
     program linear
     version 74-1 (may 1974)
     version 75-1 (april 1975)
     version 76-2 (october 1976)
     version 77-1 (january 1977)
     version 78-1 (july 1978)
     version 79-1 (july 1979) cdc-7600 and cray-1 version.
     version 80-1 (may 1980) ibm, cdc and cray version.
     version 80-2 (december 1980)
     version 81-1 (march 1981)
     version 82-1 (january 1982) improved computer compatibility.
     version 83-1 (january 1983) *major re-design.
                                 *page size increased - 1002 to 3006.
                                 *eliminated computer dependent coding.
                                 *new, more compatible i/o unit number.
                                 *added option to keep all original
                                  energy points from evaluation.
                                 *added standard allowable error option
                                  (currently 0.1 per-cent).
     version 83-2 (october 1983) improved based on user comments.
     version 84-1 (april 1984)   improved based on user comments.
     version 84-2 (june 1984)   *updated for endf/b-vi formats.
                                *special i/o routines to guarantee
                                 accuracy of energy.
                                *double precision treatment of energy
                                 (required for narrow resonances).
     version 85-1 (august 1985) *fortran-77/h version
     version 86-1 (january 1986)*endf/b-vi format
     version 87-1 (january 1987)*double precision treatment of cross
                                 section
     version 88-1 (july 1988)   *option...internally define all i/o
                                 file names (see, subroutine fileio
                                 for details).
                                *improved based on user comments.
     version 89-1 (january 1989)*psychoanalyzed by program freud to
                                 insure program will not do anything
                                 crazy.
                                *updated to use new program convert
                                 keywords.
                                *added livermore civic compiler
                                 conventions.
     version 90-1 (june 1990)   *extended to linearize photon
                                 interaction data, mf=23 and 27
                                *added fortran save option
                                *updated based on user comments.
                                *new more consistent energy output
                                 routine.
                                *warning...input parameter format
                                 has been changed...see description
                                 below.
     version 91-1 (july 1991)   *added interpolation law 6 - only used
                                 for charged particle cross sections
                                 for coulomb penetrabilities.
     version 92-1 (january 1992)*added nu-bar (total, delayed, prompt)
                                 polynomial or tabulated all converted
                                 to linearly interpolable
                                *increased page size from 3006 to 5010
                                 points.
                                *all energies internally rounded prior
                                 to calculations.
                                *completely consistent i/o and rounding
                                 routines - to minimize computer
                                 dependence.
     version 92-2 (july 1992)   *corrected conversion of nu-bar from
                                 polynomial to tabulated - copy
                                 spontaneous nu-bar (by definition
                                 the spontaneous nu-bar is not an
                                 energy dependent quantity).
     version 93-1 (march 1993)  *updated for use with lahey compiler
                                 on ibm-pcs.
                                *increased page size from 5010 to
                                 30000 points
     version 94-1 (january 1994)*variable endf/b data filenames
                                 to allow access to file structures
                                 (warning - input parameter format
                                 has been changed)
                                *close all files before terminating
                                 (see, subroutine endit)
     version 96-1 (january 1996) *complete re-write
                                 *improved computer independence
                                 *all double precision
                                 *on screen output
                                 *uniform treatment of endf/b i/o
                                 *improved output precision
                                 *defined scratch file names
                                 *always include thermal value
                                 *increased page size from 30000 to
                                  60000 points
     version 99-1 (march 1999)   *corrected character to floating
                                  point read for more digits
                                 *updated test for endf/b format
                                  version based on recent format change
                                 *general improvements based on
                                  user feedback
     version 99-2 (june 1999)    *assume endf/b-vi, not v, if missing
                                  mf=1, mt-451.
     vers. 2000-1 (february 2000)*added mf = 9 and 10 linearization
                                 *general improvements based on
                                  user feedback

     owned, maintained and distributed by
     ------------------------------------
     the nuclear data section
     international atomic energy agency
     p.o. box 100
     a-1400, vienna, austria
     europe

     originally written by
     ------------------------------------
     dermott e. cullen
     current address
     university of california
     lawrence livermore national laboratory
     l-86
     p.o. box 808
     livermore, ca 94550
     u.s.a.
     telephone  925-423-7359
     e. mail    cullen1@llnl.gov
     website    http://reddog1.llnl.gov

     authors message
     ---------------
     the report described above is the latest published documentation
     for this program. however, the comments below should be considered
     the latest documentation including all recent improvements. please
     read all of these comments before implementation.

     at the present time we are attempting to develop a set of computer
     independent programs that can easily be implemented on any one
     of a wide variety of computers. in order to assist in this project
     it would be appeciated if you would notify the author of any
     compiler diagnostics, operating problems or suggestions on how to
     improve this program. hopefully, in this way future versions of
     this program will be completely compatible for use on your
     computer.

     purpose
     -------
     this program is designed to convert endf/b file 3, 23 and 27 data
     to linear-linear interpolable form. any section that is already
     linear-linear interpolable will be thinned.

     in the following discussion for simplicity the endf/b terminology
     ---endf/b tape---will be used. in fact the actual medium may be
     tape, cards, disk or any other medium.

     endf/b format
     -------------
     this program only uses the endf/b bcd or card image format (as
     opposed to the binary format) and can handle data in any version
     of the endf/b format (i.e., endf/b-i, ii,iii, iv, v or vi format).

     it is assumed that the data is correctly coded in the endf/b
     format and no error checking is performed. in particular it is
     assumed that the mat, mf and mt on each line is correct. sequence
     numbers (columns 76-80) are ignored on input, but will be
     correctly output on all lines. the format of section mf=1, mt=451
     and all sections of mf=3 must be correct. the program copies all
     other section of data as hollerith and as such is insensitive to
     the correctness or incorrectness of all other sections.

     output format
     -------------
     in this version of linear all energies will be output in
     f (instead of e) format in order to allow energies to be written
     with up to 9 digits of accuracy. in previous versions this was an
     output option. however use of this option to compare the results
     of energies written in the normal endf/b convention of 6 digits
     to the 9 digit output from this program demonstrated that failure
     to use the 9 digit output can lead to large errors in the data
     due to truncation of energies to 6 digits during output.

     contents of output
     ------------------
     entire evaluations are output, not just the linearized data
     cross sections, e.g. angular and energy distributions are also
     included.

     documentation
     -------------
     the fact that this program has operated on the data is documented
     by the addition of 3 comment lines at the end of each hollerith
     section in the form

     ***************** program linear (2000-1) ****************
     for all data greater than 1.00000-10 in absolute value
     data linearized to within an accuracy of  0.1  per-cent

     the order of similar comments (from recent, sigma1 and groupie)
     represents a complete history of all operations performed on
     the data by these programs.

     these comment lines are only added to existing hollerith sections,
     i.e., this program will not create a hollerith section. the format
     of the hollerith section in endf/b-v differs from the that of
     earlier versions of endf/b. by reading an existing mf=1, mt=451
     it is possible for this program to determine which version of
     the endf/b format the data is in. without having a section of
     mf=1, mt=451 present it is impossible for this program to
     determine which version of the endf/b format the data is in, and
     as such it is impossible for the program to determine what format
     should be used to create a hollerith section.

     reaction index
     --------------
     this program does not use the reaction index which is given in
     section mf=1, mt=451 of each evaluation.

     this program does not update the reaction index in mf=1, mt=451.
     this convention has been adopted because most users do not
     require a correct reaction index for their applications and it was
     not considered worthwhile to include the overhead of constructing
     a correct reaction index in this program. however, if you require
     a reaction index for your applications, after running this program
     you may use program diction to create a correct reaction index.

     section size
     ------------
     since this program uses a logical paging system there is no limit
     to the number of points in any section, e.g., the total cross
     section may be represented by 200,000 data points.

     for any linearized section that contains 60000 or fewer points
     the entire operation will be performed in core and the linearized
     data will be output directly to the endf/b format. for any section
     that contains more points the data will be linearized a page at a
     time (1 page = 60000 points) and output to scratch. after the
     entire section has been linearized the data will be read back from
     scratch and output to the endf/b format.

     selection of data
     -----------------
     the program selects data to be linearized based either on either
     mat (endf/b mat no.) or za as well as mf and mt numbers. this
     program allows up to 100 mat/mf/mt or za/mf/mt ranges to be
     specified by input parameters. the program will assume that the
     endf/b tape is in mat order, regardless of the criteria used
     to retrieve materials. if retrieval is by mat range the program
     will terminate when a mat is found that is above all requested
     mat ranges. if retrieval is by za range the program will search
     the entire endf/b tape.

     program operation
     -----------------
     each section of data is considered separately. each section of
     endf/b data to linearize is represented by a table of energy
     vs. cross section and any one of five allowable interpolation laws
     between any two tabulated points. this program will replace each
     section of data cross sections by a new table of energy vs.
     cross section in which the interpolation law is always linear in
     energy and cross section between any two tabulated points.

     data is read and linearized a page at a time (one page contains
     60000 data points). if the final linearized section contains two
     pages or less, data points it will be entirely core resident
     after it has been linearized and will be written directly from
     core to the output tape. if the linearized section is larger than
     two pages, after each page is linearized it will be written to
     scratch. after the entire section has been linearized it will
     be read back from scratch, two pages at a time, and written to
     the output tape.

     keep evaluated data points
     --------------------------
     sometimes it is convenient to keep all energy points which were
     present in the original evaluation and to merely supplement these
     points with additional energy points in order to linearize the
     cross sections. for example, it is often convenient to keep the
     thermal value (at 0.0253 ev) or the value at 14.1 mev.

     the current version of this program will allow the user to keep
     all original evaluated data points by specifying 1 in columns
     34-44 of the first input line. this will turn off the backward
     thinning (see ucrl-50400, vol. 17, part a for explanation) and
     result in all original energy points being kept. caution should
     be exercised in using this option since it can result in a
     considerable increase in the number of data points output by
     this code.

     for all users who are not interested in this options no changes
     are required in the input to this program, i. e. if columns
     34-44 are blank (as for all previous versions of this code) the
     program will operate exactly as it did before.

     allowable error
     ---------------
     allowable error must always be specified in the input to this
     program as a fraction, not a per-cent. for example, input the
     allowable fractional error 0.001 in order to obtain data that is
     accurate to within 0.1 per-cent.

     the conversion of the data from the general interpolation form to
     linarly interpolable form cannot be performed exactly. however, it
     can be performed to virtually any required accuracy and most
     importantly can be performed to a tolerance that is small compared
     to the uncertainty in the cross sections themselves. as such the
     conversion of cross sections to linearly interpolable form can be
     performed with essentially no lose of information.

     the allowable error may be energy independent (constant) or energy
     dependent. the allowable error is described by a tabulated
     function of up to 20 (energy,error) pairs and linear interpolation
     between tabulated points. if only one tabulated point is given the
     error will be considered constant over the entire energy range.
     with this energy dependent error one may optimize the output for
     any given application by using a small error in the energy range
     of interest and a less stringent error in other energy ranges.

     default allowable error
     -----------------------
     in order to insure convergence of the linearizing algorithm the
     allowable error must be positive. if the user inputs an error
     that is not positive it will automatically be set to the default
     value (currently 0.001, corresponding to 0.1 per-cent) and
     indicated as such in the output listing.

     coulomb penetrability (interpolation law = 6)
     --------------------------------------------
     introduced for endf/b-vi. this is defined as,

     sig(e) = c1*exp(-c2/sqrt(e - t))

     this program only considers exothermic reactions - t = 0

     sig(e) = c1*exp(-c2/sqrt(e))

     warning...this interpolation law should only be used for reactions
               which have a positive q-value (exothermic reactions),
               since here we only consider t = 0.0 in the formalism.
               in all other cases a warning message will be printed.

     input files
     -----------
     unit  description
     ----  -----------
        2  input lines (bcd - 80 characters/record)
       10  original endf/b data (bcd - 80 characters/record)

     output files
     ------------
     unit  description
     ----  -----------
        3  output report (bcd - 120 characters/record)
       11  final endf/b data (bcd - 80 characters/record)

     scratch files
     -------------
     unit  description
     ----  -----------
       12  scratch file (binary - 180000 words/record

     optional standard file names (see subroutine fileio)
     ----------------------------------------------------
     unit  file name
     ----  ----------
       2   linear.inp
       3   linear.lst
      10   endfb.in
      11   endfb.out
      12   (scratch)


     input parameters
     ----------------
     for versions earlier than 90-1 this program only allowed the user
     to specify by input parameters which materials (mat) to process.
     for each requested material neutron interaction cross sections
     (mf=3) would be linearized and the remainder of the material
     would be copied.

     for versions 90-1 and later this program will allow the user to
     to specify by input parameters exactly what sections of data
     to process. for each section of data, specified by mat, mf, mt
     ranges, sections of mf=3, 23 and 27 will be linearized and all
     other requested sections will be copied. all sections which are
     not explicitly requested will be skipped and will not appear on
     endf/b file output by this program.

     with this new procedure you can minimize the size of the endf/b
     file output by this program, e.g., if you only want neutron
     cross sections for subsequent processing you need only request
     only mf=3 data.

     however, you must understand that only those sections which you
     explicitly request will appear on the endf/b file output by
     this program. for example, if you wish to document exactly
     how you linearized the data by including comments in mf=1, mt=451
     then you must explicitly request that mf=1, mt=451 be processed
     for each material that you request. similar if you want the
     entire evaluation you must request all mf and mt to be output.

     line  cols.  description
     ----  -----  -----------
        1   1-11  selection criteria (0=mat, 1=za)
           12-22  monitor mode selector
                  = 0 - normal operation
                  = 1 - monitor progress of linearizing of the data.
                        each time a page of data points is written to
                        the scratch file print out the total number of
                        points on scratch and the lower and upper
                        energy limits of the page (this option may be
                        used in order to monitor the execution speed
                        of long running jobs).
           23-33  minimum cross section of interest (barns).
                  (if 0.0 or less is input the program will
                  use 1.0e-10). energy intervals will not be
                  sub-divided if the absolute value of the cross
                  section within the interval is less than this value.
                  an exception to this rule is near thresholds energy
                  intervals will be sub-divided until convergence
                  regardless of the magnitude of the cross section.
           34-44  keep original evaluated data points.
                  = 0 - no.
                  = 1 - yes - additional points may be added in order
                              to linearize data, but all original
                              data points will be included in the
                              results.
        2   1-60  endf/b input data filename
                  (standard option = endfb.in)
        3   1-60  endf/b output data filename
                  (standard option = endfb.out)
      4-n   1- 6  lower mat or za limit
            7- 8  lower mf limit
            9-11  lower mt limit
           12-17  upper mat or za limit
           18-19  upper mf limit
           20-22  upper mt limit
                  up to 100 ranges may be specified, only one range
                  per line. the list of ranges is terminated by a
                  blank line. if the upper mat limit of any request
                  is less than the low limit it will be set equal to
                  the lower limit. if the upper limit is still zero
                  it will be set equal to 999999. if the upper mf or
                  mt limit is zero it will be set to 99 or 999
                  respectively.
      vary  1-11  energy for error law
           12-22  allowable fractional error for error law.
                  the acceptable linearizing error may be specified to
                  be either energy independent (defined by a single
                  error), or energy dependent (defined by up to 20
                  energy, error pairs). for the energy dependent case
                  linear interpolation will be used to define the error
                  at energies between those at which it is tabulated.
                  in all cases the error law is terminated by a blank
                  line. if only one energy, error pair is given the
                  the law will be considered to be energy independent.
                  if more than one pair is given it will be considered
                  to be energy dependent (note, energy independent
                  form will run faster than the equivalent energy
                  dependent form). for an energy dependent error law
                  all energies must be ascending energy order. for
                  convergence of the linearizing algorithm all errors
                  must be positive. if an allowable error is not
                  positive it will be set equal to the standard option
                  (currently 0.001, corresponding to 0.1 per-cent).
                  if the first error line is blank it will terminate
                  the error law and the error will be treated as
                  energy independent, equal to the standard option
                  (currently 0.1 per-cent). (see example input 4).

     example input no. 1
     -------------------
     retrieve data by za in order to find all uranium isotopes and
     thorium 232. retrieve all neutron interaction cross sections
     (mf=3). all energy intervals in which the cross section is
     at least 1 micro-barn (1.0e-06 barns) will be subdivided.
     backward thinning will be performed. from 0 to 100 ev linearize
     to within 0.1 per-cent accuracy. from 100 ev to 1 kev vary
     accuracy between 0.1 and 1.0 per-cent. above 1 kev use 1
     per-cent accuracy.

     explicitly specify the standard filenames.

     in this case the following 11 input lines are required

          1          0 1.00000- 6          0
 endfb.in
 endfb.out
 92000 3  0 92999 3999
 90232 3  0     0 3  0    (upper limit automatically set to 90232 3999)
                          (end of request list)
 0.00000+ 0 1.00000-03
 1.00000+ 2 1.00000-03
 1.00000+ 3 1.00000-02
 1.00000+ 9 1.00000-02
                          (end of error law)

     example input no. 2
     -------------------
     same as the above case, except linearize all data to within the
     standard accuracy (currently 0.1 per-cent). in order to use the
     standard accuracy you need not specify any error law at all. in
     this case include the hollerith section, mf=1, mt=451, for each
     material.

     leave the definition of the filenames blank - the program will
     then use standard filenames.

     in this case the following 9 input lines are required

          1          0 1.00000- 6          0
                          (use default filename = endfb.in)
                          (use default filename = endfb.out)
 92000 1451 92999 1451
 92000 3  0 92999 3999
 90232 1451     0 1451
 90232 3  0     0 3  0    (upper limit automatically set to 90232 3999)
                          (end of request list)
                          (0.1 per-cent error, end of error law)

     example input no. 3
     -------------------
     linearize all materials on an endf/b tape to within an accuracy
     of 0.5 per-cent (0.005 as a fraction). in this case you need not
     specify the mat, mf, mt ranges.

     read the endf/b data from \endfb6\za092238 and write the endf/b
     data to \endfb6\linear\za092238.

     in this case the following 6 input lines are required

                                             (mat, 1.0e-10 barns, thin)
 \endfb6\za092238
 \endfb6\linear\za092238
                          (retrieve all data, end request list)
            5.00000-03
                          (end of error law)

     note that in this case if the input had specified an equivalent
     energy dependent error law by giving a number of energy points
     at each of which the error is 0.5 per-cent the program would take
     longer to run (i.e., only use an energy dependent error law when
     it is necessary).

     example input no. 4
     -------------------
     in order to linearize all materials on an endf/b tape to the
     standard option of 0.1 per-cent it is adequate to input a set
     of completely blank lines which will automatically invoke all
     of the standard options.

     leave the definition of the filenames blank - the program will
     then use standard filenames.

     in this case the following three input lines are required

                                             (mat, 1.0e-10 barns, thin)
                          (use default filename = endfb.in)
                          (use default filename = endfb.out)
                          (retrieve all data, end request list)
                          (0.1 per-cent error, end of error law)

