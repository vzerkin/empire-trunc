Ccc   * $Rev: 2443 $
Ccc   * $Author: mherman $
Ccc   * $Date: 2012-02-06 04:12:36 +0100 (Mo, 06 Feb 2012) $

C--------------------------------------------------------------------------------------
C     Customized version of ECIS06 (some printing added)
C     20. Aug. 2008
C--------------------------------------------------------------------------------------
      SUBROUTINE ECIS(fname)

C 19/04/07                                                      ECIS06  ECIS-000
C                                                                       ECIS-001
C THE COMMON /INOUT/ IS USED IN ANY SUBROUTINE WITH STANDARD INPUT OR   ECIS-002
C                            OUTPUT AND SAVE OR RESTART A SEARCH.       ECIS-003
C FOR THE COMMON  /DCONS/ SEE CALC.                                     ECIS-004
C                                                                       ECIS-005
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INOUT/:                     ECIS-006
C  MR:        STANDARD INPUT FILE (USUAL VALUE 5).                      ECIS-007
C  MW:        STANDARD OUTPUT FILE (USUAL VALUE 6).                     ECIS-008
C  MS:        FILE TO SAVE OR RESTART A SEARCH IN REST (USUAL VALUE 8). ECIS-009
C                                                                       ECIS-010
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     ECIS-011
C  CM:        ATOMIC MASS IN MEV.                                       ECIS-012
C  CHB:       PLANCK CONSTANT X SPEED OF LIGHT /(2*PI) IN MEV*FERMI.    ECIS-013
C  CZ:        ELECTRIC CONSTANT.                                        ECIS-014
C   DEFINED:  CM,CHB,CZ                                                 ECIS-015
C                                                                       ECIS-016
C CONSTANTS COMPUTED FROM THE FUNDAMENTAL CONSTANTS, ATOMIC MASS, HBAR*CECIS-017
C AND ALPHA, AS GIVEN IN THE JOURNAL OF PHYSICS G, VOLUME 33, PAGE 97,  ECIS-018
C (JULY 2006) REFERRING FOR THESE VALUES TO THE 2002 CODATA SET WHICH   ECIS-019
C MAY BE FOUND AT HTTP://PHYSICS.NIST.GOV/CONSTANTS.                    ECIS-020
C     CM=931.494043 +/- 0.000080 MEV/C**2                               ECIS-021
C     CHB=197.326968 +/- 0.000017 MEV FM                                ECIS-022
C     CZ=137.03599911 +/- 0.00000046 WITHOUT DIMENSION                  ECIS-023
C                                                                       ECIS-024
C***********************************************************************ECIS-025
      IMPLICIT REAL*8 (A-H,O-Z)                                         ECIS-026
C
C Dummy arguments
C
      CHARACTER*(*) fname

      PARAMETER (IDMX=35000000)                                         ECIS-027
      CHARACTER*4 CW(2,IDMX)                                            ECIS-028

      DIMENSION NW(2,IDMX),DW(IDMX)                                     ECIS-029
      EQUIVALENCE (DW,NW,CW,W)                                          ECIS-030
      COMMON DW                                                         ECIS-031
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            ECIS-032
      COMMON /INOUT/ MR,MW,MS                                           ECIS-033
      CM=931.494043D0                                                   ECIS-034
      CHB=197.326968D0                                                  ECIS-035
      CZ=137.03599911D0                                                 ECIS-036

      MR=95                                                             ECIS-037
      MW=96                                                             ECIS-038
      MS=97

      OPEN (58,FILE = TRIM(fname)//'.cs')
      OPEN (55,FILE = TRIM(fname)//'.dat')
      OPEN (59,FILE = TRIM(fname)//'.ics')
      OPEN (60,FILE = TRIM(fname)//'.smat')
      OPEN (61,FILE = 'file61')
      OPEN (62,FILE = 'file62')
      OPEN (63,FILE = TRIM(fname)//'.tlj')
      OPEN (64,FILE = TRIM(fname)//'.exp')
      OPEN (65,FILE = TRIM(fname)//'.leg')
      OPEN (66,FILE = TRIM(fname)//'.ang')

      OPEN (85,FILE = 'file85')
      OPEN (86,FILE = 'file86')
      OPEN (87,FILE = 'file87')
      OPEN (88,FILE = 'file88')
      OPEN (89,FILE = 'file89')
      OPEN (90,FILE = 'file90')
      OPEN (91,FILE = 'file91')
      OPEN (93,FILE = 'file93')
      OPEN (94,FILE = 'file94')

      OPEN (95,FILE = TRIM(fname)//'.inp')
      OPEN (96,FILE = TRIM(fname)//'.out')
      OPEN (97,FILE = 'file97')

      OPEN (99,FILE = 'file99')
      CALL THORA(MW)      
      CALL CALC(NW,CW,DW,IDMX)                                          ECIS-040
      CALL THORA(MW)
      CLOSE (58)
      CLOSE (55)
      CLOSE (59)
      CLOSE (60)
      CLOSE (61,STATUS = 'delete')
      CLOSE (62,STATUS = 'delete')
      CLOSE (63)
      CLOSE (64)
      CLOSE (65)
      CLOSE (66)
      CLOSE (85,STATUS = 'delete')
      CLOSE (86,STATUS = 'delete')
      CLOSE (87,STATUS = 'delete')
      CLOSE (88,STATUS = 'delete')
      CLOSE (89,STATUS = 'delete')
      CLOSE (90,STATUS = 'delete')
      CLOSE (91,STATUS = 'delete')
      CLOSE (93,STATUS = 'delete')
      CLOSE (94,STATUS = 'delete')
      CLOSE (95)
      CLOSE (96)
      CLOSE (97,STATUS = 'delete')
      CLOSE (99,STATUS = 'delete')
      RETURN                                                            ECIS-041
      END                                                               ECIS-042
C 19/11/05                                                      ECIS06  MEMO-000
      SUBROUTINE MEMO(NAME,IDMT,NPLACE)                                 MEMO-001
C CONTROL OF MEMORY AREA.                                               MEMO-002
C INPUT:     NAME:    NAME OF CALLING SUBROUTINE.                       MEMO-003
C            IDMT:    PREVIOUS SPACE.                                   MEMO-004
C            NPLACE:  REQUESTED SPACE.                                  MEMO-005
C                                                                       MEMO-006
C THIS SUBROUTINE CAN BE REPLACED BY A SUBROUTINE INCREASING THE COMMON MEMO-007
C IF IT IS POSSIBLE.                                                    MEMO-008
C***********************************************************************MEMO-009
      CHARACTER*4 NAME                                                  MEMO-010
      COMMON /INOUT/ MR,MW,MS                                           MEMO-011
      IF (IDMT.GE.NPLACE) RETURN                                        MEMO-012
      WRITE (MW,1000) IDMT,NPLACE,NAME                                  MEMO-013
      STOP                                                              MEMO-014
 1000 FORMAT (' NOT ENOUGH PLACE .....   ',I10,' MEMORIES ALLOWED',I10,'MEMO-015
     1 MEMORIES REQUESTED.'///' IN ',A4,'  ...  STOP  ...')             MEMO-016
      END                                                               MEMO-017
C 07/02/06                                                      ECIS06  HORA-000
      SUBROUTINE HORA                                                   HORA-001
C GIVES THE TIME ELAPSED SINCE THE FIRST CALL AND SINCE THE LAST CALL.  HORA-002
C***********************************************************************HORA-003
      DIMENSION A(2)                                                    HORA-004
      COMMON /INOUT/ MR,MW,MS                                           HORA-005
      DATA M0,M2 /2*0/                                                  HORA-006
      SAVE M0,M2                                                        HORA-007
      M1=INT(1000.*ETIME(A))                                            HORA-008
      N5=M1-M2                                                          HORA-009
      NT=M1-M0                                                          HORA-010
      M2=M1                                                             HORA-011
      NS=NT/1000                                                        HORA-012
      NT=NT-1000*NS                                                     HORA-013
      NM=NS/60                                                          HORA-014
      NS=NS-60*NM                                                       HORA-015
      NH=NM/60                                                          HORA-016
      NM=NM-60*NH                                                       HORA-017
      WRITE (MW,1000) NH,NM,NS,NT,N5                                    HORA-018
      RETURN                                                            HORA-019
 1000 FORMAT (' *** TOTAL TIME ***',I3,'H',I3,'MN',I3,'S',I4,' MS',10X,'HORA-020
     1DIFFERENCE SINCE LAST CALL',I9,' MILLISECONDS.')                  HORA-021
      END                                                               HORA-022
C 23/02/07                                                      ECIS06  CALC-000
      SUBROUTINE CALC(NW,CW,DW,IDMX)                                    CALC-001
C MAIN SUBROUTINE OF THE PROGRAM.                                       CALC-002
C INPUT:     NW:      WORKING AREA FOR INTEGERS.                        CALC-003
C            CW:      WORKING AREA FOR CHARACTERS.                      CALC-004
C            DW:      WORKING AREA FOR DOUBLE PRECISION.                CALC-005
C            IDMX:    LENGTH OF DW.                                     CALC-006
C               NW,CW,DW ARE IN EQUIVALENCE BY CALL.                    CALC-007
C                                                                       CALC-008
C THE COMMON /ADDRE/ IS USED IN CALC, CALX, CAL1, VARI, EVAL AND REST.  CALC-009
C THE COMMON /COUPL/ IS USED IN CALC, CALX, LECL, LECT, REDM, VIBM,     CALC-010
C                               ROTM, ROAM, EXTP, LDIS, CAL1, POTE,     CALC-011
C                               ROTP, VARI, EVAL AND REST.              CALC-012
C THE COMMON /DCONS/ IS USED IN ECIS, CALC, LECL, LECT, COLF, KHCO,     CALC-013
C                               CONU, CAL1, POTE, ROTP, ROTZ, STDP,     CALC-014
C                               STBF, MTCH, SCAM, SCHE, LCSP, RESU,     CALC-015
C                               SCAT AND REST.                          CALC-016
C THE COMMON /INTEG/ IS USED IN CALC, CALX, DEPH, LECD, CAL1, VARI,     CALC-017
C                               EVAL AND REST.                          CALC-018
C THE COMMON /TITRE/ IS USED IN CALC, CALX, RESU, EVAL AND REST.        CALC-019
C                                                                       CALC-020
C FOR THE COMMON  /CONVE/, /DCHI2/ AND /NCOMP/ SEE CALX.                CALC-021
C FOR THE COMMONS /POTE1/ AND /POTE2/ SEE REDM.                         CALC-022
C                                                                       CALC-023
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ADDRE/:                     CALC-024
C  NIPH:      NUMBER OF PHONONS FOR THE HARMONIC VIBRATIONAL MODEL.     CALC-025
C  NJIT:      DATA FOR INTERPOLATION ON TOTAL SPIN.                     CALC-026
C  NWV:       NON INTEGER VALUES FOR THE CHANNELS.                      CALC-027
C  NIPP:      DISPERSION PARAMETERS.                                    CALC-028
C  NPAR:      INDICATIONS FOR NUCLEAR PARAMETERS.                       CALC-029
C  NPAA:      VALUES OF NUCLEAR PARAMETERS.                             CALC-030
C  NSCN:      LEVEL DENSITY DESCRIPTION.                                CALC-031
C  NFIS:      FISSION DATA FOR COMPOUND NUCLEUS.                        CALC-032
C  NGAM:      GAMMA DATA FOR COMPOUND NUCLEUS.                          CALC-033
C  NNIV:      ADDRESSES OF REDUCED NUCLEAR MATRIX ELEMENTS AND COULOMB  CALC-034
C             INTEGRALS IN NIV(NCOLL,NCOLL,3).                          CALC-035
C  NPOT:      OPTICAL POTENTIAL PARAMETERS.                             CALC-036
C  NBETA:     DEFORMATION PARAMETERS.                                   CALC-037
C  NFM:       HELICITIES AND OBSERVABLES (SEE DEPH,LECD AND OBSE).      CALC-038
C  NTGX:      BEGINNING OF CHI2 AND NORMALISATION OF DATA.              CALC-039
C  NDONN:     EXPERIMENTAL DATA.                                        CALC-040
C  NNVI:      TABLE OF ADDRESSES OF COUPLING COEFFICIENTS.              CALC-041
C  NDE:       SEARCH ACCURACIES.                                        CALC-042
C  NISE:      INDEXES OF THE VARIABLE PARAMETERS IN SEARCH.             CALC-043
C  NRC:       PERMANENT WORKING FIELD FOR THE SEARCH.                   CALC-044
C  NIW:       INTEGER WORKING FIELD FOR THE SEARCH.                     CALC-045
C  NNWI:      SAME AS NNVI FOR SYMMETRISED EQUATIONS.                   CALC-046
C  NCC:       TABLE OF ENERGIES, L*(L+1) AND L*S  (SEE QUAN).           CALC-047
C  MCC:       SAME AS NCC FOR SYMMETRISED EQUATIONS.                    CALC-048
C  NXA:       TABLE OF COEFFICIENTS OF SYMMETRISATION.                  CALC-049
C  NAM1:      COMPUTATION OF OBSERVABLES (SEE OBSE).                    CALC-050
C  NFAC:      TABLE OF LOG OF FACTORIALS FOR GEOMETRIC COEFFICIENTS.    CALC-051
C  NFG:       COULOMB FUNCTIONS AND FINITE INTEGRALS.                   CALC-052
C  NXG:       COULOMB PHASES AND INFINITE INTEGRALS.                    CALC-053
C  NRES:      FUNCTIONS FOR THE SEARCH.                                 CALC-054
C  NXX:       VARIABLES FOR THE SEARCH.                                 CALC-055
C  NT:        TABLE OF REDUCED NUCLEAR MATRIX ELEMENTS.                 CALC-056
C  NIVQ:      TABLE OF MULTIPOLES.                                      CALC-057
C  NIVY:      TABLE OF FORM FACTOR IDENTIFICATION IVY (FOR COMPUTATION).CALC-058
C  NIVZ:      TABLE OF FORM FACTOR IDENTIFICATION IVZ (FOR USE).        CALC-059
C  NCOI:      ADDRESS OF THE TABLE FOR DISCRETISATION OF CONTINUUM.     CALC-060
C  MIPI:      ADDRESS OF "IPIM" FOR THE DISCRETISATION OF CONTINUUM.    CALC-061
C  NXD:       ADDRESS OF WEIGHTS AND STEPS OF CONTINUUM.                CALC-062
C  MWV:       SAME AS NWV FOR THE DISCRETISATION OF CONTINUUM.          CALC-063
C  NIXT:      TRANSMISSION COEFFICIENTS OF UNCOUPLED STATES.            CALC-064
C  NTY:       TEMPORARY RESULTS OF COMPOUND NUCLEUS FOR INTERPOLATION.  CALC-065
C  NSM:       STANDARD AND HELICITY SCATTERING MATRIX ELEMENTS.         CALC-066
C  NTX:       PARTIAL REACTION CROSS SECTIONS AND COMPOUND NUCLEUS.     CALC-067
C  NRY:       COMPOUND NUCLEUS COEFFICIENTS.                            CALC-068
C  NRCO:      STRENGTH OF COULOMB CENTRAL POTENTIALS FOR CORRECTIONS.   CALC-069
C  NRDO:      STRENGTH OF COULOMB TRANSITION POTENTIALS FOR CORRECTIONS.CALC-070
C  NVC1:      REAL POTENTIALS.                                          CALC-071
C  NVC2:      IMAGINARY POTENTIALS.                                     CALC-072
C  NNC:       FIRST FREE ADDRESS AFTER COMPUTATION OF POTENTIALS.       CALC-073
C  NCX:       FIRST FREE ADDRESS FOR COMPUTATION OF POTENTIALS.         CALC-074
C   DEFINED:  NPOT,NT,NIVQ,NIVY,NIVZ,NCOI,MIPI,NXD,MWV,NIXT,NTY,NSM,NTX,CALC-075
C             NRY,,NRDO,NVC1,NVC2,NNC,NCX.                              CALC-076
C   USED:     NIPH,NWV,NIPP,NPAR,NPAA,NSCN,NNIV,NPOT,NBETA,NDE,NRC,NIW, CALC-077
C             NFAC,NFG,NXG,NRES,NXX,NT,NIVQ,NIVY,NIVZ,NCOI,MIPI,NXD,MWV,CALC-078
C             NIXT,NTY,NSM,NTX,NRY,NRCO,NRDO,NVC1,NNC,NCX.              CALC-079
C   NOT USED: NJIT,NFIS,NGAM,NFM,NTGX,NDONN,NNVI,NISE,NNWI,NCC,MCC,NXA, CALC-080
C             NAM1.                                                     CALC-081
C                                                                       CALC-082
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     CALC-083
C  H:         STEP SIZE FOR INTEGRATION.                                CALC-084
C   USED:     H                                                         CALC-085
C                                                                       CALC-086
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     CALC-087
C  IQM:       MAXIMUM L-VALUE OF DEFORMATION IN ROTATIONAL MODEL.       CALC-088
C  IQMAX:     MAXIMUM L-EXPANSION IN ROTATIONAL MODEL.                  CALC-089
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           CALC-090
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       CALC-091
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             CALC-092
C  NSPIN:     TWICE THE K-VALUE OF THE ROTATIONAL BAND.                 CALC-093
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             CALC-094
C   USED:     IQMAX,NFA,NPP,NSPIN                                       CALC-095
C   NOT USED: IQM,NBT1,NVA                                              CALC-096
C                                                                       CALC-097
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCHI2/:                     CALC-098
C  CHI2M:     MINIMUM CHI-SQUARE IN THE SEARCH.                         CALC-099
C   DEFINED:  CHI2M.                                                    CALC-100
C                                                                       CALC-101
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     CALC-102
C  CM:        ATOMIC MASS IN MEV.                                       CALC-103
C  CHB:       PLANCK CONSTANT /(2*PI) IN MEV*FERMI.                     CALC-104
C  CZ:        ELECTRIC CONSTANT.                                        CALC-105
C  CMB:       ATOMIC MASS CM DIVIDED BY H-BAR*C.                        CALC-106
C  CCZ:       COULOMB ALPHA CONSTANT.                                   CALC-107
C  CK:        H-BAR*C.                                                  CALC-108
C  XZ:        CONVERSION FACTOR TO MILLIBARNS.                          CALC-109
C   DEFINED:  CMB,CCZ,CK.                                               CALC-110
C   USED:     CM,CHB,CZ.                                                CALC-111
C   NOT USED: XZ.                                                       CALC-112
C                                                                       CALC-113
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INTEG/:                     CALC-114
C  IDMT:      TOTAL WORKING FIELD LENGTH AS SINGLE PRECISION.           CALC-115
C  NPLACE:    MAXIMUM WORKING FIELD USED.                               CALC-116
C  NCOLL:     NUMBER OF COUPLED CHANNELS.                               CALC-117
C  NJMAX:     MAXIMUM NUMBER OF J-VALUES.                               CALC-118
C  ITERM:     MAXIMUM NUMBER OF ITERATIONS.                             CALC-119
C  JDM:       MINIMUM NUMBER OF TOTAL SPIN.                             CALC-120
C  JIT:       NUMBER OF RATES OF INTERPOLATION ON TOTAL SPIN.           CALC-121
C  KMIN:      MINIMUM NUMBER OF J VALUES FOR COMPOUND NUCLEUS.          CALC-122
C  KMAX:      MAXIMUM NUMBER OF J VALUES FOR COMPOUND NUCLEUS.          CALC-123
C  NCOLS:     NUMBER OF CHANNELS WITH ANGULAR DISTRIBUTIONS.            CALC-124
C  NCOLT:     NUMBER OF CHANNELS INCLUDING UNCOUPLED STATES.            CALC-125
C  NBET:      NUMBER OF DIFFERENT DEFORMATIONS (VIBRATIONS+ROTATIONS).  CALC-126
C  LMX:       DIFFERENCE BETWEEN NUMBER OF J AND OF COULOMB FUNCTIONS.  CALC-127
C  LMAX1:     NUMBER OF L-VALUES FOR COULOMB FUNCTIONS.                 CALC-128
C  NLT:       MEMORIES NEEDED FOR LEGENDRE POLYNOMIALS.                 CALC-129
C  ISM:       NUMBER OF INTEGRATION STEPS.                              CALC-130
C  NJC:       MAXIMUM NUMBER OF OBSERVABLES AT EQUIDISTANT ANGLES.      CALC-131
C  JTX:       MAXIMUM NUMBER OF CALCULATED VALUES FOR A PLOT.           CALC-132
C  KCC:       NUMBER OF INDEPENDENT AMPLITUDES WITH UNCOUPLED STATES.   CALC-133
C  MS1:       LARGEST PARTICLE MULTIPLICITY.                            CALC-134
C  MS2:       LARGEST TARGET MULTIPLICITY.                              CALC-135
C  KBA:       NUMBER OF INDEPENDENT AMPLITUDES WITHOUT UNCOUPLED STATES.CALC-136
C  KAB:       MAXIMUM NUMBER OF EQUATIONS.                              CALC-137
C  KBC:       MAXIMUM NUMBER OF SOLUTIONS.                              CALC-138
C  JTH:       MAXIMUM NUMBER OF ANGLES FOR A PLOT.                      CALC-139
C  NCOLR:     NUMBER OF EXPERIMENTAL ANGULAR DISTRIBUTIONS.             CALC-140
C  NREC:      NUMBER OF VARIABLES IN SEARCH.                            CALC-141
C  NTOT:      NUMBER OF EXPERIMENTAL DATA.                              CALC-142
C  LMAX2:     NUMBER OF L VALUES FOR COULOMB PHASES.                    CALC-143
C  KE:        CONTROL OF SEARCH (SEE FITE).                             CALC-144
C  ITEMM:     MAXIMUM NUMBER OF ITERATIONS AT THE BEGINNING OF A RUN.   CALC-145
C  KXT:       NUMBER OF PENETRABILITIES FOR UNCOUPLED STATES.           CALC-146
C  LMAX3:     EFFECTIVE NUMBER OF COULOMB FUNCTIONS.                    CALC-147
C  NRZ:       NUMBER OF RESULTS TO SAVE FOR MINIMUM CHI2..              CALC-148
C  NTZ:       NUMBER OF MEMORIES TO INITIALISE TO ZERO FOR SCATTERING   CALC-149
C             MATRIX AND COMPOUND NUCLEUS RESULTS..                     CALC-150
C  IPM:       NUMBER PF J VALUES USED FOR SCATTERING MATRIX (IN CAL1).  CALC-151
C  IPK:       NUMBER PF J VALUES USED FOR COMPOUND NUCLEUS (IN CAL1).   CALC-152
C  MCM(1):    MAXIMUM ANGULAR MOMENTUM FOR CENTRAL COULOMB CORRECTIONS. CALC-153
C  MCM(2):    MAXIMUM ANGULAR MOMENTUM FOR SPIN-ORBIT COULOMB CORRECT.  CALC-154
C  NCT(1):    NUMBER OF EQUATIONS FOR POSITIVE PARITY.                  CALC-155
C  NCT(2):    NUMBER OF EQUATIONS FOR NEGATIVE PARITY.                  CALC-156
C  NCT(3):    NUMBER OF SOLUTIONS FOR POSITIVE PARITY.                  CALC-157
C  NCT(4):    NUMBER OF SOLUTIONS FOR NEGATIVE PARITY.                  CALC-158
C  NCT(5):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, POSITIVE PARITY. CALC-159
C  NCT(6):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, NEGATIVE PARITY. CALC-160
C   DEFINED:  IDMT,NPLACE,KE,NRZ,NTZ.                                   CALC-161
C   USED:     IDMT,NPLACE,NCOLL,NJMAX,KMAX,NCOLS,NCOLT,NBET,LMAX1,ISM,  CALC-162
C             KCC,KBA,NREC,NTOT,LMAX2,KE,KXT,LMAX3.                     CALC-163
C   NOT USED: ITERM,JDM,JIT,KMIN,LMX,NLT,NJC,JTX,MS1,MS2,KAB,KBC,JTH,   CALC-164
C             NCOLR,ITMM,IPM,IPK,MCM,NCT.                               CALC-165
C                                                                       CALC-166
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     CALC-167
C  NSP(1):    NUMBER OF UNCOUPLED LEVELS FOR COMPOUND NUCLEUS           CALC-168
C             INCLUDING DISCRETISATION OF CONTINUUM.                    CALC-169
C  NSP(2):    NUMBER OF THESE LEVELS WITH ANGULAR DISTRIBUTION.         CALC-170
C  NSP(3):    NUMBER OF THESE LEVELS WITHOUT ANGULAR DISTRIBUTION.      CALC-171
C  NIE:       NUMBER OF UNCOUPLED STATES ADDED FOR DISCRETISATION.      CALC-172
C  NCOLX:     TOTAL NUMBER OF LEVELS WITHOUT DISCRETISATION.            CALC-173
C  NDP:       ADDRESS OF FISSION AND GAMMA FINAL RESULTS.               CALC-174
C  NDQ:       ADDRESS OF FISSION AND GAMMA INTERMEDIATE RESULTS.        CALC-175
C   DEFINED:  NSP,NIE,NCOLX,NDP,NDQ.                                    CALC-176
C   USED:     NSP,NIE,NCOLX.                                            CALC-177
C                                                                       CALC-178
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE1/:                     CALC-179
C  ITX(16):   STARTING ADDRESS OF DIFFERENT FORM FACTORS.               CALC-180
C             FOR SCHROEDINGER EQUATION, ITX(I)+1 IS THE STARTING       CALC-181
C             ADDRESS OF THE FORM FACTOR READ IN EXTP WITH ITYP=I       CALC-182
C             (POTENTIAL FOR I=1 TO 8, TRANSITION FOR I=9 TO 16).       CALC-183
C             FOR DIRAC EQUATIONS, ITX(1)=0,                            CALC-184
C             ITX(2)+1=ADDRESS OFF FIRST TRANSITION FORM FACTOR,        CALC-185
C             ITX(7)=ADDRESS OF LAST TRANSITION FORM FACTOR,            CALC-186
C             ITX(3)=ADDRESS OF LAST TEMPORARY CENTRAL POTENTIAL,       CALC-187
C             ITX(4)=ITX(7)-24,ITX(5)=ITX(3)-11,ITX(6)=ITX(2)-4.        CALC-188
C             ALL ARE USED FOR SCHROEDINGER, THE FIRST 8 FOR DIRAC.     CALC-189
C  INTC:      NUMBER OF FORM FACTORS WITHOUT DEFORMED SPIN-ORBIT        CALC-190
C             INCLUDING CORRECTION TERMS.                               CALC-191
C  ITXM:      TOTAL NUMBER OF FORM FACTORS.                             CALC-192
C   USED:     ITX(1),ITX(2),INTC,ITXM.                                  CALC-193
C                                                                       CALC-194
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     CALC-195
C  ITY(2):    STARTING ADDRESS OF IMAGINARY CENTRAL POTENTIAL.          CALC-196
C        ITY(2)=14*NCOLL IS USED FOR DIRAC EQUATIONS.                   CALC-197
C  INTV:      SAME AS INVT, TAKING INTO ACCOUNT DISPERSION.             CALC-198
C  NPX:       NUMBER OF POTENTIALS TAKING INTO ACCOUNT DISPERSION.      CALC-199
C   USED:     ITY(2),INTV,NPX.                                          CALC-200
C                                                                       CALC-201
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /TITRE/:                     CALC-202
C  TITLE(18): TITLE OF THE RUN PRINTED AS HEADING OF RESULTS.           CALC-203
C   USED:     TITLE.                                                    CALC-204
C                                                                       CALC-205
C ******** MEANING OF THE LOGICAL CONTROLS LO ********                  CALC-206
C                                                                       CALC-207
C LO(135+I)=LO(50+I) FOR I=1,15 DURING SEARCH IF LO(51) TO LO(65) ARE   CALC-208
C USED ONLY FOR COMPLETE OUTPUT.                                        CALC-209
C THE VALUES OF THE FIRST 100 LO ARE READ IN CALX ON TWO DATA CARDS.    CALC-210
C THE FIRST DATA CARD IS FOR 1-50,THE SECOND FOR 51-100.                CALC-211
C ONLY,THE VALUES LISTED ON THE INPUT DESCRIPTION ARE USED.             CALC-212
C *** FOR THEIR MEANING, SEE THIS DESCRIPTION *****                     CALC-213
C EXCEPTION IF LO(36)=.TRUE.: ONLY THE FIRST CARD IS READ, THE CODE DOESCALC-214
C NOT TAKE THEM INTO ACCOUNT BUT CONTINUE A SEARCH SAVED ON TAPE MS.    CALC-215
C                                                                       CALC-216
C *** MEANING OF THE 100 FIRST LO USED HERE ********                    CALC-217
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    CALC-218
C               LO(10) =.TRUE. DISPERSION RELATIONS FOR POTENTIALS.     CALC-219
C               LO(32) =.TRUE. AUTOMATIC SEARCH ON SOME PARAMETERS.     CALC-220
C               LO(34) =.TRUE. NEXT CALCULATION CHANGING ENERGY AND/OR  CALC-221
C                              SOME PARAMETERS.                         CALC-222
C               LO(35) =.TRUE. SEARCH SAVED ON TAPE 8 IF CORRECTLY ENDEDCALC-223
C                              OR STOPPED BY THE NUMBER OF EVALUATIONS. CALC-224
C               LO(36) =.TRUE. RESTART A SEARCH FROM TAPE 8.            CALC-225
C               LO(52) =.TRUE. REDUCED NUCLEAR MATRIX ELEMENTS OUTPUT.  CALC-226
C               LO(54) =.TRUE. OUTPUT LENGTH USED IN THE WORKING FIELD. CALC-227
C               LO(61) =.TRUE. REDUCED NUCLEAR MATRIX ELEMENTS WRITTEN  CALC-228
C                              ON FILE 61.                              CALC-229
C               LO(75) =.TRUE. NO COMPLETE OUTPUT AT THE FIRST RUN OF A CALC-230
C                              SEARCH.                                  CALC-231
C               LO(76) =.TRUE. LO(51) TO LO(65) ARE ALWAYS USED.        CALC-232
C               LO(77) =.TRUE. OUTPUT OF TIME DIFFERENCES DURING THE    CALC-233
C                              SEARCH.                                  CALC-234
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             CALC-235
C               LO(100)=.TRUE. DIRAC EQUATION.                          CALC-236
C                                                                       CALC-237
C *** MEANING OF LO(I) FOR I GREATER THAN 100 ****                      CALC-238
C LO(101) IS TRUE IF THERE IS A REAL SPIN-ORBIT POTENTIAL.              CALC-239
C LO(102) IS TRUE IF THERE IS A IMAGINARY SPIN-ORBIT POTENTIAL.         CALC-240
C LO(103) IS TRUE IF THERE IS A COULOMB SPIN-ORBIT POTENTIAL.           CALC-241
C LO(104) IS TRUE IF CONVERGENCE IS OBTAINED IN THE ITERATION.          CALC-242
C LO(105) IS TRUE IF CONVERGENCE IS OBTAINED FOR THIS EQUATION.         CALC-243
C LO(106) IS TRUE WHEN THE ITERATION IS NOT THE LAST ONE PERMITTED.     CALC-244
C LO(107) IS TRUE IF ALL THE COUPLINGS HAVE TO BE CALCULATED BEFOREHAND.CALC-245
C LO(108) IS TRUE IF THE DIAGONAL COULOMB CORRECTIONS ARE NEEDED.       CALC-246
C LO(109) IS TRUE FOR DIRAC POTENTIALS.                                 CALC-247
C LO(110) IS TRUE IF DERIVATIVES ARE NEEDED.                            CALC-248
C LO(111) IS TRUE IF NUCLEAR PARAMETERS ARE CHANGED IN SEARCH.          CALC-249
C LO(112) IS TRUE IF SPIN-ORBIT OR COMPOUND NUCLEUS PARAMETERS ARE      CALC-250
C                 CHANGED IN SEARCH.                                    CALC-251
C LO(113) IS TRUE IF DISPERSION RELATION IS CHANGED IN SEARCH.          CALC-252
C LO(114) IS TRUE IF COMPOUND NUCLEUS CONTINUUM IS CHANGED IN SEARCH.   CALC-253
C LO(115) IS TRUE IF IT IS THE FIRST COMPUTATION FOR THIS ENERGY.       CALC-254
C LO(116) IS TRUE FOR NO OUTPUT.                                        CALC-255
C LO(117) IS TRUE FOR ALL THE CALCULATIONS EXCEPT THE FIRST.            CALC-256
C LO(118) IS TRUE FOR LAST RESULTS.                                     CALC-257
C LO(119) IS TRUE FOR RESULTS WITHOUT DOING THE CALCULATION AGAIN.      CALC-258
C LO(120) IS TRUE FOR OUTPUT AND LAST CALCULATION IS THE BEST ONE.      CALC-259
C LO(121) IS TRUE FOR OPTICAL MODEL WITHOUT COUPLING.                   CALC-260
C LO(122) IS TRUE FOR IDENTICAL PARTICLES WITHOUT SPIN.                 CALC-261
C LO(123) IS TRUE FOR IDENTICAL PARTICLES WITH SPIN.                    CALC-262
C LO(124) IS TRUE TO COMPUTE TRANSMISSION COEFFICIENTS.                 CALC-263
C LO(125) IS TRUE IN CAL1 FOR USUAL COUPLED EQUATIONS SUBROUTINES.      CALC-264
C LO(126) IS TRUE IF THERE ARE OBSERVABLES IN THE LABORATORY SYSTEM.    CALC-265
C LO(127) IS TRUE FOR COULOMB CORRECTIONS WITH PURE REGULAR FUNCTIONS.  CALC-266
C LO(128) IS TRUE FOR NO COPY OF UNCOUPLED FUNCTIONS AND PHASE-SHIFT.   CALC-267
C LO(129) IS TRUE FOR REAL SPIN-ORBIT OR DIRAC EQUATION.                CALC-268
C LO(130) IS TRUE FOR IMAGINARY SPIN-ORBIT OR DIRAC EQUATION.           CALC-269
C LO(131) IS TRUE IF THE TOTAL SPIN IS TOO LARGE FOR COMPOUND NUCLEUS.  CALC-270
C LO(132) IS TRUE STORE FISSION AND GAMMA TRANSMISSION COEFFICIENTS FOR CALC-271
C                 INTERPOLATION.                                        CALC-272
C LO(133) IS TRUE TO STORE SCALAR AND COULOMB POTENTIAL INDEPENDENTLY.  CALC-273
C LO(134) AND LO(135) ARE NOT USED.                                     CALC-274
C LO(111) TO LO(120) ARE INITIALISED TO .FALSE. IN CALX.                CALC-275
C LO(116) TO LO(120) ARE INITIALISED TO .FALSE. IN EVAL.                CALC-276
C                                                                       CALC-277
C***********************************************************************CALC-278
      IMPLICIT REAL*8 (A-H,O-Z)                                         CALC-279
      LOGICAL LO(150)                                                   CALC-280
      DIMENSION NW(2,IDMX),DW(IDMX)                                     CALC-281
      CHARACTER*4 FIN,TITLE,CW(2*IDMX)                                  CALC-282
      COMMON /ADDRE/ NIPH,NJIT,NWV,NIPP,NPAR,NPAA,NSCN,NFIS,NGAM,NNIV,NPCALC-283
     1OT,NBETA,NFM,NTGX,NDONN,NNVI,NDE,NISE,NRC,NIW,NNWI,NCC,MCC,NXA,NAMCALC-284
     21,NFAC,NFG,NXG,NRES,NXX,NT,NIVQ,NIVY,NIVZ,NCOI,MIPI,NXD,MWV,NIXT,NCALC-285
     3TY,NSM,NTX,NRY,NRCO,NRDO,NVC1,NVC2,NNC,NCX                        CALC-286
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       CALC-287
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   CALC-288
      COMMON /DCHI2/ CHI2,CHI2M,YY(3)                                   CALC-289
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            CALC-290
      COMMON /INOUT/ MR,MW,MS                                           CALC-291
      COMMON /INTEG/ IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOCALC-292
     1LS,NCOLT,NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,JTCALC-293
     2H,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM(2),CALC-294
     3NCT(6)                                                            CALC-295
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQCALC-296
     1,ACN1,ACN2,AZ(18)                                                 CALC-297
      COMMON /POTE1/ ITX(16),IMAX,INTC,INLS,INVC,INVD,ITXM              CALC-298
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         CALC-299
      COMMON /TITRE/ TITLE(18)                                          CALC-300
      DATA FIN /'FIN '/                                                 CALC-301
      IDMT=IDMX                                                         CALC-302
      CMB=CM/CHB                                                        CALC-303
      CCZ=CHB/CZ                                                        CALC-304
      CK=2.D0*CM/CHB**2                                                 CALC-305
C MAIN INPUT.                                                           CALC-306
    1 CHI2M=1.D35                                                       CALC-307
      CALL CALX(NW,CW,DW,LO)                                            CALC-308
      IF (TITLE(1).EQ.FIN) RETURN                                       CALC-309
      NSP1D=NSP(1)                                                      CALC-310
      IF (LO(36)) GO TO 17                                              CALC-311
    2 NSP(1)=NSP1D                                                      CALC-312
      NSP(3)=NSP(1)-NSP(2)                                              CALC-313
      CALL COLF(NCOLX,NCOLL,NW,DW(NWV),ISM,LMAX1,LMAX2,H,IDMT-NT,NW(1,NNCALC-314
     1IV),LO,DW(NFG),DW(NXG),LMAX3,KXT,NW(1,NT),DW(NT))                 CALC-315
C COMPUTATION OF NUCLEAR MATRIX ELEMENTS AND SPACE FOR FORM FACTORS.    CALC-316
    3 IF (LO(61)) WRITE (61,1000) DW(NWV),DW(NWV+12),DW(NWV+1),NW(2,2),NCALC-317
     1COLL                                                              CALC-318
      CALL REDM(NW,NCOLL,NW(1,NBETA),DW(NBETA),NW(1,NIPH),NW(1,NPAR),DW(CALC-319
     1NPAA),DW(NFAC),IDMT-NT,LO,NW(1,NNIV),NW(1,NT),NW(1,NT),DW(NT),IT,ICALC-320
     2M)                                                                CALC-321
      NIVQ=NT+3*IT                                                      CALC-322
      NIVY=NIVQ+(3*IM+1)/2                                              CALC-323
      NIVZ=NIVY+(7*INTC+1)/2                                            CALC-324
      NCOI=NIVZ+2*INTV                                                  CALC-325
      IF ((.NOT.LO(7)).OR.LO(117)) GO TO 6                              CALC-326
      NPOT=NCOI                                                         CALC-327
      CALL EXTP(NCOLL,NCOLT,DW(NWV),NW(1,NNIV),NW(1,NT),NW(1,NIVY),NW(1,CALC-328
     1NIVQ),NW,DW(NFAC),DW(NPOT),NW(1,NPOT),NW(1,NPOT+2),NW(1,NIPP),DW(NCALC-329
     2IPP),IDMT-NPOT,LO)                                                CALC-330
C PERMUTATION OF POTENTIALS AND INFORMATIONS ON TRANSITIONS.            CALC-331
      N=NPOT-NT                                                         CALC-332
      M=NPOT+NW(2,NPOT+1)                                               CALC-333
      IF (N+M.GT.IDMT) CALL MEMO('CALC',IDMT,N+M)                       CALC-334
      NN=2*N                                                            CALC-335
      N1=2*NT-2                                                         CALC-336
      N2=2*M-2                                                          CALC-337
      DO 4 I=1,NN                                                       CALC-338
    4 CW(N2+I)=CW(N1+I)                                                 CALC-339
      NN=NN+2*NW(2,NPOT+1)                                              CALC-340
      N2=N2-2*NW(2,NPOT+1)                                              CALC-341
      DO 5 I=1,NN                                                       CALC-342
    5 CW(N1+I)=CW(N2+I)                                                 CALC-343
      NPOT=NT                                                           CALC-344
      NT=NPOT+NW(2,NPOT+1)                                              CALC-345
      NIVQ=NT+3*IT                                                      CALC-346
      NIVY=NIVQ+(3*IM+1)/2                                              CALC-347
      NIVZ=NIVY+(7*INTC+1)/2                                            CALC-348
    6 NCOI=NIVZ+2*INTV                                                  CALC-349
      MIPI=NCOI+2*NCONT                                                 CALC-350
      NXD=MIPI                                                          CALC-351
      MWV=NXD                                                           CALC-352
      NIE=0                                                             CALC-353
      NIXT=MWV+22*NIE                                                   CALC-354
    7 CALL DISP(NW,DW(NWV),NW(1,NIPP),DW(NIPP),NW(1,NPOT),DW(NPOT),NCOLXCALC-355
     1-NCONT,LO)                                                        CALC-356
      IF (NCONT.EQ.0) GO TO 10                                          CALC-357
      IF (.NOT.(LO(114).OR.LO(115))) GO TO 9                            CALC-358
      CALL CONU(0,NW,DW(NWV),NW(1,MIPI),DW(MWV),NW(1,NCOI),DW(NXD),DW(NSCALC-359
     1CN),KXT,LO)                                                       CALC-360
      NXD=MIPI+(11*NIE+1)/2                                             CALC-361
      MWV=NXD+3*NIE                                                     CALC-362
      NIXT=MWV+22*NIE                                                   CALC-363
      IF (NIXT.GT.IDMT) CALL MEMO('CALC',IDMT,NIXT)                     CALC-364
      NCOLT=NCOLX+NIE-NCONT                                             CALC-365
      NSP(1)=NSP(1)+NCOLT-NCOLX                                         CALC-366
      NSP(3)=NSP(3)+NCOLT-NCOLX                                         CALC-367
    8 CALL CONU(1,NW,DW(NWV),NW(1,MIPI),DW(MWV),NW(1,NCOI),DW(NXD),DW(NSCALC-368
     1CN),KXT,LO)                                                       CALC-369
    9 CALL DISP(NW(1,MIPI),DW(MWV),NW(1,NIPP),DW(NIPP),NW(1,NPOT),DW(NPOCALC-370
     1T),-NIE,LO)                                                       CALC-371
   10 NDP=2*NCOLL+NSP(1)+1                                              CALC-372
      NDQ=KBA+NSP(3)-NSP(1)                                             CALC-373
      NTY=NIXT+KXT                                                      CALC-374
      NSM=NTY                                                           CALC-375
      IF (LO(81).AND.LO(132)) NSM=NSM+KMAX*(KCC+2+NCOLT-NCOLS)          CALC-376
      NTX=NSM+2*NJMAX*KBA                                               CALC-377
      NRY=NTX+NCOLS+1                                                   CALC-378
      IF (LO(81)) NRY=NTX+NCOLL+NCOLT+3                                 CALC-379
      NRCO=NRY                                                          CALC-380
      IF (LO(81)) NRCO=NRCO+KMAX*NCOLS                                  CALC-381
      NRZ=NRCO-NSM                                                      CALC-382
      NTZ=NRCO-NTY                                                      CALC-383
      IF (LO(32)) NRCO=2*NRCO-NSM                                       CALC-384
      NRDO=NRCO+2*NPX                                                   CALC-385
      IF (LO(100)) NRDO=NRCO+2*NCOLT                                    CALC-386
      NVC1=NRDO+2*INTV                                                  CALC-387
      NVC2=NVC1+ITY(2)*ISM                                              CALC-388
      NNC=NVC1+ITX(1)*ISM                                               CALC-389
      IF (LO(100)) NNC=NVC1+ITX(7)*ISM                                  CALC-390
      NCX=NVC1+ITXM*ISM                                                 CALC-391
      NPLACE=MAX0(NPLACE,NCX,NNC+((NREC+1)*(2*NTOT+2+NREC)/2+1)/2)      CALC-392
   11 CALL GGDR(NW,DW(NWV),DW(NSCN),LO)                                 CALC-393
      IF (LO(113)) GO TO 12                                             CALC-394
      IF (LO(54)) WRITE (MW,1001) NPLACE                                CALC-395
      IF (NPLACE.GT.IDMT) CALL MEMO('CALC',IDMT,NPLACE)                 CALC-396
C MAIN COMPUTATION.                                                     CALC-397
   12 CALL CAL1(NW,CW,DW,LO)                                            CALC-398
      IF (LO(77)) CALL HORA                                             CALC-399
      IF (LO(118).OR.(.NOT.LO(32))) GO TO 18                            CALC-400
C AUTOMATIC SEARCH.                                                     CALC-401
      IF (NW(1,NIW+1).GT.1.OR.LO(76).OR.LO(75)) GO TO 14                CALC-402
C CHANGE OF CONTROLS IF FULL OUTPUT WAS NOT REQUESTED AT THE FIRST RUN. CALC-403
      DO 13 I=51,58                                                     CALC-404
      LO(I+85)=LO(I)                                                    CALC-405
   13 LO(I)=.FALSE.                                                     CALC-406
      LO(116)=.TRUE.                                                    CALC-407
C IDENTIFICATION OF VARIABLES.                                          CALC-408
   14 CALL VARI(1,NW,DW,LO)                                             CALC-409
C SAVE THE SEARCH ON TAPE MS.                                           CALC-410
      IF (LO(35).AND.NW(1,NIW+1).GE.NW(2,NIW)) CALL REST(0,NW,DW,IDMT,LOCALC-411
     1)                                                                 CALC-412
C HANDLING OF VARIABLES.                                                CALC-413
   15 CALL FITE(KE,NTOT,NREC,DW(NRES),DW(NXX),DW(NDE),DW(NRC),NW(1,NRC),CALC-414
     1NW(1,NIW),DW(NNC))                                                CALC-415
C TRANSFORMATION OF VARIABLES INTO PARAMETERS.                          CALC-416
   16 CALL VARI(0,NW,DW,LO)                                             CALC-417
      IF (KE.EQ.1) GO TO 19                                             CALC-418
      LO(111)=LO(52).OR.LO(61).OR.LO(111)                               CALC-419
      LO(112)=LO(112).OR.LO(10)                                         CALC-420
      GO TO 19                                                          CALC-421
C CONTINUATION OF A PREVIOUS SEARCH.                                    CALC-422
   17 CALL REST(1,NW,DW,IDMT,LO)                                        CALC-423
      IF (LO(77)) CALL HORA                                             CALC-424
      IF ((KE.NE.1).AND.(NW(1,NIW+1).NE.1)) GO TO 16                    CALC-425
      GO TO 15                                                          CALC-426
   18 N=IDMT-NPLACE                                                     CALC-427
      WRITE (MW,1002) NPLACE,N                                          CALC-428
      IF (LO(35).AND.LO(32).AND.(KE.EQ.0)) CALL REST(0,NW,DW,IDMT,LO)   CALC-429
      IF (.NOT.LO(34)) GO TO 1                                          CALC-430
      CALL EVAL(NW,DW,CM,LO)                                            CALC-431
      KE=0                                                              CALC-432
      IF (LO(115)) GO TO 2                                              CALC-433
   19 IF (LO(111)) GO TO 3                                              CALC-434
      IF (LO(113)) GO TO 7                                              CALC-435
      IF (LO(114)) GO TO 8                                              CALC-436
      IF (LO(112)) GO TO 11                                             CALC-437
      GO TO 12                                                          CALC-438
 1000 FORMAT ('<RED.MAT.>',F10.2,1P,D20.8,0P,F10.2,2I5)                 CALC-439
 1001 FORMAT (10X,'REQUIRED WORKING FIELD',I10)                         CALC-440
 1002 FORMAT (//' *** WORKSPACE USED IN THIS COMPUTATION',I10,'  ***',  CALC-441
     110X,I10,' MEMORIES NOT USED.')                                    CALC-442
      END                                                               CALC-443
C 07/03/07                                                      ECIS06  CALX-000
      SUBROUTINE CALX(NW,CW,DW,LO)                                      CALX-001
C CALX AND THE SUBROUTINES CALLED BY IT READ ALL THE INPUT EXCEPT FOR   CALX-002
C REDUCED NUCLEAR MATRIX ELEMENTS AND EXTERNAL FORM FACTORS.            CALX-003
C INPUT:     NW:      WORKING AREA FOR INTEGERS.                        CALX-004
C            CW:      WORKING AREA FOR CHARACTERS.                      CALX-005
C            DW:      WORKING AREA FOR DOUBLE PRECISION.                CALX-006
C                     NW,CW,DW ARE IN EQUIVALENCE BY CALL.              CALX-007
C            LO(I):   LOGICAL CONTROLS:                                 CALX-008
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).CALX-009
C               LO(2)  =.TRUE. SECOND ORDER VIBRATIONAL OR CONSTRAINED  CALX-010
C                              ASYMMETRIC ROTATIONAL MODEL.             CALX-011
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     CALX-012
C                              ROTATIONAL MODEL.                        CALX-013
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    CALX-014
C               LO(10) =.TRUE. DISPERSION RELATIONS FOR POTENTIALS.     CALX-015
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              CALX-016
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            CALX-017
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. CALX-018
C               LO(18) =.TRUE. PROJECTILE-TARGET ANTISYMMETRISATION.    CALX-019
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   CALX-020
C               LO(20) =.TRUE. DISPERSION RELATIONS FOR TRANSITION      CALX-021
C                              FORM-FACTORS.                            CALX-022
C               LO(21) =.TRUE. USUAL COUPLED EQUATIONS.                 CALX-023
C               LO(22) =.TRUE. NO USE OF PADE APPROXIMANTS.             CALX-024
C               LO(28) =.TRUE. COMPUTATION UP TO J-CONVERGENCE-(F: STOP CALX-025
C                              WHEN ALL COUPLING TERMS NEGLIGIBLE).     CALX-026
C               LO(29) =.TRUE. NO DIAGONAL TERMS IN SECOND MEMBER.      CALX-027
C               LO(30) =.TRUE. PURE DWBA CALCULATION.                   CALX-028
C               LO(31) =.TRUE. INPUT OF EXPERIMENTAL DATA AND CHI2      CALX-029
C                              CALCULATION.                             CALX-030
C               LO(131)=.TRUE. TOTAL SPIN IS TOO LARGE FOR COMPOUND     CALX-031
C                              NUCLEUS.                                 CALX-032
C               LO(36) =.TRUE. RESTART A SEARCH FROM TAPE 8.            CALX-033
C               LO(32) =.TRUE. AUTOMATIC SEARCH ON SOME PARAMETERS.     CALX-034
C               LO(41) =.TRUE. FACTORISATION OF 1/(1-COS(THETA)).       CALX-035
C               LO(42) =.TRUE. SCHMIDT'S ORTHOGONALISATION OF SOLUTIONS CALX-036
C                              IN USUAL COUPLED EQUATIONS.              CALX-037
C               LO(43) =.TRUE. INTERPOLATION ON TOTAL SPIN.             CALX-038
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     CALX-039
C               LO(45) =.TRUE. LIMITATION ON THE ANGULAR MOMENTA FOR    CALX-040
C                              COULOMB CORRECTIONS.                     CALX-041
C               LO(63) =.TRUE. PENETRABILITIES WRITTEN ON FILE 63.      CALX-042
C               LO(65) =.TRUE. PRINT COEFFICIENTS OF THE EXPANSION IN   CALX-043
C                              LEGENDRE POLYNOMIALS ON FILE 65.         CALX-044
C               LO(66) =.TRUE. NO CALCULATION AT EQUIDISTANT ANGLES.    CALX-045
C               LO(71) =.TRUE. NO DETAILED OUTPUT OF LOGICAL CONTROLS.  CALX-046
C               LO(74) =.TRUE. OUTPUT OF TIME IN DIFFERENT STEPS.       CALX-047
C               LO(75) =.TRUE. NO COMPLETE OUTPUT AT THE FIRST RUN OF A CALX-048
C                              SEARCH.                                  CALX-049
C               LO(76) =.TRUE. LO(51) TO LO(65) ARE ALWAYS USED.        CALX-050
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             CALX-051
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         CALX-052
C               LO(84) =.TRUE. UNCOUPLED LEVELS FOR COMPOUND NUCLEUS.   CALX-053
C               LO(85) =.TRUE. FISSION TRANSMISSION COEFFICIENTS.       CALX-054
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      CALX-055
C               LO(99) =.TRUE. SCHROEDINGER EQUIVALENT TO DIRAC         CALX-056
C                              EQUATION.                                CALX-057
C               LO(100)=.TRUE. DIRAC EQUATION.                          CALX-058
C               LO(108)=.TRUE. DIAGONAL COULOMB CORRECTIONS ARE NEEDED. CALX-059
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    CALX-060
C               LO(115)=.TRUE. FIRST COMPUTATION FOR THIS ENERGY.       CALX-061
C               LO(116)=.TRUE. NO OUTPUT.                               CALX-062
C               LO(123)=.TRUE. IDENTICAL PARTICLES WITH SPIN.           CALX-063
C               LO(124)=.TRUE. COMPUTE TRANSMISSION COEFFICIENTS.       CALX-064
C               LO(128)=.TRUE. NO COPY OF UNCOUPLED FUNCTIONS AND       CALX-065
C                              PHASE-SHIFTS.                            CALX-066
C                                                                       CALX-067
C USE OF SOME PARTS OF THE WORKING AREA (W,NW,DW):                      CALX-068
C  1:   IPI(11,NCOLX) INTEGER VALUES FOR THE DESCRIPTION OF CHANNELS.   CALX-069
C           FIRST INDEX:                                                CALX-070
C       1 - PARITY (0 FOR + AND 1 FOR -).                               CALX-071
C       2 - MULTIPLICITY OF INCIDENT PARTICLE.                          CALX-072
C       3 - MULTIPLICITY OF THE TARGET.                                 CALX-073
C       4 - PRODUCT OF CHARGES.                                         CALX-074
C       5 - INDEX OF POTENTIAL.                                         CALX-075
C       6,7,8,9 - BEGINNING AND END IN THE TWO PARTS OF TABLE MF-FM     CALX-076
C                           (SEE DEPH).                                 CALX-077
C      10 - MAXIMUM ANGULAR MOMENTUM.                                   CALX-078
C      11 - INDEX OF POTENTIAL ENERGY DEPENDENT BY DISPERSION RELATIONS.CALX-079
C  NIPP:    IPP(2,18,NPP)/PIP(18,NPP) DISPERSION PARAMETERS.            CALX-080
C     1,1 - FIRST LEVEL USING THIS POTENTIAL BEFORE INPUT OF PARAMETERS.CALX-081
C           REPLACED BY INDICATION TO USE LABORATORY ENERGY (1), CENTRE CALX-082
C           OF MASS ENERGY (-1) OR READ COEFFICIENTS (0).               CALX-083
C     2,1 - N2 - POWER FOR LARGE NEGATIVE ENERGY CORRECTIONS.           CALX-084
C     1,2 - NV - |NV| POWER FOR VOLUME POTENTIAL.                       CALX-085
C     2,2 - NS - |NS| POWER FOR SURFACE POTENTIAL.                      CALX-086
C             SUM OF TWO TERMS IF NV OR NS ARE NEGATIVE,                CALX-087
C             ABSENCE OF VOLUME OR SURFACE TERM IF NV OR NS ARE 0.      CALX-088
C     1,3 - NL - |NL| POWER FOR SPIN-ORBIT POTENTIAL.                   CALX-089
C       4 - ENERGY CORRESPONDING TO THE DEPTHS READ.                    CALX-090
C       5 - FERMI ENERGY EF.                                            CALX-091
C       6 - THRESHOLD ENERGY EP.                                        CALX-092
C       7 - LARGE ENERGY STARTING VALUE ABOVE FERMI ENERGY EA.          CALX-093
C       8 - EXPONENTIAL VARIATION OF REAL SPIN-ORBIT.                   CALX-094
C       9 - LINEAR VARIATION OF IMAGINARY SPIN-ORBIT.                   CALX-095
C      10 - BV PARAMETER FOR VOLUME POTENTIALS.                         CALX-096
C      11 - STRENGTH OF LARGE POSITIVE ENERGY TERM IN VOLUME POTENTIAL, CALX-097
C           SECOND BV' PARAMETER FOR VOLUME POTENTIALS IF NV<0.         CALX-098
C      12 - EXPONENTIAL DECREASE IN SQRT|E| FOR LARGE ENERGY TERMS OF   CALX-099
C           VOLUME POTENTIALS OR FRACTION IN THE FIRST TERM IF NV<0.    CALX-100
C      13 - BS PARAMETER FOR SURFACE POTENTIALS.                        CALX-101
C      14 - EXPONENTIAL DECREASE OF A SURFACE POTENTIAL OR SECOND BS'   CALX-102
C           PARAMETER FOR SURFACE POTENTIALS IF NS<0.                   CALX-103
C      15 - NON-LOCALITY RANGE PARAMETER OF SURFACE POTENTIAL OR        CALX-104
C           FRACTION IN THE FIRST TERM IF NS<0.                         CALX-105
C      16 - BL PARAMETER FOR SPIN-ORBIT POTENTIALS.                     CALX-106
C      17 - EXPONENTIAL VARIATION OF H.F. REAL VOLUME POTENTIAL.        CALX-107
C  NWV:     WV(20,NCOLX) IBM-DOUBLE PRECISION VALUES FOR THE CHANNELS.  CALX-108
C       1 - MASS OF THE PARTICLE.                                       CALX-109
C       2 - MASS OF THE TARGET.                                         CALX-110
C       3 - ENERGY IN THE CENTRE OF MASS IN MEV.                        CALX-111
C       4 - K WAVE NUMBER.                                              CALX-112
C       5 - COULOMB PARAMETER.                                          CALX-113
C       6 - REDUCED MASS.                                               CALX-114
C       7 - REDUCED ENERGY.                                             CALX-115
C       8 - STEP SIZE FOR THIS LEVEL.                                   CALX-116
C       9 - SQUARE ROOT OF COEFFICIENT OF SCALAR POTENTIALS.            CALX-117
C      10 - SQUARE ROOT OF COEFFICIENT OF COULOMB POTENTIALS.           CALX-118
C      11 - K WAVE NUMBER MULTIPLIED BY RATIO OF STEP SIZES.            CALX-119
C      12 - REDUCED ENERGY TERM.                                        CALX-120
C      13 - ENERGY IN THE LABORATORY SYSTEM IN MEV.                     CALX-121
C      14,15,16,17,18,19,20 - DISPERSION CORRECTIONS (SEE DISP).        CALX-122
C                                                                       CALX-123
C THE COMMON /CONVE/ IS USED IN CALC, CALX, LECT, CAL1, STDP, FOLD,     CALX-124
C                               INTI, INSH, INSI, INRH, INRI AND REST.  CALX-125
C THE COMMON /DCHI2/ IS USED IN CALC, CALX, RESU, VARI, EVAL, REST      CALX-126
C                               AND FITE.                               CALX-127
C THE COMMON /NCOMP/ IS USED IN CALC, CALX, LECT, CONU, GGDR, CAL1,     CALX-128
C                               QUAN, SCAM, SCHE, RESU, VARI, EVAL,     CALX-129
C                               AND REST.                               CALX-130
C                                                                       CALX-131
C FOR THE COMMON  /ANGUL/ SEE LECT.                                     CALX-132
C FOR THE COMMON  /ADDRE/, /COUPL/, /INTEG/ AND /TITRE/ SEE CALC.       CALX-133
C                                                                       CALX-134
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ADDRE/:                     CALX-135
C  NIPH:      NUMBER OF PHONONS FOR THE HARMONIC VIBRATIONAL MODEL.     CALX-136
C  NJIT:      DATA FOR INTERPOLATION ON TOTAL SPIN.                     CALX-137
C  NWV:       NON INTEGER VALUES FOR THE CHANNELS.                      CALX-138
C  NIPP:      DISPERSION PARAMETERS.                                    CALX-139
C  NPAR:      INDICATIONS FOR NUCLEAR PARAMETERS.                       CALX-140
C  NPAA:      VALUES OF NUCLEAR PARAMETERS.                             CALX-141
C  NSCN:      LEVEL DENSITY DESCRIPTION.                                CALX-142
C  NFIS:      FISSION DATA FOR COMPOUND NUCLEUS.                        CALX-143
C  NGAM:      GAMMA DATA FOR COMPOUND NUCLEUS.                          CALX-144
C  NNIV:      ADDRESSES OF REDUCED NUCLEAR MATRIX ELEMENTS AND COULOMB  CALX-145
C             INTEGRALS IN NIV(NCOLL,NCOLL,3).                          CALX-146
C  NPOT:      OPTICAL POTENTIAL PARAMETERS.                             CALX-147
C  NBETA:     DEFORMATION PARAMETERS.                                   CALX-148
C  NFM:       HELICITIES AND OBSERVABLES (SEE DEPH,LECD AND OBSE).      CALX-149
C  NTGX:      BEGINNING OF CHI2 AND NORMALISATION OF DATA.              CALX-150
C  NDONN:     EXPERIMENTAL DATA.                                        CALX-151
C  NNVI:      TABLE OF ADDRESSES OF COUPLING COEFFICIENTS.              CALX-152
C  NDE:       SEARCH ACCURACIES.                                        CALX-153
C  NISE:      INDEXES OF THE VARIABLE PARAMETERS IN SEARCH.             CALX-154
C  NRC:       PERMANENT WORKING FIELD FOR THE SEARCH.                   CALX-155
C  NIW:       INTEGER WORKING FIELD FOR THE SEARCH.                     CALX-156
C  NNWI:      SAME AS NNVI FOR SYMMETRISED EQUATIONS.                   CALX-157
C  NCC:       TABLE OF ENERGIES, L*(L+1) AND L*S  (SEE QUAN).           CALX-158
C  MCC:       SAME AS NCC FOR SYMMETRISED EQUATIONS.                    CALX-159
C  NXA:       TABLE OF COEFFICIENTS OF SYMMETRISATION.                  CALX-160
C  NAM1:      COMPUTATION OF OBSERVABLES (SEE OBSE).                    CALX-161
C  NFAC:      TABLE OF LOG OF FACTORIALS FOR GEOMETRIC COEFFICIENTS.    CALX-162
C  NFG:       COULOMB FUNCTIONS AND FINITE INTEGRALS.                   CALX-163
C  NXG:       COULOMB PHASES AND INFINITE INTEGRALS.                    CALX-164
C  NRES:      FUNCTIONS FOR THE SEARCH.                                 CALX-165
C  NXX:       VARIABLES FOR THE SEARCH.                                 CALX-166
C  NT:        TABLE OF REDUCED NUCLEAR MATRIX ELEMENTS.                 CALX-167
C   DEFINED:  NIPH,NJIT,NWV,NIPP,NPAR,NPAA,NSCN,NFIS,NGAM,NNIV,NPOT,    CALX-168
C             NBETA,NFM,NTGX,NDONN,NNVI,NDE,NISE,NRC,NIW,NNWI,NCC,MCC,  CALX-169
C             NXA,NAM1,NFAC,NFG,NXG,NRES,NXX,NT.                        CALX-170
C   USED:     NIPH,NJIT,NWV,NIPP,NPAR,NPAA,NSCN,NFIS,NGAM,NNIV,NPOT,    CALX-171
C             NBETA,NFM,NTGX,NDONN,NNVI,NDE,NISE,NRC,NIW,NNWI,NCC,MCC,  CALX-172
C             NXA,NAM1,NFAC,NFG,NXG,NRES,NXX,NT.                        CALX-173
C                                                                       CALX-174
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ANGUL/:                     CALX-175
C  THETA1:    FIRST ANGLE FOR COMPUTATION AT EQUIDISTANT ANGLES.        CALX-176
C  DTHETA:    STEP FOR COMPUTATION AT EQUIDISTANT ANGLES.               CALX-177
C  THETA2:    LAST ANGLE FOR COMPUTATION AT EQUIDISTANT ANGLES.         CALX-178
C  NCJ:       NUMBER OF FACTORISATIONS OF 1/(1-COS(THETA)) IN AMPLITUDE.CALX-179
C  NL(1):     POWER OF (1-COS(THETA)) FOR THE EXPANSION IN LEGENDRE     CALX-180
C             POLYNOMIALS OF THE INTERFERENCE BETWEEN COULOMB AND       CALX-181
C             NUCLEAR ELASTIC SCATTERING. POWER OF (1-COS(THETA)**2)    CALX-182
C             IF LO(18) IS .TRUE..                                      CALX-183
C  NL(2):     NUMBER OF LEGENDRE POLYNOMIALS FOR ELASTIC SCATTERING OF  CALX-184
C             CHARGED PARTICLES.                                        CALX-185
C  NL(3):     NUMBER OF LEGENDRE POLYNOMIALS FOR ELASTIC SCATTERING OF  CALX-186
C             UNCHARGED PARTICLES, INELASTIC SCATTERING AND COMPOUND    CALX-187
C             NUCLEUS.                                                  CALX-188
C   DEFINED:  NCJ,NL.                                                   CALX-189
C   USED:     THETA1,DTHETA,THETA2,NCJ,NL.                              CALX-190
C                                                                       CALX-191
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     CALX-192
C  H:         STEP SIZE FOR INTEGRATION.                                CALX-193
C  BJM:       CONVERGENCE COEFFICIENT OF IMAGINARY POTENTIAL.           CALX-194
C  EITER:     CONVERGENCE CRITERION FOR S-MATRIX.                       CALX-195
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         CALX-196
C  CONJ:      CONVERGENCE CRITERION FOR THE SCATTERING AMPLITUDES.      CALX-197
C  HCONV:     ACONV*H*H CONVERGENCE CRITERION FOR SECOND MEMBERS.       CALX-198
C   DEFINED:  H,BJM,EITER,ACONV,CONJ,HCONV.                             CALX-199
C   USED:     BJM,EITER,ACONV,CONJ.                                     CALX-200
C                                                                       CALX-201
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     CALX-202
C  IQM:       MAXIMUM L-VALUE OF DEFORMATION IN ROTATIONAL MODEL.       CALX-203
C  IQMAX:     MAXIMUM L-EXPANSION IN ROTATIONAL MODEL.                  CALX-204
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           CALX-205
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       CALX-206
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             CALX-207
C  NSPIN:     TWICE THE K-VALUE OF THE ROTATIONAL BAND.                 CALX-208
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             CALX-209
C   DEFINED:  IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA.                         CALX-210
C   USED:     NFA,NPP,NVA.                                              CALX-211
C                                                                       CALX-212
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCHI2/:                     CALX-213
C  CHI2:      CHI-SQUARE COMPUTED IN SUBROUTINE RESU.                   CALX-214
C  CHI2M:     MINIMUM CHI-SQUARE IN THE SEARCH.                         CALX-215
C  YY(1):     STEP SIZE IN THE SEARCH.                                  CALX-216
C  YY(2):     HALF OF THE SUCCESS MULTIPLICATIVE FACTOR OF THE STEP.    CALX-217
C  YY(3):     VARIOUS MEANINGS.  SEE FITE.                              CALX-218
C   DEFINED:  YY.                                                       CALX-219
C   NOT USED: CHI2,CHI2M.                                               CALX-220
C                                                                       CALX-221
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INTEG/:                     CALX-222
C  IDMT:      TOTAL WORKING FIELD LENGTH AS SINGLE PRECISION.           CALX-223
C  NPLACE:    MAXIMUM WORKING FIELD USED.                               CALX-224
C  NCOLL:     NUMBER OF COUPLED CHANNELS.                               CALX-225
C  NJMAX:     MAXIMUM NUMBER OF J-VALUES.                               CALX-226
C  ITERM:     MAXIMUM NUMBER OF ITERATIONS.                             CALX-227
C  JDM:       MINIMUM NUMBER OF TOTAL SPIN.                             CALX-228
C  JIT:       NUMBER OF RATES OF INTERPOLATION ON TOTAL SPIN.           CALX-229
C  KMIN:      MINIMUM NUMBER OF J VALUES FOR COMPOUND NUCLEUS.          CALX-230
C  KMAX:      MAXIMUM NUMBER OF J VALUES FOR COMPOUND NUCLEUS.          CALX-231
C  NCOLS:     NUMBER OF CHANNELS WITH ANGULAR DISTRIBUTIONS.            CALX-232
C  NCOLT:     NUMBER OF CHANNELS INCLUDING UNCOUPLED STATES.            CALX-233
C  NBET:      NUMBER OF DIFFERENT DEFORMATIONS (VIBRATIONS+ROTATIONS).  CALX-234
C  LMX:       DIFFERENCE BETWEEN NUMBER OF J AND OF COULOMB FUNCTIONS.  CALX-235
C  LMAX1:     NUMBER OF L-VALUES FOR COULOMB FUNCTIONS.                 CALX-236
C  NLT:       MEMORIES NEEDED FOR LEGENDRE POLYNOMIALS.                 CALX-237
C  ISM:       NUMBER OF INTEGRATION STEPS.                              CALX-238
C  NJC:       MAXIMUM NUMBER OF OBSERVABLES AT EQUIDISTANT ANGLES.      CALX-239
C  JTX:       MAXIMUM NUMBER OF CALCULATED VALUES FOR A PLOT.           CALX-240
C  KCC:       NUMBER OF INDEPENDENT AMPLITUDES WITH UNCOUPLED STATES.   CALX-241
C  MS1:       LARGEST PARTICLE MULTIPLICITY.                            CALX-242
C  MS2:       LARGEST TARGET MULTIPLICITY.                              CALX-243
C  KBA:       NUMBER OF INDEPENDENT AMPLITUDES WITHOUT UNCOUPLED STATES.CALX-244
C  KAB:       MAXIMUM NUMBER OF EQUATIONS.                              CALX-245
C  KBC:       MAXIMUM NUMBER OF SOLUTIONS.                              CALX-246
C  JTH:       MAXIMUM NUMBER OF ANGLES FOR A PLOT.                      CALX-247
C  NCOLR:     NUMBER OF EXPERIMENTAL ANGULAR DISTRIBUTIONS.             CALX-248
C  NREC:      NUMBER OF VARIABLES IN SEARCH.                            CALX-249
C  NTOT:      NUMBER OF EXPERIMENTAL DATA.                              CALX-250
C  LMAX2:     NUMBER OF L VALUES FOR COULOMB PHASES.                    CALX-251
C  KE:        CONTROL OF SEARCH (SEE FITE).                             CALX-252
C  ITEMM:     MAXIMUM NUMBER OF ITERATIONS AT THE BEGINNING OF A RUN.   CALX-253
C  MCM(1):    MAXIMUM ANGULAR MOMENTUM FOR CENTRAL COULOMB CORRECTIONS. CALX-254
C  MCM(2):    MAXIMUM ANGULAR MOMENTUM FOR SPIN-ORBIT COULOMB CORRECT.  CALX-255
C  NCT(1):    NUMBER OF EQUATIONS FOR POSITIVE PARITY.                  CALX-256
C  NCT(2):    NUMBER OF EQUATIONS FOR NEGATIVE PARITY.                  CALX-257
C  NCT(3):    NUMBER OF SOLUTIONS FOR POSITIVE PARITY.                  CALX-258
C  NCT(4):    NUMBER OF SOLUTIONS FOR NEGATIVE PARITY.                  CALX-259
C  NCT(5):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, POSITIVE PARITY. CALX-260
C  NCT(6):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, NEGATIVE PARITY. CALX-261
C   DEFINED:  NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOLS,NCOLT,   CALX-262
C             NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,   CALX-263
C             JTH,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,MCM,NCT.               CALX-264
C   USED:     IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMAX,NCOLS,NCOLT,   CALX-265
C             NBET,LMX,LMAX1,JTX,KCC,KAB,KBC,JTH,NCOLR,NREC,NTOT,LMAX2. CALX-266
C                                                                       CALX-267
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     CALX-268
C  NSP(1):    NUMBER OF UNCOUPLED LEVELS FOR COMPOUND NUCLEUS           CALX-269
C             INCLUDING DISCRETISATION OF CONTINUUM.                    CALX-270
C  NSP(2):    NUMBER OF THESE LEVELS WITH ANGULAR DISTRIBUTION.         CALX-271
C  NSP(3):    NUMBER OF THESE LEVELS WITHOUT ANGULAR DISTRIBUTION.      CALX-272
C  NFISS:     NUMBER OF FISSION TRANSMISSION COEFFICIENTS.              CALX-273
C  NRD:       NUMBER OF GAMMA TRANSMISSION COEFFICIENTS.                CALX-274
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 CALX-275
C  NCOJ:      NUMBER OF SPINS OF THE TARGET FOR A CONTINUUM.            CALX-276
C  NCONS:     NUMBER OF LEVEL DENSITIES NEEDED.                         CALX-277
C  NIE:       NUMBER OF UNCOUPLED STATES ADDED FOR DISCRETISATION.      CALX-278
C  NCOLX:     TOTAL NUMBER OF LEVELS WITHOUT DISCRETISATION.            CALX-279
C  NDP:       ADDRESS OF FISSION AND GAMMA FINAL RESULTS.               CALX-280
C  NDQ:       ADDRESS OF FISSION AND GAMMA INTERMEDIATE RESULTS.        CALX-281
C  ACN1:      RATIO SIZE/STEP FOR DISCRETISATION OF A CONTINUUM.        CALX-282
C  ACN2:      MAXIMUM NUMBER OF STEPS BY MEV FOR A CONTINUUM.           CALX-283
C  AZ(6):     DEFORMED SPIN-ORBIT PARAMETERS. SEE ALSO COMMENT IN       CALX-284
C             INPUT DESCRIPTION AND SUBROUTINE QUAN.                    CALX-285
C  BZ(5):     HAUSER-FESHBACH AND MOLDAUER'S PARAMETERS DESCRIBED BELOW.CALX-286
C   BZ(1):    SQUARE ROOT OF ELASTIC ENHANCEMENT.                       CALX-287
C   BZ(2):    IF LO(82)=.TRUE., SPIN CUT-OFF PARAMETER.                 CALX-288
C             IF LO(82)=.FALSE., PARTICLE DEGREES OF FREEDOM.           CALX-289
C   BZ(3):    SQUARE ROOT OF LEVEL DENSITY PARAMETER. IF LO(82)=LO(87)= CALX-290
C             .FALSE., PARAMETER BZ(3) IN MOLDAUER'S FORMULA OF INPUT   CALX-291
C             DESCRIPTION.                                              CALX-292
C   BZ(4):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(4) IN SAME FORMULA.CALX-293
C   BZ(5):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(5) IN SAME FORMULA.CALX-294
C  TG0:       SLOW S-WAVE NEUTRON GAMMA WIDTH/SPACING FOR NORMALISATION.CALX-295
C  BN:        NEUTRON SEPARATION ENERGY.                                CALX-296
C  FNUG:      RADIATIVE DEGREES OF FREEDOM.                             CALX-297
C  EGD:       ENERGY OF THE GIANT DIPOLE RESONANCE.                     CALX-298
C  GGD:       RESONANCE WIDTH.                                          CALX-299
C  TG1:       DERIVED DATA FOR GAMMA IN COMPOUND NUCLEUS.               CALX-300
C  SGSQ:      DERIVED DATA FOR GAMMA IN COMPOUND NUCLEUS.               CALX-301
C   DEFINED:  NSP,NFISS,NRD,NCONT,NCOJ,NCONS,NCOLX,ACN1,ACN2.           CALX-302
C   USED:     NSP,NFISS,NRD,NCONT,NCOJ,NCONS,NCOLX,ACN1,ACN2.           CALX-303
C   NOT USED: NIE,NDP,NDQ,AZ,BZ,TG0,BN,FNUG,EGD,TGD,TG1,SGSQ.           CALX-304
C             AZ(6),BZ(5) AND FOLLOWING ARE SOMETIMES GROUPED IN AZ(18);CALX-305
C             THIS IS NECESSARY FOR AUTOMATIC SEARCH.                   CALX-306
C                                                                       CALX-307
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /TITRE/:                     CALX-308
C  TITLE(18): TITLE OF THE RUN PRINTED AS HEADING OF RESULTS.           CALX-309
C   DEFINED:  TITLE.                                                    CALX-310
C   USED:     TITLE.                                                    CALX-311
C                                                                       CALX-312
C***********************************************************************CALX-313
      IMPLICIT REAL*8 (A-H,O-Z)                                         CALX-314
      LOGICAL LO(150)                                                   CALX-315
      DIMENSION NW(2,*),NGR(2),NPR(2),DESC(3),DW(*)                     CALX-316
      CHARACTER*4 FIN,DESC,TITLE,CW(2,1)                                CALX-317
      COMMON /ADDRE/ NIPH,NJIT,NWV,NIPP,NPAR,NPAA,NSCN,NFIS,NGAM,NNIV,NPCALX-318
     1OT,NBETA,NFM,NTGX,NDONN,NNVI,NDE,NISE,NRC,NIW,NNWI,NCC,MCC,NXA,NAMCALX-319
     21,NFAC,NFG,NXG,NRES,NXX,NT,NIVQ,NIVY,NIVZ,NCOI,MIPI,NXD,MWV,NIXT,NCALX-320
     3TY,NSM,NTX,NRY,NRCO,NRDO,NVC1,NVC2,NNC,NCX                        CALX-321
      COMMON /ANGUL/ THETA1,THETA2,DTHETA,DTHE,NCJ,NL(3),JMM(2)         CALX-322
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       CALX-323
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   CALX-324
      COMMON /DCHI2/ CHI2,CHI2M,YY(3)                                   CALX-325
      COMMON /INOUT/ MR,MW,MS                                           CALX-326
      COMMON /INTEG/ IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOCALX-327
     1LS,NCOLT,NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,JTCALX-328
     2H,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM(2),CALX-329
     3NCT(6)                                                            CALX-330
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQCALX-331
     1,ACN1,ACN2,AZ(6),BZ(5),TG0,BN,FNUG,EGD,GGD,TG1,SGSQ               CALX-332
      COMMON /TITRE/ TITLE(18)                                          CALX-333
      DATA FIN,DESC /'FIN ','DESC','RIPT','ION '/                       CALX-334
    1 READ (MR,1000) TITLE                                              CALX-335
      DO 2 J=1,3                                                        CALX-336
      IF (TITLE(J).NE.DESC(J)) GO TO 3                                  CALX-337
    2 CONTINUE                                                          CALX-338
      CALL INPA                                                         CALX-339
      CALL INPB                                                         CALX-340
      CALL INPC                                                         CALX-341
      GO TO 1                                                           CALX-342
    3 IF (TITLE(1).EQ.FIN) RETURN                                       CALX-343
      DO 4 I=1,100                                                      CALX-344
    4 LO(I)=.FALSE.                                                     CALX-345
      READ (MR,1001) (LO(I),I=1,50)                                     CALX-346
C IF LO(36)=.TRUE. RETURN TO RESTART A SEARCH SAVED ON TAPE 8.          CALX-347
      IF (LO(36)) RETURN                                                CALX-348
      READ (MR,1001) (LO(I),I=51,100)                                   CALX-349
      READ (MR,1002) NCOLL,NJMAX,ITERM,NPP,NCJ,NGR,NPR,LMZ,JDM,LML,JIT,MCALX-350
     1N                                                                 CALX-351
C ELIMINATION OF CONTRADICTIONS BETWEEN LOGICAL CONTROLS.               CALX-352
      IF (NCOLL.LE.1) LO(28)=.TRUE.                                     CALX-353
      IF (.NOT.LO(31)) LO(32)=.FALSE.                                   CALX-354
      IF (LO(14)) LO(13)=.TRUE.                                         CALX-355
      IF (LO(19)) LO(11)=.TRUE.                                         CALX-356
      IF (LO(30)) ITERM=1                                               CALX-357
      IF (LO(18)) LO(29)=.TRUE.                                         CALX-358
      IF (LO(100)) LO(29)=.FALSE.                                       CALX-359
      IF (LO(100).AND.LO(95)) LO(94)=.FALSE.                            CALX-360
      LO(109)=LO(99).OR.LO(100)                                         CALX-361
      IF (LO(109)) LO(8)=.TRUE.                                         CALX-362
      IF (LO(82)) LO(84)=.FALSE.                                        CALX-363
      IF (LO(82)) LO(85)=.FALSE.                                        CALX-364
      IF (LO(82)) LO(86)=.FALSE.                                        CALX-365
      IF (LO(82).OR.LO(84).OR.LO(85).OR.LO(86)) LO(81)=.TRUE.           CALX-366
      LO(44)=LO(44).AND.LO(11)                                          CALX-367
      IF (.NOT.LO(99)) GO TO 5                                          CALX-368
      LO(11)=.FALSE.                                                    CALX-369
      LO(19)=.FALSE.                                                    CALX-370
      IF (LO(1)) LO(3)=.FALSE.                                          CALX-371
      IF (.NOT.LO(1)) LO(2)=.FALSE.                                     CALX-372
      IF ((.NOT.LO(10)).OR.(.NOT.LO(12))) LO(20)=.FALSE.                CALX-373
    5 LO(124)=LO(81).OR.LO(63)                                          CALX-374
      WRITE (MW,1003) IDMT                                              CALX-375
C OUTPUT OF LOGICAL CONTROLS.                                           CALX-376
      IF (LO(71)) GO TO 6                                               CALX-377
      WRITE (MW,1004) (LO(I),LO(I+53),I=1,3),(LO(I+53),LO(I),I=4,5),LO(6CALX-378
     1),LO(59),(LO(I),I=7,8),(LO(I),LO(51+I),I=9,10)                    CALX-379
      WRITE (MW,1005) (LO(I),LO(I+51),I=11,13),LO(14),LO(15),LO(65),LO(1CALX-380
     16),(LO(I),LO(I+49),I=17,20),(LO(I),LO(I+50),I=21,22)              CALX-381
      WRITE (MW,1006) (LO(I),LO(I+50),I=23,25),LO(76),LO(26),LO(27),LO(7CALX-382
     17),LO(78),LO(28),LO(29),LO(81),LO(30),LO(82),LO(83),LO(31)        CALX-383
      WRITE (MW,1007) (LO(I),LO(I+52),I=32,34),LO(87),LO(35),LO(36),LO(9CALX-384
     11),(LO(I+51),LO(I),I=41,44),LO(45),LO(46),LO(96)                  CALX-385
      WRITE (MW,1008) LO(47),LO(97),(LO(I),LO(I+47),I=51,53)            CALX-386
      GO TO 7                                                           CALX-387
    6 WRITE (MW,1009) (LO(I),I=1,100)                                   CALX-388
    7 WRITE (MW,1010) TITLE                                             CALX-389
      IF (LO(109).AND.(.NOT.LO(8))) WRITE (MW,1011)                     CALX-390
      READ (MR,1012) H,RM,BJM,EITER,ACONV,CONJ                          CALX-391
C DEFECT VALUES OF NJMAX,ITERM,NPP,NCJ,NPR,NGR,EITER,ACONV,CONJ.        CALX-392
C FOR NPR AND NGR, SEE DEPH.                                            CALX-393
      IF (NJMAX.EQ.0) NJMAX=20                                          CALX-394
      IF (ITERM.EQ.0) ITERM=20                                          CALX-395
      IF (NPP.EQ.0) NPP=1                                               CALX-396
      IF (NPR(1).EQ.0) NPR(1)=1                                         CALX-397
      IF (NPR(2).EQ.0) NPR(2)=1                                         CALX-398
      IF (NGR(1).EQ.0) NGR(1)=2                                         CALX-399
      IF (NGR(2).EQ.0) NGR(2)=2                                         CALX-400
      IF (NCJ.LE.0) NCJ=1                                               CALX-401
      IF (JIT.EQ.0) JIT=1                                               CALX-402
      IF (.NOT.LO(43)) JIT=0                                            CALX-403
      IF (MN.LE.0) MN=1                                                 CALX-404
      NJMAX=MN*NJMAX                                                    CALX-405
      IF (EITER.EQ.0.D0) EITER=1.D-5                                    CALX-406
      IF (ACONV.EQ.0.D0) ACONV=1.D-5                                    CALX-407
      IF (CONJ.EQ.0.D0) CONJ=1.D-5                                      CALX-408
C OUTPUT OF TITLE, MASSES, ETC...                                       CALX-409
      WRITE (MW,1013) NJMAX,JDM,CONJ,NGR,NPR                            CALX-410
      IF (LO(41)) WRITE (MW,1014) NCJ                                   CALX-411
      IF (LML.NE.0) WRITE (MW,1015) LML                                 CALX-412
      IF (.NOT.LO(21)) WRITE (MW,1016) ITERM,EITER,ACONV                CALX-413
      LO(128)=LO(21).OR.LO(29).OR.BJM.NE.0.D0                           CALX-414
      IF (BJM.NE.0.D0) WRITE (MW,1017) BJM                              CALX-415
      IF (LO(21)) WRITE (MW,1018)                                       CALX-416
      IF (LO(21).AND.LO(42)) WRITE (MW,1019) ITERM                      CALX-417
C INITIALISATION OF A SEARCH OR A SINGLE RUN.                           CALX-418
      DO 8 I=111,120                                                    CALX-419
    8 LO(I)=.FALSE.                                                     CALX-420
      LO(115)=.TRUE.                                                    CALX-421
C LIMITATION ON ANGULAR MOMENTUM FOR COULOMB CORRECTIONS.               CALX-422
      MCM(1)=3                                                          CALX-423
      MCM(2)=2                                                          CALX-424
      IF (.NOT.LO(45)) GO TO 9                                          CALX-425
      READ (MR,1002) MC1,MC2                                            CALX-426
      IF (MC1.GT.0) MCM(1)=MIN0(MC1,5)                                  CALX-427
      IF (MC2.GT.0) MCM(2)=MIN0(MC2,4)                                  CALX-428
      IF (MC1.LT.0) MCM(1)=0                                            CALX-429
      IF (MC2.LT.0) MCM(2)=0                                            CALX-430
      WRITE (MW,1021) MCM                                               CALX-431
    9 NL2=3*NJMAX                                                       CALX-432
      NL3=2*NJMAX                                                       CALX-433
C LEGENDRE POLYNOMIALS DATA.                                            CALX-434
      IF (.NOT.LO(65)) GO TO 10                                         CALX-435
      READ (MR,1002) NL                                                 CALX-436
      IF (NL(1).EQ.0) NL(1)=2                                           CALX-437
      IF (NL(2).NE.0) NL2=NL(2)                                         CALX-438
      IF (NL(3).NE.0) NL3=NL(3)                                         CALX-439
      IF (LO(65)) WRITE (MW,1022) NL                                    CALX-440
C COMPOUND NUCLEUS DATA.                                                CALX-441
   10 NSP(1)=0                                                          CALX-442
      NSP(2)=0                                                          CALX-443
      NSP(3)=0                                                          CALX-444
      NFISS=0                                                           CALX-445
      NRD=0                                                             CALX-446
      NCONT=0                                                           CALX-447
      NCONS=0                                                           CALX-448
      IF (.NOT.(LO(84).OR.LO(85).OR.LO(86))) GO TO 11                   CALX-449
      READ (MR,1023) NSP(1),NSP(2),NFISS,NRD,NCONT,NCOJ,KMIN,KMAX,ACN1,ACALX-450
     1CN2                                                               CALX-451
      IF (.NOT.LO(84)) NSP(1)=0                                         CALX-452
      NSP(2)=MIN0(NSP(1),NSP(2))                                        CALX-453
      NSP(3)=NSP(1)-NSP(2)                                              CALX-454
      IF (NSP(3).LT.NCONT) GO TO 20                                     CALX-455
      IF (.NOT.LO(85)) NFISS=0                                          CALX-456
      IF (.NOT.LO(86)) NRD=0                                            CALX-457
      IF (NFISS.EQ.0) LO(85)=.FALSE.                                    CALX-458
      IF (LO(84).OR.LO(85).OR.LO(86)) WRITE (MW,1024) NSP,NFISS,NRD,NCONCALX-459
     1T                                                                 CALX-460
      NCONS=NCONT                                                       CALX-461
      IF (LO(86).AND.NRD.EQ.0) NCONS=NCONS+1                            CALX-462
      IF (NCONT.EQ.0) GO TO 11                                          CALX-463
      IF (NCOJ.LE.0) NCOJ=30                                            CALX-464
      IF (ACN1.LE.1.D0) ACN1=8.D0                                       CALX-465
      IF (ACN2.LE.1.D0) ACN2=8.D0                                       CALX-466
      WRITE (MW,1025) NCOJ,ACN1,ACN2                                    CALX-467
   11 NCOLX=NCOLL+NSP(1)                                                CALX-468
      NCOLS=NCOLL+NSP(2)                                                CALX-469
      NCOLT=NCOLX                                                       CALX-470
      NIPH=(11*NCOLX+1)/2+1                                             CALX-471
      NJIT=NIPH+NCOLL                                                   CALX-472
      IF (LO(7)) NJIT=NIPH                                              CALX-473
      NWV=NJIT+JIT                                                      CALX-474
      NIPP=NWV+22*NCOLX                                                 CALX-475
      NPAR=NIPP+17*NPP                                                  CALX-476
      NPLACE=NPAR                                                       CALX-477
      CALL MEMO('CALX',IDMT,NPLACE)                                     CALX-478
C INTERPOLATION DATA.                                                   CALX-479
      IF (.NOT.LO(43)) GO TO 13                                         CALX-480
      K=NJIT                                                            CALX-481
      READ (MR,1002) (NW(1,NJIT+I-1),NW(2,NJIT+I-1),I=1,JIT)            CALX-482
      WRITE (MW,1026) (NW(1,NJIT+I-1),NW(2,NJIT+I-1),I=1,JIT)           CALX-483
      M=0                                                               CALX-484
      L=-1                                                              CALX-485
      DO 12 I=1,JIT                                                     CALX-486
      IF (NW(1,NJIT+I-1).LT.L) GO TO 21                                 CALX-487
      L=NW(1,NJIT+I-1)                                                  CALX-488
      NW(2,NJIT+I-1)=NW(2,NJIT+I-1)-M                                   CALX-489
      M=M+NW(2,NJIT+I-1)                                                CALX-490
   12 K=K+2                                                             CALX-491
      WRITE (MW,1027) (NW(2,NJIT+I-1),I=1,JIT)                          CALX-492
C INPUT OF LEVEL DESCRIPTIONS.                                          CALX-493
   13 CALL LECL(NCOLX,NCOLL,NCONT,IDMT-NPAR,LO,NW,NW(1,NIPH),DW(NWV),NW(CALX-494
     11,NIPP),NW(1,NPAR),DW(NPAR),NA,NB,NIMAX,NBET)                     CALX-495
      NPAA=NPAR+NA                                                      CALX-496
      NSCN=NPAA+NVA+NB                                                  CALX-497
      IF (KMIN.EQ.0) KMIN=IABS(NW(2,1)-NW(1,2))/2+NW(1,1)               CALX-498
      IF (KMAX.EQ.0) KMAX=NJMAX                                         CALX-499
      LO(132)=LO(43).AND.((NW(1,NJIT).LT.KMAX).OR.(NW(2,NJIT).NE.0))    CALX-500
C INPUT OF POTENTIALS, DEFORMATIONS ......                              CALX-501
      NBT1=NBET                                                         CALX-502
      LMX=NIMAX/2+2                                                     CALX-503
      LMAX1=NJMAX+LMX                                                   CALX-504
      IF (LML.EQ.0) LML=LMAX1                                           CALX-505
      NW(2,5)=LML                                                       CALX-506
      NFIS=NSCN+7*NCONS                                                 CALX-507
      NGAM=NFIS+2*NFISS                                                 CALX-508
      NNIV=NGAM+NRD                                                     CALX-509
      NPOT=NNIV+(3*NCOLL*NCOLL+1)/2                                     CALX-510
      NBETA=NPOT+42*NPP                                                 CALX-511
      IF (LO(7)) NBETA=NPOT                                             CALX-512
      IF (NBETA+9*NBET.GT.IDMT) CALL MEMO('CALX',IDMT,NBETA+9*NBET)     CALX-513
      IF (DW(NWV+4).EQ.0.) NL2=NL3                                      CALX-514
      NLT=MAX0(NL2,NL3)                                                 CALX-515
      IF (.NOT.LO(65)) NLT=0                                            CALX-516
      CALL LECT(NBET,NW,NW(1,NIPP),DW(NWV),RM,IDMT-NBETA,LO,NW(1,NBETA),CALX-517
     1DW(NBETA),DW(NPOT),DW(NFIS),DW(NGAM),ISM,DW(NSCN))                CALX-518
      HCONV=ACONV*H*H                                                   CALX-519
      NFM=NBETA+9*NBET                                                  CALX-520
      IF (LO(74)) CALL HORA                                             CALX-521
C HELICITY AMPLITUDES AND OBSERVABLES.                                  CALX-522
      NJX=NCOLL                                                         CALX-523
      CALL DEPH(NCOLL,DW(NWV),NW,NGR,NPR,IDMT-NFM,LO,NW(1,NFM),KTGR,NW(1CALX-524
     1,NNIV),NJX,NJY)                                                   CALX-525
      JTH=0                                                             CALX-526
      IF (.NOT.LO(66)) JTH=IDINT((THETA2-THETA1)/DTHETA+1.5D0)          CALX-527
      JTX=JTX*JTH                                                       CALX-528
      NGRM=NFM+5*KCC                                                    CALX-529
      NNVI=NFM+5*KTGR                                                   CALX-530
      NTGX=1                                                            CALX-531
      NDONN=1                                                           CALX-532
      NREC=0                                                            CALX-533
      NTOT=0                                                            CALX-534
      IF (.NOT.LO(31)) GO TO 17                                         CALX-535
C NUMBER OF PARAMETERS IN SEARCH AND EXPERIMENTAL DATA.                 CALX-536
      READ (MR,1028) NCOLR,NREC,NFIT,NESSAI,YY(1),YY(2)                 CALX-537
C SEARCH CONDITIONS.                                                    CALX-538
C DEFECT VALUES FOR NESSAI (MAXIMUM NUMBER OF EVALUATIONS) AND ECH.     CALX-539
C NFIT IS THE NUMBER OF FUNCTIONS STORED FOR SEARCH BEYOND NREC+1.      CALX-540
      IF (NESSAI.EQ.0) NESSAI=100                                       CALX-541
      KFIT=NREC+NFIT+1                                                  CALX-542
      IF (YY(1).EQ.0.D0) YY(1)=20.D0                                    CALX-543
      IF (YY(2).LT.1.D0) YY(2)=1.D0                                     CALX-544
      YY(3)=0.D0                                                        CALX-545
      WRITE (MW,1029) NCOLR                                             CALX-546
      IF (NCOLR.LE.0) GO TO 15                                          CALX-547
      KTGR=KTGR+NCOLR                                                   CALX-548
      NTGX=NFM+5*KTGR                                                   CALX-549
      NDONN=NTGX+7*NCOLR                                                CALX-550
C EXPERIMENTAL DATA.                                                    CALX-551
      IF (NDONN.GT.IDMT) CALL MEMO('CALX',IDMT,NDONN)                   CALX-552
      CALL LECD(DW(NWV),NGR,KFIT,NESSAI,YY,NJY,IDMT-NDONN,LO,NW(1,NNVI),CALX-553
     1NW(1,NTGX),DW(NTGX),DW(NDONN),DW(NDONN),NW(1,NDONN),NMX)          CALX-554
      JTX=MAX0(JTH,JTX)                                                 CALX-555
      NNVI=NDONN+6*NTOT                                                 CALX-556
      IF (.NOT.LO(32)) GO TO 17                                         CALX-557
      IF (NREC.LE.0) GO TO 16                                           CALX-558
      NDE=NNVI                                                          CALX-559
      NISE=NDE+NREC                                                     CALX-560
      NRC=NISE+NMX/2                                                    CALX-561
      NIW=NRC+MAX0(14+NREC+KFIT*(NTOT+NREC+1),(NREC*(NREC+5))/2)        CALX-562
      IF (NIW.GT.IDMT) CALL MEMO('CALX',IDMT,NIW)                       CALX-563
      NW(1,NIW)=KFIT                                                    CALX-564
      NW(2,NIW)=NESSAI                                                  CALX-565
      NW(1,NIW+1)=1                                                     CALX-566
      NNVI=NIW+(KFIT+5)/2                                               CALX-567
      I1=51                                                             CALX-568
      IF (LO(76).OR.(.NOT.LO(75))) I1=59                                CALX-569
      DO 14 I=I1,65                                                     CALX-570
      LO(I+85)=LO(I)                                                    CALX-571
   14 LO(I)=.FALSE.                                                     CALX-572
      LO(116)=LO(75)                                                    CALX-573
      GO TO 17                                                          CALX-574
   15 WRITE (MW,1030)                                                   CALX-575
      LO(31)=.FALSE.                                                    CALX-576
   16 IF (LO(32)) WRITE (MW,1031)                                       CALX-577
      LO(32)=.FALSE.                                                    CALX-578
   17 IF (LO(74)) CALL HORA                                             CALX-579
      NNWI=NNVI                                                         CALX-580
      IF (LO(123)) NNWI=NNWI+(3*KAB*KAB+1)/2                            CALX-581
      NCC=NNWI+2*KAB*KAB                                                CALX-582
      MCC=NCC                                                           CALX-583
      IF (LO(123)) MCC=MCC+3*KAB                                        CALX-584
      NXA=MCC+3*KAB                                                     CALX-585
      NAM1=NXA                                                          CALX-586
      IF (LO(123)) NAM1=NAM1+KBC*KBC                                    CALX-587
      NAM2=NAM1+4*(NJY+16)                                              CALX-588
      IF (NAM2.GT.IDMT) CALL MEMO('CALX',IDMT,NAM2)                     CALX-589
C DO LOOPS AND CG-COEFFICIENTS FOR OBSERVABLES.                         CALX-590
      CALL OBSE(NW(1,NGRM),CW(1,NGRM),KTGR-KCC,NCOLR,NW,IDMT-NAM2,LO,CW(CALX-591
     11,NAM1),JCAL,NW(1,NAM1),CW(1,NAM1),DW(NAM2),CW(1,NAM2),NW(1,NAM2),CALX-592
     2DW(NAM2),NW(1,NAM2))                                              CALX-593
      NFA=4*LMAX1+10-2*NJMAX                                            CALX-594
      NFAC=NAM1+JCAL                                                    CALX-595
      NFG=NFAC+NFA+1                                                    CALX-596
      LMAX2=LMAX1                                                       CALX-597
      IF (.NOT.LO(108)) GO TO 18                                        CALX-598
      LMAX1=LMZ+LMX                                                     CALX-599
      IF (LMZ.EQ.0) LMAX1=LMAX2-NJMAX/2                                 CALX-600
      IF (LMZ.LT.0) LMAX1=LMAX2                                         CALX-601
      WRITE (MW,1032) LMAX2,LMAX1                                       CALX-602
   18 NXG=NFG+4*NJX*LMAX1                                               CALX-603
      NRES=NXG+NJX*LMAX2                                                CALX-604
      KE=0                                                              CALX-605
      NXX=NRES+NTOT                                                     CALX-606
      NT=NXX+NREC                                                       CALX-607
      ITEMM=ITERM                                                       CALX-608
      NPLACE=NT                                                         CALX-609
      IF (NPLACE.GT.IDMT) CALL MEMO('CALX',IDMT,NPLACE)                 CALX-610
      DW(NFAC)=0.D0                                                     CALX-611
      DO 19 I=1,NFA                                                     CALX-612
   19 DW(NFAC+I)=DW(NFAC+I-1)+DLOG(DFLOAT(I))                           CALX-613
      RETURN                                                            CALX-614
   20 WRITE (MW,1033) NSP(3),NCONT                                      CALX-615
      GO TO 22                                                          CALX-616
   21 WRITE (MW,1034) I,NW(K,1),L                                       CALX-617
   22 WRITE (MW,1035)                                                   CALX-618
      STOP                                                              CALX-619
 1000 FORMAT (18A4)                                                     CALX-620
 1001 FORMAT (50L1)                                                     CALX-621
 1002 FORMAT (14I5)                                                     CALX-622
 1003 FORMAT ('1',20X,'E. C. I. S. CODE FOR COUPLED CHANNELS CALCULATIONCALX-623
     1S ( 2006 ) WORKING FIELD LENGTH =',I10//24X,'TO OBTAIN THE INPUT DCALX-624
     2ESCRIPTION, PUNCH ''DESCRIPTION '' IN COLUMNS 1-12 OF THE FIRST CACALX-625
     3RD.'//)                                                           CALX-626
 1004 FORMAT ('  1',L2,' - ROTATIONAL MODEL-(.F.: VIBRATIONAL MODEL).',9CALX-627
     1X,'| 54',L2,' - OUTPUT OF THE LENGTH USED IN THE WORKING FIELD.'/'CALX-628
     2  2',L2,' - SECOND ORDER VIBRATIONAL MODEL-(.F.: FIRST ORDER)  | 5CALX-629
     35',L2,' - OUTPUT OF C-MATRIX ELEMENTS AND COMPOUND NUCLEUS'/8X,'ORCALX-630
     4 CONSTRAINED ASYMMETRIC ROTATIONAL MODEL.',8X,'|',8X,'INTERMEDIATECALX-631
     5 RESULTS.'/'  3',L2,' - ANHARMONIC VIBRATIONAL MODEL-(.F.: HARMONICALX-632
     6C) OR    | 56',L2,' - OUTPUT OF S-MATRIX ELEMENTS.'/8X,'ASYMMETRICCALX-633
     7 ROTATIONAL MODEL-(.F.: SYMMETRIC).',6X,'| 57',L2,' - OUTPUT OF PHCALX-634
     8ASE-SHIFTS AT EACH E.C.I.S. ITERATION.'/'  4',L2,' - PARAMETRISED CALX-635
     9SPIN-ORBIT DEFORMATION-(.F.:STANDARD) | 58',L2,' - OUTPUT OF THE CCALX-636
     AOEFFICIENTS OF EACH FORM FACTOR'/'  5',L2,' - DIFFERENT DEFORMATIOCALX-637
     BN FOR EACH POTENTIAL(.F.: SAME)|',8X,'FOR ALL SETS OF EQUATIONS.'/CALX-638
     C'  6',L2,' - USE OF DEFORMATION LENGTHS.',24X,'| 59',L2,' - TOTAL CALX-639
     DELASTIC REACTION CROSS-SECTIONS WRITTEN ON'/'  7',L2,' - NUCLEAR MCALX-640
     EATRIX ELEMENTS AND FORM FACTORS ON CARDS. |',8X,'FILE 58 AND TOTALCALX-641
     F INELASTIC REACTION'/'  8',L2,' - RELATIVISTIC KINEMATICS.',27X,'|CALX-642
     G',8X,'CROSS-SECTIONS ON FILE 59.'/'  9',L2,' - SYMMETRISED WOODS-SCALX-643
     HAXON FORM FOR NEGATIVE RADII.   | 60',L2,' - S-MATRIX ELEMENTS WRICALX-644
     ITTEN ON FILE 60.'/' 10',L2,' - DISPERSION RELATIONS FOR POTENTIALSCALX-645
     J.',15X,'|'/59X,'| 61',L2,' - REDUCED NUCLEAR MATRIX ELEMENTS WRITTCALX-646
     KEN ON FILE 61.')                                                  CALX-647
 1005 FORMAT (' 11',L2,' - DEFORMED COULOMB POTENTIAL.',24X,'| 62',L2,' CALX-648
     1- POTENTIALS WRITTEN ON FILE 62.'/' 12',L2,' - DEFORMED IMAGINARY CALX-649
     2POTENTIAL.',22X,'| 63',L2,' - PENETRABILITIES WRITTEN ON FILE 63.'CALX-650
     3/' 13',L2,' - DEFORMED REAL SPIN-ORBIT/TENSOR POTENTIAL. ',8X,'| 6CALX-651
     44',L2,' - RESULTS FOR EXPERIMENTAL DATA ON FILE 64'/' 14',L2,' - DCALX-652
     5EFORMED IMAGINARY SPIN-ORBIT/TENSOR POTENTIAL.    |',8X,'AND AT EQCALX-653
     6UIDISTANT ANGLES WRITTEN ON FILE 66.'/' 15',L2,' - REDUCED NUCLEARCALX-654
     7 MATRIX ELEMENTS READ FROM CARDS.   | 65',L2,' - LEGENDRE EXPANSIOCALX-655
     8N FOR CROSS-SECTIONS WRITTEN ON'/' 16',L2,' - HEAVY-ION DEFINITIONCALX-656
     9 OF RADII AND DEFORMATIONS.    |',8X,'FILE 65.'/' 17',L2,' - FOLDICALX-657
     ANG MODEL.',37X,'| 66',L2,' - NO CALCULATION AT EQUIDISTANT ANGLES.CALX-658
     B'/' 18',L2,' - PROJECTILE-TARGET ANTISYMMETRISATION.',14X,'| 67',LCALX-659
     C2,' - NO PLOT OF EXPERIMENTAL DATA.'/' 19',L2,' - DEFORMED COULOMBCALX-660
     D SPIN-ORBIT POTENTIAL.',13X,'| 68',L2,' - NO PLOT OF CROSS-SECTIONCALX-661
     ES AT EQUIDISTANT ANGLES.'/' 20',L2,' - DISPERSION RELATIONS FOR TRCALX-662
     FANSITION FORM-FACTORS.  | 69',L2,' - NO PLOT OF POLARISATIONS AT ECALX-663
     GQUIDISTANT ANGLES.'/59X,'|'/' 21',L2,' - USUAL COUPLED EQUATIONS-(CALX-664
     H.F.: ITERATIONS).',9X,'| 71',L2,' - NO DETAILED OUTPUT OF LOGICAL CALX-665
     ICONTROLS.'/' 22',L2,' - NO USE OF PADE FOR CONVERGENCE OF THE ITERCALX-666
     JATIONS.  | 72',L2,' - NO OUTPUT OF EXPERIMENTAL DATA AS THEY ARE RCALX-667
     KEAD.')                                                            CALX-668
 1006 FORMAT (' 23',L2,' - NO USE OF PADE WITHOUT CONVERGENCE.',16X,'| 7CALX-669
     13',L2,' - NO OUTPUT OF EXTERNAL POTENTIALS AS THEY ARE READ.'/' 24CALX-670
     2',L2,' - COUPLING POTENTIALS COMPUTED AT EACH ITERATION.    | 74',CALX-671
     3L2,' - OUTPUT OF VARIATIONS IN STORAGE.'/' 25',L2,' - COMPLETE CALCALX-672
     4CULATION UP TO THE END-(.F.: ONE ITE-  | 75',L2,' - NO COMPLETE OUCALX-673
     5TPUT AT THE FIRST RUN OF A SEARCH.'/8X,'RATION ONLY AS SOON AS TWOCALX-674
     6 ITERATIONS ARE ENOUGH). | 76',L2,' - LO(51) TO LO(65) ARE ALWAYS CALX-675
     7USED-(.F.: ONLY FOR'/' 26',L2,' - INTEGRATION STABILISED FOR LONG CALX-676
     8RANGE POTENTIAL.   |',8X,'COMPLETE OUTPUT)'/' 27',L2,' - NUMEROV''CALX-677
     9S METHOD FOR SINGLE EQUATIONS-(.F.: MODI-  | 77',L2,' - OUTPUT OF CALX-678
     ATIME DIFFERENCES DURING THE SEARCH.'/8X,'FIED NUMEROV''S METHOD).'CALX-679
     B,28X,'| 78',L2,' - OUTPUT OF DIFFERENCES BETWEEN EXPERIMENTAL'/' 2CALX-680
     C8',L2,' - COMPUTATION UP TO J-CONVERGENCE-(.F.: STOP WHEN    |',8XCALX-681
     D,'AND CALCULATED VALUES.'/8X,'ALL THE INHOMOGENEOUS TERMS ARE NEGLCALX-682
     EIGIBLE).',7X,'|'/' 29',L2,' - NO DIAGONAL TERM IN SECOND MEMBERS.'CALX-683
     F,16X,'| 81',L2,' - HAUSER-FESHBACH CORRECTIONS TO CROSS-SECTIONS.'CALX-684
     G/' 30',L2,' - PURE DWBA CALCULATION.',29X,'| 82',L2,' - SIMPLEST CCALX-685
     HOMPOUND NUCLEUS FORMALISM.'/59X,'| 83',L2,' - NO ENGELBRETCH-WEIDECALX-686
     INMULLER TRANSFORMATION IN'/' 31',L2,' - INPUT OF EXPERIMENTAL DATACALX-687
     J AND CHI2 CALCULATION.   |',8X,'IN COMPOUND NUCLEUS.')            CALX-688
 1007 FORMAT (' 32',L2,' - AUTOMATIC SEARCH ON SOME PARAMETERS.',15X,'| CALX-689
     184',L2,' - UNCOUPLED LEVELS FOR COMPOUND NUCLEUS.'/' 33',L2,' - SYCALX-690
     2MMETRISED CHI2 FOR CROSS-SECTIONS.',15X,'| 85',L2,' - FISSION DATACALX-691
     3 IN COMPOUND NUCLEUS.'/' 34',L2,' - NEXT CALCULATION CHANGING ENERCALX-692
     4GY AND/OR SOME',7X,'| 86',L2,' - GAMMA EMISSION DATA IN COMPOUND NCALX-693
     5UCLEUS.'/8X,'PARAMETERS.',40X,'| 87',L2,' - NO WIDTH FLUCTUATIONS.CALX-694
     6'/' 35',L2,' - SEARCH SAVED ON TAPE 8 IF ENDED OR LACK OF TIME.   CALX-695
     7|'/' 36',L2,' - RESTART A SEARCH FROM TAPE 8.',22X,'| 91',L2,' - ECALX-696
     8QUIDISTANT ANGLES IN THE LABORATORY SYSTEM.'/59X,'| 92',L2,' - NONCALX-697
     9 STANDARD OBSERVABLES AT EQUIDISTANT ANGLES.'/' 41',L2,' - FACTORICALX-698
     ASATION OF 1/(1-COS(THETA)) IN AMPLITUDES.   | 93',L2,' - NO RECOILCALX-699
     B CORRECTION FOR REACTIONS.'/' 42',L2,' - SCHMIDT''S ORTHOGONAL. INCALX-700
     C USUAL COUPLED EQUATIONS.  | 94',L2,' - NON RELATIVISTIC "REDUCED CALX-701
     DMASS" FOR DIRAC EQUATION.'/' 43',L2,' - INTERPOLATION ON TOTAL SPICALX-702
     EN.',23X,'| 95',L2,' - "REDUCED ENERGY" FOR NON COULOMB INTERACTIONCALX-703
     F IN'/' 44',L2,' - COULOMB CORRECTIONS.',31X,'|',8X,'RELATIVISTIC SCALX-704
     GCHROEDINGER EQUATION OR USE OF REST'/' 45',L2,' - ANGULAR MOMENTUMCALX-705
     H LIMIT FOR COULOMB CORRECTIONS.    |',8X,'MASS IN DIRAC EQUATION.'CALX-706
     I/' 46',L2,' - RESTRICTED COULOMB CORRECTIONS.',20X,'| 96',L2,' - "CALX-707
     JREDUCED MASS" FOR COULOMB INTERACTION IN')                        CALX-708
 1008 FORMAT (' 47',L2,' - NO RECOIL CORRECTION FOR BOUND STATES.',13X,'CALX-709
     1|',8X,'RELATIVISTIC SCHROEDINGER EQUATION.'/59X,'| 97',L2,' - SAMECALX-710
     2 REDUCED MASS FOR ALL THE STATES.'/' 51',L2,' - OUTPUT OF POTENTIACALX-711
     3LS.',30X,'| 98',L2,' - Q ADDED TO THE MASS OF RESIDUAL NUCLEUS.'/'CALX-712
     4 52',L2,' - OUTPUT OF REDUCED NUCLEAR MATRIX ELEMENTS.',9X,'| 99',CALX-713
     5L2,' - SCHROEDINGER EQUIVALENT TO DIRAC EQUATION.'/' 53',L2,' - OUCALX-714
     6TPUT OF THE NUMBER OF ITERATIONS.',16X,'|100',L2,' - COMPLETE DIRACALX-715
     7C EQUATION.'/'1')                                                 CALX-716
 1009 FORMAT (//' **** FIRST CONTROL CARD ****',2X,'1 ',9(' 1'),' 2 ',9(CALX-717
     1' 2'),' 3 ',9(' 3'),' 4 ',9(' 4'),' 5'/ 11X,5('  1 2 3 4 5 6 7 8 9CALX-718
     2 0')/11X,5(1X,10L2)//' *** SECOND CONTROL CARD ****',2X,'1 ',9(' 1CALX-719
     3'),' 2 ',9(' 2'),' 3 ',9(' 3'),' 4 ',9(' 4'),' 5'/11X,5('  1 2 3 4CALX-720
     4 5 6 7 8 9 0')/11X,5(1X,10L2)/)                                   CALX-721
 1010 FORMAT (10X,82('*')/10X,'*',80X,'*'/10X,'*',4X,18A4,4X,'*'/10X,'*'CALX-722
     1,80X,'*'/10X,82('*')/)                                            CALX-723
 1011 FORMAT (//' ******** YOU ARE USING DIRAC EQUATION WITHOUT RELATIVICALX-724
     1STIC KINEMATICS ********'//)                                      CALX-725
 1012 FORMAT (7F10.5)                                                   CALX-726
 1013 FORMAT (' MAXIMUM NUMBER OF J',I6,'  (MIN',I3,') STOP WHEN MAXIMUMCALX-727
     1 S-MATRIX ELEMENT IS LESS THAN',D18.4//' PLOT CONDITIONS FOR CROSSCALX-728
     2-SECTIONS',2I5,5X,'FOR POLARISATIONS',2I5/)                       CALX-729
 1014 FORMAT (4X,I3,' FACTORISATION OF 1/(1-COS(THETA)) IN THE AMPLITUDECALX-730
     1S.')                                                              CALX-731
 1015 FORMAT (' ANGULAR MOMENTA LIMITED TO',I5)                         CALX-732
 1016 FORMAT (10X,'ITERATION METHOD:  MAXIMUM NUMBER OF ITERATIONS',I10/CALX-733
     110X,'CONVERGENCE CRITERION:',1P,D15.4,' FOR S-MATRIX',D15.4,' FOR CALX-734
     2POTENTIALS AND FUNCTIONS.'/)                                      CALX-735
 1017 FORMAT (' IMAGINARY POTENTIAL INCREASED WITH A FACTOR',F10.5,' FORCALX-736
     1 BETTER CONVERGENCE.')                                            CALX-737
 1018 FORMAT (' USUAL COUPLED EQUATIONS.')                              CALX-738
 1019 FORMAT (' SCHMIDT''S ORTHOGONALISATION EVERY',I5,'  STEPS.')      CALX-739
 1021 FORMAT (' COULOMB CORRECTIONS LIMITED TO ANGULAR MOMENTA',I2,' FORCALX-740
     1 CENTRAL TERM AND',I2,' FOR SPIN-ORBIT TERM')                     CALX-741
 1022 FORMAT (/' INDICATIONS FOR EXPANSION OF CROSS-SECTIONS IN LEGENDRECALX-742
     1 POLYNOMIALS:',3I5)                                               CALX-743
 1023 FORMAT (8I5,2F10.5)                                               CALX-744
 1024 FORMAT (/' COMPOUND NUCLEUS INPUT:',I5,' UNCOUPLED STATES',I4,' WICALX-745
     1TH ANGULAR DISTRIBUTION AND',I4,' WITHOUT ANGULAR DISTRIBUTION'/24CALX-746
     2X,I5,' FISSION TRANSM. COEFF.'/24X,I5,' GAMMA TRANSM. COEFF.'/24X,CALX-747
     3I5,' CONTINUA')                                                   CALX-748
 1025 FORMAT (' MAXIMUM NUMBER OF SPIN VALUES IN THE CONTINUUM:',I5/' DICALX-749
     1SCRETISATION WITH:',2F10.5)                                       CALX-750
 1026 FORMAT (' INTERPOLATION OF S-MATRIX',3(2X,'FROM',I6,'  BY STEPS OFCALX-751
     1',I4,'+1')/(26X,3(2X,'FROM',I6,'  BY STEPS OF',I4,'+1')))         CALX-752
 1027 FORMAT (' UNCUMULATED INCREASES  ',3(27X,I4)/(24X,3(27X,I4)))     CALX-753
 1028 FORMAT (4I5,2F10.5)                                               CALX-754
 1029 FORMAT (//5X,I5,'  EXPERIMENTAL ANGULAR DISTRIBUTIONS.'/)         CALX-755
 1030 FORMAT (' THERE ARE NO EXPERIMENTAL DATA   ...  NO SEARCH.')      CALX-756
 1031 FORMAT (' NO PARAMETER IN SEARCH.')                               CALX-757
 1032 FORMAT (2X,I10,' COULOMB PHASES AND INDEFINITE INTEGRALS'/2X,I10,'CALX-758
     1 COULOMB FUNCTIONS AND FINITE INTEGRALS.')                        CALX-759
 1033 FORMAT (' NUMBER OF UNCOUPLED STATES WITHOUT ANGULAR DISTRIBUTION'CALX-760
     1,I5,' LESS THAN THE NUMBER OF CONTINUA:',I5)                      CALX-761
 1034 FORMAT (2X,I3,'TH LIMIT OF INTERPOLATION',I6,' SMALLER THAN PREVIOCALX-762
     1US ONE',I6)                                                       CALX-763
 1035 FORMAT (//' IN CALX  ...  STOP  ...')                             CALX-764
      END                                                               CALX-765
C C 05/03/                                                      ECIS06  INPA-000
      SUBROUTINE INPA                                                   INPA-001
      COMMON /INOUT/ MR,MW,MS                                           INPA-002
      WRITE (MW,1000)                                                   INPA-003
 1000 FORMAT ('C 05/03/07',62X,'ECIS-000'/15X,'DESCRIPTION OF INPUT OF EINPA-004
     1CIS06',27X,'ECIS-001'/15X,'******************************',27X,'ECINPA-005
     2IS-002'/72X,'ECIS-003'/72X,'ECIS-004'/72X,'ECIS-005'/'CARDS READ IINPA-006
     3N SUBROUTINE CALX',43X,'ECIS-006'/'*****************************',INPA-007
     443X,'ECIS-007'/72X,'ECIS-008'/'CARD 1',34X,'FORMAT (18A4)',19X,'ECINPA-008
     5IS-009'/'******',66X,'ECIS-010'/6X,'TITLE OF THE RUN WHICH WILL BEINPA-009
     6 PRINTED AS HEADING OF RESULTS.',5X,'ECIS-011'/72X,'ECIS-012'/6X,'INPA-010
     7IF TITLE="DESCRIPTION " THIS INPUT DESCRIPTION IS LISTED.',9X,'ECIINPA-011
     8S-013'/9X,'(1958 LINES CORRECTLY PRINTED IN 32 PAGES)',21X,'ECIS-0INPA-012
     914'/10X,'AFTER THIS LISTING, GO BACK TO CARD 1.',24X,'ECIS-015'/72INPA-013
     AX,'ECIS-016'/6X,'IF TITLE="FIN " THE CALCULATION IS STOPPED.',23X,INPA-014
     B'ECIS-017'/72X,'ECIS-018'/11X,'THESE CONTROL WORDS MUST BE PUNCHEDINPA-015
     C FROM COLUMN 1.',11X,'ECIS-019'/72X,'ECIS-020'/'CARD 2',34X,'FORMAINPA-016
     DT (50L1)',19X,'ECIS-021'/'******',66X,'ECIS-022'/6X,'50 FIRST LOGIINPA-017
     ECAL CONTROLS LO. ENTER "T" IN THE CORRESPONDING',6X,'ECIS-023'/6X,INPA-018
     F'COLUMN FOR .TRUE. AND NOTHING FOR .FALSE. UNLESS "F" IS NEEDED.  INPA-019
     G ECIS-024'/72X,'ECIS-025'/' MODEL',66X,'ECIS-026'/7X,'1- LO(1)  ROINPA-020
     HTATIONAL MODEL-(INVERSE: VIBRATIONAL MODEL).',9X,'ECIS-027'/7X,'2-INPA-021
     I LO(2)  SECOND ORDER VIBRATIONAL MODEL-(INVERSE: FIRST ORDER). ECIINPA-022
     JS-028'/17X,'OR CONSTRAINED ASYMMETRIC ROTATIONAL MODEL (BAND MIXININPA-023
     KGECIS-029')                                                       INPA-024
      WRITE (MW,1001)                                                   INPA-025
 1001 FORMAT (17X,'PARAMETERS OF THE FIRST TWO 2+ COMPUTED FROM THE',7X,INPA-026
     1'ECIS-030'/17X,'QUADRUPOLE "GAMMA" IN THE DAVYDOV-FILIPPOV MODEL).INPA-027
     2',5X,'ECIS-031'/7X,'3- LO(3)  ANHARMONIC VIBRATIONAL MODEL-(INVERSINPA-028
     3E: HARMONIC) OR',4X,'ECIS-032'/17X,'ASYMMETRIC ROTATIONAL MODEL-(IINPA-029
     4NVERSE: SYMMETRIC).',6X,'ECIS-033'/7X,'4- LO(4)  PARAMETRISED SPININPA-030
     5-ORBIT DEFORMATION-(INVERSE: STANDARD)ECIS-034'/7X,'5- LO(5)  DIFFINPA-031
     6ERENT DEFORMATION FOR EACH POTENTIAL-(INVERSE: SAMEECIS-035'/17X,'INPA-032
     7DEFORMATION).',42X,'ECIS-036'/7X,'6- LO(6)  DEFORMATION LENGTHS REINPA-033
     8AD INSTEAD OF DEFORMATIONS FOR   ECIS-037'/17X,'WOODS-SAXON FORM FINPA-034
     9ACTORS.',30X,'ECIS-038'/7X,'7- LO(7)  NUCLEAR MATRIX ELEMENT AND FINPA-035
     AORM FACTORS READ ON CARDS. ECIS-039'/17X,'THIS IS NOT ALLOWED FOR INPA-036
     BSCHROEDINGER EQUIVALENT OF',5X,'ECIS-040'/17X,'DIRAC EQUATION.',40INPA-037
     CX,'ECIS-041'/7X,'8- LO(8)  RELATIVISTIC KINEMATICS. FOR THE REDUCEINPA-038
     DD MASS, SEE',5X,'ECIS-042'/17X,'LO(94) TO LO(97).',38X,'ECIS-043'/INPA-039
     E7X,'9- LO(9)  SYMMETRISED WOODS-SAXON FORM FACTORS WHEN THE RADIUSINPA-040
     F ISECIS-044'/17X,'NEGATIVE.',46X,'ECIS-045'/6X,'10- LO(10) ENERGY INPA-041
     GDEPENDENT POTENTIALS BY DISPERSION RELATIONS.   ECIS-046'/17X,'NOWINPA-042
     H ALLOWED WITH EXTERNAL POTENTIALS (LO(7)=.TRUE.).   ECIS-047'/72X,INPA-043
     I'ECIS-048'/' INTERACTION',60X,'ECIS-049'/6X,'11- LO(11) DEFORMED CINPA-044
     JOULOMB POTENTIAL. WITH LO(7)=.FALSE., IT IS  ECIS-050'/17X,'SET .FINPA-045
     KALSE. BY THE CODE IF NO CHARGE IS READ.',10X,'ECIS-051')          INPA-046
      WRITE (MW,1002)                                                   INPA-047
 1002 FORMAT (6X,'12- LO(12) DEFORMED IMAGINARY POTENTIAL (VOLUME AND SUINPA-048
     1RFACE OR',4X,'ECIS-052'/17X,'SCALAR AND VECTOR).',36X,'ECIS-053'/6INPA-049
     2X,'13- LO(13) DEFORMED REAL SPIN-ORBIT OR TENSOR POTENTIAL. WITH',INPA-050
     35X,'ECIS-054'/17X,'LO(7)=.FALSE., IT IS SET .FALSE. BY THE CODE IFINPA-051
     4 NO',5X,'ECIS-055'/17X,'NON ZERO SPIN AND NO RELATED POTENTIAL AREINPA-052
     5 READ.',7X,'ECIS-056'/6X,'14- LO(14) DEFORMED IMAGINARY SPIN-ORBITINPA-053
     6 OR TENSOR POTENTIAL. IF  ECIS-057'/17X,'.TRUE., LO(13) IS SET .TRINPA-054
     7UE.. WITH LO(7)=.FALSE., IT ISECIS-058'/17X,'SET .FALSE. BY THE COINPA-055
     8DE AS FOR LO(13).',17X,'ECIS-059'/6X,'15- LO(15) REDUCED NUCLEAR MINPA-056
     9ATRIX ELEMENTS READ FROM CARDS.',7X,'ECIS-060'/17X,'IT IS NECESSARINPA-057
     AY FOR THE ANHARMONIC VIBRATIONAL MODEL.  ECIS-061'/''/6X,'16- LO(INPA-058
     B16) HEAVY-ION DEFINITION OF REDUCED RADII AND DEFORMATIONS.ECIS-06INPA-059
     C2'/17X,'WHEN THERE ARE DIFFERENT MASSES IN DIFFERENT CHANNELS, ECIINPA-060
     DS-063'/17X,'THE MASSES TO BE USED CAN BE INDICATED BY THE FIRST',4INPA-061
     EX,'ECIS-064'/17X,'INPUT, BUT ONLY THE MASSES OF THE FIRST LEVEL CAINPA-062
     FN BE   ECIS-065'/17X,'USED FOR THE BACK TRANSFORMATION OF THE RESUINPA-063
     GLTS OF A   ECIS-066'/17X,'SEARCH OR IN THE SUBROUTINE EVAL (LO(34)INPA-064
     H=.TRUE.).',6X,'ECIS-067'/17X,'IF LO(6)=.TRUE., ONLY COULOMB DEFORMINPA-065
     IATION LENGTHS ARE  ECIS-068'/17X,'CHANGED.',47X,'ECIS-069'/6X,'17-INPA-066
     J LO(17) FOLDING MODEL. WITH EXTERNAL FORM FACTORS THE FOLDING  ECIINPA-067
     KS-070')                                                           INPA-068
      WRITE (MW,1003)                                                   INPA-069
 1003 FORMAT (17X,'PARAMETERS ARE USED INDEPENDENTLY OF THIS LOGICAL.',5INPA-070
     1X,'ECIS-071'/6X,'18- LO(18) PROJECTILE-TARGET ANTISYMMETRISATION, INPA-071
     2VALID ONLY FOR   ECIS-072'/17X,'SAME SPIN OF THE PARTICLE AND THE INPA-072
     3TARGET AND POSITIVE  ECIS-073'/17X,'PARITY IN THE SCHROEDINGER FORINPA-073
     4MALISM. FOR SPIN 0,',6X,'ECIS-074'/17X,'THE S-MATRIX IS COMPUTED OINPA-074
     5NLY FOR EVEN TOTAL SPINS.',4X,'ECIS-075'/17X,'FOR SPIN NON 0., THEINPA-075
     6 AMPLITUDES ARE SYMMETRISED BUT',4X,'ECIS-076'/17X,'THIS DO NOT COINPA-076
     7RRECT THE LACK OF SYMMETRY OF THE',8X,'ECIS-077'/17X,'INTERACTION INPA-077
     8BETWEEN PARTICLE AND TARGET.',15X,'ECIS-078'/6X,'19- LO(19) DEFORMINPA-078
     9ED COULOMB SPIN-ORBIT POTENTIAL. IF .TRUE.,',6X,'ECIS-079'/17X,'LOINPA-079
     A(11) IS SET .TRUE.. WITH LO(7)=.FALSE., IT IS SET',4X,'ECIS-080'/1INPA-080
     B7X,'.FALSE. BY THE CODE AS FOR LO(13). (NEEDS LO(13)=.TRUE.ECIS-08INPA-081
     C1'/17X,'WITH A REAL SPIN-ORBIT POTENTIAL, EVEN VERY SMALL)',5X,'ECINPA-082
     DIS-082'/6X,'20- LO(20) ENERGY DEPENDENCE OF TRANSITION FORM-FACTORINPA-083
     ES WHEN',6X,'ECIS-083'/17X,'LO(10)=.TRUE. . THIS DEPENDENCE IS THE INPA-084
     FARITHMETIC MEAN ECIS-084'/17X,'VALUE OF THE DEPENDENCE OF THE LEVEINPA-085
     GLS BETWEEN WHICH',4X,'ECIS-085'/17X,'THE TRANSITION FORM-FACTOR OCINPA-086
     HCURS. IT CANNOT BE USED   ECIS-086'/17X,'WITH LO(12)=.FALSE. .',34INPA-087
     IX,'ECIS-087'/'  NOTE:  IN THE ROTATIONAL MODELS, THE OPTICAL POTENINPA-088
     JTIALS (FOR ELASTIC  ECIS-088'/'  ****  SCATTERING) ARE ALWAYS DEFOINPA-089
     KRMED. TO AVOID THIS, WHEN LO(11),',4X,'ECIS-089')                 INPA-090
      WRITE (MW,1004)                                                   INPA-091
 1004 FORMAT (8X,'LO(12),LO(13),LO(14) OR LO(19) IS .FALSE., USE LO(5)=.INPA-092
     1TRUE.',5X,'ECIS-090'/8X,'AND ENTER 0. FOR THE CORRESPONDING DEFORMINPA-093
     2ATIONS.',16X,'ECIS-091'/8X,'IF LO(14)=.TRUE., LO(13) IS SET .TRUE.INPA-094
     3; IF LO(19)=.TRUE.,',7X,'ECIS-092'/8X,'LO(11) IS SET .TRUE.; THIS INPA-095
     4CAN BE AVOIDED WITH LO(5)=.TRUE.',5X,'ECIS-093'/72X,'ECIS-094'/' IINPA-096
     5NTEGRATION',60X,'ECIS-095'/6X,'21- LO(21) USUAL COUPLED EQUATIONS-INPA-097
     6(INVERSE: ITERATIONS).',9X,'ECIS-096'/17X,'NOT ALLOWED WITH DIRAC INPA-098
     7EQUATION. WHEN IT IS USED WITH  ECIS-097'/17X,'DEFORMED SPIN-ORBITINPA-099
     8, THE DERIVATIVE TERMS ARE NOT TAKENECIS-098'/17X,'INTO ACCOUNT ANINPA-100
     9D THE COMPUTATION IS INCORRECT.',9X,'ECIS-099'/6X,'22- LO(22) NO UINPA-101
     ASE OF PADE APPROXIMANTS FOR CONVERGENCE OF THE',5X,'ECIS-100'/17X,INPA-102
     B'ITERATIONS.',44X,'ECIS-101'/6X,'23- LO(23) NO USE OF PADE APPROXIINPA-103
     CMANT RESULTS AND SHIFT TO USUAL  ECIS-102'/17X,'COUPLED EQUATIONS INPA-104
     DWHEN CONVERGENCE IS NOT OBTAINED.',4X,'ECIS-103'/6X,'24- LO(24) COINPA-105
     EMPUTATION OF COUPLING POTENTIALS AT EACH ITERATION.  ECIS-104'/17XINPA-106
     F,'(SAVES SPACE BUT LOSES TIME, CHIEFLY IN ROTATIONAL',5X,'ECIS-105INPA-107
     G'/17X,'MODEL).',48X,'ECIS-106'/6X,'25- LO(25) COMPLETE CALCULATIONINPA-108
     H UP TO THE END-(INVERSE: ONE',7X,'ECIS-107'/17X,'ITERATION ONLY ASINPA-109
     I SOON AS TWO ITERATIONS ARE ENOUGH).  ECIS-108'/6X,'26- LO(26) STAINPA-110
     JBILISATION OF INTEGRATION FOR LONG RANGE CONSTANT   ECIS-109'/17X,INPA-111
     K'POTENTIALS. AN ADDITIONAL TERM IN H**6 IS INTRODUCED INECIS-110')INPA-112
      WRITE (MW,1005)                                                   INPA-113
 1005 FORMAT (17X,'THE TRUNCATION IN SUCH A WAY THAT THE TERM IN H**6 OFINPA-114
     1  ECIS-111'/17X,'THE TOTAL TRUNCATION ERROR CANCELS OUT FOR A CONSINPA-115
     2TANT  ECIS-112'/17X,'POTENTIAL. THIS TERM IS -H**6*V**3/240 FOR NUINPA-116
     3MEROV''S   ECIS-113'/17X,'METHOD AND +H**6*V**3/360 FOR MODIFIED NINPA-117
     4UMEROV''S METHODECIS-114'/17X,'WITH THE REAL POTENTIAL V.',29X,'ECINPA-118
     5IS-115'/6X,'27- LO(27) NUMEROV''S METHOD FOR SINGLE EQUATIONS-(INVINPA-119
     6ERSE:',8X,'ECIS-116'/17X,'MODIFIED NUMEROV''S METHOD). FOR SINGLE INPA-120
     7EQUATION AND',4X,'ECIS-117'/17X,'CONSTANT POTENTIAL, TRUNCATION ERINPA-121
     8RORS ARE OF OPPOSITE  ECIS-118'/17X,'SIGN.',50X,'ECIS-119'/6X,'28-INPA-122
     9 LO(28) COMPUTATION UP TO J-CONVERGENCE-(INVERSE: STOP WHEN ALLECIINPA-123
     AS-120'/17X,'THE INHOMOGENEOUS TERMS ARE NEGLIGIBLE). FOR ELASTIC  INPA-124
     B ECIS-121'/17X,'SCATTERING (ONLY ONE CHANNEL) LO(21) OR LO(28) MUSINPA-125
     CT BE ECIS-122'/17X,'.TRUE.. IN THIS CASE LO(28) IS SET .TRUE. BY TINPA-126
     DHE CODE. ECIS-123'/''/6X,'29- LO(29) NO DIAGONAL TERMS IN SECOND INPA-127
     EMEMBERS FOR ITERATIONS OF  ECIS-124'/17X,'SCHROEDINGER EQUATIONS. INPA-128
     F(INVERSE: ALL COUPLINGS ARE IN ECIS-125'/17X,'SECOND MEMBERS. THE INPA-129
     GUNCOUPLED SOLUTIONS DO NOT DEPEND  ECIS-126'/17X,'ON THE CHANNEL SINPA-130
     HPIN BUT CONVERGENCE CAN BE SLOWER IN   ECIS-127'/17X,'SOME PROBLEMINPA-131
     IS. NO EFFECT IN FIRST ORDER VIBRATIONAL',4X,'ECIS-128'/17X,'MODEL,INPA-132
     J NO USE IN DIRAC EQUATIONS: IF LO(100)=.TRUE.,   ECIS-129'/17X,'LOINPA-133
     K(29) IS SET .FALSE.). FOR CONVENIENCE, LO(29) IS SET ECIS-130')   INPA-134
      WRITE (MW,1006)                                                   INPA-135
 1006 FORMAT (17X,'.FALSE. IF LO(18)=.TRUE. .',29X,'ECIS-131'/6X,'30- LOINPA-136
     1(30) PURE DWBA CALCULATION.',33X,'ECIS-132'/72X,'ECIS-133'/' SEARCINPA-137
     2H',65X,'ECIS-134'/6X,'31- LO(31) INPUT OF EXPERIMENTAL DATA AND CAINPA-138
     3LCULATION OF A CHI2.  ECIS-135'/17X,'IT IS SET .FALSE. IF NO EXPERINPA-139
     4IMENTAL DATA ARE READ.',4X,'ECIS-136'/6X,'32- LO(32) AUTOMATIC SEAINPA-140
     5RCH ON SOME PARAMETERS. IT IS SET .FALSE. ECIS-137'/17X,'IF NO PARINPA-141
     6AMETERS ARE IN SEARCH.',24X,'ECIS-138'/6X,'33- LO(33) SYMMETRISED INPA-142
     7CHI2 FOR CROSS-SECTIONS WITH FIXED',9X,'ECIS-139'/17X,'NORMALISATIINPA-143
     8ON-(INVERSE: USUAL CHI2). THE CHI2',10X,'ECIS-140'/17X,'CONTRIBUTIINPA-144
     9ON IS MULTIPLIED BY THE RATIO OF',13X,'ECIS-141'/17X,'EXPERIMENTALINPA-145
     A TO CALCULATED VALUE.',22X,'ECIS-142'/6X,'34- LO(34) NEXT CALCULATINPA-146
     BION CHANGING ONLY ENERGY AND SOME OPTICAL ECIS-143'/17X,'PARAMETERINPA-147
     CS.',44X,'ECIS-144'/6X,'35- LO(35) SEARCH SAVED ON TAPE 8 IF CORRECINPA-148
     DTLY ENDED OR STOPPED BYECIS-145'/17X,'THE NUMBER OF EVALUATIONS.',INPA-149
     E29X,'ECIS-146'/6X,'36- LO(36) RESTART A SEARCH FROM TAPE 8.',26X,'INPA-150
     FECIS-147'/72X,'ECIS-148'/' LONG RANGE INTERACTION',49X,'ECIS-149'/INPA-151
     G6X,'41- LO(41) FACTORISATION OF 1/(1-COS(THETA)) IN THE AMPLITUDESINPA-152
     H. ITECIS-150'/17X,'IS NEEDED FOR DIRAC EQUATION OR WITH SPIN-ORBITINPA-153
     I COULOMBECIS-151'/17X,'POTENTIAL.',45X,'ECIS-152'/6X,'42- LO(42) SINPA-154
     JCHMIDT''S ORTHOGONALISATION OF SOLUTIONS IN USUAL',6X,'ECIS-153'/1INPA-155
     K7X,'COUPLED EQUATIONS.',37X,'ECIS-154')                           INPA-156
      WRITE (MW,1007)                                                   INPA-157
 1007 FORMAT (6X,'43- LO(43) INTERPOLATION ON TOTAL SPIN.',27X,'ECIS-155INPA-158
     1'/6X,'44- LO(44) COULOMB CORRECTIONS. LO(44) IS SET .FALSE. IF LO(INPA-159
     211) ISECIS-156'/17X,'.FALSE. . OUTSIDE THE DIRAC FORMALISM IT IS BINPA-160
     3ETTER TO  ECIS-157'/17X,'USE ALSO LO(29)=.TRUE..',32X,'ECIS-158'/6INPA-161
     4X,'45- LO(45) LIMITATION ON THE ANGULAR MOMENTA FOR COULOMB',10X,'INPA-162
     5ECIS-159'/17X,'CORRECTIONS. DEFAULT VALUES ARE 3 FOR CENTRAL TERM'INPA-163
     6,5X,'ECIS-160'/17X,'AND 2 FOR SPIN-ORBIT TERM. MAXIMUM VALUES ARE'INPA-164
     7,10X,'ECIS-161'/17X,'RESPECTIVELY 5 AND 4.',34X,'ECIS-162'/6X,'46-INPA-165
     8 LO(46) RESTRICTED COULOMB CORRECTIONS. (SAVES STORAGE).',7X,'ECISINPA-166
     9-163'/17X,'IF LO(44)=.FALSE. THE DIAGONAL CORRECTIONS USED IN',5X,INPA-167
     A'ECIS-164'/17X,'DIRAC FORMALISM OR FOR THE COULOMB SPIN-ORBIT ARE'INPA-168
     B,6X,'ECIS-165'/17X,'SUPPRESSED. IF LO(44)=.TRUE. INDICATIONS FOR TINPA-169
     CHESE',5X,'ECIS-166'/17X,'RESTRICTIONS BETWEEN CHANNELS WILL BE REAINPA-170
     DD.',12X,'ECIS-167'/6X,'47- LO(47) NO RECOIL CORRECTION FOR BOUND SINPA-171
     ETATES.',17X,'ECIS-168'/'  NOTE:  IF LO(36)=.TRUE. A SEARCH SAVED OINPA-172
     FN TAPE 8 IS RESTARTED;',8X,'ECIS-169'/'  ****  NO OTHER LOGICAL COINPA-173
     GNTROL FROM THIS CARD IS TAKEN INTO ACCOUNT.  ECIS-170'/8X,'INSTEADINPA-174
     H OF THE FOLLOWING CARDS, GO TO "RESTART INPUT: CARDS',5X,'ECIS-171INPA-175
     I'/8X,'READ IN SUBROUTINE REST".',39X,'ECIS-172'/72X,'ECIS-173'/'CAINPA-176
     JRD 3',34X,'FORMAT (50L1)',19X,'ECIS-174'/'******',66X,'ECIS-175') INPA-177
      WRITE (MW,1008)                                                   INPA-178
 1008 FORMAT (6X,'LOGICAL CONTROLS FROM 51 TO 100 (AS FOR PREVIOUS CARD)INPA-179
     1.',11X,'ECIS-176'/72X,'ECIS-177'/' PRINTING IN COMPLETE OUTPUT',44INPA-180
     2X,'ECIS-178'/7X,'1- LO(51) OUTPUT OF POTENTIALS.',34X,'ECIS-179'/7INPA-181
     3X,'2- LO(52) OUTPUT OF REDUCED NUCLEAR MATRIX ELEMENTS.',13X,'ECISINPA-182
     4-180'/7X,'3- LO(53) OUTPUT OF THE NUMBER OF ITERATIONS.',20X,'ECISINPA-183
     5-181'/7X,'4- LO(54) OUTPUT OF THE LENGTH USED IN THE WORKING FIELDINPA-184
     6.',8X,'ECIS-182'/7X,'5- LO(55) OUTPUT OF C-MATRIX ELEMENTS AND OF INPA-185
     7COMPOUND NUCLEUS',4X,'ECIS-183'/17X,'INTERMEDIATE RESULTS.',34X,'EINPA-186
     8CIS-184'/7X,'6- LO(56) OUTPUT OF S-MATRIX ELEMENTS.',27X,'ECIS-185INPA-187
     9'/7X,'7- LO(57) OUTPUT OF PHASE-SHIFTS AT EACH E.C.I.S. ITERATION.INPA-188
     A',5X,'ECIS-186'/7X,'8- LO(58) OUTPUT OF THE COEFFICIENTS OF EACH FINPA-189
     BORM FACTOR FOR ALL ECIS-187'/17X,'SETS OF EQUATIONS.',37X,'ECIS-18INPA-190
     C8'/'  NOTE:  IN A SEARCH, LO(51) TO LO(58) ARE USED FOR THE COMPLEINPA-191
     DTE RESULTSECIS-189'/'  ****  (AT THE FIRST CALCULATION IF LO(75)=.INPA-192
     EFALSE. AND ALWAYS AT THE   ECIS-190'/8X,'END OF THE SEARCH).',45X,INPA-193
     F'ECIS-191'/72X,'ECIS-192'/' PUNCH AND RESULTS IN LAST OUTPUT',39X,INPA-194
     G'ECIS-193'/7X,'9- LO(59) TOTAL CROSS SECTION, TOTAL REACTION CROSSINPA-195
     H SECTION',6X,'ECIS-194'/17X,'(INCLUDING COMPOUND ELASTIC), TOTAL SINPA-196
     IUM OF COMPOUND',4X,'ECIS-195'/17X,'CONTRIBUTIONS AND TOTAL ELASTICINPA-197
     J CROSS SECTION WRITTEN  ECIS-196'/17X,'ON FILE 58 IF THEY ARE DEFIINPA-198
     KNED.',24X,'ECIS-197')                                             INPA-199
      WRITE (MW,1009)                                                   INPA-200
 1009 FORMAT (17X,'INELASTIC CROSS-SECTIONS WRITTEN ON FILE 59.',11X,'ECINPA-201
     1IS-198'/6X,'10- LO(60) S-MATRIX ELEMENTS WRITTEN ON FILE 60.',18X,INPA-202
     2'ECIS-199'/6X,'11- LO(61) REDUCED NUCLEAR MATRIX ELEMENTS WRITTEN INPA-203
     3ON FILE 61.',4X,'ECIS-200'/6X,'12- LO(62) POTENTIALS WRITTEN ON FIINPA-204
     4LE 62.',25X,'ECIS-201'/6X,'13- LO(63) PENETRABILITIES WRITTEN ON FINPA-205
     5ILE 63. WITH ITERATIONS,   ECIS-202'/17X,'THE CODE COMPUTES ALL THINPA-206
     6E SOLUTIONS.',19X,'ECIS-203'/6X,'14- LO(64) RESULTS FOR EXPERIMENTINPA-207
     7AL DATA WRITTEN ON FILE 64',7X,'ECIS-204'/17X,'AND AT EQUIDISTANT INPA-208
     8ANGLES WRITTEN ON FILE 66.',10X,'ECIS-205'/6X,'15- LO(65) COEFFICIINPA-209
     9ENTS OF THE EXPANSION IN LEGENDRE POLYNOMIALS  ECIS-206'/17X,'WRITINPA-210
     ATEN ON FILE 65.',36X,'ECIS-207'/'  NOTE:  IN A SEARCH, LO(59) TO LINPA-211
     BO(65) ARE USED ONLY IN THE LAST RESULT.ECIS-208'/'  ****  THERE ARINPA-212
     CE INTRODUCED FOR NEUTRON SCATTERING, IN PECULIAR, ON THEECIS-209'/INPA-213
     D8X,'SUGGESTION OF E. BAUGE, R. CAPOTE AND A. KONING. FOR EACH RUN,INPA-214
     E  ECIS-210'/8X,'THE FIRST LINE (FORMAT A10,F10.2,1P,D20.8,0P,F10.2INPA-215
     F,2I5) WITH THEECIS-211'/4X,'1-10  IDENTIFICATION <CROSS-S.>, <INE.INPA-216
     GC.S.>, <S-MATRIX>, <RED.MAT.>,ECIS-212'/10X,'<POTENTI.>, <TLJ',5X,INPA-217
     H'>, <EXP.DAT.>, <LEGENDRE>, <ANG.DIS.> FORECIS-213'/10X,'FILES 58 INPA-218
     ITO 66.',47X,'ECIS-214'/3X,'11-20 THE MASS OF THE INCIDENT PARTICLEINPA-219
     J.',29X,'ECIS-215'/3X,'21-40 THE ENERGY IN THE LABORATORY SYSTEM.',INPA-220
     K27X,'ECIS-216'/3X,'41-50 THE MASS OF THE TARGET.',40X,'ECIS-217') INPA-221
      WRITE (MW,1010)                                                   INPA-222
 1010 FORMAT (3X,'51-55 THE PRODUCT OF CHARGES.',40X,'ECIS-218'/3X,'56-6INPA-223
     10 THE NUMBER OF LINES OR THE NUMBER OF SUBSETS WHICH ARE HEADED  EINPA-224
     2CIS-219'/9X,'BY SOME INDICATIONS INCLUDING THEIR OWN NUMBER OF LININPA-225
     3ES, EXCEPTECIS-220'/9X,'FOR 61 AND 62. FOR 61, IT IS THE NUMBER OFINPA-226
     4 COUPLED STATES AND  ECIS-221'/9X,'THE REMAINING OF THE OUTPUT CANINPA-227
     5 BE USED BY THE PROGRAM.',8X,'ECIS-222'/9X,'FOR 62, IT IS THE NUMBINPA-228
     6ER OF FORM-FACTORS AND THE REMAINING OF  ECIS-223'/9X,'THE OUTPUT INPA-229
     7CAN ALSO BE USED BY THE PROGRAM, REPLACING THE',6X,'ECIS-224'/9X,'INPA-230
     8IDENTIFICATIONS BY THE SUITABLE INPUT.',25X,'ECIS-225'/72X,'ECIS-2INPA-231
     926'/' PRINTING IN THE LAST RESULT',44X,'ECIS-227'/6X,'16- LO(66) NINPA-232
     AO CALCULATION AT EQUIDISTANT ANGLES.',18X,'ECIS-228'/6X,'17- LO(67INPA-233
     B) NO PLOT OF EXPERIMENTAL DATA.',26X,'ECIS-229'/6X,'18- LO(68) NO INPA-234
     CPLOT OF CROSS-SECTIONS AT EQUIDISTANT ANGLES.',7X,'ECIS-230'/6X,'1INPA-235
     D9- LO(69) NO PLOT OF POLARISATIONS AT EQUIDISTANT ANGLES.',8X,'ECIINPA-236
     ES-231'/72X,'ECIS-232'/' PRINTING AT THE BEGINNING AND IN A SEARCH'INPA-237
     F,30X,'ECIS-233'/6X,'21- LO(71) NO DETAILED OUTPUT OF LOGICAL CONTRINPA-238
     GOLS.',16X,'ECIS-234'/6X,'22- LO(72) NO OUTPUT OF EXPERIMENTAL DATAINPA-239
     H WHEN THEY ARE READ.',5X,'ECIS-235'/6X,'23- LO(73) NO OUTPUT OF EXINPA-240
     ITERNAL POTENTIALS WHEN THEY ARE READ.   ECIS-236'/6X,'24- LO(74) OINPA-241
     JUTPUT OF TIME IN DIFFERENT STEPS OF COMPUTATION.',6X,'ECIS-237')  INPA-242
      WRITE (MW,1011)                                                   INPA-243
 1011 FORMAT (6X,'25- LO(75) NO COMPLETE OUTPUT AT THE FIRST RUN OF A SEINPA-244
     1ARCH.',7X,'ECIS-238'/6X,'26- LO(76) LO(51) TO LO(65) ARE ALWAYS USINPA-245
     2ED-(INVERSE: ONLY FOR',4X,'ECIS-239'/17X,'COMPLETE OUTPUT).',38X,'INPA-246
     3ECIS-240'/6X,'27- LO(77) OUTPUT OF TIME DIFFERENCES DURING THE SEAINPA-247
     4RCH.',10X,'ECIS-241'/6X,'28- LO(78) NO OUTPUT OF DIFFERENCES BETWEINPA-248
     5EN EXPERIMENTAL AND',6X,'ECIS-242'/17X,'CALCULATED VALUES.',37X,'EINPA-249
     6CIS-243'/72X,'ECIS-244'/' COMPOUND NUCLEUS',55X,'ECIS-245'/6X,'31-INPA-250
     7 LO(81) HAUSER-FESHBACH CORRECTIONS TO CROSS-SECTIONS.',9X,'ECIS-2INPA-251
     846'/17X,'WITH ITERATIONS, THE CODE COMPUTES ALL THE SOLUTIONS.  ECINPA-252
     9IS-247'/17X,'IF LO(82), LO(84), LO(85) OR LO(86) IS .TRUE., LO(81)INPA-253
     A  ECIS-248'/17X,'IS SET .TRUE..',41X,'ECIS-249'/''/6X,'32- LO(82)INPA-254
     B OLD SIMPLIFIED COMPOUND NUCLEUS (EXCLUDES UNCOUPLED',4X,'ECIS-250INPA-255
     C'/17X,'STATES, FISSION AND GAMMAS; LO(84), LO(85), LO(86) ARE ECISINPA-256
     D-251'/17X,'SET .FALSE.).',42X,'ECIS-252'/6X,'33- LO(83) NO ENGELBRINPA-257
     EETCH-WEIDENMULLER TRANSFORMATION IN COMPOUND ECIS-253'/17X,'NUCLEUINPA-258
     FS.',47X,'ECIS-254'/6X,'34- LO(84) UNCOUPLED LEVELS FOR COMPOUND NUINPA-259
     GCLEUS. IT IS SET',7X,'ECIS-255'/17X,'.FALSE. IF NONE ARE READ.',30INPA-260
     HX,'ECIS-256'/6X,'35- LO(85) FISSION TRANSMISSION COEFFICIENTS (TO INPA-261
     IBE READ FROM',5X,'ECIS-257'/17X,'CARDS) FOR COMPOUND NUCLEUS. IT IINPA-262
     JS SET .FALSE. IF NONE ECIS-258'/17X,'ARE READ.',46X,'ECIS-259'/6X,INPA-263
     K'36- LO(86) GAMMA EMISSION IN COMPOUND NUCLEUS.',20X,'ECIS-260')  INPA-264
      WRITE (MW,1012)                                                   INPA-265
 1012 FORMAT (6X,'37- LO(87) NO WIDTH FLUCTUATIONS.',33X,'ECIS-261'/72X,INPA-266
     1'ECIS-262'/' MISCELLANEOUS',58X,'ECIS-263'/6X,'41- LO(91) ANGULAR INPA-267
     2DISTRIBUTION AT EQUIDISTANT ANGLES IN THE',6X,'ECIS-264'/17X,'LABOINPA-268
     3RATORY SYSTEM.',37X,'ECIS-265'/6X,'42- LO(92) NON STANDARD OBSERVAINPA-269
     4BLES AT EQUIDISTANT ANGLES.',8X,'ECIS-266'/6X,'43- LO(93) NO RECOIINPA-270
     5L CORRECTION FOR REACTIONS WITH SMALL',10X,'ECIS-267'/17X,'DIFFEREINPA-271
     6NCES (LESS THAN .5) OF TARGET MASSES.',11X,'ECIS-268'/6X,'44- LO(9INPA-272
     74) NON RELATIVISTIC "REDUCED MASS" FOR DIRAC EQUATION.',4X,'ECIS-2INPA-273
     869'/6X,'45- LO(95) "REDUCED ENERGY" FOR NON COULOMB INTERACTION ININPA-274
     9',8X,'ECIS-270'/17X,'RELATIVISTIC SCHROEDINGER EQUATION OR USE OF INPA-275
     AREST MASS ECIS-271'/17X,'IN DIRAC EQUATION (EXCLUDE LO(94)=.TRUE.)INPA-276
     B.',13X,'ECIS-272'/6X,'46- LO(96) "REDUCED MASS" FOR COULOMB INTERAINPA-277
     CCTION IN RELATIVISTIC ECIS-273'/17X,'SCHROEDINGER EQUATION.',33X,'INPA-278
     DECIS-274'/6X,'47- LO(97) SAME REDUCED MASS FOR ALL THE STATES WITHINPA-279
     E SMALL',8X,'ECIS-275'/17X,'DIFFERENCES (LESS THAN .5) OF TARGET MAINPA-280
     FSSES.',11X,'ECIS-276'/6X,'48- LO(98) Q ADDED TO THE MASS OF RESIDUINPA-281
     GAL NUCLEUS OR OUTGOING',4X,'ECIS-277'/17X,'PARTICLE. Q CAN BE TAKEINPA-282
     HN INTO ACCOUNT ONLY IF',10X,'ECIS-278'/17X,'LO(8)=.TRUE. FOR RELATINPA-283
     IIVISTIC KINEMATICS. NOT TO BE',4X,'ECIS-279'/17X,'USED IF THIS EFFINPA-284
     JECT IS INCLUDED IN THE MASSES WHEN',5X,'ECIS-280'/17X,'THEY ARE REINPA-285
     KAD.',41X,'ECIS-281')                                              INPA-286
      WRITE (MW,1013)                                                   INPA-287
 1013 FORMAT (6X,'49- LO(99) SCHROEDINGER EQUIVALENT TO DIRAC EQUATION.'INPA-288
     1,13X,'ECIS-282'/17X,'DIFFUSENESS OF COULOMB POTENTIALS MUST BE 0 AINPA-289
     2ND THEY   ECIS-283'/17X,'CANNOT BE DEFORMED. DIFFUSENESS ARE SET TINPA-290
     3O 0.',10X,'ECIS-284'/17X,'NO ASYMMETRIC ROTATIONAL MODEL AND NO SEINPA-291
     4COND ORDER',5X,'ECIS-285'/17X,'VIBRATIONAL MODEL: THE CORRESPONDININPA-292
     5G LOGICALS ARE SET  ECIS-286'/17X,'.FALSE. AS ARE ALSO LO(11) AND INPA-293
     6LO(19).',17X,'ECIS-287'/6X,'50- LO(100) COMPLETE DIRAC EQUATION.',INPA-294
     730X,'ECIS-288'/'  NOTE:  IF LO(99)=.TRUE. OR LO(100)=.TRUE., LO(8)INPA-295
     8 IS SET .TRUE.; THE   ECIS-289'/'  ****  WITH RELATIVISTIC KINEMATINPA-296
     9ICS (LO(8)=.TRUE.), THE "REDUCED MASS" ECIS-290'/8X,'AND THE "REDUINPA-297
     ACED ENERGY" ARE THE PRODUCT OF MASSES OR ENERGIES  ECIS-291'/8X,'DINPA-298
     BIVIDED BY THE TOTAL ENERGY IN THE CENTRE OF MASS.',14X,'ECIS-292'/INPA-299
     C72X,'ECIS-293'/'CARD 4',34X,'FORMAT (14I5)',19X,'ECIS-294'/'******INPA-300
     D',66X,'ECIS-295'/7X,'1- 5   NCOLL  NUMBER OF NUCLEAR STATES. IT DOINPA-301
     EES NOT INCLUDE THE  ECIS-296'/21X,'NUMBER OF UNCOUPLED STATES FOR INPA-302
     FCOMPOUND NUCLEUS.   ECIS-297'/7X,'6-10   NJMAX  MAXIMUM NUMBER OF INPA-303
     GCHANNEL SPIN. (DEFAULT VALUE 20) ECIS-298'/21X,'THE MAXIMUM VALUE INPA-304
     HOF THE TOTAL ANGULAR MOMENTUM J  ECIS-299'/21X,'WILL BE NJMAX-1 WHINPA-305
     IEN IT IS INTEGER OR NJMAX-.5 WHENECIS-300'/21X,'IT IS HALF-INTEGERINPA-306
     J.',32X,'ECIS-301'/6X,'11-15   ITERM  MAXIMUM NUMBER OF ECIS ITERATINPA-307
     KIONS. (DEFAULT VALUE  ECIS-302')                                  INPA-308
      WRITE (MW,1014)                                                   INPA-309
 1014 FORMAT (21X,'20). MUST BE 1 FOR DWBA CALCULATIONS.',14X,'ECIS-303'INPA-310
     1/21X,'IF LO(21)=LO(42)=.TRUE., PERODICITY OF SCHMIDT''S   ECIS-304INPA-311
     2'/21X,'ORTHOGONALISATION IN USUAL COUPLED EQUATIONS.',6X,'ECIS-305INPA-312
     3'/6X,'16-20   NPP',4X,'NUMBER OF OPTICAL POTENTIALS. (DEFAULT VALUINPA-313
     4E 1).   ECIS-306'/21X,'ONLY THE FIRST ONE IS DEFORMED WHEN THE FORINPA-314
     5M',7X,'ECIS-307'/21X,'FACTORS ARE NOT READ ON CARDS.',21X,'ECIS-30INPA-315
     68'/6X,'21-25   NCJ',4X,'NUMBER OF FACTORISATIONS OF 1/(1-COS(THETAINPA-316
     7)) IN',4X,'ECIS-309'/21X,'THE AMPLITUDES. (DEFAULT VALUE 1).',17X,INPA-317
     8'ECIS-310'/''/6X,'26-30   NGR(1) NUMBER OF DECADES IN LOGARITHMICINPA-318
     9 SCALE IN PLOTS OF ECIS-311'/21X,'ELASTIC CROSS-SECTIONS IN THE STINPA-319
     AANDARD OPTION',6X,'ECIS-312'/21X,'(DEFAULT VALUE 2). FOR CHARGED PINPA-320
     BARTICLES, THE',6X,'ECIS-313'/21X,'CROSS-SECTION DIVIDED BY RUTHERFINPA-321
     CORD''S CROSS-SECTIONECIS-314'/21X,'IS PLOTTED.',40X,'ECIS-315'/6X,INPA-322
     D'31-35   NGR(2) AS NGR(1),FOR INELASTIC CHANNELS.(DEFAULT VALUE 2)INPA-323
     E ECIS-316'/6X,'36-40   NPR(1) PLOT INDICATIONS FOR ELASTIC POLARISINPA-324
     FATIONS AT',6X,'ECIS-317'/21X,'EQUIDISTANT ANGLES. IF THERE ARE N DINPA-325
     GIFFERENT',7X,'ECIS-318'/21X,'ANGULAR DISTRIBUTIONS OF POLARISATIONINPA-326
     HS, NPR(1) IS  ECIS-319'/21X,'THE SUM FOR I=1 TO N OF K(I)*(2**(I-1INPA-327
     I)) WHERE',6X,'ECIS-320'/21X,'K(I)=1 FOR A PLOT AND 0 FOR NO PLOT OINPA-328
     JF THE I-TH',4X,'ECIS-321'/21X,'DISTRIBUTION.(DEFAULT VALUE 1)',21XINPA-329
     K,'ECIS-322')                                                      INPA-330
      WRITE (MW,1015)                                                   INPA-331
 1015 FORMAT (17X,'STANDARD OPTIONS: SPIN 0 - NO POLARISATION.',12X,'ECIINPA-332
     1S-323'/35X,'SPIN 1/2 - VECTOR POLARISATION.',6X,'ECIS-324'/35X,'SPINPA-333
     2IN >1/2 - IT11, T20, T21, T22.',5X,'ECIS-325'/6X,'41-45   NPR(2) AINPA-334
     3S NPR(1),FOR INELASTIC CHANNELS.(DEFAULT VALUE 1) ECIS-326'/17X,'SINPA-335
     4TANDARD OPTIONS: SPIN 0 - NO POLARISATION.',12X,'ECIS-327'/22X,'SPINPA-336
     5IN 1/2 - VECT. ANA. POWER, VECT. POL., SPIN-FLIPECIS-328'/22X,'SPIINPA-337
     6N >1/2 - IT11, VECT. POL., T20, T21, T22.',6X,'ECIS-329'/6X,'46-50INPA-338
     7   LMZ',4X,'NUMBER OF J VALUES FOR WHICH THE RADIAL EQUATIONS  ECIINPA-339
     8S-330'/21X,'ARE SOLVED WHEN COULOMB CORRECTIONS ARE USED. THIS ECIINPA-340
     9S-331'/21X,'NUMBER CAN BE AUTOMATICALLY DECREASED IF THE',7X,'ECISINPA-341
     A-332'/21X,'IRREGULAR FUNCTIONS ARE TOO LARGE. THE ASYMPTOTIC  ECISINPA-342
     B-333'/21X,'REGION WHERE THE PHASE-SHIFTS ARE COMPUTED',9X,'ECIS-33INPA-343
     C4'/21X,'ANALYTICALLY IS ABOVE THIS VALUE. THE BEST VALUE OFECIS-33INPA-344
     D5'/21X,'LMZ IS THE MAXIMUM VALUE OF J NEEDED BY THE SAME   ECIS-33INPA-345
     E6'/21X,'COMPUTATION WITHOUT CHARGE AND WITHOUT ANOMALOUS   ECIS-33INPA-346
     F7'/21X,'MAGNETIC MOMENT. (DEFAULT VALUE NJMAX/2, BUT ENTER ECIS-33INPA-347
     G8'/21X,'A NEGATIVE VALUE IF YOU WANT TO USE NJMAX).',8X,'ECIS-339'INPA-348
     H/6X,'51-55   JDM',4X,'TOTAL SPIN ABOVE WHICH STOP OR REDUCTION TO INPA-349
     IONE',4X,'ECIS-340'/21X,'ITERATION CAN OCCUR. (LIMITS LO(25),LO(28)INPA-350
     J=.FALSE.)ECIS-341'/21X,'NECESSARY FOR HEAVY-ION SCATTERING BECAUSEINPA-351
     K THE',5X,'ECIS-342')                                              INPA-352
      WRITE (MW,1016)                                                   INPA-353
 1016 FORMAT (21X,'CROSS-SECTION FOR SMALL TOTAL ANGULAR MOMENTA ARE  ECINPA-354
     1IS-343'/21X,'VERY SMALL.',40X,'ECIS-344'/6X,'56-60   LML',4X,'MAXIINPA-355
     2MUM ANGULAR MOMENTUM (DEFAULT VALUE MAXIMUM).  ECIS-345'/21X,'WITHINPA-356
     3OUT LONG RANGE INTERACTION, A LIMIT IS GIVEN   ECIS-346'/21X,'FOR INPA-357
     4EACH LEVEL SUCH THAT THE REGULAR COULOMB',7X,'ECIS-347'/21X,'FUNCTINPA-358
     5ION IS LARGER THAN 1.D-30 AT MATCHING RADIUS. ECIS-348'/6X,'61-65 INPA-359
     6  JIT',4X,'NUMBER OF RATES OF INTERPOLATION FOR TOTAL SPIN.   ECISINPA-360
     7-349'/21X,'(DEFAULT VALUE 1).',33X,'ECIS-350'/6X,'66-70   MN',5X,'INPA-361
     8MULTIPLICATIVE FACTOR FOR NJMAX READ IN COLUMNS',4X,'ECIS-351'/21XINPA-362
     9,'6-10 ALLOWING TO USE MORE THAN NJMAX>10**5.',8X,'ECIS-352'/21X,'INPA-363
     A(DEFAULT VALUE 1)',34X,'ECIS-353'/'  NOTE:  IF LO(93)=.TRUE. NGR AINPA-364
     BND NPR ARE NOT TAKEN INTO ACCOUNT IN',5X,'ECIS-354'/'  ****  COMPUINPA-365
     CTATIONS AT EQUIDISTANT ANGLES BECAUSE SUCH INDICATIONS WILLECIS-35INPA-366
     D5'/8X,'BE READ AGAIN IN SUBROUTINE DEPH, BUT NGR IS ALWAYS USED FOINPA-367
     ER',4X,'ECIS-356'/8X,'PLOTS OF EXPERIMENTAL CROSS-SECTIONS.',27X,'EINPA-368
     FCIS-357'/72X,'ECIS-358'/'CARD 5',34X,'FORMAT (7F10.5)',17X,'ECIS-3INPA-369
     G59'/'******',66X,'ECIS-360'/7X,'1-10   H',6X,'INTEGRATION STEP SIZINPA-370
     HE IN FERMIS. (DEFAULT VALUE',4X,'ECIS-361'/21X,'MIN(0.5/WAVE NUMBEINPA-371
     IR, 0.5*MIN(DIFFUSENESSES)),',6X,'ECIS-362'/21X,'WITHOUT THE DIFFUSINPA-372
     JENESSES IF LO(7)=.TRUE.).',8X,'ECIS-363'/6X,'11-20   RM',5X,'MATCHINPA-373
     KING RADIUS.(IF LO(7)=.TRUE. DEFAULT VALUE 20. ECIS-364')          INPA-374
      WRITE (MW,1017)                                                   INPA-375
 1017 FORMAT (21X,'IF LO(7)=.FALSE., FOR EACH NON ZERO POTENTIAL, THE ECINPA-376
     1IS-365'/21X,'RADIUS WHERE ITS ABSOLUTE VALUE IS (ACONV*ECM/WAVE ECINPA-377
     2IS-366'/21X,'NUMBER) IS COMPUTED AND RM IS THE LARGEST OF THEM. ECINPA-378
     3IS-367'/21X,'FOR COULOMB FORM FACTORS, RADIUS+10*DIFFUSENESS IS ECINPA-379
     4IS-368'/21X,'USED)',46X,'ECIS-369'/6X,'21-30   BJM',4X,'COEFFICIENINPA-380
     5T OF THE IMAGINARY POTENTIAL TO BE ADDED ECIS-370'/21X,'TO THE UNCINPA-381
     6OUPLED EQUATIONS AND REMOVED IN THE',6X,'ECIS-371'/''/21X,'SECONDINPA-382
     7 MEMBER TO ACCELERATE CONVERGENCE FOR',8X,'ECIS-372'/21X,'SCHROEDIINPA-383
     8NGER EQUATIONS.',28X,'ECIS-373'/6X,'31-40   EITER  CONVERGENCE CRIINPA-384
     9TERION FOR S-MATRIX IN THE ITERATIONECIS-374'/21X,'(DEFAULT VALUE INPA-385
     A1.D-5).',29X,'ECIS-375'/6X,'41-50   ACONV  VALUE BELOW WHICH FUNCTINPA-386
     BIONS AND POTENTIALS ARE',5X,'ECIS-376'/21X,'NEGLECTED IN ITERATIONINPA-387
     CS.(DEFAULT VALUE 1.D-5).',5X,'ECIS-377'/21X,'ACONV IS ALSO USED ININPA-388
     D THE DEFAULT VALUE OF RM.',5X,'ECIS-378'/6X,'51-60   CONJ   CONVERINPA-389
     EGENCE CRITERION FOR J VALUES.',16X,'ECIS-379'/21X,'(DEFAULT VALUE INPA-390
     F1.D-5).',29X,'ECIS-380'/72X,'ECIS-381'/'LIMITATION TO COULOMB CORRINPA-391
     GECTIONS',7X,'FORMAT (14I5)',19X,'ECIS-382'/'**********************INPA-392
     H***********',39X,'ECIS-383'/' IF LO(45) IS .TRUE., OTHERWISE GO TOINPA-393
     I "LEGENDRE EXPANSION DATA"',9X,'ECIS-384'/7X,'1- 5   MCM(1) MAXIMUINPA-394
     JM ANGULAR MOMENTUM FOR THE COMPUTATION OF',4X,'ECIS-385'/21X,'THE INPA-395
     KCORRECTIONS DUE TO THE COULOMB POTENTIAL.',6X,'ECIS-386')         INPA-396
      WRITE (MW,1018)                                                   INPA-397
 1018 FORMAT (21X,'(DEFAULT VALUE 3, VALUE LIMITED TO 5).',13X,'ECIS-387INPA-398
     1'/7X,'6-10   MCM(2) SAME FOR THE SPIN-ORBIT COULOMB POTENTIAL.',9XINPA-399
     2,'ECIS-388'/21X,'(DEFAULT VALUE 2, VALUE LIMITED TO 4).',13X,'ECISINPA-400
     3-389'/'  NOTE:  ENTER A NEGATIVE VALUE TO USE 0. A BLANK OR 0 IS RINPA-401
     4EPLACED BY   ECIS-390'/'  ****  THE DEFAULT VALUES DESCRIBED ABOVEINPA-402
     5.',29X,'ECIS-391'/72X,'ECIS-392'/'LEGENDRE EXPANSION DATA',17X,'FOINPA-403
     6RMAT (14I5)',19X,'ECIS-393'/'***********************',49X,'ECIS-39INPA-404
     74'/' IF LO(65) IS .TRUE., OTHERWISE GO TO "COMPOUND NUCLEUS DATA".INPA-405
     8',10X,'ECIS-395'/7X,'1- 5   NL(1)  POWER OF (1-COS(THETA)) FOR THEINPA-406
     9 EXPANSION IN',7X,'ECIS-396'/21X,'LEGENDRE POLYNOMIALS OF THE INTEINPA-407
     ARFERENCE BETWEEN   ECIS-397'/21X,'COULOMB AND NUCLEAR ELASTIC SCATINPA-408
     BTERING. POWER OF   ECIS-398'/21X,'(1-COS(THETA)**2) IF LO(18) IS .INPA-409
     CTRUE..',13X,'ECIS-399'/21X,'(DEFAULT VALUE 2).',33X,'ECIS-400'/7X,INPA-410
     D'6-10   NL(2)  NUMBER OF LEGENDRE POLYNOMIALS FOR ELASTIC',9X,'ECIINPA-411
     ES-401'/21X,'SCATTERING OF CHARGED PARTICLES. (DEFAULT VALUE',4X,'EINPA-412
     FCIS-402'/21X,'1.5 NUMBER OBTAINED WITHOUT COULOMB AMPLITUDE).',4X,INPA-413
     G'ECIS-403'/6X,'11-15   NL(3)  NUMBER OF LEGENDRE POLYNOMIALS FOR EINPA-414
     HLASTIC',9X,'ECIS-404'/21X,'SCATTERING OF UNCHARGED PARTICLES, INELINPA-415
     IASTIC',7X,'ECIS-405'/21X,'SCATTERING AND COMPOUND NUCLEUS. (DEFAULINPA-416
     JT VALUE',4X,'ECIS-406'/21X,'MAXIMUM NUMBER).',35X,'ECIS-407'/72X,'INPA-417
     KECIS-408')                                                        INPA-418
      WRITE (MW,1019)                                                   INPA-419
 1019 FORMAT ('COMPOUND NUCLEUS DATA',19X,'FORMAT (8I5,2F10.5)',13X,'ECIINPA-420
     1S-409'/'*********************',51X,'ECIS-410'/' IF LO(84) OR LO(85INPA-421
     2) OR LO(86) IS .TRUE., OTHERWISE GO TO',15X,'ECIS-411'/' "INTERPOLINPA-422
     3ATION ON TOTAL SPIN".',41X,'ECIS-412'/7X,'1- 5   NSP(1) NUMBER OF INPA-423
     4UNCOUPLED STATES AND CONTINUA. IF IT IS  ECIS-413'/21X,'ZERO, LO(8INPA-424
     54)=.FALSE.',31X,'ECIS-414'/7X,'6-10   NSP(2) NUMBER OF UNCOUPLED SINPA-425
     6TATES WITH ANGULAR',12X,'ECIS-415'/21X,'DISTRIBUTION. THEY MUST BEINPA-426
     7 THE FIRST GIVEN.',8X,'ECIS-416'/21X,'IT IS REPLACED BY MIN(NSP(1)INPA-427
     8,NSP(2)).',14X,'ECIS-417'/6X,'11-15   NFISS  NUMBER OF FISSION DATINPA-428
     9A. IF NFISS=0, LO(85)=.FALSE. ECIS-418'/6X,'16-20   NRD',4X,'NUMBEINPA-429
     AR OF GAMMA TRANSMISSION FACTORS. IF IT IS 0,  ECIS-419'/21X,'THESEINPA-430
     B COEFFICIENTS ARE COMPUTED.',19X,'ECIS-420'/6X,'21-25   NCONT  NUMINPA-431
     CBER OF CONTINUA. THEY MUST BE THE LAST GIVEN,   ECIS-421'/21X,'NO INPA-432
     DANGULAR DISTRIBUTION CAN BE REQUESTED FOR THEM. ECIS-422'/6X,'26-3INPA-433
     E0   NCOJ   NUMBER OF VALUES OF THE SPIN OF THE RESIDUAL',7X,'ECIS-INPA-434
     F423'/21X,'NUCLEUS FOR THE CONTINUA. (DEFAULT VALUE 30).',6X,'ECIS-INPA-435
     G424'/6X,'31-35   KMIN   MINIMUM NUMBER OF J VALUES FOR COMPOUND NUINPA-436
     HCLEUS',4X,'ECIS-425'/21X,'(DEFAULT VALUE: MINIMUM VALUE FOR S WAVEINPA-437
     IS IN',7X,'ECIS-426'/21X,'ENTRANCE CHANNEL).',33X,'ECIS-427'/6X,'36INPA-438
     J-40   KMAX   MAXIMUM NUMBER OF J VALUES FOR COMPOUND NUCLEUS',4X,'INPA-439
     KECIS-428'/21X,'(DEFAULT VALUE NJMAX).',29X,'ECIS-429')            INPA-440
      WRITE (MW,1020)                                                   INPA-441
 1020 FORMAT (6X,'41-50   ACN1   RATIO ENERGY/STEP FOR THE DISCRETISATIOINPA-442
     1N OF THE',4X,'ECIS-430'/21X,'CONTINUA AT LARGE ENERGY . (DEFAULT VINPA-443
     2ALUE 8.).',5X,'ECIS-431'/6X,'51-60   ACN2   NUMBER OF STEPS PER MEINPA-444
     3V FOR THE DISCRETISATION OF  ECIS-432'/21X,'THE CONTINUA AT LOW ENINPA-445
     4ERGY. (DEFAULT VALUE 8.).',4X,'ECIS-433'/''/'  NOTE:  THE SHIFT FINPA-446
     5ROM THE USE OF ACN1 TO ACN2 OCCURS BELOW THE ENERGY ECIS-434'/'  *INPA-447
     6***  ACN1/ACN2. BELOW THIS ENERGY, THE INTERVAL IS DIVIDED IN EQUAINPA-448
     7L  ECIS-435'/8X,'STEPS WITH A MINIMUM OF TWO STEPS. CALCULATIONS AINPA-449
     8RE DONE WITH   ECIS-436'/8X,'THE ENERGY OF THE MIDDLE OF THE STEP.INPA-450
     9',27X,'ECIS-437'/9X,'WITHOUT KMIN THE CALCULATION CAN STOP BEFORE INPA-451
     AANY SIGNIFICANT   ECIS-438'/8X,'RESULT. WITH INTERPOLATION ON TOTAINPA-452
     BL SPIN BELOW KMAX, A HUGE',5X,'ECIS-439'/8X,'STORAGE ARRAY, PROPORINPA-453
     CTIONAL TO KMAX, IS NEEDED FOR UNCOUPLED',4X,'ECIS-440'/8X,'STATES INPA-454
     DWITH ANGULAR DISTRIBUTION.',31X,'ECIS-441'/9X,'COMPOUND NUCLEUS CAINPA-455
     ELCULATION IS STOPPED AT THE J VALUE LARGER  ECIS-442'/8X,'THAN KMIINPA-456
     FN ONE FOR WHICH THE LARGEST COMPOUND NUCLEUS',12X,'ECIS-443'/8X,'CINPA-457
     GONTRIBUTION IS LESS THAN CONJ**2. THE CODE CANNOT DEAL WITH',4X,'EINPA-458
     HCIS-444'/8X,'VERY LARGE J VALUES.',44X,'ECIS-445'/72X,'ECIS-446'/'INPA-459
     IINTERPOLATION ON TOTAL SPIN',13X,'FORMAT (14I5)',19X,'ECIS-447'/'*INPA-460
     J**************************',45X,'ECIS-448'/' IF LO(43) IS .TRUE., INPA-461
     KOTHERWISE GO TO  "CARDS READ IN SUBROUTINE LECT". ECIS-449')      INPA-462
      WRITE (MW,1021)                                                   INPA-463
 1021 FORMAT (7X,'1- 5   LS(1)  FIRST LIMIT.',39X,'ECIS-450'/7X,'6-10   INPA-464
     1LD(1)  NUMBER OF VALUES SKIPPED.',26X,'ECIS-451'/6X,'11-15   LS(2)INPA-465
     2  SECOND LIMIT.',38X,'ECIS-452'/6X,'16-20   LD(2)  NUMBER OF VALUEINPA-466
     3S SKIPPED.',26X,'ECIS-453'/3X,'....................  UP TO LS(JIT)INPA-467
     4 AND LD(JIT)   ...................ECIS-454'/7X,'THE CALCULATION ISINPA-468
     5 STOPPED IF VALUES LS DECREASE. THE VALUES LD  ECIS-455'/' ARE CHAINPA-469
     6NGED TO BE USED CUMULATIVELY IN THE PROGRAM. IF LO(18)=.TRUE.,  ECINPA-470
     7IS-456'/' AND THE SPINS IN THE GROUND STATE ARE BOTH ZERO, THE VALINPA-471
     8UES LD READ AREECIS-457'/' MULTIPLIED BY 2.',55X,'ECIS-458'/72X,'EINPA-472
     9CIS-459'/72X,'ECIS-460'/'CARDS READ IN SUBROUTINE LECL',43X,'ECIS-INPA-473
     A461'/'*****************************',43X,'ECIS-462'/72X,'ECIS-463'INPA-474
     B/'FOR EACH NUCLEAR STATE:',49X,'ECIS-464'/'***********************INPA-475
     C',49X,'ECIS-465'/' BEGINNING WITH THE GROUND STATE AND INCLUDING UINPA-476
     DNCOUPLED STATES FOR',5X,'ECIS-466'/' COMPOUND NUCLEUS CALCULATION INPA-477
     EWHICH MUST BE AT THE END.',17X,'ECIS-467'/' THE BEST ORDER IS THE INPA-478
     FONE OF DECREASING COUPLING STRENGTH.',13X,'ECIS-468'/72X,'ECIS-469INPA-479
     G'/'NUCLEAR STATES -SPINS AND MASSES -',6X,'FORMAT (F5.2,2I2,A1,6F1INPA-480
     H0.5)',5X,'ECIS-470'/'***********************************',37X,'ECIINPA-481
     IS-471'/7X,'1- 5   SP2:   SPIN OF THE TARGET (2*SP2+1 KEPT IN IPI(3INPA-482
     J,I)).',5X,'ECIS-472'/7X,'6- 7   N:',5X,'FURTHER DESCRIPTION OF THEINPA-483
     K STATE.',18X,'ECIS-473')                                          INPA-484
      WRITE (MW,1022)                                                   INPA-485
 1022 FORMAT (21X,'IN THE ROTATIONAL MODEL, MUST BE NON-ZERO FOR THE  ECINPA-486
     1IS-474'/27X,'MEMBER OF A VIBRATIONAL BAND.',16X,'ECIS-475'/21X,'ININPA-487
     2 THE VIBRATIONAL MODEL, CAN BE NON-ZERO FOR THE  ECIS-476'/27X,'GRINPA-488
     3OUND STATE TO AVOID THE INPUT OF NEXT CARD.ECIS-477'/21X,'NOT USEDINPA-489
     4 IF LO(3)=.TRUE. (ANHARMONIC VIBRATIONAL   ECIS-478'/27X,'MODEL ORINPA-490
     5 ASYMMETRIC ROTATIONAL MODEL).',7X,'ECIS-479'/21X,'NOT USED IF LO(INPA-491
     67)=.TRUE. (EXTERNAL POTENTIALS).',4X,'ECIS-480'/21X,'NOT USED FOR INPA-492
     7UNCOUPLED STATES.',21X,'ECIS-481'/7X,'8- 9   K:',5X,'OPTICAL POTENINPA-493
     8TIAL. (DEFAULT VALUE,1 FOR GROUND',5X,'ECIS-482'/21X,'STATE AND SAINPA-494
     9ME AS LAST ONE FOR EXCITED STATE).',5X,'ECIS-483'/9X,'10   SPI:   INPA-495
     APARITY OF THE NUCLEAR STATE: "+" OR "-" BUT ONLY   ECIS-484'/21X,'INPA-496
     B"-" IS NEEDED ("+" FOR A BLANK OR ANY CHARACTER).  ECIS-485'/21X,'INPA-497
     CTHIS DATA IS KEPT AS 0 OR 1 IN IPI(1,I).',11X,'ECIS-486'/6X,'11-20INPA-498
     D   ENERGY OF THE PROJECTILE IN THE LABORATORY SYSTEM IN MEV  ECIS-INPA-499
     E487'/14X,'FOR THE GROUND STATE. EXCITATION ENERGY FOR THE OTHERS. INPA-500
     F  ECIS-488'/6X,'21-30   SP1: SPIN OF THE PARTICLE (2*SP1+1 KEPT ININPA-501
     G IPI(2,I)).',5X,'ECIS-489'/6X,'31-40   WV(1,I):   MASS OF THE PROJINPA-502
     HECTILE IN A.M.U.  .',12X,'ECIS-490'/19X,'IF THIS VALUE IS NOT ZEROINPA-503
     I FOR AN EXCITED STATE, THE  ECIS-491'/19X,'SPIN OF THE PROJECTILE,INPA-504
     J ITS MASS AND THE PRODUCT OF  ECIS-492'/19X,'CHARGES READ ON THIS INPA-505
     KCARD ARE TAKEN INTO ACCOUNT. IF ECIS-493')                        INPA-506
      WRITE (MW,1023)                                                   INPA-507
 1023 FORMAT (19X,'THIS MASS IS ZERO, VALUES OF SP1, SP3, WV(1,I) AND   INPA-508
     1ECIS-494'/19X,'WV(2,I) ARE TAKEN FROM THE PRECEDING LEVEL.',10X,'EINPA-509
     2CIS-495'/''/6X,'41-50   WV(2,I):   MASS OF THE TARGET IN A.M.U.  INPA-510
     3.',16X,'ECIS-496'/6X,'51-60   SP3: PRODUCT OF THE CHARGES OF THE TINPA-511
     4ARGET AND OF THE',6X,'ECIS-497'/19X,'PARTICLE (SP3 KEPT IN IPI(4,IINPA-512
     5)).',21X,'ECIS-498'/6X,'61-70   WV(4,I):   REPARTITION OF EXCITATIINPA-513
     6ON ENERGY BETWEEN THE   ECIS-499'/25X,'PARTICLE AND THE TARGET: 0.INPA-514
     7 FOR EXCITATION OF  ECIS-500'/25X,'THE TARGET, 1. FOR EXCITATION OINPA-515
     8F THE PARTICLE, ECIS-501'/25X,'RATIO FOR TWO-BODY EXCITATION.',17XINPA-516
     9,'ECIS-502'/'  NOTE:  ONLY THIS CARD IS READ FOR UNCOUPLED STATES INPA-517
     AAND CONTINUA',7X,'ECIS-503'/'  ****  USED FOR COMPOUND NUCLEUS CALINPA-518
     BCULATION.',26X,'ECIS-504'/9X,'WV(4,I) IS NOT TAKEN INTO ACCOUNT FOINPA-519
     CR THE GROUND STATE AND USEDECIS-505'/8X,'FOR THE EXCITED STATES ONINPA-520
     DLY IF LO(98)=.TRUE. AND IF RELATIVISTICECIS-506'/8X,'KINEMATICS ARINPA-521
     EE USED (SCHROEDINGER OR DIRAC EQUATION).',11X,'ECIS-507'/72X,'ECISINPA-522
     F-508'/'DESCRIPTION OF VIBRATIONS  (IF N IS NOT 0 IN ROTATIONAL MODINPA-523
     GEL OR N IS 0 ECIS-509'/'*************************  IN VIBRATIONAL INPA-524
     HMODEL AND LO(3)=LO(7)=.FALSE.)ECIS-510'/72X,'ECIS-511'/'NUMBER OF INPA-525
     IPHONONS',23X,'FORMAT (14I5)',19X,'ECIS-512'/'*****************',55INPA-526
     JX,'ECIS-513'/7X,'1- 5   IPH(I)  DESCRIPTION OF THE STATE.',25X,'ECINPA-527
     KIS-514')                                                          INPA-528
      WRITE (MW,1024)                                                   INPA-529
 1024 FORMAT (14X,'IN THE VIBRATIONAL MODEL: 0 FOR GROUND STATE',14X,'ECINPA-530
     1IS-515'/22X,'1 OR 2 FOR PURE 1 OR 2-PHONONS STATE',14X,'ECIS-516'/INPA-531
     222X,'3 FOR A MIXTURE OF 1 AND 2-PHONONS STATES.',8X,'ECIS-517'/14XINPA-532
     3,'IN THE ROTATIONAL MODEL: 0 FOR GROUND STATE BAND',10X,'ECIS-518'INPA-533
     4/39X,'1 FOR VIBRATIONAL BAND',11X,'ECIS-519'/39X,'2 FOR A MIXTURE INPA-534
     5OF THEM.',9X,'ECIS-520'/7X,'6-10   VIBRATIONAL MODEL: NUMBER OF THINPA-535
     6E PHONON OF THE ONE-PHONON ECIS-521'/14X,'STATE OR OF THE FIRST PHINPA-536
     7ONON OF THE TWO-PHONONS STATE.',4X,'ECIS-522'/14X,'ROTATIONAL MODEINPA-537
     8L: NUMBER OF THE VIBRATION IN THE ORDER OF ECIS-523'/14X,'INPUT. (INPA-538
     9SEE "CARDS READ IN LECT")',25X,'ECIS-524'/6X,'11-15   VIBRATIONAL INPA-539
     AMODEL: NUMBER OF THE SECOND PHONON OF THE',5X,'ECIS-525'/14X,'TWO-INPA-540
     BPHONONS STATE.',40X,'ECIS-526'/6X,'16-20   VIBRATIONAL MODEL: NUMBINPA-541
     CER OF THE ONE-PHONON COMPONENT OF  ECIS-527'/14X,'A MIXED STATE.',INPA-542
     D44X,'ECIS-528'/'  NOTE:  THE TOTAL NUMBER OF PHONONS WILL BE THE LINPA-543
     EARGEST NUMBER READ',4X,'ECIS-529'/'  ****  IN THE COLUMNS 6 TO 20.INPA-544
     F',41X,'ECIS-530'/72X,'ECIS-531'/'PHONONS MIXING PARAMETER',16X,'FOINPA-545
     GRMAT (7F10.5)',17X,'ECIS-532'/'************************',48X,'ECISINPA-546
     H-533'/' IF IPH IS 3 (VIBRATIONAL MODEL) OR IPH IS 2 (ROTATIONAL MOINPA-547
     IDEL)',9X,'ECIS-534'/7X,'1-10   BT IN DEGREES.',44X,'ECIS-535'/6X,'INPA-548
     JTHE NUCLEAR STATE IS:  COS(BT)*(1 PHONON) + SIN(BT)*(2 PHONONS).  INPA-549
     KECIS-536')                                                        INPA-550
      WRITE (MW,1025)                                                   INPA-551
 1025 FORMAT (14X,'OR:  COS(BT)*(VIBR. BAND) + SIN(BT)*(GROUND BAND).',8INPA-552
     1X,'ECIS-537'/72X,'ECIS-538'/'FOR ASYMMETRIC ROTATIONAL MODEL',41X,INPA-553
     2'ECIS-539'/'*******************************',41X,'ECIS-540'/' IF LINPA-554
     3O(1)=LO(3)=.TRUE.',50X,'ECIS-541'/4X,'FOR A STATE OF SPIN "J" THERINPA-555
     4E ARE N=("J"+1)/2 BAND MIXING',11X,'ECIS-542'/' PARAMETERS BETWEENINPA-556
     5 THE N+1 BANDS DEFINED AS ATAN(A(2*I)/A(2*I-2))',6X,'ECIS-543'/' WINPA-557
     6HERE A(I) IS THE AMPLITUDE OF BAND I. IF N IS NOT 0:',18X,'ECIS-54INPA-558
     74'/72X,'ECIS-545'/'MIXING PARAMETERS',23X,'FORMAT (7F10.5)',17X,'EINPA-559
     8CIS-546'/'*****************',55X,'ECIS-547'/7X,'1-10   BT(1)  IN DINPA-560
     9EGREES.',40X,'ECIS-548'/6X,'11-20   BT(2)  IN DEGREES.',40X,'ECIS-INPA-561
     A549'/6X,'21-30   BT(3)  IN DEGREES.',40X,'ECIS-550'/6X,'31-40   BTINPA-562
     B(4)  IN DEGREES.',40X,'ECIS-551'/6X,'41-50   BT(5)  IN DEGREES.',4INPA-563
     C0X,'ECIS-552'/6X,'51-60   .................',41X,'ECIS-553'/6X,'THINPA-564
     DE NUCLEAR STATE IS:   COS(BT(1))*Y(AI,0) + SIN(BT(1))*COS(BT(2))ECINPA-565
     EIS-554'/6X,'*(Y(AI,2)+S*Y(AI,-2))*SQRT(0.5) + SIN(BT(1))*SIN(BT(2)INPA-566
     F)*COS(BT(3))ECIS-555'/6X,'*(Y(AI,4)+S*Y(AI,-4))*SQRT(0.5) + ......INPA-567
     G. WHERE S=(-)**(AI+SPI).  ECIS-556'/''/'  NOTE:  FOR UNNATURAL PAINPA-568
     HRITY STATES (SPI=-), BT(1) WILL BE IGNORED IN  ECIS-557'/'  **** TINPA-569
     IHE CALCULATION AND REPLACED BY 90. DEGREES.',21X,'ECIS-558'/8X,'IFINPA-570
     J LO(15)=.TRUE., ALL THE NUCLEAR PARAMETERS (QUANTITIES GIVEN  ECISINPA-571
     K-559')                                                            INPA-572
      WRITE (MW,1026)                                                   INPA-573
 1026 FORMAT (7X,'IN DEGREES) HAVE TO BE READ IN ORDER TO AVOID A CHANGEINPA-574
     1 IN THIS   ECIS-560'/7X,'PART OF INPUT WHEN SHIFTING LO(15) FROM .INPA-575
     2FALSE. TO .TRUE..  THEY ECIS-561'/7X,'ARE NOT USED AND CANNOT BE IINPA-576
     3N SEARCH.',28X,'ECIS-562'/72X,'ECIS-563'/72X,'ECIS-564'/'CARDS REAINPA-577
     4D IN SUBROUTINE LECT',43X,'ECIS-565'/'****************************INPA-578
     5*',43X,'ECIS-566'/72X,'ECIS-567'/'PHONON DESCRIPTIONS',21X,'FORMATINPA-579
     6 (2I5,F10.5,I5)',11X,'ECIS-568'/'*******************',53X,'ECIS-56INPA-580
     79'/' FOR EVERY PHONON INVOLVED:',45X,'ECIS-570'/7X,'1- 5   NBTA(9,INPA-581
     8*)  = L ANGULAR MOMENTUM USED ALSO FOR HEAVY ION.  ECIS-571'/21X,'INPA-582
     9VALUE USED FOR HEAVY-ION COULOMB DEFORMATIONS.',5X,'ECIS-572'/7X,'INPA-583
     A6-10   NBTA(10,*) = K MAGNETIC QUANTUM NUMBER OF THE VIBRATION INEINPA-584
     BCIS-573'/21X,'ROTATIONAL MODEL. IN THE VIBRATIONAL MODEL, MUST BEEINPA-585
     CCIS-574'/21X,'ZERO TO USE THIS PHONON IN L=0 SECOND ORDER TERMS. EINPA-586
     DCIS-575'/6X,'11-20   BETA(1,*)   PHONON AMPLITUDE FOR THE REAL POTINPA-587
     EENTIAL.',6X,'ECIS-576'/6X,'21-25   IK   LEVEL OF WHICH THE MASSES INPA-588
     FARE USED FOR HEAVY-ION',5X,'ECIS-577'/21X,'CORRECTIONS. (DEFAULT VINPA-589
     GALUE IK=1).',17X,'ECIS-578'/72X,'ECIS-579'/'PHONON AMPLITUDES OF OINPA-590
     HTHER POTENTIALS   FORMAT (7F10.5)',17X,'ECIS-580'/'***************INPA-591
     I**********************',35X,'ECIS-581'/' IF DEFORMATIONS ARE NOT TINPA-592
     JHE SAME FOR ALL POTENTIALS (LO(5)=.TRUE.):',4X,'ECIS-582'/7X,'1-10INPA-593
     K   BETA(2,*) FOR VOLUME IMAGINARY POTENTIAL.',17X,'ECIS-583')     INPA-594
      WRITE (MW,1027)                                                   INPA-595
 1027 FORMAT (6X,'11-20   BETA(3,*) FOR SURFACE REAL POTENTIAL.',21X,'ECINPA-596
     1IS-584'/6X,'21-30   BETA(4,*) FOR SURFACE IMAGINARY POTENTIAL.',16INPA-597
     2X,'ECIS-585'/6X,'31-40   BETA(5,*) FOR REAL SPIN-ORBIT.',28X,'ECISINPA-598
     3-586'/6X,'41-50   BETA(6,*) FOR IMAGINARY SPIN-ORBIT.',23X,'ECIS-5INPA-599
     487'/6X,'51-60   BETA(7,*) FOR COULOMB POTENTIAL.',26X,'ECIS-588'/6INPA-600
     5X,'61-70   BETA(8,*) FOR COULOMB SPIN-ORBIT POTENTIAL.',15X,'ECIS-INPA-601
     6589'/'  NOTE:  IF LO(5)=.FALSE., BETA(I,*)=BETA(1,*) FOR I=2,8.',1INPA-602
     75X,'ECIS-590'/'  ****',66X,'ECIS-591'/72X,'ECIS-592'/'DEFORMATIONSINPA-603
     8 OF ROTATIONAL MODEL',8X,'FORMAT (2I5,F10.5,I5)',11X,'ECIS-593'/'*INPA-604
     9*******************************',40X,'ECIS-594'/' ONLY IF LO(1)=.TINPA-605
     ARUE. AND LO(7)=.FALSE., OTHERWISE GO TO "OPTICAL MODEL ECIS-595'/'INPA-606
     B PARAMETERS".',59X,'ECIS-596'/7X,'1- 5   IQM',4X,'LARGEST ORDER OFINPA-607
     C DEFORMATION.',22X,'ECIS-597'/7X,'6-10   IQMAX  MAXIMUM L-VALUE OFINPA-608
     D MULTIPOLE EXPANSION.',12X,'ECIS-598'/6X,'11-20   ASPIN, THE K-VALINPA-609
     EUE OF THE BAND, USED ONLY IN SYMMETRIC',4X,'ECIS-599'/21X,'ROTATIOINPA-610
     FNAL MODEL.',34X,'ECIS-600'/6X,'21-25   IK',5X,'LEVEL OF WHICH THE INPA-611
     GMASSES ARE USED FOR HEAVY-ION   ECIS-601'/21X,'CORRECTIONS. (DEFAUINPA-612
     HLT VALUE IK=1).',17X,'ECIS-602'/'  NOTE:  IN THE ASYMMETRIC ROTATIINPA-613
     IONAL MODEL IQM IS LIMITED TO 35',8X,'ECIS-603'/'  ****  AND IQMAX INPA-614
     JIS LIMITED TO 8.',38X,'ECIS-604'/72X,'ECIS-605'/'DEFORMATIONS OF RINPA-615
     KEAL VOLUME POTENTIAL   FORMAT (7F10.5)',17X,'ECIS-606')           INPA-616
      WRITE (MW,1028)                                                   INPA-617
 1028 FORMAT ('*************************************',35X,'ECIS-607'/' IINPA-618
     1Q=IQM/2 VALUES FOR SYMMETRIC ROTATIONAL MODEL,',24X,'ECIS-608'/' IINPA-619
     2Q=IQM-1 VALUES FOR ASYMMETRIC ROTATIONAL MODEL:',23X,'ECIS-609'/7XINPA-620
     3,'1-10   BETA(1,1)  DEFORMATION OF THE REAL POTENTIAL.',13X,'ECIS-INPA-621
     4610'/6X,'11-20   BETA(1,2)  DEFORMATION OF THE REAL POTENTIAL.',13INPA-622
     5X,'ECIS-611'/6X,'21-30   BETA(1,3)  DEFORMATION OF THE REAL POTENTINPA-623
     6IAL.',13X,'ECIS-612'/6X,'31-40   BETA(1,4)  DEFORMATION OF THE REAINPA-624
     7L POTENTIAL.',13X,'ECIS-613'/6X,'41-50   BETA(1,5)  DEFORMATION OFINPA-625
     8 THE REAL POTENTIAL.',13X,'ECIS-614'/'............................INPA-626
     9...',41X,'ECIS-615'/6X,'EVENTUALLY, ON NEXT CARD:',9X,'FORMAT (7F1INPA-627
     A0.5)',17X,'ECIS-616'/7X,'1-10   BETA(1,8)  DEFORMATION OF THE REALINPA-628
     B POTENTIAL.',13X,'ECIS-617'/''/6X,'11-20   BETA(1,9)  DEFORMATIONINPA-629
     C OF THE REAL POTENTIAL. ....',8X,'ECIS-618'/6X,'..... AND SO ON UPINPA-630
     D TO BETA(1,IQ).',33X,'ECIS-619'/72X,'ECIS-620'/'DEFORMATIONS FOR OINPA-631
     ETHER POTENTIALS',7X,'FORMAT (7F10.5)',17X,'ECIS-621'/'************INPA-632
     F*********************',39X,'ECIS-622'/' IF DEFORMATIONS ARE NOT THINPA-633
     GE SAME FOR ALL POTENTIALS (LO(5)=.TRUE.):',4X,'ECIS-623'/7X,'1-10 INPA-634
     H  BETA(2,I) DEFORMATION OF THE VOLUME IMAGINARY POTENTIAL.  ECIS-6INPA-635
     I24'/6X,'11-20   BETA(3,I) DEFORMATION OF THE SURFACE REAL POTENTIAINPA-636
     JL.',6X,'ECIS-625'/6X,'21-30   BETA(4,I) DEFORMATION OF THE SURFACEINPA-637
     K IMAGINARY POTENTIAL. ECIS-626')                                  INPA-638
      WRITE (MW,1029)                                                   INPA-639
 1029 FORMAT (6X,'31-40   BETA(5,I) DEFORMATION FOR THE REAL SPIN-ORBIT.INPA-640
     1',12X,'ECIS-627'/6X,'41-50   BETA(6,I) DEFORMATION FOR THE IMAGINAINPA-641
     2RY SPIN-ORBIT.',7X,'ECIS-628'/6X,'51-60   BETA(7,I) DEFORMATION FOINPA-642
     3R THE COULOMB POTENTIAL.',10X,'ECIS-629'/6X,'61-70   BETA(8,I) DEFINPA-643
     4ORMATION FOR THE COULOMB SPIN-ORBIT.',9X,'ECIS-630'/' THERE ARE IQINPA-644
     5 SUCH CARDS',48X,'ECIS-631'/'  NOTE:  IF LO(5)=.FALSE., BETA(I,J)=INPA-645
     6BETA(1,J) FOR I=2,8 AND J=1,IQ.',4X,'ECIS-632'/'  ****',66X,'ECIS-INPA-646
     7633'/72X,'ECIS-634'/'EXPLANATION OF DEFORMATIONS OF THE ROTATIONALINPA-647
     8 MODEL:',20X,'ECIS-635'/'*****************************************INPA-648
     9***********',20X,'ECIS-636'/'FOR SYMMETRIC ROTATIONAL MODEL (LO(3)INPA-649
     A=.FALSE.):',25X,'ECIS-637'/7X,'THE ORDER OF DEFORMATION IS L=2, 4,INPA-650
     B 6, ... AND SO ON.',12X,'ECIS-638'/7X,'THE RADIAL DEPENDENCE OF POINPA-651
     CTENTIALS IS:',26X,'ECIS-639'/10X,'R = R0*(1 + BETA(*,1)*Y(2,0).+ BINPA-652
     DETA(*,2)*Y(4,0) + .....)',6X,'ECIS-640'/10X,'ODD ORDER DEFORMATIONINPA-653
     ES ARE NOT READ.',26X,'ECIS-641'/72X,'ECIS-642'/'FOR THE ASYMMETRICINPA-654
     F ROTATIONAL MODEL (LO(3)=.TRUE.):',21X,'ECIS-643'/7X,'THE ORDER OFINPA-655
     G DEFORMATIONS ARE (L,K)=(2,0), (2,2), (4,0), (4,2),  ECIS-644'/10XINPA-656
     H,'(4,4), (6,0) .... AND SO ON. THERE ARE LIMITED TO (8,8).',6X,'ECINPA-657
     IIS-645'/7X,'THE RADIAL DEPENDENCE OF POTENTIALS IS:',26X,'ECIS-646INPA-658
     J'/10X,'R = R0*(1 + BETA(*,1)*(COS(BETA(*,2))*Y(2,0)+SIN(BETA(*,2))INPA-659
     K*  ECIS-647')                                                     INPA-660
      RETURN                                                            INPA-661
      END                                                               INPA-662
C C 05/03/                                                      ECIS06  INPB-000
      SUBROUTINE INPB                                                   INPB-001
      COMMON /INOUT/ MR,MW,MS                                           INPB-002
      WRITE (MW,1030)                                                   INPB-003
 1030 FORMAT (10X,'(Y(2,2)+Y(2,-2))*SQRT(0.5)) + BETA(*,3)*(COS(BETA(*,4INPB-004
     1))*Y(4,0)ECIS-648'/10X,'+SIN(BETA(*,4)*(COS(BETA(*,5))*(Y(4,2)+Y(4INPB-005
     2,-2))*SQRT(0.5))',4X,'ECIS-649'/10X,'+SIN(BETA(*,5))*(Y(4,4)+Y(4,-INPB-006
     34))*SQRT(0.5)) + ..............  ECIS-650'/3X,'THE "GAMMA" TYPE BEINPB-007
     4TAS AS BETA(*,I) FOR I=2,4,5,7... ARE IN DEGREES. ECIS-651'/3X,'**INPB-008
     5******************************************************************INPB-009
     6 ECIS-652'/'FOR THE CONSTRAINED ASYMMETRIC ROTATIONAL MODEL, WHEN INPB-010
     7LO(2)=.TRUE., THE ECIS-653'/7X,'BAND MIXING COEFFICIENTS ARE CALCUINPB-011
     8LATED FROM "GAMMA"=BETA(*,2)   ECIS-654'/7X,'IN THE DAVYDOV-FILIPPINPB-012
     9OV MODEL. THE SEQUENCE OF STATES MUST BE',4X,'ECIS-655'/7X,'THE GRINPB-013
     AOUND STATE, THE FIRST 2+, THE SECOND 2+,THE OTHER STATES   ECIS-65INPB-014
     B6'/7X,'DESCRIBED AS IN THE GENERAL CASE (THERE CAN BE ONLY THE GROINPB-015
     CUND   ECIS-657'/7X,'STATE AND THE FIRST 2+). THE MIXING PARAMETER INPB-016
     DOF THE FIRST 2+',4X,'ECIS-658'/7X,'STATE IS USED AS "GAMMA" VALUE INPB-017
     EINSTEAD OF BETA(1,2), BUT THE',5X,'ECIS-659'/7X,'DIFFERENCES BETWEINPB-018
     FEN BETA(I,3) ARE KEPT. THE MIXING PARAMETER',5X,'ECIS-660'/7X,'OF INPB-019
     GTHE SECOND 2+ STATE IS IGNORED. IN A SEARCH, THE INDEX 4001   ECISINPB-020
     H-661'/7X,'SHOULD BE USED INSTEAD OF 2002 OR 3011 FOR "GAMMA".',14XINPB-021
     I,'ECIS-662'/72X,'ECIS-663'/'DEFORMATIONS OF ANHARMONIC VIBRATIONALINPB-022
     J MODEL',28X,'ECIS-664'/'******************************************INPB-023
     K**',28X,'ECIS-665')                                               INPB-024
      WRITE (MW,1031)                                                   INPB-025
 1031 FORMAT ('  NOTE:  IN THIS MODEL, THERE IS AN UNIQUE RATIO 1/SQRT(4INPB-026
     1*PI) FOR ANY   ECIS-666'/'  ****  ORDER OF DEFORMATION. TO BE CONSINPB-027
     2ISTENT WITH THE HARMONIC',8X,'ECIS-667'/8X,'VIBRATIONAL MODEL, THEINPB-028
     3 DEFORMATIONS INDICATED BELOW SHOULD BE   ECIS-668'/8X,'BETA, BETAINPB-029
     4**2/SQRT(4*PI) AND BETA**3/(4*PI) RESPECTIVELY.',7X,'ECIS-669'/72XINPB-030
     5,'ECIS-670'/'DEFORMATIONS',28X,'FORMAT (7F10.5)',17X,'ECIS-671'/'*INPB-031
     6***********',60X,'ECIS-672'/' ONLY IF LO(1)=.FALSE. AND .LO(3)=.TRINPB-032
     7UE., LO(5) OR LO(16)=.TRUE.,',7X,'ECIS-673'/' OTHERWISE GO TO "OPTINPB-033
     8ICAL MODEL PARAMETERS".',28X,'ECIS-674'/7X,'1-10   BETA(1,*) FOR CINPB-034
     9ENTRAL POTENTIAL.',26X,'ECIS-675'/6X,'11-20   BETA(2,*) FOR VOLUMEINPB-035
     A IMAGINARY POTENTIAL.',17X,'ECIS-676'/6X,'21-30   BETA(3,*) FOR SUINPB-036
     BRFACE REAL POTENTIAL.',21X,'ECIS-677'/6X,'31-40   BETA(4,*) FOR SUINPB-037
     CRFACE IMAGINARY POTENTIAL.',16X,'ECIS-678'/6X,'41-50   BETA(5,*) FINPB-038
     DOR REAL SPIN-ORBIT.',28X,'ECIS-679'/''/6X,'51-60   BETA(6,*) FOR INPB-039
     EIMAGINARY SPIN-ORBIT.',23X,'ECIS-680'/6X,'61-70   BETA(7,*) FOR COINPB-040
     FULOMB POTENTIAL.',26X,'ECIS-681'/72X,'ECIS-682'/'  NEXT CARD:',28XINPB-041
     G,'FORMAT (7F10.5)',17X,'ECIS-683'/'  **********',60X,'ECIS-684'/7XINPB-042
     H,'1-10   BETA(8,*) FOR COULOMB SPIN-ORBIT POTENTIAL.',15X,'ECIS-68INPB-043
     I5'/'THERE ARE FOUR SETS OF SUCH CARDS, ONE FOR EACH ORDER OF DEFORINPB-044
     JMATION.   ECIS-686'/72X,'ECIS-687'/'ANGULAR MOMENTA',25X,'FORMAT (INPB-045
     K14I5)',19X,'ECIS-688'/'***************',57X,'ECIS-689')           INPB-046
      WRITE (MW,1032)                                                   INPB-047
 1032 FORMAT (' IF LO(16)=.TRUE., OTHERWISE GO TO "DEFORMATIONS".(IF LO(INPB-048
     16)=.TRUE.,',5X,'ECIS-690'/' HEAVY-ION DEFINITION DO NOT CHANGE NONINPB-049
     2 COULOMB DEFORMATION LENGTHS).   ECIS-691'/7X,'1- 5   FOR ZEROTH OINPB-050
     3RDER (DEFAULT VALUE 2). (NOT USED)',12X,'ECIS-692'/7X,'6-10   FOR INPB-051
     4FIRST ORDER (DEFAULT VALUE 2).',24X,'ECIS-693'/6X,'11-15   FOR SECINPB-052
     5OND ORDER (DEFAULT VALUE 2).',23X,'ECIS-694'/6X,'16-20   FOR THIRDINPB-053
     6 ORDER (DEFAULT VALUE 2).',24X,'ECIS-695'/6X,'21-25   IK   LEVEL OINPB-054
     7F WHICH THE MASSES ARE USED FOR HEAVY-ION',5X,'ECIS-696'/14X,'CORRINPB-055
     8ECTIONS. (DEFAULT VALUE IK=1).',24X,'ECIS-697'/9X,'ENTER A NEGATIVINPB-056
     9E VALUE IF YOU WANT 0.',26X,'ECIS-698'/72X,'ECIS-699'/'OPTICAL POTINPB-057
     AENTIAL PARAMETERS',44X,'ECIS-700'/'****************************',4INPB-058
     B4X,'ECIS-701'/'IF LO(7)=.FALSE., NPP LOOPS TO "EQUIDISTANT ANGLES"INPB-059
     C. EACH LOOP INCLUDES ECIS-702'/'EIGHT CARDS GIVING THE DEPTH, THE INPB-060
     DREDUCED RADIUS, THE DIFFUSENESS AND   ECIS-703'/'AN EXPONENT FOR AINPB-061
     E WOODS-SAXON FORM-FACTOR (AT THE POWER 1+THIS EXPONENT)ECIS-704'/'INPB-062
     FFOLLOWED, IF LO(17)=.TRUE., BY THE FOLDING PARAMETERS.',18X,'ECIS-INPB-063
     G705'/' THE PROGRAM SEARCHES TO WHICH NUCLEAR LEVEL THE POTENTIAL BINPB-064
     HELONGS. IF  ECIS-706'/'NONE IS FOUND, A WARNING IS PRINTED AND THEINPB-065
     I FIRST ONE IS CHOSEN.',8X,'ECIS-707'/72X,'ECIS-708'/'VOLUME OR SCAINPB-066
     JLAR REAL POTENTIAL',9X,'FORMAT (4F10.5)',17X,'ECIS-709'/'*********INPB-067
     K**********************',41X,'ECIS-710')                           INPB-068
      WRITE (MW,1033)                                                   INPB-069
 1033 FORMAT (7X,'1-10   VAL(1)   DEPTH IN MEV.',36X,'ECIS-711'/6X,'11-2INPB-070
     10   VAL(2)   REDUCED RADIUS IN FERMIS.',24X,'ECIS-712'/6X,'21-30  INPB-071
     2 VAL(3)   DIFFUSENESS IN FERMIS.',27X,'ECIS-713'/6X,'31-40   VAL(4INPB-072
     3)   EXTRA EXPONENTIATION FACTOR.',21X,'ECIS-714'/72X,'ECIS-715'/'VINPB-073
     4OLUME OR SCALAR IMAGINARY POTENTIAL',4X,'FORMAT (4F10.5)',17X,'ECIINPB-074
     5S-716'/'************************************',36X,'ECIS-717'/7X,'1INPB-075
     6-10   VAL(5)   DEPTH IN MEV.',36X,'ECIS-718'/6X,'11-20   VAL(6)   INPB-076
     7REDUCED RADIUS IN FERMIS.',24X,'ECIS-719'/6X,'21-30   VAL(7)   DIFINPB-077
     8FUSENESS IN FERMIS.',27X,'ECIS-720'/6X,'31-40   VAL(8)   EXTRA EXPINPB-078
     9ONENTIATION FACTOR.',21X,'ECIS-721'/72X,'ECIS-722'/'SURFACE OR VECINPB-079
     ATOR REAL POTENTIAL',8X,'FORMAT (4F10.5)',17X,'ECIS-723'/'*********INPB-080
     B***********************',40X,'ECIS-724'/7X,'1-10   VAL(9)   DEPTH INPB-081
     CIN MEV.',36X,'ECIS-725'/6X,'11-20   VAL(10)  REDUCED RADIUS IN FERINPB-082
     DMIS.',24X,'ECIS-726'/6X,'21-30   VAL(11)  DIFFUSENESS IN FERMIS.',INPB-083
     E27X,'ECIS-727'/6X,'31-40   VAL(12)  EXTRA EXPONENTIATION FACTOR.',INPB-084
     F21X,'ECIS-728'/72X,'ECIS-729'/'SURFACE OR VECTOR IMAGINARY POTENTIINPB-085
     GAL   FORMAT (4F10.5)',17X,'ECIS-730'/'****************************INPB-086
     H*********',35X,'ECIS-731'/7X,'1-10   VAL(13)  DEPTH IN MEV.',36X,'INPB-087
     IECIS-732'/6X,'11-20   VAL(14)  REDUCED RADIUS IN FERMIS.',24X,'ECIINPB-088
     JS-733'/6X,'21-30   VAL(15)  DIFFUSENESS IN FERMIS.',27X,'ECIS-734'INPB-089
     K)                                                                 INPB-090
      WRITE (MW,1034)                                                   INPB-091
 1034 FORMAT (6X,'31-40   VAL(16)  EXTRA EXPONENTIATION FACTOR.',21X,'ECINPB-092
     1IS-735'/72X,'ECIS-736'/'SPIN-ORBIT OR TENSOR REAL POTENTIAL',5X,'FINPB-093
     2ORMAT (4F10.5)',17X,'ECIS-737'/'**********************************INPB-094
     3*',37X,'ECIS-738'/7X,'1-10   VAL(17)  DEPTH IN MEV.',36X,'ECIS-739INPB-095
     4'/6X,'11-20   VAL(19)  REDUCED RADIUS IN FERMIS.',24X,'ECIS-740'/6INPB-096
     5X,'21-30   VAL(19)  DIFFUSENESS IN FERMIS.',27X,'ECIS-741'/''/6X,INPB-097
     6'31-40   VAL(20)  EXTRA EXPONENTIATION FACTOR.',21X,'ECIS-742'/72XINPB-098
     7,'ECIS-743'/'SPIN-ORBIT/TENSOR IMAGINARY POTENTIAL   FORMAT (4F10.INPB-099
     85)',17X,'ECIS-744'/'*************************************',35X,'ECINPB-100
     9IS-745'/7X,'1-10   VAL(21)  DEPTH IN MEV.',36X,'ECIS-746'/6X,'11-2INPB-101
     A0   VAL(22)  REDUCED RADIUS IN FERMIS.',24X,'ECIS-747'/6X,'21-30  INPB-102
     B VAL(23)  DIFFUSENESS IN FERMIS.',27X,'ECIS-748'/6X,'31-40   VAL(2INPB-103
     C4)  EXTRA EXPONENTIATION FACTOR.',21X,'ECIS-749'/'  NOTE:  THE SPIINPB-104
     DN-ORBIT OPERATOR IS ALWAYS 2*(L.S)',22X,'ECIS-750'/'  ****  FOR SPINPB-105
     EIN 1/2 PARTICLE, THE DEPTH IS THE USUAL VALUE.',12X,'ECIS-751'/8X,INPB-106
     F'FOR SPIN 1 PARTICLE, THE DEPTH IS THE HALF OF THE USUAL VALUE.  EINPB-107
     GCIS-752'/72X,'ECIS-753'/'COULOMB POTENTIAL',23X,'FORMAT (4F10.5)',INPB-108
     H17X,'ECIS-754'/'*****************',55X,'ECIS-755'/7X,'1-10   VAL(2INPB-109
     I6)  REDUCED COULOMB RADIUS IN FERMIS.',16X,'ECIS-756'/6X,'11-20   INPB-110
     JVAL(27)  DIFFUSENESS OF A WOODS-SAXON CHARGE DISTRIBUTION.ECIS-757INPB-111
     K')                                                                INPB-112
      WRITE (MW,1035)                                                   INPB-113
 1035 FORMAT (6X,'21-30   VAL(33)  THIRD PARAMETER OF A FERMI CHARGE DISINPB-114
     1TRIBUTION.  ECIS-758'/6X,'31-40   VAL(28)  EXTRA EXPONENTIATION FAINPB-115
     2CTOR.',21X,'ECIS-759'/72X,'ECIS-760'/'SPIN-ORBIT COULOMB POTENTIALINPB-116
     3',12X,'FORMAT (4F10.5)',17X,'ECIS-761'/'**************************INPB-117
     4**',44X,'ECIS-762'/7X,'1-10   VAL(29)  ANOMALOUS MAGNETIC MOMENT (INPB-118
     5LESS HALF CHARGE IN   ECIS-763'/14X,'DIRAC FORMALISM) MULTIPLIED BINPB-119
     6Y THE CHARGE OF THE TARGET.  ECIS-764'/6X,'11-20   VAL(30)  REDUCEINPB-120
     7D RADIUS IN FERMIS.',24X,'ECIS-765'/6X,'21-30   VAL(31)  DIFFUSENEINPB-121
     8SS IN FERMIS.',27X,'ECIS-766'/6X,'31-40   VAL(32)  EXTRA EXPONENTIINPB-122
     9ATION FACTOR.',21X,'ECIS-767'/'  NOTE:  IF VAL(27)=0. OR VAL(31)=0INPB-123
     A. A HOMOGENEOUS CHARGE DISTRIBUTION  ECIS-768'/'  ****  IS USED. TINPB-124
     BHE PRODUCT OF CHARGES IS COPIED INTO VAL(25).',9X,'ECIS-769'/9X,'WINPB-125
     CHEN THE DIFFUSENESS OF THE CHARGE IS NOT ZERO, THE WOODS-SAXONECISINPB-126
     D-770'/8X,'FORM FACTOR IS MULTIPLIED BY 1+VAL(33)*R**2. THE SAME PAINPB-127
     ERAMETER ECIS-771'/8X,'VAL(25) IS USED FOR THESE TWO LAST POTENTIALINPB-128
     FS, IF THEIR',9X,'ECIS-772'/8X,'DIFFUSENESS IS NOT ZERO.',40X,'ECISINPB-129
     G-773'/9X,'IF LO(9)=.TRUE., ENTER A NEGATIVE RADIUS TO USE A SYMMETINPB-130
     HRIC',4X,'ECIS-774'/8X,'WOODS-SAXON FORM FACTOR.',40X,'ECIS-775'/9XINPB-131
     I,'IF A DIFFUSENESS OR THE RADIUS OF A COULOMB POTENTIAL WITHOUT  EINPB-132
     JCIS-776'/8X,'DIFFUSENESS IS NEGATIVE, ITS ABSOLUTE VALUE IS TAKEN INPB-133
     KINTO',7X,'ECIS-777')                                              INPB-134
      WRITE (MW,1036)                                                   INPB-135
 1036 FORMAT (8X,'ACCOUNT IN SUBROUTINE ROTP AND A MESSAGE PRINTED.',15XINPB-136
     1,'ECIS-778'/72X,'ECIS-779'/'*** END OF DO-LOOP FOR POTENTIALS WITHINPB-137
     2OUT FOLDING (LO(17)=.FALSE.) ***  ECIS-780'/72X,'ECIS-781'/'FOLDININPB-138
     3G FOR REAL POTENTIALS',13X,'FORMAT (3F10.5)',17X,'ECIS-782'/'*****INPB-139
     4**********************',45X,'ECIS-783'/' ONLY IF LO(17)=.TRUE., OTINPB-140
     5HERWISE GO TO "END OF DO-LOOP FOR POTENTIALS".ECIS-784'/7X,'1-10  INPB-141
     6 VAL(34) "V" PARAMETER',37X,'ECIS-785'/6X,'11-20   VAL(35) "R" PARINPB-142
     7AMETER',37X,'ECIS-786'/6X,'21-30   VAL(36) "A" PARAMETER',37X,'ECIINPB-143
     8S-787'/72X,'ECIS-788'/'FOLDING FOR IMAGINARY POTENTIALS',8X,'FORMAINPB-144
     9T (3F10.5)',17X,'ECIS-789'/'********************************',40X,INPB-145
     A'ECIS-790'/7X,'1-10   VAL(37) "V" PARAMETER.',36X,'ECIS-791'/6X,'1INPB-146
     B1-20   VAL(38) "R" PARAMETER.',36X,'ECIS-792'/6X,'21-30   VAL(39) INPB-147
     C"A" PARAMETER.',36X,'ECIS-793'/72X,'ECIS-794'/'FOLDING FOR COULOMBINPB-148
     D POTENTIALS',10X,'FORMAT (3F10.5)',17X,'ECIS-795'/'***************INPB-149
     E***************',42X,'ECIS-796'/7X,'1-10   VAL(40) "V" PARAMETER.'INPB-150
     F,36X,'ECIS-797'/6X,'11-20   VAL(41) "R" PARAMETER.',36X,'ECIS-798'INPB-151
     G/6X,'21-30   VAL(42) "A" PARAMETER.',36X,'ECIS-799'/72X,'ECIS-800'INPB-152
     H/'EXPLANATION OF FOLDING PARAMETERS:  THE FOLDING FUNCTIONS ARE NOINPB-153
     IRMALISEDECIS-801'/'**********************************  TO 1.  TO FINPB-154
     JOLD AN OPTICAL POTENTIAL,ECIS-802'/4X,'ENTER THE TRUE CHARGE, THE INPB-155
     KDEPTH OF CENTRAL POTENTIAL EQUAL TO THE  ECIS-803')               INPB-156
      WRITE (MW,1037)                                                   INPB-157
 1037 FORMAT (''/4X,'DEPTH OF THE NUCLEON POTENTIAL MULTIPLIED BY THE NINPB-158
     1UMBER OF NUCLEONS ECIS-804'/4X,'IN THE PROJECTILE, AND THE DEPTH OINPB-159
     2F OF SPIN-ORBIT POTENTIAL EQUAL TOECIS-805'/4X,'THE DEPTH OF THE NINPB-160
     3UCLEON SPIN-ORBIT POTENTIAL DIVIDED BY THE NUMBER ECIS-806'/4X,'OFINPB-161
     4 NUCLEONS IN THE PROJECTILE.',38X,'ECIS-807'/6X,'"V"=0',4X,'NO FOLINPB-162
     5DING.',46X,'ECIS-808'/6X,'"A"=0',4X,'GAUSSIAN FORM FACTOR WITH THEINPB-163
     6 RANGE "R".',17X,'ECIS-809'/6X,'"R"=0',4X,'HULTHEN FORM FACTOR (EXINPB-164
     7P(-X/"V")-EXP(-X/"A"))/X.',9X,'ECIS-810'/15X,'REDUCED TO YUKAWA FOINPB-165
     8RM FACTOR EXP(-X/"V")/X IF "A"=0.',4X,'ECIS-811'/4X,'OTHERWISE  SAINPB-166
     9XON FORM FACTOR 1/(1+EXP((X-"R")/"A").',17X,'ECIS-812'/6X,'IF A FOINPB-167
     ALDING PARAMETER IS NEGATIVE, THE ABSOLUTE VALUE IS TAKEN   ECIS-81INPB-168
     B3'/4X,'INTO ACCOUNT IN SUBROUTINE FOLD AND A MESSAGE PRINTED.',14XINPB-169
     C,'ECIS-814'/6X,'ALL THE DERIVATIVES OF POTENTIALS NEEDED ARE OBTAIINPB-170
     DNED BY NUMERICALECIS-815'/4X,'DERIVATION AFTER FOLDING.',43X,'ECISINPB-171
     E-816'/72X,'ECIS-817'/6X,'******  END OF DO-LOOP FOR POTENTIALS ***INPB-172
     F***',22X,'ECIS-818'/72X,'ECIS-819'/'EQUIDISTANT ANGLES',22X,'FORMAINPB-173
     GT (7F10.5)',17X,'ECIS-820'/'******************',54X,'ECIS-821'/'  INPB-174
     HONLY IF LO(66)=.FALSE., OTHERWISE GO TO "SPIN-ORBIT PARAMETRISATIOINPB-175
     IN". ECIS-822'/7X,'1-10   THETA1   FIRST ANGLE.',37X,'ECIS-823'/6X,INPB-176
     J'11-20   DTHETA   STEP. (DEFAULT VALUE 1.)',25X,'ECIS-824'/6X,'21-INPB-177
     K30   THETA2   LAST ANGLE.',38X,'ECIS-825')                        INPB-178
      WRITE (MW,1038)                                                   INPB-179
 1038 FORMAT (6X,'31-40   DTHE',5X,'AVERAGING ANGLE. VALUES LISTED ARE 1INPB-180
     1/3 OF THE SUMECIS-826'/23X,'OF VALUES AT THETA AND THETA+/-DTHE.',INPB-181
     213X,'ECIS-827'/72X,'ECIS-828'/'SPIN-ORBIT PARAMETRISATION',14X,'FOINPB-182
     3RMAT (7F10.5)',17X,'ECIS-829'/'**************************',46X,'ECINPB-183
     4IS-830'/' ONLY IF LO(4)=.TRUE., OTHERWISE GO TO "HAUSER-FESHBACH CINPB-184
     5ORRECTIONS".   ECIS-831'/7X,'1-10   AZ1.',54X,'ECIS-832'/6X,'11-20INPB-185
     6   AZ2.',8X,'(THESE PARAMETERS ARE IN AN ARRAY',13X,'ECIS-833'/6X,INPB-186
     7'21-30   AZ3.',54X,'ECIS-834'/6X,'31-40   AZ4.',8X,'AZ(16) FROM AZINPB-187
     8(1) TO AZ(6) FOR THE SEARCH)',4X,'ECIS-835'/6X,'41-50   AZ5.',54X,INPB-188
     9'ECIS-836'/6X,'51-60   AZ6.',54X,'ECIS-837'/'  NOTE:  THE UNPARAMEINPB-189
     ATRISED SPIN-ORBIT DEFORMATION IS:',18X,'ECIS-838'/'  ****',8X,'AZ1INPB-190
     B=AZ4=0.,  AZ2=AZ3=AZ5=AZ6=1.',27X,'ECIS-839'/8X,'THE SPIN-ORBIT DEINPB-191
     CFORMATION MULTIPLIED BY X IS:',18X,'ECIS-840'/14X,'AZ1=AZ4=0., AZ2INPB-192
     D=1., AZ3=AZ5=AZ6=X .',23X,'ECIS-841'/8X,'THE "INCORRECT" SPIN-ORBIINPB-193
     ET DEFORMATION IS:',22X,'ECIS-842'/14X,'AZ1=AZ2=AZ5=AZ6=0., AZ3=AZ4INPB-194
     F=0.5 .',25X,'ECIS-843'/8X,'FOR THE MOST GENERAL PARAMETRISATION OFINPB-195
     G DEFORMED SPIN-ORBIT SEE ECIS-844'/8X,'COMMENT CARDS IN SUBROUTINEINPB-196
     H QUAN.',31X,'ECIS-845'/72X,'ECIS-846'/'HAUSER-FESHBACH CORRECTIONSINPB-197
     I',13X,'FORMAT (7F10.5)',17X,'ECIS-847'/'**************************INPB-198
     J*',45X,'ECIS-848'/' ONLY IF LO(81)=.TRUE., OTHERWISE GO TO "CARDS INPB-199
     KREAD IN SUBROUTINE DEPH".ECIS-849')                               INPB-200
      WRITE (MW,1039)                                                   INPB-201
 1039 FORMAT (7X,'1-10   BZ1.   SQUARE ROOT OF ELASTIC ENHANCEMENT.',16XINPB-202
     1,'ECIS-850'/21X,'(DEFAULT VALUE 1.4142).',28X,'ECIS-851'/6X,'11-20INPB-203
     2   BZ2.   IF LO(82)=.TRUE., SPIN CUT-OFF PARAMETER (DEFAULT  ECIS-INPB-204
     3852'/21X,'VALUE 3.5). IF LO(82)=.FALSE., PARTICLE DEGREES OF ECIS-INPB-205
     4853'/21X,'FREEDOM.',43X,'ECIS-854'/6X,'21-30   BZ3.   SQUARE ROOT INPB-206
     5OF LEVEL DENSITY PARAMETER.',12X,'ECIS-855'/21X,'(DEFAULT VALUE 10INPB-207
     60.). IF LO(82)=LO(87)=.FALSE.,',4X,'ECIS-856'/21X,'PARAMETER BZ3 IINPB-208
     7N MOLDAUER''S FORMULA GIVEN BELOW.   ECIS-857'/21X,'(DEFAULT VALUEINPB-209
     8 1.212).',29X,'ECIS-858'/6X,'31-40   BZ4.   IF LO(82)=LO(87)=.FALSINPB-210
     9E., PARAMETER BZ4 IN MOL-',4X,'ECIS-859'/21X,'DAUER''S FORMULA GIVINPB-211
     AEN BELOW. (DEFAULT VALUE 0.78). ECIS-860'/6X,'41-50   BZ5.   IF LOINPB-212
     B(82)=LO(87)=.FALSE., PARAMETER BZ5 IN MOL-',4X,'ECIS-861'/20X,'DAUINPB-213
     CER''S FORMULA GIVEN BELOW. (DEFAULT VALUE 0.228). ECIS-862'/'  NOTINPB-214
     DE:  THE PENETRABILITIES, WHICH ARE PROBABILITIES OF COMPOUND',7X,'INPB-215
     EECIS-863'/'  ****  NUCLEUS FORMATION, ARE RELATED TO PARTIAL CROSSINPB-216
     F-SECTIONS MINUS  ECIS-864'/8X,'THE REACTION CROSS-SECTION TO THE CINPB-217
     GHANNELS TAKEN INTO ACCOUNT.  ECIS-865'/''/9X,'IF LO(82)=.TRUE., DINPB-218
     HENOTING BY TI AND TF THE PENETRABILITIES',4X,'ECIS-866'/8X,'DEFINEINPB-219
     ID ABOVE FOR THE INCOMING AND THE OUTGOING CHANNELS, THE   ECIS-867INPB-220
     J'/8X,'HAUSER-FESHBACH CORRECTION IS: TI*TF/(4*(SUM ON ALL THE T)+'INPB-221
     K,5X,'ECIS-868')                                                   INPB-222
      WRITE (MW,1040)                                                   INPB-223
 1040 FORMAT (8X,'+BZ3**2*(2*J+1)*EXP(-(J*J+J)/(2*BZ2**2)) FOR INELASTICINPB-224
     1 CHANNELS,ECIS-869'/8X,'MULTIPLIED BY BZ1**2 FOR THE ELASTIC ONE.'INPB-225
     2,23X,'ECIS-870'/8X,'FOR THE SEARCH, THESE QUANTITIES ARE IN AZ FROINPB-226
     3M AZ(7) TO AZ(9). ECIS-871'/9X,'FOR LO(82)=.FALSE.: WITHOUT FLUCTUINPB-227
     4ATIONS (LO(87)=.TRUE.), BZ1  ECIS-872'/8X,'IS USED AND CAN BE IN SINPB-228
     5EARCH; WITH FLUCTUATIONS (LO(87)=.FALSE.)ECIS-873'/8X,'THE GIVEN VINPB-229
     6ALUE OF BZ2 IS USED IF BZ2 IS NOT 0; IF BZ2=0., THE  ECIS-874'/8X,INPB-230
     7'CHANNEL DEGREE OF FREEDOM PARAMETER, FORMULA (1) IN P.A.',8X,'ECIINPB-231
     8S-875'/8X,'MOLDAUER, NUCLEAR PHYSICS A344 (1980), PAGE 185-195, WHINPB-232
     9ICH IS:  ECIS-876'/12X,'1.78D0+(TL**1.212D0-0.78D0)*DEXP(-0.228D0*INPB-233
     ASUM ON TL)',8X,'ECIS-877'/8X,'IS GENERALISED BY THE EXPRESSION:',3INPB-234
     B1X,'ECIS-878'/12X,'1.D0+BZ4+(TL**BZ3-BZ4)*DEXP(-BZ5*SUM ON TL)',17INPB-235
     CX,'ECIS-879'/8X,'IF LO(82)=.TRUE. BZ1 AND BZ2 CAN BE IN SEARCH; IFINPB-236
     D LO(82)=.FALSE.ECIS-880'/8X,'AND LO(87)=.TRUE. BZ3 CAN BE IN SEARCINPB-237
     EH; IF LO(82)=LO(87)=.FALSE.ECIS-881'/8X,'BZ2 CAN BE IN SEARCH, BUTINPB-238
     F IF BZ2=0., BZ3, BZ4 AND BZ5 CAN ALSO  ECIS-882'/8X,'BE IN SEARCH.INPB-239
     G',51X,'ECIS-883'/72X,'ECIS-884'/'FISSION DATA',28X,'FORMAT (7F10.5INPB-240
     H)',17X,'ECIS-885'/'************',60X,'ECIS-886'/' IF LO(82)=.TRUE.INPB-241
     I, GO TO "CARDS READ IN SUBROUTINE DEPH".',15X,'ECIS-887'/' IF LO(8INPB-242
     J5)=.FALSE., GO TO "GIANT DIPOLE RESONANCE DESCRIPTION".',9X,'ECIS-INPB-243
     K888')                                                             INPB-244
      WRITE (MW,1041)                                                   INPB-245
 1041 FORMAT (7X,'1-10   FISS(1,*)  TRANSMISSION COEFFICIENT',23X,'ECIS-INPB-246
     1889'/6X,'11-20   FISS(2,*)  DEGREE OF FREEDOM. IF <.5, IT IS REPLAINPB-247
     2CED BY 0.ECIS-890'/'  THERE ARE NFISS SUCH CARDS. THE FIRST COEFFIINPB-248
     3CIENT IS FOR THE SMALLEST ECIS-891'/'TOTAL J VALUE OF THE SYSTEM AINPB-249
     4ND THE SAME PARITY OF THE GROUND STATE. THEECIS-892'/'SECOND ONE IINPB-250
     5S FOR THE OPPOSITE PARITY. THE FOLLOWING ONES ARE FOR HIGHERECIS-8INPB-251
     693'/'J VALUES, WITH THE SAME ORDER FOR PARITIES.',29X,'ECIS-894'/7INPB-252
     72X,'ECIS-895'/'GIANT DIPOLE RESONANCE DESCRIPTION',6X,'FORMAT (7F1INPB-253
     80.5)',17X,'ECIS-896'/'**********************************',38X,'ECIINPB-254
     9S-897'/' ONLY IF LO(86)=.TRUE., OTHERWISE GO TO "LEVEL DENSITY FORINPB-255
     A CONTINUUM".  ECIS-898'/' IF NRD IS NOT 0, GO TO "GAMMA TRANSMISSIINPB-256
     BON FACTORS".',19X,'ECIS-899'/' DATA TO COMPUTE THE (NEUTRON, GAMMAINPB-257
     C) CROSS-SECTION WHEN THE GIANT',6X,'ECIS-900'/' DIPOLE RESONANCE MINPB-258
     DODEL IS USED (SEE E. LYNN, "THE THEORY OF NEUTRON',4X,'ECIS-901'/'INPB-259
     E RESONANCE REACTIONS", PAGES 321/326 AND A. GILBERT AND A.G.W.',10INPB-260
     FX,'ECIS-902'/' CAMERON, CAN. JOUR. OF PHYSICS 43, 1446, 1965, PAGEINPB-261
     GS 1475/1476).',7X,'ECIS-903'/7X,'1-10   TGO   SLOW S-WAVE NEUTRON INPB-262
     HGAMMA WIDTHS/SPACING FOR',8X,'ECIS-904'/20X,'NORMALISATION. IF TGOINPB-263
     I=0, LO(86) IS SET .FALSE.',6X,'ECIS-905'/6X,'11-20   BN',4X,'NEUTRINPB-264
     JON SEPARATION ENERGY.(DEFAULT VALUE 8.).',7X,'ECIS-906'/6X,'21-30 INPB-265
     K  FNUG  RADIATIVE DEGREES OF FREEDOM.',23X,'ECIS-907')            INPB-266
      WRITE (MW,1042)                                                   INPB-267
 1042 FORMAT (20X,'IF LESS THAN 1., IT IS REPLACED BY FNUG=20.',9X,'ECISINPB-268
     1-908'/6X,'31-40   EGD   ENERGY OF THE GIANT DIPOLE RESONANCE.',15XINPB-269
     2,'ECIS-909'/20X,'(DEFAULT VALUE 163*(N*Z)**2/(N+Z)**(4/3).).',9X,'INPB-270
     3ECIS-910'/20X,'THE STRONG ABSORPTION MODEL ID USED IF EGD < 0.',5XINPB-271
     4,'ECIS-911'/20X,'(SIMPLE BEHAVIOUR AS E**3 INSTEAD OF RESONANCE',6INPB-272
     5X,'ECIS-912'/20X,'WITH A FACTOR E**4)',33X,'ECIS-913'/6X,'41-50   INPB-273
     6GGD   RESONANCE WIDTH. (DEFAULT VALUE 5.).',16X,'ECIS-914'/4X,'FORINPB-274
     7 THE SEARCH, THESE QUANTITIES ARE IN AZ FROM AZ(12) TO AZ(16).   EINPB-275
     8CIS-915'/72X,'ECIS-916'/'GAMMA TRANSMISSION FACTORS',14X,'FORMAT (INPB-276
     97F10.5)',17X,'ECIS-917'/'**************************',46X,'ECIS-918INPB-277
     A'/' ONLY IF LO(86)=.TRUE. AND NRD IS NOT 0.',32X,'ECIS-919'/7X,'1-INPB-278
     B10   GAM(1) FOR L=0.',43X,'ECIS-920'/6X,'11-20   GAM(2) FOR L=1.',INPB-279
     C43X,'ECIS-921'/6X,'.......................',43X,'ECIS-922'/6X,'61-INPB-280
     D70   GAM(7) FOR L=6.',43X,'ECIS-923'/'  UP TO GAM(NRD), EVENTUALLYINPB-281
     E ON OTHERS CARDS.',27X,'ECIS-924'/72X,'ECIS-925'/''/'LEVEL DENSITINPB-282
     FY OF COMPOUND NUCLEUS',7X,'FORMAT (7F10.5)',17X,'ECIS-926'/'******INPB-283
     G***************************',39X,'ECIS-927'/' IF THERE ARE GAMMA TINPB-284
     HRANSMISSION PARAMETERS COMPUTED WITH THE GIANT',5X,'ECIS-928'/' DIINPB-285
     IPOLE RESONANCE MODEL (LO(86)=.TRUE. AND NRD=0 IN "COMPOUND NUCLEUSINPB-286
     J   ECIS-929'/' DATA"),  OR CONTINUA (NCONT NOT 0 IN "COMPOUND NUCLINPB-287
     KEUS DATA"),',9X,'ECIS-930')                                       INPB-288
      WRITE (MW,1043)                                                   INPB-289
 1043 FORMAT (' OTHERWISE GO TO "CARDS READ IN SUBROUTINE DEPH".',23X,'EINPB-290
     1CIS-931'/' FOR THE TOTAL RESIDUAL NUCLEUS NEEDED FOR THE GAMMA GIAINPB-291
     2NT RESONANCE,   ECIS-932'/' FOLLOWED BY THE RESIDUAL NUCLEUS OF EAINPB-292
     3CH CONTINUUM:',20X,'ECIS-933'/7X,'1-10   SCN(7,I) Z:   CHARGE OF TINPB-293
     4HE COMPOUND NUCLEUS',14X,'ECIS-934'/6X,'11-20   SCN(1,I) SA:  LEVEINPB-294
     5L DENSITY PARAMETER FOR S-WAVE RESONANCEECIS-935'/28X,'SPACING. (DINPB-295
     6EFAULT VALUE (.0091*(SHELL CORR. ECIS-936'/28X,'-.23*ND)+.143)*NA INPB-296
     7WHERE NA IS THE TOTAL',5X,'ECIS-937'/28X,'NUMBER OF NUCLEONS, ND TINPB-297
     8HE MINIMUM DISTANCE ECIS-938'/28X,'TO A MAGIC NUMBER FOR PROTONS OINPB-298
     9R NEUTRONS   ECIS-939'/28X,'AND SHELL CORRECTIONS ARE GIVEN BY COOINPB-299
     AK: SEEECIS-940'/28X,'TABLES AND REFERENCES IN SUBROUTINE LDEN).  EINPB-300
     BCIS-941'/6X,'21-30   SCN(2,I) UX:  MATCHING ENERGY FOR THE TWO DENINPB-301
     CSITY FORMULA ECIS-942'/28X,'SHIFTED BY PAIRING ENERGY. (DEFAULT VAINPB-302
     DLUE   ECIS-943'/28X,'2.5+150/NA).',32X,'ECIS-944'/6X,'31-40   SCN(INPB-303
     E3,I) TAU: NUCLEAR TEMPERATURE. (DEFAULT VALUE',9X,'ECIS-945'/28X,'INPB-304
     F1/TAU=SQRT(SA/UX)-1.5/UX).',18X,'ECIS-946'/6X,'41-50   SCN(4,I) SGINPB-305
     G:  SPIN CUT OFF PARAMETER. (DEFAULT VALUE',6X,'ECIS-947'/28X,'FORMINPB-306
     HULA (11) OF GILBERT AND CAMERON).',7X,'ECIS-948'/6X,'51-60   SCN(5INPB-307
     I,I) E0:  ENERGY SHIFT. (DEFAULT VALUE FORMULA (28) OFECIS-949'/28XINPB-308
     J,'GILBERT AND CAMERON).',23X,'ECIS-950'/6X,'61-70   SCN(6,I) EX:  INPB-309
     KMATCHING ENERGY BETWEEN THE TWO DENSITY',5X,'ECIS-951')           INPB-310
      WRITE (MW,1044)                                                   INPB-311
 1044 FORMAT (28X,'FORMULAE. (DEFAULT VALUE UX+PAIRING WITH',4X,'ECIS-95INPB-312
     12'/28X,'PAIRING GIVEN BY COOK)',22X,'ECIS-953'/'  NOTE:  THE DIMENINPB-313
     2SIONS OF THE ARRAY SCN ARE 7 AND NCONS. SCN(J,I)',6X,'ECIS-954'/' INPB-314
     3 ****  CAN BE SEARCHED FOR J=1 TO 6. IF SCN(J,I) IS 0., IT IS REPLINPB-315
     4ACED ECIS-955'/8X,'BY THE DEFAULT VALUE COMPUTED WITH THE SCN(J,K)INPB-316
     5 FOR K<I. IF',5X,'ECIS-956'/8X,'SCN(3,I) IS NEGATIVE, IT IS REPLACINPB-317
     6ED BY THE DEFAULT VALUE',7X,'ECIS-957'/8X,'COMPUTED WITH DEFAULT VINPB-318
     7ALUES FOR SA AND UX. AFTER REPLACEMENT,  ECIS-958'/8X,'DENSITY PARINPB-319
     8AMETERS USED, WHICH MUST BE TAKEN INTO ACCOUNT FOR A ECIS-959'/8X,INPB-320
     9'SEARCH OR A CHANGE USING LO(37)=.TRUE. ARE LISTED AT THE END.   EINPB-321
     ACIS-960'/72X,'ECIS-961'/72X,'ECIS-962'/'CARDS READ IN SUBROUTINE DINPB-322
     BEPH',43X,'ECIS-963'/'*****************************',43X,'ECIS-964'INPB-323
     C/72X,'ECIS-965'/'NUMBER OF OBSERVABLES BY CHANNEL',8X,'FORMAT (14IINPB-324
     D5)',19X,'ECIS-966'/'********************************',40X,'ECIS-96INPB-325
     E7'/' (NON-STANDARD OBSERVABLES) ONLY IF LO(94)=.TRUE. AND LO(66)=.INPB-326
     FFALSE.,   ECIS-968'/' OTHERWISE GO TO "RESTRICTED COULOMB CORRECTIINPB-327
     GONS".',22X,'ECIS-969'/7X,'1- 5   NUMBER OF OBSERVABLES FOR THE ELAINPB-328
     HSTIC SCATTERING.',9X,'ECIS-970'/7X,'6-10   NUMBER OF OBSERVABLES FINPB-329
     IOR THE FIRST EXCITED STATE.',8X,'ECIS-971'/6X,'11-15   NUMBER OF OINPB-330
     JBSERVABLES FOR THE SECOND EXCITED STATE.',7X,'ECIS-972')          INPB-331
      WRITE (MW,1045)                                                   INPB-332
 1045 FORMAT (6X,'16-20   NUMBER OF OBSERVABLES FOR THE THIRD EXCITED STINPB-333
     1ATE.',8X,'ECIS-973'/6X,'21-25   ...........',47X,'ECIS-974'/14X,'UINPB-334
     2P TO THE LAST COUPLED CHANNEL (NCOLL VALUES).',12X,'ECIS-975'/72X,INPB-335
     3'ECIS-976'/'FOR EACH COUPLED STATE',50X,'ECIS-977'/'**************INPB-336
     4********',50X,'ECIS-978'/72X,'ECIS-979'/'OBSERVABLE IDENTIFICATIONINPB-337
     5S',14X,'FORMAT (14I5)',19X,'ECIS-980'/'**************************'INPB-338
     6,46X,'ECIS-981'/7X,'1- 5   FIRST OBSERVABLE WHICH MUST BE THE CROSINPB-339
     7S-SECTION (ENTER A ECIS-982'/14X,'BLANK OR 0) .',45X,'ECIS-983'/7XINPB-340
     8,'6-10   SECOND OBSERVABLE.',40X,'ECIS-984'/6X,'11-15   THIRD OBSEINPB-341
     9RVABLE.',41X,'ECIS-985'/6X,'16-20   FOURTH OBSERVABLE.',40X,'ECIS-INPB-342
     A986'/''/6X,'21-25   FIFTH OBSERVABLE.',41X,'ECIS-987'/6X,'26-30  INPB-343
     B ...........',47X,'ECIS-988'/14X,'UP TO THE LAST OBSERVABLE.',32X,INPB-344
     C'ECIS-989'/72X,'ECIS-990'/3X,'STANDARD DESCRIPTION  0   CROSS-SECTINPB-345
     DION.',29X,'ECIS-991'/3X,'********************  1   CROSS-SECTION /INPB-346
     E RUTHERFORD''S CROSS-SECTION.ECIS-992'/25X,'2   VECTOR ANALYSING PINPB-347
     FOWER.',20X,'ECIS-993'/6X,'3',5X,'VECTOR POLARISATION.',40X,'ECIS-9INPB-348
     G94'/12X,'(NOTE A RATIO SQRT(2.) WITH IT11 FOR SPIN 1/2 FOR 2 AND 3INPB-349
     H). ECIS-995'/6X,'4',5X,'T20 .',55X,'ECIS-996'/6X,'5',5X,'T21 .',55INPB-350
     IX,'ECIS-997'/6X,'6',5X,'T22 .',55X,'ECIS-998'/6X,'7',5X,'KYY OR D INPB-351
     J DEFINED AS -A(1100 1100)-A(1100 1-100)',12X,'ECIS-999'/6X,'8',5X,INPB-352
     K'KXX OR R  DEFINED AS  A(1100 1100)-A(1100 1-100)',12X,'ECIS1000')INPB-353
      WRITE (MW,1046)                                                   INPB-354
 1046 FORMAT (6X,'9',5X,'KZZ OR A'' DEFINED AS  A(1000 1000)',26X,'ECIS1INPB-355
     1001'/5X,'10',5X,'KXZ OR R'' DEFINED AS -SQRT(2.) A(1100 1000)',17XINPB-356
     2,'ECIS1002'/5X,'11',5X,'KZX OR A  DEFINED AS -SQRT(2.) A(1000 1100INPB-357
     3)',17X,'ECIS1003'/5X,'12',5X,'SPIN-FLIP :  (A(0000,0000)+A(1100,11INPB-358
     400)+A(1100,1-100))/2',4X,'ECIS1004'/5X,'13',5X,'VECTOR ANALYSING PINPB-359
     5OWER OF THE TARGET',24X,'ECIS1005'/10X,'(NOTE A RATIO SQRT(2.) WITINPB-360
     6H IT11 FOR SPIN 1/2 FOR 2, 3 AND 13)ECIS1006'/5X,'14',5X,'AYY  DEFINPB-361
     7INED AS -A(1111 0000)-A(111-1 0000)',17X,'ECIS1007'/5X,'15',5X,'AXINPB-362
     8X  DEFINED AS  A(1111 0000)-A(111-1 0000)',17X,'ECIS1008'/5X,'16',INPB-363
     95X,'AZZ  DEFINED AS  A(1010 0000)',31X,'ECIS1009'/5X,'17',5X,'AXZ INPB-364
     A DEFINED AS -SQRT(2.) A(1110 0000)',22X,'ECIS1010'/5X,'18',5X,'AZXINPB-365
     B  DEFINED AS -SQRT(2.) A(1011 0000)',22X,'ECIS1011'/5X,'19',5X,'REINPB-366
     CSERVED FOR A SET OF EXPERIMENTAL DATA WHICH ARE REACTION  ECIS1012INPB-367
     D'/17X,'CROSS-SECTIONS. SEE "CARDS READ IN SUBROUTINE LECD''',4X,'EINPB-368
     ECIS1013'/12X,'NOTE THAT 12 AND 19 WERE PREVIOUSLY 7 AND 8.',16X,'EINPB-369
     FCIS1014'/72X,'ECIS1015'/4X,'NON STANDARD DESCRIPTION',4X,'ENTER A INPB-370
     GNEGATIVE VALUE, DIFFERENT FOR   ECIS1016'/4X,'********************INPB-371
     H****',4X,'DIFFERENT OBSERVABLES. THE DESCRIPTION  ECIS1017'/32X,'WINPB-372
     IILL BE READ IN SUBROUTINE OBSE.',8X,'ECIS1018'/10X,'CROSS-SECTIONSINPB-373
     J MUST BE BEFORE POLARISATIONS.',18X,'ECIS1019'/72X,'ECIS1020'/'PLOINPB-374
     KT INDICATIONS',24X,'FORMAT (14I5)',19X,'ECIS1021')                INPB-375
      WRITE (MW,1047)                                                   INPB-376
 1047 FORMAT ('****************',56X,'ECIS1022'/7X,'1- 5   NUMBER OF DECINPB-377
     1ADES IN LOGARITHMIC SCALES FOR CROSS-SECTION.ECIS1023'/7X,'6-10   INPB-378
     2INDICATION FOR SECOND OBSERVABLE.',25X,'ECIS1024'/6X,'11-15   INDIINPB-379
     3CATION FOR THIRD OBSERVABLE.',26X,'ECIS1025'/6X,'16-20   .........INPB-380
     4..........',39X,'ECIS1026'/14X,'UP TO THE LAST OBSERVABLE.',32X,'EINPB-381
     5CIS1027'/6X,'INDICATIONS FOR POLARISATIONS ARE "1" FOR PLOT AND "0INPB-382
     6" FOR NO PLOTECIS1028'/72X,'ECIS1029'/6X,'******  END OF DO-LOOP FINPB-383
     7OR NUCLEAR STATES ******',18X,'ECIS1030'/72X,'ECIS1031'/'RESTRICTEINPB-384
     8D COULOMB CORRECTIONS',10X,'FORMAT (14I5)',19X,'ECIS1032'/'*******INPB-385
     9***********************',42X,'ECIS1033'/' IF LO(44) AND LO(46)=.TRINPB-386
     AUE., OTHERWISE GO TO "CARDS READ IN',12X,'ECIS1034'/' SUBROUTINE CINPB-387
     BALX".  FOR EACH NUCLEAR LEVEL:',29X,'ECIS1035'/7X,'1- 5   NIV(I,J,INPB-388
     C3) BETWEEN LEVEL I AND LEVEL J FOR J=1.',11X,'ECIS1036'/7X,'6-10  INPB-389
     D NIV(I,J,3) BETWEEN LEVEL I AND LEVEL J FOR J=2.',11X,'ECIS1037'/6INPB-390
     EX,'11-15   .........................',33X,'ECIS1038'/14X,'ENTER "1INPB-391
     F" FOR COULOMB CORRECTION AND "0" FOR NONE.',8X,'ECIS1039'/4X,'ONLYINPB-392
     G VALUES FOR J SMALLER THAN OR EQUAL TO I ARE TAKEN INTO ACCOUNT.ECINPB-393
     HIS1040'/9X,'THERE ARE NCOLL SUCH CARDS.',36X,'ECIS1041'/72X,'ECIS1INPB-394
     I042'/72X,'ECIS1043'/'CARDS READ IN SUBROUTINE CALX',43X,'ECIS1044'INPB-395
     J/'*****************************',43X,'ECIS1045'/' ONLY IF LO(31)=.INPB-396
     KTRUE., OTHERWISE GO TO "CARDS READ IN SUBROUTINE OBSE".ECIS1046') INPB-397
      WRITE (MW,1048)                                                   INPB-398
 1048 FORMAT (72X,'ECIS1047'/''/'CHI2 CONDITIONS',25X,'FORMAT (4I5,2F10INPB-399
     1.5)',13X,'ECIS1048'/'***************',57X,'ECIS1049'/7X,'1- 5   NCINPB-400
     2OLR  NUMBER OF ANGULAR DISTRIBUTIONS. IF SOME OF THEM   ECIS1050'/INPB-401
     321X,'ARE SUMS ON SEVERAL LEVELS, THEY ACCOUNT FOR THEIR ECIS1051'/INPB-402
     421X,'NUMBER OF LEVELS IN NCOLR.',25X,'ECIS1052'/7X,'6-10   NREC   INPB-403
     5NUMBER OF PARAMETERS IN SEARCH.',20X,'ECIS1053'/6X,'11-15   NFIT  INPB-404
     6 NUMBER OF FUNCTIONS KEPT IN THE SEARCH BEYOND THE  ECIS1054'/21X,INPB-405
     7'MINIMUM NUMBER WHICH IS NREC+1 .',19X,'ECIS1055'/6X,'16-20   NESSINPB-406
     8AI MAXIMUM NUMBER OF EVALUATIONS. (DEFAULT VALUE 100) ECIS1056'/21INPB-407
     9X,'THIS VALUE IS NOT USED WHEN LO(34)=.TRUE..',9X,'ECIS1057'/6X,'2INPB-408
     A1-30   ECH',4X,'SEARCH SCALE. (DEFAULT VALUE 20.).',17X,'ECIS1058'INPB-409
     B/21X,'IN THE PRELIMINARY RUNS, VARIABLES ARE CHANGED BY  ECIS1059'INPB-410
     C/21X,'THE PRODUCT OF THIS NUMBER WITH THEIR ACCURACY. IN ECIS1060'INPB-411
     D/21X,'THE OTHERS RUNS, THE CHANGE OF ANY VARIABLE IS',5X,'ECIS1061INPB-412
     E'/21X,'LIMITED BY TWICE THIS VALUE.',23X,'ECIS1062'/6X,'31-40   RAINPB-413
     FP',4X,'RATIO OF INCREASE FOR THE SEARCH SCALE AFTER A RUN ECIS1063INPB-414
     G'/21X,'FOR WHICH THE CHI2 DECREASED. (DEFAULT VALUE 1.)   ECIS1064INPB-415
     H'/21X,'THE VALUE OF ECH IS THE PRODUCT BY RAP OF THE LAST ECIS1065INPB-416
     I'/21X,'MAXIMUM CHANGE OF PARAMETER WHICH GAVE A LOWER CHI2ECIS1066INPB-417
     J'/21X,'THE VALUE 1 LEADS SAFELY TO THE MINIMUM. A VALUE   ECIS1067INPB-418
     K')                                                                INPB-419
      WRITE (MW,1049)                                                   INPB-420
 1049 FORMAT (21X,'LARGER THAN 1. LEADS QUICKER TOWARDS THE MINIMUM.  ECINPB-421
     1IS1068'/21X,'A VALUE LESS THAN 1. IS REPLACED BY 1.',13X,'ECIS1069INPB-422
     2'/72X,'ECIS1070'/72X,'ECIS1071'/'CARDS READ IN SUBROUTINE LECD',43INPB-423
     3X,'ECIS1072'/'*****************************',43X,'ECIS1073'/' ONLYINPB-424
     4 IF NCOLR IS NOT 0, OTHERWISE GO TO "CARDS READ IN SUBROUTINE OBSEINPB-425
     5"ECIS1074'/' THE ANGULAR DISTRIBUTIONS CAN BE READ IN ANY ORDER.',INPB-426
     620X,'ECIS1075'/72X,'ECIS1076'/'FOR EACH ANGULAR DISTRIBUTION',43X,INPB-427
     7'ECIS1077'/'*****************************',43X,'ECIS1078'/72X,'ECIINPB-428
     8S1079'/'IDENTIFICATION',26X,'FORMAT (L1,I1,I3,2I5,5X,3F10.5) ECIS1INPB-429
     9080'/'**************',58X,'ECIS1081'/10X,'1   LX LOGICAL. IF LX=.TINPB-430
     ARUE. THE EXPERIMENTAL ERRORS ARE',6X,'ECIS1082'/14X,'PERCENTAGES. INPB-431
     BLX IS SET .FALSE. IF THE OBSERVABLE',10X,'ECIS1083'/14X,'IDENTIFICINPB-432
     CATION IS NOT 0, 1 OR 19.',25X,'ECIS1084'/10X,'2   1 IF THE ANGLES INPB-433
     DARE IN THE LABORATORY SYSTEM, 0 OTHERWISE.ECIS1085'/7X,'3- 5   NT INPB-434
     E  NUMBER OF ANGLES.',36X,'ECIS1086'/7X,'6-10   NUMBER OF THE NUCLEINPB-435
     FAR STATE.',30X,'ECIS1087'/6X,'11-15   OBSERVABLE IDENTIFICATION. (INPB-436
     GSEE COMMENTS ON "OBSERVABLE   ECIS1088'/14X,'IDENTIFICATION" IN "CINPB-437
     HARDS READ IN SUBROUTINE DEPH").',6X,'ECIS1089'/6X,'21-30   WEIGHT INPB-438
     IOF THIS OBSERVABLE IN CHI2. (DEFAULT VALUE 1.)',5X,'ECIS1090'/6X,'INPB-439
     J31-40   EXPERIMENTAL NORMALISATION OF DATA. (DEFAULT VALUE 1.)',4XINPB-440
     K,'ECIS1091')                                                      INPB-441
      WRITE (MW,1050)                                                   INPB-442
 1050 FORMAT (6X,'41-50   ERROR ON EXPERIMENTAL NORMALISATION. (IF 0., TINPB-443
     1HE',10X,'ECIS1092'/14X,'NORMALISATION IS FIXED).',34X,'ECIS1093'/1INPB-444
     26X,'THE EXPERIMENTAL VALUES AND THEIR ERRORS ARE DIVIDED BY ECIS10INPB-445
     394'/14X,'THE "RENORMALISATION PARAMETER". IF THE NORMALISATION IS INPB-446
     4 ECIS1095'/14X,'FIXED, THIS PARAMETER IS THE "EXPERIMENTAL NORMALIINPB-447
     5SATION".ECIS1096'/14X,'IF THE NORMALISATION IS NOT FIXED, THE SQUAINPB-448
     6RE OF THE',6X,'ECIS1097'/14X,'DIFFERENCE BETWEEN THE "EXPERIMENTALINPB-449
     7 NORMALISATION" AND   ECIS1098'/14X,'THIS PARAMETER DIVIDED BY THEINPB-450
     8 "ERROR ON EXPERIMENTAL',6X,'ECIS1099'/14X,'NORMALISATION" IS ADDEINPB-451
     9D TO THE CHI2 FOR THIS OBSERVABLE   ECIS1100'/14X,'FOLLOWING THE DINPB-452
     AEFINITION OF THE CHI2. THE "CALCULATED',5X,'ECIS1101'/14X,'NORMALIINPB-453
     BSATION" IS THE VALUE OF THE "RENORMALISATION',7X,'ECIS1102'/14X,'PINPB-454
     CARAMETER" WHICH MINIMISES THE CHI2. EXPERIMENTAL VALUES  ECIS1103'INPB-455
     D/14X,'AND ERRORS ARE DIVIDED BY IT.',29X,'ECIS1104'/16X,'IF FOR TWINPB-456
     EO SUCCESSIVE ANGULAR DISTRIBUTIONS, BOTH',7X,'ECIS1105'/14X,'CROSSINPB-457
     F-SECTIONS OR POLARISATIONS, THE "ERRORS ON',11X,'ECIS1106'/14X,'EXINPB-458
     GPERIMENTAL NORMALISATIONS" ARE NON-0 AND THE SAME AND   ECIS1107'/INPB-459
     H14X,'THE TWO "EXPERIMENTAL NORMALISATION" ARE IDENTICAL, THE   ECIINPB-460
     IS1108'/''/14X,'RENORMALISATION PARAMETERS ARE THE SAME FOR THESE INPB-461
     JTWO',5X,'ECIS1109'/14X,'ANGULAR DISTRIBUTIONS AND ONE VALUE IS ADDINPB-462
     KED TO THE CHI2  ECIS1110'/14X,'FOR EACH ONE.',45X,'ECIS1111')     INPB-463
      WRITE (MW,1051)                                                   INPB-464
 1051 FORMAT ('  NOTE:  IF NT=0, THE ANGULAR DISTRIBUTION DESCRIBED HEREINPB-465
     1 IS NOT',8X,'ECIS1112'/'  ****  EXPERIMENTALLY SEPARATED FROM THE INPB-466
     2FOLLOWING ONE. IT CANNOT',6X,'ECIS1113'/8X,'HAPPEN FOR THE LAST ANINPB-467
     3GULAR DISTRIBUTION AND THE OBSERVABLES',4X,'ECIS1114'/8X,'MUST BE INPB-468
     4OF THE SAME KIND (IF NOT, THE PROGRAM STOPS).',11X,'ECIS1115'/8X,'INPB-469
     5ANGULAR DISTRIBUTION IS ATTRIBUTED TO THE LEVEL READ WITHOUT',4X,'INPB-470
     6ECIS1116'/8X,'NT=0 WHICH CAN BE ANY OF THEM.',34X,'ECIS1117'/12X,'INPB-471
     7THE PROGRAM STOPS ALSO IF THE CHANNEL NUMBER IS TOO LARGE   ECIS11INPB-472
     818'/8X,'OR IF THE OBSERVABLE IDENTIFICATION IS LARGER THAN 19.',10INPB-473
     9X,'ECIS1119'/72X,'ECIS1120'/'DATA CARD FOR EACH ANGLE',16X,'FORMATINPB-474
     A (6F10.5)',17X,'ECIS1121'/'************************',48X,'ECIS1122INPB-475
     B'/7X,'1-10   ANGLE IN DEGREES.',41X,'ECIS1123'/6X,'11-20   EXPERIMINPB-476
     CENTAL VALUE.',39X,'ECIS1124'/6X,'21-30   EXPERIMENTAL ERROR.',39X,INPB-477
     D'ECIS1125'/6X,'31-40   WIDTH OF DETECTOR. (IF NON 0.,THREE CALCULAINPB-478
     ETIONS ARE DONE ECIS1126'/14X,'AT THE EXPERIMENTAL ANGLE AND AT PLUINPB-479
     FS AND MINUS THIS',6X,'ECIS1127'/14X,'WIDTH, THE CALCULATED VALUE WINPB-480
     GILL BE THE MEAN VALUE).',6X,'ECIS1128'/6X,'41-50   ANGULAR ERROR. INPB-481
     H(IF NON 0. AND THE WIDTH OF DETECTOR NON 0.ECIS1129'/14X,'THE EXPEINPB-482
     IRIMENTAL ERROR IS INCREASED TO TAKE INTO ACCOUNT  ECIS1130'/14X,'TINPB-483
     JHE SLOPE OF THE CALCULATED CURVE).',23X,'ECIS1131')               INPB-484
      WRITE (MW,1052)                                                   INPB-485
 1052 FORMAT ('  NOTE:  IF THE OBSERVABLE IDENTIFICATION IS 19, THE SET INPB-486
     1OF EXPERIMENTALECIS1132'/'  ****  VALUES ARE TOTAL CROSS-SECTIONS INPB-487
     2OF WHICH THE CHANNEL IS READ IN ECIS1133'/8X,'FLOATING VALUE INSTEINPB-488
     3AD OF THE ANGLE. FOR CHANNEL 0., IT IS THE  ECIS1134'/8X,'TOTAL REINPB-489
     4ACTION CROSS-SECTION, NOT TAKING INTO ACCOUNT THE',7X,'ECIS1135'/8INPB-490
     5X,'COULOMB SCATTERING. FOR CHANNEL -1., IT IS THE TOTAL',12X,'ECISINPB-491
     61136'/8X,'CROSS-SECTION AS DEFINED FOR NEUTRONS. WEIGHT AND EXPERIINPB-492
     7MENTAL  ECIS1137'/8X,'NORMALISATION ARE TAKEN INTO ACCOUNT. FOR COINPB-493
     8MPOUND NUCLEUS,',5X,'ECIS1138'/8X,'UNCOUPLED LEVELS, CONTINUA, FISINPB-494
     9SION AND GAMMA CROSS-SECTIONS',4X,'ECIS1139'/8X,'FOLLOW THE COUPLEINPB-495
     AD STATES.',38X,'ECIS1140'/72X,'ECIS1141'/72X,'ECIS1142'/'CARDS REAINPB-496
     BD IN SUBROUTINE CALX',43X,'ECIS1143'/'****************************INPB-497
     C*',43X,'ECIS1144'/' ONLY IF LO(31)=.TRUE., OTHERWISE GO TO "CARDS INPB-498
     DREAD IN SUBROUTINE OBSE".ECIS1145'/72X,'ECIS1146'/'SEARCH ACCURACIINPB-499
     EES',23X,'FORMAT (7F10.3)',17X,'ECIS1147'/'*****************',55X,'INPB-500
     FECIS1148'/' ONLY IF LO(32)=.TRUE. AND NEITHER NCOLR AND NREC IS 0,INPB-501
     G OTHERWISE GO TO ECIS1149'/' "CARDS READ IN SUBROUTINE OBSE".',39XINPB-502
     H,'ECIS1150'/7X,'1-10   SEARCH ACCURACY FOR THE FIRST VARIABLE.',19INPB-503
     IX,'ECIS1151'/6X,'11-20   SEARCH ACCURACY FOR THE SECOND VARIABLE.'INPB-504
     J,18X,'ECIS1152'/6X,'21-30   SEARCH ACCURACY FOR THE THIRD VARIABLEINPB-505
     K.',19X,'ECIS1153')                                                INPB-506
      WRITE (MW,1053)                                                   INPB-507
 1053 FORMAT (6X,'31-40   ....................',38X,'ECIS1154'/14X,'UP TINPB-508
     1O NREC VALUES.',40X,'ECIS1155'/6X,'THE SEARCH ACCURACIES CANNOT BEINPB-509
     2 0..THERE IS NO DEFAULT VALUE.',5X,'ECIS1156'/'  THEY REFER TO VALINPB-510
     3UES USED IN THE PROGRAM AS REAL RADII OR',13X,'ECIS1157'/'  DEFORMINPB-511
     4ATIONS CHANGED FOR HEAVY IONS.',34X,'ECIS1158'/72X,'ECIS1159'/'INDINPB-512
     5ICES OF VARIABLES',20X,'FORMAT (14I5)',19X,'ECIS1160'/'***********INPB-513
     6*********',52X,'ECIS1161'/7X,'1- 5   INDEX OF THE FIRST VARIABLE.'INPB-514
     7,30X,'ECIS1162'/7X,'6-10   INDEX OF THE SECOND VARIABLE.',29X,'ECIINPB-515
     8S1163'/6X,'11-15   INDEX OF THE THIRD VARIABLE.',30X,'ECIS1164'/6XINPB-516
     9,'16-20   ....................',38X,'ECIS1165'/14X,'UP TO NREC VALINPB-517
     AUES.',40X,'ECIS1166'/72X,'ECIS1167'/''/4X,'INDEX SPECIFICATIONS:'INPB-518
     B,47X,'ECIS1168'/4X,'*********************',47X,'ECIS1169'/7X,'1-10INPB-519
     C00   OPTICAL MODEL AND FOLDING PARAMETERS VAL(I).(SEE, ABOVE,ECIS1INPB-520
     D170'/16X,'OPTICAL POTENTIAL PARAMETERS). POSSIBLE VALUES 1 TO',5X,INPB-521
     E'ECIS1171'/16X,'42*NPP. PARAMETERS OF EXTERNAL FORM FACTORS IN THEINPB-522
     F ORDERECIS1172'/16X,'DEFINED WHEN THEY ARE READ. ONLY FLOATING VALINPB-523
     GUES WHICH  ECIS1173'/16X,'ARE NOT POTENTIALS READ BY POINT CAN BE INPB-524
     HIN SEARCH.',6X,'ECIS1174'/16X,'POSSIBLE VALUES: 1 TO 1000. ABOVE, INPB-525
     IADD 9000.',12X,'ECIS1175'/16X,'CHOOSING SEARCH ACCURACIES, NOTE THINPB-526
     JAT REDUCED RADII ARE ECIS1176'/16X,'NOT USED BUT ONLY RADII. COULOINPB-527
     KMB CHARGES ARE EXCLUDED.  ECIS1177')                              INPB-528
      WRITE (MW,1054)                                                   INPB-529
 1054 FORMAT (4X,'1001-2000   DEFORMATIONS FOR A GIVEN POTENTIAL. POSSIBINPB-530
     1LE VALUES 1001ECIS1178'/16X,'TO 1008.(NOT THE ANGLES OF ASYMMETRICINPB-531
     2 ROTATIONAL MODEL) ECIS1179'/4X,'2001-3000   DEFORMATIONS FOR A GIINPB-532
     3VEN MULTIPOLE. POSSIBLE VALUES 2001ECIS1180'/16X,'TO 2000+NBET WHEINPB-533
     4RE NBET IS THE TOTAL NUMBER OF PHONONS  ECIS1181'/16X,'AND DEFORMAINPB-534
     5TIONS AS LISTED IN THE OUTPUT.',15X,'ECIS1182'/4X,'3001-4000   INDINPB-535
     6IVIDUAL DEFORMATION. (THE UNIT OF THE INDEX IS THE   ECIS1183'/16XINPB-536
     7,'POTENTIAL, THE TENTH IS THE DEFORMATION). TO SIMPLIFY   ECIS1184INPB-537
     8'/16X,'NOTATIONS, POSSIBLE VALUE ARE 3001 TO 3000+10*NBET WITH ECIINPB-538
     9S1185'/16X,'NBET DEFINED ABOVE. VALUES 3XX9 AND 3XX0 ARE EXCLUDED.INPB-539
     A  ECIS1186'/16X,'NOTE THAT DEFORMATION LENGTHS ARE USED IN THE SEAINPB-540
     BRCH IF ECIS1187'/16X,'LO(6)=.TRUE..',43X,'ECIS1188'/4X,'4001-5000 INPB-541
     C  NUCLEAR MODEL PARAMETERS. (IN THE ORDER OF INPUT).',6X,'ECIS1189INPB-542
     D'/4X,'5001-6000   REDUCED NUCLEAR MATRIX ELEMENTS. (ORDER OF INPUTINPB-543
     E IF THEYECIS1190'/16X,'ARE READ ON CARDS, OR ORDER OF COMPUTATION INPB-544
     FAS LISTED).  ECIS1191'/4X,'6001-7000   SPIN-ORBIT PARAMETRISATION,INPB-545
     G HAUSER-FESHBACH CORRECTIONS.ECIS1192'/16X,'AND COMPOUND NUCLEUS PINPB-546
     HARAMETERS. POSSIBLE VALUES ARE:   ECIS1193'/16X,'6001-6006 FOR SPIINPB-547
     IN-ORBIT PARAMETRISATION,',15X,'ECIS1194'/16X,'6007-6011 FOR HAUSERINPB-548
     J-FESHBACH CORRECTIONS,',14X,'ECIS1195'/16X,'6012-6016 FOR GIANT DIINPB-549
     KPOLE RESONANCE PARAMETERS,',8X,'ECIS1196')                        INPB-550
      WRITE (MW,1055)                                                   INPB-551
 1055 FORMAT (16X,'(IN A TEST, 6015 WAS USELESS FOR LO(87)=.FALSE., 6014INPB-552
     1   ECIS1197'/16X,'AND 6015 IF LO(87=.TRUE.)',31X,'ECIS1198'/16X,'6INPB-553
     2017-6016+6*NCONS FOR LEVEL DENSITY PARAMETERS IN ORDER ECIS1199'/1INPB-554
     36X,'GIVEN BY SCN(6,NCONS), SKIPPING THE CHARGE. ONLY VALUES ECIS12INPB-555
     400'/16X,'PRINTED AS USED VALUES CAN BE CHANGED.',18X,'ECIS1201'/16INPB-556
     5X,'(IN A TEST, SCN(5,I) WAS USELESS FOR GAMMA, SCN(1,I),   ECIS120INPB-557
     62'/16X,'SCN(2,I) AND SCN(6,I) FOR A CONTINUUM)',18X,'ECIS1203'/16XINPB-558
     7,'6016+6*NCONS-6016+6*NCONS+NRD GAMMA TRANSMISSION COEFF. ECIS1204INPB-559
     8'/16X,'6016+6*NCONS+NRD-6016+6*NCONS+NRD+2*NFISS FISSION',7X,'ECISINPB-560
     91205'/16X,'TRANSMISSION COEFFICIENTS.',30X,'ECIS1206'/4X,'7001-800INPB-561
     A0   DISPERSION PARAMETER FROM PIP(5,*) TO PIP(17,*) WITHOUT ECIS12INPB-562
     B07'/16X,'POSSIBILITY TO CHANGE THE DESCRIPTION INDUCED BY THE',4X,INPB-563
     C'ECIS1208'/16X,'INTEGER VALUES IPP(*,1,*), IPP(*,2,*), IPI(*,3,*) INPB-564
     DAND   ECIS1209'/16X,'ENERGY REFERENCE PIP(4,*). POSSIBLE VALUES FRINPB-565
     EOM 7001 TO ECIS1210'/16X,'7000+13*NPP.',44X,'ECIS1211'/3X,'10001-9INPB-566
     F9999  TO CONTINUE 1-1000 WHEN THERE ARE MORE THAN 1000 VALUES ECISINPB-567
     G1212'/16X,'WITH EXTERNAL FORM FACTORS. USE THE NUMBER OF THE',7X,'INPB-568
     HECIS1213'/16X,'LISTING INCREASED BY 9000.',30X,'ECIS1214'/'  NOTE:INPB-569
     I  ANY NEGATIVE NUMBER -K IN THE CARD ABOVE MEANS THAT K VARIABLESEINPB-570
     JCIS1215'/'  ****  WILL BE KEPT PROPORTIONAL IN THE SEARCH. THIS VAINPB-571
     KLUE IS REPLACED ECIS1216')                                        INPB-572
      WRITE (MW,1056)                                                   INPB-573
 1056 FORMAT (8X,'BY -*ADDRESS WHERE K FOLLOWED BY K INDICES OF PARAMETEINPB-574
     1RS IS',5X,'ECIS1217'/8X,'STORED',58X,'ECIS1218'/72X,'ECIS1219'/'LIINPB-575
     2NKS BETWEEN VARIABLES',17X,'FORMAT (14I5)',19X,'ECIS1220'/'*******INPB-576
     3****************',49X,'ECIS1221'/4X,'FOR EVERY NEGATIVE VALUE -K IINPB-577
     4N THE PRECEDING CARD:',18X,'ECIS1222'/7X,'1- 5   INDEX OF THE FIRSINPB-578
     5T VARIABLE.',30X,'ECIS1223'/7X,'6-10   INDEX OF THE SECOND VARIABLINPB-579
     6E.',29X,'ECIS1224'/6X,'11-15   INDEX OF THE THIRD VARIABLE.',30X,'INPB-580
     7ECIS1225'/6X,'16-20   ..................',40X,'ECIS1226'/14X,'UP TINPB-581
     8O K INDICES.',42X,'ECIS1227'/72X,'ECIS1228'/72X,'ECIS1229'/''/'CAINPB-582
     9RDS READ IN SUBROUTINE OBSE',43X,'ECIS1230'/'*********************INPB-583
     A********',43X,'ECIS1231'/' ONLY IF THERE IS ANY NON STANDARD OBSERINPB-584
     BVABLE (IDENTIFIED BY A NEGATIVE ECIS1232'/' NUMBER), OTHERWISE GO INPB-585
     CTO "CARDS READ IN SUBROUTINE REDM".',14X,'ECIS1233'/72X,'ECIS1234'INPB-586
     D/'FOR EACH NON STANDARD OBSERVABLE',40X,'ECIS1235'/'**************INPB-587
     E******************',40X,'ECIS1236'/72X,'ECIS1237'/'DEFINITION AND INPB-588
     FNAME',21X,'FORMAT (2L1,I1,I2,I5,5A4)',7X,'ECIS1238'/'*************INPB-589
     G******',53X,'ECIS1239'/10X,'1   LT1  "T" FOR AN OBSERVABLE DEFINEDINPB-590
     H WITH AN AXIS',11X,'ECIS1240'/19X,'PERPENDICULAR TO THE REACTION PINPB-591
     ILANE. THE DESCRIPTION ECIS1241'/19X,'IS CHANGED BY A ROTATION R(PIINPB-592
     J/2,PI/2,PI/2) TO THE',4X,'ECIS1242'/19X,'DEFINITION WITH RESPECT TINPB-593
     KO THE DIRECTION OF PARTICLE ECIS1243')                            INPB-594
      WRITE (MW,1057)                                                   INPB-595
 1057 FORMAT (19X,'(HELICITY). USE A BLANK FOR THE USUAL HELICITY',7X,'EINPB-596
     1CIS1244'/19X,'DESCRIPTION.',41X,'ECIS1245'/10X,'2   LT2  "T" IF THINPB-597
     2E OBSERVABLE IS NOT COMPLETELY DEFINED BY   ECIS1246'/19X,'TENSORSINPB-598
     3. SEE NOTE BELOW "QUANTUM NUMBERS".',11X,'ECIS1247'/10X,'3   BLANKINPB-599
     4 OR 0 FOR OBSERVABLE IN THE CENTRE OF MASS SYSTEM.   ECIS1248'/14XINPB-600
     5,'1',10X,'FOR OBSERVABLE IN THE LABORATORY SYSTEM.',7X,'ECIS1249'/INPB-601
     614X,'2',10X,'FOR OBSERVABLE DEFINED WITH RESPECT TO THE',5X,'ECIS1INPB-602
     7250'/30X,'INCIDENT BEAM.',28X,'ECIS1251'/7X,'4- 5   KX   POSITIVE INPB-603
     8NUMBER, IDENTIFICATION OF THE OBSERVABLE',4X,'ECIS1252'/19X,'READ INPB-604
     9WITH -KX.',39X,'ECIS1253'/7X,'6-10   K',4X,'NUMBER OF COMPONENTS OINPB-605
     AF THE DESCRIPTION.',13X,'ECIS1254'/6X,'11-30   NAME OF THE OBSERVAINPB-606
     BBLE WHICH WILL BE USED IN THE OUTPUT.  ECIS1255'/72X,'ECIS1256'/'QINPB-607
     CUANTUM NUMBERS',25X,'FORMAT (8I5)',20X,'ECIS1257'/'***************INPB-608
     D',57X,'ECIS1258'/7X,'1- 5   TENSOR ORDER OF THE INCOMING PARTICLE.INPB-609
     E',20X,'ECIS1259'/7X,'6-10   RELATED MAGNETIC QUANTUM NUMBER.',26X,INPB-610
     F'ECIS1260'/6X,'11-15   TENSOR ORDER OF THE INITIAL NUCLEUS.',22X,'INPB-611
     GECIS1261'/6X,'16-20   RELATED MAGNETIC QUANTUM NUMBER.',26X,'ECIS1INPB-612
     H262'/6X,'21-25   TENSOR ORDER OF THE OUTGOING PARTICLE.',20X,'ECISINPB-613
     I1263'/6X,'26-30   RELATED QUANTUM NUMBER.',35X,'ECIS1264'/6X,'31-3INPB-614
     J5   TENSOR ORDER OF THE FINAL NUCLEUS.',24X,'ECIS1265'/6X,'36-40  INPB-615
     K RELATED QUANTUM NUMBER.',35X,'ECIS1266')                         INPB-616
      WRITE (MW,1058)                                                   INPB-617
 1058 FORMAT (4X,'THERE ARE K SUCH CARDS.',45X,'ECIS1267'/'  NOTE:  IF LINPB-618
     1T2=.TRUE., SOME COUPLES (TENSOR ORDER, MAGNETIC QUANTUM',4X,'ECIS1INPB-619
     2268'/'  ****  NUMBER) CAN BE REPLACED BY NON TENSOR NOTATION (MI, INPB-620
     3MF). IN THISECIS1269'/8X,'CASE, USE (MI-S-1) AND (MF-S-1) WHERE S INPB-621
     4IS THE SPIN OF PARTICLE ECIS1270'/8X,'OR TARGET.',54X,'ECIS1271'/7INPB-622
     52X,'ECIS1272'/'COEFFICIENTS OF COMPONENTS',14X,'FORMAT (6F10.5)',1INPB-623
     67X,'ECIS1273'/'**************************',46X,'ECIS1274'/7X,'1-10INPB-624
     7   COEFFICIENT OF THE FIRST COMPONENT.',23X,'ECIS1275'/6X,'11-20  INPB-625
     8 COEFFICIENT OF THE SECOND COMPONENT.',22X,'ECIS1276'/6X,'21-30   INPB-626
     9...................',39X,'ECIS1277'/14X,'UP TO K VALUES.',43X,'ECIINPB-627
     AS1278'/72X,'ECIS1279'/'IMAGINARY PART OF COEFFICIENTS',10X,'FORMATINPB-628
     B (6F10.5)',17X,'ECIS1280'/'******************************',42X,'ECINPB-629
     CIS1281'/' ONLY IF LT1=.TRUE. OR LT2=.TRUE., OTHERWISE GO TO NEXT OINPB-630
     DBSERVABLE.',5X,'ECIS1282'/7X,'1-10   IMAGINARY PART FOR THE FIRST INPB-631
     ECOMPONENT.',19X,'ECIS1283'/6X,'11-20   IMAGINARY PART FOR THE SECOINPB-632
     FND COMPONENT.',18X,'ECIS1284'/6X,'21-30   ....................',38INPB-633
     GX,'ECIS1285'/14X,'UP TO K VALUES.',43X,'ECIS1286'/'  NOTE:  THE QUINPB-634
     HANTUM NUMBERS ARE CHECKED AND ERRORS CAN STOP THE',8X,'ECIS1287'/'INPB-635
     I  ****  PROGRAM (TOO LARGE MAGNETIC QUANTUM NUMBERS, NEGATIVE TENSINPB-636
     JOR',4X,'ECIS1288'/8X,'ORDER, ODD SUM OF MAGNETIC QUANTUM NUMBERS FINPB-637
     KOR OBSERVABLE',7X,'ECIS1289')                                     INPB-638
      WRITE (MW,1059)                                                   INPB-639
 1059 FORMAT (8X,'DEFINED WITH THE AXIS PERPENDICULAR TO THE REACTION PLINPB-640
     1ANE).',5X,'ECIS1290'/9X,'THE OBSERVABLES CAN BE READ IN ANY ORDER.INPB-641
     2',22X,'ECIS1291'/''/9X,'POLARISATION OF THE TARGET IS DESCRIBED IINPB-642
     3N THE SYSTEM OF THE   ECIS1292'/8X,'PARTICLE.',55X,'ECIS1293'/72X,INPB-643
     4'ECIS1294'/72X,'ECIS1295'/'CARDS READ IN SUBROUTINE REDM',43X,'ECIINPB-644
     5S1296'/'******************************',42X,'ECIS1297'/' IF LO(7)=INPB-645
     6.TRUE. OR LO(15)=.TRUE.. OTHERWISE GO TO "CARDS READ IN',7X,'ECIS1INPB-646
     7298'/' SUBROUTINE EXTP".',54X,'ECIS1299'/72X,'ECIS1300'/6X,'IN THEINPB-647
     8 SUBROUTINE REDM, THERE IS THE FOLLOWING DO LOOP:',11X,'ECIS1301'/INPB-648
     910X,'DO 16 I1=1,NCOLL',46X,'ECIS1302'/10X,'DO 15 I2=I1,NCOLL',45X,INPB-649
     A'ECIS1303'/10X,'.........',53X,'ECIS1304'/7X,'15 CONTINUE',54X,'ECINPB-650
     BIS1305'/7X,'16 CONTINUE',54X,'ECIS1306'/6X,'INSIDE WHICH MUST BE RINPB-651
     CEAD:',40X,'ECIS1307'/72X,'ECIS1308'/'LOOP CONTROL AND NUMBER CARD'INPB-652
     D,12X,'FORMAT (3I5)',20X,'ECIS1309'/'****************************',INPB-653
     E44X,'ECIS1310'/7X,'1- 5   J1 WHICH MUST BE EQUAL TO I1. (IF NOT THINPB-654
     FE RUN IS STOPPED).ECIS1311'/7X,'6-10   J2 WHICH MUST BE EQUAL TO IINPB-655
     G2. (IF NOT THE RUN IS STOPPED).ECIS1312'/6X,'11-15   K  NUMBER OF INPB-656
     HREDUCED NUCLEAR MATRIX ELEMENTS.',13X,'ECIS1313'/72X,'ECIS1314'/'RINPB-657
     IEDUCED NUCLEAR MATRIX ELEMENTS',9X,'FORMAT (4I5,F20.12)',13X,'ECISINPB-658
     J1315'/'*******************************',41X,'ECIS1316'/'IF K IS NOINPB-659
     KT 0:',58X,'ECIS1317')                                             INPB-660
      RETURN                                                            INPB-661
      END                                                               INPB-662
C C 05/03/                                                      ECIS06  INPC-000
      SUBROUTINE INPC                                                   INPC-001
      COMMON /INOUT/ MR,MW,MS                                           INPC-002
      WRITE (MW,1060)                                                   INPC-003
 1060 FORMAT (7X,'1- 5   FORM FACTOR IDENTIFICATION.',31X,'ECIS1318'/7X,INPC-004
     1'6-10   MULTIPOLARITY. (IF TRIANGULAR RELATION  OR PARITY IS',6X,'INPC-005
     2ECIS1319'/18X,'TRANSGRESSED THE RUN IS STOPPED). ENTER L FOR A',7XINPC-006
     3,'ECIS1320'/18X,'MAGNETIC MULTIPOLE TRANSITION BM(L-1).',16X,'ECISINPC-007
     41321'/6X,'11-15   2*S WHERE S IS THE TRANSFER OF SPIN. S CAN BE NOINPC-008
     5T 0 EVEN  ECIS1322'/18X,'IF LO(7)=.FALSE. (IF LO(7)=.TRUE. THE RUNINPC-009
     6 IS STOPPED  ECIS1323'/18X,'WHEN TRIANGULAR RELATION IS NOT FULFILINPC-010
     7LED).',11X,'ECIS1324'/14X,'INDICATION FOR EXISTENCE OF MAGNETIC MUINPC-011
     8LTIPOLE COULOMB',4X,'ECIS1325'/18X,'FORM FACTOR FOR THE TARGET, WIINPC-012
     9TH S=0: ENTER "-1".',5X,'ECIS1326'/18X,'THIS FORM FACTOR INCLUDES INPC-013
     ANO CENTRAL AND NO',11X,'ECIS1327'/18X,'SPIN-ORBIT CONTRIBUTION.',3INPC-014
     B0X,'ECIS1328'/6X,'16-20   2*J WHERE J IS THE TRANSFER OF TOTAL SPIINPC-015
     CN IF THE VALUE',4X,'ECIS1329'/18X,'GIVEN FOR 2*S IS NOT "0" OR "-1INPC-016
     D". IN THIS CASE THE',4X,'ECIS1330'/18X,'CALCULATION IS STOPPED IF INPC-017
     ETHERE IS NOT A TRIANGULAR   ECIS1331'/18X,'RELATION BETWEEN L, S AINPC-018
     FND J.',26X,'ECIS1332'/14X,'INDICATION FOR EXISTENCE OF AN ASSOCIATINPC-019
     GED SPIN-ORBIT FORM ECIS1333'/18X,'FACTOR WHEN 2*S IS "0": ENTER "1INPC-020
     H" IF THERE IS ONE,',4X,'ECIS1334'/18X,'"0" OR A BLANK IF THERE IS INPC-021
     INONE.',22X,'ECIS1335'/6X,'21-40   VALUE. THE RATIO BETWEEN A MAGNEINPC-022
     JTIC MULTIPOLE COULOMB',5X,'ECIS1336'/18X,'EXCITATION BM(L-1) AND AINPC-023
     KN ELECTRIC ONE BE(L) IS',7X,'ECIS1337')                           INPC-024
      WRITE (MW,1061)                                                   INPC-025
 1061 FORMAT (18X,'SQRT(BM(L-1)/BE(L)) (SQRT(.01106*BM(L-1)/BE(L)) IF',4INPC-026
     1X,'ECIS1338'/18X,'BM(L-1) IS EXPRESSED IN NUCLEAR MAGNETONS SQUAREINPC-027
     2S.',4X,'ECIS1339'/8X,'THERE ARE K SUCH CARDS.',41X,'ECIS1340'/72X,INPC-028
     3'ECIS1341'/4X,'FORM FACTOR IDENTIFICATION',42X,'ECIS1342'/4X,'****INPC-029
     4**********************',42X,'ECIS1343'/6X,'FOR ANHARMONIC VIBRATIOINPC-030
     5NAL MODEL: THE ORDER OF DERIVATIVE.',8X,'ECIS1344'/13X,'(FROM 0 TOINPC-031
     6 3).',45X,'ECIS1345'/6X,'FOR HARMONIC VIBRATIONAL MODEL:',35X,'ECIINPC-032
     7S1346'/13X,'FIRST ORDER:  K1, NUMBER OF THE PHONON IS ORDER OF INPINPC-033
     8UT.  ECIS1347'/13X,'SECOND ORDER: K1+K2*(NBT1+1)  WHERE K1 AND K2 INPC-034
     9ARE THE',6X,'ECIS1348'/17X,'NUMBER OF THE PHONONS IN THE ORDER OF INPC-035
     AINPUT, WITH K2   ECIS1349'/17X,'LARGER THAN K1 AND NBT1 THE TOTAL INPC-036
     BNUMBER OF PHONONS.   ECIS1350'/72X,'ECIS1351'/6X,'FOR SYMMETRIC ROINPC-037
     CTATIONAL MODEL: 1+L WHERE L IS THE MULTIPOLARITY  ECIS1352'/13X,'MINPC-038
     DULTIPLIED BY 1000 PLUS THE IDENTIFICATION OF THE',10X,'ECIS1353'/'INPC-039
     E'/13X,'VIBRATIONAL BAND AS IN HARMONIC VIBRATIONAL MODEL.',9X,'ECINPC-040
     FIS1354'/13X,'A L=0 OR L=1 VIBRATION TERM GENERATE A MONOPOLE OR DIINPC-041
     GPOLE  ECIS1355'/13X,'CORRECTION TERM.',43X,'ECIS1356'/6X,'FOR ASYMINPC-042
     HMETRIC ROTATIONAL MODEL: DEFINED AS 1000* THE "ORDER OF   ECIS1357INPC-043
     I'/13X,'DEFORMATION". (SEE "DEFORMATIONS OF ROTATIONAL MODELS").   INPC-044
     JECIS1358'/72X,'ECIS1359'/6X,'FOR EXTERNAL FORM FACTOR MODEL: IF THINPC-045
     KE FORM FACTOR IDENTIFICATION ECIS1360')                           INPC-046
      WRITE (MW,1062)                                                   INPC-047
 1062 FORMAT (13X,'IS BLANK OR ZERO, AN IDENTIFICATION IS DEFINED IN SEQINPC-048
     1UENCE ECIS1361'/13X,'A NEGATIVE VALUE INDICATES THAT THERE IS A COINPC-049
     2RRECTION TERM ECIS1362'/13X,'TO BE ADDED IN SUCH A WAY THAT THE ININPC-050
     3TEGRAL OF THE SUM WITHECIS1363'/13X,'R**(L+2) VANISHES (L BEING THINPC-051
     4E ANGULAR MOMENTUM RELATED TO ECIS1364'/13X,'THIS FORM FACTOR). IFINPC-052
     5 THE FORM FACTOR IDENTIFICATION IS NONECIS1365'/13X,'ZERO, ITS ABSINPC-053
     6OLUTE VALUE MUST BE IN SEQUENCE OR REFER TO A ECIS1366'/13X,'FORM INPC-054
     7FACTOR ALREADY DEFINED WITH THE SAME SIGN.',12X,'ECIS1367'/72X,'ECINPC-055
     8IS1368'/'  NOTE ON REDUCED MATRIX ELEMENTS:  THE SPIN ANGULAR DESCINPC-056
     9RIPTION FOR A  ECIS1369'/'  ********************************  PARTINPC-057
     AIAL WAVE WITH TOTAL SPIN JJ AND ECIS1370'/'  WITH QUANTUM NUMBERS INPC-058
     BL1 AND J1 FOR THE PARTICLE, I1 FOR THE TARGET IS ECIS1371'/'  ((I*INPC-059
     C*L1*Y(L1) , S1)J1 ,I1)JJ. THE INTERACTION FOR THE TRANSFER OF',5X,INPC-060
     D'ECIS1372'/'  ANGULAR MOMENTUM L, OF SPIN S AND OF TOTAL SPIN J, IINPC-061
     ES THE SCALAR',6X,'ECIS1373'/'  PRODUCT OF A TENSOR OPERATOR Q(J)NUINPC-062
     FCLEAR FOR THE TARGET BY THE TENSOR ECIS1374'/'  PRODUCT OF (I**L*YINPC-063
     G(L) , Q(S)PAR)J FOR THE PARTICLE.',19X,'ECIS1375'/4X,'(((L2,S2)J2,INPC-064
     HI2)JJ|(Q(L),Q(S))J.Q(J)|((L1,S1)J1,I1)JJ) =',13X,'ECIS1376'/'  (-)INPC-065
     I**(JJ+I2+J1+(L1+L2+L)/2)) * C9J(L2,L1,L,S2,S1,S,J2,J1,J) *',9X,'ECINPC-066
     JIS1377'/'  C6J(J2,J,J1,I1,JJ,I2) * C3J(L1,L,L2,0,0,0) * SQRT((2J+1INPC-067
     K)*(2L+1)*',6X,'ECIS1378')                                         INPC-068
      WRITE (MW,1063)                                                   INPC-069
 1063 FORMAT ('  (2S+1)(2L1+1)*(2L2+1)*(2J1+1)*(2J2+1)) /COMPUTED IN SUBINPC-070
     1ROUTINE QUAN/  ECIS1379'/'  * (S2||Q(S)||S1)/(2S+1) * (I2||Q(J)||IINPC-071
     21) * (4*PI)**(-1/2) /WHICH IS   ECIS1380'/'  THE REDUCED NUCLEAR MINPC-072
     3ATRIX ELEMENT READ HERE, EXCEPT FOR THE SQUARE   ECIS1381'/'  ROOTINPC-073
     4 WHICH IS INCLUDED IN FORM FACTORS/.',30X,'ECIS1382'/72X,'ECIS1383INPC-074
     5'/4X,'THIS MATRIX ELEMENT IS REAL AND SYMMETRIC WHEN THE "REDUCED INPC-075
     6NUCLEAR ECIS1384'/'  MATRIX ELEMENT" IS SUCH THAT  (S2,I2 || Q(S) INPC-076
     7Q(J) ||S1,I1) =',10X,'ECIS1385'/'  (-)**(I2+S2-I1-S1+S+J) * (S1,I1INPC-077
     8 || Q(S) Q(J) ||S2,I2). IN MACROSCOPIC ECIS1386'/'  MODELS, S=0 ANINPC-078
     9D THE PHASE BECOMES (-)**(I2-I1)*(PRODUCT OF PARITIES). ECIS1387'/INPC-079
     A4X,'A FACTOR I**(-L) MUST BE TAKEN INTO ACCOUNT IN THE DEFINITION INPC-080
     BOF',4X,'ECIS1388'/'  Q(J)NUCLEAR AND A PHASE I INTRODUCED FOR NEGAINPC-081
     CTIVE PARITY STATES.',6X,'ECIS1389'/4X,'WHEN S=0, (S2|| ||S1) = SQRINPC-082
     DT(2*S1+1) IS COMPUTED IN SUBROUTINE QUAN ECIS1390'/4X,'THE FACTOR INPC-083
     E(2S+1) INTRODUCED IN QUAN TO USE THE SAME REDUCED MATRIX ECIS1391'INPC-084
     F/'  ELEMENT WHEN TARGET AND PARTICLE ARE EXCHANGED.',23X,'ECIS1392INPC-085
     G'/4X,'FOR A MAGNETIC MULTIPOLE COULOMB TRANSITION BM(L-1), THE FORINPC-086
     HM FACTORECIS1393'/'  IS THE ONE OF AN ELECTRIC MULTIPOLE TRANSITIOINPC-087
     IN BE(L) DIVIDED BY',7X,'ECIS1394'/'  MR(M*C/HBAR)**2, WHERE M AND INPC-088
     JMR AND MP ARE ATOMIC AND REDUCED MASSES  ECIS1395'/'  RESPECTIVELYINPC-089
     K.',57X,'ECIS1396'/72X,'ECIS1397'/72X,'ECIS1398')                  INPC-090
      WRITE (MW,1064)                                                   INPC-091
 1064 FORMAT ('CARDS READ IN SUBROUTINE EXTP',43X,'ECIS1399'/'**********INPC-092
     1*******************',43X,'ECIS1400'/' IF (LO(7)=.TRUE., OTHERWISE INPC-093
     2GO TO "CARDS READ IN SUBROUTINE LDIS".',5X,'ECIS1401'/72X,'ECIS140INPC-094
     32'/'IDENTIFICATION',26X,'FORMAT (12I5)',19X,'ECIS1403'/'**********INPC-095
     4****',58X,'ECIS1404'/7X,'1- 5   L1',4X,'LEVEL I.',44X,'ECIS1405'/7INPC-096
     5X,'6-10   L2',4X,'LEVEL IP.',43X,'ECIS1406'/6X,'11-15   ML',4X,'SEINPC-097
     6QUENCE NUMBER OF THE FORM FACTOR IN THE TABLE OF  ECIS1407'/20X,'RINPC-098
     7EDUCED NUCLEAR MATRIX ELEMENTS BETWEEN LEVEL I AND ECIS1408'/20X,'INPC-099
     8LEVEL IP. IT MUST BE 0 FOR POTENTIALS. USE THE',6X,'ECIS1409'/20X,INPC-100
     9'VALUE -ML TO ENTER THE CORRECTION TERM TO THE FORM  ECIS1410'/20XINPC-101
     A,'FACTOR READ WITH ML.',32X,'ECIS1411'/6X,'16-20   ITYP =  1 REAL INPC-102
     BVOLUME OR SCALAR POTENTIAL',17X,'ECIS1412'/22X,'2 IMAGINARY VOLUMEINPC-103
     C OR SCALAR POTENTIAL',12X,'ECIS1413'/22X,'3 REAL SURFACE OR VECTORINPC-104
     D POTENTIAL',16X,'ECIS1414'/22X,'4 IMAGINARY SURFACE OR VECTOR POTEINPC-105
     ENTIAL',11X,'ECIS1415'/''/22X,'5 REAL SPIN-ORBIT OR TENSOR POTENTIINPC-106
     FAL',13X,'ECIS1416'/22X,'6 IMAGINARY SPIN-ORBIT OR TENSOR POTENTIALINPC-107
     G',8X,'ECIS1417'/22X,'7 COULOMB POTENTIAL',31X,'ECIS1418'/22X,'8 COINPC-108
     HULOMB SPIN-ORBIT POTENTIAL',20X,'ECIS1419'/6X,'21-25   L1X   NON PINPC-109
     IOSITIVE OR L1 OF THE FORM FACTOR TO BE COPIED  ECIS1420'/20X,'INTOINPC-110
     J THE NEW ONE.',35X,'ECIS1421'/6X,'26-30   L2X   L2 OF THE FORM FACINPC-111
     KTOR TO BE COPIED IF L1X IS NOT',4X,'ECIS1422')                    INPC-112
      WRITE (MW,1065)                                                   INPC-113
 1065 FORMAT (20X,'POSITIVE.',43X,'ECIS1423'/6X,'31-35   MLX   SAME FOR INPC-114
     1ML IF L1X IS NOT POSITIVE.',17X,'ECIS1424'/6X,'36-40   ITYPX SAME INPC-115
     2FOR ITYP IF L1X IS NOT POSITIVE, MUST BE EQUAL ECIS1425'/20X,'TO IINPC-116
     3TYP.',44X,'ECIS1426'/20X,'NEGATIVE NUMBER FOR STANDARD FORM FACTORINPC-117
     4S WITH NON  ECIS1427'/20X,'POSITIVE VALUE OF L1X IN COLUMNS 21-30:INPC-118
     5',13X,'ECIS1428'/24X,'-1  WOODS-SAXON POTENTIAL.',22X,'ECIS1429'/2INPC-119
     64X,'-2  FIRST DERIVATIVE OF WOODS-SAXON POTENTIAL.  ECIS1430'/24X,INPC-120
     7'-3  SECOND DERIVATIVE OF WOODS-SAXON POTENTIAL. ECIS1431'/24X,'-4INPC-121
     8  THIRD DERIVATIVE OF WOODS-SAXON POTENTIAL.  ECIS1432'/12X,'(THE INPC-122
     9N TH DERIVATIVE IS ALWAYS DIVIDED BY FACT(N)*SQRT(4*PI)ECIS1433'/1INPC-123
     A7X,'AND MULTIPLIED BY R**N ONLY IF LO(6)=.FALSE.)',10X,'ECIS1434'/INPC-124
     B24X,'-5  DEFORMED WOODS-SAXON POTENTIAL.',13X,'ECIS1435'/24X,'-6  INPC-125
     CDERIVATIVE OF DEFORMED WOODS-SAXON POTENTIALECIS1436'/24X,'-7  LAGINPC-126
     DUERRE POLYNOMIAL.',24X,'ECIS1437'/24X,'-8  SOLUTION IN REAL WOODS-INPC-127
     ESAXON POTENTIAL.',5X,'ECIS1438'/24X,'-9  BESSEL EXPANSION.',27X,'EINPC-128
     FCIS1439'/24X,'-10 EXPANSION WITH LAGUERRE POLYNOMIALS.',8X,'ECIS14INPC-129
     G40'/20X,'(SEE BELOW "SPECIAL MEANING OF L1X, L2X AND MLX ..")ECIS1INPC-130
     H441'/6X,'41-45   NST   CHANNEL OF WHICH THE STEP SIZE IS USED (DEFINPC-131
     IAULT',5X,'ECIS1442'/20X,'VALUE: THE CHANNEL WHICH USES IT FOR A CEINPC-132
     JNTRAL',6X,'ECIS1443'/20X,'POTENTIAL, 1 FOR A TRANSITION POTENTIAL)INPC-133
     K. IF NST IS ECIS1444')                                            INPC-134
      WRITE (MW,1066)                                                   INPC-135
 1066 FORMAT (20X,'NEGATIVE FOR A STANDARD FORM FACTOR WITH ITYPX=-1 TOEINPC-136
     1CIS1445'/20X,'ITYPX=-6, USE OF A REDUCED RADIUS, TAKING INTO',6X,'INPC-137
     2ECIS1446'/20X,'ACCOUNT LO(16) (HEAVY-ION DEFINITION) AND LO(6)',5XINPC-138
     3,'ECIS1447'/20X,'(USE OF DEFORMATION LENGTHS).',23X,'ECIS1448'/6X,INPC-139
     4'46-50   NFOLD 0 FOR NO FOLDING OR ADDRESS OF FOLDING PARAMETERS  INPC-140
     5 ECIS1449'/20X,'IN THEIR LIST READ BELOW. NFOLD CAN BE DIFFERENT FINPC-141
     6ORECIS1450'/20X,'A COPIED FORM FACTOR AND ALLOWS THE FOLDING WITH INPC-142
     7A  ECIS1451'/20X,'DIFFERENT MULTIPOLARITY. IT CAN BE USED WITH A',INPC-143
     86X,'ECIS1452'/20X,'FORM FACTOR GIVEN BY POINTS.',24X,'ECIS1453'/6XINPC-144
     9,'51-55   NINT  IF NOT 0, THE STRENGTH IS THE INTEGRAL OF THIS FORINPC-145
     AM ECIS1454'/20X,'FACTOR WITH R**(L+2) WHERE L IS THE RELEVANT ANGUINPC-146
     BLARECIS1455'/20X,'MOMENTUM. WHEN NINT, IS A POSITIVE NUMBER, THE',INPC-147
     C6X,'ECIS1456'/20X,'INTEGRAL WITH R**(L+1) HAS TO BE GIVEN; WITH A'INPC-148
     D,6X,'ECIS1457'/20X,'NEGATIVE INTEGER, THE USUAL STRENGTH HAS TO BEINPC-149
     E GIVENECIS1458'/20X,'AND IS REPLACED BY THIS INTEGRAL AT ITS FIRSTINPC-150
     F',7X,'ECIS1459'/20X,'CALCULATION. FOR SPIN-ORBIT POTENTIALS, IT ISINPC-151
     G THE   ECIS1460'/20X,'INTEGRAL OF THE FORM FACTOR WITHOUT DERIVATIINPC-152
     HON. THISECIS1461'/20X,'STRENGTH IS OF THE SAME SIGN AS THE DEPTH OINPC-153
     IF THE',4X,'ECIS1462'/20X,'STANDARD DESCRIPTION. FOR COULOMB POTENTINPC-154
     JIALS, THIS  ECIS1463'/20X,'STRENGTH IS THE LAST VALUE MULTIPLIED BINPC-155
     KY',12X,'ECIS1464')                                                INPC-156
      WRITE (MW,1067)                                                   INPC-157
 1067 FORMAT (20X,'(2*L+1)*R**(L+1)/1.43998 . IF NST IS NEGATIVE FOR A EINPC-158
     1CIS1465'/20X,'FORM FACTOR COPIED, INPUT OF A MULTIPLICATION FACTORINPC-159
     2ECIS1466'/20X,'IN NEXT CARD.',39X,'ECIS1467'/72X,'ECIS1468'/'MEANIINPC-160
     3NG OF L1X, L2X AND MLX FOR NEGATIVE VALUES OF ITYPX (COLUMNS 36-40INPC-161
     4)ECIS1469'/'******************************************************INPC-162
     5******************ECIS1470'/6X,'21-25   L1X   -L1X IS THE MAGNETICINPC-163
     6 QUANTUM NUMBER OF THE VIBRATIONECIS1471'/20X,'WHEN ITYPX=-6.',38XINPC-164
     7,'ECIS1472'/20X,'-L1X IS THE NUMBER OF NODES WHEN ITYPX=-7 OR -8',INPC-165
     85X,'ECIS1473'/20X,'(USED ONLY WHEN MLX=0 OR MLX=1).',20X,'ECIS1474INPC-166
     9'/20X,'-L1X IS THE ORDER OF DERIVATION OF BESSEL FUNCTIONS ECIS147INPC-167
     A5'/20X,'OR LAGUERRE POLYNOMIALS WHEN ITYPX=-9 OR -10.',7X,'ECIS147INPC-168
     B6'/''/6X,'26-30   L2X   NUMBER OF DEFORMATIONS WHEN ITYPX=-5 OR -INPC-169
     C6.',9X,'ECIS1477'/20X,'A DIVISION FACTOR FOR THE STEPS IN COMPUTININPC-170
     DG BOUND  ECIS1478'/20X,'FUNCTION (DEFAULT VALUE 4) WHEN ITYPX=-8.'INPC-171
     E,11X,'ECIS1479'/20X,'NUMBER OF BESSEL FUNCTIONS OR LAGUERRE POLYNOINPC-172
     FMIALS  ECIS1480'/20X,'WHEN ITYPX=-9 OR -10.',31X,'ECIS1481'/6X,'31INPC-173
     G-35   MLX   ANGULAR MOMENTUM OF THE VIBRATION WHEN ITYPX=-6.',4X,'INPC-174
     HECIS1482'/20X,'NUMBER OF BOUND FUNCTIONS WHEN ITYPX=-7 OR -8:',6X,INPC-175
     I'ECIS1483'/20X,'=0 OR 1 FOR ONE FUNCTION WITH THE QUANTUM NUMBERS INPC-176
     JOFECIS1484'/31X,'THE TRANSITION,',26X,'ECIS1485'/20X,'=2 FOR TWO FINPC-177
     KUNCTIONS WITH THE SAME ITYPX,',11X,'ECIS1486')                    INPC-178
      WRITE (MW,1068)                                                   INPC-179
 1068 FORMAT (20X,'=3 WHEN ITYPX=-8 FOR A LAGUERRE POLYNOMIAL FOR THE  EINPC-180
     1CIS1487'/31X,'SECOND FUNCTION.',25X,'ECIS1488'/20X,'L-VALUE OF BESINPC-181
     2SEL FUNCTIONS OR LAGUERRE POLYNOMIALS ECIS1489'/20X,'WHEN ITYPX=-9INPC-182
     3 OR -10 (DEFAULT VALUE: ANGULAR',8X,'ECIS1490'/20X,'MOMENTUM OF THINPC-183
     4E FORM FACTOR, ENTER A NEGATIVE VALUE ECIS1491'/20X,'TO USE 0).',4INPC-184
     52X,'ECIS1492'/'  ERRORS IN THIS CARD STOP THE PROGRAM.',33X,'ECIS1INPC-185
     6493'/72X,'ECIS1494'/'  NOTE:  IF THERE IS NO SPIN FOR THE PARTICLEINPC-186
     7 IN ALL THE CHANNELS, THE  ECIS1495'/'  ****  SPIN-ORBIT POTENTIALINPC-187
     8S (ITYP = 5 , 6 AND 8) ARE NOT READ, BUT',4X,'ECIS1496'/8X,'THEY AINPC-188
     9RE REQUIRED AS SOON AS THERE IS AT LEAST A NON SPIN-0',5X,'ECIS149INPC-189
     A7'/8X,'PARTICLE AT LEAST FOR ONE LEVEL. FOR THE TRANSITIONS WITH AINPC-190
     B',5X,'ECIS1498'/8X,'TRANSFER OF SPIN S WHICH IS NOT ZERO THERE AREINPC-191
     C NO SPIN-ORBIT',4X,'ECIS1499'/8X,'POTENTIALS (NO TENSOR TERM IN DIINPC-192
     DRAC FORMALISM). THERE IS A',6X,'ECIS1500'/8X,'COULOMB POTENTIAL FOINPC-193
     ER INTEGRAL SPIN TRANSFER EVEN FOR L=0.',6X,'ECIS1501'/9X,'VOLUME AINPC-194
     FND SURFACE POTENTIALS ARE READ SEPARATELY EXCEPT FOR   ECIS1502'/8INPC-195
     GX,'ITYPX=-7 AND -8. IN THE DIRAC FORMALISM ITYPX=-7 AND ITYPX=-8  INPC-196
     H ECIS1503'/8X,'CANNOT BE USED. FOR MAGNETIC COULOMB INTERACTION, OINPC-197
     INLY THE',6X,'ECIS1504'/8X,'COULOMB POTENTIAL IS READ. THE FORM FACINPC-198
     JTORS WITH ITYPX=-5 TO -9 ECIS1505'/8X,'CAN BE COPIED ONLY IF THEY INPC-199
     KINVOLVE THE SAME MULTIPOLARITY. THEREECIS1506')                   INPC-200
      WRITE (MW,1069)                                                   INPC-201
 1069 FORMAT (8X,'IS NO LIMITATION FOR ITYPX=-7 AND -8 IF THEY INVOLVE TINPC-202
     1WO BOUND  ECIS1507'/8X,'FUNCTIONS. THE COPIED FORM FACTORS CAN BE INPC-203
     2FOLDED DIFFERENTLY.   ECIS1508'/72X,'ECIS1509'/' ALLOWED VALUES OFINPC-204
     3 ITYPX FOR STANDARD POTENTIALS',24X,'ECIS1510'/' *****************INPC-205
     4******************************',24X,'ECIS1511'/' *** ML = 0 ******INPC-206
     5',54X,'ECIS1512'/' ITYPX =',4X,'-1',4X,'-2',4X,'-3',4X,'-4',4X,'-5INPC-207
     6',4X,'-6',4X,'-7',4X,'-8  -9,-10',8X,'ECIS1513'/' ITYP = 1   YES  INPC-208
     7 NO',4X,'NO',4X,'NO',4X,'YES   NO',4X,'NO',4X,'NO   YES',10X,'ECISINPC-209
     81514'/' ITYP = 2   YES   NO',4X,'NO',4X,'NO',4X,'YES   NO',4X,'NO'INPC-210
     9,4X,'NO   YES',10X,'ECIS1515'/' ITYP = 3   YES   NO',4X,'NO',4X,'NINPC-211
     AO',4X,'YES   NO',4X,'NO',4X,'NO   YES',10X,'ECIS1516'/' ITYP = 4  INPC-212
     B YES   NO',4X,'NO',4X,'NO',4X,'YES   NO',4X,'NO',4X,'NO   YES',10XINPC-213
     C,'ECIS1517'/' ITYP = 5   YES   NO',4X,'NO',4X,'NO',4X,'YES   NO',4INPC-214
     DX,'NO',4X,'NO   YES',10X,'ECIS1518'/' ITYP = 6   YES   NO',4X,'NO'INPC-215
     E,4X,'NO',4X,'YES   NO',4X,'NO',4X,'NO   YES',10X,'ECIS1519'/' ITYPINPC-216
     F = 7   YES   NO',4X,'NO',4X,'NO',4X,'YES   NO',4X,'NO',4X,'NO   YEINPC-217
     GS',10X,'ECIS1520'/' ITYP = 8   YES   NO',4X,'NO',4X,'NO',4X,'YES  INPC-218
     H NO',4X,'NO',4X,'NO   YES',10X,'ECIS1521'/' **** ML IS NOT 0 ****'INPC-219
     I,50X,'ECIS1522'/' ITYPX =',4X,'-1',4X,'-2',4X,'-3',4X,'-4',4X,'-5'INPC-220
     J,4X,'-6',4X,'-7',4X,'-8  -9,-10',8X,'ECIS1523'/' ITYP = 1   YES   INPC-221
     KYES   YES   YES   YES   YES   YES   YES  YES',10X,'ECIS1524')     INPC-222
      WRITE (MW,1070)                                                   INPC-223
 1070 FORMAT (' ITYP = 2   YES   YES   YES   YES   YES   YES   YES   YESINPC-224
     1  YES',10X,'ECIS1525'/' ITYP = 3   YES   YES   YES   YES   YES   YINPC-225
     2ES   NO',4X,'NO   YES',10X,'ECIS1526'/' ITYP = 4   YES   YES   YESINPC-226
     3   YES   YES   YES   NO',4X,'NO   YES',10X,'ECIS1527'/' ITYP = 5  INPC-227
     4 YES   YES   YES   YES   YES   YES   NO',4X,'NO   YES',10X,'ECIS15INPC-228
     528'/' ITYP = 6   YES   YES   YES   YES   YES   YES   NO',4X,'NO   INPC-229
     6YES',10X,'ECIS1529'/' ITYP = 7   NO',4X,'YES   YES   YES   YES   YINPC-230
     7ES   NO',4X,'NO   YES',10X,'ECIS1530'/' ITYP = 8   NO',4X,'YES   YINPC-231
     8ES   YES   YES   YES   NO',4X,'NO   YES',10X,'ECIS1531'/72X,'ECIS1INPC-232
     9532'/' NUMBER OF PARAMETERS TO STORE:',41X,'ECIS1533'/12X,'10',4X,INPC-233
     A'10',4X,'10',4X,'10  11+L2X 13+L2X 11',4X,'22   13+L2X',7X,'ECIS15INPC-234
     B34'/' THERE IS ONE MORE FOR COULOMB POTENTIALS AND ITYPX=-1 TO -6.INPC-235
     C',11X,'ECIS1535'/' THERE ARE 5 MORE PARAMETERS FOR ITYPX=-7 AND MLINPC-236
     DX=2.',20X,'ECIS1536'/' THERE ARE 16 OR 6 MORE PARAMETERS FOR ITYPXINPC-237
     E=-8 AND MLX=2 OR MLX=3.',5X,'ECIS1537'/72X,'ECIS1538'/''/'STRENGTINPC-238
     FH AND SCALING FACTOR',13X,'FORMAT (7F10.5)',17X,'ECIS1539'/'******INPC-239
     G*********************',45X,'ECIS1540'/' IF ITYPX IS NEGATIVE GO TOINPC-240
     H "PARAMETERS OF STANDARD FORM FACTORS".',6X,'ECIS1541'/' THEN IF LINPC-241
     I1X IS POSITIVE GO BACK TO "IDENTIFICATION" CARD.',14X,'ECIS1542'/1INPC-242
     J0X,'1   .TRUE. TO ALLOW EXTRAPOLATION BEYOND THE LAST POINT. IF ITINPC-243
     KECIS1543')                                                        INPC-244
      WRITE (MW,1071)                                                   INPC-245
 1071 FORMAT (14X,'IS .FALSE., VALUES BEYOND THE LAST POINT WILL BE 0.',INPC-246
     17X,'ECIS1544'/7X,'2-10   MULTIPLICATIVE FACTOR FOR THE STRENGTH (DINPC-247
     2EFAULT VALUE 1.).ECIS1545'/6X,'11-20   MULTIPLICATIVE FACTOR FOR TINPC-248
     3HE STEP SIZE (DEFAULT VALUE 1.)ECIS1546'/72X,'ECIS1547'/'NUMERICALINPC-249
     4 VALUES OF THE POTENTIALS',6X,'FORMAT (2(F10.5,F20.10),A4)',5X,'ECINPC-250
     5IS1548'/'**********************************',38X,'ECIS1549'/7X,'1-INPC-251
     610   REXT  RADIUS.',45X,'ECIS1550'/6X,'11-30   FEXT  VALUE AT REXTINPC-252
     7.',38X,'ECIS1551'/6X,'31-40   REXT  RADIUS.',45X,'ECIS1552'/6X,'41INPC-253
     8-60   FEXT  VALUE AT REXT.',38X,'ECIS1553'/6X,'61-64   LAST  CONTRINPC-254
     9OL WORD WHICH MUST BE "LAST" FOR THE LAST POINTECIS1554'/7X,'IF THINPC-255
     AIS CONTROL WORD IS NOT "LAST" GO TO NEXT SUCH CARD.',9X,'ECIS1555'INPC-256
     B/'  NOTE:  THE NUMBER OF RADII AND VALUES MUST BE AT LEAST 4. IF IINPC-257
     CT IS',4X,'ECIS1556'/'  ***** THE COMPUTATION IS STOPPED.',37X,'ECIINPC-258
     DS1557'/9X,'THE GIVEN RADII MUST BE IN INCREASING ORDER AND THEIR NINPC-259
     EUMBER   ECIS1558'/8X,'EVEN. MANY POINTS ARE NEEDED FOR COULOMB POTINPC-260
     FENTIAL FOR WHICH THEECIS1559'/8X,'EXTRAPOLATION DOES NOT WORK WELLINPC-261
     G. IF ITS DEPTH IS GIVEN BY THE  ECIS1560'/8X,'INTEGRAL, (NINT NOT INPC-262
     H0), THESE VALUES DESCRIBE THE CHARGE',8X,'ECIS1561'/8X,'DISTRIBUTIINPC-263
     ION.',51X,'ECIS1562'/9X,'THE SIGN OF THE POTENTIALS IS THE ONE OF TINPC-264
     JHEIR DEPTH WHEN',6X,'ECIS1563'/8X,'WOODS-SAXON FORM FACTORS ARE USINPC-265
     KED FOR SCHROEDINGER EQUATIONS ANDECIS1564')                       INPC-266
      WRITE (MW,1072)                                                   INPC-267
 1072 FORMAT (8X,'FOR DIRAC EQUATION.',45X,'ECIS1565'/9X,'THE SPIN-ORBITINPC-268
     1 "CENTRAL" HAVE TO BE GIVEN AS 1/R D/DR(V(R))',4X,'ECIS1566'/8X,'EINPC-269
     2XCEPT IF ITS STRENGTH IS DEFINED BY ITS INTEGRAL OR IS FOLDED. ECIINPC-270
     3S1567'/9X,'THE SPIN-ORBIT TRANSITION POTENTIALS HAVE TO BE GIVEN AINPC-271
     4S V(R), ECIS1568'/8X,'FROM WHICH 1/R D/DR(V(R)) AND V(R)/R**2 ARE INPC-272
     5INTERNALLY COMPUTED.ECIS1569'/9X,'THE TWO MULTIPLICATIVE FACTORS OINPC-273
     6NLY CAN BE IN SEARCH OR CHANGEDECIS1570'/8X,'IF LO(34) WAS .TRUE. INPC-274
     7IN A PREVIOUS COMPUTATION.',17X,'ECIS1571'/72X,'ECIS1572'/'MULTIPLINPC-275
     8ICATIVE FACTOR',19X,'FORMAT (7F10.5)',17X,'ECIS1573'/'************INPC-276
     9*********',51X,'ECIS1574'/' IF NINT IS NOT NEGATIVE FOR A COPIED FINPC-277
     AORM FACTOR GO BACK TO',12X,'ECIS1575'/' "IDENTIFICATION" CARD.',49INPC-278
     BX,'ECIS1576'/7X,'1-10   MULTIPLICATIVE FACTOR FOR THE STRENGTH (MUINPC-279
     CST NOT BE 0.).  ECIS1577'/72X,'ECIS1578'/'PARAMETERS OF STANDARD FINPC-280
     DORM FACTORS',37X,'ECIS1579'/'***********************************',INPC-281
     E37X,'ECIS1580'/' ONLY IF L1X IS NOT POSITIVE AND ITYPX IS NEGATIVEINPC-282
     F, OTHERWISE GO TO',5X,'ECIS1581'/' NEXT "IDENTIFICATION CARD".',44INPC-283
     GX,'ECIS1582'/72X,'ECIS1583'/'IF ITYPX=-1 TO -6:',54X,'ECIS1584'/'*INPC-284
     H*****************',54X,'ECIS1585'/72X,'ECIS1586'/'PARAMETERS OF THINPC-285
     IE POTENTIAL',13X,'FORMAT (7F10.5)',17X,'ECIS1587'/'***************INPC-286
     J************',45X,'ECIS1588'/7X,'1-10   DEPTH OF POTENTIAL.',39X,'INPC-287
     KECIS1589')                                                        INPC-288
      WRITE (MW,1073)                                                   INPC-289
 1073 FORMAT (14X,'PRODUCT OF DEPTH AND DEFORMATION FOR A TRANSITION FORINPC-290
     1M',4X,'ECIS1590'/18X,'FACTOR.',47X,'ECIS1591'/14X,'PRODUCT OF CHARINPC-291
     2GES FOR COULOMB POTENTIAL.',17X,'ECIS1592'/14X,'PRODUCT OF CHARGESINPC-292
     3 AND DEFORMATION FOR COULOMB TRANSITION ECIS1593'/18X,'FORM FACTORINPC-293
     4.',42X,'ECIS1594'/6X,'11-20   RADIUS OF VOLUME POTENTIAL.',31X,'ECINPC-294
     5IS1595'/6X,'21-30   DIFFUSENESS OF VOLUME POTENTIAL.',26X,'ECIS159INPC-295
     66'/6X,'31-40   EXPONENTIATION FACTOR (THE FORM FACTOR IS AT THE POINPC-296
     7WER',4X,'ECIS1597'/18X,'1+THIS VALUE).',40X,'ECIS1598'/''/6X,'41-INPC-297
     850   THIRD PARAMETER OF A FERMI CHARGE DISTRIBUTION FOR A',6X,'ECIINPC-298
     9S1599'/14X,'COULOMB POTENTIAL.',40X,'ECIS1600'/72X,'ECIS1601'/'DEFINPC-299
     AORMATIONS FOR ITYPX=-5 OR -6',9X,'FORMAT (7F10.5)',17X,'ECIS1602'/INPC-300
     B'*******************************',41X,'ECIS1603'/7X,'1-10   DEFORMINPC-301
     CATION FOR L=1.',38X,'ECIS1604'/6X,'11-20   DEFORMATION FOR L=2.',3INPC-302
     D8X,'ECIS1605'/6X,'21-30   DEFORMATION FOR L=3.',38X,'ECIS1606'/6X,INPC-303
     E'31-40   DEFORMATION FOR L=4.',38X,'ECIS1607'/6X,'41-50   ........INPC-304
     F.. AND SO ON UP TO L2X ....',23X,'ECIS1608'/'  NOTE:  ODD AND EVENINPC-305
     G DEFORMATIONS ARE USED, STARTING BY L=1.',11X,'ECIS1609'/'  ****  INPC-306
     HTHE RADII MUST BE VALUES ALREADY MULTIPLIED BY A**(1/3).',8X,'ECISINPC-307
     I1610'/8X,'NO CHECK IS DONE ON PRODUCT OF CHARGES WHEN THEY ARE REAINPC-308
     JD OR TO ECIS1611'/8X,'PREVENT A SEARCH ON THEM.',39X,'ECIS1612'/72INPC-309
     KX,'ECIS1613'/'IF ITYPX=-7 OR -8:',54X,'ECIS1614')                 INPC-310
      WRITE (MW,1074)                                                   INPC-311
 1074 FORMAT ('******************',54X,'ECIS1615'/72X,'ECIS1616'/'QUANTUINPC-312
     1M NUMBERS',25X,'FORMAT (12I5)',19X,'ECIS1617'/'***************',57INPC-313
     2X,'ECIS1618'/'IF MLX=0 OR MLX=1, THE NUMBER OF NODES IS L2X AND THINPC-314
     3E QUANTUM NUMBERS   ECIS1619'/'ARE THOSE OF THE TRANSITION. IN THIINPC-315
     4S CASE, GO TO NEXT CARD.',13X,'ECIS1620'/'IF MLX=2 OR MLX=3:',54X,INPC-316
     5'ECIS1621'/7X,'1- 5   NP: NUMBER OF NODES OF THE FIRST BOUND FUNCTINPC-317
     6ION.',10X,'ECIS1622'/7X,'6-10   LP: ANGULAR MOMENTUM OF THE FIRST INPC-318
     7BOUND FUNCTION.',9X,'ECIS1623'/6X,'11-15   SP: VALUE OF 2*S FOR THINPC-319
     8E FIRST BOUND FUNCTION.',12X,'ECIS1624'/6X,'16-20   JP: VALUE OF 2INPC-320
     9*J FOR THE FIRST BOUND FUNCTION.',12X,'ECIS1625'/6X,'21-25   NH: NINPC-321
     AUMBER OF NODES OF THE SECOND BOUND FUNCTION.',9X,'ECIS1626'/6X,'26INPC-322
     B-30   LH: ANGULAR MOMENTUM OF THE SECOND BOUND FUNCTION.',8X,'ECISINPC-323
     C1627'/6X,'31-35   SH: VALUE OF 2*S FOR THE SECOND BOUND FUNCTION.'INPC-324
     D,11X,'ECIS1628'/6X,'36-40   JH: VALUE OF 2*J FOR THE SECOND BOUND INPC-325
     EFUNCTION.',11X,'ECIS1629'/6X,'41-45   NVC NOT 0 TO TAKE INTO ACCOUINPC-326
     FNT PARTICLE-HOLE COUPLING',5X,'ECIS1630'/18X,'(USED ONLY WITH SP=1INPC-327
     G AND SH=1).',23X,'ECIS1631'/72X,'ECIS1632'/'FOR ITYPX=-7:',27X,'FOINPC-328
     HRMAT (7F10.5)',17X,'ECIS1633'/'*************',59X,'ECIS1634'/7X,'1INPC-329
     I-10   OSCILLATOR PARAMETER FOR THE FIRST BOUND FUNCTION.',8X,'ECISINPC-330
     J1635'/6X,'11-20   TOTAL MASS (DEFAULT VALUE: TARGET MASS OF FIRST INPC-331
     KLEVEL).   ECIS1636')                                              INPC-332
      WRITE (MW,1075)                                                   INPC-333
 1075 FORMAT (6X,'21-30   MASS OF BOUND PARTICLE (DEFAULT VALUE 1.).',16INPC-334
     1X,'ECIS1637'/6X,'31-40   OSCILLATOR PARAMETER FOR THE SECOND BOUNDINPC-335
     2 FUNCTION.',7X,'ECIS1638'/6X,'41-50   TOTAL MASS (DEFAULT VALUE: TINPC-336
     3ARGET MASS OF FIRST LEVEL).   ECIS1639'/6X,'51-60   MASS OF BOUND INPC-337
     4PARTICLE (DEFAULT VALUE 1.).',16X,'ECIS1640'/'FOR MLX=0 OR 1 OR ITINPC-338
     5YPX=-8 WITH MLX=3, ONLY THE THREE FIRST PARAMETERS  ECIS1641'/'AREINPC-339
     6 READ. FOR MLX=2, IF THE SECOND OSCILLATOR PARAMETER IS 0., THE FIINPC-340
     7RSTECIS1642'/'ONE IS COPIED.',58X,'ECIS1643'/'ONLY, OSCILLATOR PARINPC-341
     8AMETERS CAN BE IN SEARCH OR CHANGED IF LO(34) WAS   ECIS1644'/'.TRINPC-342
     9UE. IN A PREVIOUS COMPUTATION.',39X,'ECIS1645'/72X,'ECIS1646'/'FORINPC-343
     A ITYPX=-8:',27X,'FORMAT (7F10.5)',17X,'ECIS1647'/'*************',5INPC-344
     B9X,'ECIS1648'/7X,'1-10   BINDING ENERGY. IF THIS VALUE IS NEGATIVEINPC-345
     C, THE BOUND STATEECIS1649'/14X,'IS REPLACED BY A SCATTERING STATE INPC-346
     DNORMALISED TO',11X,'ECIS1650'/14X,'SIN(KR+DELTA) AT INFINITY.',32XINPC-347
     E,'ECIS1651'/6X,'11-20   TOTAL MASS (DEFAULT VALUE: TARGET MASS OF INPC-348
     FFIRST LEVEL).   ECIS1652'/6X,'21-30   MASS OF BOUND PARTICLE (DEFAINPC-349
     GULT VALUE 1.).',16X,'ECIS1653'/6X,'31-40   PRODUCT OF CHARGES.',39INPC-350
     HX,'ECIS1654'/6X,'41-50   REAL POTENTIAL FOR UNBOUND STATES OR STARINPC-351
     ITING VALUE FOR   ECIS1655'/14X,'THE SEARCH ON BOUND STATE (DEFAULTINPC-352
     J VALUES 35 MEV).',8X,'ECIS1656'/''/6X,'51-60   REDUCED RADIUS OF INPC-353
     KREAL POTENTIAL.',25X,'ECIS1657')                                  INPC-354
      WRITE (MW,1076)                                                   INPC-355
 1076 FORMAT (6X,'61-70   DIFFUSENESS OF REAL POTENTIAL.',28X,'ECIS1658'INPC-356
     1/72X,'ECIS1659'/'ON NEXT CARD:',27X,'FORMAT (7F10.5)',17X,'ECIS166INPC-357
     20'/'*************',59X,'ECIS1661'/7X,'1-10   DEPTH OF SPIN-ORBIT PINPC-358
     3OTENTIAL.',28X,'ECIS1662'/6X,'11-20   REDUCED RADIUS OF SPIN-ORBITINPC-359
     4 POTENTIAL.',19X,'ECIS1663'/6X,'21-30   DIFFUSENESS OF SPIN-ORBIT INPC-360
     5POTENTIAL.',22X,'ECIS1664'/6X,'31-40   REDUCED RADIUS OF COULOMB PINPC-361
     6OTENTIAL.',22X,'ECIS1665'/'FOR MLX=2, GO BACK TO "FOR ITYPX=-8:".'INPC-362
     7,34X,'ECIS1666'/'FOR MLX=3, GO BACK TO "FOR ITYPX=-7:" TO READ ONEINPC-363
     8 OSCILLATOR PARAMETER. ECIS1667'/'  NOTE:  REDUCED RADII ARE USED INPC-364
     9FOR ITYPX=-8.',27X,'ECIS1668'/'  ****  USING THE PRODUCT OF TWO BOINPC-365
     AUND FUNCTIONS, THEIR COUPLING TO THE ECIS1669'/8X,'ANGULAR MOMENTUINPC-366
     BM OF THE TRANSITION IS COMPUTED BY THE CODE ONLY ECIS1670'/8X,'IF INPC-367
     CTHEIR SPINS ARE BOTH 1/2 AND THE NUCLEAR MATRIX ELEMENT',6X,'ECIS1INPC-368
     D671'/8X,'SHOULD BE THE STRENGTH OF THE INTERACTION. FOR SPINS NOT INPC-369
     E1/2,   ECIS1672'/8X,'THIS COUPLING SHOULD BE INCLUDED IN THE NUCLEINPC-370
     FAR MATRIX ELEMENT. ECIS1673'/72X,'ECIS1674'/'IF ITYPX=-9 OR -10:',INPC-371
     G53X,'ECIS1675'/'*******************',53X,'ECIS1676'/72X,'ECIS1677'INPC-372
     H/'STRENGTHS',31X,'FORMAT (7F10.5)',17X,'ECIS1678'/'*********',63X,INPC-373
     I'ECIS1679'/7X,'1-10   STRENGTH OF THE INTEGRAL WITH R**(L+2). (FORINPC-374
     J COULOMB',6X,'ECIS1680'/14X,'POTENTIALS AND COUPLINGS, GIVE THE DEINPC-375
     KSCRIPTION OF',9X,'ECIS1681')                                      INPC-376
      WRITE (MW,1077)                                                   INPC-377
 1077 FORMAT (14X,'CHARGE DENSITY OR TRANSITION. THE STRENGTH MUST BE',8INPC-378
     1X,'ECIS1682'/14X,'GIVEN. FOR POTENTIALS, IT IS THE PRODUCT OF CHARINPC-379
     2GES).',5X,'ECIS1683'/6X,'11-20   FOR ITYPX=-9, RADIAL EXTENSION OFINPC-380
     3 BESSEL FUNCTION',9X,'ECIS1684'/14X,'(DEFAULT VALUE MATCHING RADIUINPC-381
     4S).',26X,'ECIS1685'/14X,'FOR ITYPX=-10, PARAMETER B OF LAGUERRE POINPC-382
     5LYNOMIAL',9X,'ECIS1686'/14X,'(DEFAULT VALUE 1). THE POTENTIAL IS SINPC-383
     6UM ON N OF',11X,'ECIS1687'/14X,'X**L L(L+1/2,N,X**2) EXP(-X**2/2) INPC-384
     7WHERE X=R/B.',12X,'ECIS1688'/6X,'21-30   STRENGTH OF FIRST BESSEL INPC-385
     8FUNCTION/LAGUERRE POLYNOMIAL.',4X,'ECIS1689'/6X,'31-40   STRENGTH INPC-386
     9OF SECOND BESSEL FUNCTION/LAGUERRE POLYNOMIAL.   ECIS1690'/6X,'41-INPC-387
     A50   STRENGTH OF THIRD BESSEL FUNCTION/LAGUERRE POLYNOMIAL.',4X,'EINPC-388
     BCIS1691'/6X,'51-60   STRENGTH OF FOURTH BESSEL FUNCTION/LAGUERRE PINPC-389
     COLYNOMIAL.   ECIS1692'/6X,'61-70   STRENGTH OF FIFTH BESSEL FUNCTIINPC-390
     DON/LAGUERRE POLYNOMIAL.',4X,'ECIS1693'/72X,'ECIS1694'/' EVENTUALLYINPC-391
     E, ON NEXT CARD:',14X,'FORMAT (7F10.5)',17X,'ECIS1695'/' **********INPC-392
     F***************',46X,'ECIS1696'/7X,'1-10   STRENGTH OF SIXTH BESSEINPC-393
     GL FUNCTION/LAGUERRE POLYNOMIAL.',4X,'ECIS1697'/6X,'11-20   STRENGTINPC-394
     HH OF SEVENTH BESSEL FUNCTION/LAGUERRE POLYNOMIAL.  ECIS1698'/6X,'2INPC-395
     I1-30   .......... AND SO ON UP TO L2X ....',23X,'ECIS1699'/'  NOTEINPC-396
     J:  WITH BESSEL FUNCTION OR LAGUERRE POLYNOMIAL OR LAGUERRE, GIVE  INPC-397
     KECIS1700')                                                        INPC-398
      WRITE (MW,1078)                                                   INPC-399
 1078 FORMAT ('  ****  THE SPIN-ORBIT V(R) AND NEVER 1/R D/DR V(R). THE INPC-400
     1LAGUERRE',7X,'ECIS1701'/8X,'POLYNOMIALS ARE X**L EXP(-X**2) L^(L+1INPC-401
     2/2)_N(2X**2) WHERE X=R/B  ECIS1702'/8X,'(UNNORMALISED POLYNOMIALS INPC-402
     3AS DEFINED IN BATEMAN OR ABRAMOWITZ,  ECIS1703'/8X,'WITH A PARAMETINPC-403
     4ER B INVERSE OF THE HARMONIC OSCILLATOR PARAMETER)ECIS1704'/9X,'THINPC-404
     5E PROGRAM STOPS IF FORM FACTORS ARE MISSING.',17X,'ECIS1705'/72X,'INPC-405
     6ECIS1706'/'FOLDING PARAMETERS',22X,'FORMAT (7E10.5)',17X,'ECIS1707INPC-406
     7'/'******************',54X,'ECIS1708'/' IF THE MAXIMUM POSITIVE VAINPC-407
     8LUE OF "NFOLD" READ IN COLUMNS 46-50 OF THE  ECIS1709'/' IDENTIFICINPC-408
     9ATION CARDS IS N, READ N TIMES:',31X,'ECIS1710'/7X,'1-10   "V"',6XINPC-409
     A,'PARAMETER',40X,'ECIS1711'/6X,'11-20   "R"',6X,'PARAMETER',40X,'EINPC-410
     BCIS1712'/6X,'21-30   "A"',6X,'PARAMETER',40X,'ECIS1713'/'FOR EXPLAINPC-411
     CNATIONS, SEE "CARDS READ IN SUBROUTINE LECT".',18X,'ECIS1714'/72X,INPC-412
     D'ECIS1715'/72X,'ECIS1716'/''/'CARDS READ IN SUBROUTINE LDIS',43X,INPC-413
     E'ECIS1717'/'*****************************',43X,'ECIS1718'/' ONLY IINPC-414
     FF LO(10)=.TRUE., OTHERWISE GO TO "CARDS READ IN SUBROUTINE DISP".EINPC-415
     GCIS1719'/72X,'ECIS1720'/'FOR EACH POTENTIAL:',53X,'ECIS1721'/72X,'INPC-416
     HECIS1722'/'DISPERSION PARAMETERS (INTEGER)',9X,'FORMAT (14I5)',19XINPC-417
     I,'ECIS1723'/'*******************************',41X,'ECIS1724'/7X,'1INPC-418
     J- 5   IPP(1)   1 ENERGIES IN LABORATORY SYSTEM, ANYTHING FOR',4X,'INPC-419
     KECIS1725'/23X,'CENTRE OF MASS ENERGY.',27X,'ECIS1726')            INPC-420
      WRITE (MW,1079)                                                   INPC-421
 1079 FORMAT (7X,'6-10   IPP(2)   N2 WITH |N2| POWER IN LARGE NEGATIVE EINPC-422
     1NERGY',6X,'ECIS1727'/23X,'CORRECTION TERM. FOR NEGATIVE VALUE, AN'INPC-423
     2,10X,'ECIS1728'/23X,'APPROXIMATION DESCRIBED BELOW IS USED',12X,'EINPC-424
     3CIS1729'/23X,'(SEE POSITIVE VALUES OF NV).',21X,'ECIS1730'/6X,'11-INPC-425
     415   IPP(3)   NV WITH |NV| POWER FOR VOLUME/SCALAR POTENTIAL.  ECIINPC-426
     5S1731'/6X,'16-20   IPP(4)   NS WITH |NS| POWER FOR SURFACE/VECTOR INPC-427
     6POTENTIAL. ECIS1732'/6X,'21-25   IPP(5)   NL WITH |NL| POWER FOR SINPC-428
     7PIN-ORBIT OR TENSOR',6X,'ECIS1733'/23X,'POTENTIAL. N2, NV, NS AND INPC-429
     8NL MUST BE EVEN.',7X,'ECIS1734'/6X,'26-30   IPP(6)   0: COEFFICIENINPC-430
     9TS COMPUTED.',24X,'ECIS1735'/23X,'ANY OTHER VALUE: COEFFICIENTS GIINPC-431
     AVEN BY THE USER. ECIS1736'/14X,'IPP(1) TO IPP(6) ARE EQUIVALENT TOINPC-432
     B PIP(1) TO PIP(3).',6X,'ECIS1737'/72X,'ECIS1738'/'DISPERSION PARAMINPC-433
     CETERS (FLOATING)',8X,'FORMAT (7F10.5)',17X,'ECIS1739'/'***********INPC-434
     D*********************',40X,'ECIS1740'/' IF IPP(6) IS 0 IN PREVIOUSINPC-435
     E CARD, OTHERWISE GO TO "END OF DO-LOOP',7X,'ECIS1741'/' FOR POTENTINPC-436
     FIALS".',55X,'ECIS1742'/7X,'1-10   PIP(4)   ENERGY FOR WHICH THE IMINPC-437
     GAGINARY DEPTHS ARE READ   ECIS1743'/23X,'(DEFAULT VALUE: ENERGY OFINPC-438
     H THE FIRST LEVEL USING  ECIS1744'/23X,'THIS POTENTIAL).',33X,'ECISINPC-439
     I1745'/6X,'11-20   PIP(5)   EF FERMI ENERGY. (DEFAULT VALUE -6.8 MEINPC-440
     JV).',7X,'ECIS1746'/6X,'21-30   PIP(6)   EP THRESHOLD ENERGY (DEFAUINPC-441
     KLT VALUE PIP(5)=EF).   ECIS1747')                                 INPC-442
      WRITE (MW,1080)                                                   INPC-443
 1080 FORMAT (6X,'31-40   PIP(7)   EA LARGE ENERGY STARTING VALUE ABOVE INPC-444
     1PIP(5)=EF)  ECIS1748'/6X,'41-50   PIP(8)   AVSO EXPONENTIAL DECREAINPC-445
     2SE OF REAL SPIN-ORBIT.',4X,'ECIS1749'/6X,'51-60   PIP(9)   AWSO LIINPC-446
     3NEAR DECREASE OF IMAGINARY SPIN-ORBIT.',4X,'ECIS1750'/6X,'61-70   INPC-447
     4PIP(10)  BV CONSTANT FOR VOLUME OR SCALAR POTENTIAL.',6X,'ECIS1751INPC-448
     5'/72X,'ECIS1752'/'NEXT CARD',31X,'FORMAT (7F10.5)',17X,'ECIS1753'/INPC-449
     6'*********',63X,'ECIS1754'/7X,'1-10   PIP(11)   ALP COEFFICIENT OFINPC-450
     7 LARGE POSITIVE ENERGY TERM   ECIS1755'/24X,'IN VOLUME POTENTIAL.'INPC-451
     8,28X,'ECIS1756'/24X,'SECOND BV'' PARAMETER FOR VOLUME POTENTIALS IINPC-452
     9F   ECIS1757'/24X,'NV<0 (DEFAULT VALUE 2*BV).',22X,'ECIS1758'/6X,'INPC-453
     A11-20   PIP(12)   CV EXPONENTIAL DECREASE (IN |E| FOR POSITIVE',4XINPC-454
     B,'ECIS1759'/24X,'VALUES OF CV OR IN SQRT|E| FOR NEGATIVE VALUES) EINPC-455
     CCIS1760'/24X,'FOR LARGE ENERGY TERMS OF VOLUME POTENTIALS OR  ECISINPC-456
     D1761'/24X,'FV FRACTION OF THE FIRST TERM IF NV<0.',10X,'ECIS1762'/INPC-457
     E6X,'21-30   PIP(13)   BS CONSTANT FOR SURFACE OR VECTOR POTENTIAL.INPC-458
     F',4X,'ECIS1763'/6X,'31-40   PIP(14)   CS EXPONENTIAL DECREASE OF AINPC-459
     G SURFACE POTENTIAL. ECIS1764'/24X,'SECOND BS'' PARAMETER FOR SURFAINPC-460
     HCE POTENTIALS IF  ECIS1765'/24X,'NS<0 (DEFAULT VALUE 2*BW).',22X,'INPC-461
     IECIS1766'/6X,'41-50   PIP(15)   CR NON-LOCALITY RANGE PARAMETER OFINPC-462
     J SURFACE',6X,'ECIS1767'/24X,'POTENTIAL OR FRACTION IN THE FIRST TEINPC-463
     KRM IF NS<0.ECIS1768')                                             INPC-464
      WRITE (MW,1081)                                                   INPC-465
 1081 FORMAT (6X,'51-60   PIP(16)   BL CONSTANT FOR SPIN-ORBIT OR TENSORINPC-466
     1 POTENTIAL. ECIS1769'/6X,'61-70   PIP(17)   AHF EXPONENTIAL DECREAINPC-467
     2SE OF H.F. REAL VOLUME',4X,'ECIS1770'/24X,'POTENTIAL.',38X,'ECIS17INPC-468
     371'/72X,'ECIS1772'/'  NOTE:  THERE ARE NINE COEFFICIENTS FOR DISPEINPC-469
     4RSION, WW(1) TO WW(9),',4X,'ECIS1773'/'  **** COMPUTED IN SUBROUTIINPC-470
     5NE DISP AND STORE FROM WV(14) TO WV(22). THE ECIS1774'/7X,'POTENTIINPC-471
     6ALS GIVEN BEEN VVR(R), VVI(R), VSR(R), VSI(R), VLR(R) AND ECIS1775INPC-472
     7'/7X,'VLI(R), THE POTENTIALS USED ARE:',33X,'ECIS1776'/''/8X,'WVRINPC-473
     8(R)=VRR(R)*(1+WW(3))+WW(2)*VRI(R)',5X,'WVI(R)=VVI(R)*(1+WW(1))ECISINPC-474
     91777'/8X,'WSR(R)=VSR(R)*(1+WW(6))+WW(5)*VSI(R)',5X,'WSI(R)=VSI(R)*INPC-475
     A(1+WW(4))ECIS1778'/8X,'WLR(R)=VLR(R)*(1+WW(9))+WW(8)*VLI(R)',5X,'WINPC-476
     BLI(R)=VLI(R)*(1+WW(7))ECIS1779'/7X,'NOTE THAT WW(6) IS ZERO IN THEINPC-477
     C MODELS USED IN THE CODE.',10X,'ECIS1780'/7X,'NOTE ALSO THAT THE DINPC-478
     DEPTHS READ FOR THE REAL POTENTIALS MUST BE   ECIS1781'/7X,'THE ONEINPC-479
     ES NEEDED AT THE REFERENCE ENERGY, WITHOUT THE DISPERSIVE  ECIS1782INPC-480
     F'/7X,'CONTRIBUTIONS INVOLVING THE ADDITION OF THE IMAGINARY FORM',INPC-481
     G7X,'ECIS1783'/7X,'FACTORS AND THE DEPTHS OF IMAGINARY POTENTIAL THINPC-482
     HOSE NEEDED AT',4X,'ECIS1784'/7X,'THE REFERENCE ENERGY.',44X,'ECIS1INPC-483
     I785'/72X,'ECIS1786'/'EXPLANATION OF DISPERSION PARAMETERS:',35X,'EINPC-484
     JCIS1787'/'*************************************',35X,'ECIS1788')  INPC-485
      WRITE (MW,1082)                                                   INPC-486
 1082 FORMAT ('FOR POSITIVE VALUES OF NV: THE VOLUME IMAGINARY POTENTIALINPC-487
     1 AT THE ENERGY ECIS1789'/'************************** E IS ASSUMED INPC-488
     2TO BE SUCH THAT "V(2*EF-E)=V(E)"ECIS1790'/4X,'WITH "V(E)=V*(E-EF)*INPC-489
     3*NV/((E-EF)**NV+BV**NV)" WITH ADDITION FOR',6X,'ECIS1791'/4X,'E>EFINPC-490
     4+EA OF "ALP*[SQRT(E)+.5*SQRT(EF+EA)*(EF+EA-3*E)/E" (USUALLY',5X,'EINPC-491
     5CIS1792'/4X,'WRITTEN "ALP*[SQRT(E)+.5*(EF+EA)**(3/2)/E-1.5*SQRT(EFINPC-492
     6+EA)]") AND',4X,'ECIS1793'/4X,'FOR E<EF-EA OF "-V(E)*(EF-E-EA)**N2INPC-493
     7/((EF-E-EA)**N2+EA**N2)" WHERE   ECIS1794'/4X,'V(E) WAS GIVEN ABOVINPC-494
     8E; FOR NEGATIVE VALUES OF N2, V(E) IS REPLACED   ECIS1795'/4X,'BY INPC-495
     9V(EF-EA) BUT NOTE THAT THIS EXPRESSION IS VERY DIFFERENT AND',5X,'INPC-496
     AECIS1796'/4X,'V(E) SHOULD BE REPLACED BY V(-INFINITY) TO GIVE A GOINPC-497
     BOD',14X,'ECIS1797'/4X,'APPROXIMATION. THESE EXPRESSION CAN BE DAMPINPC-498
     CED BY A FACTOR',11X,'ECIS1798'/4X,'"EXP[-|CV|*SQRT(E-EF-EA)]" IF "INPC-499
     DCV"<0 AND "EXP[-CV*SQRT(EF-EA-E)]"   ECIS1799'/4X,'IF "CV">0. THE INPC-500
     EVALUE OF "V" IS SUCH THAT THIS GIVES THE STRENGTH',4X,'ECIS1800'/4INPC-501
     FX,'OF V(E) READ (INCLUDING LARGE POSITIVE ENERGY TERM) AT THE ENERINPC-502
     GGY   ECIS1801'/4X,'PIP(4). THE REAL VOLUME POTENTIAL WITH THE SAMEINPC-503
     H GEOMETRY, OBTAINED  ECIS1802'/4X,'BY DISPERSION RELATION (AS DESCINPC-504
     IRIBED BY C. MAHAUX AND R. SARTOR IN  ECIS1803'/4X,'NUCL. PHYS A528INPC-505
     J (1991) 253), IS ADDED TO THE REAL POTENTIAL.',8X,'ECIS1804')     INPC-506
      WRITE (MW,1083)                                                   INPC-507
 1083 FORMAT ('FOR POSITIVE VALUES OF NS: THE SURFACE IMAGINARY POTENTIAINPC-508
     1L "W(E)" IN THEECIS1805'/'************************** SCHROEDINGER INPC-509
     2FORMALISM IS ASSUMED TO HAVE THEECIS1806'/4X,'SAME ENERGY DEPENDENINPC-510
     3CE AS "V(E)" GIVEN ABOVE MULTIPLIED BY',10X,'ECIS1807'/4X,'"EXP[-CINPC-511
     4S*|E-EF|-CR*(E-EF)]". THE NON-LOCALITY RANGE PARAMETER "CR"  ECIS1INPC-512
     5808'/4X,'IS THE INVERSE OF "EB" GIVEN BY EQUATIONS (3.17) AND (3.1INPC-513
     68) OF',6X,'ECIS1809'/4X,'C. MAHAUX AND R. SARTOR IN NUCL. PHYS A45INPC-514
     78 (1986) 25. THE REAL',6X,'ECIS1810'/4X,'SURFACE POTENTIAL WITH THINPC-515
     8E SAME GEOMETRY, OBTAINED BY DISPERSION',4X,'ECIS1811'/4X,'RELATIOINPC-516
     9N IS ADDED TO THE REAL POTENTIAL. THERE IS NOT THE DEFAULT   ECIS1INPC-517
     A812'/4X,'VALUE CR=.0125 TO ALLOW TO USE 0.',35X,'ECIS1813'/'FOR POINPC-518
     BSITIVE VALUES OF NL: THE SPIN-ORBIT IMAGINARY POTENTIAL IS',8X,'ECINPC-519
     CIS1814'/'************************** "LS(E)=LS*(E-EF)**NL/((E-EF)**INPC-520
     DNL+BL**NL)"',4X,'ECIS1815'/4X,'WITH THE CONSTANT "LS" SUCH THAT "LINPC-521
     ES(E)" BE EQUAL TO THE STRENGTH   ECIS1816'/4X,'OF THE IMAGINARY SPINPC-522
     FIN-ORBIT AT THE ENERGY PIP(4). THE REAL',10X,'ECIS1817'/4X,'SPIN-OINPC-523
     GRBIT POTENTIAL WITH THE SAME GEOMETRY, OBTAINED BY DISPERSION ECISINPC-524
     H1818'/4X,'RELATION IS ADDED TO THE REAL POTENTIAL WHICH IS DAMPED INPC-525
     IBY A FACTOR ECIS1819'/4X,'"EXP[-AVSO*(E-EF)]".',48X,'ECIS1820'/'FOINPC-526
     JR NEGATIVE VALUES OF NV: THE VOLUME IMAGINARY POTENTIAL IS ASSUMEDINPC-527
     K TO ECIS1821')                                                    INPC-528
      WRITE (MW,1084)                                                   INPC-529
 1084 FORMAT ('************************** BE THE SUM OF TWO TERMS SIMILAINPC-530
     1R TO "V(E)"',4X,'ECIS1822'/4X,'USED FOR POSITIVE VALUES, WITH THE INPC-531
     2POWER |NV| AND THE PARAMETERS BV ECIS1823'/4X,'AND BV'' RESPECTIVEINPC-532
     3LY. THE STRENGTHS ARE SUCH THAT THE FIRST TERM IS ECIS1824'/4X,'FVINPC-533
     4 TIMES THE VALUE READ AT THE ENERGY PIP(3).',23X,'ECIS1825'/'FOR NINPC-534
     5EGATIVE VALUES OF NS: THE SURFACE IMAGINARY POTENTIAL IS THE',7X,'INPC-535
     6ECIS1826'/'************************** DIFFERENCE OF TWO TERMS SIMIINPC-536
     7LAR TO THOSE USEDECIS1827'/4X,'FOR POSITIVE VALUES OF NV, WITH THEINPC-537
     8 POWER |NS|, THE PARAMETERS BS,  ECIS1828'/4X,'BS'' RESPECTIVELY AINPC-538
     9ND THE SAME STRENGTH.',29X,'ECIS1829'/'FOR NEGATIVE VALUES OF NL: INPC-539
     ATHE SPIN-ORBIT IMAGINARY POTENTIAL IS THE',4X,'ECIS1830'/'********INPC-540
     B****************** SAME AS FOR POSITIVE VALUES OF NL. THE REAL  ECINPC-541
     CIS1831'/4X,'POTENTIAL IS DAMPED BY A FACTOR "EXP[-AVSO*(E-EF)]" BUINPC-542
     DT NO',10X,'ECIS1832'/4X,'DISPERSIVE CONTRIBUTION IS ADDED.',35X,'EINPC-543
     ECIS1833'/'FOR ZERO VALUES OF NL: THE SPIN-ORBIT REAL POTENTIAL IS INPC-544
     FAS FOR NEGATIVE ECIS1834'/'********************** VALUES OF NL. THINPC-545
     GE IMAGINARY POTENTIAL IS LINEAR  ECIS1835'/4X,'IN ENERGY WITH THE INPC-546
     HCOEFFICIENT "AWSO".',30X,'ECIS1836'/''/6X,'THE VECTOR DISPERSIVE INPC-547
     IPOTENTIAL OF THE DIRAC FORMALISM IS TREATED ECIS1837'/4X,'AS THE SINPC-548
     JCALAR ONE WITHOUT LARGE ENERGY TERMS.',23X,'ECIS1838')            INPC-549
      WRITE (MW,1085)                                                   INPC-550
 1085 FORMAT (6X,'THE POWERS NV, NS, NL AND N2 MUST BE EVEN. INPUT OF 0 INPC-551
     1SUPPRESSES  ECIS1839'/4X,'THE USE OF DISPERSION RELATION FOR THE CINPC-552
     2ORRESPONDING POTENTIAL.',5X,'ECIS1840'/72X,'ECIS1841'/72X,'ECIS184INPC-553
     32'/'CARDS READ IN SUBROUTINE DISP',43X,'ECIS1843'/'***************INPC-554
     4**************',43X,'ECIS1844'/' ONLY IF LO(10)=.TRUE. AND IF FOR INPC-555
     5A LEVEL FOR WHICH THE DISPERSION',6X,'ECIS1845'/'PARAMETERS WERE RINPC-556
     6EAD WITH IPP(6) NOT 0, OTHERWISE GO TO "CARDS READ IN  ECIS1846'/'INPC-557
     7SUBROUTINE EVAL". FOR EACH LEVEL:',39X,'ECIS1847'/72X,'ECIS1848'/'INPC-558
     8DISPERSION COEFFICIENTS',17X,'FORMAT (6F10.5)',17X,'ECIS1849'/'***INPC-559
     9********************',49X,'ECIS1850'/7X,'1-10   WW(1)',5X,'INCREASINPC-560
     AE OF VOLUME/SCALAR IMAGINARY POTENTIAL,  ECIS1851'/6X,'11-20   WW(INPC-561
     B2)',5X,'CORRECTION TO VOLUME/SCALAR REAL POTENTIAL,',5X,'ECIS1852'INPC-562
     C/6X,'21-30   WW(3)',5X,'INCREASE OF VOLUME/SCALAR REAL POTENTIAL,'INPC-563
     D,7X,'ECIS1853'/6X,'31-40   WW(4)',5X,'INCREASE OF SURFACE/VECTOR IINPC-564
     EMAGINARY POTENTIAL, ECIS1854'/6X,'41-50   WW(5)',5X,'CORRECTION TOINPC-565
     F SURFACE/VECTOR REAL POTENTIAL,',4X,'ECIS1855'/6X,'51-60   WW(6)',INPC-566
     G5X,'INCREASE OF SURFACE/VECTOR REAL POTENTIAL,',6X,'ECIS1856'/72X,INPC-567
     H'ECIS1857'/'ON NEXT CARD:',27X,'FORMAT (3F10.5)',17X,'ECIS1858'/'*INPC-568
     I************',59X,'ECIS1859'/7X,'1-10   WW(7)',5X,'INCREASE OF SP-INPC-569
     JO/TENSOR IMAGINARY POTENTIAL,',4X,'ECIS1860'/6X,'11-20   WW(8)',5XINPC-570
     K,'INCREASE OF SP-O/TENSOR REAL POTENTIAL.',9X,'ECIS1861')         INPC-571
      WRITE (MW,1086)                                                   INPC-572
 1086 FORMAT (6X,'21-30   WW(9)',5X,'CORRECTION TO SP-O/TENSOR REAL POTEINPC-573
     1NTIAL.',7X,'ECIS1862'/72X,'ECIS1863'/'  NOTE:  SUCH SETS OF COEFFIINPC-574
     2CIENTS HAVE TO BE GIVEN FOR ALL LEVELS USINGECIS1864'/'  ****  A PINPC-575
     3OTENTIAL FOR WHICH IPP(6) IS NOT 0. FOR A COMPOUND CONTINUUM ECIS1INPC-576
     4865'/8X,'FOUR SUCH SETS FOR DIFFERENT ENERGIES HAVE TO BE GIVEN FOINPC-577
     5R',6X,'ECIS1866'/8X,'INTERPOLATION AFTER THE FOLLOWING CARD:',25X,INPC-578
     6'ECIS1867'/72X,'ECIS1868'/'ENERGIES FOR INTERPOLATION',14X,'FORMATINPC-579
     7 (4F10.5)',17X,'ECIS1869'/'**************************',46X,'ECIS18INPC-580
     870'/' ENERGIES FOR WHICH THE FOUR FOLLOWING SETS OF COEFFICIENTS AINPC-581
     9PPLY.',6X,'ECIS1871'/7X,'1-10   EN(1)',5X,'ENERGY OF THE FIRST SETINPC-582
     A.',24X,'ECIS1872'/6X,'11-20   EN(2)',5X,'ENERGY OF THE SECOND SET.INPC-583
     B',23X,'ECIS1873'/6X,'21-30   EN(3)',5X,'ENERGY OF THE THIRD SET.',INPC-584
     C24X,'ECIS1874'/6X,'31-40   EN(4)',5X,'ENERGY OF THE FOURTH SET.',2INPC-585
     D3X,'ECIS1875'/72X,'ECIS1876'/'FOR A COMPUTATION CHANGING ONLY ENERINPC-586
     EGY AND SOME PARAMETERS, THESE DATA  ECIS1877'/'MUST BE READ AGAIN.INPC-587
     F THESE DATA CANNOT BE IN SEARCH.',21X,'ECIS1878'/72X,'ECIS1879'/72INPC-588
     GX,'ECIS1880'/'CARDS READ IN SUBROUTINE EVAL',43X,'ECIS1881'/'*****INPC-589
     H************************',43X,'ECIS1882'/3X,'IF LO(34)=.TRUE., OTHINPC-590
     IERWISE GO TO THE BEGINNING OF ANOTHER DATA SET. ECIS1883'/72X,'ECIINPC-591
     JS1884'/'NUMBER OF CHANGES',23X,'FORMAT (2L1,I3,I5,F10.5)',8X,'ECISINPC-592
     K1885'/'*****************',55X,'ECIS1886')                         INPC-593
      WRITE (MW,1087)                                                   INPC-594
 1087 FORMAT (10X,'1   LO(34)',5X,'.TRUE. FOR OTHER CALLS TO THIS SUBROUINPC-595
     1TINE',6X,'ECIS1887'/25X,'.FALSE. FOR THE LAST CALL.',21X,'ECIS1888INPC-596
     2'/10X,'2   LX',9X,'.TRUE. TO READ ANOTHER TITLE',19X,'ECIS1889'/7XINPC-597
     3,'3- 5   NIN',8X,'NUMBER OF PARAMETERS TO CHANGE.',16X,'ECIS1890'/INPC-598
     47X,'6-10   NEX',8X,'INDICATION FOR THE USE OF THE VALUES TO BE REAINPC-599
     5DECIS1891'/27X,'>0  INCREMENTS',31X,'ECIS1892'/27X,'=0  NEW VALUESINPC-600
     6',31X,'ECIS1893'/27X,'<0  PERCENTAGE OF INCREASE',19X,'ECIS1894'/6INPC-601
     7X,'11-20   ECH',8X,'NEW SEARCH SCALE. (DEFAULT VALUE 20.)',10X,'ECINPC-602
     8IS1895'/72X,'ECIS1896'/''/'CARD 1',34X,'FORMAT (18A4)',19X,'ECIS1INPC-603
     9897'/'******',66X,'ECIS1898'/'IF LX=.TRUE.  NEW TITLE WHICH WILL BINPC-604
     AE PRINTED AS HEADING OF RESULTS.',4X,'ECIS1899'/72X,'ECIS1900'/'IDINPC-605
     BENTIFICATIONS',25X,'FORMAT (14I5)',19X,'ECIS1901'/'***************INPC-606
     C',57X,'ECIS1902'/7X,'1- 5   INDEX OF FIRST PARAMETER.',33X,'ECIS19INPC-607
     D03'/7X,'6-10   INDEX OF SECOND PARAMETER.',32X,'ECIS1904'/6X,'11-1INPC-608
     E5   ........................',34X,'ECIS1905'/10X,'UP TO NIN VALUESINPC-609
     F, EVENTUALLY ON OTHER CARDS, STARTING IN 1-5. ECIS1906'/'  NOTE:  INPC-610
     GA NEGATIVE VALUE IS REPLACED BY ZERO.',26X,'ECIS1907'/'  ****  INDINPC-611
     HEX ZERO IS THE TOTAL ENERGY.',33X,'ECIS1908'/9X,'THE OTHER INDICESINPC-612
     I ARE THE SAME AS THE ONES USED FOR SEARCH,',4X,'ECIS1909'/8X,'WITHINPC-613
     J THE LIMITATIONS ALREADY DESCRIBED.',25X,'ECIS1910'/72X,'ECIS1911'INPC-614
     K/'NEW VALUES',30X,'FORMAT (7F10.5)',17X,'ECIS1912')               INPC-615
      WRITE (MW,1088)                                                   INPC-616
 1088 FORMAT ('**********',62X,'ECIS1913'/7X,'1-10   FIRST NEW PARAMETERINPC-617
     1.',38X,'ECIS1914'/6X,'11-20   SECOND NEW PARAMETER.',37X,'ECIS1915INPC-618
     2'/6X,'21-30   ....................',38X,'ECIS1916'/'  IF LO(34)=.TINPC-619
     3RUE. GO AGAIN TO "CARDS READ IN SUBROUTINE EVAL".',9X,'ECIS1917'/'INPC-620
     4  IF LO(34)=.FALSE. GO TO THE BEGINNING OF NEXT DATA SET.',15X,'ECINPC-621
     5IS1918'/'  NOTE:  THERE ARE DIFFERENT USES OF THIS POSSIBILITY:',1INPC-622
     68X,'ECIS1919'/'  *****  1) AS A SEARCH STOPS USUALLY BEFORE THE MIINPC-623
     7NIMUM, IT CAN BE',5X,'ECIS1920'/8X,'REFINED BY USING NEX POSITIVE INPC-624
     8AND INTRODUCING AN INCREMENT "0." ECIS1921'/8X,'FOR ANY PARAMETER,INPC-625
     9 IN SEARCH OR NOT IN SEARCH.',18X,'ECIS1922'/9X,'2) WHEN SEARCHINGINPC-626
     A THE MINIMUM OF THE CHI2 AS A FUNCTION OF SOMEECIS1923'/8X,'FIXED INPC-627
     BPARAMETER. THE NEXT SEARCH STARTS WITH THE VALUES OF THE  ECIS1924INPC-628
     C'/8X,'PARAMETERS IN SEARCH OBTAINED IN THE LAST SEARCH.',15X,'ECISINPC-629
     D1925'/9X,'3) WHEN SOME RESULT MUST BE OBTAINED FOR DIFFERENT VALUEINPC-630
     ES OF   ECIS1926'/8X,'THE PARAMETERS.',49X,'ECIS1927'/72X,'ECIS1928INPC-631
     F'/72X,'ECIS1929'/'RESTART INPUT: CARDS READ IN SUBROUTINE REST',28INPC-632
     GX,'ECIS1930'/'********************************************',28X,'EINPC-633
     HCIS1931'/72X,'ECIS1932'/'RESTART CONDITIONS',22X,'FORMAT (L1,I4,5XINPC-634
     I,2F10.5)',8X,'ECIS1933'/'******************',54X,'ECIS1934'/10X,'1INPC-635
     J   LO(35)  THE ONLY CONTROL WHICH CAN BE CHANGED, ALL THE',4X,'ECIINPC-636
     KS1935'/14X,'OTHERS BEING THOSE OF LAST RUN.',27X,'ECIS1936')      INPC-637
      WRITE (MW,1089)                                                   INPC-638
 1089 FORMAT (7X,'2- 5   NEW MAXIMUM NUMBER OF EVALUATIONS.',24X,'ECIS19INPC-639
     137'/6X,'11-20   NEW VALUE OF ECH.',41X,'ECIS1938'/6X,'11-20   NEW INPC-640
     2VALUE OF RAP.',41X,'ECIS1939'/14X,'IF THEY ARE LESS THAN 1., ECH OINPC-641
     3R RAP ARE NOT CHANGED.',5X,'ECIS1940'/72X,'ECIS1941'/72X,'ECIS1942INPC-642
     4'/'***************************************************************INPC-643
     5*********ECIS1943'/72X,'ECIS1944'/30X,'*******************',23X,'EINPC-644
     6CIS1945'/30X,'*  NEXT DATA SET  *',23X,'ECIS1946'/30X,'***********INPC-645
     7********',23X,'ECIS1947'/72X,'ECIS1948'/6X,'"FIN" IN COLUMNS 1-3 TINPC-646
     8O STOP THE JOB WITHOUT DIAGNOSTIC.',10X,'ECIS1949'/72X,'ECIS1950'/INPC-647
     97X,'FOR ANY TROUBLE, WRITE (AND EVEN SEND LISTINGS) TO',15X,'ECIS1INPC-648
     A951'/5X,'JACQUES RAYNAL/SERVICE DE PHYSIQUE THEORIQUE/C.E.-SACLAY'INPC-649
     B,11X,'ECIS1952'/15X,'91191 GIF-SUR-YVETTE CEDEX/FRANCE',24X,'ECIS1INPC-650
     C953'/72X,'ECIS1954'/5X,'FAX: (33)(1) 69.08-81-20',43X,'ECIS1955'/5INPC-651
     DX,'E-MAIL: RAYNAL@DSM-MAIL.SACLAY.CEA.FR',30X,'ECIS1956'/72X,'ECISINPC-652
     E1957')                                                            INPC-653
      RETURN                                                            INPC-654
      END                                                               INPC-655
C 24/01/07                                                      ECIS06  LECL-000
      SUBROUTINE LECL(NCOLX,NCOLL,NCONT,IDT,LO,IPI,IPH,WV,IPP,NPA,PA,NA,LECL-001
     1NB,NIMAX,NBET)                                                    LECL-002
C INPUT OF LEVEL DESCRIPTIONS.                                          LECL-003
C INPUT:     NCOLX:   TOTAL NUMBER OF NUCLEAR STATES                    LECL-004
C            NCOLL:   NUMBER OF COUPLED NUCLEAR STATES                  LECL-005
C            NCONT:   NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS          LECL-006
C            IDT:     FREE SPACE IN NPA,PA                              LECL-007
C            LO(I):   LOGICAL CONTROLS:                                 LECL-008
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).LECL-009
C               LO(2)  =.TRUE. SECOND ORDER VIBRATIONAL OR CONSTRAINED  LECL-010
C                              ASYMMETRIC ROTATIONAL MODEL.             LECL-011
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     LECL-012
C                              ROTATIONAL MODEL.                        LECL-013
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    LECL-014
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 LECL-015
C               LO(10) =.TRUE. DISPERSION RELATIONS FOR POTENTIALS.     LECL-016
C               LO(15) =.TRUE. REDUCED NUCLEAR MATRIX ELEMENTS READ.    LECL-017
C               LO(18) =.TRUE. PROJECTILE-TARGET ANTISYMMETRISATION.    LECL-018
C               LO(98) =.TRUE. Q ADDED TO THE MASS OF RESIDUAL NUCLEUS  LECL-019
C                              OR OUTGOING PARTICLE.                    LECL-020
C               LO(100)=.TRUE. DIRAC EQUATION.                          LECL-021
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    LECL-022
C               LO(122)=.TRUE. IDENTICAL PARTICLES WITHOUT SPIN.        LECL-023
C               LO(123)=.TRUE. IDENTICAL PARTICLES WITH SPIN.           LECL-024
C OUTPUT:    IPI:     DESCRIPTION OF LEVELS IN IPI(J,*):                LECL-025
C                     PARITY (0 FOR + AND 1 FOR -) FOR J=1.             LECL-026
C                     MULTIPLICITY OF INCIDENT PARTICLE FOR J=2.        LECL-027
C                     MULTIPLICITY OF THE TARGET FOR J=3.               LECL-028
C                     PRODUCT OF CHARGES FOR J=4.                       LECL-029
C                     INDEX OF POTENTIAL FOR J=5.                       LECL-030
C            IPH:     DESCRIPTION OF VIBRATIONAL LEVELS. FOR VIBRATIONALLECL-031
C                     MODEL, IPH(I,J) IS THE NUMBER OF PHONONS FOR      LECL-032
C                     I=1, J=1,NCOLL. IF IPH(1,J) IS 3, THE STATE       LECL-033
C                     IS A MIXTURE OF 1 AND 2-PHONONS STATES.           LECL-034
C                     FOR ROTATIONAL MODEL, IPH(1,J) IS 1 FOR A         LECL-035
C                     VIBRATIONAL BAND AND 2 FOR A MIXTURE WITH THE     LECL-036
C                     GROUND STATE BAND. SINGLE PHONON OR ADDRESS OF    LECL-037
C                     THE DESCRIPTION OF MIXED STATES IN IPH(2,J).      LECL-038
C            WV:      DESCRIPTION OF THE LEVELS IN WV(J,*):             LECL-039
C                     MASS OF INCIDENT PARTICLE FOR J=1.                LECL-040
C                     MASS OF THE TARGET FOR J=2.                       LECL-041
C                     ENERGY IN THE CENTRE OF MASS IN MEV FOR J=3.      LECL-042
C                     (TEMPORARY) PARTICLE EXCITATION FRACTION FOR J=4. LECL-043
C                     ENERGY IN THE LABORATORY SYSTEM IN MEV FOR J=13.  LECL-044
C            IPP(I,J):FIRST LEVEL USING POTENTIAL J FOR I=1 (TEMPORARY).LECL-045
C                     -1 TO READ DISPERSION PARAMETERS FOR I=2.         LECL-046
C            NPA,PA:  STORAGE OF NUCLEAR PARAMETERS EQUIVALENT BY CALL. LECL-047
C            NA:      NUMBER OF INTEGER PARAMETER INFORMATIONS.         LECL-048
C            NB:      STORAGE IN ROAM FOR ASYMMETRIC ROTATION.          LECL-049
C            NIMAX:   TWICE MAXIMUM SUM OF SPINS TARGET+PARTICLE.       LECL-050
C            NBET:    NUMBER OF DIFFERENT PHONONS.                      LECL-051
C            LO:      LOGICAL CONTROLS, DEFINED HERE:                   LECL-052
C                     LO(122) AND LO(123).                              LECL-053
C                                                                       LECL-054
C FOR THE COMMON  /COUPL/ AND /DCONS/ SEE CALC.                         LECL-055
C FOR THE COMMON  /POTE2/ SEE REDM.                                     LECL-056
C                                                                       LECL-057
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     LECL-058
C  CM:        ATOMIC MASS IN MEV.                                       LECL-059
C   USED:     CM.                                                       LECL-060
C                                                                       LECL-061
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     LECL-062
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             LECL-063
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             LECL-064
C   DEFINED:  NVA.                                                      LECL-065
C   USED:     NPP.                                                      LECL-066
C                                                                       LECL-067
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     LECL-068
C  NPX:       NUMBER OF POTENTIALS TAKING INTO ACCOUNT DISPERSION.      LECL-069
C   DEFINED:  NTX.                                                      LECL-070
C                                                                       LECL-071
C***********************************************************************LECL-072
      IMPLICIT REAL*8 (A-H,O-Z)                                         LECL-073
      LOGICAL LO(150)                                                   LECL-074
      CHARACTER*1 SIGM,SPI                                              LECL-075
      DIMENSION IPI(11,*),IPH(2,*),WV(22,*),IPP(34,*),NPA(2,*),PA(*)    LECL-076
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   LECL-077
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            LECL-078
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         LECL-079
      COMMON /INOUT/ MR,MW,MS                                           LECL-080
      DATA SIGM /'-'/                                                   LECL-081
C OUTPUT OF NUCLEAR MODEL.                                              LECL-082
      IF (LO(7)) GO TO 3                                                LECL-083
      IF (LO(1)) GO TO 2                                                LECL-084
      IF (LO(3)) GO TO 1                                                LECL-085
      IF (.NOT.LO(2)) WRITE (MW,1000)                                   LECL-086
      IF (LO(2)) WRITE (MW,1001)                                        LECL-087
      GO TO 4                                                           LECL-088
    1 WRITE (MW,1002)                                                   LECL-089
      IF (.NOT.LO(15)) GO TO 29                                         LECL-090
      GO TO 4                                                           LECL-091
    2 IF (.NOT.LO(3)) WRITE (MW,1003)                                   LECL-092
      IF (LO(3)) WRITE (MW,1004)                                        LECL-093
      GO TO 4                                                           LECL-094
    3 WRITE (MW,1005)                                                   LECL-095
C INPUT OF LEVEL DESCRIPTION.                                           LECL-096
    4 NVA=0                                                             LECL-097
      NA=0                                                              LECL-098
      NB=0                                                              LECL-099
      NBET=0                                                            LECL-100
      NIMAX=0                                                           LECL-101
      DO 5 IV=1,NPP                                                     LECL-102
      IPP(1,IV)=-1                                                      LECL-103
    5 IPP(2,IV)=-1                                                      LECL-104
      IF (LO(98).AND.LO(8)) WRITE (MW,1006)                             LECL-105
      DO 27 IV=1,NCOLX                                                  LECL-106
      READ (MR,1007) SP2,N,K,SPI,E,SP1,WV(1,IV),WV(2,IV),SP3,WV(4,IV)   LECL-107
      IPI(2,IV)=1+IDINT(2.00001D0*SP1)                                  LECL-108
      IPI(3,IV)=1+IDINT(2.00001D0*SP2)                                  LECL-109
      IPI(4,IV)=IDINT(SP3)                                              LECL-110
      IF (IV.NE.1) GO TO 8                                              LECL-111
      WV(13,1)=E                                                        LECL-112
      IF (K.EQ.0) K=1                                                   LECL-113
      IF (LO(18).AND.((IPI(3,1).NE.IPI(2,1)).OR.(SPI.EQ.SIGM).OR.LO(100)LECL-114
     1)) GO TO 30                                                       LECL-115
      LO(122)=LO(18).AND.IPI(2,1)*IPI(3,1).EQ.1                         LECL-116
      LO(123)=LO(18).AND.IPI(2,1)*IPI(3,1).NE.1                         LECL-117
      IF (LO(8)) GO TO 6                                                LECL-118
      WV(3,1)=E*WV(2,1)/(WV(1,1)+WV(2,1))                               LECL-119
      WV(4,1)=DSQRT(CK*WV(3,1)*WV(1,1)*WV(2,1)/(WV(1,1)+WV(2,1)))       LECL-120
      GO TO 7                                                           LECL-121
C RELATIVISTIC C.-M. ENERGY ECM=SQRT((M1+M2)**2+2*M2*ELAB))-M1-M2.      LECL-122
    6 WV(3,1)=CM*(DSQRT((WV(1,1)+WV(2,1))**2+2.D0*WV(2,1)*E/CM)-WV(1,1)-LECL-123
     1WV(2,1))                                                          LECL-124
      WV(4,1)=DSQRT(0.125D0*CK*WV(3,1)*(WV(3,1)/CM+2.D0*WV(1,1)+2.D0*WV(LECL-125
     12,1))*(WV(3,1)/CM+2.D0*WV(1,1))*(WV(3,1)/CM+2.D0*WV(2,1)))/(WV(3,1LECL-126
     2)/CM+WV(1,1)+WV(2,1))                                             LECL-127
    7 AM3=WV(2,1)**.33333333333333D0                                    LECL-128
      BM3=WV(1,1)**.33333333333333D0                                    LECL-129
      WRITE (MW,1008) WV(2,1),SP3,AM3,WV(1,1),SP1,BM3                   LECL-130
      WRITE (MW,1009) E,WV(3,1)                                         LECL-131
      E=0.D0                                                            LECL-132
      GO TO 13                                                          LECL-133
    8 IF (WV(1,IV).EQ.0.D0) GO TO 9                                     LECL-134
      AM3=WV(2,IV)**.33333333333333D0                                   LECL-135
      BM3=WV(1,IV)**.33333333333333D0                                   LECL-136
      WRITE (MW,1008) WV(2,IV),SP3,AM3,WV(1,IV),SP1,BM3                 LECL-137
      GO TO 10                                                          LECL-138
    9 WV(1,IV)=WV(1,IV-1)                                               LECL-139
      WV(2,IV)=WV(2,IV-1)                                               LECL-140
      IPI(2,IV)=IPI(2,IV-1)                                             LECL-141
      IPI(4,IV)=IPI(4,IV-1)                                             LECL-142
      SP2=0.5D0*DFLOAT(IPI(3,IV)-1)                                     LECL-143
      SP3=IPI(4,IV)                                                     LECL-144
   10 WV(3,IV)=WV(3,1)-E                                                LECL-145
      IF (.NOT.(LO(98).AND.LO(8))) GO TO 11                             LECL-146
      EP=E*WV(13,IV)                                                    LECL-147
      ET=E-EP                                                           LECL-148
      WV(1,IV)=WV(1,1)+(WV(2,1)-WV(2,IV))+EP/CM                         LECL-149
      WV(2,IV)=WV(2,1)+(WV(1,1)-WV(1,IV))+ET/CM                         LECL-150
   11 IF (K.EQ.0) K=IPI(5,IV-1)                                         LECL-151
      IF (LO(8)) GO TO 12                                               LECL-152
      WV(13,IV)=WV(3,IV)*(WV(1,IV)+WV(2,IV))/WV(2,IV)                   LECL-153
      GO TO 13                                                          LECL-154
   12 WV(13,IV)=WV(3,IV)*(WV(3,IV)/(2.D0*CM)+WV(1,IV)+WV(2,IV))/WV(2,IV)LECL-155
   13 IF (LO(109).AND.IPI(2,IV).NE.2) GO TO 31                          LECL-156
      IF (K.GT.NPP.OR.K.LE.0) GO TO 32                                  LECL-157
      IPI(5,IV)=K                                                       LECL-158
      IF (IPP(1,K).EQ.-1) IPP(1,K)=IV                                   LECL-159
      NIMAX=MAX0(NIMAX,IPI(2,IV)+IPI(3,IV))                             LECL-160
      IPI(1,IV)=0                                                       LECL-161
      IF (SPI.EQ.SIGM) IPI(1,IV)=1                                      LECL-162
      IF (IV.LE.NCOLL) GO TO 15                                         LECL-163
C UNCOUPLED STATES FOR COMPOUND NUCLEUS.                                LECL-164
      IF (NCONT+IV.GT.NCOLX) GO TO 14                                   LECL-165
      WRITE (MW,1010) IV,SP2,SPI,E,K                                    LECL-166
      GO TO 27                                                          LECL-167
C CONTINUUM FOR COMPOUND NUCLEUS.                                       LECL-168
   14 WRITE (MW,1011) IV,SP2,SPI,E,K                                    LECL-169
      GO TO 27                                                          LECL-170
   15 IF (LO(7)) GO TO 17                                               LECL-171
      NNPA=0                                                            LECL-172
      NNVA=0                                                            LECL-173
      IF ((LO(1).EQV.(N.EQ.0)).OR.(LO(3).AND.(.NOT.LO(1)))) GO TO 16    LECL-174
C INPUT OF PHONONS IN HARMONIC VIBRATIONAL OR SYMMETRIC ROTATIONAL MODELLECL-175
      READ (MR,1012) IPH(1,IV),IPH(2,IV),I2,I3                          LECL-176
      NBET=MAX0(NBET,IPH(2,IV),I2,I3)                                   LECL-177
      M=IPH(1,IV)+1                                                     LECL-178
      GO TO ( 17 , 19 , 20 , 20 ) , M                                   LECL-179
C GROUND STATE.                                                         LECL-180
   16 IPH(1,IV)=0                                                       LECL-181
      IF (LO(1)) GO TO 18                                               LECL-182
   17 WRITE (MW,1013) IV,SP2,SPI,E,K                                    LECL-183
      GO TO 27                                                          LECL-184
   18 WRITE (MW,1014) IV,SP2,SPI,E,K                                    LECL-185
      IF (.NOT.LO(3)) GO TO 27                                          LECL-186
      NNVA=(IPI(3,IV)-1)/4                                              LECL-187
      GO TO 21                                                          LECL-188
C 1 PHONON STATE.                                                       LECL-189
   19 IF (.NOT.LO(1)) WRITE (MW,1015) IV,SP2,SPI,E,K,IPH(2,IV)          LECL-190
      IF (LO(1)) WRITE (MW,1016) IV,SP2,SPI,E,K,IPH(2,IV)               LECL-191
      GO TO 27                                                          LECL-192
   20 NNPA=IPH(1,IV)-1                                                  LECL-193
      NNVA=M-2                                                          LECL-194
      IF (.NOT.LO(3)) NNVA=NNVA+1                                       LECL-195
   21 IF (NA+NVA+NNPA+2.GT.IDT) CALL MEMO('LECL',NA+NVA+NNPA+2,IDT)     LECL-196
      IF ((NVA.EQ.0).OR.(NNPA.EQ.0)) GO TO 23                           LECL-197
      DO 22 I=NVA,1,-1                                                  LECL-198
   22 PA(NNPA+NA+I)=PA(NA+I)                                            LECL-199
   23 IF (LO(3)) GO TO 26                                               LECL-200
      WRITE (MW,1013) IV,SP2,SPI,E,K                                    LECL-201
C 2 PHONON STATE.                                                       LECL-202
      NA=NA+1                                                           LECL-203
      NPA(1,NA)=IPH(2,IV)                                               LECL-204
      IF (LO(1)) GO TO 25                                               LECL-205
      IPH(2,IV)=NA                                                      LECL-206
      NPA(2,NA)=I2                                                      LECL-207
      IF (M.EQ.4) GO TO 24                                              LECL-208
      WRITE (MW,1017) NPA(1,NA),NPA(2,NA)                               LECL-209
      GO TO 27                                                          LECL-210
C MIXTURE OF 1 PHONON AND 2 PHONON STATE - INPUT OF MIXING PARAMETER.   LECL-211
   24 NA=NA+1                                                           LECL-212
      NPA(1,NA)=I3                                                      LECL-213
   25 NVA=NVA+1                                                         LECL-214
      NPA(2,NA)=NVA                                                     LECL-215
      READ (MR,1018) PA(NA+NVA)                                         LECL-216
      B1=0.0174532925199433D0*PA(NA+NVA)                                LECL-217
      C1=DCOS(B1)                                                       LECL-218
      C3=DSIN(B1)                                                       LECL-219
      IF (.NOT.LO(1)) WRITE (MW,1019) PA(NA+NVA),C3,NPA(1,NA-1),I2,C1,I3LECL-220
      IF (LO(1)) WRITE (MW,1020) PA(NA+NVA),C3,NPA(1,NA),C1             LECL-221
      GO TO 27                                                          LECL-222
C ASYMMETRIC ROTATIONAL MODEL - INPUT OF MIXING PARAMETERS.             LECL-223
   26 IF (.NOT.LO(1)) GO TO 27                                          LECL-224
      IPH(1,IV)=NNVA                                                    LECL-225
      IPH(2,IV)=NVA                                                     LECL-226
      NB=NB+NNVA+1                                                      LECL-227
      IF (NNVA.EQ.0) GO TO 27                                           LECL-228
      READ (MR,1018) (PA(NA+NVA+J),J=1,NNVA)                            LECL-229
      WRITE (MW,1021) (PA(NA+NVA+J),J=1,NNVA)                           LECL-230
      NVA=NVA+NNVA                                                      LECL-231
   27 IF (LO(1).AND.LO(2).AND.LO(3)) NVA=MAX0(NVA,5)                    LECL-232
      NPX=0                                                             LECL-233
      DO 28 I=1,NCOLL                                                   LECL-234
      IPI(11,I)=IPI(5,I)                                                LECL-235
      IF (LO(10)) IPI(11,I)=I                                           LECL-236
   28 NPX=MAX0(NPX,IPI(11,I))                                           LECL-237
      RETURN                                                            LECL-238
   29 WRITE (MW,1022)                                                   LECL-239
      GO TO 33                                                          LECL-240
   30 WRITE (MW,1023)                                                   LECL-241
      GO TO 33                                                          LECL-242
   31 SP1=0.5D0*DFLOAT(IPI(2,IV)-1)                                     LECL-243
      WRITE (MW,1024) SP1                                               LECL-244
      GO TO 33                                                          LECL-245
   32 WRITE (MW,1025) K,NPP                                             LECL-246
   33 WRITE (MW,1026)                                                   LECL-247
      STOP                                                              LECL-248
 1000 FORMAT (/' FIRST ORDER VIBRATIONAL MODEL.'/)                      LECL-249
 1001 FORMAT (/' SECOND ORDER VIBRATIONAL MODEL.'/)                     LECL-250
 1002 FORMAT (/' ANHARMONIC VIBRATIONAL MODEL.'/)                       LECL-251
 1003 FORMAT (/' SYMMETRIC ROTATIONAL MODEL.'/)                         LECL-252
 1004 FORMAT (/' ASYMMETRIC ROTATIONAL MODEL.'/)                        LECL-253
 1005 FORMAT (/' EXTERNAL FORM FACTOR MODEL.'/)                         LECL-254
 1006 FORMAT (/' MASSES OF INPUT FOR EXCITED STATES MODIFIED BY "Q" VALULECL-255
     1E.'/)                                                             LECL-256
 1007 FORMAT (F5.2,2I2,A1,6F10.5)                                       LECL-257
 1008 FORMAT (/' TARGET',14X,'MASS =',F10.5,11X,'PRODUCT OF CHARGES =',FLECL-258
     16.0,11X,'AT**1/3 =',1P,D15.6,0P/' INCIDENT PARTICLE',3X,'MASS =',FLECL-259
     210.5,3X,3X,'SPIN =',F4.1,3X,'AP**1/3 =',1P,D15.6)                 LECL-260
 1009 FORMAT (10X,'ENERGY(LAB) =',1P,D15.6,' MEV',10X,'ENERGY(C. M.) =',LECL-261
     1D15.6,' MEV.'/)                                                   LECL-262
 1010 FORMAT (' N =',I3,' -   SPIN =',F4.1,A1,' EXCITATION ENERGY =',F8.LECL-263
     14,' MEV',10X,'POTENTIAL',I5,6X,'***** UNCOUPLED STATE *****')     LECL-264
 1011 FORMAT (' N =',I3,' -   SPIN =',F4.1,A1,' EXCITATION ENERGY =',F8.LECL-265
     14,' MEV',10X,'POTENTIAL',I5,6X,'***** START OF A CONTINUUM *****')LECL-266
 1012 FORMAT (14I5)                                                     LECL-267
 1013 FORMAT (' N =',I3,' -   SPIN =',F4.1,A1,' EXCITATION ENERGY =',F8.LECL-268
     14,' MEV',10X,'POTENTIAL',I5)                                      LECL-269
 1014 FORMAT (' N =',I3,' -   SPIN =',F4.1,A1,' EXCITATION ENERGY =',F8.LECL-270
     14,' MEV',10X,'POTENTIAL',I5,6X,'GROUND STATE BAND.')              LECL-271
 1015 FORMAT (' N =',I3,' -   SPIN =',F4.1,A1,' EXCITATION ENERGY =',F8.LECL-272
     14,' MEV',10X,'POTENTIAL',I5,6X,' PHONON STATE WITH PHONON',I3)    LECL-273
 1016 FORMAT (' N =',I3,' -   SPIN =',F4.1,A1,' EXCITATION ENERGY =',F8.LECL-274
     14,' MEV',10X,'POTENTIAL',I5,6X,'VIBRATIONAL BAND OF PHONON',I3)   LECL-275
 1017 FORMAT (23X,'2 PHONONS STATE, WITH PHONONS',I3,' AND',I3)         LECL-276
 1018 FORMAT (7F10.5)                                                   LECL-277
 1019 FORMAT (23X,'MIXING OF 1 AND 2 PHONON STATES WITH',F9.3,' DEGREES'LECL-278
     1/23X,F10.5,' 2 PHONONS STATE, WITH PHONONS',I3,' AND',I3,'  + ',F1LECL-279
     20.5,' 1 PHONON STATE WITH PHONON',I3)                             LECL-280
 1020 FORMAT (23X,'MIXING OF VIBRATIONAL AND GROUND BANDS WITH',F9.3,' DLECL-281
     1EGREES'/23X,F10.5,' VIBRATIONAL BAND OF PHONON',I3,' AND',F10.5,' LECL-282
     2GROUND STATE BAND.')                                              LECL-283
 1021 FORMAT (23X,'BAND MIXING COEFF.',5F10.5)                          LECL-284
 1022 FORMAT (' THE NUCLEAR REDUCED MATRIX ELEMENTS MUST BE READ IN THISLECL-285
     1 MODEL.')                                                         LECL-286
 1023 FORMAT (' PROJECTILE-TARGET ANTISYMMETRISATION VALID ONLY FOR SPINLECL-287
     1 OF PARTICLE EQUAL TO SPIN OF TARGET AND POSITIVE PARITY'/49X,'ANDLECL-288
     2 SCHROEDINGER FORMALISM.')                                        LECL-289
 1024 FORMAT (' PARTICLE SPIN',F5.1,' NOT ALLOWED FOR DIRAC EQUATION.') LECL-290
 1025 FORMAT (' POTENTIAL',I3,' WILL NOT BE READ.TOTAL NUMBER IS:',I3)  LECL-291
 1026 FORMAT (//' IN LECL  ...  STOP  ...')                             LECL-292
      END                                                               LECL-293
C 01/10/06                                                      ECIS06  LECT-000
      SUBROUTINE LECT(NBET,IPI,IPP,WV,RM,IDT,LO,NBETA,BETA,VAL,FISS,GAM,LECT-001
     1ISM,SCN)                                                          LECT-002
C LECT READS ALL INPUT EXCEPT THE 5 FIRST DATA CARDS,THE LEVELS, THE    LECT-003
C EXPERIMENTAL DATA,THE SEARCH CONDITIONS,THE NUCLEAR REDUCED MATRIX    LECT-004
C ELEMENTS AND THE FORM FACTORS.                                        LECT-005
C INPUT:     NBET:    NUMBER OF PHONONS.                                LECT-006
C            IPI(J,*):MULTIPLICITY OF PARTICLE FOR J=2.                 LECT-007
C                     PRODUCT OF CHARGES FOR J=4.                       LECT-008
C            IPI(1,J):FIRST LEVEL USING POTENTIAL J.                    LECT-009
C            WV(J,*): MASS OF THE PARTICLE FOR J=1.                     LECT-010
C                     MASS OF THE TARGET FOR J=2.                       LECT-011
C                     ENERGY IN THE CENTRE OF MASS IN MEV FOR J=3.      LECT-012
C                     ENERGY IN THE LABORATORY SYSTEM IN MEV FOR J=13.  LECT-013
C            RM:      MATCHING RADIUS (VALUE READ).                     LECT-014
C            IDT:     LENGTH FREE FOR BETA.                             LECT-015
C            LO(I):   LOGICAL CONTROLS:                                 LECT-016
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).LECT-017
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     LECT-018
C                              ROTATIONAL MODEL.                        LECT-019
C               LO(4)  =.TRUE. PARAMETRISED SPIN-ORBIT DEFORMATION.     LECT-020
C               LO(5)  =.TRUE  DIFFERENT DEFORMATION FOR EACH POTENTIAL.LECT-021
C               LO(6)  =.TRUE. USE DEFORMATION LENGTHS.                 LECT-022
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    LECT-023
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 LECT-024
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              LECT-025
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            LECT-026
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      LECT-027
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. LECT-028
C               LO(16) =.TRUE. HEAVY-ION DEFINITION OF REDUCED RADII ANDLECT-029
C                              DEFORMATIONS.                            LECT-030
C               LO(17) =.TRUE. FOLDING MODEL.                           LECT-031
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   LECT-032
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     LECT-033
C               LO(46) =.TRUE. RESTRICTED COULOMB CORRECTIONS.          LECT-034
C               LO(66) =.TRUE. NO CALCULATION AT EQUIDISTANT ANGLES.    LECT-035
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             LECT-036
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         LECT-037
C               LO(85) =.TRUE. FISSION TRANSMISSION COEFFICIENTS.       LECT-038
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      LECT-039
C               LO(99) =.TRUE. SCHROEDINGER EQUIVALENT TO DIRAC         LECT-040
C                              EQUATION.                                LECT-041
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    LECT-042
C OUTPUT:    NBET:    NUMBER OF PHONONS PLUS DEFORMATIONS.              LECT-043
C            RM:      MATCHING RADIUS (ACTUAL VALUE).                   LECT-044
C            NBETA:   QUANTUM NUMBERS OF DEFORMATIONS IN NBETA(J,*) FOR LECT-045
C                     J=17,18.                                          LECT-046
C            BETA:    IN EQUIVALENCE BY CALL WITH NBETA: NUCLEAR        LECT-047
C                     DEFORMATION FOR POTENTIALS IN BETA(J,*) FOR J=1,8.LECT-048
C            VAL:     (25 OPTICAL +9 FOLDING PARAMETERS)* NPP           LECT-049
C            FISS:    FISSION DATA FOR COMPOUND NUCLEUS                 LECT-050
C            GAM:     GAMMA DATA FOR COMPOUND NUCLEUS                   LECT-051
C            ISM:     NUMBER OF INTEGRATION STEPS                       LECT-052
C            SCN:     DESCRIPTIONS OF LEVEL DENSITIES                   LECT-053
C            LO:      LOGICAL CONTROLS:                                 LECT-054
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              LECT-055
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      LECT-056
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. LECT-057
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   LECT-058
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      LECT-059
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    LECT-060
C               LO(102)=.TRUE. THERE IS AN IMAGINARY SPIN-ORBIT         LECT-061
C                              POTENTIAL.                               LECT-062
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. LECT-063
C               LO(108)=.TRUE. DIAGONAL COULOMB CORRECTIONS ARE NEEDED. LECT-064
C               LO(129)=.TRUE. REAL SPIN-ORBIT OR DIRAC EQUATION.       LECT-065
C               LO(130)=.TRUE. IMAGINARY SPIN-ORBIT OR DIRAC EQUATION.  LECT-066
C                                                                       LECT-067
C THE COMMON /ANGUL/ IS USED IN CALX, LECT, SCHE, LCSP, RESU AND REST.  LECT-068
C                                                                       LECT-069
C FOR THE COMMON  /CONVE/, /COUPL/, /DCONS/ AND /NCOMP/ SEE CALC.       LECT-070
C                                                                       LECT-071
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ANGUL/:                     LECT-072
C  THETA1:    FIRST ANGLE FOR COMPUTATION AT EQUIDISTANT ANGLES.        LECT-073
C  DTHETA:    STEP FOR COMPUTATION AT EQUIDISTANT ANGLES.               LECT-074
C  THETA2:    LAST ANGLE FOR COMPUTATION AT EQUIDISTANT ANGLES.         LECT-075
C  DTHE:      AVERAGING ANGLE.                                          LECT-076
C  NCJ:       NUMBER OF FACTORISATIONS OF 1/(1-COS(THETA)) IN AMPLITUDE.LECT-077
C  NL(1):     POWER OF (1-COS(THETA)) FOR THE EXPANSION IN LEGENDRE     LECT-078
C             POLYNOMIALS OF THE INTERFERENCE BETWEEN COULOMB AND       LECT-079
C             NUCLEAR ELASTIC SCATTERING. POWER OF (1-COS(THETA)**2)    LECT-080
C             IF LO(18) IS .TRUE..                                      LECT-081
C  NL(2):     NUMBER OF LEGENDRE POLYNOMIALS FOR ELASTIC SCATTERING OF  LECT-082
C             CHARGED PARTICLES.                                        LECT-083
C  NL(3):     NUMBER OF LEGENDRE POLYNOMIALS FOR ELASTIC SCATTERING OF  LECT-084
C             UNCHARGED PARTICLES, INELASTIC SCATTERING AND COMPOUND    LECT-085
C             NUCLEUS.                                                  LECT-086
C  JMM(1):    NUMBER OF CHANNEL SPINS USED FOR MINIMUM CHI2.            LECT-087
C  JMM(2):    NUMBER OF L FOR COMPOUND NUCLEUS FOR MINIMUM CHI2.        LECT-088
C   DEFINED:  THETA1,DTHETA,THETA2,DTHE                                 LECT-089
C   USED:     THETA1,DTHETA,THETA2,DTHE                                 LECT-090
C   NOT USED: NCJ,NL,JMM.                                               LECT-091
C                                                                       LECT-092
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     LECT-093
C  H:         STEP SIZE FOR INTEGRATION.                                LECT-094
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         LECT-095
C   DEFINED:  H,ACONV.                                                  LECT-096
C   USED:     H,ACONV.                                                  LECT-097
C                                                                       LECT-098
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     LECT-099
C  IQM:       MAXIMUM L-VALUE OF DEFORMATION IN ROTATIONAL MODEL.       LECT-100
C  IQMAX:     MAXIMUM L-EXPANSION IN ROTATIONAL MODEL.                  LECT-101
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             LECT-102
C  NSPIN:     TWICE THE K-VALUE OF THE ROTATIONAL BAND.                 LECT-103
C   DEFINED:  IQM,IQMAX,NSPIN.                                          LECT-104
C   USED:     NPP.                                                      LECT-105
C                                                                       LECT-106
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     LECT-107
C  CM:        ATOMIC MASS IN MEV.                                       LECT-108
C  CK:        H-BAR*C.                                                  LECT-109
C   USED:     CM,CK.                                                    LECT-110
C                                                                       LECT-111
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     LECT-112
C  NFISS:     NUMBER OF FISSION TRANSMISSION COEFFICIENTS.              LECT-113
C  NRD:       NUMBER OF GAMMA TRANSMISSION COEFFICIENTS.                LECT-114
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 LECT-115
C  NCONS:     NUMBER OF LEVEL DENSITIES NEEDED.                         LECT-116
C  NCOLX:     TOTAL NUMBER OF LEVELS WITHOUT DISCRETISATION.            LECT-117
C  AZ(6):     DEFORMED SPIN-ORBIT PARAMETERS. SEE ALSO COMMENT IN       LECT-118
C             INPUT DESCRIPTION AND SUBROUTINE QUAN.                    LECT-119
C  BZ(6)      HAUSER-FESHBACH AND MOLDAUER'S PARAMETERS DESCRIBED BELOW.LECT-120
C   BZ(1):    SQUARE ROOT OF ELASTIC ENHANCEMENT.                       LECT-121
C   BZ(2):    IF LO(82)=.TRUE., SPIN CUT-OFF PARAMETER.                 LECT-122
C             IF LO(82)=.FALSE., PARTICLE DEGREES OF FREEDOM.           LECT-123
C   BZ(3):    SQUARE ROOT OF LEVEL DENSITY PARAMETER. IF LO(82)=LO(87)= LECT-124
C             .FALSE., PARAMETER BZ(3) IN MOLDAUER'S FORMULA OF INPUT   LECT-125
C             DESCRIPTION.                                              LECT-126
C   BZ(4):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(4) IN SAME FORMULA.LECT-127
C   BZ(5):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(5) IN SAME FORMULA.LECT-128
C  TG0:       SLOW S-WAVE NEUTRON GAMMA WIDTH/SPACING FOR NORMALISATION.LECT-129
C  BN:        NEUTRON SEPARATION ENERGY.                                LECT-130
C  FNUG:      RADIATIVE DEGREES OF FREEDOM.                             LECT-131
C  EGD:       ENERGY OF THE GIANT DIPOLE RESONANCE.                     LECT-132
C  GGD:       RESONANCE WIDTH.                                          LECT-133
C   DEFINED:  AZ,BZ,TG0,BN,FNUG,EGD,GGD.                                LECT-134
C   USED:     NFISS,NRD,NCONT,NCONS,NCOLX,AZ,BZ,TG0,BN,FNUG,EGD,GGD.    LECT-135
C                                                                       LECT-136
C***********************************************************************LECT-137
      IMPLICIT REAL*8 (A-H,O-Z)                                         LECT-138
      DIMENSION IPI(11,*),IPP(34,*),WV(22,*),NBETA(18,*),BETA(9,*),VAL(4LECT-139
     12,*),FISS(2,*),GAM(*),SCN(7,*),RO(6)                              LECT-140
      CHARACTER*4 ALEG(6),BLEG(2)                                       LECT-141
      LOGICAL LO(150),LT(6)                                             LECT-142
      COMMON /ANGUL/ THETA1,THETA2,DTHETA,DTHE,NCJ,NL(3),JMM(2)         LECT-143
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       LECT-144
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   LECT-145
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            LECT-146
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQLECT-147
     1,ACN1,ACN2,AZ(6),BZ(5),TG0,BN,FNUG,EGD,GGD,TG1,SGSQ               LECT-148
      COMMON /INOUT/ MR,MW,MS                                           LECT-149
      DATA BLEG /'NOT ','    '/                                         LECT-150
      IQM=0                                                             LECT-151
      IF (NBET.EQ.0) GO TO 4                                            LECT-152
C INPUT OF PHONON DEFORMATIONS IN VIBRATIONAL AND ROTATIONAL MODELS     LECT-153
      DO 3 I=1,NBET                                                     LECT-154
      READ (MR,1000) NBETA(17,I),NBETA(18,I),BETA(1,I),K                LECT-155
      DO 1 J=2,8                                                        LECT-156
    1 BETA(J,I)=BETA(1,I)                                               LECT-157
      IF (LO(5)) READ (MR,1001) (BETA(J,I),J=2,8)                       LECT-158
      WRITE (MW,1002) I,NBETA(17,I),NBETA(18,I),(BETA(J,I),J=1,8)       LECT-159
      IF (.NOT.LO(16)) GO TO 3                                          LECT-160
      IF (K.EQ.0) K=1                                                   LECT-161
      K=MIN0(K,NCOLX)                                                   LECT-162
      AM3=WV(2,K)**.33333333333333D0                                    LECT-163
      BM3=WV(1,K)**.33333333333333D0                                    LECT-164
      CM3=AM3/(AM3+BM3)                                                 LECT-165
      DM3=1.D0                                                          LECT-166
      IF (LO(6)) DM3=CM3                                                LECT-167
      DO 2 J=1,6                                                        LECT-168
    2 BETA(J,I)=BETA(J,I)*CM3/DM3                                       LECT-169
      BETA(7,I)=BETA(7,I)*CM3**NBETA(17,I)/DM3                          LECT-170
      BETA(8,I)=BETA(8,I)*CM3**NBETA(17,I)/DM3                          LECT-171
      WRITE (MW,1003) K,(BETA(J,I),J=1,8)                               LECT-172
    3 CONTINUE                                                          LECT-173
    4 IF (LO(7)) GO TO 18                                               LECT-174
      IF (.NOT.LO(1)) GO TO 13                                          LECT-175
C INPUT OF DEFORMATIONS FOR THE ROTATIONAL MODEL                        LECT-176
      READ (MR,1000) IQM,IQMAX,ASPIN,K                                  LECT-177
      NSPIN=IDINT(2.D0*ASPIN+0.1D0)                                     LECT-178
      IQ=NBET+1                                                         LECT-179
      JQ=NBET+IQM/2                                                     LECT-180
      IF (.NOT.LO(3)) GO TO 5                                           LECT-181
      JQ=NBET+IQM                                                       LECT-182
      IF ((IQM.GT.35).OR.(IQMAX.GT.8)) GO TO 33                         LECT-183
    5 IF (9*JQ.GT.IDT) CALL MEMO('LECT',IDT,9*JQ)                       LECT-184
      READ (MR,1001) (BETA(1,I),I=IQ,JQ)                                LECT-185
      M=0                                                               LECT-186
      L=0                                                               LECT-187
      DO 9 I=IQ,JQ                                                      LECT-188
      IF (LO(3)) GO TO 6                                                LECT-189
      L=2*(I-NBET)                                                      LECT-190
      GO TO 7                                                           LECT-191
    6 M=M+2                                                             LECT-192
      IF (M.LE.L) GO TO 7                                               LECT-193
      L=L+2                                                             LECT-194
      M=0                                                               LECT-195
    7 NBETA(17,I)=L                                                     LECT-196
      NBETA(18,I)=M                                                     LECT-197
      DO 8 J=2,8                                                        LECT-198
    8 BETA(J,I)=BETA(1,I)                                               LECT-199
    9 CONTINUE                                                          LECT-200
      IF (LO(5)) READ (MR,1001) ((BETA(J,I),J=2,8),I=IQ,JQ)             LECT-201
      WRITE (MW,1004) IQMAX,ASPIN                                       LECT-202
      WRITE (MW,1005) (I,NBETA(17,I),NBETA(18,I),(BETA(J,I),J=1,8),I=IQ,LECT-203
     1JQ)                                                               LECT-204
      IF (.NOT.LO(16)) GO TO 12                                         LECT-205
      IF (K.EQ.0) K=1                                                   LECT-206
      K=MIN0(K,NCOLX)                                                   LECT-207
      AM3=WV(2,K)**.33333333333333D0                                    LECT-208
      BM3=WV(1,K)**.33333333333333D0                                    LECT-209
      CM3=AM3/(AM3+BM3)                                                 LECT-210
      DM3=1.D0                                                          LECT-211
      IF (LO(6)) DM3=CM3                                                LECT-212
      DO 11 I=IQ,JQ                                                     LECT-213
      IF (NBETA(18,I).NE.0) GO TO 11                                    LECT-214
      DO 10 K=1,6                                                       LECT-215
   10 BETA(K,I)=BETA(K,I)*CM3/DM3                                       LECT-216
      BETA(7,I)=BETA(7,I)*CM3**NBETA(17,I)/DM3                          LECT-217
      BETA(8,I)=BETA(8,I)*CM3**NBETA(17,I)/DM3                          LECT-218
   11 CONTINUE                                                          LECT-219
      WRITE (MW,1006) K                                                 LECT-220
      WRITE (MW,1005) (I,NBETA(17,I),NBETA(18,I),(BETA(J,I),J=1,8),I=IQ,LECT-221
     1JQ)                                                               LECT-222
   12 NBET=JQ                                                           LECT-223
      GO TO 18                                                          LECT-224
C ANHARMONIC VIBRATIONAL MODEL WITH DIFFERENT DEFORMATIONS.             LECT-225
   13 IF (.NOT.LO(3)) GO TO 18                                          LECT-226
      IF (36.GT.IDT) CALL MEMO('LECT',IDT,36)                           LECT-227
      WRITE (MW,1007)                                                   LECT-228
      DO 15 I=1,4                                                       LECT-229
      DO 14 J=1,8                                                       LECT-230
   14 BETA(J,I)=1.D0                                                    LECT-231
      NBETA(17,I)=0                                                     LECT-232
      NBETA(18,I)=0                                                     LECT-233
      IF (LO(5)) READ (MR,1001) (BETA(J,I),J=1,8)                       LECT-234
   15 WRITE (MW,1008) I,NBETA(17,I),(BETA(J,I),J=1,8)                   LECT-235
      NBET=4                                                            LECT-236
      IF (.NOT.LO(16)) GO TO 18                                         LECT-237
      READ (MR,1009) (NBETA(17,J),J=1,4),K                              LECT-238
      IF (K.EQ.0) K=1                                                   LECT-239
      K=MIN0(K,NCOLX)                                                   LECT-240
      AM3=WV(2,K)**.33333333333333D0                                    LECT-241
      BM3=WV(1,K)**.33333333333333D0                                    LECT-242
      CM3=AM3/(AM3+BM3)                                                 LECT-243
      DM3=1.D0                                                          LECT-244
      IF (LO(6)) DM3=CM3                                                LECT-245
      WRITE (MW,1006) K                                                 LECT-246
      DO 17 I=2,4                                                       LECT-247
      IF (NBETA(17,I).EQ.0) NBETA(17,I)=2                               LECT-248
      IF (NBETA(17,I).LT.0) NBETA(17,I)=0                               LECT-249
      DO 16 J=1,6                                                       LECT-250
   16 BETA(J,I)=BETA(J,I)*(CM3/DM3)**(I-1)                              LECT-251
      BETA(7,I)=BETA(7,I)*(CM3**NBETA(17,I)/DM3)**(I-1)                 LECT-252
      BETA(8,I)=BETA(8,I)*(CM3**NBETA(17,I)/DM3)**(I-1)                 LECT-253
   17 WRITE (MW,1010) I,NBETA(17,I),(BETA(J,I),J=1,8)                   LECT-254
C INPUT OF OPTICAL MODEL PARAMETERS.                                    LECT-255
   18 W2=10.D20                                                         LECT-256
      LO(101)=.FALSE.                                                   LECT-257
      LO(102)=.FALSE.                                                   LECT-258
      LO(103)=.FALSE.                                                   LECT-259
      LO(108)=.FALSE.                                                   LECT-260
      LT(4)=.TRUE.                                                      LECT-261
      LT(6)=.TRUE.                                                      LECT-262
      W1=0.D0                                                           LECT-263
      W3=WV(4,1)/(ACONV*WV(3,1))                                        LECT-264
      DO 21 IP=1,NPP                                                    LECT-265
      IJ=IPP(1,IP)                                                      LECT-266
      IF (IJ.NE.-1) GO TO 19                                            LECT-267
      IPP(1,IP)=1                                                       LECT-268
      WRITE (MW,1011) IP                                                LECT-269
      IJ=1                                                              LECT-270
   19 IF (LO(7)) GO TO 21                                               LECT-271
      AM3=WV(2,IJ)**.33333333333333D0                                   LECT-272
      IF (LO(16)) AM3=AM3+WV(1,IJ)**.33333333333333D0                   LECT-273
      WRITE (MW,1012) IP,AM3                                            LECT-274
      DO 20 I=1,6                                                       LECT-275
      ALEG(I)=BLEG(2)                                                   LECT-276
      READ (MR,1013) VAL(4*I-3,IP),RO(I),VAL(4*I-1,IP),VAL(4*I,IP)      LECT-277
      VAL(4*I-2,IP)=AM3*RO(I)                                           LECT-278
      IF (VAL(4*I-3,IP).EQ.0.D0) GO TO 20                               LECT-279
      W1=DMAX1(W1,VAL(4*I-2,IP)+DLOG(W3*DABS(VAL(4*I-3,IP)))*VAL(4*I-1,ILECT-280
     1P))                                                               LECT-281
      W2=DMIN1(W2,VAL(4*I-1,IP))                                        LECT-282
   20 CONTINUE                                                          LECT-283
      LT(1)=IPI(2,IJ).EQ.1.OR.VAL(17,IP).EQ.0.D0                        LECT-284
      LT(2)=IPI(2,IJ).EQ.1.OR.VAL(21,IP).EQ.0.D0                        LECT-285
      LO(101)=LO(101).OR.(.NOT.LT(1))                                   LECT-286
      LO(102)=LO(102).OR.(.NOT.LT(2))                                   LECT-287
C OUTPUT OF OPTICAL PARAMETERS.                                         LECT-288
      IF (.NOT.LO(12)) ALEG(2)=BLEG(1)                                  LECT-289
      IF (LT(1).OR.(.NOT.LO(13))) ALEG(5)=BLEG(1)                       LECT-290
      IF (LT(2).OR.(.NOT.LO(14))) ALEG(6)=BLEG(1)                       LECT-291
      ALEG(4)=ALEG(2)                                                   LECT-292
      WRITE (MW,1014) (ALEG(I),VAL(4*I-3,IP),VAL(4*I-2,IP),RO(I),VAL(4*ILECT-293
     1-1,IP),VAL(4*I,IP),I=1,6)                                         LECT-294
      READ (MR,1013) RO(1),VAL(27,IP),VAL(33,IP),VAL(28,IP)             LECT-295
      READ (MR,1013) VAL(29,IP),RO(2),VAL(31,IP),VAL(33,IP)             LECT-296
      IF (LO(99)) VAL(27,IP)=0.D0                                       LECT-297
      IF (LO(99)) VAL(31,IP)=0.D0                                       LECT-298
      VAL(25,IP)=IPI(4,IJ)                                              LECT-299
      VAL(26,IP)=AM3*RO(1)                                              LECT-300
      LT(3)=VAL(25,IP).EQ.0.D0                                          LECT-301
      LT(4)=LT(3).AND.LT(4)                                             LECT-302
      ALEG(1)=BLEG(2)                                                   LECT-303
      IF (LT(3).OR.(.NOT.LO(11))) ALEG(1)=BLEG(1)                       LECT-304
      VAL(30,IP)=AM3*RO(2)                                              LECT-305
      LT(5)=VAL(29,IP).EQ.0.OR.IPI(2,IJ).EQ.1                           LECT-306
      LO(103)=LO(103).OR.(.NOT.LT(5))                                   LECT-307
      LT(6)=LT(5).AND.LT(6)                                             LECT-308
      ALEG(2)=BLEG(2)                                                   LECT-309
      IF (LT(5).OR.(.NOT.LO(19))) ALEG(2)=BLEG(1)                       LECT-310
      WRITE (MW,1015) (ALEG(I),VAL(4*I+21,IP),VAL(4*I+22,IP),RO(I),VAL(4LECT-311
     1*I+23,IP),VAL(4*I+24,IP),I=1,2),VAL(25,IP)                        LECT-312
      LO(108)=LO(108).OR.VAL(29,IP).NE.0.D0.OR.(LO(109).AND.VAL(19,IP).NLECT-313
     1E.0.D0)                                                           LECT-314
      W1=DMAX1(W1,VAL(26,IP)+10.D0*VAL(27,IP),VAL(30,IP)+10.D0*VAL(31,IPLECT-315
     1))                                                                LECT-316
      IF (VAL(27,IP).NE.0.D0) W2=DMIN1(W2,VAL(27,IP))                   LECT-317
      IF (VAL(33,IP).NE.0.D0) W2=DMIN1(W2,VAL(33,IP))                   LECT-318
      IF (.NOT.LO(17)) GO TO 21                                         LECT-319
C INPUT OF FOLDING PARAMETERS.                                          LECT-320
      READ (MR,1016) (VAL(I,IP),I=34,42)                                LECT-321
      WRITE (MW,1017) (VAL(I,IP),I=34,42)                               LECT-322
   21 CONTINUE                                                          LECT-323
      IF (LO(99)) LO(102)=.TRUE.                                        LECT-324
      IF (.NOT.LO(7)) GO TO 23                                          LECT-325
      DO 22 IJ=1,NCOLX                                                  LECT-326
      LT(4)=LT(4).AND.IPI(4,IJ).EQ.0                                    LECT-327
      LT(6)=LT(6).AND.IPI(2,IJ).EQ.1                                    LECT-328
   22 LO(102)=LO(102).OR.IPI(2,IJ).NE.1                                 LECT-329
      W1=20.D0                                                          LECT-330
      LO(101)=LO(102)                                                   LECT-331
      LO(103)=LO(102).AND.(.NOT.LT(6))                                  LECT-332
      LO(108)=LO(109).OR.LO(103)                                        LECT-333
   23 LO(101)=LO(101).OR.LO(102).OR.LO(103)                             LECT-334
      LO(129)=LO(101).OR.LO(109)                                        LECT-335
      LO(130)=LO(102).OR.LO(109)                                        LECT-336
      LO(13)=LO(13).AND.LO(101)                                         LECT-337
      LO(14)=LO(14).AND.LO(102)                                         LECT-338
      LO(11)=LO(11).AND.(.NOT.LT(4))                                    LECT-339
      LO(19)=LO(19).AND.(.NOT.LT(6))                                    LECT-340
      IF (LO(19)) LO(11)=.TRUE.                                         LECT-341
      LO(108)=LO(108).OR.LO(44)                                         LECT-342
      IF ((.NOT.LO(44)).AND.LO(46)) LO(108)=.FALSE.                     LECT-343
C DEFAULT VALUE OF MATCHING RADIUS: MAX(R*A**1/3+10*A).                 LECT-344
C DEFAULT VALUE FOR INTEGRATION STEP: MIN(MIN(A)/2,1/(2*K)).            LECT-345
      IF (RM.LE.0.D0) RM=W1                                             LECT-346
      IF (H.LE.0.D0) H=DMIN1(W2/2.D0,0.5D0/WV(4,1))                     LECT-347
      ISM=IDINT(RM/H+0.5D0)                                             LECT-348
      H=DFLOAT(ISM)                                                     LECT-349
      H=RM/H                                                            LECT-350
      RM=H*ISM                                                          LECT-351
      WRITE (MW,1018) H,RM                                              LECT-352
      IF (LO(66)) GO TO 24                                              LECT-353
C INPUT OF LIMITS FOR CALCULATION AT EQUIDISTANT ANGLES.                LECT-354
      READ (MR,1001) THETA1,DTHETA,THETA2,DTHE                          LECT-355
      IF (DTHETA.EQ.0.D0) DTHETA=1.D0                                   LECT-356
      IF ((THETA2-THETA1)*DTHETA.LT.0.D0) DTHETA=-DTHETA                LECT-357
      WRITE (MW,1019) THETA1,DTHETA,THETA2,DTHE                         LECT-358
C INPUT OF DEFORMED SPIN-ORBIT PARAMETERS.                              LECT-359
   24 AZ(1)=0.D0                                                        LECT-360
      AZ(2)=1.D0                                                        LECT-361
      AZ(3)=1.D0                                                        LECT-362
      AZ(4)=0.D0                                                        LECT-363
      AZ(5)=1.D0                                                        LECT-364
      AZ(6)=1.D0                                                        LECT-365
      IF (.NOT.LO(4)) GO TO 25                                          LECT-366
      READ (MR,1001) AZ                                                 LECT-367
      WRITE (MW,1020) AZ                                                LECT-368
   25 IF (.NOT.LO(81)) GO TO 32                                         LECT-369
      READ (MR,1001) BZ                                                 LECT-370
      IF (BZ(1).EQ.0.D0) BZ(1)=1.4142D0                                 LECT-371
      IF (.NOT.LO(82)) GO TO 26                                         LECT-372
      IF (BZ(2).EQ.0.D0) BZ(2)=3.5D0                                    LECT-373
      IF (BZ(3).EQ.0.D0) BZ(3)=100.D0                                   LECT-374
      WRITE (MW,1021) (BZ(I),I=1,3)                                     LECT-375
      GO TO 32                                                          LECT-376
   26 IF (BZ(3).EQ.0.D0) BZ(3)=1.212D0                                  LECT-377
      IF (BZ(4).EQ.0.D0) BZ(4)=0.78D0                                   LECT-378
      IF (BZ(5).EQ.0.D0) BZ(5)=0.228D0                                  LECT-379
      WRITE (MW,1022) (BZ(I),I=1,5)                                     LECT-380
      IF (.NOT.LO(85)) GO TO 28                                         LECT-381
      WRITE (MW,1023) NFISS                                             LECT-382
      DO 27 I=1,NFISS                                                   LECT-383
      READ (MR,1001) FISS(1,I),FISS(2,I)                                LECT-384
      IF (FISS(2,I).LT.0.5D0) FISS(2,I)=0.D0                            LECT-385
   27 WRITE (MW,1024) FISS(1,I),FISS(2,I)                               LECT-386
   28 IF (.NOT.LO(86)) GO TO 30                                         LECT-387
      WRITE (MW,1025)                                                   LECT-388
      IF (NRD.GT.0) GO TO 29                                            LECT-389
      READ (MR,1001) TG0,BN,FNUG,EGD,GGD                                LECT-390
      READ (MR,1001) SCN(7,1),(SCN(I,1),I=1,6)                          LECT-391
      IF (BN.EQ.0.D0) BN=8.D0                                           LECT-392
      IF (FNUG.LT.1.D0) FNUG=20.D0                                      LECT-393
      IF (TG0.EQ.0.D0) LO(86)=.FALSE.                                   LECT-394
      WRITE (MW,1026) TG0,BN,FNUG,EGD,GGD                               LECT-395
      J=1                                                               LECT-396
      WRITE (MW,1027) J,(SCN(I,J),I=1,7)                                LECT-397
      NA=IDINT(WV(2,1)+WV(1,1)+.5D0)                                    LECT-398
      CALL LDEN(NA,SCN(1,1))                                            LECT-399
      GO TO 30                                                          LECT-400
   29 READ (MR,1001) (GAM(I),I=1,NRD)                                   LECT-401
      WRITE (MW,1028) (GAM(I),I=1,NRD)                                  LECT-402
   30 IF (NCONT.EQ.0) GO TO 32                                          LECT-403
      WRITE (MW,1029)                                                   LECT-404
      J1=1+NCONS-NCONT                                                  LECT-405
      DO 31 J=J1,NCONS                                                  LECT-406
      READ (MR,1001) SCN(7,J),(SCN(I,J),I=1,6)                          LECT-407
      WRITE (MW,1027) J,(SCN(I,J),I=1,7)                                LECT-408
      NA=IDINT(WV(2,NCOLX+J-NCONS)+.5D0)                                LECT-409
   31 CALL LDEN(NA,SCN(1,J))                                            LECT-410
   32 RETURN                                                            LECT-411
   33 WRITE (MW,1030) IQM,IQMAX                                         LECT-412
      STOP                                                              LECT-413
 1000 FORMAT (2I5,F10.5,I5)                                             LECT-414
 1001 FORMAT (7F10.5)                                                   LECT-415
 1002 FORMAT (10X,'PHONON',I3,5X,'L =',I3,5X,'K =',I3,5X,'BETA =',8F8.5)LECT-416
 1003 FORMAT (12X,'AFTER HEAVY ION CORRECTION I =',I2,'  BETA =',8F8.5) LECT-417
 1004 FORMAT (/10X,'MULTIPOLE EXPANSION UP TO IQMAX =',I3,20X,'K =',F7.2LECT-418
     1,' BAND.')                                                        LECT-419
 1005 FORMAT (/' BETA(I,J) FOR  L   K ',8X,'V',9X,'W',8X,'VS',8X,'WS',7XLECT-420
     1,'VSO',7X,'WSO',6X,'COUL S.O. COUL'/(5X,I5,5X,I2,2X,I2,2X,8F10.5))LECT-421
 1006 FORMAT (/10X,'AFTER HEAVY ION CORRECTION I =',I3/)                LECT-422
 1007 FORMAT (/10X,'RATIOS OF ANHARMONIC DEFORMATIONS'/25X,'V',9X,'W',8XLECT-423
     1,'VS',8X,'WS',7X,'VSO',7X,'WSO',6X,'COUL S.O. COUL')              LECT-424
 1008 FORMAT (' ORDER',I3,6X,I3,2X,8F10.5)                              LECT-425
 1009 FORMAT (14I5)                                                     LECT-426
 1010 FORMAT (' ORDER',I3,'  IQ =',I3,2X,8F10.5)                        LECT-427
 1011 FORMAT (/' ***** NO STATE FOR THE POTENTIAL',I3,' *** WE USE THE GLECT-428
     1ROUND STATE'/)                                                    LECT-429
 1012 FORMAT (//' OPTICAL POTENTIALS  **',I3,' **     REDUCED RADIUS MULLECT-430
     1TIPLIED BY  ',1P,D15.6/)                                          LECT-431
 1013 FORMAT (4F10.5)                                                   LECT-432
 1014 FORMAT (2X,A4,'DEFORMED  VOLUME/SCALAR REAL POTENTIAL'/' DEPTH',F1LECT-433
     12.6,' MEV   RADIUS',F10.6,' FERMI (REDUCED VALUE',F9.6,')   DIFFUSLECT-434
     2ENESS',F9.6,' FERMI AT THE POWER (1+',F9.6,')'//2X,A4,'DEFORMED  VLECT-435
     3OLUME/SCALAR IMAGINARY POTENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',FLECT-436
     410.6,' FERMI (REDUCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FERMI ALECT-437
     5T THE POWER (1+',F9.6,')'//2X,A4,'DEFORMED  SURFACE/VECTOR REAL POLECT-438
     6TENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',F10.6,' FERMI (REDUCED VALLECT-439
     7UE',F9.6,')   DIFFUSENESS',F9.6,' FERMI AT THE POWER (1+',F9.6,')'LECT-440
     8//2X,A4,'DEFORMED  SURFACE/VECTOR IMAGINARY POTENTIAL'/' DEPTH',F1LECT-441
     92.6,' MEV   RADIUS',F10.6,' FERMI (REDUCED VALUE',F9.6,')   DIFFUSLECT-442
     AENESS',F9.6,' FERMI AT THE POWER (1+',F9.6,')'//2X,A4,'DEFORMED  RLECT-443
     BEAL SPIN-ORBIT/TENSOR POTENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',F1LECT-444
     C0.6,' FERMI (REDUCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FERMI ATLECT-445
     D THE POWER (1+',F9.6,')'//2X,A4,'DEFORMED  IMAGINARY SPIN-ORBIT/TELECT-446
     ENSOR POTENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',F10.6,' FERMI (REDULECT-447
     FCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FERMI AT THE POWER (1+',FLECT-448
     H9.6,')')                                                          LECT-449
 1015 FORMAT (/2X,A4,'DEFORMED  COULOMB POTENTIAL'/'  CHARGE PRODUCT',F7LECT-450
     1.0,'  RADIUS',F10.6,' FERMI (REDUCED VALUE',F9.6,')   DIFFUSENESS'LECT-451
     2,F9.6,' FERMI AT THE POWER (1+',F9.6,')'//2X,A4,'DEFORMED  SPIN-ORLECT-452
     3BIT COULOMB POTENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',F10.6,' FERMLECT-453
     4I (REDUCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FERMI AT THE POWERLECT-454
     5 (1+',F9.6,')'/14X,'THIRD CHARGE PARAMETER',F9.6)                 LECT-455
 1016 FORMAT (3F10.5)                                                   LECT-456
 1017 FORMAT (/' *** FOLDING MODEL ***'/' REAL PART      V =',F10.4,6X,'LECT-457
     1R =',F10.4,6X,'A =',F10.4/' IMAGINARY PART V =',F10.4,6X,'R =',F10LECT-458
     2.4,6X,'A =',F10.4/' COULOMB PART   V =',F10.4,6X,'R =',F10.4,6X,'ALECT-459
     3 =',F10.4/)                                                       LECT-460
 1018 FORMAT (/' INTEGRATION STEP SIZE =',F8.5,10X,'MATCHING RADIUS =',FLECT-461
     18.3,' FERMI')                                                     LECT-462
 1019 FORMAT (/' SCATTERING ANGLES FROM',F7.3,' IN STEPS OF',F7.3,' UP TLECT-463
     1O',F8.3,' DEGREES   AVERAGED WITH +/-',F8.3,' DEGREES.'/)         LECT-464
 1020 FORMAT (10X,'****** AZ ******',1P,D15.8)                          LECT-465
 1021 FORMAT (/' SQUARE ROOT OF ELASTIC ENHANCEMENT FACTOR',8X,1P,D15.8/LECT-466
     1' SPIN CUT-OFF PARAMETER',27X,D15.8/' SQUARE ROOT OF LEVEL DENSITYLECT-467
     2 PARAMETER',11X,D15.8)                                            LECT-468
 1022 FORMAT (/' SQUARE ROOT OF ELASTIC ENHANCEMENT FACTOR WITHOUT FLUCTLECT-469
     1UATIONS',7X,1P,D15.8/' PARTICLE WIDTH FLUCTUATION DEGREE OF FREEDOLECT-470
     2M',25X,D15.8/' PARAMETERS OF MOLDAUER''S FORMULA',22X,3D15.8)     LECT-471
 1023 FORMAT (/I5,' FISSION DATA:')                                     LECT-472
 1024 FORMAT (10X,1P,2D15.8)                                            LECT-473
 1025 FORMAT (/' GAMMA DATA:')                                          LECT-474
 1026 FORMAT (5X,'TG0:',1P,D13.6,6X,'BN:',D13.6,4X,'FNUG:',D13.6,5X,'EGDLECT-475
     1:',D13.6,5X,'GGD:',D13.6/' DENSITY OF STATES GIVEN BY')           LECT-476
 1027 FORMAT (' READ VALUES'/(1X,I3,'  SA:',1P,D13.6,6X,'UX:',D13.6,5X,'LECT-477
     1TAU:',D13.6,6X,'SG:',D13.6/28X,'E0:',D13.6,6X,'EX:',D13.6,7X,'Z:',LECT-478
     20P,F5.0))                                                         LECT-479
 1028 FORMAT (1P,8D15.8)                                                LECT-480
 1029 FORMAT (' DENSITY OF STATES FOR CONTINUUM GIVEN BY')              LECT-481
 1030 FORMAT (' IQM =',I3,' OR IQMAX =',I3,' ARE LARGER THAN THE MAXIMUMLECT-482
     1 VALUES 35 OR 8 OF THE ASYMMETRIC ROTATIONAL MODEL'///' IN LECT  .LECT-483
     2..  STOP  ...')                                                   LECT-484
      END                                                               LECT-485
C 31/08/06                                                      ECIS06  LDEN-000
      SUBROUTINE LDEN(NA,SCN)                                           LDEN-001
C COMPOUND NUCLEUS PREPARATORY COMPUTATIONS ADDED BY MOLDAUER WITH PRSL LDEN-002
C INPUT:     NA:      TOTAL MASS OF THE COMPOUND NUCLEUS.               LDEN-003
C            SCN:     DESCRIPTIONS OF LEVEL DENSITIES.                  LDEN-004
C OUTPUT:    SCN:     DESCRIPTIONS OF LEVEL DENSITIES.                  LDEN-005
C IN SCN:  1-SA  2-UX   3-TAU  4-SG   5-E0   6-EX   7-Z                 LDEN-006
C          AS DESCRIBED IN THE 3DESCRIPTION OF INOUT".                  LDEN-007
C DATA PZ, PN, SZ AND SN ARE THE ONE USED BY THE CODE GNASH             LDEN-008
C***********************************************************************LDEN-009
      IMPLICIT REAL*8 (A-H,O-Z)                                         LDEN-010
      DIMENSION SCN(7)                                                  LDEN-011
      REAL*4 PZ(100),PN(150),SZ(100),SN(150)                            LDEN-012
      COMMON /INOUT/ MR,MW,MS                                           LDEN-013
      DATA PZ /0.,5.05,0.,4.50,0.,3.95,0.,3.40,0.,2.90,0.,2.46,0.,2.09,0LDEN-014
     1.,1.62,0.,1.62,0.,1.83,0.,1.73,0.,1.35,0.,1.54,0.,1.28,0.26,0.88,0LDEN-015
     2.19,1.35,-.05,1.52,-.09,1.17,.04,1.24,0.29,1.09,.26,1.17,.23,1.15,LDEN-016
     3-.08,1.35,0.34,1.05,.28,1.27,0.,1.05,0.,1.,.09,1.2,.2,1.4,.93,1.,-LDEN-017
     4.2,1.19,.09,.97,0.,.92,.11,.68,.05,.68,-.22,.79,.09,.69,.01,.72,0.LDEN-018
     5,.4,.16,.73,0.,.46,.17,.89,0.,.79,0.,.89,0.,.81,-.06,.69,-.2,.71,-LDEN-019
     6.12,.72,0.,.77,2*0./                                              LDEN-020
      DATA PN /0.,5.25,0.,4.70,0.,4.15,0.,3.58,0.,3.05,0.,2.67,0.,1.8,0.LDEN-021
     1,1.67,0.,1.86,0.,2.04,0.,1.64,0.,1.44,0.,1.54,0.,1.3,0.,1.27,0.,1.LDEN-022
     229,.08,1.41,-.08,1.5,-.05,2.24,-.47,1.43,-.15,1.44,.06,1.56,.25,1.LDEN-023
     357,-.16,1.46,0.,.93,.01,.62,-.5,1.42,.13,1.52,-.65,.8,-.08,1.29,-.LDEN-024
     447,1.25,-.44,.97,.08,1.65,-.11,1.26,-.46,1.06,0.22,1.55,-.07,1.37,LDEN-025
     50.1,1.2,-.27,.92,-.35,1.19,0.,1.05,-.25,1.61,-.21,.9,-.21,.74,-.38LDEN-026
     6,.72,-.34,.92,-.26,.94,.01,.65,-.36,.83,.11,.67,.05,1.,.51,1.04,.3LDEN-027
     73,.68,-.27,.81,.09,.75,.17,.86,.14,1.1,-.22,.84,-.47,.48,.02,.88,.LDEN-028
     824,.52,.27,.41,-.05,.38,.15,.67,0.,.61,0.,.78,0.,.67,0.,.67,0.,.79LDEN-029
     9,0.,.6,.04,.64,-.06,.45,.05,.26,-.22,.39,0.,.39/                  LDEN-030
      DATA SZ /.19,.38,.57,.75,.94,1.13,1.32,1.51,1.70,2.10,2.91,4.17,5.LDEN-031
     172,7.8,8.97,9.7,10.1,10.7,11.38,12.07,12.55,13.24,13.93,14.71,15.5LDEN-032
     23,16.37,17.36,18.6,18.7,18.01,17.87,17.08,16.6,16.75,16.5,16.35,16LDEN-033
     3.22,16.41,16.89,16.43,16.68,16.73,17.45,17.29,17.44,17.82,18.62,18LDEN-034
     4.27,19.39,19.91,19.14,18.26,17.4,16.42,15.77,14.37,13.91,13.1,13.1LDEN-035
     51,11.43,10.89,10.75,10.62,10.41,10.21,9.85,9.47,9.03,8.61,8.13,7.4LDEN-036
     66,7.48,7.2,7.13,7.06,6.78,6.64,6.64,7.68,7.89,8.41,8.49,7.88,6.3,5LDEN-037
     7.47,4.78,4.37,4.17,4.13,4.32,4.55,5.04,5.28,6.06,6.28,6.87,7.20,7.LDEN-038
     874,2*0./                                                          LDEN-039
      DATA SN /0.62,1.24,1.85,2.47,3.09,3.71,4.33,4.95,5.56,6.18,6.8,7.5LDEN-040
     13,7.55,7.21,7.44,8.07,8.94,9.81,10.6,11.39,12.54,13.68,14.34,14.19LDEN-041
     2,13.83,13.5,13.,12.13,12.6,13.26,14.13,14.92,15.52,16.38,17.16,17.LDEN-042
     355,18.03,17.59,19.03,18.71,18.8,18.99,18.46,18.25,17.76,17.38,16.7LDEN-043
     42,15.62,14.38,12.88,13.23,13.81,14.9,14.86,15.76,16.2,17.62,17.73,LDEN-044
     518.16,18.67,19.69,19.51,20.17,19.48,19.98,19.83,20.2,19.72,19.87,1LDEN-045
     69.24,18.44,17.61,17.1,16.16,15.9,15.33,14.76,13.54,12.63,10.65,10.LDEN-046
     71,8.89,10.25,9.79,11.39,11.72,12.43,12.96,13.43,13.37,12.96,12.11,LDEN-047
     811.92,11.,10.8,10.42,10.39,9.69,9.27,8.93,8.57,8.02,7.59,7.33,7.23LDEN-048
     9,7.05,7.42,6.75,6.6,6.38,6.36,6.49,6.25,5.85,5.48,4.53,4.3,3.39,2.LDEN-049
     A35,1.66,.81,0.46,-.96,-1.69,-2.53,-3.16,-1.87,-.41,.71,1.66,2.62,3LDEN-050
     B.22,3.76,4.1,4.46,4.83,5.09,5.18,5.17,5.1,5.01,4.97,5.09,5.03,4.93LDEN-051
     C,5.28,5.49,5.50,5.37,5.30/                                        LDEN-052
      NZ=IDINT(SCN(7)+.1D0)                                             LDEN-053
      IF (NZ.LE.0) NZ=NA/2                                              LDEN-054
      NN=NA-NZ                                                          LDEN-055
      AA=NA                                                             LDEN-056
      SC=0.D0                                                           LDEN-057
      PR=0.D0                                                           LDEN-058
C SA GIVEN BY P. J. BRANCAZIO AND A. G. W. CAMERON, CANADIAN JOURNAL OF LDEN-059
C PHYSICS 47 (1969) 1029.                                               LDEN-060
      IF (NZ.GT.100.OR.NN.GT.150) GO TO 1                               LDEN-061
      SC=DBLE(SN(NN)-SZ(NZ))                                            LDEN-062
      PR=DBLE(PN(NN)+PZ(NZ))                                            LDEN-063
      ND=MIN0(IABS(NZ-2),IABS(NZ-8),IABS(NZ-20),IABS(NZ-28),IABS(NZ-50),LDEN-064
     1IABS(NZ-82),IABS(NZ-126),IABS(NN-2),IABS(NN-8),IABS(NN-20),IABS(NNLDEN-065
     2-28),IABS(NN-50),IABS(NN-82),IABS(NN-126),IABS(NN-184))           LDEN-066
    1 SA=DABS((.0091D0*(SC-.23D0*DFLOAT(ND))+.143D0)*AA)                LDEN-067
      IF (SCN(1).EQ.0.D0) SCN(1)=SA                                     LDEN-068
      UX=2.5D0+150.D0/AA                                                LDEN-069
      IF (SCN(2).EQ.0.D0) SCN(2)=UX                                     LDEN-070
      TAU=1.D0/(DSQRT(SCN(1)/SCN(2))-1.5D0/SCN(2))                      LDEN-071
      IF (TAU.GT.0.D0) GO TO 2                                          LDEN-072
      SCN(3)=1.D0/(DSQRT(SA/UX)-1.5D0/UX)                               LDEN-073
      WRITE (MW,1000) TAU,SCN(3)                                        LDEN-074
    2 IF (SCN(3).EQ.0.D0) SCN(3)=TAU                                    LDEN-075
      SG=DSQRT(0.0888D0*DSQRT(SCN(1)*SCN(2))*AA**0.666666667D0)         LDEN-076
      IF (SCN(4).EQ.0.D0) SCN(4)=SG                                     LDEN-077
      EX=DABS(SCN(2)+PR)                                                LDEN-078
      E0=EX-SCN(3)*(2.D0*DSQRT(SCN(1)*SCN(2))+DLOG(SCN(3)/(16.9705627D0*LDEN-079
     1SCN(1)**.25D0*SCN(2)**1.25D0*SCN(4))))                            LDEN-080
      IF (SCN(5).EQ.0.D0) SCN(5)=E0                                     LDEN-081
      IF (SCN(6).EQ.0.D0) SCN(6)=EX                                     LDEN-082
      WRITE (MW,1001) (SCN(J),J=1,7)                                    LDEN-083
      RETURN                                                            LDEN-084
 1000 FORMAT (5X,'TEMPERATURE',F10.5,' REPLACED BY',F10.5)              LDEN-085
 1001 FORMAT (' USED VALUES'/(4X,'  SA:',1P,D13.6,6X,'UX:',D13.6,5X,'TAULDEN-086
     1:',D13.6,6X,'SG:',D13.6/28X,'E0:',D13.6,6X,'EX:',D13.6,0P,7X,'Z:',LDEN-087
     2F5.0))                                                            LDEN-088
      END                                                               LDEN-089
C 31/08/06                                                      ECIS06  DEPH-000
      SUBROUTINE DEPH(NCOL,WV,IPI,NGR,NPR,NMAX,LO,MF,KTGR,NIV,NJX,NJY)  DEPH-001
C HELICITY QUANTUM NUMBERS AND CHOICE OF OBSERVABLES FOR THE OUTPUT.    DEPH-002
C INPUT:     NCOL:    NUMBER OF COUPLED NUCLEAR LEVELS FOR DIMENSION OF DEPH-003
C                     ARRAY NIV, EQUAL TO NCOLL.                        DEPH-004
C            WV(I,*): MASS OF THE INCIDENT PARTICLE FOR J=1,            DEPH-005
C                     ENERGY IN THE CENTRE OF MASS SYSTEM FOR J=3.      DEPH-006
C            IPI(I,*):PARITY (0 FOR + AND 1 FOR -) FOR J=1,             DEPH-007
C                     MULTIPLICITY OF INCIDENT PARTICLE FOR J=2,        DEPH-008
C                     MULTIPLICITY OF THE TARGET FOR J=3,               DEPH-009
C                     PRODUCT OF CHARGES FOR J=4.                       DEPH-010
C            NGR:     INDICATION FOR PLOTS OF CROSS-SECTION: NUMBER     DEPH-011
C                     OF POWERS OF 10 BY 100 POINTS.                    DEPH-012
C            NPR:     INDICATIONS FOR PLOTS OF POLARISATIONS:           DEPH-013
C                     1 FIRST ONE,2 SECOND,3 FIRST AND SECOND ..ETC     DEPH-014
C                     ON A BINARY BASIS. THE FIRST VALUE OF NGR AND NPR DEPH-015
C                     IS FOR THE GROUND STATE AND THE SECOND ONE FOR THEDEPH-016
C                     EXCITED STATES                                    DEPH-017
C            NMAX:    MAXIMUM NUMBER OF AMPLITUDES.                     DEPH-018
C            LO(I):   LOGICAL CONTROLS:                                 DEPH-019
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     DEPH-020
C               LO(46) =.TRUE. RESTRICTED COULOMB CORRECTIONS.          DEPH-021
C               LO(66) =.TRUE. NO CALCULATION AT EQUIDISTANT ANGLES.    DEPH-022
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             DEPH-023
C               LO(92) =.TRUE. NON STANDARD OBSERVABLES AT EQUIDISTANT  DEPH-024
C                              ANGLES.                                  DEPH-025
C               LO(100)=.TRUE. DIRAC EQUATION.                          DEPH-026
C OUTPUT:    IPI(I,*):BEGINNING AND END FOR EACH LEVEL IN THE TWO PARTS DEPH-027
C                     OF THE TABLE MF FOR J=5 TO 8.                     DEPH-028
C            MF:      TABLE OF QUANTUM NUMBERS AND OBSERVABLES.         DEPH-029
C            KTGR:    LENGTH OF THE TABLE MF.                           DEPH-030
C            NIV:     ADDRESS OF COULOMB INTEGRALS IN NIV(*,*,3).       DEPH-031
C            NJX:     NUMBER OF SETS OF COULOMB FUNCTIONS AND INTEGRALS.DEPH-032
C            NJY:     MAXIMUM LABEL OF NON STANDARD OBSERVABLE.         DEPH-033
C                                                                       DEPH-034
C FOR THE COMMON  /INTEG/ SEE CALC.                                     DEPH-035
C                                                                       DEPH-036
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INTEG/:                     DEPH-037
C  NCOLS:     NUMBER OF CHANNELS WITH ANGULAR DISTRIBUTIONS.            DEPH-038
C  NJC:       MAXIMUM NUMBER OF OBSERVABLES AT EQUIDISTANT ANGLES.      DEPH-039
C  JTX:       MAXIMUM NUMBER OF CALCULATED VALUES FOR A PLOT.           DEPH-040
C  KCC:       NUMBER OF INDEPENDENT AMPLITUDES WITH UNCOUPLED STATES.   DEPH-041
C  MS1:       LARGEST PARTICLE MULTIPLICITY.                            DEPH-042
C  MS2:       LARGEST TARGET MULTIPLICITY.                              DEPH-043
C  KBA:       NUMBER OF INDEPENDENT AMPLITUDES WITHOUT UNCOUPLED STATES.DEPH-044
C  KAB:       MAXIMUM NUMBER OF EQUATIONS.                              DEPH-045
C  KBC:       MAXIMUM NUMBER OF SOLUTIONS.                              DEPH-046
C  NCT(1):    NUMBER OF EQUATIONS FOR POSITIVE PARITY.                  DEPH-047
C  NCT(2):    NUMBER OF EQUATIONS FOR NEGATIVE PARITY.                  DEPH-048
C  NCT(3):    NUMBER OF SOLUTIONS FOR POSITIVE PARITY.                  DEPH-049
C  NCT(4):    NUMBER OF SOLUTIONS FOR NEGATIVE PARITY.                  DEPH-050
C  NCT(5):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, POSITIVE PARITY. DEPH-051
C  NCT(6):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, NEGATIVE PARITY. DEPH-052
C   DEFINED:  NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,NCT.                      DEPH-053
C   USED:     NCOLS.                                                    DEPH-054
C                                                                       DEPH-055
C   **** TABLE MF **** FIRST PART                                       DEPH-056
C FOR EACH INDEPENDENT AMPLITUDE (WITH RESPECT TO PARITY ONLY):         DEPH-057
C  MF(1,*)  HELICITY OF THE OUTGOING PARTICLE,                          DEPH-058
C  MF(2,*)  HELICITY OF THE RESIDUAL TARGET,                            DEPH-059
C  MF(3,*)  HELICITY OF THE INCOMING PARTICLE,                          DEPH-060
C  MF(4,*)  HELICITY OF THE TARGET,                                     DEPH-061
C    (THESE HELICITIES ARE NUMBERED FROM THE LOWEST VALUE)              DEPH-062
C  MF(5,*)  TWICE THE MAGNETIC QUANTUM NUMBER OF THE ROTATION MATRIX    DEPH-063
C    ELEMENTS RELATED TO THE INITIAL STATE,                             DEPH-064
C  MF(6,*)  TWICE THE MAGNETIC QUANTUM NUMBER OF THE ROTATION MATRIX    DEPH-065
C    ELEMENTS FOR THE FINAL STATE,                                      DEPH-066
C    (HOWEVER, WITH ABSOLUTE VALUE 99999 IT INDICATES THAT THE LAST     DEPH-067
C    COMPUTED MATRIX ELEMENTS CAN BE USED WITH THE SIGN OF MF(10,*).    DEPH-068
C    A RE-ORDERING OF THE HELICITIES HAS BEEN DONE TO BE ABLE TO DO SO) DEPH-069
C  MF(7,*)  DIRECT ADDRESS OF THE AMPLITUDE IN AN ONE-ROW MATRIX,       DEPH-070
C  MF(8,*)  DIRECT ADDRESS OF PARITY RELATED AMPLITUDE OR 0 IF THERE IS DEPH-071
C    NONE,                                                              DEPH-072
C  MF(9,*)  RELATIVE SIGN BETWEEN THE AMPLITUDES MF(7,*) AND MF(8,*),   DEPH-073
C  MF(10,*) RELATIVE SIGN FOR ROTATION MATRIX ELEMENTS IF MF(6,*)=99999.DEPH-074
C***********************************************************************DEPH-075
      IMPLICIT REAL*8 (A-H,O-Z)                                         DEPH-076
      LOGICAL LO(150)                                                   DEPH-077
      DIMENSION WV(22,*),IPI(11,*),MF(10,*),NGR(2),NPR(2),NIV(NCOL,NCOL,DEPH-078
     13)                                                                DEPH-079
      COMMON /INOUT/ MR,MW,MS                                           DEPH-080
      COMMON /INTEG/ IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCODEPH-081
     1LS,NCOLT,NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,JTDEPH-082
     2H,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM(2),DEPH-083
     3NCT(6)                                                            DEPH-084
      NJC=2                                                             DEPH-085
      NJY=0                                                             DEPH-086
      JTX=0                                                             DEPH-087
      NCT(5)=0                                                          DEPH-088
      NCT(6)=0                                                          DEPH-089
      KCC=0                                                             DEPH-090
      MS1=0                                                             DEPH-091
      MS2=0                                                             DEPH-092
      NI=IPI(2,1)                                                       DEPH-093
      MI=IPI(3,1)                                                       DEPH-094
C LOOP ON THE NUCLEAR LEVELS.                                           DEPH-095
      DO 13 I=1,NCOLS                                                   DEPH-096
      IP=MOD(IPI(1,I)+IPI(1,1),2)                                       DEPH-097
      KI=KCC+1                                                          DEPH-098
      IPI(6,I)=KI                                                       DEPH-099
      NJ=IPI(2,I)                                                       DEPH-100
      MJ=IPI(3,I)                                                       DEPH-101
      MS1=MAX0(MS1,NJ)                                                  DEPH-102
      MS2=MAX0(MS2,MJ)                                                  DEPH-103
      DO 10 I1=1,NJ                                                     DEPH-104
      J1=NJ+1-I1                                                        DEPH-105
      DO 9 I2=1,MJ                                                      DEPH-106
      J2=MJ+1-I2                                                        DEPH-107
      DO 8 I3=1,NI                                                      DEPH-108
      J3=NI+1-I3                                                        DEPH-109
      DO 7 I4=1,MI                                                      DEPH-110
      J4=MI+1-I4                                                        DEPH-111
      IF (KCC.LT.KI) GO TO 3                                            DEPH-112
C SEARCH FOR PARITY CONJUGATE AMONG THE AMPLITUDES ALREADY OBTAINED.    DEPH-113
      DO 1 J=KI,KCC                                                     DEPH-114
      IF ((MF(1,J).EQ.J1).AND.(MF(2,J).EQ.J2).AND.(MF(3,J).EQ.J3).AND.(MDEPH-115
     1F(4,J).EQ.J4)) GO TO 2                                            DEPH-116
    1 CONTINUE                                                          DEPH-117
      GO TO 3                                                           DEPH-118
    2 MF(8,J)=I1+NJ*(I2-1+MJ*(I4-1+MI*(I3-1)))                          DEPH-119
      MF(9,J)=1-2*MOD(IP+J1+I2+J3+I4,2)                                 DEPH-120
      GO TO 7                                                           DEPH-121
C NEW AMPLITUDE.                                                        DEPH-122
    3 KCC=KCC+1                                                         DEPH-123
      IF (5*KCC.GE.NMAX) CALL MEMO('DEPH',NMAX,5*KCC)                   DEPH-124
      MF(1,KCC)=I1                                                      DEPH-125
      MF(2,KCC)=I2                                                      DEPH-126
      MF(3,KCC)=I3                                                      DEPH-127
      MF(4,KCC)=I4                                                      DEPH-128
      MF(5,KCC)=2*(MF(3,KCC)-MF(4,KCC))-IPI(2,1)+IPI(3,1)               DEPH-129
      MF(6,KCC)=2*(MF(1,KCC)-MF(2,KCC))-IPI(2,I)+IPI(3,I)               DEPH-130
      MF(7,KCC)=I1+NJ*(I2-1+MJ*(I4-1+MI*(I3-1)))                        DEPH-131
      MF(8,KCC)=0                                                       DEPH-132
      MF(9,KCC)=0                                                       DEPH-133
      MF(10,KCC)=0                                                      DEPH-134
      IF (KCC.LE.KI) GO TO 7                                            DEPH-135
C SEARCH FOR RELATED ROTATION MATRIX ELEMENTS.                          DEPH-136
      KK=KCC-1                                                          DEPH-137
      M1=IABS(MF(5,KCC)+MF(6,KCC))/2                                    DEPH-138
      M2=IABS(MF(5,KCC)-MF(6,KCC))/2                                    DEPH-139
      DO 6 J=KI,KK                                                      DEPH-140
      IF (MF(6,J).EQ.99999) GO TO 6                                     DEPH-141
      M3=IABS(MF(5,J)+MF(6,J))/2                                        DEPH-142
      M4=IABS(MF(5,J)-MF(6,J))/2                                        DEPH-143
      IF (M1.NE.M3.OR.M2.NE.M4) GO TO 6                                 DEPH-144
      MF(10,KCC)=1-MOD(IABS(MF(5,J)-MF(5,KCC)+MF(6,KCC)-MF(6,J))/2,4)   DEPH-145
      MF(6,KCC)=99999                                                   DEPH-146
      JA=J+1                                                            DEPH-147
      IF (JA.EQ.KCC) GO TO 7                                            DEPH-148
C PERMUTATION OF AMPLITUDES.                                            DEPH-149
      DO 5 M1=1,10                                                      DEPH-150
      M2=MF(M1,KCC)                                                     DEPH-151
      DO 4 M3=JA,KCC                                                    DEPH-152
      M4=KCC+JA-M3                                                      DEPH-153
    4 MF(M1,M4)=MF(M1,M4-1)                                             DEPH-154
    5 MF(M1,JA)=M2                                                      DEPH-155
      GO TO 7                                                           DEPH-156
    6 CONTINUE                                                          DEPH-157
    7 CONTINUE                                                          DEPH-158
    8 CONTINUE                                                          DEPH-159
    9 CONTINUE                                                          DEPH-160
   10 CONTINUE                                                          DEPH-161
      IPI(7,I)=KCC                                                      DEPH-162
C COMPUTATION OF THE NUMBER OF COUPLED EQUATIONS.                       DEPH-163
      L=NJ*MJ                                                           DEPH-164
      KK1=L/2                                                           DEPH-165
      KK2=L-KK1                                                         DEPH-166
      IF (KK1.EQ.KK2) GO TO 11                                          DEPH-167
      N=MJ/2+NJ/2+IPI(1,I)                                              DEPH-168
      IF (2*(N/2).EQ.N) GO TO 11                                        DEPH-169
      KK1=KK1+1                                                         DEPH-170
      KK2=KK1-1                                                         DEPH-171
   11 NCT(5)=NCT(5)+KK2                                                 DEPH-172
      NCT(6)=NCT(6)+KK1                                                 DEPH-173
      IF (I.NE.1) GO TO 12                                              DEPH-174
      NCT(3)=NCT(5)                                                     DEPH-175
      NCT(4)=NCT(6)                                                     DEPH-176
   12 IF (I.NE.NCOLL) GO TO 13                                          DEPH-177
      NCT(1)=NCT(5)                                                     DEPH-178
      NCT(2)=NCT(6)                                                     DEPH-179
      KAB=MAX0(NCT(1),NCT(2))                                           DEPH-180
      KBC=MAX0(NCT(3),NCT(4))                                           DEPH-181
      IF (NCT(4).EQ.0) KAB=NCT(1)                                       DEPH-182
      IF (NCT(3).EQ.0) KAB=NCT(2)                                       DEPH-183
      KBA=KCC                                                           DEPH-184
   13 CONTINUE                                                          DEPH-185
      IF (KBA.EQ.KCC) WRITE (MW,1000) KBC,KAB,KBA                       DEPH-186
      IF (KBA.NE.KCC) WRITE (MW,1001) KBC,KAB,KBA,KCC                   DEPH-187
      KTGR=KCC                                                          DEPH-188
      IPI(9,NCOLS)=IPI(7,NCOLS)                                         DEPH-189
      IF (LO(66)) GO TO 25                                              DEPH-190
C***********************************************************************DEPH-191
C   **** TABLE MF-FM **** SECOND PART                                   DEPH-192
C  THIS PART OF THE TABLE IS PROLONGATED IN LECD FOR EACH ANGULAR       DEPH-193
C  DISTRIBUTION AND WILL BE UPDATED BY OBSE. MF(1,*), MF(2,*) AND       DEPH-194
C  MF(5,*) ONLY ARE DEFINED HERE.                                       DEPH-195
C                                                                       DEPH-196
C  - FOR EACH OBSERVABLE:                                               DEPH-197
C  MF(1,*)             LEVEL.                                           DEPH-198
C  MF(2,*)             KIND: SEE BELOW **** STANDARD DESCRIPTIONS ****  DEPH-199
C  MF(3,I), MF(4,I)    BEGINNING AND END OF THE DESCRIPTION IN THE ARRAYDEPH-200
C                      AM DEFINED IN SUBROUTINE OBSE,                   DEPH-201
C  MF(5,*)             INDICATION FOR PLOTS,                            DEPH-202
C  MF(6,*) TO M(10,*)  CONTAINS THE LEGEND (ADDED IN SUBROUTINE OBSE).  DEPH-203
C                                                                       DEPH-204
C  ****STANDARD OPTIONS****                                             DEPH-205
C FOR ALL STATES : CROSS SECTION.                                       DEPH-206
C FOR GROUND STATE WITH CHARGED PARTICLES: CROSS SECTION DIVIDED BY     DEPH-207
C       RUTHERFORD'S CROSS-SECTION.                                     DEPH-208
C FOR SPIN 1/2 - GROUND STATE  POLARISATION.                            DEPH-209
C FOR SPIN 1/2 EXCITED STATES  VECTOR ANALYSING POWER, POLARISATION     DEPH-210
C       AND SPIN-FLIP.                                                  DEPH-211
C FOR SPIN LARGER THAN 1/2  GROUND STATE IT11, T20, T21 AND T22.        DEPH-212
C FOR EXCITED STATES, IT11, VECTOR POLARISATION, T20, T21 AND T22.      DEPH-213
C                                                                       DEPH-214
C  *** NON-STANDARD OPTIONS ***                                         DEPH-215
C  THE FIRST ONE MUST BE THE CROSS-SECTION.                             DEPH-216
C ANY OBSERVABLE NOT DESCRIBED BELOW IS IDENTIFIED BY A NEGATIVE NUMBER DEPH-217
C  OF WHICH THE POSITIVE VALUE MUST BE FOUND BY THE SUBROUTINE OBSE     DEPH-218
C  FOLLOWED BY THE DESCRIPTION OF THE OBSERVABLE.                       DEPH-219
C                                                                       DEPH-220
C **** STANDARD DESCRIPTIONS ****                                       DEPH-221
C  0  CROSS SECTION.                                                    DEPH-222
C  1  CROSS SECTION DIVIDED BY RUTHERFORD'S CROSS SECTION.              DEPH-223
C  2  VECTOR ANALYSING POWER.                                           DEPH-224
C  3  VECTOR POLARISATION.                                              DEPH-225
C  4  T20.                                                              DEPH-226
C  5  T21.                                                              DEPH-227
C  6  T22.                                                              DEPH-228
C  7  KYY OR D  DEFINED AS -A(1100 1100)-A(1100 1-100).                 DEPH-229
C  8  KXX OR R  DEFINED AS  A(1100 1100)-A(1100 1-100).                 DEPH-230
C  9  KZZ OR A' DEFINED AS  A(1000 1000).                               DEPH-231
C 10  KXZ OR R' DEFINED AS -SQRT(2.) A(1100 1000).                      DEPH-232
C 11  KZX OR A  DEFINED AS -SQRT(2.) A(1000 1100).                      DEPH-233
C 12  SPIN-FLIP :  (A(0000,0000)+A(1100,1100)+A(1100,1-100))/2.         DEPH-234
C 13  VECTOR ANALYSING POWER OF THE TARGET.                             DEPH-235
C   (NOTE A RATIO SQRT(2.) WITH IT11 FOR SPIN 1/2 FOR 2, 3 AND 13).     DEPH-236
C 14  AYY  DEFINED AS -A(1111 0000)-A(111-1 0000).                      DEPH-237
C 15  AXX  DEFINED AS  A(1111 0000)-A(111-1 0000).                      DEPH-238
C 16  AZZ  DEFINED AS  A(1010 0000).                                    DEPH-239
C 17  AXZ  DEFINED AS -SQRT(2.) A(1110 0000).                           DEPH-240
C 18  AZX  DEFINED AS -SQRT(2.) A(1011 0000).                           DEPH-241
C 19  RESERVED FOR A SET OF EXPERIMENTAL DATA WHICH ARE REACTION        DEPH-242
C          CROSS-SECTIONS.                                              DEPH-243
C***********************************************************************DEPH-244
      KX=KCC                                                            DEPH-245
      IY=1                                                              DEPH-246
      IF (.NOT.LO(92)) GO TO 14                                         DEPH-247
      READ (MR,1002) (IPI(9,I),I=1,NCOLL)                               DEPH-248
      WRITE (MW,1003) (I,IPI(9,I),I=1,NCOLL)                            DEPH-249
   14 DO 24 I=1,NCOLL                                                   DEPH-250
      IF (LO(92)) GO TO 19                                              DEPH-251
C THERE MUST BE AT LEAST PLACE TO STORE SIX OBSERVABLES                 DEPH-252
      IF (5*KX+30.GE.NMAX) CALL MEMO('DEPH',NMAX,5*KX+30)               DEPH-253
      KX=KX+1                                                           DEPH-254
      IPI(9,I)=1                                                        DEPH-255
      MF(2,KX)=0                                                        DEPH-256
      IF ((I.NE.1).OR.(IPI(4,1).EQ.0)) GO TO 15                         DEPH-257
      IPI(9,1)=2                                                        DEPH-258
      KX=KX+1                                                           DEPH-259
      MF(2,KX)=1                                                        DEPH-260
   15 MF(5,KX)=NGR(IY)                                                  DEPH-261
      IF (NI.EQ.1) GO TO 19                                             DEPH-262
      IPI(9,I)=IPI(9,I)+1                                               DEPH-263
      KX=KX+1                                                           DEPH-264
      MF(2,KX)=2                                                        DEPH-265
      IX=NPR(IY)/2                                                      DEPH-266
      MF(5,KX)=NPR(1)-2*IX                                              DEPH-267
      IF (NI.GT.2) GO TO 17                                             DEPH-268
      IF (I.EQ.1) GO TO 19                                              DEPH-269
      IF (IPI(2,I).GT.3) GO TO 16                                       DEPH-270
      IF (IPI(2,I).EQ.1) GO TO 19                                       DEPH-271
      IPI(9,I)=IPI(9,I)+1                                               DEPH-272
      KX=KX+1                                                           DEPH-273
      MF(2,KX)=3                                                        DEPH-274
      MF(5,KX)=MOD(IX,2)                                                DEPH-275
      IX=IX/2                                                           DEPH-276
   16 KX=KX+1                                                           DEPH-277
      MF(2,KX)=12                                                       DEPH-278
      MF(5,KX)=MOD(IX,2)                                                DEPH-279
      IPI(9,I)=IPI(9,I)+1                                               DEPH-280
      GO TO 19                                                          DEPH-281
   17 IPI(9,I)=IPI(9,I)+3                                               DEPH-282
      DO 18 L=4,6                                                       DEPH-283
      KX=KX+1                                                           DEPH-284
      MF(2,KX)=L                                                        DEPH-285
      MF(5,KX)=MOD(IX,2)                                                DEPH-286
   18 IX=IX/2                                                           DEPH-287
   19 K1=KTGR+1                                                         DEPH-288
      IPI(8,I)=K1                                                       DEPH-289
      KTGR=KTGR+IPI(9,I)                                                DEPH-290
      IPI(9,I)=KTGR                                                     DEPH-291
      IF (5*KTGR.GE.NMAX) CALL MEMO('DEPH',NMAX,5*KTGR)                 DEPH-292
      DO 20 J=K1,KTGR                                                   DEPH-293
   20 MF(1,J)=I                                                         DEPH-294
      IF (.NOT.LO(92)) GO TO 22                                         DEPH-295
      READ (MR,1002) (MF(2,J),J=K1,KTGR)                                DEPH-296
      IF (MF(2,K1).NE.0) WRITE (MW,1004)                                DEPH-297
      READ (MR,1002) (MF(5,J),J=K1,KTGR)                                DEPH-298
      MF(2,K1)=0                                                        DEPH-299
      WRITE (MW,1005) I,(MF(2,J),J=K1,KTGR)                             DEPH-300
      WRITE (MW,1006) (MF(5,J),J=K1,KTGR)                               DEPH-301
      DO 21 J=K1,KTGR                                                   DEPH-302
      IF (MF(2,J).GT.18) GO TO 32                                       DEPH-303
   21 CONTINUE                                                          DEPH-304
   22 JT=0                                                              DEPH-305
      DO 23 J=K1,KTGR                                                   DEPH-306
      NJY=MAX0(NJY,-MF(2,J))                                            DEPH-307
      IF (MF(2,J).EQ.0.OR.MF(2,J).EQ.1) GO TO 23                        DEPH-308
      JT=JT+1                                                           DEPH-309
   23 CONTINUE                                                          DEPH-310
      JTX=MAX0(JTX,JT)                                                  DEPH-311
      NJC=MAX0(NJC,KTGR-K1+2)                                           DEPH-312
   24 IY=2                                                              DEPH-313
      IF (LO(81)) NJC=MAX0(NJC+2,6)                                     DEPH-314
   25 IY=0                                                              DEPH-315
      IF (LO(44)) IY=1                                                  DEPH-316
      IF (LO(46).AND.LO(44)) WRITE (MW,1007)                            DEPH-317
      DO 28 I=1,NCOLL                                                   DEPH-318
      IF (LO(46).AND.LO(44)) GO TO 27                                   DEPH-319
      DO 26 J=1,NCOLL                                                   DEPH-320
   26 NIV(I,J,3)=IY                                                     DEPH-321
      IF (LO(108)) NIV(I,I,3)=1                                         DEPH-322
      GO TO 28                                                          DEPH-323
   27 READ (MR,1002) (NIV(I,J,3),J=1,NCOLL)                             DEPH-324
      WRITE (MW,1008) I,(J,NIV(I,J,3),J=1,NCOLL)                        DEPH-325
   28 CONTINUE                                                          DEPH-326
      NJ=NJX                                                            DEPH-327
      DO 30 I=1,NCOLL                                                   DEPH-328
      DO 29 J=1,I                                                       DEPH-329
      L=NIV(I,J,3)                                                      DEPH-330
      NIV(I,J,3)=0                                                      DEPH-331
C NO COUL. CORR. WITH DIFF. PARTICLE MASS, CHARGES OR A CLOSED CHANNEL  DEPH-332
      IF (L.EQ.0.OR.IPI(4,I).NE.IPI(4,J).OR.(DABS(WV(1,I)-WV(1,J)).GT.1DDEPH-333
     10).OR.WV(3,I).LT.0.D0.OR.WV(3,J).LT.0.D0) GO TO 29                DEPH-334
      NJX=NJX+1                                                         DEPH-335
      NIV(I,J,3)=NJX                                                    DEPH-336
   29 NIV(J,I,3)=NIV(I,J,3)                                             DEPH-337
   30 CONTINUE                                                          DEPH-338
      IF (NJ.EQ.NJX) RETURN                                             DEPH-339
      WRITE (MW,1009)                                                   DEPH-340
      DO 31 I=1,NCOLL                                                   DEPH-341
   31 WRITE (MW,1010) I,(NIV(I,J,3),J,J=1,NCOLL)                        DEPH-342
      RETURN                                                            DEPH-343
   32 WRITE (MW,1011)                                                   DEPH-344
      STOP                                                              DEPH-345
 1000 FORMAT (/5X,I3,' SOLUTIONS',I10,' COUPLED EQUATIONS',I10,' INDEPENDEPH-346
     1DENT AMPLITUDES.'/)                                               DEPH-347
 1001 FORMAT (/5X,I3,' SOLUTIONS',I10,' COUPLED EQUATIONS',I10,' INDEPENDEPH-348
     1DENT AMPLITUDES',I10,' SETS OF COMPOUND COEFFICIENTS.'/)          DEPH-349
 1002 FORMAT (14I5)                                                     DEPH-350
 1003 FORMAT (/' EQUIDISTANT ANGLES OUTPUT:'//(10X,'CHANNEL',I3,5X,I3,' DEPH-351
     1OBSERVABLES.'))                                                   DEPH-352
 1004 FORMAT (' THE FIRST OBSERVABLE MUST BE THE CROSS SECTION: LABEL 0.DEPH-353
     1')                                                                DEPH-354
 1005 FORMAT (' OBSERVABLES FOR CHANNEL',I3,'  : ',18I5/(24X,18I5))     DEPH-355
 1006 FORMAT (12X,'GRAPH INFORMATION: ',18I5/(24X,18I5))                DEPH-356
 1007 FORMAT (/' COULOMB CORRECTIONS ( 1=YES, 0=NO):')                  DEPH-357
 1008 FORMAT (' I =',I2,4X,10(' J =',I2,':',I1,2X)/(10X,10(' J =',I2,':'DEPH-358
     1,I1,2X)))                                                         DEPH-359
 1009 FORMAT (/' STORAGE OF COULOMB CORRECTIONS:')                      DEPH-360
 1010 FORMAT (' I =',I2,2X,6(I6,' FOR J =',I2)/(10X,6(I6,' FOR J =',I2))DEPH-361
     1)                                                                 DEPH-362
 1011 FORMAT (//' THE STANDARD OBSERVABLES ARE ONLY 19 FOR ANY OTHER GIVDEPH-363
     1E A NEGATIVE INTEGER'///' IN DEPH  ...  STOP  ...')               DEPH-364
      END                                                               DEPH-365
C 28/02/07                                                      ECIS06  LECD-000
      SUBROUTINE LECD(WV,NP,KFIT,NESSAI,YY,NJY,NMAX,LO,MF,MFM,FM,DONN,DWLECD-001
     1,NW,NMX)                                                          LECD-002
C INPUT OF EXPERIMENTAL DATA AND SEARCH INFORMATIONS.                   LECD-003
C INPUT:     WV(J,*): ENERGY IN THE CENTRE OF MASS IN MEV FOR J=3.      LECD-004
C            NP:      INDICATIONS FOR PLOTS OF CROSS-SECTION            LECD-005
C            KFIT:    NUMBER OF FITS STORED IN A SEARCH.                LECD-006
C            NESSAI:  MAXIMUM NUMBER OF EVALUATIONS IN THE SEARCH.      LECD-007
C            YY(3):   PARAMETERS FOR THE SEARCH.                        LECD-008
C            NJY:     MAXIMUM INDEX OF NON STANDARD OBSERVABLE.         LECD-009
C            NMAX:    MAXIMUM NUMBER OF DATA FOR THE WORKING SPACE.     LECD-010
C            LO(I):   LOGICAL CONTROLS:                                 LECD-011
C               LO(32) =.TRUE. AUTOMATIC SEARCH ON SOME PARAMETERS.     LECD-012
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             LECD-013
C               LO(72) =.TRUE. NO OUTPUT OF EXPERIMENTAL DATA WHEN THEY LECD-014
C                              ARE READ.                                LECD-015
C               LO(85) =.TRUE. FISSION TRANSMISSION COEFFICIENTS.       LECD-016
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      LECD-017
C OUTPUT:    NMX:     NUMBER OF INDEXES.                                LECD-018
C            MF:      CONTINUATION OF THE SECOND PART OF MF AS DESCRIBEDLECD-019
C                     IN SUBROUTINE DEPH.                               LECD-020
C            MFM,FM:  IN EQUIVALENCE BY CALL:                           LECD-021
C                     MFM(1,*) CHANNEL,                                 LECD-022
C                     MFM(2,*), MFM(3,*) BEGINNING AND END OF DATA,     LECD-023
C                     MFM(4,*) INDICATION CENTRE OF MASS OR LABORATORY  LECD-024
C                              SYSTEM BY 0 OR 1,                        LECD-025
C                     FM(3,*) WEIGHT,                                   LECD-026
C                     FM(4,*) AND FM(5,*) NORM AND ITS ERROR,           LECD-027
C                     FM(6,*) PLACE FOR CALCULATED NORMALISATION,       LECD-028
C                     FM(7,*) PLACE FOR CALCULATED CHI2.                LECD-029
C            DONN:    EXPERIMENTAL DATA: ANGLE, VALUE, ERROR,           LECD-030
C                     ANGULAR WIDTH AND PLACE FOR CORRECTED ERROR.      LECD-031
C            DW:      ACCURACY OF PARAMETERS IN SEARCH.                 LECD-032
C            NW:      INDEXES OF PARAMETERS IN SEARCH.                  LECD-033
C            NJY:     MAXIMUM INDEX OF NON STANDARD OBSERVABLE.         LECD-034
C                                                                       LECD-035
C      IF THE NUMBER OF DATA FOR AN OBSERVABLE IS 0, IT IS SUMMED       LECD-036
C      WITH THE NEXT OBSERVABLE WHICH MUST BE OF THE SAME KIND.         LECD-037
C                                                                       LECD-038
C FOR THE COMMON  /INTEG/ SEE CALC.                                     LECD-039
C                                                                       LECD-040
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INTEG/:                     LECD-041
C  NCOLS:     NUMBER OF CHANNELS WITH ANGULAR DISTRIBUTIONS.            LECD-042
C  NCOLT:     NUMBER OF CHANNELS INCLUDING UNCOUPLED STATES.            LECD-043
C  JTH:       MAXIMUM NUMBER OF ANGLES FOR A PLOT.                      LECD-044
C  NCOLR:     NUMBER OF EXPERIMENTAL ANGULAR DISTRIBUTIONS.             LECD-045
C  NREC:      NUMBER OF VARIABLES IN SEARCH.                            LECD-046
C  NTOT:      NUMBER OF EXPERIMENTAL DATA.                              LECD-047
C   DEFINED:  NTOT.                                                     LECD-048
C   USED:                                                               LECD-049
C                                                                       LECD-050
C***********************************************************************LECD-051
      IMPLICIT REAL*8 (A-H,O-Z)                                         LECD-052
      LOGICAL LO(150),LT,LX                                             LECD-053
      DIMENSION WV(22,*),MF(10,*),MFM(14,*),FM(7,*),DONN(6,*),NP(2),DW(*LECD-054
     1),NW(*),YY(3)                                                     LECD-055
      COMMON /INOUT/ MR,MW,MS                                           LECD-056
      COMMON /INTEG/ IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOLECD-057
     1LS,NCOLT,NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,JTLECD-058
     2H,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM(2),LECD-059
     3NCT(6)                                                            LECD-060
      LT=.TRUE.                                                         LECD-061
      NTOT=0                                                            LECD-062
      NCLR=0                                                            LECD-063
      NMX=NREC+1                                                        LECD-064
      DO 5 IV=1,NCOLR                                                   LECD-065
C INPUT OF THE DEFINITION OF THE ANGULAR DISTRIBUTION.                  LECD-066
      LX=.FALSE.                                                        LECD-067
      READ (MR,1000) LX,MFM(4,IV),NT,MFM(1,IV),MF(2,IV),(FM(J,IV),J=3,5)LECD-068
      IF (MFM(1,IV).GT.NCOLS) GO TO 8                                   LECD-069
      IF (WV(3,MFM(1,IV)).LE.0.D0) GO TO 9                              LECD-070
      IF (MF(2,IV).GT.19) GO TO 10                                      LECD-071
      IF (FM(3,IV).EQ.0.D0) FM(3,IV)=1.D0                               LECD-072
      IF (FM(4,IV).EQ.0.D0) FM(4,IV)=1.D0                               LECD-073
      FM(6,IV)=1.D0                                                     LECD-074
      FM(7,IV)=0.D0                                                     LECD-075
      MF(1,IV)=MFM(1,IV)                                                LECD-076
      JTH=MAX0(JTH,NT)                                                  LECD-077
      NJY=MAX0(NJY,-MF(2,IV))                                           LECD-078
      MF(5,IV)=1                                                        LECD-079
      MF2=MIN0(2,MFM(1,IV))                                             LECD-080
      IF (MF(2,IV).EQ.0.OR.MF(2,IV).EQ.1) MF(5,IV)=NP(MF2)              LECD-081
      IF (.NOT.LO(72).AND.NT.EQ.0) WRITE (MW,1001) IV,NT,MFM(1,IV),MF(2,LECD-082
     1IV)                                                               LECD-083
      IF (IV.EQ.1) GO TO 1                                              LECD-084
      IF ((.NOT.LT).AND.(MF(2,IV).NE.MF(2,IV-1))) GO TO 11              LECD-085
    1 LT=NT.NE.0                                                        LECD-086
      NS=NTOT+1                                                         LECD-087
      NTOT=NTOT+NT                                                      LECD-088
      MFM(2,IV)=NS                                                      LECD-089
      MFM(3,IV)=NTOT                                                    LECD-090
      IF (.NOT.LT) GO TO 5                                              LECD-091
      NCLR=NCLR+1                                                       LECD-092
      IF (.NOT.LO(72)) WRITE (MW,1002) IV,NT,MFM(1,IV),MF(2,IV),(FM(I,IVLECD-093
     1),I=3,5)                                                          LECD-094
      IF (.NOT.LO(72).AND.(MF(2,IV).EQ.19)) WRITE (MW,1003)             LECD-095
      LX=LX.AND.(MF(2,IV).EQ.0.OR.MF(2,IV).EQ.1.OR.MF(2,IV).EQ.19)      LECD-096
      IF (.NOT.LO(72).AND.LX) WRITE (MW,1004)                           LECD-097
      IF (.NOT.LO(72).AND.MFM(4,IV).EQ.1) WRITE (MW,1005)               LECD-098
      IF (3*NTOT+3.GE.NMAX) CALL MEMO('LECD',NMAX,3*NTOT+3)             LECD-099
C INPUT OF THE ANGULAR DISTRIBUTION DATA.                               LECD-100
      DO 2 I=NS,NTOT                                                    LECD-101
      READ (MR,1006) (DONN(J,I),J=1,5)                                  LECD-102
      IF (LX) DONN(3,I)=DONN(2,I)*DONN(3,I)*.01D0                       LECD-103
      DONN(6,I)=DONN(3,I)                                               LECD-104
      IF (.NOT.LO(72)) WRITE (MW,1007) I,(DONN(J,I),J=1,5)              LECD-105
    2 CONTINUE                                                          LECD-106
      IF (MF(2,IV).LT.19) GO TO 4                                       LECD-107
C CHECK OF TOTAL CROSS-SECTION DATA.                                    LECD-108
      DO 3 I=NS,NTOT                                                    LECD-109
      J=IDINT(DONN(1,I)+.1D0)                                           LECD-110
      IF (J.LT.0.OR.J.GT.NCOLT+2) GO TO 12                              LECD-111
      IF (J.GT.0.AND.J.LE.NCOLT.AND.WV(3,J).LE.0.D0) GO TO 13           LECD-112
      IF (LO(81).AND.J.GT.NCOLS) GO TO 12                               LECD-113
      IF ((.NOT.LO(85)).AND.J.EQ.NCOLT+1) GO TO 12                      LECD-114
      IF ((.NOT.LO(86)).AND.J.EQ.NCOLT+2) GO TO 12                      LECD-115
    3 CONTINUE                                                          LECD-116
    4 IF (FM(5,IV).EQ.0.D0) GO TO 5                                     LECD-117
      NTOT=NTOT+1                                                       LECD-118
C NORMALISATION AS A DATA FOR THE SEARCH.                               LECD-119
      DONN(2,NTOT)=FM(4,IV)                                             LECD-120
      DONN(3,NTOT)=FM(5,IV)                                             LECD-121
      IF (.NOT.LO(72)) WRITE (MW,1008) NTOT,DONN(2,NTOT),DONN(3,NTOT)   LECD-122
    5 CONTINUE                                                          LECD-123
      IF ((.NOT.LO(72)).AND.(NCOLR.NE.NCLR)) WRITE (MW,1009) NCLR,NCOLR LECD-124
      IF ((.NOT.LO(32)).OR.(NREC.EQ.0)) GO TO 7                         LECD-125
      WRITE (MW,1010) NREC,KFIT,NESSAI,YY(1),YY(2)                      LECD-126
      NISE=12*NTOT+2*NREC                                               LECD-127
      IF (NISE+NMX.GE.2*NMAX) CALL MEMO('LECD',NMAX,(NISE+NMX)/2)       LECD-128
      READ (MR,1006) (DW(6*NTOT+I),I=1,NREC)                            LECD-129
      READ (MR,1011) (NW(NISE+I),I=1,NREC)                              LECD-130
      WRITE (MW,1012) (I,NW(NISE+I),DW(6*NTOT+I),I=1,NREC)              LECD-131
      DO 6 I=1,NREC                                                     LECD-132
C A NEGATIVE VALUE -K INSTEAD OF INDEXES OF PARAMETERS MEANS THAT K     LECD-133
C PARAMETERS WILL BE KEPT PROPORTIONAL - INPUT OF THEIR INDEXES.        LECD-134
      K=-NW(NISE+I)                                                     LECD-135
      IF (K.LT.0) GO TO 6                                               LECD-136
      NW(NISE+NMX)=K                                                    LECD-137
      IF (NISE+NMX+K.GE.2*NMAX) CALL MEMO('LECD',NMAX,(NISE+NMX+K)/2)   LECD-138
      READ (MR,1011) (NW(NISE+NMX+J),J=1,K)                             LECD-139
      WRITE (MW,1013) I,(NW(NISE+NMX+J),J=1,K)                          LECD-140
      NW(NISE+I)=-NMX                                                   LECD-141
      NMX=NMX+K+1                                                       LECD-142
    6 CONTINUE                                                          LECD-143
    7 IF (LT) RETURN                                                    LECD-144
      WRITE (MW,1014)                                                   LECD-145
      GO TO 14                                                          LECD-146
    8 WRITE (MW,1015) MFM(1,IV)                                         LECD-147
      GO TO 14                                                          LECD-148
    9 WRITE (MW,1016) MFM(1,IV)                                         LECD-149
      GO TO 14                                                          LECD-150
   10 WRITE (MW,1017)                                                   LECD-151
      GO TO 14                                                          LECD-152
   11 WRITE (MW,1018) MF(2,IV),MF(2,IV-1)                               LECD-153
      GO TO 14                                                          LECD-154
   12 WRITE (MW,1019) DONN(1,I),I                                       LECD-155
      GO TO 14                                                          LECD-156
   13 WRITE (MW,1020) DONN(1,I),I                                       LECD-157
   14 WRITE (MW,1021)                                                   LECD-158
      STOP                                                              LECD-159
 1000 FORMAT (L1,I1,I3,2I5,5X,3F10.5)                                   LECD-160
 1001 FORMAT (/'  ANG. DISTR.',I3,I9,' DATA   LEVEL =',I3,5X,'KIND =',I3LECD-161
     1,' UNRESOLVED WITH THE FOLLOWING ONE.'/)                          LECD-162
 1002 FORMAT (/'  ANG. DISTR.',I3,I9,' DATA   LEVEL =',I3,5X,'KIND =',I3LECD-163
     1//5X,'WEIGHT',1P,D12.4,5X,'NORM',D12.4,'  WITH ERROR',D12.4//23X,'LECD-164
     2ANGLE',14X,'VALUE',15X,'ERROR',12X,'ANG. WIDTH',10X,'ANG. ERROR'/)LECD-165
 1003 FORMAT (' THESE DATA ARE TOTAL CROSS-SECTIONS.')                  LECD-166
 1004 FORMAT (' INPUT OF PERCENTAGE ERRORS.')                           LECD-167
 1005 FORMAT (' ANGLES IN THE LABORATORY SYSTEM.')                      LECD-168
 1006 FORMAT (7F10.5)                                                   LECD-169
 1007 FORMAT (5X,I5,1P,5D20.6)                                          LECD-170
 1008 FORMAT (5X,I5,' DATA WHICH IS A NORMALISATION',1P,D20.6,' WITH ERRLECD-171
     1OR',D20.6)                                                        LECD-172
 1009 FORMAT (/5X,I5,' DIFFERENT ANGULAR DISTRIBUTIONS INSTEAD OF',I5/) LECD-173
 1010 FORMAT (//5X,I5,' PARAMETERS IN SEARCH'/5X,I5,' RESULTS STORED'/5XLECD-174
     1,I5,' RUNS    STARTING SCALE',F10.2/12X,'MULTIPLICATION FACTOR',F1LECD-175
     20.2/)                                                             LECD-176
 1011 FORMAT (14I5)                                                     LECD-177
 1012 FORMAT (5X,I5,5X,I5,5X,F15.8)                                     LECD-178
 1013 FORMAT (5X,I5,' VARIABLE DEFINED AS',20I5/(18X,20I5))             LECD-179
 1014 FORMAT (//'  THE LAST ANGULAR DISTRIBUTION INCLUDE NO DATA.')     LECD-180
 1015 FORMAT (//' LEVEL NUMBER',I4,' TOO LARGE.')                       LECD-181
 1016 FORMAT (//' LEVEL',I4,' CLOSED.')                                 LECD-182
 1017 FORMAT (//' THERE ARE ONLY 20 KIND OF PROGRAMMED OBSERVABLES'//'  LECD-183
     1FOR OTHER KINDS, INTRODUCE A NEGATIVE NUMBER AND, LATER, THEIR DESLECD-184
     2CRIPTION.')                                                       LECD-185
 1018 FORMAT (//' THE KIND =',I3,' OF THIS OBSERVABLE IS NOT THE SAME ASLECD-186
     1 THE KIND =',I3,' OF THE PREVIOUS ONE WHICH WAS EMPTY.')          LECD-187
 1019 FORMAT (' ANGULAR DATA',F10.5,' FOR',I4,' DATA NOT ALLOWED FOR TOTLECD-188
     1AL CROSS-SECTION.')                                               LECD-189
 1020 FORMAT (' ANGULAR DATA',F10.5,' FOR',I4,' DATA NOT ALLOWED FOR CLOLECD-190
     1SED CHANNEL.')                                                    LECD-191
 1021 FORMAT (//' IN LECD  ...  STOP  ...')                             LECD-192
      END                                                               LECD-193
C 21/02/07                                                      ECIS06  OBSE-000
      SUBROUTINE OBSE(MF,CMF,NT,NCOLR,IPI,JTN,LO,AM,JCAL,ITX,ITZ,BM,CBM,OBSE-001
     1NX,DM,NY)                                                         OBSE-002
C COMPUTES FOR EACH OBSERVABLE ALL THE INDICATIONS FOR DO LOOPS AND THE OBSE-003
C GEOMETRICAL COEFFICIENTS NEEDED IN SUBROUTINE SCAT.                   OBSE-004
C INPUT:     MF,CMF:  EQUIVALENT BY CALL, INFORMATIONS COMING FROM      OBSE-005
C                     SUBROUTINES DEPH AND LECD.                        OBSE-006
C            NT:      NUMBER OF ROWS OF MF.                             OBSE-007
C            NCOLR :  NUMBER OF EXPERIMENTAL ANGULAR DISTRIBUTIONS.     OBSE-008
C            IPI(J,*):MULTIPLICITY OF PARTICLE AND TARGET FOR J+2 AND 3.OBSE-009
C            JTN:     LENGTH AVAILABLE IN AM.                           OBSE-010
C            LO(I):   LOGICAL CONTROLS:                                 OBSE-011
C               LO(31) =.TRUE. INPUT OF EXPERIMENTAL DATA AND CHI2      OBSE-012
C                              CALCULATION.                             OBSE-013
C               LO(92) =.TRUE. NON STANDARD OBSERVABLES AT EQUIDISTANT  OBSE-014
C                              ANGLES.                                  OBSE-015
C               LO(126)=.TRUE. SOME OBSERVABLES IN LABORATORY SYSTEM.   OBSE-016
C OUTPUT:    MF,CMF:  SECOND PART DESCRIBED IN SUBROUTINE DEPH UPDATED. OBSE-017
C            AM:      CHARACTER*4 FOR TRANSFER, SEE DESCRIPTION BELOW.  OBSE-018
C            JCAL:    LENGTH OF AM.                                     OBSE-019
C            LO(I):   LOGICAL CONTROLS: LO(126) IS DEFINED HERE.        OBSE-020
C WORKING AREAS:                                                        OBSE-021
C            ITX:     EQUIVALENT WITH AM BY CALL, TO STORE QUANTUM      OBSE-022
C                     NUMBERS OF OBSERVABLES.                           OBSE-023
C            ITZ:     EQUIVALENT WITH AM BY CALL, TO STORE LEGENDS OF   OBSE-024
C                     OBSERVABLES.                                      OBSE-025
C            BM(9,*): IN EQUIVALENCE WITH AM SHIFTED OF 4 TIMES THE     OBSE-026
C                     NUMBER OF STANDARD AND NON STANDARD OBSERVABLES.  OBSE-027
C                     USED FOR COMPUTATION OF CLEBSCH-GORDAN            OBSE-028
C                     COEFFICIENTS BY RECURRENCE.                       OBSE-029
C            CBM:     IN EQUIVALENCE BY CALL WITH BM. USED FOR TRANSFER OBSE-030
C                     OF DATA TO AM.                                    OBSE-031
C            NX(18,*):IN EQUIVALENCE BY CALL WITH BM. USED FOR          OBSE-032
C                     MANIPULATION OF QUANTUM NUMBERS.                  OBSE-033
C            NY(*):   IN EQUIVALENCE BY CALL WITH NX.                   OBSE-034
C                                                                       OBSE-035
C***********************************************************************OBSE-036
C  ALL THE OBSERVABLES (AS GIVEN FOR SOME OF THEM IN SUBROUTINE DEPH FOROBSE-037
C     THE DESCRIPTION OF THE SECOND PART OF TABLE MF) ARE DEFINED AS A  OBSE-038
C     SUM OF OPERATORS "A(L1,M1,L2,M2 L1,M1,L2,M2)" WITH SOME NUMERICAL OBSE-039
C     COEFFICIENT. WITH SCATTERING AMPLITUDE B(I1,I2,I3,I4) FOR A GIVEN OBSE-040
C     ANGLE, THE CONTRIBUTION OF "A" IS GIVEN BY A QUADRUPLE SUM ON     OBSE-041
C     I1, I2, I3 AND I4 FROM IM1 TO IP1, IM2 TO IP2, IM3 TO IP3, IM4 TO OBSE-042
C     IP4 RESPECTIVELY OF:                                              OBSE-043
C     B(I1,I2,I3,I4)(COMPLEX CONJUGATE)*B(I1-NM1,I2-NM2,I3-NM3,I4-NM4)* OBSE-044
C     AM(IL1+I1)*AM(IL2-I2)*AM(IL3+I3)*AM(IL4-I4)                       OBSE-045
C     WITH AM(IL1+I1), AM(IL2-I2),... CLEBSCH-GORDAN COEFFICIENTS STOREDOBSE-046
C     IN THE SECOND PART OF TABLE AM ASSUMED TO BE DOUBLE PRECISION.    OBSE-047
C        DUE TO FREQUENT REDUCTION OF THESE CLEBSCH-GORDAN COEFFICIENTS OBSE-048
C     TO UNITY, THERE IS A LOGICAL FOR EACH DO LOOP WHICH ARE .TRUE. IF OBSE-049
C     THERE IS A TENSOR OPERATOR FOR THE RELATED DO LOOP,.FALSE. FOR    OBSE-050
C     IDENTITY OPERATOR; A FIFTH LOGICAL IS .TRUE. FOR NO TENSOR        OBSE-051
C     OPERATOR AT ALL AND A SIXTH IS .TRUE. FOR PURE IMAGINARY          OBSE-052
C     COEFFICIENT. THESE SIX LOGICALS ARE STORED ON A BINARY BASIS      OBSE-053
C     IN "JQ".                                                          OBSE-054
C        INDICATION FOR CHANGE OF FRAME, N1 FOR THE PARTICLE AND N2 THE OBSE-055
C     TARGET:                                                           OBSE-056
C            1 FOR LABORATORY SYSTEM,                                   OBSE-057
C            2 FOR AXIS ALONG THE INCIDENT DIRECTION,                   OBSE-058
C     ARE STORED UNDER THE FORM "JT"=N1+1000*N2.                        OBSE-059
C                                                                       OBSE-060
C  **** THE FIRST PART OF THE AM TABLE IS SETS OF 20 INTEGERS, EACH OF  OBSE-061
C     THEM RELATED TO A SINGLE "A" - THE 16 FIRST ARE INDICATIONS FOR   OBSE-062
C     THE 4 DO LOOPS: IM1, IP1, NM1, IL1, IM2, IP2, NM2, IL2, IM3, IP3, OBSE-063
C     NM3, IL3, IM4, IP4, NM4 AND IL4. THERE ARE FOLLOWED BY "JQ" AND   OBSE-064
C     "JT" AND THE COEFFICIENT OF THIS "A" IN DOUBLE PRECISION.         OBSE-065
C  **** THE SECOND PART ARE TENSOR OPERATOR MATRIX ELEMENTS WHICH ARE   OBSE-066
C     QUITE PURELY CLEBSCH-GORDAN COEFFICIENTS.                         OBSE-067
C                                                                       OBSE-068
C***********************************************************************OBSE-069
      IMPLICIT REAL*8 (A-H,O-Z)                                         OBSE-070
      LOGICAL LT1,LT2,LZ(6),LO(150)                                     OBSE-071
      DIMENSION MF(10,*),IPI(11,*),ITX(7,*),BM(9,*),IY(2,20),MT(4),NX(18OBSE-072
     1,*),MX(8,24),NZ(2),CX(24),DM(*),NY(*)                             OBSE-073
      CHARACTER*4 CMF(10,*),AM(*),ITZ(7,* ),CBM(*),IZ(5,20)             OBSE-074
      COMMON /INOUT/ MR,MW,MS                                           OBSE-075
      DATA IY /4*1,2*2,2*3,2*4,2*5,2*6,7,8,9,10,2*11,2*12,2*13,14,16,2*1OBSE-076
     17,18,19,20,21,2*22,2*23,2*24,2*1/                                 OBSE-077
      DATA CX /6*1.D0,2*-1.D0,1.D0,-1.D0,1.D0,2*-1.4142136573791504D0,3*OBSE-078
     1.5D0,1.4142136999999999D0,2*-1.D0,1.D0,-1.D0,1.D0,2*-1.41421365737OBSE-079
     291504D0/                                                          OBSE-080
      DATA MX,JTS /8*0,2*1,10*0,2*1,2*0,2,7*0,2,1,6*0,2*2,6*0,2*1,2*0,2*OBSE-081
     11,2*0,2*1,2*0,1,-1,2*0,2*1,2*0,2*1,2*0,2*1,2*0,1,-1,2*0,1,3*0,1,3*OBSE-082
     20,2*1,2*0,1,3*0,1,3*0,2*1,10*0,2*1,2*0,2*1,2*0,2*1,2*0,1,-1,4*0,2*OBSE-083
     31,4*0,4*1,4*0,3*1,-1,4*0,4*1,4*0,3*1,-1,4*0,1,0,1,5*0,3*1,5*0,1,0,OBSE-084
     42*1,5*0/                                                          OBSE-085
      DATA IZ /'   C','ROSS','-SEC','TION','    ','   C','. S.','/RUT','OBSE-086
     1HER.','    ','   A','SYM.',' OR ','IT11',2*'    ','VECT','. PO','LOBSE-087
     2AR.',4*'    ',' T20',4*'    ',' T21',4*'    ',' T22',3*'    ','KYYOBSE-088
     3 ','OR D',3*'    ','KXX ','OR R',2*'    ','   K','ZZ O','R A''',3*OBSE-089
     4'    ','KZX ','OR A',2*'    ','   K','XZ O','R R''',2*'    ','   SOBSE-090
     5','PIN-','FLIP',2*'    ','TARG','ET A','SYM.',4*'    ',' AYY',4*' OBSE-091
     6   ',' AXX',4*'    ' ,' AZZ',4*'    ',' AXZ',4*'    ',' AZX',2*'  OBSE-092
     7  ',' TOT','AL C','.-S.','    '/                                  OBSE-093
      IF (JTN.LT.270) CALL MEMO('OBSE',JTN,270)                         OBSE-094
C TRANSFER OF STANDARD DESCRIPTIONS.                                    OBSE-095
      DO 2 I=1,24                                                       OBSE-096
      DO 1 J=1,8                                                        OBSE-097
    1 NX(J+6,I)=MX(J,I)                                                 OBSE-098
    2 BM(3,I)=CX(I)                                                     OBSE-099
      DO 4 I=1,20                                                       OBSE-100
      ITX(1,I)=IY(1,I)                                                  OBSE-101
      ITX(2,I)=IY(2,I)                                                  OBSE-102
      DO 3 J=3,7                                                        OBSE-103
    3 ITZ(J,I)=IZ(J-2,I)                                                OBSE-104
    4 CONTINUE                                                          OBSE-105
      LO(126)=.FALSE.                                                   OBSE-106
      KIT=20                                                            OBSE-107
      KNX=24                                                            OBSE-108
      JCAL=0                                                            OBSE-109
      MT(1)=IPI(2,1)                                                    OBSE-110
      MT(2)=IPI(3,1)                                                    OBSE-111
C VERIFICATION OF INDICATIONS ALREADY IN MF(1,I).                       OBSE-112
      DO 5 I=1,NT                                                       OBSE-113
      IF (MF(2,I).LE.18) GO TO 5                                        OBSE-114
      IF (MF(2,I).EQ.19.AND.NT-I.GE.NCOLR) GO TO 83                     OBSE-115
      IF (MF(2,I).GT.19) GO TO 84                                       OBSE-116
    5 MF(6,I)=0                                                         OBSE-117
      IF (.NOT.(LO(92).OR.LO(31))) GO TO 56                             OBSE-118
C SEARCH FOR NON STANDARD OBSERVABLES.                                  OBSE-119
    6 DO 7 L=1,NT                                                       OBSE-120
      IF (MF(2,L).LT.0) GO TO 8                                         OBSE-121
    7 CONTINUE                                                          OBSE-122
      GO TO 56                                                          OBSE-123
    8 KZ=KIT                                                            OBSE-124
      KIT=KIT+1                                                         OBSE-125
C INPUT OF THE DESCRIPTION OF NON STANDARD OBSERVABLES.                 OBSE-126
      LT1=.FALSE.                                                       OBSE-127
      LT2=.FALSE.                                                       OBSE-128
      READ (MR,1000) LT1,LT2,LT3,KX,K,(ITZ(J,KIT),J=3,7)                OBSE-129
      K1=KNX+1                                                          OBSE-130
      KNX=KNX+K                                                         OBSE-131
      IF (9*KNX.GT.JTN) CALL MEMO('OBSE',JTN,9*KNX)                     OBSE-132
      READ (MR,1001) ((NX(J,I),J=7,14),I=K1,KNX)                        OBSE-133
      READ (MR,1002) (BM(3,I),I=K1,KNX)                                 OBSE-134
      IF (LT1.OR.LT2) READ (MR,1002) (BM(1,I),I=K1,KNX)                 OBSE-135
    9 K2=K1                                                             OBSE-136
      WRITE (MW,1003) KX,(ITZ(J,KIT),J=3,7),K                           OBSE-137
      IF (LT1) WRITE (MW,1004)                                          OBSE-138
      IF (LT3.EQ.1) WRITE (MW,1005)                                     OBSE-139
      IF (LT3.EQ.2) WRITE (MW,1006)                                     OBSE-140
      IF (.NOT.LT2) GO TO 22                                            OBSE-141
C OUTPUT OF THE DESCRIPTION NOT COMPLETELY IN TENSOR NOTATION           OBSE-142
C IF LT2=.TRUE. , OBSERVABLES CAN BE DEFINED AS MATRIX ELEMENTS         OBSE-143
C (MI,MF). IN THIS CASE,THE VALUES READ ARE (MI-S-1,MF-S-1) INSTEAD OF  OBSE-144
C THE QUANTUM NUMBERS OF TENSOR OPERATOR.                               OBSE-145
      WRITE (MW,1007)                                                   OBSE-146
   10 K3=MIN0(K2+5,KNX)                                                 OBSE-147
      WRITE (MW,1008) ((NX(I,J),I=11,14),J=K2,K3)                       OBSE-148
      WRITE (MW,1009) (BM(3,I),I=K2,K3)                                 OBSE-149
      WRITE (MW,1010) ((NX(I,J),I=7,10),J=K2,K3)                        OBSE-150
      WRITE (MW,1011) (BM(1,I),I=K2,K3)                                 OBSE-151
      K2=K3+1                                                           OBSE-152
      IF (K2.LE.KNX) GO TO 10                                           OBSE-153
      IV=MF(1,L)                                                        OBSE-154
      MT(3)=IPI(2,IV)                                                   OBSE-155
      MT(4)=IPI(3,IV)                                                   OBSE-156
      KLT=1                                                             OBSE-157
C SEARCH FOR NON TENSOR DESCRIPTION - PSEUDO-LOOP FOR IJ.               OBSE-158
      IJ=1                                                              OBSE-159
   11 K2=K1                                                             OBSE-160
      K6=KNX                                                            OBSE-161
   12 IF (K2.GT.K6) GO TO 14                                            OBSE-162
      DO 13 K=K2,K6                                                     OBSE-163
      IF (NX(2*IJ+5,K).LT.0) GO TO 15                                   OBSE-164
   13 CONTINUE                                                          OBSE-165
   14 IF (K6.NE.KNX) GO TO 27                                           OBSE-166
      GO TO 20                                                          OBSE-167
C RECURRENCE COMPUTATION OF (-)**(S-MF)*<S S MI -MF|L M>/SQRT(2*S+1)    OBSE-168
C STARTING WITH THE MINIMUM VALUE OF L.                                 OBSE-169
   15 M1=MT(IJ)+NX(2*IJ+5,K)                                            OBSE-170
      M2=MT(IJ)+NX(2*IJ+6,K)                                            OBSE-171
      IF (M1.LT.0.OR.M2.LT.0) GO TO 85                                  OBSE-172
      M4=M1-M2                                                          OBSE-173
      M3=IABS(M4)+1                                                     OBSE-174
      M5=MT(IJ)                                                         OBSE-175
      E2=0.D0                                                           OBSE-176
      E3=1.D0                                                           OBSE-177
      C1=DFLOAT(M1+M2-MT(IJ)+1)                                         OBSE-178
      D2=0.D0                                                           OBSE-179
      C2=0.D0                                                           OBSE-180
      DO 18 M=M3,M5                                                     OBSE-181
      IF (M.EQ.M3) GO TO 16                                             OBSE-182
      E1=E2                                                             OBSE-183
      E2=E3                                                             OBSE-184
      D1=D2                                                             OBSE-185
      F1=DFLOAT(((M-1)**2-M4**2)*(MT(IJ)**2-(M-1)**2))                  OBSE-186
      F2=DFLOAT((2*M-1)*(2*M-3))                                        OBSE-187
      D2=DSQRT(F1/F2)                                                   OBSE-188
      E3=(C1*E2-D1*E1)/D2                                               OBSE-189
   16 KNX=KNX+1                                                         OBSE-190
      DO 17 JI=7,14                                                     OBSE-191
   17 NX(JI,KNX)=NX(JI,K)                                               OBSE-192
      NX(2*IJ+5,KNX)=M-1                                                OBSE-193
      NX(2*IJ+6,KNX)=M4                                                 OBSE-194
      C2=C2+E3*E3                                                       OBSE-195
   18 BM(1,KNX)=E3                                                      OBSE-196
C NORMALISATION AND SIGN GIVEN BY COEFFICIENT FOR MAXIMUM VALUE OF L.   OBSE-197
      C2=C2*DFLOAT(MT(IJ))                                              OBSE-198
      C2=1.D0/DSQRT(C2)                                                 OBSE-199
      IF (E3.LT.0.D0) C2=-C2                                            OBSE-200
      IF (MOD(NX(2*IJ+6,K),2).EQ.0) C2=-C2                              OBSE-201
      DO 19 M=M3,M5                                                     OBSE-202
      JI=KNX+M-M5                                                       OBSE-203
      BM(3,JI)=BM(3,K)*BM(1,JI)*C2                                      OBSE-204
   19 BM(1,JI)=BM(1,K)*BM(1,JI)*C2                                      OBSE-205
      BM(3,K)=0.D0                                                      OBSE-206
      BM(1,K)=0.D0                                                      OBSE-207
      K2=K+1                                                            OBSE-208
      GO TO 12                                                          OBSE-209
   20 IJ=IJ+1                                                           OBSE-210
      IF (IJ.LE.4) GO TO 11                                             OBSE-211
      K2=K1                                                             OBSE-212
      LT2=.FALSE.                                                       OBSE-213
      IF (LT1) GO TO 22                                                 OBSE-214
C IF AXIS OF QUANTIFICATION NOT IN VERTICAL PLANE, TAKE IMAGINARY       OBSE-215
C AMPLITUDE FOR PURE IMAGINARY TENSORS.                                 OBSE-216
      DO 21 K=K1,KNX                                                    OBSE-217
      M1=NX(7,K)+NX(9,K)+NX(11,K)+NX(13,K)                              OBSE-218
      IF (MOD(M1,2).NE.0) BM(3,K)=BM(1,K)                               OBSE-219
   21 CONTINUE                                                          OBSE-220
   22 IF (LT1) GO TO 35                                                 OBSE-221
C THE FIRST NON ZERO MAGNETIC QUANTUM NUMBER MUST BE POSITIVE.          OBSE-222
      DO 26 K4=K1,KNX                                                   OBSE-223
      BM(1,K4)=0.D0                                                     OBSE-224
      DO 23 J=8,14,2                                                    OBSE-225
      IF (NX(J,K4)) 24 , 23 , 26                                        OBSE-226
   23 CONTINUE                                                          OBSE-227
      GO TO 26                                                          OBSE-228
   24 IK=0                                                              OBSE-229
      DO 25 J=8,14,2                                                    OBSE-230
      IK=IK+NX(J-1,K4)+NX(J,K4)                                         OBSE-231
   25 NX(J,K4)=-NX(J,K4)                                                OBSE-232
      IF (2*(IK/2).NE.IK) BM(3,K4)=-BM(3,K4)                            OBSE-233
   26 CONTINUE                                                          OBSE-234
      KLT=2                                                             OBSE-235
C REDUCTION OF THE DESCRIPTION:                                         OBSE-236
C FOR CHANGE INTO TENSORS IF KLT=1, FOR HERE IF KLT=2,                  OBSE-237
C FOR CHANGE TO AXIS IN THE REACTION PLANE IF KLT=3.                    OBSE-238
   27 IF (K1.GT.KNX) GO TO 86                                           OBSE-239
      DO 30 K4=K1,KNX                                                   OBSE-240
      IF (DABS(BM(3,K4))+DABS(BM(1,K4)).LT..1D-6) GO TO 32              OBSE-241
      K5=K4-1                                                           OBSE-242
      IF (K1.GT.K5) GO TO 30                                            OBSE-243
      DO 29 J=K1,K5                                                     OBSE-244
      DO 28 I=7,14                                                      OBSE-245
      IF (NX(I,J).NE.NX(I,K4)) GO TO 29                                 OBSE-246
   28 CONTINUE                                                          OBSE-247
      GO TO 31                                                          OBSE-248
   29 CONTINUE                                                          OBSE-249
   30 CONTINUE                                                          OBSE-250
      GO TO ( 20 , 35 , 50 ),KLT                                        OBSE-251
   31 BM(3,J)=BM(3,J)+BM(3,K4)                                          OBSE-252
      BM(1,J)=BM(1,J)+BM(1,K4)                                          OBSE-253
   32 KNX=KNX-1                                                         OBSE-254
      IF (KNX.LT.K4) GO TO 27                                           OBSE-255
      DO 34 K=K4,KNX                                                    OBSE-256
      DO 33 J=7,14                                                      OBSE-257
   33 NX(J,K)=NX(J,K+1)                                                 OBSE-258
      BM(1,K)=BM(1,K+1)                                                 OBSE-259
   34 BM(3,K)=BM(3,K+1)                                                 OBSE-260
      GO TO 27                                                          OBSE-261
C OUTPUT OF THE DESCRIPTION.                                            OBSE-262
   35 K3=MIN0(K2+5,KNX)                                                 OBSE-263
      WRITE (MW,1008) ((NX(I,J),I=11,14),J=K2,K3)                       OBSE-264
      WRITE (MW,1012) (BM(3,I),I=K2,K3)                                 OBSE-265
      WRITE (MW,1010) ((NX(I,J),I=7,10),J=K2,K3)                        OBSE-266
      IF (LT1) WRITE (MW,1011) (BM(1,I),I=K2,K3)                        OBSE-267
      K2=K3+1                                                           OBSE-268
      IF (K2.LE.KNX) GO TO 35                                           OBSE-269
      DO 37 K=K1,KNX                                                    OBSE-270
      DO 36 I=8,14,2                                                    OBSE-271
      IF (IABS(NX(I,K)).GT.NX(I-1,K).OR.NX(I-1,K).LT.0) GO TO 87        OBSE-272
   36 CONTINUE                                                          OBSE-273
   37 CONTINUE                                                          OBSE-274
      IF (.NOT.LT1) GO TO 54                                            OBSE-275
C CHANGE FROM VERTICAL AXIS OF QUANTIFICATION TO HELICITY DESCRIPTION   OBSE-276
C BY THE ROTATION R(PI/2,PI/2,PI/2).                                    OBSE-277
      DO 39 I=K1,KNX                                                    OBSE-278
      M1=IABS(NX(8,I))+IABS(NX(10,I))+IABS(NX(12,I))+IABS(NX(14,I))     OBSE-279
      M2=M1/2                                                           OBSE-280
      IF (2*M2.NE.M1) GO TO 88                                          OBSE-281
      IF (2*(M2/2).EQ.M2) GO TO 38                                      OBSE-282
      BM(3,I)=-BM(3,I)                                                  OBSE-283
      BM(1,I)=-BM(1,I)                                                  OBSE-284
   38 IF (M1.EQ.0) BM(1,I)=0.D0                                         OBSE-285
   39 CONTINUE                                                          OBSE-286
      KLT=3                                                             OBSE-287
C PSEUDO-LOOP ON IJ TO 50.                                              OBSE-288
      IJ=7                                                              OBSE-289
   40 J1=KNX                                                            OBSE-290
      DO 47 K3=K1,KNX                                                   OBSE-291
      K=NX(IJ,K3)                                                       OBSE-292
      N1=K+NX(IJ+1,K3)+1                                                OBSE-293
      N=2*K+1                                                           OBSE-294
      E3=1.D0                                                           OBSE-295
      IF (K.EQ.0) GO TO 42                                              OBSE-296
C ROTATION MATRIX ELEMENTS FOR PI/2.                                    OBSE-297
      DO 41 I=1,K                                                       OBSE-298
   41 E3=E3*.5D0                                                        OBSE-299
   42 C1=0.D0                                                           OBSE-300
      E2=0.D0                                                           OBSE-301
      FJ=DFLOAT(K)                                                      OBSE-302
      FS=-FJ                                                            OBSE-303
      DO 43 I=1,N1                                                      OBSE-304
      IF (I.EQ.1) GO TO 43                                              OBSE-305
      C2=C1                                                             OBSE-306
      C1=DSQRT(DFLOAT((I-1)*(1+N-I)))                                   OBSE-307
      E1=E2                                                             OBSE-308
      E2=E3                                                             OBSE-309
      E3=(2.D0*FJ*E2-E1*C2)/C1                                          OBSE-310
      FS=FS+1.D0                                                        OBSE-311
   43 F2=0.D0                                                           OBSE-312
      F3=E3                                                             OBSE-313
      D1=0.D0                                                           OBSE-314
      DO 46 J=1,N                                                       OBSE-315
      IF (J.EQ.1) GO TO 44                                              OBSE-316
      D2=D1                                                             OBSE-317
      D1=DSQRT(DFLOAT((J-1)*(1+N-J)))                                   OBSE-318
      F1=F2                                                             OBSE-319
      F2=F3                                                             OBSE-320
      F3=(2.D0*FS*F2-F1*D2)/D1                                          OBSE-321
   44 J1=J1+1                                                           OBSE-322
      IF (9*J1.GT.JTN) CALL MEMO('OBSE',JTN,9*J1)                       OBSE-323
      DO 45 L=7,14                                                      OBSE-324
   45 NX(L,J1)=NX(L,K3)                                                 OBSE-325
      BM(3,J1)=F3*BM(3,K3)                                              OBSE-326
      BM(1,J1)=F3*BM(1,K3)                                              OBSE-327
   46 NX(IJ+1,J1)=J-1-K                                                 OBSE-328
   47 CONTINUE                                                          OBSE-329
C REDUCTION OF THE DESCRIPTION.                                         OBSE-330
      J2=K1-1                                                           OBSE-331
      J3=KNX+1                                                          OBSE-332
      DO 49 J4=J3,J1                                                    OBSE-333
      J2=J2+1                                                           OBSE-334
      DO 48 L=7,14                                                      OBSE-335
   48 NX(L,J2)=NX(L,J4)                                                 OBSE-336
      BM(3,J2)=BM(3,J4)                                                 OBSE-337
   49 BM(1,J2)=BM(1,J4)                                                 OBSE-338
      KNX=J2                                                            OBSE-339
      GO TO 27                                                          OBSE-340
   50 IJ=IJ+2                                                           OBSE-341
      IF (IJ.LE.13) GO TO 40                                            OBSE-342
      DO 53 J1=K1,KNX                                                   OBSE-343
      M1=NX(7,J1)+NX(9,J1)+NX(11,J1)+NX(13,J1)                          OBSE-344
      M2=NX(8,J1)+NX(10,J1)+NX(12,J1)+NX(14,J1)+4*M1                    OBSE-345
      M3=M2/2                                                           OBSE-346
      IF (2*(M1/2).EQ.M1) GO TO 51                                      OBSE-347
      IF (2*M3.NE.M2) GO TO 52                                          OBSE-348
      BM(3,J1)=BM(1,J1)                                                 OBSE-349
      GO TO 52                                                          OBSE-350
   51 IF (2*M3.EQ.M2) GO TO 52                                          OBSE-351
      BM(3,J1)=-BM(1,J1)                                                OBSE-352
   52 IF (2*(M3/2).NE.M3) BM(3,J1)=-BM(3,J1)                            OBSE-353
   53 CONTINUE                                                          OBSE-354
      LT1=.FALSE.                                                       OBSE-355
      WRITE (MW,1013)                                                   OBSE-356
      K=KNX+1-K1                                                        OBSE-357
      GO TO 9                                                           OBSE-358
C STORAGE OF THE DESCRIPTION.                                           OBSE-359
   54 L1=0                                                              OBSE-360
      ITX(1,KIT)=K1                                                     OBSE-361
      ITX(2,KIT)=KNX                                                    OBSE-362
      DO 55 I=1,NT                                                      OBSE-363
      IF (MF(2,I).NE.-KX) GO TO 55                                      OBSE-364
      MF(2,I)=KZ                                                        OBSE-365
      MF(6,I)=LT3                                                       OBSE-366
      L1=L1+1                                                           OBSE-367
   55 CONTINUE                                                          OBSE-368
      IF (L1.EQ.0) WRITE (MW,1014) KX                                   OBSE-369
      GO TO 6                                                           OBSE-370
C COMPUTATION OF ALL THE INDICATIONS NEEDED FOR THE OBSERVABLES.        OBSE-371
C (BEGINNING AND END OF DO LOOPS,GEOMETRICAL COEFFICIENTS ...)          OBSE-372
   56 DO 57 I=1,NT                                                      OBSE-373
      I1=MF(2,I)+1                                                      OBSE-374
      MF(3,I)=ITX(1,I1)                                                 OBSE-375
   57 MF(4,I)=ITX(2,I1)                                                 OBSE-376
      LT1=.FALSE.                                                       OBSE-377
   58 LT1=.NOT.LT1                                                      OBSE-378
C LT1=.TRUE.  FIRST PASSAGE: NUMBER OF INFORMATIONS NEEDED FOR DO LOOPS OBSE-379
C LT1=.FALSE. SECOND ONE: COMPUTATION OF GEOMETRICAL COEFFICIENTS WHICH OBSE-380
C ARE STORED AFTER THE INDICATIONS FOR DO LOOPS.                        OBSE-381
      ICAL=0                                                            OBSE-382
      NCAL=0                                                            OBSE-383
      DO 78 I=1,NT                                                      OBSE-384
      IV=MF(1,I)                                                        OBSE-385
      MT(3)=IPI(2,IV)                                                   OBSE-386
      MT(4)=IPI(3,IV)                                                   OBSE-387
      IF (MF(2,I).LE.0.OR.MF(2,I).EQ.19) GO TO 78                       OBSE-388
      IF (MF(2,I).NE.1) GO TO 59                                        OBSE-389
      IF (IV.NE.1) GO TO 89                                             OBSE-390
      GO TO 78                                                          OBSE-391
   59 IF ((MF(2,I).EQ.2.AND.MT(1).LE.3).OR.(MF(2,I).EQ.3.AND.MT(3).LE.3)OBSE-392
     1) GO TO 62                                                        OBSE-393
      IF (I.EQ.1) GO TO 63                                              OBSE-394
      I1=I-1                                                            OBSE-395
      DO 60 J=1,I1                                                      OBSE-396
      IF (MF(1,I).EQ.MF(1,J).AND.MF(2,I).EQ.MF(2,J)) GO TO 61           OBSE-397
   60 CONTINUE                                                          OBSE-398
      GO TO 63                                                          OBSE-399
   61 MF(3,I)=MF(3,J)                                                   OBSE-400
      MF(4,I)=MF(4,J)                                                   OBSE-401
      GO TO 78                                                          OBSE-402
   62 MF(2,I)=-MF(2,I)                                                  OBSE-403
      IF ((MF(2,I).EQ.-2.AND.MT(1).EQ.0).OR.(MF(2,I).EQ.-3.AND.MT(3).EQ.OBSE-404
     10)) GO TO 90                                                      OBSE-405
      GO TO 78                                                          OBSE-406
   63 I1=MF(3,I)                                                        OBSE-407
      I2=MF(4,I)                                                        OBSE-408
      DO 77 KI=I1,I2                                                    OBSE-409
      KT=0                                                              OBSE-410
      DO 73 L=1,4                                                       OBSE-411
      K=NX(2*L+5,KI)                                                    OBSE-412
      NM=NX(2*L+6,KI)                                                   OBSE-413
      KT=KT+K                                                           OBSE-414
      IF (K.GT.MT(L)) GO TO 91                                          OBSE-415
      IF (ICAL.EQ.0) GO TO 65                                           OBSE-416
      DO 64 N=1,ICAL                                                    OBSE-417
      IF (MT(L).EQ.NX(15,N).AND.K.EQ.NX(16,N).AND.NM.EQ.NX(17,N)) GO TO OBSE-418
     1 71                                                               OBSE-419
   64 CONTINUE                                                          OBSE-420
   65 ICAL=ICAL+1                                                       OBSE-421
      IF (9*ICAL.GT.JTN) CALL MEMO('OBSE',JTN,9*ICAL)                   OBSE-422
      NX(15,ICAL)=MT(L)                                                 OBSE-423
      NX(16,ICAL)=K                                                     OBSE-424
      NX(17,ICAL)=NM                                                    OBSE-425
      NX(18,ICAL)=JCAL                                                  OBSE-426
      IF (LT1) GO TO 73                                                 OBSE-427
      IL=MT(L)                                                          OBSE-428
      NX(1,ICAL)=MAX0(1,1+NM)                                           OBSE-429
      NX(2,ICAL)=MIN0(IL,IL+NM)                                         OBSE-430
      NX(3,ICAL)=NM                                                     OBSE-431
      NX(4,ICAL)=JCAL-NX(1,ICAL)+1                                      OBSE-432
      IF (NX(16,ICAL).EQ.0) GO TO 70                                    OBSE-433
C RECURRENCE COMPUTATION OF GEOMETRICAL COEFFICIENTS.                   OBSE-434
      F3=DSQRT(DFLOAT(2*K+1))                                           OBSE-435
      DO 66 J=1,K                                                       OBSE-436
   66 F3=-F3*DSQRT(DFLOAT(IL-J)/DFLOAT(IL+J))                           OBSE-437
      JNM=NM                                                            OBSE-438
      INM=IABS(JNM)                                                     OBSE-439
      IF (JNM.EQ.0) GO TO 68                                            OBSE-440
      IF (INM.NE.JNM.AND.2*(INM/2).NE.INM) F3=-F3                       OBSE-441
      DO 67 J=1,INM                                                     OBSE-442
   67 F3=F3*DSQRT(DFLOAT((K+J)*(K-J+1))/DFLOAT(J*(IL-J)))               OBSE-443
   68 JCAL=JCAL+1                                                       OBSE-444
      IS=NX(2,ICAL)-NX(1,ICAL)                                          OBSE-445
      IF (JCAL+IS.GT.JTS) CALL MEMO('OBSE',JTS,JCAL+IS)                 OBSE-446
      DM(JCAL+KX)=F3                                                    OBSE-447
      IF (IS.LT.1) GO TO 70                                             OBSE-448
      F2=0.D0                                                           OBSE-449
      D1=K*(K+1)-(IL+1)*(INM-1)                                         OBSE-450
      C2=0.D0                                                           OBSE-451
      DO 69 J=1,IS                                                      OBSE-452
      C1=C2                                                             OBSE-453
      C2=DSQRT(DFLOAT(J*(IL-J)*(J+INM)*(IL-J-INM)))                     OBSE-454
      D1=D1+DFLOAT(2*(2*J-2-IL+INM))                                    OBSE-455
      F1=F2                                                             OBSE-456
      F2=F3                                                             OBSE-457
      F3=-(D1*F2+C1*F1)/C2                                              OBSE-458
      JCAL=JCAL+1                                                       OBSE-459
      DM(JCAL+KX)=F3                                                    OBSE-460
   69 CONTINUE                                                          OBSE-461
   70 N=ICAL                                                            OBSE-462
   71 IF (LT1) GO TO 73                                                 OBSE-463
      DO 72 MA=1,4                                                      OBSE-464
      MC=20*NCAL+4*L+MA-4                                               OBSE-465
   72 NY(MC+2*KX)=NX(MA,N)                                              OBSE-466
      LZ(L)=NX(16,N).NE.0                                               OBSE-467
   73 CONTINUE                                                          OBSE-468
      IF (LT1) GO TO 76                                                 OBSE-469
      LZ(5)=KT.EQ.0                                                     OBSE-470
      LZ(6)=2*(KT/2).NE.KT                                              OBSE-471
      NZ(1)=0                                                           OBSE-472
      NZ(2)=0                                                           OBSE-473
      IF (LZ(4)) NZ(2)=MF(6,I)                                          OBSE-474
      IF (LZ(3).OR.LZ(4)) NZ(1)=MF(6,I)                                 OBSE-475
      LO(126)=LO(126).OR.NZ(1).NE.0                                     OBSE-476
      IA1=0                                                             OBSE-477
      IA2=1                                                             OBSE-478
      DO 74 LI=1,6                                                      OBSE-479
      IF (LZ(LI)) IA1=IA1+IA2                                           OBSE-480
   74 IA2=2*IA2                                                         OBSE-481
      NY(20*NCAL+17+2*KX)=IA1                                           OBSE-482
      NY(20*NCAL+18+2*KX)=NZ(1)+1000*NZ(2)                              OBSE-483
      DM(10*NCAL+10+KX)=BM(3,KI)                                        OBSE-484
      DO 75 LI=2,4,2                                                    OBSE-485
      IF (.NOT.LZ(LI)) GO TO 75                                         OBSE-486
      IM=NY(20*NCAL+4*LI-3+2*KX)                                        OBSE-487
      NY(20*NCAL+4*LI-3+2*KX)=MT(LI)-NY(20*NCAL+4*LI-2+2*KX)+1          OBSE-488
      NY(20*NCAL+4*LI-2+2*KX)=MT(LI)-IM+1                               OBSE-489
      NY(20*NCAL+4*LI-1+2*KX)=-NY(20*NCAL+4*LI-1+2*KX)                  OBSE-490
      NY(20*NCAL+4*LI+2*KX)=NY(20*NCAL+4*LI+2*KX)+IM+NY(20*NCAL+4*LI-2+2OBSE-491
     1*KX)                                                              OBSE-492
   75 CONTINUE                                                          OBSE-493
   76 NCAL=NCAL+1                                                       OBSE-494
   77 CONTINUE                                                          OBSE-495
      IF (LT1) GO TO 78                                                 OBSE-496
      MF(4,I)=NCAL                                                      OBSE-497
      MF(3,I)=NCAL+I1-I2                                                OBSE-498
   78 CONTINUE                                                          OBSE-499
      IF (.NOT.LT1) GO TO 79                                            OBSE-500
      KX=9*MAX0(KNX,ICAL)                                               OBSE-501
      JCAL=10*NCAL                                                      OBSE-502
      JTS=JTN-18*(KX-1)                                                 OBSE-503
      IF (JCAL.GT.JTS) CALL MEMO('OBSE',JTS,JCAL)                       OBSE-504
      GO TO 58                                                          OBSE-505
C STORAGE OF LEGENDS AND COPY OF RESULTS.                               OBSE-506
   79 DO 81 I=1,NT                                                      OBSE-507
      I5=IABS(MF(2,I))+1                                                OBSE-508
      DO 80 J=3,7                                                       OBSE-509
   80 CMF(J+3,I)=ITZ(J,I5)                                              OBSE-510
   81 CONTINUE                                                          OBSE-511
      JN=2*JCAL                                                         OBSE-512
      DO 82 I=1,JN                                                      OBSE-513
   82 AM(I)=CBM(I+2*KX)                                                 OBSE-514
      RETURN                                                            OBSE-515
   83 WRITE (MW,1015) I,MF(2,I)                                         OBSE-516
      GO TO 92                                                          OBSE-517
   84 WRITE (MW,1016) I,MF(2,I)                                         OBSE-518
      GO TO 92                                                          OBSE-519
   85 WRITE (MW,1017) NX(2*IJ+5,K),NX(2*IJ+6,K),MT(IJ)                  OBSE-520
      GO TO 92                                                          OBSE-521
   86 WRITE (MW,1018)                                                   OBSE-522
      GO TO 92                                                          OBSE-523
   87 WRITE (MW,1019) NX(2*I-1,K1),NX(2*I,K1)                           OBSE-524
      GO TO 92                                                          OBSE-525
   88 WRITE (MW,1020)                                                   OBSE-526
      GO TO 92                                                          OBSE-527
   89 WRITE (MW,1021) MF(1,I)                                           OBSE-528
      GO TO 92                                                          OBSE-529
   90 WRITE (MW,1022) MF(1,I)                                           OBSE-530
      GO TO 92                                                          OBSE-531
   91 WRITE (MW,1023) MT(L),MF(2,I),L,K                                 OBSE-532
   92 WRITE (MW,1024)                                                   OBSE-533
      STOP                                                              OBSE-534
 1000 FORMAT (2L1,I1,I2,I5,5A4)                                         OBSE-535
 1001 FORMAT (8I5)                                                      OBSE-536
 1002 FORMAT (6F10.5)                                                   OBSE-537
 1003 FORMAT (/' OBSERVABLE',I3,' LABELLED',5X,5A4,10X,I3,' COMPONENTS')OBSE-538
 1004 FORMAT (' DEFINED WITH AN AXIS PERPENDICULAR TO THE REACTION PLANEOBSE-539
     1')                                                                OBSE-540
 1005 FORMAT (' DEFINED IN THE LABORATORY SYSTEM')                      OBSE-541
 1006 FORMAT (' DEFINED WITH RESPECT TO THE INCIDENT BEAM')             OBSE-542
 1007 FORMAT (' NOT COMPLETELY DEFINED BY TENSORS')                     OBSE-543
 1008 FORMAT (/6(11X,4I2,2X))                                           OBSE-544
 1009 FORMAT (6(' +',F8.4,'*M',9X))                                     OBSE-545
 1010 FORMAT (6(11X,4I2,2X))                                            OBSE-546
 1011 FORMAT (' IMAGINARY PARTS'/6(1X,F8.5,12X))                        OBSE-547
 1012 FORMAT (6(' +',F8.4,'*A',9X))                                     OBSE-548
 1013 FORMAT (//' AFTER TRANSFORMATION:'/)                              OBSE-549
 1014 FORMAT (' THE OBSERVABLE READ WITH NUMBER',I4,' IS NOT USED.')    OBSE-550
 1015 FORMAT (' THE',I4,'TH OBSERVABLE, OF KIND',I2,' MUST BE FOR EXPERIOBSE-551
     1MENTAL DATA.')                                                    OBSE-552
 1016 FORMAT (' THE',I4,'TH OBSERVABLE, OF KIND',I2,' IS NOT DEFINED.') OBSE-553
 1017 FORMAT (' NON TENSOR INDICATIONS',I4,' AND',I4,' INCORRECT FOR (2*OBSE-554
     1S+1) =',I3)                                                       OBSE-555
 1018 FORMAT (' ZERO OBSERVABLE.')                                      OBSE-556
 1019 FORMAT (/' TOO LARGE MAGNETIC QUANTUM NUMBER OR NEGATIVE MULTIPOLAOBSE-557
     1RITY',2I6)                                                        OBSE-558
 1020 FORMAT (' THE SUM OF MAGNETIC QUANTUM NUMBERS IS ODD FOR ONE COMPOOBSE-559
     1NENT.')                                                           OBSE-560
 1021 FORMAT (' NO CROSS SECTION DIVIDED BY RUTHERFORD''S FOR THE INELASOBSE-561
     1TIC CHANNEL',I3)                                                  OBSE-562
 1022 FORMAT (' NO POLARISATION FOR A ZERO SPIN IN THE CHANNEL',I3)     OBSE-563
 1023 FORMAT (5X,I5,' IS A TOO SMALL SPIN IN CHANNEL',I4,' AND PARTICLE'OBSE-564
     1,I4,' FOR A POLARISATION OF TENSOR ORDER',I4)                     OBSE-565
 1024 FORMAT (//' IN OBSE  ...  STOP  ...')                             OBSE-566
      END                                                               OBSE-567
C 31/08/06                                                      ECIS06  COLF-000
      SUBROUTINE COLF(NCOLT,NCOLL,IPI,WV,ISM,LMAX1,LMAX2,H,LM,NIV,LO,FG,COLF-001
     1XG,LMAX3,KXT,IEXP,Z)                                              COLF-002
C COULOMB FUNCTIONS AT THE MATCHING POINT RM=ISM*H.                     COLF-003
C INPUT:     NCOLT:   NUMBER OF NUCLEAR STATES (COUPLED OR NOT)         COLF-004
C                     AND CONTINUA FOR COMPOUND NUCLEUS.                COLF-005
C            NCOLL:   NUMBER OF COUPLED STATES.                         COLF-006
C            IPI(J,I):MULTIPLICITY OF PARTICLE AND TARGET FOR J=1 AND 2,COLF-007
C                     PRODUCT OF CHARGES FOR J=4,                       COLF-008
C                     NUMBER OF ANGULAR MOMENTA FOR I=1 AND J=10.       COLF-009
C            WV(J,*): MASS OF PARTICLE AND TARGET FOR J=1,2,            COLF-010
C                     CENTRE OF MASS ENERGY IN MEV FOR J=3.             COLF-011
C            ISM:     NUMBER OF POINTS FOR INTEGRATION.                 COLF-012
C            LMAX1:   MAXIMUM NUMBER OF COULOMB FUNCTIONS.              COLF-013
C            LMAX2:   MAXIMUM NUMBER OF COULOMB PHASE SHIFTS.           COLF-014
C            H:       INTEGRATION STEP SIZE IN FERMIS.                  COLF-015
C            LM:      LENGTH OF WORKING SPACE Z.                        COLF-016
C            NIV:     ADDRESSES OF COULOMB INTEGRALS IN NIV(*,*,3).     COLF-017
C            LO(I):   LOGICAL CONTROLS:                                 COLF-018
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 COLF-019
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     COLF-020
C               LO(108)=.TRUE. DIAGONAL COULOMB CORRECTIONS ARE NEEDED. COLF-021
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    COLF-022
C               LO(133)=.TRUE. STORE SCALAR AND COULOMB POTENTIAL       COLF-023
C                              INDEPENDENTLY.                           COLF-024
C OUTPUT:    IPI(J,I):STARTING ADDRESS OF PENETRABILITIES FOR I=NCOLL+1 COLF-025
C                     TO NCOLT AND J=8.                                 COLF-026
C                     NUMBER OF ANGULAR MOMENTA FOR J=10.               COLF-027
C            WV(J,*): OUTPUT OF SUBROUTINE KHCO FOR J=4 TO 11.          COLF-028
C            FG:      IN FG(I,J,K), COULOMB WAVE FUNCTIONS F, FP, G, GP COLF-029
C                     RESPECTIVELY FOR J=1 TO 4, FOR ANGULAR MOMENTUM   COLF-030
C                     I-1 AND CHANNEL K. IF COULOMB CORRECTIONS ARE     COLF-031
C                     REQUESTED, INTEGRALS OF F*F, F*G, G*F AND G*G     COLF-032
C                     DIVIDED BY R**2 FROM MATCHING RADIUS TO INFINITY  COLF-033
C                     WITH THE SAME ANGULAR MOMENTUM I-1 RESPECTIVELY   COLF-034
C                     FOR J+1 TO 4 AND K GIVEN BY NIV(*,*,3).           COLF-035
C            XG:      IN XG(I,K), SIGMA(I-1)-SIGMA(0) FOR ANGULAR       COLF-036
C                     MOMENTUM I-1 AND CHANNEL K. IF COULOMB CORRECTIONSCOLF-037
C                     ARE REQUESTED, INTEGRALS OF F*F DIVIDED BY R**2   COLF-038
C                     FROM ZERO TO INFINITY AND K GIVEN BY NIV(*,*,3).  COLF-039
C            LMAX3:   EFFECTIVE MAXIMUM NUMBER OF COULOMB FUNCTIONS.    COLF-040
C            KXT:     NUMBER OF PENETRABILITIES FOR UNCOUPLED STATES.   COLF-041
C WORKING AREA:                                                         COLF-042
C            IEXP:    POWERS OF 10 FOR LARGE VALUES OF FUNCTIONS        COLF-043
C                     (MULTIPLES OF 10**15).                            COLF-044
C            Z:       WORKING AREA FOR SUBROUTINE CORI.                 COLF-045
C                                                                       COLF-046
C FOR THE COMMON  /DCONS/ SEE CALC.                                     COLF-047
C                                                                       COLF-048
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     COLF-049
C  CM:        ATOMIC MASS IN MEV.                                       COLF-050
C  CHB:       PLANCK CONSTANT /(2*PI) IN MEV*FERMI.                     COLF-051
C  CCZ:       COULOMB ALPHA CONSTANT.                                   COLF-052
C  CK:        H-BAR*C.                                                  COLF-053
C  XZ:        CONVERSION FACTOR TO MILLIBARNS.                          COLF-054
C   DEFINED:  XZ.                                                       COLF-055
C   USED:     CM,CHB,CCZ,CK.                                            COLF-056
C                                                                       COLF-057
C***********************************************************************COLF-058
      IMPLICIT REAL*8 (A-H,O-Z)                                         COLF-059
      LOGICAL LO(150)                                                   COLF-060
      DIMENSION IPI(11,*),WV(22,*),FG(LMAX1,4,*),XG(LMAX2,*),IEXP(*),Z(*COLF-061
     1),NIV(NCOLL,NCOLL,3)                                              COLF-062
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            COLF-063
      COMMON /INOUT/ MR,MW,MS                                           COLF-064
      KXT=0                                                             COLF-065
      LO(133)=.FALSE.                                                   COLF-066
      WRITE (MW,1000)                                                   COLF-067
C CHECK OF THE LENGTH OF WORKING FIELD FOR IEXP.                        COLF-068
      IF (LM.LT.LMAX1) CALL MEMO('COLF',LM,LMAX1)                       COLF-069
      LMAX3=LMAX1                                                       COLF-070
C WAVE NUMBER,COULOMB PARAMETER AND CALL TO COULOMB SUBROUTINES.        COLF-071
      CALL KHCO(NCOLT,WV,IPI,WV,H,LO)                                   COLF-072
      XZ=10.D0/DFLOAT(IPI(2,1)*IPI(3,1))/WV(4,1)**2                     COLF-073
      RM=ISM*H                                                          COLF-074
      DO 6 I=1,NCOLT                                                    COLF-075
      LO(133)=LO(133).OR.((WV(5,I).NE.0.D0).AND.(WV(9,I).NE.WV(10,I)))  COLF-076
      IF (I.GT.NCOLL) GO TO 5                                           COLF-077
      WRITE (MW,1001) I,(WV(J,I),J=4,8)                                 COLF-078
      RAU=RM*WV(11,I)                                                   COLF-079
      ETA=WV(5,I)                                                       COLF-080
      IF (WV(3,I).GT.0.D0) GO TO 1                                      COLF-081
      CALL COCL(ETA,RAU,LMAX1-1,FG(1,1,I),FG(1,2,I),FG(1,3,I),FG(1,4,I),COLF-082
     1XG(1,I))                                                          COLF-083
      GO TO 2                                                           COLF-084
    1 LX=LMAX1                                                          COLF-085
      CALL FCOU(LX-1,ETA,RAU,FG(1,1,I),FG(1,2,I),FG(1,3,I),FG(1,4,I),IEXCOLF-086
     1P,XG(1,I))                                                        COLF-087
    2 IPI(10,I)=IPI(10,1)                                               COLF-088
      IF (WV(3,I).LT.0.D0) GO TO 6                                      COLF-089
C COMPUTATION OF COULOMB PHASE-SHIFTS.                                  COLF-090
      LMX1=LMAX3                                                        COLF-091
C CORRECTION OF LARGE VALUE AND SEARCH FOR MAXIMUM EFFECTIVE NUMBER     COLF-092
C OF COULOMB FUNCTIONS.                                                 COLF-093
      DO 3 J=1,LMX1                                                     COLF-094
      IF (IEXP(J).EQ.0) GO TO 3                                         COLF-095
      IF (LO(108).OR.IEXP(J).GT.15) LMAX3=MIN0(LMAX3,J)                 COLF-096
      FG(J,1,I)=FG(J,1,I)*1.D-15                                        COLF-097
      FG(J,2,I)=FG(J,2,I)*1.D-15                                        COLF-098
      FG(J,3,I)=FG(J,3,I)*1.D15                                         COLF-099
      FG(J,4,I)=FG(J,4,I)*1.D15                                         COLF-100
    3 CONTINUE                                                          COLF-101
      IF (LMX1.NE.LMAX3) WRITE (MW,1002) LMX1,LMAX3                     COLF-102
      IF (.NOT.LO(108)) IPI(10,I)=MIN0(LMAX3-1,IPI(10,1))               COLF-103
C COMPUTATION OF COULOMB INTEGRALS.                                     COLF-104
      XI=XG(1,I)                                                        COLF-105
      SI=WV(11,I)                                                       COLF-106
      DO 4 J=1,I                                                        COLF-107
      K=NIV(I,J,3)                                                      COLF-108
      IF (K.EQ.0) GO TO 4                                               COLF-109
      XJ=XG(1,J)                                                        COLF-110
      EJ=WV(5,J)                                                        COLF-111
      SJ=WV(11,J)                                                       COLF-112
      CALL CORI(ETA,EJ,RM*SI,RM*SJ,XG(1,K),XI,XJ,FG(1,1,I),FG(1,1,J),Z,LCOLF-113
     1MAX1,LMAX2,LM,LMAX3,FG(1,1,K))                                    COLF-114
    4 CONTINUE                                                          COLF-115
      GO TO 6                                                           COLF-116
    5 LY=0                                                              COLF-117
      IF (WV(3,I).GT.0.D0) LY=MIN0(IDINT(4.D0+3.3D0*DSQRT(WV(3,I))),LMAXCOLF-118
     11)                                                                COLF-119
      IPI(10,I)=LY-1                                                    COLF-120
      IPI(8,I)=KXT                                                      COLF-121
      KXT=KXT+LY*IPI(2,I)                                               COLF-122
    6 CONTINUE                                                          COLF-123
      DO 8 I=1,NCOLL                                                    COLF-124
      XG(1,I)=0.D0                                                      COLF-125
      DO 7 J=2,LMAX2                                                    COLF-126
    7 XG(J,I)=XG(J-1,I)+DATAN2(WV(5,I),DFLOAT(J-1))                     COLF-127
    8 CONTINUE                                                          COLF-128
      LO(133)=LO(133).AND.(.NOT.LO(109))                                COLF-129
      RETURN                                                            COLF-130
 1000 FORMAT (/' LEVEL       WAVE NUMBER  COULOMB PARAMETER   REDUCED MACOLF-131
     1SS       REDUCED ENERGY     STEP SIZE')                           COLF-132
 1001 FORMAT (1X,I5,5F18.10)                                            COLF-133
 1002 FORMAT (' NUMBER OF FINITE COULOMB INTEGRALS REDUCED FROM',I6,' TOCOLF-134
     1',I6)                                                             COLF-135
      END                                                               COLF-136
C 29/09/06                                                      ECIS06  KHCO-000
      SUBROUTINE KHCO(NCOLT,WV,IPI,WW,H,LO)                             KHCO-001
C INPUT:     NCOLT:   NUMBER OF NUCLEAR STATES (COUPLED OR NOT) WHEN    KHCO-002
C                     CALLED FROM COLF OR NUMBER OF CONTINUA FOR        KHCO-003
C                     COMPOUND NUCLEUS WHEN CALLED FROM CONU.           KHCO-004
C            WV(J,*): MASS OF THE PARTICLE FOR J=1,                     KHCO-005
C                     MASS OF THE TARGET FOR J=2,                       KHCO-006
C                     ENERGY IN THE CENTRE OF MASS IN MEV FOR J=3.      KHCO-007
C                     ENERGY IN THE LABORATORY SYSTEM IN MEV FOR J=12.  KHCO-008
C            IPI(J,I):PRODUCT OF CHARGES FOR J=4.                       KHCO-009
C            WW:      WV FOR THE GROUND STATE.                          KHCO-010
C            H:       INTEGRATION STEP SIZE IN FERMIS.                  KHCO-011
C            LO(I):   LOGICAL CONTROLS:                                 KHCO-012
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 KHCO-013
C               LO(93) =.TRUE. NO RECOIL CORRECTION FOR REACTIONS WITH  KHCO-014
C                              SMALL DIFFERENCES (LESS THAN .5) OF      KHCO-015
C                              TARGET MASSES.                           KHCO-016
C               LO(94) =.TRUE. NON RELATIVISTIC "REDUCED MASS" FOR DIRACKHCO-017
C                              EQUATION.                                KHCO-018
C               LO(95) =.TRUE. "REDUCED ENERGY" FOR NON COULOMB         KHCO-019
C                              INTERACTION IN RELATIVISTIC SCHROEDINGER KHCO-020
C                              EQUATION OR USE OF REST MASS IN DIRAC    KHCO-021
C                              EQUATION.                                KHCO-022
C               LO(96) =.TRUE. "REDUCED MASS" FOR COULOMB INTERACTION   KHCO-023
C                              IN RELATIVISTIC SCHROEDINGER EQUATION.   KHCO-024
C               LO(97) =.TRUE. SAME REDUCED MASS FOR ALL THE STATES     KHCO-025
C                              WITH SMALL DIFFERENCES (LESS THAN .5)    KHCO-026
C                              OF TARGET MASSES.                        KHCO-027
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    KHCO-028
C OUTPUT:    WV(J,*): WAVE NUMBER IN 1/FERMI FOR J=4,                   KHCO-029
C                     COULOMB PARAMETER FOR J=5,                        KHCO-030
C                     REDUCED MASS FOR J=6.                             KHCO-031
C                     REDUCED ENERGY FOR J=7.                           KHCO-032
C                     STEP SIZE FOR THIS LEVEL FOR J=8.                 KHCO-033
C                     SQUARE ROOT OF COEF. OF SCALAR POTENTIALS FOR J=9.KHCO-034
C                     SQUARE ROOT OF COEF. OF COUL. POTENTIALS FOR J109.KHCO-035
C                     K MULTIPLIED BY RATIO OF STEP SIZES FOR J=11.     KHCO-036
C                     REDUCED ENERGY TERM FOR J=12.                     KHCO-037
C                     SET TO 0. FOR J=14 TO 19.                         KHCO-038
C                                                                       KHCO-039
C FOR THE COMMON  /DCONS/ SEE CALC.                                     KHCO-040
C                                                                       KHCO-041
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     KHCO-042
C  CM:        ATOMIC MASS IN MEV.                                       KHCO-043
C  CHB:       PLANCK CONSTANT /(2*PI) IN MEV*FERMI.                     KHCO-044
C  CMB:       ATOMIC MASS CM DIVIDED BY H-BAR*C.                        KHCO-045
C  CCZ:       COULOMB ALPHA CONSTANT.                                   KHCO-046
C  CK:        H-BAR*C.                                                  KHCO-047
C   USED:     CM,CHB,CCZ,CK.                                            KHCO-048
C                                                                       KHCO-049
C***********************************************************************KHCO-050
      IMPLICIT REAL*8 (A-H,O-Z)                                         KHCO-051
      LOGICAL LO(150)                                                   KHCO-052
      DIMENSION IPI(11,*),WV(22,*),WW(22)                               KHCO-053
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            KHCO-054
      AMT1=DMAX1(WW(1),WW(2))                                           KHCO-055
      AMR=WW(3)/CM+WW(1)+WW(2)                                          KHCO-056
C WAVE NUMBER,COULOMB PARAMETER AND CALL TO COULOMB SUBROUTINES.        KHCO-057
      DO 6 I=1,NCOLT                                                    KHCO-058
      AMT2=DMAX1(WV(1,I),WV(2,I))                                       KHCO-059
      RC=1.D0                                                           KHCO-060
      IF ((.NOT.LO(93)).OR.(DABS(AMT1-AMT2).GT.0.5D0)) RC=AMT1/AMT2     KHCO-061
      HREC=H*RC                                                         KHCO-062
      IF ((.NOT.LO(97)).OR.(DABS(AMT1-AMT2).GT.0.5D0)) GO TO 1          KHCO-063
      AMP=WW(1)                                                         KHCO-064
      AMT=WW(2)                                                         KHCO-065
      GO TO 2                                                           KHCO-066
    1 AMP=WV(1,I)                                                       KHCO-067
      AMT=WV(2,I)                                                       KHCO-068
    2 IF (LO(8)) GO TO 3                                                KHCO-069
C NON RELATIVISTIC KINEMATICS: NO MASS CORRECTION.                      KHCO-070
      AMRE=AMP*AMT/(AMP+AMT)                                            KHCO-071
      AMRM=AMRE                                                         KHCO-072
      WSK2=CK*WV(3,I)*AMRM                                              KHCO-073
      GO TO 5                                                           KHCO-074
    3 WSK2=0.125D0*CK*WV(3,I)*(WV(3,I)/CM+2.D0*WV(1,I)+2.D0*AMT)*(WV(3,IKHCO-075
     1)/CM+2.D0*WV(1,I))*(WV(3,I)/CM+2.D0*AMT)/AMR**2                   KHCO-076
      WV(4,I)=DSQRT(DABS(WSK2))                                         KHCO-077
      AMRM=AMP*AMT/AMR                                                  KHCO-078
      IF (LO(109)) GO TO 4                                              KHCO-079
C RELATIVISTIC KINEMATICS FOR SCHROEDINGER EQUATION.                    KHCO-080
      AMRD=(AMR**4-(WV(1,I)**2-AMT**2)**2)/(4.D0*AMR**3)                KHCO-081
      AMRE=AMRD                                                         KHCO-082
      IF (LO(96)) AMRE=AMRM                                             KHCO-083
      IF (LO(95)) AMRM=AMRE                                             KHCO-084
      GO TO 5                                                           KHCO-085
    4 IF (LO(94)) AMRM=AMP*AMT/(AMP+AMT)                                KHCO-086
      IF (LO(95)) AMRM=AMP                                              KHCO-087
      AMRE=DSQRT(WSK2/CMB**2+AMRM**2)                                   KHCO-088
      IF (LO(96)) AMRE=DSQRT(WSK2/CMB**2+AMP**2)                        KHCO-089
    5 WV(4,I)=DSQRT(DABS(WSK2))                                         KHCO-090
      WV(5,I)=CM*CCZ*AMRE*IPI(4,I)/WV(4,I)/CHB**2                       KHCO-091
      WV(6,I)=CM*AMRM                                                   KHCO-092
      WV(7,I)=CM*AMRE                                                   KHCO-093
      WV(8,I)=HREC                                                      KHCO-094
      WV(9,I)=HREC*DSQRT(CK*AMRM)                                       KHCO-095
      WV(10,I)=HREC*DSQRT(CK*AMRE)                                      KHCO-096
      WV(11,I)=WV(4,I)*RC                                               KHCO-097
      WV(12,I)=HREC*HREC*WSK2                                           KHCO-098
      IF (DABS(WV(5,I)).GT.400.D0) WV(5,I)=400.D0*WV(5,I)/DABS(WV(5,I)) KHCO-099
    6 CONTINUE                                                          KHCO-100
      RETURN                                                            KHCO-101
      END                                                               KHCO-102
C 31/08/06                                                      ECIS06  COCL-000
      SUBROUTINE COCL(ETA,R,L,G,GD,F,FD,SIGMA)                          COCL-001
C COMPUTATION OF LOGARITHMIC DERIVATIVE AT THE MATCHING RADIUS OF       COCL-002
C INCREASING AND DECREASING SOLUTIONS WITH WRONSKIAN EQUAL TO UNITY     COCL-003
C FOR CLOSED CHANNELS..                                                 COCL-004
C INPUT:     ETA:     COULOMB PARAMETER.                                COCL-005
C            R:       |K|*R VALUE.                                      COCL-006
C            L:       MAXIMUM L VALUE.                                  COCL-007
C OUTPUT:    F:       DECREASING SOLUTION AT (ETA,RHO) FOR I = 1 TO L+1.COCL-008
C            FD:      DERIVATIVE OF F(I) FOR I = 1 TO L+1.              COCL-009
C            G:       INCREASING SOLUTION FOR I = 1 TO L+1.             COCL-010
C            GD:      DERIVATIVE OF F(I) FOR I = 1 TO L+1.              COCL-011
C            SIGMA:   RETURNS 0 AT THE SAME NUMBER.                     COCL-012
C                                                                       COCL-013
C FOR NEGATIVE VALUES OF ETA, THE LOGARITHMIC DERIVATIVE OF THE         COCL-014
C DECREASING SOLUTION IS COMPUTED, THE LOGARITHMIC DERIVATIVE OF THE    COCL-015
C INCREASING FUNCTION IS ASSUMED OPPOSITE. IF A NEGATIVE ETA DIFFERS    COCL-016
C BY LESS THAN 1/4 PERCENT OF AN INTEGER THE NEXT INTEGER VALUE IS      COCL-017
C USED (LAGUERRE POLYNOMIAL); IN OTHER CASES, BACKWARDS INTEGRATION     COCL-018
C STARTING BEYOND THE OSCILLATIONS ESTIMATED UP TO 2*|ETA| IS USED.     COCL-019
C                                                                       COCL-020
C THE FUNCTIONS ARE RENORMALISED TO F=G AND SUCH THAT  F*GD-G*FD=1      COCL-021
C***********************************************************************COCL-022
      IMPLICIT REAL*8 (A-H,O-Z)                                         COCL-023
      DIMENSION G(*),GD(*),F(*),FD(*),SIGMA(*),S(7)                     COCL-024
      DATA GAMA /0.577215664901533D0/                                   COCL-025
C FOR L=0.                                                              COCL-026
      IF (ETA.LE.-1.D-6) GO TO 17                                       COCL-027
      IF (ETA.GT.1.D-6) GO TO 1                                         COCL-028
C NO COULOMB POTENTIAL.                                                 COCL-029
      FP=-1.D0                                                          COCL-030
      GP=1.D0                                                           COCL-031
      GO TO 14                                                          COCL-032
C POSITIVE VALUES OF ETA.                                               COCL-033
    1 IF ((ETA+1.D0)*R.GT.8.D0) GO TO 9                                 COCL-034
C SERIES EXPANSION.                                                     COCL-035
      R2=-R*R                                                           COCL-036
      ET2=ETA+ETA                                                       COCL-037
      U0=0.D0                                                           COCL-038
      U1=R                                                              COCL-039
      V0=1.D0                                                           COCL-040
      V1=0.D0                                                           COCL-041
      U=U0+U1                                                           COCL-042
      V=V0+V1                                                           COCL-043
      UP=1.D0                                                           COCL-044
      VP=0.D0                                                           COCL-045
      DO 3 N=2,10000                                                    COCL-046
      XN=DFLOAT(N)                                                      COCL-047
      XN1=XN*(XN-1.D0)                                                  COCL-048
      U2=(ET2*R*U1-R2*U0)/XN1                                           COCL-049
      U=U+U2                                                            COCL-050
      V2=(ET2*R*V1-R2*V0-ET2*(2.D0*XN-1.D0)*U2)/XN1                     COCL-051
      V=V+V2                                                            COCL-052
      UP=UP+XN*U2/R                                                     COCL-053
      VP=VP+XN*V2/R                                                     COCL-054
      IF (DABS(U2).GT.1.D-16*DABS(U)) GO TO 2                           COCL-055
      IF (DABS(V2).LE.1.D-16*DABS(V)) GO TO 4                           COCL-056
    2 U0=U1                                                             COCL-057
      U1=U2                                                             COCL-058
      V0=V1                                                             COCL-059
    3 V1=V2                                                             COCL-060
    4 XX=DABS(ETA)                                                      COCL-061
      IF (XX.LT.1.D-8) GO TO 7                                          COCL-062
      Y=XX                                                              COCL-063
      K=0                                                               COCL-064
      IF (XX.LE.7.5D0) K=IDINT(8.5D0-XX)                                COCL-065
      X=1.D0+XX+DFLOAT(K)                                               COCL-066
      UU=1.D0/X**2                                                      COCL-067
      PSR=DLOG(X)-.5D0/X-UU/12.D0+UU**2/120.D0-UU**3/252.D0+UU**4/240.D0COCL-068
     1-UU**5/132.D0+UU**6*691.D0/32760.D0                               COCL-069
      IF (K.EQ.0) GO TO 6                                               COCL-070
      DO 5 I=1,K                                                        COCL-071
    5 PSR=PSR-1.D0/(X-DFLOAT(I))                                        COCL-072
    6 PSR=PSR-.5D0/Y+2.D0*GAMA-1.D0                                     COCL-073
      GO TO 8                                                           COCL-074
    7 PSR=GAMA-1.D0                                                     COCL-075
    8 CE=ET2*(PSR+DLOG(2.D0*R))                                         COCL-076
      FP=(VP+UP*CE+ET2*U/R)/(V+U*CE)                                    COCL-077
      GO TO 14                                                          COCL-078
    9 IF (R.LT.10.D0*(ETA+1.D0)) GO TO 11                               COCL-079
C ASYMPTOTIC EXPANSION.                                                 COCL-080
      C=1.D0/R                                                          COCL-081
      A=1.D0                                                            COCL-082
      B=A                                                               COCL-083
      D=0.D0                                                            COCL-084
      DO 10 M=1,26                                                      COCL-085
      AM=DFLOAT(M)                                                      COCL-086
      A=-A*0.5D0*(ETA+AM-1.D0)*(ETA+AM)*C/AM                            COCL-087
      B=B+A                                                             COCL-088
   10 D=D-A*AM*C                                                        COCL-089
      FP=D/B-1.D0-ETA/R                                                 COCL-090
      GO TO 14                                                          COCL-091
C LONG RANGE INTEGRATION.                                               COCL-092
   11 H=DMIN1(.001953125D0,.25D0*R)                                     COCL-093
      N=1+IDINT(10.D0/H)                                                COCL-094
      S(6)=DEXP(-H)                                                     COCL-095
      S(7)=1.D0                                                         COCL-096
      V2=H**2*(1.D0+2.D0*ETA/(R+H*DFLOAT(N)))/12.D0                     COCL-097
      V3=H**2*(1.D0+2.D0*ETA/(R+H*DFLOAT(N-1)))/12.D0                   COCL-098
      DO 13 I=N-2,-3,-1                                                 COCL-099
      DO 12 J=1,6                                                       COCL-100
   12 S(J)=S(J+1)/S(7)                                                  COCL-101
      V1=V2                                                             COCL-102
      V2=V3                                                             COCL-103
      V3=H**2*(1.D0+2.D0*ETA/(R+H*DFLOAT(I)))/12.D0                     COCL-104
   13 S(7)=(S(6)*(2.D0+10.D0*V2)-S(5)*(1.D0-V1))/(1.D0-V3)              COCL-105
      FP=((S(1)-S(7))/60.D0+.15D0*(S(6)-S(2))+.75D0*(S(3)-S(5)))/H/S(4) COCL-106
   14 XX=1.D0                                                           COCL-107
      MP=L+25+IDINT(5.D0*DABS(ETA))                                     COCL-108
      DO 15 M=MP,1,-1                                                   COCL-109
      XM=DFLOAT(M)                                                      COCL-110
      A=ETA/XM                                                          COCL-111
      B=A+XM/R                                                          COCL-112
      XX=-(A*A-1.D0)/(B+XX)+B                                           COCL-113
      IF (M.LE.L) GD(M)=XX                                              COCL-114
   15 CONTINUE                                                          COCL-115
      DO 16 M=1,L+1                                                     COCL-116
      X=DSQRT(DABS(GD(M)-FP))                                           COCL-117
      XM=DFLOAT(M)                                                      COCL-118
      F(M)=1.D0/X                                                       COCL-119
      FD(M)=FP/X                                                        COCL-120
      G(M)=1.D0/X                                                       COCL-121
      GD(M)=GD(M)/X                                                     COCL-122
      A=ETA/XM                                                          COCL-123
      B=A+XM/R                                                          COCL-124
   16 FP=(A*A-1.D0)/(B-FD(M)/F(M))-B                                    COCL-125
      GO TO 25                                                          COCL-126
C NEGATIVE VALUES OF ETA.                                               COCL-127
   17 LP=IDINT(-ETA+.5D0)                                               COCL-128
      IF (DABS((DFLOAT(LP)+ETA)/ETA).LT..0025D0) GO TO 22               COCL-129
      LL=MIN0(L,IDINT(-ETA))                                            COCL-130
      RP=DMAX1(-2.D0*ETA-R,0.D0)                                        COCL-131
      DO 20 M=0,LL                                                      COCL-132
      AL=M*(M+1)                                                        COCL-133
      H=DMIN1(.001953125D0,R/DFLOAT(4+M))                               COCL-134
      N=IDINT(1.D0+(40.D0+RP)/H)                                        COCL-135
      RR=R+DFLOAT(N)*H                                                  COCL-136
      V2=H**2*(1.D0+AL/RR**2+2.D0*ETA/RR)/12.D0                         COCL-137
      RR=R+DFLOAT(N-1)*H                                                COCL-138
      V3=H**2*(1.D0+AL/RR**2+2.D0*ETA/RR)/12.D0                         COCL-139
      S(6)=DEXP(-H)                                                     COCL-140
      S(7)=1.D0                                                         COCL-141
      DO 19 I=N-2,-3,-1                                                 COCL-142
      DO 18 J=1,6                                                       COCL-143
   18 S(J)=S(J+1)/S(7)                                                  COCL-144
      V1=V2                                                             COCL-145
      V2=V3                                                             COCL-146
      RR=R+DFLOAT(I)*H                                                  COCL-147
      V3=H**2*(1.D0+AL/RR**2+2.D0*ETA/RR)/12.D0                         COCL-148
   19 S(7)=(S(6)*(2.D0+10.D0*V2)-S(5)*(1.D0-V1))/(1.D0-V3)              COCL-149
      FP=((S(1)-S(7))/60.D0+.15D0*(S(6)-S(2))+.75D0*(S(3)-S(5)))/H      COCL-150
      FF=S(4)                                                           COCL-151
      GP=1.D0                                                           COCL-152
      IF (FP.NE.0.D0) GP=-FP                                            COCL-153
      GG=1.D0                                                           COCL-154
      IF (FF.NE.0.D0) GG=FF                                             COCL-155
      X=DSQRT(DABS(GP*FF-GG*FP))                                        COCL-156
      F(M+1)=FF/X                                                       COCL-157
      FD(M+1)=FP/X                                                      COCL-158
      G(M+1)=GG/X                                                       COCL-159
      GD(M+1)=GP/X                                                      COCL-160
   20 CONTINUE                                                          COCL-161
      IF (LL.EQ.L) GO TO 25                                             COCL-162
      FP=FD(LL+1)/F(LL+1)                                               COCL-163
      DO 21 M=LL+1,L                                                    COCL-164
      XM=DFLOAT(M)                                                      COCL-165
      A=ETA/XM                                                          COCL-166
      B=A+XM/R                                                          COCL-167
      FP=(A*A-1.D0)/(B-FD(M)/F(M))-B                                    COCL-168
      X=DSQRT(DABS(2.D0*FP))                                            COCL-169
      F(M+1)=1.D0/X                                                     COCL-170
      FD(M+1)=FP/X                                                      COCL-171
      G(M+1)=1.D0/X                                                     COCL-172
   21 GD(M+1)=-FP/X                                                     COCL-173
      GO TO 25                                                          COCL-174
   22 FF=1.D0                                                           COCL-175
      FP=1.D0                                                           COCL-176
      MP=L+50-IDINT(5.D0*ETA)                                           COCL-177
      DO 24 M=MP,1,-1                                                   COCL-178
      FFM=DFLOAT(M)                                                     COCL-179
      A=ETA/FFM                                                         COCL-180
      B=A+FFM/R                                                         COCL-181
      Z=FP+B*FF                                                         COCL-182
      FP=B*Z-(A*A-1.D0)*FF                                              COCL-183
      FF=Z                                                              COCL-184
      IF (DABS(FF).LT.1.D0) GO TO 23                                    COCL-185
      FP=FP/FF                                                          COCL-186
      FF=1.D0                                                           COCL-187
   23 IF (M.GT.L+1) GO TO 24                                            COCL-188
      GP=1.D0                                                           COCL-189
      IF (FP.NE.0.D0) GP=-FP                                            COCL-190
      GG=1.D0                                                           COCL-191
      IF (FF.NE.0.D0) GG=FF                                             COCL-192
      X=DSQRT(DABS(GP*FF-GG*FP))                                        COCL-193
      F(M)=FF/X                                                         COCL-194
      FD(M)=FP/X                                                        COCL-195
      G(M)=GG/X                                                         COCL-196
      GD(M)=GP/X                                                        COCL-197
   24 CONTINUE                                                          COCL-198
   25 DO 26 M=0,L                                                       COCL-199
   26 SIGMA(M+1)=0.D0                                                   COCL-200
      RETURN                                                            COCL-201
      END                                                               COCL-202
C 19/11/05                                                      ECIS06  FCOU-000
      SUBROUTINE FCOU(L,ETA,RO,F,FP,G,GP,IEXP,SIGMA)                    FCOU-001
C COULOMB FUNCTIONS FOR RHO > 0 AND -500 < ETA < 500  FROM - DFCOUL     FCOU-002
C FOR THE MATHEMATICAL DESCRIPTION SEE CHR. BARDIN ET. AL. CEA-N-906    FCOU-003
C OR BARDIN ET AL. COMP. PHYSICS COMM. VOL 3 (1972) PAGES 73-87         FCOU-004
C NUMERICAL PRECISION: AT LEAST 8 SIGNIFICANT FIGURES, EXCEPT FOR       FCOU-005
C THE REGION -8 < ETA < -6 AND RO < 125/6                               FCOU-006
C THE COMPUTATION OF THE PHASE SHIFTS HAS BEEN REMOVED EXCEPT FOR L=0   FCOU-007
C INPUT:     L:       FINAL ANGULAR MOMENTUM REQUIRED.                  FCOU-008
C            ETA:     COULOMB PARAMETER.                                FCOU-009
C            RO:      RADIUS.                                           FCOU-010
C OUTPUT:    F:       REGULAR FUNCTION.                                 FCOU-011
C            FP:      DERIVATIVE OF THE REGULAR FUNCTION.               FCOU-012
C            G:       IRREGULAR FUNCTION.                               FCOU-013
C            GP:      DERIVATIVE OF THE IRREGULAR FUNCTION.             FCOU-014
C            IEXP:    POWERS OF 10 BY WHICH TO MULTIPLY THE IRREGULAR   FCOU-015
C                     FUNCTIONS AND DIVIDE THE REGULAR , IF THIS POWER  FCOU-016
C                     EXCEEDS 15.                                       FCOU-017
C            SIGMA:   COULOMB PHASE-SHIFT FOR L=0.                      FCOU-018
C                                                                       FCOU-019
C SUBROUTINES FCOU, FCZ0, YFRI, YFCL, YFAS, YFIR AND FUNCTIONS SIGM AND FCOU-020
C PSI WILL BE KEPT THE SAME FOR DWBA AND ECIS.                          FCOU-021
C***********************************************************************FCOU-022
      IMPLICIT REAL*8 (A-H,O-Z)                                         FCOU-023
      DIMENSION F(*),FP(*),G(*),GP(*),IEXP(*),SIGMA(*)                  FCOU-024
      COMMON /INOUT/ MR,MW,MS                                           FCOU-025
      IF (RO.GT.0.D0.AND.DABS(ETA).LE.500.D0) GO TO 1                   FCOU-026
      WRITE (MW,1000) ETA,RO                                            FCOU-027
      STOP                                                              FCOU-028
C COMPUTATION OF THE COULOMB FUNCTIONS FOR L=0.                         FCOU-029
    1 CALL FCZ0(ETA,RO,F1,FP1,G1,GP1,IEXP1,SIGMA1)                      FCOU-030
      F(1)=F1                                                           FCOU-031
      FP(1)=FP1                                                         FCOU-032
      G(1)=G1                                                           FCOU-033
      GP(1)=GP1                                                         FCOU-034
      IEXP(1)=IEXP1                                                     FCOU-035
      SIGMA(1)=SIGMA1                                                   FCOU-036
      IF (L.LE.0) RETURN                                                FCOU-037
      LINF=0                                                            FCOU-038
      LIN=1                                                             FCOU-039
      IND=0                                                             FCOU-040
      L1=L+1                                                            FCOU-041
      ETAC=ETA*ETA                                                      FCOU-042
      IF ((ETA.GT.0.D0.AND.RO.LT.ETA+ETA.OR.RO.LT.ETA+DSQRT(ETAC+1.D0)))FCOU-043
     1 GO TO 7                                                          FCOU-044
      IF (RO.GE.ETA+DSQRT(ETAC+DFLOAT(L*(L+1)))) GO TO 5                FCOU-045
    2 ROINF=ETA+DSQRT(ETAC+DFLOAT(LINF*(LINF+1)))                       FCOU-046
      IF (RO.LT.ROINF) GO TO 3                                          FCOU-047
      IF (LINF.GE.L) GO TO 4                                            FCOU-048
      LINF=LINF+1                                                       FCOU-049
      GO TO 2                                                           FCOU-050
    3 IND=1                                                             FCOU-051
    4 LIN=LINF+1                                                        FCOU-052
    5 XM=1.D0                                                           FCOU-053
      IF (IND.EQ.0) LIN=L1                                              FCOU-054
C UPWARD RECURSION FOR THE REGULAR AND IRREGULAR FUNCTIONS.             FCOU-055
      DO 6 J=2,LIN                                                      FCOU-056
      ZIG=(DSQRT(ETAC+XM*XM))/XM                                        FCOU-057
      ZAG=ETA/XM+XM/RO                                                  FCOU-058
      F(J)=(ZAG*F(J-1)-FP(J-1))/ZIG                                     FCOU-059
      FP(J)=ZIG*F(J-1)-ZAG*F(J)                                         FCOU-060
      G(J)=(ZAG*G(J-1)-GP(J-1))/ZIG                                     FCOU-061
      GP(J)=ZIG*G(J-1)-ZAG*G(J)                                         FCOU-062
      IEXP(J)=IEXP(1)                                                   FCOU-063
    6 XM=XM+1.D0                                                        FCOU-064
      IF (IND.EQ.0) RETURN                                              FCOU-065
C DESCENDING RECURSION FOR THE REGULAR FUNCTION.                        FCOU-066
    7 FTEST=F(LIN)                                                      FCOU-067
      FPTEST=FP(LIN)                                                    FCOU-068
      LMAX=LINF+25+IDINT(5.D0*DABS(ETA))                                FCOU-069
      IF (LMAX.LT.L) LMAX=L                                             FCOU-070
      FI=1.D0                                                           FCOU-071
      FPI=1.D0                                                          FCOU-072
C ANGULAR MOMENTUM GREATER THAN THE MAXIMUM REQUIRED.                   FCOU-073
    8 XM=DFLOAT(LMAX+1)                                                 FCOU-074
      ZIG=(DSQRT(ETAC+XM*XM))/XM                                        FCOU-075
      ZAG=ETA/XM+XM/RO                                                  FCOU-076
      FL=(ZAG*FI+FPI)/ZIG                                               FCOU-077
      FPL=ZAG*FL-ZIG*FI                                                 FCOU-078
      IF (DABS(FL).LT.1.D15.AND.DABS(FPL).LT.1.D15) GO TO 9             FCOU-079
      FL=FL*1.D-15                                                      FCOU-080
      FPL=FPL*1.D-15                                                    FCOU-081
    9 FI=FL                                                             FCOU-082
      FPI=FPL                                                           FCOU-083
      IF (LMAX.LE.L) GO TO 11                                           FCOU-084
   10 LMAX=LMAX-1                                                       FCOU-085
      GO TO 8                                                           FCOU-086
C ANGULAR MOMENTUM SMALLER THAN THAT REQUIRED.                          FCOU-087
   11 F(LMAX+1)=FL                                                      FCOU-088
      FP(LMAX+1)=FPL                                                    FCOU-089
      IF (LMAX.GT.LINF) GO TO 10                                        FCOU-090
      FACT=FTEST/F(LIN)                                                 FCOU-091
      FACTP=FPTEST/FP(LIN)                                              FCOU-092
      INDICE=IEXP(1)/15                                                 FCOU-093
      XM=DFLOAT(LINF)                                                   FCOU-094
C NORMALISATION OF THE RESULTS OF THE DESCENDING RECURSION AND          FCOU-095
C UPWARDS RECURSION FOR THE IRREGULAR FUNCTION.                         FCOU-096
      DO 13 J=LIN,L1                                                    FCOU-097
      F(J)=F(J)*FACT                                                    FCOU-098
      FP(J)=FP(J)*FACTP                                                 FCOU-099
      IF (J.EQ.1) GO TO 13                                              FCOU-100
      ZIG=(DSQRT(ETAC+XM*XM))/XM                                        FCOU-101
      ZAG=ETA/XM+XM/RO                                                  FCOU-102
      G(J)=(ZAG*G(J-1)-GP(J-1))/ZIG                                     FCOU-103
      GP(J)=ZIG*G(J-1)-ZAG*G(J)                                         FCOU-104
      IF (DABS(G(J)).LT.1.D15.AND.DABS(GP(J)).LT.1.D15) GO TO 12        FCOU-105
      G(J)=G(J)/1.D15                                                   FCOU-106
      GP(J)=GP(J)/1.D15                                                 FCOU-107
      INDICE=INDICE+1                                                   FCOU-108
   12 IEXP(J)=INDICE*15                                                 FCOU-109
      A=DLOG10(DABS(FP(J)))+DLOG10(DABS(G(J)))                          FCOU-110
      B=0.D0                                                            FCOU-111
      IF (A.GE.0.D0) B=1.D0                                             FCOU-112
      I1=IDINT(B+A)                                                     FCOU-113
      I2=IDINT(B+DLOG10(DABS(GP(J)))+DLOG10(DABS(F(J))))                FCOU-114
      F(J)=F(J)*1.D1**(-I2)                                             FCOU-115
      FP(J)=FP(J)*1.D1**(-I1)                                           FCOU-116
   13 XM=XM+1.D0                                                        FCOU-117
      RETURN                                                            FCOU-118
 1000 FORMAT ('  FCOU   ***  ETA =',1P,D13.5,',  RHO =',D13.5,'   ARGUMEFCOU-119
     1NT OUT OFF RANGE.')                                               FCOU-120
      END                                                               FCOU-121
C 12/01/07                                                      ECIS06  FCZ0-000
      SUBROUTINE FCZ0(ETA,RO,F0,FP0,G0,GP0,IEXP,SIGMA)                  FCZ0-001
C COMPUTATION OF THE COULOMB FUNCTIONS FOR L=0.                         FCZ0-002
C INPUT:     ETA,RO:  COULOMB PARAMETER AND RADIUS.                     FCZ0-003
C OUTPUT:    F,FP:    REGULAR FUNCTION AND DERIVATIVE.                  FCZ0-004
C            G,GP:    IRREGULAR FUNCTION AND DERIVATIVE.                FCZ0-005
C            IEXP:    POWER OF 10.                                      FCZ0-006
C            SIGMA:   COULOMB PHASE SHIFT FOR L=0.                      FCZ0-007
C***********************************************************************FCZ0-008
      IMPLICIT REAL*8 (A-H,O-Z)                                         FCZ0-009
      DATA PI /3.1415926535897932D0/                                    FCZ0-010
      SIGMA=SIGM(ETA)                                                   FCZ0-011
      IEXP=0                                                            FCZ0-012
      IF (ETA.LE.28.D0.AND.ETA.GE.-8.D0) GO TO 1                        FCZ0-013
      CALL YFRI(ETA,RO,F0,FP0,G0,GP0,IEXP,SIGMA)                        FCZ0-014
      RETURN                                                            FCZ0-015
    1 IF (ETA.NE.0.D0) GO TO 2                                          FCZ0-016
C BESSEL FUNCTIONS.                                                     FCZ0-017
      F0=DSIN(RO)                                                       FCZ0-018
      G0=DCOS(RO)                                                       FCZ0-019
      FP0=G0                                                            FCZ0-020
      GP0=-F0                                                           FCZ0-021
      RETURN                                                            FCZ0-022
    2 BORNE=1.666666666666667D0*DABS(ETA)+7.5D0                         FCZ0-023
      IF (RO.LT.BORNE) GO TO 3                                          FCZ0-024
      CALL YFAS(ETA,RO,F0,FP0,G0,GP0,SIGMA)                             FCZ0-025
      RETURN                                                            FCZ0-026
    3 IF (ETA.GE.10.D0) GO TO 4                                         FCZ0-027
      IF (ETA.LE.0.D0) GO TO 5                                          FCZ0-028
      IF (RO-2.D0) 15 , 5 , 5                                           FCZ0-029
    4 IF (ETA.GT.(5.D0*RO+6.D1)/7.D0) GO TO 15                          FCZ0-030
C RS=-1 FOR NORMALISATION AT THE ORIGIN,RS=1 AT RO=BORNE(THE BOUNDARY). FCZ0-031
    5 IF (ETA.LT.2.5D0) GO TO 6                                         FCZ0-032
      RS=1.D0                                                           FCZ0-033
      CALL YFAS(ETA,BORNE,F0,FP0,G0,GP0,SIGMA)                          FCZ0-034
      GO TO 8                                                           FCZ0-035
    6 RS=-1.D0                                                          FCZ0-036
C          CLENSHAW ORIGIN.                                             FCZ0-037
      IF (ETA) 7 , 8 , 8                                                FCZ0-038
    7 N=IDINT(-0.5D0*ETA+5.D0)                                          FCZ0-039
      GO TO 9                                                           FCZ0-040
    8 N=IDINT(ETA/5.D0+5.D0)                                            FCZ0-041
    9 N=10*(N/2+1)                                                      FCZ0-042
      TM1=1.D0                                                          FCZ0-043
      T=2.D0*RO/BORNE-1.D0                                              FCZ0-044
      X=T+T                                                             FCZ0-045
      DO 10 I=1,N                                                       FCZ0-046
      TP1=X*T-TM1                                                       FCZ0-047
      TM1=T                                                             FCZ0-048
   10 T=TP1                                                             FCZ0-049
      T=TM1                                                             FCZ0-050
      A1=1.D-30                                                         FCZ0-051
      A2=0.D0                                                           FCZ0-052
      B1=0.D0                                                           FCZ0-053
      B2=A1                                                             FCZ0-054
      S=1.D0                                                            FCZ0-055
      SA=0.D0                                                           FCZ0-056
      SB=0.D0                                                           FCZ0-057
      Z1=0.D0                                                           FCZ0-058
      Z1P=0.D0                                                          FCZ0-059
      AP12=0.D0                                                         FCZ0-060
      AP11=0.D0                                                         FCZ0-061
      BP11=0.D0                                                         FCZ0-062
      Z2=0.D0                                                           FCZ0-063
      Z2P=0.D0                                                          FCZ0-064
      AP22=0.D0                                                         FCZ0-065
      AP21=0.D0                                                         FCZ0-066
      BP21=0.D0                                                         FCZ0-067
      A0=8.D0*ETA/BORNE-1.D0                                            FCZ0-068
      BD=4.D0/(BORNE*BORNE)                                             FCZ0-069
      B0=BD*DFLOAT(N+2)                                                 FCZ0-070
      B4=BD*DFLOAT(N-1)                                                 FCZ0-071
      R4=4.D0*DFLOAT(N)                                                 FCZ0-072
C          DOWNWARDS RECURSION.                                         FCZ0-073
   11 AM11=A0*(A1-AP11)+AP12-B0*B1-B4*BP11                              FCZ0-074
      AM21=A0*(A2-AP21)+AP22-B0*B2-B4*BP21                              FCZ0-075
      SA=SA+S*A1                                                        FCZ0-076
      SB=SB+S*A2                                                        FCZ0-077
      Z1=Z1+A1*T                                                        FCZ0-078
      Z1P=Z1P+B1*T                                                      FCZ0-079
      Z2=Z2+A2*T                                                        FCZ0-080
      Z2P=Z2P+B2*T                                                      FCZ0-081
      IF (R4.EQ.0.D0) GO TO 12                                          FCZ0-082
      BM11=R4*A1+BP11                                                   FCZ0-083
      AP12=AP11                                                         FCZ0-084
      AP11=A1                                                           FCZ0-085
      A1=AM11                                                           FCZ0-086
      BP11=B1                                                           FCZ0-087
      B1=BM11                                                           FCZ0-088
      BM21=R4*A2+BP21                                                   FCZ0-089
      AP22=AP21                                                         FCZ0-090
      AP21=A2                                                           FCZ0-091
      A2=AM21                                                           FCZ0-092
      BP21=B2                                                           FCZ0-093
      B2=BM21                                                           FCZ0-094
      B4=B4-BD                                                          FCZ0-095
      B0=B0-BD                                                          FCZ0-096
      R4=R4-4.D0                                                        FCZ0-097
      S=S*RS                                                            FCZ0-098
      TM1=X*T-TP1                                                       FCZ0-099
      TP1=T                                                             FCZ0-100
      T=TM1                                                             FCZ0-101
      GO TO 11                                                          FCZ0-102
   12 A=AP21-AM21                                                       FCZ0-103
      B=AM11-AP11                                                       FCZ0-104
      SA=A*SA+B*SB                                                      FCZ0-105
      A1=A*A1+B*A2                                                      FCZ0-106
      B1=A*B1+B*B2                                                      FCZ0-107
      Z1=A*Z1+B*Z2                                                      FCZ0-108
      Z1P=A*Z1P+B*Z2P                                                   FCZ0-109
      SA=(SA-0.5D0*A1)/T                                                FCZ0-110
      Z1=Z1-0.5D0*A1                                                    FCZ0-111
      Z1P=Z1P-0.5D0*B1                                                  FCZ0-112
      IF (RS.LT.0.D0) GO TO 13                                          FCZ0-113
      S=F0/(BORNE*SA)                                                   FCZ0-114
      GO TO 14                                                          FCZ0-115
   13 PIETA=PI*ETA                                                      FCZ0-116
      S=DEXP(PIETA)                                                     FCZ0-117
      S=DEXP(-PIETA/2.D0)*DSQRT(2.D0*PIETA/(S-1.D0/S))/SA               FCZ0-118
   14 F0=S*RO*Z1                                                        FCZ0-119
      FP0=S*(Z1+RO*Z1P/BORNE)                                           FCZ0-120
      GO TO 18                                                          FCZ0-121
C   SERIES REGULAR AT THE ORIGIN.                                       FCZ0-122
   15 PI=3.141592653589793D0                                            FCZ0-123
      RO2=RO*RO                                                         FCZ0-124
      ETAP=ETA+ETA                                                      FCZ0-125
      PIETA=PI*ETA                                                      FCZ0-126
      B=DEXP(PIETA)                                                     FCZ0-127
      B=DEXP(0.5D0*PIETA)*DSQRT((B-1.D0/B)/(2.D0*PIETA))                FCZ0-128
      U0=0.D0                                                           FCZ0-129
      U1=RO                                                             FCZ0-130
      U=U0+U1                                                           FCZ0-131
      UP=1.D0                                                           FCZ0-132
      XN=2.D0                                                           FCZ0-133
      DO 16 N=2,10000                                                   FCZ0-134
      XN1=XN*(XN-1.D0)                                                  FCZ0-135
      U2=(ETAP*RO*U1-RO2*U0)/XN1                                        FCZ0-136
      U=U+U2                                                            FCZ0-137
      UP=UP+XN*U2/RO                                                    FCZ0-138
      IF (DABS(U1)+DABS(U2).LT.1.D-10*DABS(U)) GO TO 17                 FCZ0-139
      U0=U1                                                             FCZ0-140
      U1=U2                                                             FCZ0-141
   16 XN=XN+1.D0                                                        FCZ0-142
   17 F0=U/B                                                            FCZ0-143
      FP0=UP/B                                                          FCZ0-144
   18 CALL YFIR(ETA,RO,G0,GP0,SIGMA)                                    FCZ0-145
      RETURN                                                            FCZ0-146
      END                                                               FCZ0-147
C 13/11/05                                                      ECIS06  YFRI-000
      SUBROUTINE YFRI(ETA,RAU,FO,FPO,GO,GPO,IDIV,SIGMA)                 YFRI-001
C COMPUTATION OF THE COULOMB FUNCTIONS FOR L=0.                         YFRI-002
C RICCATI METHOD.  SAME ARGUMENTS AS FCZ0.                              YFRI-003
C INPUT:     ETA,RAU: COULOMB PARAMETER AND RADIUS.                     YFRI-004
C            SIGMA:   COULOMB PHASE SHIFT FOR L=0.                      YFRI-005
C OUTPUT:    FO,FPO:  REGULAR FUNCTION AND DERIVATIVE.                  YFRI-006
C            GO,GPO:  IRREGULAR FUNCTION AND DERIVATIVE.                YFRI-007
C            IDIV:    POWER OF 10.                                      YFRI-008
C***********************************************************************YFRI-009
      IMPLICIT REAL*8 (A-H,O-Z)                                         YFRI-010
      DIMENSION Q(5),QP(5)                                              YFRI-011
C        RICCATI COEFFICIENTS.                                          YFRI-012
      DATA G61,G62,G63,G64,G65,G66,G67,G68,G69,G610,G611/ 1.159057617187YFRI-013
     15D-2,3.863525390625D-2,4.6600341796875D-2,4.8583984375D-2,1.156514YFRI-014
     248567708D0,5.6874755859375D0,1.323888288225445D1,1.713083224826384YFRI-015
     3D1,1.269003295898436D1,5.05523681640625D0,8.42539464010415D-1/    YFRI-016
      DATA G81,G82,G83,G84,G85,G86,G87,G88,G89,G810,G811,G812,G813,G814,YFRI-017
     1G815/ 1.851092066083633D-2,8.63842964172363D-2,1.564757823944092D-YFRI-018
     21,1.430139541625977D-1,1.924622058868408D-1,8.500803152720129D0,7.YFRI-019
     3265429720878595D1,3.057942376817972D2,7.699689544836672D2,1.254157YFRI-020
     4054424285D3,1.361719536066055D3,9.831831171035763D2,4.547869927883YFRI-021
     5148D2,1.222640538215636D2,1.455524450256709D1/                    YFRI-022
      DATA GP61,GP62,GP63,GP64,GP65,GP66/ 0.289764404296875D-1,0.2318115YFRI-023
     1234375D0,0.8056640625D0,1.6015625D0,0.3046875D0,5.625D0/          YFRI-024
      DATA GP81,GP82,GP83,GP84,GP85,GP86,GP87,GP88/ 0.647882223129272D-1YFRI-025
     1,0.6910743713378906D0,0.3322952270507811D1,0.94830322265625D1,17.6YFRI-026
     296533203125D0,34.787109375D0,50.203125D0,78.75D0/                 YFRI-027
      DATA Q/ 0.4959570165D-1,0.8888888889D-2,0.2455199181D-2,0.91089580YFRI-028
     161D-3,0.2534684115D-3/                                            YFRI-029
      DATA QP,HO,HPO/ 0.1728260369D0,0.3174603174D-3,0.3581214850D-2,0.3YFRI-030
     1117824680D-3,0.9073966427D-3,2*0.D0/                              YFRI-031
      ETAC=ETA*ETA                                                      YFRI-032
      ETA2=ETA+ETA                                                      YFRI-033
      ETARO=ETA*RAU                                                     YFRI-034
      IND=0                                                             YFRI-035
      JND=0                                                             YFRI-036
      IG=0                                                              YFRI-037
      IDIV=0                                                            YFRI-038
      IF (ETA.GT.0.D0) GO TO 1                                          YFRI-039
      IF (-ETARO-14.0625D0) 3 , 15 , 15                                 YFRI-040
    1 IF (DABS(RAU-ETA2).LE.1.D-9) GO TO 14                             YFRI-041
      IF (RAU-ETA2) 6 , 14 , 2                                          YFRI-042
    2 IF (RAU-ETA2-2.D1*(ETA**0.25D0)) 4 , 15 , 15                      YFRI-043
    3 NN=1                                                              YFRI-044
      GO TO 5                                                           YFRI-045
    4 NN=0                                                              YFRI-046
    5 CALL YFCL(ETA,RAU,FO,FPO,GO,GPO,SIGMA,IDIV,NN)                    YFRI-047
      RETURN                                                            YFRI-048
    6 IF (ETARO.LE.12.D0) GO TO 3                                       YFRI-049
      TRA=ETA2-6.75D0*(ETA**0.4D0)                                      YFRI-050
      IF (RAU.LE.TRA) GO TO 7                                           YFRI-051
      IND=1                                                             YFRI-052
      JND=1                                                             YFRI-053
      RO=RAU                                                            YFRI-054
      RAU=TRA                                                           YFRI-055
      RAU0=TRA                                                          YFRI-056
C             RICCATI   1.                                              YFRI-057
    7 X=RAU/ETA2                                                        YFRI-058
      U=(1.D0-X)/X                                                      YFRI-059
      X2=X*X                                                            YFRI-060
      RU=DSQRT(U)                                                       YFRI-061
      RX=DSQRT(X)                                                       YFRI-062
      TRE=1.D0/(U*RU*ETA2)                                              YFRI-063
      TRB=TRE*TRE                                                       YFRI-064
      FI=(DSQRT((1.D0-X)*X)+DATAN2(RX,DSQRT(1.D0-RX*RX))-1.5707963267948YFRI-065
     197D0)*ETA2                                                        YFRI-066
      TR1=-0.25D0*DLOG(U)                                               YFRI-067
      TR2=-((9.D0*U+6.D0)*U+5.D0)/48.D0                                 YFRI-068
      TR3=((((-3.D0*U-4.D0)*U+6.D0)*U+12.D0)*U+5.D0)/64.D0              YFRI-069
      TR4=-((((((U+2.D0)*945.D0*U+1395.D0)*U+12300.D0)*U+25191.D0)*U+198YFRI-070
     190.D0)*U+5525.D0)/46080.D0                                        YFRI-071
      TR5=((((((((-27.D0*U-72.D0)*U-68.D0)*U+360.D0)*U+2190.D0)*U+4808.DYFRI-072
     10)*U+5148.D0)*U+2712.D0)*U+565.D0)/2048.D0                        YFRI-073
      TR6=-((((((((((G61*U+G62)*U+G63)*U+G64)*U+G65)*U+G66)*U+G67)*U+G68YFRI-074
     1)*U+G69)*U+G610)*U+G611)                                          YFRI-075
      TR7=((((((((((((-81.D0*U-324.D0)*U-486.D0)*U-404.D0)*U+4509.D0)*U+YFRI-076
     152344.D0)*U+233436.D0)*U+567864.D0)*U+838521.D0)*U+775884.D0)*U+44YFRI-077
     21450.D0)*U+141660.D0)*U+19675.D0)/6144.D0                         YFRI-078
      TR8=(((((((((((((G81*U+G82)*U+G83)*U+G84)*U+G85)*U+G86)*U+G87)*U+GYFRI-079
     188)*U+G89)*U+G810)*U+G811)*U+G812)*U+G813)*U+G814)*U+G815         YFRI-080
      FI=FI+TRE*(TR2+TRB*(TR4+TRB*(TR6+TRB*TR8)))                       YFRI-081
      PSI=-FI                                                           YFRI-082
      TRA=TR1+TRB*(TR3+TRB*(TR5+TRB*TR7))                               YFRI-083
      FI=FI+TRA                                                         YFRI-084
      PSI=PSI+TRA                                                       YFRI-085
      FIP=RU*ETA2                                                       YFRI-086
      TRA=1.D0/(X2*U)                                                   YFRI-087
      TR1=0.25D0                                                        YFRI-088
      TRE=TRE/(X2*X2*U)                                                 YFRI-089
      TRB=TRB/(X2*X2)                                                   YFRI-090
      TR2=-(8.D0*X-3.D0)/32.D0                                          YFRI-091
      TR3=((24.D0*X-12.D0)*X+3.D0)/64.D0                                YFRI-092
      TR4=(((-1536.D0*X+704.D0)*X-336.D0)*X+63.D0)/2048.D0              YFRI-093
      TR5=((((1920.D0*X-576.D0)*X+504.D0)*X-180.D0)*X+27.D0)/1024.D0    YFRI-094
      TR6=((((-GP66*X+GP65)*X-GP64)*X+GP63)*X-GP62)*X+GP61              YFRI-095
      TR7=-((((((-40320.D0*X-10560.D0)*X-13248.D0)*X+7560.D0)*X-3132.D0)YFRI-096
     1*X+756.D0)*X-81.D0)/2048.D0                                       YFRI-097
      TR8=-(((((((GP88*X+GP87)*X+GP86)*X-GP85)*X+GP84)*X-GP83)*X+GP82)*XYFRI-098
     1-GP81)                                                            YFRI-099
      FIP=FIP+TRE*(TR2+TRB*(TR4+TRB*(TR6+TRB*TR8)))                     YFRI-100
      PSIP=-FIP                                                         YFRI-101
      TRA=TRA*(TR1+TRB*(TR3+TRB*(TR5+TRB*TR7)))                         YFRI-102
      FIP=FIP+TRA                                                       YFRI-103
      PSIP=PSIP+TRA                                                     YFRI-104
      XXX=34.588776394910686D0                                          YFRI-105
      INDG=IDINT(PSI/XXX)                                               YFRI-106
      IDIV=15*INDG                                                      YFRI-107
      IF (INDG.EQ.0) GO TO 8                                            YFRI-108
      PSI=PSI-XXX*INDG                                                  YFRI-109
      FI=FI+XXX*INDG                                                    YFRI-110
    8 FO=0.5D0*DEXP(FI)                                                 YFRI-111
      GO=DEXP(PSI)                                                      YFRI-112
      FPO=FO*FIP/ETA2                                                   YFRI-113
      GPO=GO*PSIP/ETA2                                                  YFRI-114
      IF (JND.EQ.0) RETURN                                              YFRI-115
      RAU=RO                                                            YFRI-116
      GO=FO                                                             YFRI-117
      GPO=FPO                                                           YFRI-118
    9 X=RAU0-RO                                                         YFRI-119
      X2=X*X                                                            YFRI-120
      X3=X*X2                                                           YFRI-121
      UNR=1.D0/RAU0                                                     YFRI-122
      ETR0=1.D0-2.D0*ETA*UNR                                            YFRI-123
      U0=GO                                                             YFRI-124
      U1=-X*GPO                                                         YFRI-125
      U2=-0.5D0*ETR0*X2*U0                                              YFRI-126
      S=U0+U1+U2                                                        YFRI-127
      V1=U1/X                                                           YFRI-128
      V2=2.D0*U2/X                                                      YFRI-129
      T=V1+V2                                                           YFRI-130
      XN=3.D0                                                           YFRI-131
      DO 11 N=3,10000                                                   YFRI-132
      XN1=XN-1.D0                                                       YFRI-133
      XN1=XN*XN1                                                        YFRI-134
      U3=X*U2*UNR*(1.D0-2.D0/XN)-ETR0*U1*X2/XN1+X3*U0*UNR/XN1           YFRI-135
      S=S+U3                                                            YFRI-136
      V3=XN*U3/X                                                        YFRI-137
      T=T+V3                                                            YFRI-138
      IF (DABS(U3).GT.1.D-10*DABS(S)) GO TO 10                          YFRI-139
      IF (DABS(V3).LE.1.D-10*DABS(T)) GO TO 12                          YFRI-140
   10 U0=U1                                                             YFRI-141
      U1=U2                                                             YFRI-142
      U2=U3                                                             YFRI-143
   11 XN=XN+1.D0                                                        YFRI-144
   12 IF (IG.EQ.0) GO TO 13                                             YFRI-145
      GO=S                                                              YFRI-146
      GPO=-T                                                            YFRI-147
      FO=HO                                                             YFRI-148
      FPO=HPO                                                           YFRI-149
      RETURN                                                            YFRI-150
   13 HO=S                                                              YFRI-151
      HPO=-T                                                            YFRI-152
   14 ET0=ETA**(0.1666666666666667D0)                                   YFRI-153
      ETAD=ETAC*ETAC                                                    YFRI-154
      ET=ETA**(0.6666666666666667D0)                                    YFRI-155
      ET1=ET*ET                                                         YFRI-156
      ET2=ET1*ET1                                                       YFRI-157
      ET3=ET2*ET                                                        YFRI-158
      ET4=ETAD*ET                                                       YFRI-159
      ET5=ET4*ET                                                        YFRI-160
      FO=1.D0-Q(1)/ET1-Q(2)/ETAC-Q(3)/ET3-Q(4)/ETAD-Q(5)/ET5            YFRI-161
      GO=1.D0+Q(1)/ET1-Q(2)/ETAC+Q(3)/ET3-Q(4)/ETAD+Q(5)/ET5            YFRI-162
      FPO=1.D0+QP(1)/ET+QP(2)/ETAC+QP(3)/ET2+QP(4)/ETAD+QP(5)/ET4       YFRI-163
      GPO=1.D0-QP(1)/ET+QP(2)/ETAC-QP(3)/ET2+QP(4)/ETAD-QP(5)/ET4       YFRI-164
      FO=0.7063326373D0*ET0*FO                                          YFRI-165
      GO=1.223404016D0*ET0*GO                                           YFRI-166
      FPO=0.4086957323D0*FPO/ET0                                        YFRI-167
      GPO=-0.7078817734D0*GPO/ET0                                       YFRI-168
      IDIV=0                                                            YFRI-169
      IF (IND.EQ.0) RETURN                                              YFRI-170
      IG=1                                                              YFRI-171
      RAU0=ETA2                                                         YFRI-172
      GO TO 9                                                           YFRI-173
C        RICCATI 2 AND 3.                                               YFRI-174
   15 X=ETA2/RAU                                                        YFRI-175
      X2=X*X                                                            YFRI-176
      U=1.D0-X                                                          YFRI-177
      RU=DSQRT(U)                                                       YFRI-178
      U3=U*U*U                                                          YFRI-179
      TRD=1.D0/(U3*ETA2*ETA2)                                           YFRI-180
      TRC=X2*TRD                                                        YFRI-181
      TRE=1.D0/(U*RU*ETA2)                                              YFRI-182
      FI=-0.25D0*DLOG(U)                                                YFRI-183
      TRB=TRD/64.D0                                                     YFRI-184
      TR3=(((3.D0*U-4.D0)*U-6.D0)*U+12.D0)*U-5.D0                       YFRI-185
      TR5=((((((((-27.D0*U+72.D0)*U-68.D0)*U-360.D0)*U+2190.D0)*U-4808.DYFRI-186
     10)*U+5148.D0)*U-2712.D0)*U+565.D0)/32.D0                          YFRI-187
      TR7=((((((((((((81.D0*U-324.D0)*U+486.D0)*U-404.D0)*U-4509.D0)*U+5YFRI-188
     12344.D0)*U-233436.D0)*U+567864.D0)*U-838521.D0)*U+775884.D0)*U-441YFRI-189
     2450.D0)*U+141660.D0)*U-19675.D0)/96.D0                            YFRI-190
      FI=FI+TRB*(TR3+TRD*(TR5+TRD*TR7))                                 YFRI-191
      FIP=0.25D0/U                                                      YFRI-192
      TRB=3.D0*TRC/(64.D0*U)                                            YFRI-193
      TR3=(4.D0-X)*X-8.D0                                               YFRI-194
      TR5=((((9.D0*X-60.D0)*X+168.D0)*X-192.D0)*X+640.D0)/16.D0         YFRI-195
      TR7=((((((-27.D0*X+252.D0)*X-1044.D0)*X+2520.D0)*X-4416.D0)*X-3520YFRI-196
     1.D0)*X-13440.D0)/32.D0                                            YFRI-197
      FIP=FIP+TRB*(TR3+TRC*(TR5+TRC*TR7))                               YFRI-198
      TRA=DABS((RU-1.D0)/(RU+1.D0))                                     YFRI-199
      PSI=(0.5D0*DLOG(TRA)+RU/X)*ETA2+0.785398163397448D0               YFRI-200
      TR2=-((9.D0*U-6.D0)*U+5.D0)/48.D0                                 YFRI-201
      TR4=((((((U-2.D0)*945.D0*U+1395.D0)*U-12300.D0)*U+25191.D0)*U-1989YFRI-202
     10.D0)*U+5525.D0)/46080.D0                                         YFRI-203
      TR6=(((((((((-G61*U+G62)*U-G63)*U+G64)*U-G65)*U+G66)*U-G67)*U+G68)YFRI-204
     1*U-G69)*U+G610)*U-G611                                            YFRI-205
      TR8=(((((((((((((G81*U-G82)*U+G83)*U-G84)*U+G85)*U-G86)*U+G87)*U-GYFRI-206
     188)*U+G89)*U-G810)*U+G811)*U-G812)*U+G813)*U-G814)*U+G815         YFRI-207
      PSI=PSI+TRE*(TR2+TRD*(TR4+TRD*(TR6+TRD*TR8)))                     YFRI-208
      PSIP=-RU*ETA2/X2                                                  YFRI-209
      TRB=TRE*X/U                                                       YFRI-210
      TR2=(3.D0*X-8.D0)/32.D0                                           YFRI-211
      TR4=-(((63.D0*X-336.D0)*X+704.D0)*X-1536.D0)/2048.D0              YFRI-212
      TR6=((((GP61*X-GP62)*X+GP63)*X-GP64)*X+GP65)*X-GP66               YFRI-213
      TR8=((((((-GP81*X+GP82)*X-GP83)*X+GP84)*X-GP85)*X+GP86)*X+GP87)*X+YFRI-214
     1GP88                                                              YFRI-215
      PSIP=PSIP+TRB*(TR2+TRC*(TR4+TRC*(TR6+TRC*TR8)))                   YFRI-216
      TRA=DEXP(FI)                                                      YFRI-217
      FO=TRA*DSIN(PSI)                                                  YFRI-218
      GO=TRA*DCOS(PSI)                                                  YFRI-219
      IF (ETA.GT.0.D0) GO TO 16                                         YFRI-220
      TRA=FO                                                            YFRI-221
      FO=-GO                                                            YFRI-222
      GO=TRA                                                            YFRI-223
   16 TRA=-ETA2/(RAU*RAU)                                               YFRI-224
      FPO=(FIP*FO+PSIP*GO)*TRA                                          YFRI-225
      GPO=(FIP*GO-PSIP*FO)*TRA                                          YFRI-226
      RETURN                                                            YFRI-227
      END                                                               YFRI-228
C 12/01/07                                                      ECIS06  YFCL-000
      SUBROUTINE YFCL(ETA,RO,U,UP,V,VP,SIGMA,IDIV,NN)                   YFCL-001
C COMPUTATION OF THE COULOMB FUNCTIONS FOR L=0.                         YFCL-002
C CLENSHAW METHOD.  SAME ARGUMENTS AS FCZ0, PLUS NN.                    YFCL-003
C INPUT:     ETA,RO:  COULOMB PARAMETER AND RADIUS.                     YFCL-004
C            SIGMA:   COULOMB PHASE SHIFT FOR L=0.                      YFCL-005
C            NN:      0 FOR ASYMPTOTIC, 1 FOR SERIES AT THE ORIGIN.     YFCL-006
C OUTPUT:    U,UP:    REGULAR FUNCTION AND DERIVATIVE.                  YFCL-007
C            V,VP:    IRREGULAR FUNCTION AND DERIVATIVE.                YFCL-008
C            IDIV:    POWER OF 10.                                      YFCL-009
C***********************************************************************YFCL-010
      IMPLICIT REAL*8 (A-H,O-Z)                                         YFCL-011
      DATA PI /3.1415926535897932D0/                                    YFCL-012
      IDIV=0                                                            YFCL-013
      ETAP=ETA+ETA                                                      YFCL-014
      RO2=RO*RO                                                         YFCL-015
      IF (NN.EQ.1) GO TO 4                                              YFCL-016
C          CLENSHAW ASYMPTOTIC.                                         YFCL-017
      E2=ETA*ETA                                                        YFCL-018
      M=IDINT(40.D0+ETA/4.D0)                                           YFCL-019
      M=2*(M/2)                                                         YFCL-020
      I=1                                                               YFCL-021
      R=DFLOAT(M)                                                       YFCL-022
      D4=4.D0*R                                                         YFCL-023
      TM1=1.D0                                                          YFCL-024
      T=4.D0*ETA/RO-1.D0                                                YFCL-025
      Z=T+T                                                             YFCL-026
      DO 1 J=1,M                                                        YFCL-027
      TP1=Z*T-TM1                                                       YFCL-028
      TM1=T                                                             YFCL-029
    1 T=TP1                                                             YFCL-030
      T=TM1                                                             YFCL-031
      GR=0.D0                                                           YFCL-032
      GPR=0.D0                                                          YFCL-033
      SCR=0.D0                                                          YFCL-034
      EP1R=0.D0                                                         YFCL-035
      ER=0.D0                                                           YFCL-036
      DP1R=0.D0                                                         YFCL-037
      DR=1.D-25                                                         YFCL-038
      C1R=R+1.D0                                                        YFCL-039
      C0R=E2-R*(R+1.D0)                                                 YFCL-040
      GI=0.D0                                                           YFCL-041
      GPI=0.D0                                                          YFCL-042
      SCI=0.D0                                                          YFCL-043
      EP1I=0.D0                                                         YFCL-044
      EI=0.D0                                                           YFCL-045
      DP1I=0.D0                                                         YFCL-046
      DI=0.D0                                                           YFCL-047
      C1I=-3.D0*ETA                                                     YFCL-048
      C0I=-(R+R+1.D0)*ETA                                               YFCL-049
C          BACKWARDS RECURRENCE.                                        YFCL-050
    2 SCZ=C0R*C0R+C0I*C0I                                               YFCL-051
      C2R=C1R*DR-C1I*DI+0.5D0*(DP1R+ER+EP1R)-ETA*DP1I                   YFCL-052
      C2I=C1R*DI+C1I*DR+0.5D0*(DP1I+EI+EP1I)+ETA*DP1R                   YFCL-053
      CR=(C2R*C0R+C2I*C0I)/SCZ                                          YFCL-054
      CI=(C0R*C2I-C0I*C2R)/SCZ                                          YFCL-055
      GR=GR+CR*T                                                        YFCL-056
      GPR=GPR+DR*T                                                      YFCL-057
      SCR=SCR+I*CR                                                      YFCL-058
      GI=GI+CI*T                                                        YFCL-059
      GPI=GPI+DI*T                                                      YFCL-060
      SCI=SCI+I*CI                                                      YFCL-061
      IF (R.EQ.0.D0) GO TO 3                                            YFCL-062
      EM1R=D4*DR+EP1R                                                   YFCL-063
      DM1R=D4*CR+DP1R                                                   YFCL-064
      EP1R=ER                                                           YFCL-065
      ER=EM1R                                                           YFCL-066
      DP1R=DR                                                           YFCL-067
      DR=DM1R                                                           YFCL-068
      EM1I=D4*DI+EP1I                                                   YFCL-069
      DM1I=D4*CI+DP1I                                                   YFCL-070
      EP1I=EI                                                           YFCL-071
      EI=EM1I                                                           YFCL-072
      DP1I=DI                                                           YFCL-073
      DI=DM1I                                                           YFCL-074
      TM1=Z*T-TP1                                                       YFCL-075
      TP1=T                                                             YFCL-076
      T=TM1                                                             YFCL-077
      C0R=C0R+R+R                                                       YFCL-078
      C0I=C0I+ETAP                                                      YFCL-079
      C1R=C1R-1.D0                                                      YFCL-080
      I=-I                                                              YFCL-081
      D4=D4-4.D0                                                        YFCL-082
      R=R-1.D0                                                          YFCL-083
      GO TO 2                                                           YFCL-084
    3 SCR=SCR-0.5D0*CR                                                  YFCL-085
      GR=GR-0.5D0*CR                                                    YFCL-086
      GPR=GPR-0.5D0*DR                                                  YFCL-087
      SCI=SCI-0.5D0*CI                                                  YFCL-088
      GI=GI-0.5D0*CI                                                    YFCL-089
      GPI=GPI-0.5D0*DI                                                  YFCL-090
      Z=SIGMA+RO-ETA*DLOG(RO+RO)                                        YFCL-091
      SCZ=SCR*SCR+SCI*SCI                                               YFCL-092
      CR=DCOS(Z)                                                        YFCL-093
      CI=DSIN(Z)                                                        YFCL-094
      DR=(CR*SCR+CI*SCI)/SCZ                                            YFCL-095
      DI=(CI*SCR-CR*SCI)/SCZ                                            YFCL-096
      SCI=1.D0-ETA/RO                                                   YFCL-097
      SCR=ETAP/RO2                                                      YFCL-098
      CR=-GI*SCI-GPR*SCR                                                YFCL-099
      CI=GR*SCI-GPI*SCR                                                 YFCL-100
      VP=DR*CR-DI*CI                                                    YFCL-101
      UP=DR*CI+DI*CR                                                    YFCL-102
      V=DR*GR-DI*GI                                                     YFCL-103
      U=DR*GI+DI*GR                                                     YFCL-104
      RETURN                                                            YFCL-105
C          SERIES AT THE ORIGIN.                                        YFCL-106
    4 PIETA=PI*ETA                                                      YFCL-107
      IF (DABS(PIETA).GT.36.D0) GO TO 5                                 YFCL-108
      P=DSQRT((DEXP(2.D0*PIETA)-1.D0)/(2.D0*PIETA))                     YFCL-109
      GO TO 7                                                           YFCL-110
    5 IF (PIETA.GT.0.D0) GO TO 6                                        YFCL-111
      P=1.D0/DSQRT(-PIETA-PIETA)                                        YFCL-112
      GO TO 7                                                           YFCL-113
    6 Z=34.588776394910686D0                                            YFCL-114
      IDIV=IDINT(PIETA/Z)                                               YFCL-115
      P=DEXP(PIETA-IDIV*Z)/DSQRT(PIETA+PIETA)                           YFCL-116
      IDIV=15*IDIV                                                      YFCL-117
    7 Z1=ETAP*(PSI(ETA)+.6931471805599453D0)                            YFCL-118
      U0=0.D0                                                           YFCL-119
      U1=RO                                                             YFCL-120
      V0=1.D0                                                           YFCL-121
      V1=Z1*RO                                                          YFCL-122
      U=U0+U1                                                           YFCL-123
      V=V0+V1                                                           YFCL-124
      UP=1.D0                                                           YFCL-125
      VP=Z1                                                             YFCL-126
      XN=2.D0                                                           YFCL-127
      DO 9 N=2,10000                                                    YFCL-128
      XN1=XN*(XN-1.D0)                                                  YFCL-129
      U2=(ETAP*RO*U1-RO2*U0)/XN1                                        YFCL-130
      U=U+U2                                                            YFCL-131
      V2=(ETAP*RO*V1-RO2*V0-ETAP*(XN+XN-1.D0)*U2)/XN1                   YFCL-132
      V=V+V2                                                            YFCL-133
      UP=UP+XN*U2/RO                                                    YFCL-134
      VP=VP+XN*V2/RO                                                    YFCL-135
      IF (DABS(U2).GT.1.D-14*DABS(U)) GO TO 8                           YFCL-136
      IF (DABS(V2).LE.1.D-14*DABS(V)) GO TO 10                          YFCL-137
    8 U0=U1                                                             YFCL-138
      U1=U2                                                             YFCL-139
      V0=V1                                                             YFCL-140
      V1=V2                                                             YFCL-141
    9 XN=XN+1.D0                                                        YFCL-142
   10 PP=V+ETAP*U*DLOG(RO)                                              YFCL-143
      W=U/P                                                             YFCL-144
      WP=UP/P                                                           YFCL-145
      V=P*PP                                                            YFCL-146
      VP=P*(VP+ETAP*(UP*DLOG(RO)+U/RO))                                 YFCL-147
      U=W                                                               YFCL-148
      UP=WP                                                             YFCL-149
      RETURN                                                            YFCL-150
      END                                                               YFCL-151
C 13/11/05                                                      ECIS06  YFAS-000
      SUBROUTINE YFAS(ETA,RAU,FO,FPO,GO,GPO,SIGO)                       YFAS-001
C COMPUTATION OF THE COULOMB FUNCTIONS FOR L=0.                         YFAS-002
C     ASYMPTOTIC EXPANSION. SAME ARGUMENTS AS FCZ0 EXCEPT FOR IEXP.     YFAS-003
C INPUT:     ETA,RAU: COULOMB PARAMETER AND RADIUS.                     YFAS-004
C            SIGO:    COULOMB PHASE SHIFT FOR L=0.                      YFAS-005
C OUTPUT:    FO,FPO:  REGULAR FUNCTION AND DERIVATIVE.                  YFAS-006
C            GO,GPO:  IRREGULAR FUNCTION AND DERIVATIVE.                YFAS-007
C***********************************************************************YFAS-008
      IMPLICIT REAL*8 (A-H,O-Z)                                         YFAS-009
      TRB=0.D0                                                          YFAS-010
      RAU2=RAU+RAU                                                      YFAS-011
      ETAC=ETA*ETA                                                      YFAS-012
      N=0                                                               YFAS-013
      PS=1.D0                                                           YFAS-014
      GS=0.D0                                                           YFAS-015
      PT=0.D0                                                           YFAS-016
      GT=1.D0-ETA/RAU                                                   YFAS-017
      SF=PS                                                             YFAS-018
      SG=GS                                                             YFAS-019
      SPF=PT                                                            YFAS-020
      SPG=GT                                                            YFAS-021
    1 DENOM=DFLOAT(N+1)*RAU2                                            YFAS-022
      AN=DFLOAT(N+N+1)*ETA/DENOM                                        YFAS-023
      BN=(ETAC-DFLOAT(N*(N+1)))/DENOM                                   YFAS-024
      PS1=AN*PS-BN*PT                                                   YFAS-025
      GS1=AN*GS-BN*GT-PS1/RAU                                           YFAS-026
      PT1=AN*PT+BN*PS                                                   YFAS-027
      GT1=AN*GT+BN*GS-PT1/RAU                                           YFAS-028
      SF=SF+PS1                                                         YFAS-029
      SG=SG+GS1                                                         YFAS-030
      SPF=SPF+PT1                                                       YFAS-031
      SPG=SPG+GT1                                                       YFAS-032
      N=N+1                                                             YFAS-033
      IF (DABS(PS1).GT.TRB) TRB=DABS(PS1)                               YFAS-034
      IF (DABS(PS1).LT.1.D-10*TRB.OR.BN.LT.-1.D0) GO TO 2               YFAS-035
      PS=PS1                                                            YFAS-036
      GS=GS1                                                            YFAS-037
      PT=PT1                                                            YFAS-038
      GT=GT1                                                            YFAS-039
      GO TO 1                                                           YFAS-040
    2 TETAO=RAU-ETA*DLOG(RAU2)+SIGO                                     YFAS-041
      TRA=DSIN(TETAO)                                                   YFAS-042
      TRB=DCOS(TETAO)                                                   YFAS-043
      GO=SF*TRB-SPF*TRA                                                 YFAS-044
      GPO=SG*TRB-SPG*TRA                                                YFAS-045
      FO=SPF*TRB+SF*TRA                                                 YFAS-046
      FPO=SPG*TRB+SG*TRA                                                YFAS-047
      RETURN                                                            YFAS-048
      END                                                               YFAS-049
C 12/01/07                                                      ECIS06  YFIR-000
      SUBROUTINE YFIR(ETA,RO,G0,GP0,SIGMA)                              YFIR-001
C COMPUTATION OF THE COULOMB IRREGULAR FUNCTION FOR L=0.                YFIR-002
C INPUT:     ETA,RO:  COULOMB PARAMETER AND RADIUS.                     YFIR-003
C            SIGMA:   COULOMB PHASE SHIFT FOR L=0.                      YFIR-004
C OUTPUT:    GO,GPO:  REGULAR FUNCTION AND DERIVATIVE.                  YFIR-005
C***********************************************************************YFIR-006
      IMPLICIT REAL*8(A-H,O-Z)                                          YFIR-007
      DATA PI /3.1415926535897932D0/                                    YFIR-008
      IF (ETA.LE.0.D0) GO TO 9                                          YFIR-009
      IF ((RO.LE.(54.D0-ETA)/80.D0).OR.(ETA.LE.22.D0.AND.RO.LE.(30.D0-ETYFIR-010
     1A)/20.D0).OR.(ETA.LE.18.D0.AND.RO.LE.0.075D0*(26.D0-ETA)).OR.(ETA.YFIR-011
     2LE.10.D0.AND.RO.LE..15D0*(18.D0-ETA)).OR.(ETA.LE.3.D0.AND.RO.LE.2.YFIR-012
     325D0+7.35D0*(3.D0-ETA))) GO TO 5                                  YFIR-013
C   TAYLOR SERIES STARTING AT RAU0.                                     YFIR-014
    1 RAU0=1.666666666666667D0*DABS(ETA)+7.5D0                          YFIR-015
      CALL YFAS(ETA,RAU0,F0,FP0,G0,GP0,SIGMA)                           YFIR-016
      X=RAU0-RO                                                         YFIR-017
      X2=X*X                                                            YFIR-018
      X3=X*X2                                                           YFIR-019
      UNR=1.D0/RAU0                                                     YFIR-020
      ETR0=1.D0-2.D0*ETA*UNR                                            YFIR-021
      U0=G0                                                             YFIR-022
      U1=-X*GP0                                                         YFIR-023
      U2=-0.5D0*ETR0*X2*U0                                              YFIR-024
      S=U0+U1+U2                                                        YFIR-025
      V1=U1/X                                                           YFIR-026
      V2=2.D0*U2/X                                                      YFIR-027
      T=V1+V2                                                           YFIR-028
      XN=3.D0                                                           YFIR-029
      DO 3 N=3,10000                                                    YFIR-030
      XN1=XN-1.D0                                                       YFIR-031
      XN1=XN*XN1                                                        YFIR-032
      U3=X*U2*UNR*(1.D0-2.D0/XN)-ETR0*U1*X2/XN1+X3*U0*UNR/XN1           YFIR-033
      S=S+U3                                                            YFIR-034
      V3=XN*U3/X                                                        YFIR-035
      T=T+V3                                                            YFIR-036
      IF (DABS(U3).GT.1.D-11*DABS(S)) GO TO 2                           YFIR-037
      IF (DABS(V3).LE.1.D-11*DABS(T)) GO TO 4                           YFIR-038
    2 U0=U1                                                             YFIR-039
      U1=U2                                                             YFIR-040
      U2=U3                                                             YFIR-041
    3 XN=XN+1.D0                                                        YFIR-042
    4 G0=S                                                              YFIR-043
      GP0=-T                                                            YFIR-044
      RETURN                                                            YFIR-045
C   SERIES ORIGIN.                                                      YFIR-046
    5 RO2=RO*RO                                                         YFIR-047
      ETAP=ETA+ETA                                                      YFIR-048
      PIETA=PI*ETA                                                      YFIR-049
      PIETA2=0.5D0*PIETA                                                YFIR-050
      B=DEXP(PIETA)                                                     YFIR-051
      B=DEXP(PIETA2)*DSQRT((B-1.D0/B)/(2.D0*PIETA))                     YFIR-052
      C1=ETAP*(PSI(ETA)+.6931471805599453D0)                            YFIR-053
      U0=0.D0                                                           YFIR-054
      U1=RO                                                             YFIR-055
      V0=1.D0                                                           YFIR-056
      V1=C1*RO                                                          YFIR-057
      U=U0+U1                                                           YFIR-058
      V=V0+V1                                                           YFIR-059
      UP=1.D0                                                           YFIR-060
      VP=C1                                                             YFIR-061
      XN=2.D0                                                           YFIR-062
      DO 7 N=2,10000                                                    YFIR-063
      XN1=XN*(XN-1.D0)                                                  YFIR-064
      U2=(ETAP*RO*U1-RO2*U0)/XN1                                        YFIR-065
      U=U+U2                                                            YFIR-066
      V2=(ETAP*RO*V1-RO2*V0-ETAP*(XN+XN-1.D0)*U2)/XN1                   YFIR-067
      V=V+V2                                                            YFIR-068
      UP=UP+XN*U2/RO                                                    YFIR-069
      VP=VP+XN*V2/RO                                                    YFIR-070
      IF (DABS(U2).GT.1.D-14*DABS(U)) GO TO 6                           YFIR-071
      IF (DABS(V2).LE.1.D-14*DABS(V)) GO TO 8                           YFIR-072
    6 U0=U1                                                             YFIR-073
      U1=U2                                                             YFIR-074
      V0=V1                                                             YFIR-075
      V1=V2                                                             YFIR-076
    7 XN=XN+1.D0                                                        YFIR-077
    8 GP=V+ETAP*U*DLOG(RO)                                              YFIR-078
      G0=B*GP                                                           YFIR-079
      GP0=B*(VP+ETAP*(UP*DLOG(RO)+U/RO))                                YFIR-080
      RETURN                                                            YFIR-081
    9 IF (RO.LE.0.5D0*ETA+9.D0) GO TO 5                                 YFIR-082
      GO TO 1                                                           YFIR-083
      END                                                               YFIR-084
C 02/11/05                                                      ECIS06  SIGM-000
      FUNCTION SIGM(ETA)                                                SIGM-001
C  COULOMB PHASE SHIFT SIGMA0.                                          SIGM-002
C***********************************************************************SIGM-003
      IMPLICIT REAL*8 (A-H,O-Z)                                         SIGM-004
      DIMENSION C(2,13)                                                 SIGM-005
      DATA C1,C2,C3,C4,C5,C6,C7,C /8.333333333333333D-2,-2.7777777777777SIGM-006
     178D-3,7.936507936507937D-4,-5.952380952380952D-4,8.417508417508417SIGM-007
     2D-4,-1.917526917526918D-3,6.41025641025641D-3,1.D-16,1.4D-15,-5.4DSIGM-008
     3-15,-2.07D-14,5.1D-13,-3.6968D-12,7.7823D-12,1.043427D-10,-1.18127SIGM-009
     446D-9,5.0020075D-9,6.116095D-9,-2.056338417D-7,1.133027232D-6,-1.2SIGM-010
     5504934821D-6,-2.01348547807D-5,1.280502823882D-4,-2.152416741149D-SIGM-011
     64,-1.1651675918591D-3,7.218943246663D-3,-9.621971527877D-3,-4.2197SIGM-012
     77345555443D-2,.1665386113822915D0,-4.20026350340952D-2,-.655878071SIGM-013
     85202538D0,.5772156649015329D0,1.D0/                               SIGM-014
      IF (DABS(ETA).GT.1.D-16) GO TO 1                                  SIGM-015
      SIGM=-C(1,13)*ETA                                                 SIGM-016
      GO TO 5                                                           SIGM-017
    1 E=ETA*ETA                                                         SIGM-018
      IF (E.GT.1.D0) GO TO 3                                            SIGM-019
      X=C(1,1)                                                          SIGM-020
      Y=C(2,1)                                                          SIGM-021
      DO 2 I=2,13                                                       SIGM-022
      X=C(1,I)-E*X                                                      SIGM-023
    2 Y=C(2,I)-E*Y                                                      SIGM-024
      SIGM=-DATAN2(ETA*X,Y)                                             SIGM-025
      GO TO 5                                                           SIGM-026
    3 L=1                                                               SIGM-027
      IF (E.LT.64.D0) L=2.D0+DSQRT(64.D0-E)                             SIGM-028
      Z=DFLOAT(L)                                                       SIGM-029
      X=DSQRT(Z*Z+E)                                                    SIGM-030
      Y=DATAN2(ETA,Z)                                                   SIGM-031
      E=1.D0/(Z*Z+E)                                                    SIGM-032
      SIGM=ETA*(DLOG(X)-1.D0)+(Z-.5D0)*Y-(C1*DSIN(Y)+E*(C2*DSIN(3.D0*Y)+SIGM-033
     1E*(C3*DSIN(5.D0*Y)+E*(C4*DSIN(7.D0*Y)+E*(C5*DSIN(9.D0*Y)+E*(C6*DSISIGM-034
     2N(11.D0*Y)+E*C7*DSIN(13.D0*Y)))))))/X                             SIGM-035
      IF (L.EQ.1) GO TO 5                                               SIGM-036
      J=L-1                                                             SIGM-037
      DO 4 I=1,J                                                        SIGM-038
      Z=Z-1.D0                                                          SIGM-039
    4 SIGM=SIGM-DATAN2(ETA,Z)                                           SIGM-040
    5 RETURN                                                            SIGM-041
      END                                                               SIGM-042
C 12/11/05                                                      ECIS06  PSI_-000
      FUNCTION PSI(ETA)                                                 PSI_-001
C  REAL PART OF PSI(1-I*ETA)-PSI(1)-PSI(I)                              PSI_-002
C  WITH PSI(Z) = LOGARITHMIC DERIVATIVE OF THE GAMMA FUNCTION           PSI_-003
C***********************************************************************PSI_-004
      IMPLICIT REAL*8 (A-H,O-Z)                                         PSI_-005
      DIMENSION B(13)                                                   PSI_-006
      DATA C/.5772156649015329D0/,C1/8.333333333333333D-2/,C2/-8.3333333PSI_-007
     133333333D-3/,C3/3.968253968253968D-3/,C4/-4.166666666666667D-3/,C5PSI_-008
     2/7.575757575757576D-3/,C6/-2.109279609279609D-2/,B/7.4507117898354PSI_-009
     328D-9,2.980350351465228D-8,1.192199259653110D-7,4.769329867878064DPSI_-010
     4-7,1.908212716553938D-6,7.637197637899762D-6,3.058823630702049D-5,PSI_-011
     51.227133475784893D-4,4.941886041194665D-4,2.008392826082234D-3,8.3PSI_-012
     649277381922945D-3,3.692775514337036D-2,2.020569031595948D-1/      PSI_-013
      IF (DABS(ETA).GT.1.D-8) GO TO 1                                   PSI_-014
      PSI=C-1.D0                                                        PSI_-015
      GO TO 5                                                           PSI_-016
    1 E=ETA*ETA                                                         PSI_-017
      IF (E.GT..25D0) GO TO 3                                           PSI_-018
      X=B(1)                                                            PSI_-019
      DO 2 I=2,13                                                       PSI_-020
    2 X=B(I)-E*X                                                        PSI_-021
      PSI=C-1.D0/(1.D0+E)+E*X                                           PSI_-022
      GO TO 5                                                           PSI_-023
    3 L=1                                                               PSI_-024
      IF (E.LT.64.D0) L=2+IDINT(DSQRT(64.D0-E))                         PSI_-025
      X=DSQRT(DFLOAT(L*L)+E)                                            PSI_-026
      Y=DATAN(ETA/DFLOAT(L))                                            PSI_-027
      E=1.D0/(DFLOAT(L*L)+E)                                            PSI_-028
      PSI=DLOG(X)-.5D0*DFLOAT(L)*E-E*(C1*DCOS(2.D0*Y)+E*(C2*DCOS(4.D0*Y)PSI_-029
     1+E*(C3*DCOS(6.D0*Y)+E*(C4*DCOS(8.D0*Y)+E*(C5*DCOS(10.D0*Y)+E*(C6*DPSI_-030
     2COS(12.D0*Y)+E*C1*DCOS(14.D0*Y)))))))+C+C-1.D0                    PSI_-031
      IF (L.EQ.1) GO TO 5                                               PSI_-032
      J=L-1                                                             PSI_-033
      E=ETA*ETA                                                         PSI_-034
      DO 4 I=1,J                                                        PSI_-035
    4 PSI=PSI-1.D0/(DFLOAT(I)+E/DFLOAT(I))                              PSI_-036
    5 RETURN                                                            PSI_-037
      END                                                               PSI_-038
C 28/02/07                                                      ECIS06  CORI-000
      SUBROUTINE CORI(EI,EF,SI,SF,T,SSI,SSF,FGI,FGF,Z,LM1,LM2,LM3,LM,W) CORI-001
C    COMPUTATION OF THE INTEGRALS FROM RS TO INFINITY OF PRODUCTS OF    CORI-002
C REGULAR OR IRREGULAR COULOMB FUNCTIONS OF SAME L-VALUE DIVIDED BY R**2CORI-003
C FOR L=0 TO L=LM-1 AND OF REGULAR FUNCTIONS OF SAME L DIVIDED BY R**2  CORI-004
C L=0 TO L=LM2-1.CALLS CORZ IF THERE IS NO CHARGE.                      CORI-005
C INPUT:     EI,EF:   COULOMB PARAMETERS.                               CORI-006
C            SI,SF:   WAVE NUMBERS MULTIPLIED BY MATCHING RADIUS.       CORI-007
C            SSI,SSF: COULOMB PHASE-SHIFTS FOR L=0.                     CORI-008
C            FGI,FGF: REGULAR AND IRREGULAR COULOMB FUNCTIONS.          CORI-009
C            LM1:     MAXIMUM NUMBER OF INTEGRALS FROM RS TO INF.       CORI-010
C            LM2:     NUMBER OF INTEGRALS FROM 0 TO INFINITY            CORI-011
C            LM3:     DIMENSION OF WORKING AREA.                        CORI-012
C            LM:      ACTUAL NUMBER OF INTEGRALS FROM RS TO INF.        CORI-013
C OUTPUT:    T:       INTEGRALS FROM 0 TO INFINITY FOR PRODUCTS OF      CORI-014
C                           REGULAR FUNCTIONS.                          CORI-015
C            W:       INTEGRALS FROM RS TO INFINITY.                    CORI-016
C WORKING AREA:                                                         CORI-017
C            Z:       FOR THE COMPUTATION OF HYPERGEOMETRIC F3.         CORI-018
C                                                                       CORI-019
C THE SUBROUTINES CORI, CORO, CORZ AND CORA FOR COULOMB CORRECTIONS     CORI-020
C ARE IDENTICAL IN THE CODES ECIS AND DWBA.                             CORI-021
C THE PRESENT VERSION IS OF FEBRUARY 2006. FOR DWBA, THE NO-CHARGE      CORI-022
C PART AND ODD INTEGRALS COULD BE SUPPRESSED.                           CORI-023
C***********************************************************************CORI-024
      IMPLICIT REAL*8 (A-H,O-Z)                                         CORI-025
      LOGICAL LL(4)                                                     CORI-026
      DIMENSION FGI(LM1,*),FGF(LM1,*),Z(4,*),W(LM1,*),X1(4),X2(4),X3(4),CORI-027
     1X4(4),T(*),Y(4,4),AZ(2),CC(4,4)                                   CORI-028
      COMMON /INOUT/ MR,MW,MS                                           CORI-029
      DATA PI /3.1415926535897932D0/                                    CORI-030
      IF ((EI.EQ.0.D0).AND.(EF.EQ.0.D0)) GO TO 38                       CORI-031
C COMPUTATION OF SOME CONSTANTS.                                        CORI-032
      IF (SI.GT.2.2D0*SF) GO TO 39                                      CORI-033
      RS=DSQRT(SI*SF)                                                   CORI-034
      FS=DSQRT(SF/SI)                                                   CORI-035
      FI=EI**2                                                          CORI-036
      FF=EF**2                                                          CORI-037
      EIF=EI*EF                                                         CORI-038
      EX=EF-EI                                                          CORI-039
      SIF=SI/SF+SF/SI                                                   CORI-040
      CX=FI*SI**2+FF*SF**2                                              CORI-041
      DX=FI*SI**2-FF*SF**2                                              CORI-042
      IF (DABS(DX).GT.1.D-10) GO TO 1                                   CORI-043
      DT=1.D0                                                           CORI-044
      DX=0.D0                                                           CORI-045
      DY=EIF                                                            CORI-046
      GO TO 2                                                           CORI-047
    1 DT=SI**2-SF**2                                                    CORI-048
      DY=(FI*SI**4-FF*SF**4)/(SI*SF)                                    CORI-049
      IF (DABS(DT).LT.1.D-10) GO TO 2                                   CORI-050
      DX=DX/DT                                                          CORI-051
      DY=DY/DT                                                          CORI-052
      DT=1.D0                                                           CORI-053
    2 RM=DMAX1((5.D0*DABS(EI)+22.5D0)*FS,(5.D0*DABS(EF)+22.5D0)/FS,.18D0CORI-054
     1*EIF)/3.D0                                                        CORI-055
      IF (RM.LT.RS) RM=RS                                               CORI-056
C COMPUTATION OF INTEGRALS FROM RS TO INFINITY FOR L=0 AND L=1.         CORI-057
      CALL COR0(EI,EF,SSI,SSF,ZR,ZI,Z,LM3,RM,RS,FS,FI,FF,EX,CC)         CORI-058
C COMPUTATION OF INTEGRALS FROM 0 TO INFINITY FOR L=0 AND L=1.          CORI-059
      IF (EI.NE.EF.OR.SI.NE.SF) GO TO 4                                 CORI-060
C WHEN EI=EF=E   I(L,L,2)=(PI-PI*COTH(PI*E)-1/E+SUM ON N FROM 0 TO L OF CORI-061
C                2*E/(N**2+E**2))/2/(2*L+1).                            CORI-062
      A2=PI*.5D0                                                        CORI-063
      B2=DEXP(-2.D0*PI*EI)                                              CORI-064
      IF (EI.NE.0.D0) A2=A2-.5D0*PI*(B2+1.D0)/(1.D0-B2)+.5D0/EI         CORI-065
      B3=0.D0                                                           CORI-066
      DO 3 I=1,LM2                                                      CORI-067
      B2=B3                                                             CORI-068
      B3=B3+1.D0                                                        CORI-069
      T(I)=A2/(B2+B3)                                                   CORI-070
    3 A2=A2+EI/(B3**2+FI)                                               CORI-071
      LL(1)=.TRUE.                                                      CORI-072
      LL(2)=.TRUE.                                                      CORI-073
      GO TO 13                                                          CORI-074
C COMPUTATION OF I(0,0,1) AND I(1,1,1)                                  CORI-075
C  I(L,L,1) = 2*(SI*SF)**(1/2)/(SI+SF)**2 * EXP( PI*SIGN(SF-SI)*EX/2) * CORI-076
C REAL PART OF (|SF-SI|/(SF+SI))**(I*EX)*GAMMA(-I*EX)*EXP(I*(XEF-XEI))* CORI-077
C   2F1(L+1-I*EI,L+1+I*EF;1+I*EF-I*EI;((SF-SI)/(SF+SI))**2)             CORI-078
C  WHERE EX=EF-EI.                                                      CORI-079
    4 A2=EX**2                                                          CORI-080
      B2=((SI-SF)/(SI+SF))**2                                           CORI-081
      A3=2.D0*DEXP(ZR-PI*.5D0*EX)/(SI+SF)**2*RS                         CORI-082
      IF (SF.GT.SI) A3=A3*DEXP(PI*EX)                                   CORI-083
      A4=ZI+SSF-SSI+.5D0*DLOG(B2)*EX                                    CORI-084
      A5=A3*DCOS(A4)                                                    CORI-085
      A6=A3*DSIN(A4)                                                    CORI-086
      A3=A5                                                             CORI-087
      A4=A6                                                             CORI-088
      A7=0.D0                                                           CORI-089
      DO 7 L=1,2                                                        CORI-090
      AZ(L)=A3                                                          CORI-091
      A8=0.D0                                                           CORI-092
      DO 5 N=1,500                                                      CORI-093
      A8=A8+1.D0                                                        CORI-094
      B3=(A7+A8)**2+EIF                                                 CORI-095
      B4=(A7+A8)*EX                                                     CORI-096
      B7=B2/(A8*(A8**2+A2))                                             CORI-097
      B5=(B3*A8+B4*EX)*B7                                               CORI-098
      B6=(A8*B4-EX*B3)*B7                                               CORI-099
      A9=A3*B5-A4*B6                                                    CORI-100
      A4=A3*B6+A4*B5                                                    CORI-101
      A3=A9                                                             CORI-102
      AZ(L)=AZ(L)+A3                                                    CORI-103
      IF (DABS(A3)+DABS(A4).LT.DABS(AZ(L))*1.D-16) GO TO 6              CORI-104
    5 CONTINUE                                                          CORI-105
      LI=L-1                                                            CORI-106
      WRITE (MW,1000) LI,LI,EI,EF,AZ(L),A3,A4                           CORI-107
    6 B3=1.D0+EIF                                                       CORI-108
      B5=(1.D0-B2)/DSQRT(B3*B3+EX*EX)                                   CORI-109
      A7=1.D0                                                           CORI-110
      A3=B5*(A5*B3-A6*EX)                                               CORI-111
    7 A4=B5*(A6*B3+A5*EX)                                               CORI-112
C COMPUTATION OF I(0,0,2) AND I(1,1,2) . ONLY THE FIRST IS NEEDED       CORI-113
C   FOR BACKWARD RECURRENCE:                                            CORI-114
C I(L,L,2) = PI/(2*SH(PI*EX)*( (Y/SI-1/(Y*SF))/(2*L+1)+((SI-SF)/(SF*SI))CORI-115
C  *EXP(-PI*EX/2) * REAL PART OF EXP(I*(XEI-XEF))*((SI-SF)/2)**(-I*EX)  CORI-116
C  *SF**(I*EF)*SI**(-I*EI)*F3(-L+I*EI,-L-I*EF,L+1+I*EI,L+1-I*EF,2-I*EX; CORI-117
C  (SI-SF)/(2*SI),(SF-SI)/(2*SF))                                       CORI-118
C   WHERE  Y=EXP(PI*EX/2)*(SI/SF)**L*|GAMMA(L+1+I*EF)/GAMMA(L+1+I*EI)|. CORI-119
      IF (EI.GT.EF) GO TO 8                                             CORI-120
      EEF=EF                                                            CORI-121
      EEI=EI                                                            CORI-122
      SXF=SF                                                            CORI-123
      SXI=SI                                                            CORI-124
      SSS=SSI-SSF-ZI                                                    CORI-125
      GO TO 9                                                           CORI-126
    8 EEF=EI                                                            CORI-127
      EEI=EF                                                            CORI-128
      SXF=SI                                                            CORI-129
      SXI=SF                                                            CORI-130
      SSS=SSF-SSI+ZI                                                    CORI-131
    9 EEX=EEF-EEI                                                       CORI-132
      SFI=SXI-SXF                                                       CORI-133
      A2=EEX/(2.D0*EEF)                                                 CORI-134
      A3=-A2*SFI/(2.D0*SXF)                                             CORI-135
      A4=A2*SFI/(2.D0*SXI)                                              CORI-136
      LL(1)=DFLOAT(LM2)*DABS(EX).GT.3.D0*DABS(EI+EF)                    CORI-137
      LL(2)=.NOT.LL(1)                                                  CORI-138
      B3=DEXP(-ZR)/EEX/DSQRT(1.D0+EX**2)                                CORI-139
      IF (SFI.LT.0.D0) B3=B3*DEXP(EEX*PI)                               CORI-140
      B4=SSS+DATAN(EEX)-.5D0*PI+EEF*DLOG(SXF)-EEI*DLOG(SXI)-EEX*DLOG(.5DCORI-141
     10*DABS(SFI))                                                      CORI-142
      A5=B3*DCOS(B4)                                                    CORI-143
      A6=B3*DSIN(B4)                                                    CORI-144
      B5=A5                                                             CORI-145
      B6=A6                                                             CORI-146
      B2I=-2.D0*PI+4.D0*PI**2*EEI                                       CORI-147
      B2F=-2.D0*PI+4.D0*PI**2*EEF                                       CORI-148
      IF (DABS(EEI).GT.1.D-8) B2I=(DEXP(-2.D0*PI*EEI)-1.D0)/EEI         CORI-149
      IF (DABS(EEF).GT.1.D-8) B2F=(DEXP(-2.D0*PI*EEF)-1.D0)/EEF         CORI-150
      B2=DSQRT(B2I/B2F)                                                 CORI-151
      A7=DEXP(-.5D0*PI*EEX)                                             CORI-152
      A8=PI*A7**2/(1.D0-A7**4)*RS                                       CORI-153
      A7=-A7*SFI/(SF*SI)                                                CORI-154
      Z(1,1)=1.D0                                                       CORI-155
      Z(2,1)=0.D0                                                       CORI-156
      Z(3,1)=1.D0                                                       CORI-157
      Z(4,1)=0.D0                                                       CORI-158
      DO 12 L=1,2                                                       CORI-159
      LI=L-1                                                            CORI-160
      T(L)=B5                                                           CORI-161
      N=0                                                               CORI-162
   10 N=N+1                                                             CORI-163
      IF (2*N.GT.LM3) CALL MEMO('CORI',LM3,2*N)                         CORI-164
      B4=DFLOAT(N+1)**2+EX**2                                           CORI-165
      B9=(B5*DFLOAT(N+1)-EEX*B6)/(B4*A2)                                CORI-166
      B6=(B5*EEX+B6*DFLOAT(N+1))/(B4*A2)                                CORI-167
      B5=B9                                                             CORI-168
      B3=DFLOAT((L+N-1)*(N-L))-EEI**2                                   CORI-169
      B4=EEI*DFLOAT(2*N-1)                                              CORI-170
      Z(1,N+1)=(Z(1,N)*B3-Z(2,N)*B4)*A4/DFLOAT(N)                       CORI-171
      Z(2,N+1)=(Z(1,N)*B4+Z(2,N)*B3)*A4/DFLOAT(N)                       CORI-172
      B3=DFLOAT((L+N-1)*(N-L))-EEF**2                                   CORI-173
      B4=-EEF*DFLOAT(2*N-1)                                             CORI-174
      Z(3,N+1)=(Z(3,N)*B3-Z(4,N)*B4)*A3/DFLOAT(N)                       CORI-175
      Z(4,N+1)=(Z(3,N)*B4+Z(4,N)*B3)*A3/DFLOAT(N)                       CORI-176
      B7=Z(1,N+1)                                                       CORI-177
      B8=Z(2,N+1)                                                       CORI-178
      DO 11 J=1,N                                                       CORI-179
      M=N+2-J                                                           CORI-180
      B7=B7+Z(1,J)*Z(3,M)-Z(2,J)*Z(4,M)                                 CORI-181
   11 B8=B8+Z(2,J)*Z(3,M)+Z(1,J)*Z(4,M)                                 CORI-182
      IF (DABS(B7)+DABS(B8).GT.1.D30) GO TO 40                          CORI-183
      B7=B7*B5-B8*B6                                                    CORI-184
      T(L)=T(L)+B7                                                      CORI-185
      IF (DABS(B7).GT.DABS(T(L))*1.D-16) GO TO 10                       CORI-186
      T(L)=A8*(A7*T(L)+(B2/SXI-1.D0/(B2*SXF))/DFLOAT(2*L-1))            CORI-187
      IF (LL(1)) GO TO 13                                               CORI-188
      B2=B2*SXF/SXI*DSQRT((1.D0+EEF**2)/(1.D0+EEI**2))                  CORI-189
      B4=DSQRT((1.D0+EEI**2)*(1.D0+EEF**2))                             CORI-190
      B3=(1.D0+EIF)/B4                                                  CORI-191
      B4=-EEX/B4                                                        CORI-192
      B5=B3*A5-B4*A6                                                    CORI-193
   12 B6=B3*A6+B4*A5                                                    CORI-194
C COMP. OF THE INTEGRALS FROM 0 TO INFINITY.                            CORI-195
C UPWARDS RECURRENCES FOR THE OTHER INTEGRALS:  STARTING VALUES:        CORI-196
   13 DO 14 J=1,4                                                       CORI-197
      W(1,J)=CC(J,3)                                                    CORI-198
      W(2,J)=CC(J,4)                                                    CORI-199
      X2(J)=CC(J,1)/RS                                                  CORI-200
   14 X3(J)=CC(J,2)/RS                                                  CORI-201
      RM=RS**2                                                          CORI-202
      IM=1                                                              CORI-203
      LX=LM                                                             CORI-204
      IF (.NOT.LL(1)) LX=MAX0(LX,LM2)                                   CORI-205
      LL(3)=LL(1)                                                       CORI-206
      I=2                                                               CORI-207
      A1=DSQRT(1.D0+FI)                                                 CORI-208
      B1=DSQRT(1.D0+FF)                                                 CORI-209
      IF (LL(1)) GO TO 15                                               CORI-210
      C4=AZ(1)                                                          CORI-211
      C5=AZ(2)                                                          CORI-212
   15 I=I+1                                                             CORI-213
      A2=A1                                                             CORI-214
      B2=B1                                                             CORI-215
      A=DFLOAT(I-1)                                                     CORI-216
      A1=DSQRT(A**2+FI)                                                 CORI-217
      B1=DSQRT(A**2+FF)                                                 CORI-218
      LL(4)=I.GT.LM                                                     CORI-219
   16 A9=(A-1.D0)**2*DT+DX                                              CORI-220
      A3=(2.D0*A-3.D0)*(A**2*DT+DX)*A2*B2                               CORI-221
      A4=-(2.D0*A-1.D0)*(DX*CX/RM+DY*((A-1.D0)**2+A**2)+DT*(A*A-A)**2*SICORI-222
     1F)                                                                CORI-223
      A5=(2.D0*A+1.D0)*A9*A1*B1                                         CORI-224
      C1=DT*(2.D0*A-1.D0)*(EI*SI+EF*SF)*A2*B2/(A-1.D0)                  CORI-225
      C2=DT*(A-.5D0)*(B2**2*((A-1.D0)*EF*SF-(A+1.D0)*EI*SI)*SF/SI+A2**2*CORI-226
     1((A-1.D0)*EI*SI-(A+1.D0)*EF*SF)*SI/SF)/(A-1.D0)                   CORI-227
      A6=A*A2*B2                                                        CORI-228
      A7=-(2.D0*A-1.D0)*(EIF+(A-1.D0)*A*SIF*.5D0)                       CORI-229
      A8=(A-1.D0)*A1*B1                                                 CORI-230
      IF (LL(4)) GO TO 17                                               CORI-231
      B6=(A-.5D0)/(RM*RS*(A-1.D0)**2)                                   CORI-232
      B3=-2.D0*RM*DX*B6*A2*B2                                           CORI-233
      B4=B6*A9*SF*(2.D0*(A*A-A)*A+(A+1.D0)*EI*SI-(A-1.D0)*EF*SF)*B2     CORI-234
      B5=B6*A9*SI*(2.D0*(A*A-A)*A+(A+1.D0)*EF*SF-(A-1.D0)*EI*SI)*A2     CORI-235
      B6=-B6*(A9*(2.D0*(A*A-A)**2*(2.D0*A-1.D0)+(EI*SI+EF*SF)*(A-1.D0)*(CORI-236
     1A+1.D0)*(2.D0*A-1.D0)+2.D0*EIF*RM*A)-(A-1.D0)*(CX*DX+(A-1.D0)*((A+CORI-237
     21.D0)*CX*DT-2.D0*RM*DY)))                                         CORI-238
      B9=(A-.5D0)*A/RS                                                  CORI-239
      B7=B9*B2/SI                                                       CORI-240
      B8=B9*A2/SF                                                       CORI-241
      B9=B9*(-(2.D0*A-1.D0)*(A-1.D0)-(EI*SI+EF*SF))/RM                  CORI-242
   17 IF (IM.NE.1) GO TO 26                                             CORI-243
      IF (LL(3)) GO TO 18                                               CORI-244
      T(I)=-(A3*T(I-2)+A4*T(I-1)+C1*C4+C2*C5)/A5                        CORI-245
      C3=C4                                                             CORI-246
      C4=C5                                                             CORI-247
      C5=-(A6*C3+A7*C4)/A8                                              CORI-248
   18 IF (LL(4)) GO TO 23                                               CORI-249
      DO 20 J=1,4                                                       CORI-250
      J1=MOD(J+1,2)+I-2                                                 CORI-251
      J2=(J+1)/2+I-3                                                    CORI-252
      DO 19 K=1,4                                                       CORI-253
      K1=MOD(K+1,2)*2+1                                                 CORI-254
      K2=2*((K+1)/2)-1                                                  CORI-255
   19 Y(K,J)=FGI(J1,K1)*FGF(J2,K2)                                      CORI-256
   20 CONTINUE                                                          CORI-257
C RECURRENCE FOR (0,2;L).                                               CORI-258
      DO 21 J=1,4                                                       CORI-259
      X1(J)=X2(J)                                                       CORI-260
      X2(J)=X3(J)                                                       CORI-261
   21 W(I,J)=-(B3*Y(J,1)+B4*Y(J,2)+B5*Y(J,3)+B6*Y(J,4)+A3*W(I-2,J)+A4*W(CORI-262
     1I-1,J)+C1*X1(J)+C2*X2(J))/A5                                      CORI-263
      DO 22 J=1,4                                                       CORI-264
   22 X3(J)=-(B7*Y(J,2)+B8*Y(J,3)+B9*Y(J,4)+A6*X1(J)+A7*X2(J))/A8       CORI-265
   23 IF (I.LT.LX) GO TO 15                                             CORI-266
      LN=MAX0(LM,IDINT(RS))+50                                          CORI-267
      LX=LN                                                             CORI-268
      IF (.NOT.LL(2)) LX=MAX0(LX,LM2+6*MIN0(IDINT((SI+SF)/DABS(SI-SF)),5CORI-269
     100))                                                              CORI-270
      LL(3)=LL(2)                                                       CORI-271
      IM=2                                                              CORI-272
      X4(1)=1.D0                                                        CORI-273
      X4(2)=0.D0                                                        CORI-274
      X4(3)=0.D0                                                        CORI-275
      X4(4)=0.D0                                                        CORI-276
      A1=LX-1                                                           CORI-277
      A2=DSQRT(A1**2+FI)                                                CORI-278
      B2=DSQRT(A1**2+FF)                                                CORI-279
      DO 24 J=1,4                                                       CORI-280
      X2(J)=0.D0                                                        CORI-281
   24 X3(J)=0.D0                                                        CORI-282
      X3(1)=1.D-20                                                      CORI-283
      X3(2)=1.D-20                                                      CORI-284
   25 LX=LX-1                                                           CORI-285
      A=LX                                                              CORI-286
      A1=A2                                                             CORI-287
      B1=B2                                                             CORI-288
      A3=DFLOAT(LX-1)                                                   CORI-289
      LL(4)=LX.GT.LN                                                    CORI-290
      A2=DSQRT(A3**2+FI)                                                CORI-291
      B2=DSQRT(A3**2+FF)                                                CORI-292
      GO TO 16                                                          CORI-293
   26 IF (LL(3)) GO TO 27                                               CORI-294
      X4(1)=-A6/(A7+A8*X4(1))                                           CORI-295
      X4(3)=X4(1)*X4(2)                                                 CORI-296
      X4(2)=-(A4*X4(3)+A5*X4(4)*X4(1)+C1+C2*X4(1))/A3                   CORI-297
      X4(4)=X4(3)                                                       CORI-298
      IF (LX.LE.LM2) T(LX)=X4(3)/X4(2)                                  CORI-299
   27 IF (LL(4)) GO TO 33                                               CORI-300
C DOWNWARD RECURRENCE FOR F(EI) AND F(EF).                              CORI-301
      DO 28 J=1,4                                                       CORI-302
      X1(J)=X2(J)                                                       CORI-303
   28 X2(J)=X3(J)                                                       CORI-304
      X3(1)=((2.D0*A-1.D0)*(EI+(A-1.D0)*A/SI)*X2(1)-(A-1.D0)*A1*X1(1))/(CORI-305
     1A*A2)                                                             CORI-306
      X3(2)=((2.D0*A-1.D0)*(EF+(A-1.D0)*A/SF)*X2(2)-(A-1.D0)*B1*X1(2))/(CORI-307
     1A*B2)                                                             CORI-308
C DOWNWARDS RECURRENCE FOR (1,2;L).                                     CORI-309
      X3(4)=-(A7*X2(4)+A8*X1(4)+B7*X2(1)*X3(2)+B8*X3(1)*X2(2)+B9*X2(1)*XCORI-310
     12(2))/A6                                                          CORI-311
C DOWNWARD RECURRENCE FOR (0,2;L).                                      CORI-312
      X3(3)=-(A4*X2(3)+A5*X1(3)+C1*X3(4)+C2*X2(4)+B3*X3(1)*X3(2)+B4*X2(1CORI-313
     1)*X3(2)+B5*X3(1)*X2(2)+B6*X2(1)*X2(2))/A3                         CORI-314
      I=LX-1                                                            CORI-315
      IF (I.LE.LM) W(I,1)=X3(3)                                         CORI-316
      IF (DABS(X3(1)).LT.1.D10) GO TO 29                                CORI-317
      X3(1)=X3(1)*1.D-20                                                CORI-318
      X2(1)=X2(1)*1.D-20                                                CORI-319
      GO TO 30                                                          CORI-320
   29 IF (DABS(X3(2)).LT.1.D10) GO TO 33                                CORI-321
      X2(2)=X2(2)*1.D-20                                                CORI-322
      X3(2)=X3(2)*1.D-20                                                CORI-323
   30 DO 31 J=3,4                                                       CORI-324
      X3(J)=X3(J)*1.D-20                                                CORI-325
   31 X2(J)=X2(J)*1.D-20                                                CORI-326
      IF (I.GT.LM) GO TO 33                                             CORI-327
      DO 32 J=I,LM                                                      CORI-328
   32 W(J,1)=W(J,1)*1.D-20                                              CORI-329
   33 IF (LX.GT.2) GO TO 25                                             CORI-330
      IF (LL(2)) GO TO 36                                               CORI-331
C COMPUTATION OF THE MIXTURE OF THE DECREASING SOLUTION OF HOMOGENEOUS  CORI-332
C EQUATION  (S2/S1)**L * |GAMMA(L+1+I*E2)/GAMMA(L+1+I*E1)|/(2*L+1)      CORI-333
C WHERE S2 IS THE SMALLER OF THE TWO VALUES SI AND SF.                  CORI-334
      A1=X4(2)*AZ(1)                                                    CORI-335
      A2=T(1)-A1                                                        CORI-336
      A3=0.D0                                                           CORI-337
      DO 35 I=2,LM2                                                     CORI-338
      A3=A3+1.D0                                                        CORI-339
      A1=T(I)*A1                                                        CORI-340
      A4=SF*DSQRT((A3**2+FF)/(A3**2+FI))/SI                             CORI-341
      IF (SI.GT.SF) GO TO 34                                            CORI-342
      A2=A2/A4                                                          CORI-343
      GO TO 35                                                          CORI-344
   34 A2=A2*A4                                                          CORI-345
   35 T(I)=A1+A2/(2.D0*A3+1.D0)                                         CORI-346
C THE VALUES OBTAINED ARE UNNORMALISED INTEGRALS FROM RS TO 0.          CORI-347
C NORMALISATION AND TRANSFORMATION TO INTEGRAL FROM RS TO INFINITY.     CORI-348
   36 A1=FGI(1,1)*FGF(1,1)/(X3(1)*X3(2))                                CORI-349
      DO 37 J=1,LM                                                      CORI-350
   37 W(J,1)=A1*W(J,1)+T(J)                                             CORI-351
      IF (SI.NE.SF) WRITE (MW,1001) CC(1,3),W(1,1),CC(1,4),W(2,1)       CORI-352
      IF ((DABS(CC(1,3)-W(1,1))/(DABS(CC(1,3))+DABS(W(1,1))).GT.1.D-4).OCORI-353
     1R.(DABS(CC(1,4)-W(2,1))/(DABS(CC(1,4))+DABS(W(2,1))).GT.1.D-4)) GOCORI-354
     2 TO 41                                                            CORI-355
      RETURN                                                            CORI-356
   38 CALL CORZ(SI,SF,T,FGI,FGF,LM1,LM2,LM,W)                           CORI-357
      RETURN                                                            CORI-358
   39 WRITE (MW,1002) SF,SI                                             CORI-359
      GO TO 42                                                          CORI-360
   40 WRITE (MW,1003) N,LI,LI,EI,EF,T(L),B5,B6                          CORI-361
      GO TO 42                                                          CORI-362
   41 WRITE (MW,1004)                                                   CORI-363
      IF (SI.EQ.SF) WRITE (MW,1001) CC(1,3),W(1,1),CC(1,4),W(2,1)       CORI-364
   42 WRITE (MW,1005)                                                   CORI-365
      STOP                                                              CORI-366
 1000 FORMAT (' NO CONVERGENCE WITH 500 TERMS FOR I(',I1,',',I1,') WITH CORI-367
     1EI =',F15.6,31X,'AND EF =',F15.6,5X,'IN CORI'/5X,'VALUE =',D15.8,5CORI-368
     2X,'LAST TERM =',2D16.8/' ... CONTINUE ...')                       CORI-369
 1001 FORMAT (' INTEGRALS WITH REGULAR FUNCTIONS: (L+1)       DIRECT:   CORI-370
     1   BACKWARDS RECURRENCE:'/37X,'1',2D20.10/37X,'2',2D20.10)        CORI-371
 1002 FORMAT (' TOO LARGE RATIO SF/SI =',F15.6,1H/,F15.6,5X,'IN CORI.') CORI-372
 1003 FORMAT (' THE',I4,' TERM IS TOO LARGE IN THE COMPUTATION OF I(',I1CORI-373
     1,',',I1,',2)    WITH EI =',F15.6,5X,'AND EF =',F15.6,5X,'IN CORH:'CORI-374
     2/5X,'VALUE =',D15.8,5X,'LAST TERM =',2D16.8)                      CORI-375
 1004 FORMAT (' NO COINCIDENCE BETWEEN DIRECT AND BACKWARDS RECURRENCES CORI-376
     1FOR INTEGRALS WITH REGULAR FUNCTIONS.')                           CORI-377
 1005 FORMAT (//' IN CORI  ...  STOP  ...')                             CORI-378
      END                                                               CORI-379
C 07/03/07                                                      ECIS06  COR0-000
      SUBROUTINE COR0(EI,EF,SSI,SSF,ZR,ZI,Z,LM3,RM,RS,FS,FI,FF,EX,CC)   COR0-001
C    COMPUTATION OF THE INTEGRALS FROM RS TO INFINITY OF PRODUCTS OF    COR0-002
C REGULAR OR IRREGULAR COULOMB FUNCTIONS OF L=0 AND L=1 DIVIDED BY R**2 COR0-003
C INPUT:     EI,EF:   COULOMB PARAMETERS.                               COR0-004
C            SSI,SSF: COULOMB PHASE-SHIFTS FOR L=0.                     COR0-005
C            LM3:     DIMENSION OF WORKING AREA.                        COR0-006
C            RM:      ACTUAL MATCHING RADIUS FOR INTEGRALS.             COR0-007
C            RS:      NEEDED MATCHING RADIUS FOR INTEGRALS.             COR0-008
C            FS:      SQUARE ROOT OF RATIO OF WAVE NUMBERS.             COR0-009
C            FI,FF:   SQUARES OF COULOMB PARAMETERS.                    COR0-010
C            EX:      DIFFERENCE OF COULOMB PARAMETERS.                 COR0-011
C OUTPUT:    CC:      INTEGRALS FROM RS TO INFINITY.                    COR0-012
C            ZR,ZI:   REAL, IMAGINARY PART OF LOG(GAMMA(0.,EI-EF))      COR0-013
C WORKING AREA:                                                         COR0-014
C            Z:       FOR THE COMPUTATION OF F AND G.                   COR0-015
C***********************************************************************COR0-016
      IMPLICIT REAL*8 (A-H,O-Z)                                         COR0-017
      DIMENSION Z(4,*),X1(4),X2(4),X3(4),X4(4),X5(4),C(2,2,2),Y(4,4),IE(COR0-018
     12),ABSC(20),P(20),B(7),CC(4,4),YY(8,2)                            COR0-019
      EQUIVALENCE (Y,YY)                                                COR0-020
      DATA PI /3.1415926535897932D0/                                    COR0-021
      DATA B /.8333333333333333D-01,-.2777777777777778D-2,.7936507936507COR0-022
     19365D-3,-.5952380952380952D-3,.84175084175D-3,-.19175269D-2,.641D-COR0-023
     202/                                                               COR0-024
      DATA ABSC( 1),P( 1) / 0.88114514472040D-03, 0.22606385492666D-02/ COR0-025
      DATA ABSC( 2),P( 2) / 0.46368806502715D-02, 0.52491422655764D-02/ COR0-026
      DATA ABSC( 3),P( 3) / 0.11370025008113D-01, 0.82105291909539D-02/ COR0-027
      DATA ABSC( 4),P( 4) / 0.21041590393104D-01, 0.11122924597084D-01/ COR0-028
      DATA ABSC( 5),P( 5) / 0.33593595860662D-01, 0.13968503490012D-01/ COR0-029
      DATA ABSC( 6),P( 6) / 0.48950596515563D-01, 0.16730097641274D-01/ COR0-030
      DATA ABSC( 7),P( 7) / 0.67020248393870D-01, 0.19391083987236D-01/ COR0-031
      DATA ABSC( 8),P( 8) / 0.87693884583344D-01, 0.21935454092836D-01/ COR0-032
      DATA ABSC( 9),P( 9) / 0.11084717428674D+00, 0.24347903817536D-01/ COR0-033
      DATA ABSC(10),P(10) / 0.13634087240504D+00, 0.26613923491968D-01/ COR0-034
      DATA ABSC(11),P(11) / 0.16402165769291D+00, 0.28719884549696D-01/ COR0-035
      DATA ABSC(12),P(12) / 0.19372305516601D+00, 0.30653121246465D-01/ COR0-036
      DATA ABSC(13),P(13) / 0.22526643745244D+00, 0.32402006728300D-01/ COR0-037
      DATA ABSC(14),P(14) / 0.25846209915691D+00, 0.33956022907617D-01/ COR0-038
      DATA ABSC(15),P(15) / 0.29311039781420D+00, 0.35305823695643D-01/ COR0-039
      DATA ABSC(16),P(16) / 0.32900295458712D+00, 0.36443291197902D-01/ COR0-040
      DATA ABSC(17),P(17) / 0.36592390749637D+00, 0.37361584528984D-01/ COR0-041
      DATA ABSC(18),P(18) / 0.40365120964931D+00, 0.38055180950313D-01/ COR0-042
      DATA ABSC(19),P(19) / 0.44195796466237D+00, 0.38519909082124D-01/ COR0-043
      DATA ABSC(20),P(20) / 0.48061379124697D+00, 0.38752973989212D-01/ COR0-044
C COMPUTATION OF THE INTEGRALS FROM RM TO INFINITY FOR L=0,1 BY         COR0-045
C RAWITSCHER'S METHOD. (COMP. PHYSICS COMM., VOL.11,183,1976)           COR0-046
C EXPANSIONS OF COULOMB WAVE FUNCTIONS ARE Z(N,2*M-1)+I*Z(N,2*M)=G+I*F  COR0-047
C   N=1: L=0,E=EI     N=2: L=0,E=EF     N=3: L=1,E=EI     N=4: L=1,E=EF COR0-048
      A1=RM/FS                                                          COR0-049
      B1=RM*FS                                                          COR0-050
      X1(1)=A1-EI*DLOG(2.D0*A1)+SSI                                     COR0-051
      X1(3)=B1-EF*DLOG(2.D0*B1)+SSF                                     COR0-052
      X1(2)=X1(1)+DATAN(EI)-.5D0*PI                                     COR0-053
      X1(4)=X1(3)+DATAN(EF)-.5D0*PI                                     COR0-054
C FIRST TERM OF ASYMPTOTIC EXPANSION OF H(+/-) FOR L=0,1.               COR0-055
      DO 1 I=1,4                                                        COR0-056
      X5(I)=0.D0                                                        COR0-057
      Z(I,1)=DCOS(X1(I))                                                COR0-058
    1 Z(I,2)=DSIN(X1(I))                                                COR0-059
      X1(1)=-A1-B1                                                      COR0-060
      X2(1)=EI+EF                                                       COR0-061
      X1(2)=B1-A1                                                       COR0-062
      X2(2)=-EX                                                         COR0-063
      IF (DABS(X2(2)).LT.1.D-8) X2(2)=0.D0                              COR0-064
      IF (X2(2).EQ.0.D0) GO TO 4                                        COR0-065
C COMPUTATION OF LOG(GAMMA(0.,EI-EF)).                                  COR0-066
      B2=-DATAN(EX/11.D0)                                               COR0-067
      B3=121.D0+EX**2                                                   COR0-068
      A2=.5D0*DLOG(B3)                                                  COR0-069
      ZR=.91893853320467274D0+10.5D0*A2+EX*B2-11.D0-DLOG(DABS(EX))      COR0-070
      ZI=10.5D0*B2+EX-EX*A2+0.5D0*PI                                    COR0-071
      IF (EX.LT.0.D0) ZI=ZI-PI                                          COR0-072
      A2=11.D0/B3                                                       COR0-073
      B2=EX/B3                                                          COR0-074
      A3=A2**2-B2**2                                                    COR0-075
      B3=2.D0*A2*B2                                                     COR0-076
      DO 2 I=1,7                                                        COR0-077
      ZR=ZR+B(I)*A2                                                     COR0-078
      ZI=ZI+B(I)*B2                                                     COR0-079
      C1=A2*A3-B2*B3                                                    COR0-080
      B2=A2*B3+B2*A3                                                    COR0-081
    2 A2=C1                                                             COR0-082
      DO 3 I=1,10                                                       COR0-083
      A2=DFLOAT(I)                                                      COR0-084
      ZR=ZR-.5D0*DLOG(A2**2+EX**2)                                      COR0-085
    3 ZI=ZI+DATAN(EX/A2)                                                COR0-086
    4 IF (DABS(X1(2)).GT.2.D0) GO TO 9                                  COR0-087
C COMPUTATION OF THE FIRST CONFLUENT HYPERGEOMETRIC FUNCTION.           COR0-088
      IF (X1(2).EQ.0.D0) GO TO 8                                        COR0-089
      IF (DABS(X2(2)).LT.1.D-3) GO TO 5                                 COR0-090
      A2=DEXP(-DSIGN(0.5D0*PI,X1(2))*X2(2)+ZR)                          COR0-091
      B2=DSIGN(ZI,X2(2))+X2(2)*DLOG(DABS(X1(2)))                        COR0-092
      X5(2)=A2*DCOS(B2)                                                 COR0-093
      X5(4)=A2*DSIN(B2)-1.D0/X2(2)                                      COR0-094
      GO TO 6                                                           COR0-095
C EXPANSION FOR SMALL EX.                                               COR0-096
    5 A2=DLOG(DABS(X1(2)))                                              COR0-097
      B2=PI*.5D0                                                        COR0-098
      IF (X1(2).LT.0.D0) B2=-B2                                         COR0-099
      A3=A2*(1.D0+EX*(B2-EX*((A2**2-3.D0*B2**2)/6.D0+EX*B2*(A2**2-B2**2)COR0-100
     1/6.D0)))                                                          COR0-101
      B3=B2-EX*((A2**2-B2**2)/2.D0+EX*(B2*(3.D0*A2**2-B2**2)/6.D0-EX*(A2COR0-102
     1**4-6.D0*A2**2*B2**2+B2**4)/24.D0))                               COR0-103
      A2=.5772156649015329D0-.400685634386331D0*EX**2                   COR0-104
      B2=-EX*(.822467033424113D0-0.270580808427784D0*EX**2)             COR0-105
      A4=A2*(1.D0+EX*(B2-EX*((A2**2-3.D0*B2**2)/6.D0+EX*B2*(A2**2-B2**2)COR0-106
     1/6.D0)))                                                          COR0-107
      B4=B2-EX*((A2**2-B2**2)/2.D0+EX*(B2*(3.D0*A2**2-B2**2)/6.D0-EX*(A2COR0-108
     1**4-6.D0*A2**2*B2**2+B2**4)/24.D0))                               COR0-109
      X5(2)=-A3-A4-EX*(A3*B4+B3*A4)                                     COR0-110
      X5(4)=-B3-B4+EX*(A3*A4-B3*B4)                                     COR0-111
    6 A2=X5(2)                                                          COR0-112
      B2=X5(4)                                                          COR0-113
      A3=1.D0                                                           COR0-114
      B3=0.D0                                                           COR0-115
      DO 7 J=1,1000                                                     COR0-116
      B4=J                                                              COR0-117
      C1=-X1(2)*(B4*B3-EX*A3)/(B4**2+EX**2)                             COR0-118
      B3=X1(2)*(B4*A3+EX*B3)/(B4**2+EX**2)                              COR0-119
      A3=C1                                                             COR0-120
      C2=(-X1(2)*B2+A3)/B4                                              COR0-121
      B2=(X1(2)*A2+B3)/B4                                               COR0-122
      A2=C2                                                             COR0-123
      X5(2)=X5(2)+A2                                                    COR0-124
      X5(4)=X5(4)+B2                                                    COR0-125
      IF (DABS(A2)+DABS(B2).LT.1.D-12*(DABS(X5(2))+DABS(X5(4)))) GO TO 9COR0-126
    7 CONTINUE                                                          COR0-127
      GO TO 9                                                           COR0-128
    8 X5(4)=-.5D0*PI                                                    COR0-129
      X5(2)=0.D0                                                        COR0-130
    9 DO 11 K=1,4                                                       COR0-131
      DO 10 J=1,4                                                       COR0-132
   10 Y(J,K)=0.D0                                                       COR0-133
   11 CONTINUE                                                          COR0-134
      N=IDINT(DMIN1(A1+DSQRT(A1**2-FI),B1+DSQRT(B1**2-FF))+2.D0)        COR0-135
      A3=0.D0                                                           COR0-136
      B3=0.D0                                                           COR0-137
C LOOP OF THE ASYMPTOTIC EXPANSION.                                     COR0-138
      DO 27 I=1,N                                                       COR0-139
      IF (4*I.GT.LM3) CALL MEMO('COR0',LM3,4*I)                         COR0-140
      A4=DFLOAT(I)-2                                                    COR0-141
      IF (I.EQ.1) GO TO 19                                              COR0-142
      IF (I.EQ.2) GO TO 13                                              COR0-143
      B4=1.D0-.5D0/A4                                                   COR0-144
      X3(1)=EI*B4/A1                                                    COR0-145
      X3(2)=X3(1)                                                       COR0-146
      X3(3)=EF*B4/B1                                                    COR0-147
      X3(4)=X3(3)                                                       COR0-148
      X4(1)=(FI-A4*(A4-1.D0))/(2.D0*A4*A1)                              COR0-149
      X4(2)=(FI-(A4+1.D0)*(A4-2.D0))/(2.D0*A4*A1)                       COR0-150
      X4(3)=(FF-A4*(A4-1.D0))/(2.D0*A4*B1)                              COR0-151
      X4(4)=(FF-(A4+1.D0)*(A4-2.D0))/(2.D0*A4*B1)                       COR0-152
C NEW TERM OF ASYMPTOTIC EXPANSION.                                     COR0-153
      DO 12 J=1,4                                                       COR0-154
      Z(J,2*I-3)=Z(J,2*I-5)*X3(J)-Z(J,2*I-4)*X4(J)                      COR0-155
   12 Z(J,2*I-2)=Z(J,2*I-5)*X4(J)+Z(J,2*I-4)*X3(J)                      COR0-156
   13 DO 16 L=1,2                                                       COR0-157
      DO 15 K=1,2                                                       COR0-158
      DO 14 J=1,2                                                       COR0-159
   14 C(J,K,L)=0.D0                                                     COR0-160
   15 CONTINUE                                                          COR0-161
   16 CONTINUE                                                          COR0-162
C PRODUCT OF THE ASYMPTOTIC EXPANSIONS IN C(1,N,M)+I*C(2,N,M)           COR0-163
C  N=1: H0(+)(EI)*H0(+)(EF)     N=2: H1(+)(EI)*H1(+)(EF)                COR0-164
C  M=1: HL(+)(EI)*HL(+)(EF)     M=2: HL(+)(EI)*HL(+)(EF).               COR0-165
      I1=I-1                                                            COR0-166
      DO 18 J=1,I1                                                      COR0-167
      M=I-J                                                             COR0-168
      DO 17 L=1,2                                                       COR0-169
      C(1,L,1)=C(1,L,1)+Z(L,2*J-1)*Z(L+2,2*M-1)-Z(L,2*J)*Z(L+2,2*M)     COR0-170
      C(2,L,1)=C(2,L,1)+Z(L,2*J-1)*Z(L+2,2*M)+Z(L,2*J)*Z(L+2,2*M-1)     COR0-171
      C(1,L,2)=C(1,L,2)+Z(L,2*J-1)*Z(L+2,2*M-1)+Z(L,2*J)*Z(L+2,2*M)     COR0-172
   17 C(2,L,2)=C(2,L,2)-Z(L,2*J-1)*Z(L+2,2*M)+Z(L,2*J)*Z(L+2,2*M-1)     COR0-173
   18 CONTINUE                                                          COR0-174
   19 B4=A4+2.D0                                                        COR0-175
      A5=0.D0                                                           COR0-176
      B5=0.D0                                                           COR0-177
C INTEGRATION FROM RS TO INFINITY.                                      COR0-178
      DO 26 M=1,2                                                       COR0-179
C TRANSFER OF PREVIOUS INTEGRALS.                                       COR0-180
      X4(M)=X5(M)*RM                                                    COR0-181
      X4(M+2)=X5(M+2)*RM                                                COR0-182
      IF (DABS(X1(M)).LE.2.D0.AND.M.EQ.2) GO TO 23                      COR0-183
C PADE METHOD FOR OMEGA FUNCTION.                                       COR0-184
C INSTEAD OF FORMULA (44), WE COMPUTE I*K*R*OMEGA IN TERMS OF I*K*R.    COR0-185
      A9=B4**2+(X2(M)+X1(M))**2                                         COR0-186
      A6=B4/A9                                                          COR0-187
      B6=-(X2(M)+X1(M))/A9                                              COR0-188
      A7=-B6*X1(M)                                                      COR0-189
      B7=A6*X1(M)                                                       COR0-190
      A8=A6                                                             COR0-191
      B8=B6+1.D0/X1(M)                                                  COR0-192
      B9=1.D0                                                           COR0-193
C STEED'S ALGORITHM.                                                    COR0-194
      DO 20 J=1,1000                                                    COR0-195
      C2=B7+X1(M)/B9                                                    COR0-196
      A9=(A7**2+C2**2)*B9                                               COR0-197
      C1=A7/A9                                                          COR0-198
      C2=-C2/A9                                                         COR0-199
      C3=-(C2*X1(M)+1.D0)*A8-C1*X1(M)*B8                                COR0-200
      C4=C1*X1(M)*A8-B8*(C2*X1(M)+1.D0)                                 COR0-201
      A7=1.D0+C1*(B4+B9)-C2*X2(M)                                       COR0-202
      B7=C1*X2(M)+(B4+B9)*C2                                            COR0-203
      A9=A7**2+B7**2                                                    COR0-204
      A7=A7/A9                                                          COR0-205
      B7=-B7/A9                                                         COR0-206
      A8=(A7-1.D0)*C3-B7*C4                                             COR0-207
      B8=(A7-1.D0)*C4+B7*C3                                             COR0-208
      B9=B9+1.D0                                                        COR0-209
      IF (DABS(C3)+DABS(C4)+DABS(A8)+DABS(B8).LT.1.D-12*(DABS(B6)+DABS(ACOR0-210
     16))) GO TO 21                                                     COR0-211
      A6=A6+A8+C3                                                       COR0-212
   20 B6=B6+B8+C4                                                       COR0-213
   21 X5(M)=0.D0                                                        COR0-214
      X5(M+2)=0.D0                                                      COR0-215
      J=J+1                                                             COR0-216
C DIRECT COMPUTATION OF PADE APPROXIMANT FOR MORE PRECISION.            COR0-217
      DO 22 K=1,J                                                       COR0-218
      C1=1.D0+B9*X5(M)                                                  COR0-219
      C2=B9*X5(M+2)                                                     COR0-220
      A9=C1**2+C2**2                                                    COR0-221
      B9=B9-1.D0                                                        COR0-222
      A7=((B4+B9)*C1+X2(M)*C2)/A9                                       COR0-223
      B7=X1(M)+(C1*X2(M)-C2*(B4+B9))/A9                                 COR0-224
      A9=A7**2+B7**2                                                    COR0-225
      X5(M)=A7/A9                                                       COR0-226
   22 X5(M+2)=-B7/A9                                                    COR0-227
      GO TO 24                                                          COR0-228
C TAYLOR EXPANSION OF CONFLUENT HYPERGEOMETRIC FUNCTION.                COR0-229
   23 IF (I.EQ.1) GO TO 26                                              COR0-230
      A7=1.D0+X1(M)*X5(M+2)                                             COR0-231
      B7=-X1(M)*X5(M)                                                   COR0-232
      A9=((B4-1.D0)**2+X2(M)**2)                                        COR0-233
      X5(M)=(A7*(B4-1.D0)+X2(M)*B7)/A9                                  COR0-234
      X5(M+2)=(B7*(B4-1.D0)-X2(M)*A7)/A9                                COR0-235
   24 IF (I.EQ.1) GO TO 26                                              COR0-236
C STORAGE OF INTEGRALS TO A FACTOR R IN Y(J,M)                          COR0-237
C  J=1 AND J=2  REAL AND IMAGINARY PARTS OF INTEGRAL OF H0(EI)*H0(EF)   COR0-238
C  J=3 AND J=4  REAL AND IMAGINARY PARTS OF INTEGRAL OF H1(EI)*H1(EF)   COR0-239
C  M=1 AND M=2 FOR H*H   M=3 AND M=4 FOR H*H*                           COR0-240
C  M=1 AND M=3 FOR 1/R   M=2 AND M=4 FOR 1/R**2                         COR0-241
      DO 25 J=1,2                                                       COR0-242
      A6=C(1,J,M)*X4(M)-C(2,J,M)*X4(M+2)                                COR0-243
      B6=C(1,J,M)*X4(M+2)+C(2,J,M)*X4(M)                                COR0-244
      A5=DMAX1(A5,A6**2+B6**2)                                          COR0-245
      Y(2*J-1,2*M-1)=Y(2*J-1,2*M-1)+A6                                  COR0-246
      Y(2*J,2*M-1)=Y(2*J,2*M-1)+B6                                      COR0-247
      A3=DMAX1(A3,Y(2*J-1,2*M-1)**2+Y(2*J,2*M-1)**2)                    COR0-248
      A6=C(1,J,M)*X5(M)-C(2,J,M)*X5(M+2)                                COR0-249
      B6=C(1,J,M)*X5(M+2)+C(2,J,M)*X5(M)                                COR0-250
      B5=DMAX1(B5,A6**2+B6**2)                                          COR0-251
      Y(2*J-1,2*M)=Y(2*J-1,2*M)+A6                                      COR0-252
      Y(2*J,2*M)=Y(2*J,2*M)+B6                                          COR0-253
   25 B3=DMAX1(B3,Y(2*J-1,2*M)**2+Y(2*J,2*M)**2)                        COR0-254
   26 CONTINUE                                                          COR0-255
      IF (I.NE.1.AND.A5.LT.A3*1.D-30.AND.B5.LT.B3*1.D-30) GO TO 28      COR0-256
   27 CONTINUE                                                          COR0-257
   28 A1=2.D0*RM                                                        COR0-258
C TRANSFORMATION FROM H(+/-) TO F AND G.                                COR0-259
      DO 29 I=1,4                                                       COR0-260
      CC(1,I)=(YY(2*I-1,2)-YY(2*I-1,1))/A1                              COR0-261
      CC(4,I)=(YY(2*I-1,2)+YY(2*I-1,1))/A1                              COR0-262
      CC(3,I)=(YY(2*I,1)+YY(2*I,2))/A1                                  COR0-263
   29 CC(2,I)=(YY(2*I,1)-YY(2*I,2))/A1                                  COR0-264
      IF (RM.EQ.RS) GO TO 35                                            COR0-265
C IF RM IS NOT RS, 40 POINTS GAUSS INTEGRATION FROM RS TO RM            COR0-266
C EACH GAUSS INTEGRATION IS FOR VARIATION OF R LESS THAN 20.            COR0-267
      IL=1+IDINT(DABS(RM-RS)*.05D0)                                     COR0-268
      A1=DFLOAT(IL)                                                     COR0-269
      A1=(RM-RS)/A1                                                     COR0-270
      A2=RM                                                             COR0-271
      DO 34 IT=1,IL                                                     COR0-272
      A3=A2-A1                                                          COR0-273
      DO 33 II=1,40                                                     COR0-274
      I=MIN0(II,41-II)                                                  COR0-275
      A4=ABSC(I)                                                        COR0-276
      IF (I.NE.II) A4=1.D0-A4                                           COR0-277
      A5=A3+A1*A4                                                       COR0-278
      CALL FCOU(1,EI,A5/FS,Y,Y(1,3),Y(3,1),Y(3,3),IE,X1)                COR0-279
      CALL FCOU(1,EF,A5*FS,Y(1,2),Y(1,4),Y(3,2),Y(3,4),IE,X1)           COR0-280
      DO 32 M=1,2                                                       COR0-281
      DO 31 J=1,2                                                       COR0-282
      DO 30 L=1,2                                                       COR0-283
      A6=P(I)*Y(2*J+M-2,1)*Y(2*L+M-2,2)/A5*A1                           COR0-284
      CC(2*L+J-2,M)=CC(2*L+J-2,M)+A6                                    COR0-285
   30 CC(2*L+J-2,M+2)=CC(2*L+J-2,M+2)+A6/A5                             COR0-286
   31 CONTINUE                                                          COR0-287
   32 CONTINUE                                                          COR0-288
   33 CONTINUE                                                          COR0-289
   34 A2=A3                                                             COR0-290
   35 RETURN                                                            COR0-291
      END                                                               COR0-292
C 27/06/06                                                      ECIS06  CORZ-000
      SUBROUTINE CORZ(XI,XF,T,FGI,FGF,LM1,LM2,LM,W)                     CORZ-001
C    COMPUTATION OF THE INTEGRALS FROM 1 TO INFINITY OF PRODUCTS OF     CORZ-002
C REGULAR OR IRREGULAR BESSEL FUNCTIONS OF SAME L-VALUE AND ARGUMENT    CORZ-003
C XI*R AND XF*R RESPECTIVELY, DIVIDED BY R**3 FOR L=1 TO LM, AND OF     CORZ-004
C INTEGRALS FROM 0 TO INFINITY OF REGULAR FUNCTIONS OF THESE ARGUMENTS  CORZ-005
C DIVIDED BY R**3.                                                      CORZ-006
C    THE LIMIT OF STABILITY OF THE UPWARDS RECURRENCE HAS               CORZ-007
C     BEEN FOUND TO BE   LM2*(1-XI/XF) < 3 .                            CORZ-008
C INPUT:     XI,XF:   WAVE NUMBERS MULTIPLIED BY THE MATCHING RADIUS.   CORZ-009
C            FGI,FGF: REGULAR AND IRREGULAR BESSEL FUNCTIONS.           CORZ-010
C            LM1:     MAXIMUM NUMBER OF INTEGRALS FROM 1 TO INFINITY.   CORZ-011
C            LM2:     NUMBER OF INTEGRALS FROM 0 TO INFINITY.           CORZ-012
C            LM:      ACTUAL NUMBER OF INTEGRALS FROM 1 TO INFINITY.    CORZ-013
C OUTPUT:    T:       INTEGRALS FROM 0 TO INFINITY.                     CORZ-014
C            W:       INTEGRALS FROM RS TO INFINITY.                    CORZ-015
C***********************************************************************CORZ-016
      IMPLICIT REAL*8 (A-H,O-Z)                                         CORZ-017
      DIMENSION T(*),FGI(LM1,*),FGF(LM1,*),W(LM1,*),B(4),C(2),D(2)      CORZ-018
C INTEGRALS FROM 0 TO INFINITY.                                         CORZ-019
C THE RECURRENCE RELATION STARTS FROM L=0 WITH L*(0,3;L)=1/3 FOR L=0.   CORZ-020
      T(1)=1.D0/3.D0                                                    CORZ-021
      IF (XI.NE.XF) GO TO 2                                             CORZ-022
C WHEN KI=KF   (0,3;L)=1/(2*L*(L+1)).                                   CORZ-023
      A1=0.D0                                                           CORZ-024
      DO 1 I=2,LM2                                                      CORZ-025
      A1=A1+1.D0                                                        CORZ-026
    1 T(I)=.5D0/(A1*(A1+1.D0))                                          CORZ-027
      GO TO 11                                                          CORZ-028
    2 X=XI/XF                                                           CORZ-029
      IF (X.GT.1.D0) X=1.D0/X                                           CORZ-030
C (0,3;L) = X**L GT(1/2) GT(L+1)/2/GT(L+3/2) 2F1(L,-1/2;L+3/2;X**2).    CORZ-031
      IF (X.GE..9D0) GO TO 4                                            CORZ-032
C DIRECT EXPANSION OF THE 2F1 FUNCTION.                                 CORZ-033
      A1=X**2                                                           CORZ-034
      T(2)=X/3.D0                                                       CORZ-035
      A2=T(2)                                                           CORZ-036
      A3=0.D0                                                           CORZ-037
      DO 3 J=1,2000                                                     CORZ-038
      A3=A3+1.D0                                                        CORZ-039
      A2=A2*A1*(A3-1.5D0)/(A3+1.5D0)                                    CORZ-040
      T(2)=T(2)+A2                                                      CORZ-041
      IF (DABS(A2).LT.1.D-15*DABS(T(2))) GO TO 6                        CORZ-042
    3 CONTINUE                                                          CORZ-043
      GO TO 6                                                           CORZ-044
C ANALYTIC CONTINUATION OF THE 2F1 FUNCTION - ERDELYI,.... 15.3.11.     CORZ-045
    4 A1=1.D0-X**2                                                      CORZ-046
      A2=X*A1**2/16.D0                                                  CORZ-047
      A3=DLOG(A1/4.D0)+2.D0                                             CORZ-048
      T(2)=X*(2.D0+A1)/8.D0+A2*A3                                       CORZ-049
      A4=0.D0                                                           CORZ-050
      DO 5 J=1,2000                                                     CORZ-051
      A4=A4+1.D0                                                        CORZ-052
      A3=A3-.5D0/((A4+.5D0)*A4)                                         CORZ-053
      A2=A2*A1*(A4+.5D0)/A4                                             CORZ-054
      A5=A2*A3                                                          CORZ-055
      T(2)=T(2)+A5                                                      CORZ-056
      IF (DABS(A5).LT.1.D-15*DABS(T(2))) GO TO 6                        CORZ-057
    5 CONTINUE                                                          CORZ-058
C RECURRENCE RELATION FOR  (0,3;L) :                                    CORZ-059
C  2*(L-1)*(0,3;L-1)-(2*L+1)*(X+1/X)*(0,3;L)+2*(L+2)*(0,3;L+1)=0.       CORZ-060
C UPWARDS RECURRENCE.                                                   CORZ-061
    6 A1=X+1.D0/X                                                       CORZ-062
      XX=LM2*(1-X)                                                      CORZ-063
      IF (XX.GT.3.D0) GO TO 8                                           CORZ-064
      T(3)=.5D0*(A1*T(2)-T(1))                                          CORZ-065
      A2=0.D0                                                           CORZ-066
      DO 7 I=4,LM2                                                      CORZ-067
      A2=A2+1.D0                                                        CORZ-068
    7 T(I)=((A2+1.5D0)*A1*T(I-1)-A2*T(I-2))/(A2+3.D0)                   CORZ-069
      GO TO 11                                                          CORZ-070
C DOWNWARDS RECURRENCE.                                                 CORZ-071
    8 LK=4*LM2                                                          CORZ-072
      A2=DFLOAT(LK-1)                                                   CORZ-073
      A3=A2/(A2+2.D0)                                                   CORZ-074
      DO 9 I=3,LK                                                       CORZ-075
      J=LK-I+3                                                          CORZ-076
      A2=A2-1.D0                                                        CORZ-077
      A3=A2/((A2+1.5D0)*A1-(A2+3.D0)*A3)                                CORZ-078
      IF (J.LE.LM2) T(J)=A3                                             CORZ-079
    9 CONTINUE                                                          CORZ-080
      DO 10 I=3,LM2                                                     CORZ-081
   10 T(I)=T(I)*T(I-1)                                                  CORZ-082
   11 B(1)=XI+XF                                                        CORZ-083
      B(2)=XI-XF                                                        CORZ-084
C COMPUTATION OF THE INTEGRALS FROM 1 TO INFINITY OF EXP(I*B*R)/R**3 DR.CORZ-085
      DO 17 I=1,2                                                       CORZ-086
      IF (B(I).LT.5.D0) GO TO 13                                        CORZ-087
C USE OF PADE APPROXIMANT.                                              CORZ-088
      A1=0.D0                                                           CORZ-089
      A2=0.D0                                                           CORZ-090
      A3=21.D0                                                          CORZ-091
      DO 12 J=1,20                                                      CORZ-092
      A3=A3-1.D0                                                        CORZ-093
      A2=A2-B(I)                                                        CORZ-094
      B1=A1**2+A2**2                                                    CORZ-095
      B2=A1*A3/B1+1.D0                                                  CORZ-096
      B3=-A2*A3/B1                                                      CORZ-097
      B1=B2**2+B3**2                                                    CORZ-098
      A1=B2*(A3+2.D0)/B1                                                CORZ-099
   12 A2=-B3*(A3+2.D0)/B1                                               CORZ-100
      A2=A2-B(I)                                                        CORZ-101
      B1=A1**2+A2**2                                                    CORZ-102
      C(I)=(DCOS(B(I))*A1+DSIN(B(I))*A2)/B1                             CORZ-103
      D(I)=(DSIN(B(I))*A1-DCOS(B(I))*A2)/B1                             CORZ-104
      GO TO 17                                                          CORZ-105
   13 IF (B(I).EQ.0.D0) GO TO 16                                        CORZ-106
C USE OF THE TAYLOR EXPANSION.                                          CORZ-107
      A1=DABS(B(I))                                                     CORZ-108
      C(I)=.5D0*(1.D0-A1**2*(.922784335098467D0-DLOG(A1)))              CORZ-109
      D(I)=A1*(1.D0-.78539816339744831D0*A1)                            CORZ-110
      A2=A1**2/2.D0                                                     CORZ-111
      A3=0.D0                                                           CORZ-112
      DO 14 J=2,20                                                      CORZ-113
      A3=A3+1.D0                                                        CORZ-114
      A2=A2*A1/(2.D0*A3+1.D0)                                           CORZ-115
      D(I)=D(I)+A2/(2.D0*A3-1.D0)                                       CORZ-116
      A2=-A2*A1/(2.D0*A3+2.D0)                                          CORZ-117
      C(I)=C(I)+A2/(2.D0*A3)                                            CORZ-118
      IF (DABS(A2).LT.1.D-16) GO TO 15                                  CORZ-119
   14 CONTINUE                                                          CORZ-120
   15 IF (A1.NE.B(I)) D(I)=-D(I)                                        CORZ-121
      GO TO 17                                                          CORZ-122
   16 C(I)=.5D0                                                         CORZ-123
      D(I)=0.D0                                                         CORZ-124
   17 CONTINUE                                                          CORZ-125
C STORAGE OF THE TWO FIRST INTEGRALS.                                   CORZ-126
      A1=2.D0*XI*XF                                                     CORZ-127
      DO 18 I=1,2                                                       CORZ-128
      W(I,1)=(C(2)-C(1))/A1                                             CORZ-129
      W(I,2)=(D(1)-D(2))/A1                                             CORZ-130
      W(I,3)=(D(1)+D(2))/A1                                             CORZ-131
      W(I,4)=(C(2)+C(1))/A1                                             CORZ-132
      IF (I.EQ.2) GO TO 18                                              CORZ-133
      C(1)=C(1)*B(2)**2+DCOS(B(1))+B(1)*DSIN(B(1))                      CORZ-134
      D(1)=D(1)*B(2)**2+DSIN(B(1))-B(1)*DCOS(B(1))                      CORZ-135
      C(2)=C(2)*B(1)**2+DCOS(B(2))+B(2)*DSIN(B(2))                      CORZ-136
      D(2)=D(2)*B(1)**2+DSIN(B(2))-B(2)*DCOS(B(2))                      CORZ-137
      A1=2.D0*A1**2                                                     CORZ-138
   18 CONTINUE                                                          CORZ-139
C UPWARDS RECURRENCE.                                                   CORZ-140
      A1=XI/XF+XF/XI                                                    CORZ-141
      A2=2.D0*XI*XF                                                     CORZ-142
      A3=2.D0                                                           CORZ-143
      DO 20 J=3,LM                                                      CORZ-144
      A3=A3+1.D0                                                        CORZ-145
      B(2)=(FGI(J-2,3)*FGF(J-2,1)-FGI(J,3)*FGF(J,1))/A2                 CORZ-146
      B(3)=(FGI(J-2,1)*FGF(J-2,3)-FGI(J,1)*FGF(J,3))/A2                 CORZ-147
      B(4)=(FGI(J-2,3)*FGF(J-2,3)-FGI(J,3)*FGF(J,3))/A2                 CORZ-148
      DO 19 I=2,4                                                       CORZ-149
   19 W(J,I)=((A3-1.5D0)*A1*W(J-1,I)-(A3-3.D0)*W(J-2,I)-B(I))/A3        CORZ-150
   20 CONTINUE                                                          CORZ-151
      LN=MAX0(LM,IDINT(DMAX1(XI,XF)))+50                                CORZ-152
      B2=0.D0                                                           CORZ-153
      B3=0.D0                                                           CORZ-154
      C2=0.D0                                                           CORZ-155
      C3=1.D-15                                                         CORZ-156
      D2=0.D0                                                           CORZ-157
      D3=1.D-15                                                         CORZ-158
      A3=LN                                                             CORZ-159
      DO 24 I=2,LN                                                      CORZ-160
      J=LN-I+2                                                          CORZ-161
      A3=A3-1.D0                                                        CORZ-162
      B1=B2                                                             CORZ-163
      B2=B3                                                             CORZ-164
      C1=C2                                                             CORZ-165
      C2=C3                                                             CORZ-166
      D1=D2                                                             CORZ-167
      D2=D3                                                             CORZ-168
      C3=(2.D0*A3+3.D0)*C2/XI-C1                                        CORZ-169
      D3=(2.D0*A3+3.D0)*D2/XF-D1                                        CORZ-170
      B3=((A3+1.5D0)*A1*B2-(A3+3.D0)*B1-(C3*D3-C1*D1)/A2)/A3            CORZ-171
      IF (J.LE.LM) W(J,1)=B3                                            CORZ-172
      IF (D3.LT.1.D15) GO TO 21                                         CORZ-173
      D2=D2*1.D-30                                                      CORZ-174
      D3=D3*1.D-30                                                      CORZ-175
      GO TO 22                                                          CORZ-176
   21 IF (C3.LT.1.D15) GO TO 24                                         CORZ-177
      C2=C2*1.D-30                                                      CORZ-178
      C3=C3*1.D-30                                                      CORZ-179
   22 B2=B2*1.D-30                                                      CORZ-180
      B3=B3*1.D-30                                                      CORZ-181
      IF (J.GT.LM) GO TO 24                                             CORZ-182
      DO 23 K=J,LM                                                      CORZ-183
   23 W(K,1)=W(K,1)*1.D-30                                              CORZ-184
   24 CONTINUE                                                          CORZ-185
      A1=FGI(2,1)*FGF(2,1)/(C3*D3)                                      CORZ-186
      DO 25 I=2,LM                                                      CORZ-187
   25 W(I,1)=W(I,1)*A1+T(I)                                             CORZ-188
      RETURN                                                            CORZ-189
      END                                                               CORZ-190
C 27/02/07                                                      ECIS06  REDM-000
      SUBROUTINE REDM(IPI,NCOLL,NBETA,BETA,IPH,NVAR,VAR,FAC,IDT,LO,NIV,IREDM-001
     1Q,JQ,T,IT,IM)                                                     REDM-002
C REDUCED NUCLEAR MATRIX ELEMENTS.                                      REDM-003
C INPUT:     IPI(J,*):PARITY OF NUCLEAR STATES FOR J=1,                 REDM-004
C                     MULTIPLICITY OF THE PARTICLE FOR J=2,             REDM-005
C                     MULTIPLICITY OF THE TARGET FOR J=3.               REDM-006
C            NCOLL:   NUMBER OF COUPLED STATES                          REDM-007
C            NBETA:   QUANTUM NUMBERS OF DEFORMATIONS.                  REDM-008
C            BETA:    DEFORMATIONS, EQUIVALENT BY CALL WITH NBETA.      REDM-009
C            IPH:     DESCRIPTION OF VIBRATIONAL MODEL (SEE VIBM).      REDM-010
C            NVAR,VAR:EQUIVALENT BY CALL, PARAMETERS FOR SOME MODELS.   REDM-011
C            NVA:     NUMBER OF THESE PARAMETERS.                       REDM-012
C            FAC:     TABLE AND NUMBER OF LOGARITHMS OF FACTORIALS.     REDM-013
C            IDT:     LENGTH AVAILABLE IN THIS SUBROUTINE.              REDM-014
C            LO(I):   LOGICAL CONTROLS:                                 REDM-015
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).REDM-016
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     REDM-017
C                              ROTATIONAL MODEL.                        REDM-018
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    REDM-019
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              REDM-020
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            REDM-021
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      REDM-022
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. REDM-023
C               LO(15) =.TRUE. REDUCED NUCLEAR MATRIX ELEMENTS READ.    REDM-024
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   REDM-025
C               LO(20) =.TRUE. DISPERSION RELATIONS FOR TRANSITION      REDM-026
C                              FORM-FACTORS.                            REDM-027
C               LO(52) =.TRUE. REDUCED NUCLEAR MATRIX ELEMENTS OUTPUT.  REDM-028
C               LO(61) =.TRUE. REDUCED NUCLEAR MATRIX ELEMENTS WRITTEN  REDM-029
C                              ON FILE 61.                              REDM-030
C               LO(100)=.TRUE. DIRAC EQUATION.                          REDM-031
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    REDM-032
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. REDM-033
C               LO(117)=.TRUE. FOR ALL CALCULATIONS EXCEPT THE FIRST.   REDM-034
C               LO(120)=.TRUE. OUTPUT AND LAST CALCULATION BEST ONE.    REDM-035
C               LO(121)=.TRUE. OPTICAL MODEL WITHOUT COUPLING.          REDM-036
C               LO(133)=.TRUE. STORE SCALAR AND COULOMB POTENTIAL       REDM-037
C                              INDEPENDENTLY.                           REDM-038
C OUTPUT:    NIV:     NUMBER AND REFERENCES OF INTERACTION FORM FACTORS REDM-039
C                     BETWEEN EACH CHANNELS. NIV(I1,I2,K): FIRST I OF   REDM-040
C                     T(3,I) FOR THE PAIR OF NUCLEAR STATES I1,I2 FOR   REDM-041
C                     K=1 AND LAST ONE FOR K=2.                         REDM-042
C            IQ,JQ,T: EQUIVALENT BY CALL OF IQ(6,I), JQ(I) AND T(3,I).  REDM-043
C            IT:      NUMBER OF NUCLEAR MATRIX ELEMENTS IN IQ,T. FOR A  REDM-044
C                     GIVEN VALUE OF I:                                 REDM-045
C                     IQ(1,I): REFERENCE TO TABLE OF FORM FACTORS,      REDM-046
C                     IQ(2,I): REFERENCE TO TABLE OF ANGULAR MOMENTA,   REDM-047
C                     IQ(3,I): ADDRESS OF THE ASSOCIATED SPIN-ORBIT FORMREDM-048
C                              FACTOR OR 0,                             REDM-049
C                     IQ(4,I): UNUSED,                                  REDM-050
C                     T(3,I):  REDUCED NUCLEAR MATRIX ELEMENT MULTIPLIEDREDM-051
C                              BY (-)**(L/2) WHERE L IS THE TRANSFERRED REDM-052
C                              ANGULAR MOMENTUM                         REDM-053
C            IM:      NUMBER OF ANGULAR MOMENTA.                        REDM-054
C***********************************************************************REDM-055
C BEYOND IQ(6,IT) ARE STORED IN JQ(*) THE TABLES:                       REDM-056
C            IVQ:     3*"IM" DATA, DESCRIPTION OF ANGULAR MOMENTA:      REDM-057
C                     1) L  TRANSFERRED ANGULAR MOMENTUM,               REDM-058
C                     2) 2*S WHERE S IS THE TRANSFER OF SPIN,           REDM-059
C                     3) 2*J WHERE J IS THE TRANSFER OF TOTAL           REDM-060
C                            SPIN OR 0 IF S=0.                          REDM-061
C            IVY:     7*"INTC", TABLE OF FORM FACTOR INDEPENDENT OF     REDM-062
C                     DISPERSION RELATIONS:                             REDM-063
C                     1) FORM FACTOR CONTROL NUMBER,                    REDM-064
C                     2) REFERENCE TO THE TABLE OF MULTIPOLES,          REDM-065
C                     3) 0 OR ADDRESS OF FIRST SPIN-ORBIT FORM FACTOR,  REDM-066
C                     4) 0 OR ADDRESS OF TEMPORARY COULOMB FORM FACTOR, REDM-067
C                     5) 0 OR ADDRESS OF TEMPORARY COULOMB SPIN-ORBIT,  REDM-068
C                     6) 0 OR ADDRESS OF CORRECTION TERM (POSITIVE FOR  REDM-069
C                        CORRECTED TERM, NEGATIVE FOR CORRECTION TERM), REDM-070
C                     7) ANGULAR MOMENTUM.                              REDM-071
C            IVZ:     4*"INTV" TABLE FORM FACTOR DEPENDENT OF DISPERSIONREDM-072
C                     RELATIONS:                                        REDM-073
C                     1) ADDRESS OF COMPUTATION (WITHOUT DISPERSION),   REDM-074
C                     2) FORM FACTOR CONTROL NUMBER FOR DISPERSION,     REDM-075
C                     3) 0 OR ADDRESS OF THE FIRST SPIN-ORBIT FORM      REDM-076
C                        FACTOR,                                        REDM-077
C                     4) ANGULAR MOMENTUM.                              REDM-078
C "INTC" AND "INTC" ARE IN COMMON /POTE1/. THE ADDRESSES OF THE TABLES  REDM-079
C "IVQ", "IVY" AND "IVZ" ARE DEFINED AFTER RETURN FROM THIS SUBROUTINE. REDM-080
C IF LO(15)=.TRUE. THE REDUCED MATRIX ELEMENTS ARE READ AT THE FIRST    REDM-081
C CALL AND THE PARAMETERS "VAR" ARE NOT USED - IN ANY CASE WHERE "VAR"  REDM-082
C ARE NOT USED,THE SUBROUTINE IS SKIPPED.                               REDM-083
C IF LO(61)=.TRUE. THE MATRIX ELEMENTS ARE PUNCHED AT THE LAST CALL     REDM-084
C OF A SEARCH IN THIS SUBROUTINE.                                       REDM-085
C***********************************************************************REDM-086
C                                                                       REDM-087
C THE COMMON /POTE2/ IS USED IN CALC, LECL, REDM, CAL1, POTE, QUAN,     REDM-088
C                               MTCH, INTI, INSH, INSI, INCH AND REST.  REDM-089
C THE COMMON /POTE1/ IS USED IN CALC, REDM, EXTP, POTE, ROTP, STDP,     REDM-090
C                               FOLD AND REST.                          REDM-091
C FOR THE COMMON  /COUPL/ SEE CALC.                                     REDM-092
C                                                                       REDM-093
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     REDM-094
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           REDM-095
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             REDM-096
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             REDM-097
C   USED:     NBT1,NPP,NVA.                                             REDM-098
C                                                                       REDM-099
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE1/:                     REDM-100
C  ITX(16):   STARTING ADDRESS OF DIFFERENT FORM FACTORS.               REDM-101
C             FOR SCHROEDINGER EQUATION, ITX(I)+1 IS THE STARTING       REDM-102
C             ADDRESS OF THE FORM FACTOR READ IN EXTP WITH ITYP=I       REDM-103
C             (POTENTIAL FOR I=1 TO 8, TRANSITION FOR I=9 TO 16).       REDM-104
C             FOR DIRAC EQUATIONS, ITX(1)=0,                            REDM-105
C             ITX(2)+1=ADDRESS OFF FIRST TRANSITION FORM FACTOR,        REDM-106
C             ITX(7)=ADDRESS OF LAST TRANSITION FORM FACTOR,            REDM-107
C             ITX(3)=ADDRESS OF LAST TEMPORARY CENTRAL POTENTIAL,       REDM-108
C             ITX(4)=ITX(7)-24,ITX(5)=ITX(3)-11,ITX(6)=ITX(2)-4.        REDM-109
C             ALL ARE USED FOR SCHROEDINGER, THE FIRST 8 FOR DIRAC.     REDM-110
C  IMAX:      MAXIMUM ANGULAR MOMENTUM.                                 REDM-111
C  INTC:      NUMBER OF FORM FACTORS WITHOUT DEFORMED SPIN-ORBIT        REDM-112
C             INCLUDING CORRECTION TERMS.                               REDM-113
C  INLS:      NUMBER OF SPIN-ORBIT FORM FACTORS NOT TAKING INTO ACCOUNT REDM-114
C             MULTIPLICATION BY 2.                                      REDM-115
C  INVC:      NUMBER OF COULOMB TRANSITION FORM FACTORS.                REDM-116
C  INVD:      IDEM FOR COULOMB SPIN-ORBIT.                              REDM-117
C  ITXM:      TOTAL NUMBER OF FORM FACTORS.                             REDM-118
C   DEFINED:  ITX,IMAX,INTC,INLS,INVC,INVD,ITXM.                        REDM-119
C                                                                       REDM-120
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     REDM-121
C  ITY(1):    STARTING ADDRESS OF REAL CENTRAL POTENTIAL (IT IS 0).     REDM-122
C  ITY(2):    STARTING ADDRESS OF IMAGINARY CENTRAL POTENTIAL.          REDM-123
C  ITY(3):    STARTING ADDRESS OF REAL SPIN-ORBIT POTENTIAL.            REDM-124
C  ITY(4):    STARTING ADDRESS OF IMAGINARY SPIN-ORBIT POTENTIAL.       REDM-125
C  ITY(5):    STARTING ADDRESS OF REAL CENTRAL TRANSITION.              REDM-126
C  ITY(6):    STARTING ADDRESS OF IMAGINARY CENTRAL TRANSITION.         REDM-127
C  ITY(7):    STARTING ADDRESS OF REAL SPIN-ORBIT TRANSITION.           REDM-128
C  ITY(8):    STARTING ADDRESS OF IMAGINARY SPIN-ORBIT TRANSITION.      REDM-129
C  ITY(9):    STARTING ADDRESS OF COULOMB CENTRAL POTENTIAL.            REDM-130
C  ITY(10):   STARTING ADDRESS OF COULOMB SPIN-ORBIT POTENTIAL.         REDM-131
C  ITY(11):   STARTING ADDRESS OF COULOMB CENTRAL TRANSITION.           REDM-132
C  ITY(12):   STARTING ADDRESS OF COULOMB SPIN-ORBIT TRANSITION.        REDM-133
C        ITY(2)=14*NCOLL AND ITY(5)=0 ONLY ARE USED FOR DIRAC EQUATIONS.REDM-134
C  INVT:      NUMBER OF TRANSITION FORM FACTORS WITHOUT SPIN-ORBIT.     REDM-135
C  INTV:      SAME AS INVT, TAKING INTO ACCOUNT DISPERSION.             REDM-136
C  INSL:      NUMBER OF SPIN-ORBIT FORM TRANSITION FACTORS NOT TAKING   REDM-137
C                  INTO ACCOUNT MULTIPLICATION BY 2.                    REDM-138
C  NPX:       NUMBER OF POTENTIALS TAKING INTO ACCOUNT DISPERSION.      REDM-139
C   DEFINED:  ITY,INVT,INTV,INSL.                                       REDM-140
C   USED:     ITY,INVT,INTV,INSL,NPX.                                   REDM-141
C                                                                       REDM-142
C***********************************************************************REDM-143
      IMPLICIT REAL*8 (A-H,O-Z)                                         REDM-144
      LOGICAL LO(150),LT                                                REDM-145
      DIMENSION NIV(NCOLL,NCOLL,*),IQ(6,*),JQ(*),T(3,*),IPI(11,*),NBETA(REDM-146
     118,*),BETA(9,*),IPH(2,*),NVAR(2,*),VAR(*),FAC(*)                  REDM-147
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   REDM-148
      COMMON /INOUT/ MR,MW,MS                                           REDM-149
      COMMON /POTE1/ ITX(16),IMAX,INTC,INLS,INVC,INVD,ITXM              REDM-150
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         REDM-151
      IF (LO(120)) GO TO 42                                             REDM-152
      IF (LO(7).OR.LO(15)) GO TO 3                                      REDM-153
C STANDARD COMPUTATION OF THE REDUCED MATRIX ELEMENTS IN T(3,I)         REDM-154
C WITH FORM FACTOR IDENTIFICATION IN IQ(1,I), MULTIPOLE IN IQ(2,I)      REDM-155
C AND 0 OR 1 IN IQ(3,I) IF SPIN-ORBIT IS NOT OR IS DEFORMED.            REDM-156
C THEY ARE CALLED AT THE FIRST RUN OR IF "VAR" HAS BEEN CHANGED.        REDM-157
      IF (LO(1)) GO TO 1                                                REDM-158
      CALL VIBM(NIV,IQ,T,IPI,NCOLL,IT,IPH,NVAR,VAR,NBETA,FAC,IDT,LO)    REDM-159
      GO TO 17                                                          REDM-160
    1 IF (LO(3)) GO TO 2                                                REDM-161
      CALL ROTM(NIV,IQ,T,IPI,NCOLL,IPH,NBETA,NVAR,VAR,IT,FAC,IDT,LO)    REDM-162
      GO TO 17                                                          REDM-163
    2 CALL ROAM(NIV,IQ,T,IPI,NCOLL,IT,BETA,IPH,VAR,VAR(NVA+1),FAC,IDT,LOREDM-164
     1)                                                                 REDM-165
      GO TO 17                                                          REDM-166
C INPUT OF NUCLEAR MATRIX ELEMENTS FROM CARDS.                          REDM-167
    3 IF (LO(117)) GO TO 42                                             REDM-168
      IT=0                                                              REDM-169
      I=0                                                               REDM-170
      DO 16 I1=1,NCOLL                                                  REDM-171
      DO 15 I2=I1,NCOLL                                                 REDM-172
      NIV(I1,I2,1)=IT+1                                                 REDM-173
      READ (MR,1000) J1,J2,K                                            REDM-174
      WRITE (MW,1001) J1,J2,K                                           REDM-175
      IF ((J1.NE.I1).OR.(J2.NE.I2)) GO TO 46                            REDM-176
      IF (K.EQ.0) GO TO 15                                              REDM-177
      IJL=IABS(IPI(3,I1)-IPI(3,I2))                                     REDM-178
      JIL=(IPI(3,I1)+IPI(3,I2))                                         REDM-179
      IJS=IABS(IPI(2,I1)-IPI(2,I2))                                     REDM-180
      JIS=IPI(2,I1)+IPI(2,I2)                                           REDM-181
      IF (2*(IT+K).GT.IDT) CALL MEMO('REDM',IDT,2*(IT+K))               REDM-182
      DO 14 K1=1,K                                                      REDM-183
      IT=IT+1                                                           REDM-184
      READ (MR,1002) J,IQ(2,IT),NN,M,T(3,IT)                            REDM-185
      IF (NN.EQ.-1.AND.(.NOT.LO(11))) GO TO 47                          REDM-186
      N=NN                                                              REDM-187
      IF (NN.EQ.-1) N=0                                                 REDM-188
      IF (MOD(IQ(2,IT)+IPI(1,I1)+IPI(1,I2),2).NE.0) GO TO 48            REDM-189
      IF ((N.GT.JIS).OR.(N.LT.IJS).OR.(MOD(JIS+N,2).NE.0)) GO TO 49     REDM-190
      IF (LO(7)) GO TO 7                                                REDM-191
      IF (LO(1)) GO TO 5                                                REDM-192
      IF (LO(3)) GO TO 4                                                REDM-193
      IQP=J/(NBT1+1)                                                    REDM-194
      IPQ=MOD(J,NBT1+1)                                                 REDM-195
      IF ((IPQ.LE.0).OR.(MAX0(IPQ,IQP).GT.NBT1).OR.(IQP.LT.0)) GO TO 50 REDM-196
      GO TO 11                                                          REDM-197
    4 IF (J.LT.0.OR.J.GT.3) GO TO 51                                    REDM-198
      GO TO 11                                                          REDM-199
    5 IQP=J/1000                                                        REDM-200
      IF (LO(3)) GO TO 6                                                REDM-201
      IF (IQP.NE.1+IQ(2,IT)) GO TO 52                                   REDM-202
      GO TO 11                                                          REDM-203
    6 IQY=IQ(2,IT)/2+1                                                  REDM-204
      IQZ=(IQY*(IQY-1))/2                                               REDM-205
      IF (IQP.LE.IQZ.OR.IQP.GT.IQZ+IQY) GO TO 53                        REDM-206
      GO TO 11                                                          REDM-207
    7 IF (J.EQ.0) GO TO 10                                              REDM-208
      IF (IABS(J)-I-1) 8 , 10 , 54                                      REDM-209
    8 IF (IT.EQ.1) GO TO 11                                             REDM-210
      DO 9 II=2,IT                                                      REDM-211
      IF (J.EQ.IQ(1,II-1)) GO TO 11                                     REDM-212
    9 CONTINUE                                                          REDM-213
      GO TO 55                                                          REDM-214
   10 I=I+1                                                             REDM-215
      IF (J.EQ.0) J=I                                                   REDM-216
   11 IQ(1,IT)=J                                                        REDM-217
      IF (N.EQ.0) GO TO 12                                              REDM-218
      IF (2*IQ(2,IT).LT.IABS(N-M).OR.2*IQ(2,IT).GT.N+M.OR.MOD(N+M,2).NE.REDM-219
     10) GO TO 56                                                       REDM-220
      NM=M                                                              REDM-221
      IQ(3,IT)=10*M+10000*N                                             REDM-222
      GO TO 13                                                          REDM-223
   12 IF (M.LT.0) GO TO 57                                              REDM-224
      IQ(3,IT)=10*M                                                     REDM-225
      NM=2*IQ(2,IT)                                                     REDM-226
   13 IF (NM.LT.IJL.OR.NM.GT.JIL) GO TO 58                              REDM-227
      IF (NN.EQ.-1) IQ(3,IT)=IQ(3,IT)+1                                 REDM-228
   14 WRITE (MW,1003) IQ(1,IT),IQ(2,IT),NN,M,T(3,IT)                    REDM-229
   15 NIV(I1,I2,2)=IT                                                   REDM-230
   16 CONTINUE                                                          REDM-231
   17 K=NIV(NCOLL,NCOLL,2)                                              REDM-232
      DO 19 I1=1,NCOLL                                                  REDM-233
      DO 18 I2=I1,NCOLL                                                 REDM-234
      NIV(I2,I1,1)=NIV(I1,I2,1)                                         REDM-235
      NIV(I2,I1,2)=NIV(I1,I2,2)                                         REDM-236
   18 CONTINUE                                                          REDM-237
   19 CONTINUE                                                          REDM-238
C CHECK THAT THERE IS ENOUGH PLACE.                                     REDM-239
      IF (7*IT.GT.IDT) CALL MEMO('REDM',IDT,7*IT)                       REDM-240
      IM=0                                                              REDM-241
      INVT=0                                                            REDM-242
      INTV=0                                                            REDM-243
      INLS=0                                                            REDM-244
      INSL=0                                                            REDM-245
      INVC=0                                                            REDM-246
      INVD=0                                                            REDM-247
      INTC=0                                                            REDM-248
      IMAX=0                                                            REDM-249
C TABLE OF MULTIPOLES.                                                  REDM-250
      IF (IT.EQ.0) GO TO 40                                             REDM-251
      ITN=6*IT                                                          REDM-252
      DO 23 J=1,IT                                                      REDM-253
      IS=IQ(3,J)/10000                                                  REDM-254
      IJ=MOD(IQ(3,J),1000)/10                                           REDM-255
      IL=MOD(IQ(3,J),10)                                                REDM-256
      IF (IS.EQ.0) IJ=2*IQ(2,J)                                         REDM-257
      IF (IJ.EQ.0) IS=2*IQ(2,J)                                         REDM-258
      IF (IL.EQ.1) IS=-2                                                REDM-259
      IF (IS.NE.0) IQ(3,J)=0                                            REDM-260
      IF (IM.EQ.0) GO TO 21                                             REDM-261
      DO 20 K=1,IM,3                                                    REDM-262
      IF ((JQ(ITN+K).EQ.IQ(2,J)).AND.(JQ(ITN+K+1).EQ.IS).AND.(JQ(ITN+K+2REDM-263
     1).EQ.IJ)) GO TO 22                                                REDM-264
   20 CONTINUE                                                          REDM-265
   21 JQ(ITN+IM+1)=IQ(2,J)                                              REDM-266
      JQ(ITN+IM+2)=IS                                                   REDM-267
      JQ(ITN+IM+3)=IJ                                                   REDM-268
      IMAX=MAX0(IMAX,IQ(2,J))                                           REDM-269
      IM=IM+3                                                           REDM-270
      IQ(2,J)=IM/3                                                      REDM-271
      GO TO 23                                                          REDM-272
   22 IQ(2,J)=1+K/3                                                     REDM-273
   23 CONTINUE                                                          REDM-274
      ITM=ITN+IM+MOD(IM,2)                                              REDM-275
C TABLE OF FORM FACTORS.                                                REDM-276
C LT IS TRUE IF THE MULTIPOLE ORDER MATTERS FOR FORM FACTORS.           REDM-277
      LT=(LO(1).OR.LO(11).OR.LO(17).OR.LO(19)).AND.(.NOT.LO(7))         REDM-278
      DO 26 J=1,IT                                                      REDM-279
      IF (INVT.EQ.0) GO TO 25                                           REDM-280
      DO 24 L=1,INVT,7                                                  REDM-281
      IF (JQ(ITM+L).NE.IQ(1,J)) GO TO 24                                REDM-282
      IF (LT.AND.(JQ(ITM+L+1).NE.IQ(2,J))) GO TO 24                     REDM-283
      IQ(1,J)=1+L/7                                                     REDM-284
      JQ(ITM+L+2)=MAX0(IQ(3,J),JQ(ITM+L+2))                             REDM-285
      GO TO 26                                                          REDM-286
   24 CONTINUE                                                          REDM-287
   25 K=IQ(2,J)                                                         REDM-288
      K1=JQ(ITN+3*K-2)                                                  REDM-289
      JQ(ITM+INVT+1)=IQ(1,J)                                            REDM-290
      JQ(ITM+INVT+2)=K                                                  REDM-291
      JQ(ITM+INVT+3)=IQ(3,J)                                            REDM-292
      JQ(ITM+INVT+4)=0                                                  REDM-293
      JQ(ITM+INVT+5)=0                                                  REDM-294
      JQ(ITM+INVT+6)=0                                                  REDM-295
      JQ(ITM+INVT+7)=K1                                                 REDM-296
      IF ((IQ(1,J).LT.0).OR.((IQ(1,J).GT.1000).AND.(K1.LE.1).AND.(MOD(IQREDM-297
     1(1,J),1000).NE.0))) JQ(ITM+INVT+6)=1                              REDM-298
      IF (LO(11).AND.(MOD(JQ(ITN+3*K-1),2).EQ.0)) JQ(ITM+INVT+4)=1      REDM-299
      IF (LO(19)) JQ(ITM+INVT+5)=JQ(ITM+INVT+3)                         REDM-300
      INVT=INVT+7                                                       REDM-301
      IQ(1,J)=INVT/7                                                    REDM-302
   26 CONTINUE                                                          REDM-303
C SEARCH ON CORRECTION TERMS.                                           REDM-304
      INTC=INVT                                                         REDM-305
      DO 28 J=1,INVT,7                                                  REDM-306
      IF (JQ(ITM+J+5).EQ.0) GO TO 28                                    REDM-307
      K1=ITM+J-1                                                        REDM-308
      DO 27 L=1,7                                                       REDM-309
   27 JQ(ITM+INTC+L)=JQ(K1+L)                                           REDM-310
      JQ(ITM+INTC+6)=-(1+J/7)                                           REDM-311
      INTC=INTC+7                                                       REDM-312
      JQ(K1+6)=INTC/7                                                   REDM-313
   28 CONTINUE                                                          REDM-314
      DO 30 J=1,INTC,7                                                  REDM-315
      IF (JQ(ITM+J+3).EQ.0) GO TO 29                                    REDM-316
      INVC=INVC+1                                                       REDM-317
      JQ(ITM+J+3)=INVC                                                  REDM-318
   29 IF ((JQ(ITM+J+2).EQ.0).AND.(JQ(ITM+J+4).EQ.0)) GO TO 30           REDM-319
      INLS=INLS+1                                                       REDM-320
      JQ(ITM+J+2)=INLS                                                  REDM-321
      IF (JQ(ITM+J+4).EQ.0) GO TO 30                                    REDM-322
      INVD=INVD+1                                                       REDM-323
      JQ(ITM+J+4)=INVD                                                  REDM-324
   30 CONTINUE                                                          REDM-325
      ITP=ITM+INTC+MOD(INTC,2)                                          REDM-326
      NTC=INVT/7                                                        REDM-327
      DO 31 J=1,NTC                                                     REDM-328
      JQ(ITP+4*J-3)=J                                                   REDM-329
      JQ(ITP+4*J-2)=0                                                   REDM-330
      JQ(ITP+4*J-1)=JQ(ITM+7*J-4)                                       REDM-331
      JQ(ITP+4*J)=JQ(ITM+7*J)                                           REDM-332
   31 CONTINUE                                                          REDM-333
      INTV=4*NTC                                                        REDM-334
      IF (.NOT.LO(20)) GO TO 37                                         REDM-335
      DO 36 I1=1,NCOLL                                                  REDM-336
      DO 35 I2=I1,NCOLL                                                 REDM-337
      K1=NIV(I1,I2,1)                                                   REDM-338
      K2=NIV(I1,I2,2)                                                   REDM-339
      IF (K1.GT.K2) GO TO 35                                            REDM-340
      KK=I1*(NCOLL+1)+I2                                                REDM-341
      DO 34 K=K1,K2                                                     REDM-342
      J=IQ(1,K)                                                         REDM-343
      IF (JQ(ITP+4*J-2).NE.0) GO TO 32                                  REDM-344
      JQ(ITP+4*J-2)=KK                                                  REDM-345
      GO TO 34                                                          REDM-346
   32 DO 33 L=1,4                                                       REDM-347
   33 JQ(ITP+INTV+L)=JQ(ITP+4*J+L-4)                                    REDM-348
      JQ(ITP+INTV+2)=KK                                                 REDM-349
      INTV=INTV+4                                                       REDM-350
      IQ(1,K)=INTV/4                                                    REDM-351
   34 CONTINUE                                                          REDM-352
   35 CONTINUE                                                          REDM-353
   36 CONTINUE                                                          REDM-354
   37 IM=IM/3                                                           REDM-355
      INTV=INTV/4                                                       REDM-356
      INVT=INVT/7                                                       REDM-357
      INTC=INTC/7                                                       REDM-358
      INSL=0                                                            REDM-359
      DO 39 J=1,INTV                                                    REDM-360
      L=JQ(ITP+4*J-1)                                                   REDM-361
      INSL=MAX0(INSL,L)                                                 REDM-362
      DO 38 K=1,IT                                                      REDM-363
      IF (IQ(1,K).EQ.J) IQ(3,K)=L                                       REDM-364
   38 CONTINUE                                                          REDM-365
   39 CONTINUE                                                          REDM-366
C NUMBER OF REAL AND IMAGINARY FORM FACTORS.                            REDM-367
   40 NV=INTC                                                           REDM-368
      IF (LO(13).OR.LO(19)) NV=NV+2*INLS                                REDM-369
      ITY(1)=0                                                          REDM-370
      LO(121)=IM.EQ.0                                                   REDM-371
      IF (LO(100)) GO TO 41                                             REDM-372
      ITY(3)=NPX                                                        REDM-373
      ITY(5)=ITY(3)+NPX                                                 REDM-374
      IF (.NOT.(LO(101).OR.LO(103))) ITY(5)=ITY(3)                      REDM-375
      ITY(7)=ITY(5)+INTV                                                REDM-376
      ITY(2)=ITY(7)+2*INSL                                              REDM-377
      ITY(4)=ITY(2)+NPX                                                 REDM-378
      ITY(6)=ITY(4)+NPX                                                 REDM-379
      IF (.NOT.(LO(101).OR.LO(103))) ITY(6)=ITY(4)                      REDM-380
      ITY(8)=ITY(6)+INTV                                                REDM-381
      IF (.NOT.LO(12)) ITY(8)=ITY(6)                                    REDM-382
      ITX1=ITY(8)+2*INSL                                                REDM-383
      IF (.NOT.LO(14)) ITX1=ITY(8)                                      REDM-384
      INTXC=ITX1                                                        REDM-385
      IF (.NOT.LO(133)) INTXC=0                                         REDM-386
      ITY(9)=ITY(1)+INTXC                                               REDM-387
      ITY(10)=ITY(3)+INTXC                                              REDM-388
      ITY(11)=ITY(5)+INTXC                                              REDM-389
      ITY(12)=ITY(7)+INTXC                                              REDM-390
      IF (.NOT.(LO(103).OR.LO(11).OR.LO(19))) ITY(11)=ITY(10)           REDM-391
      IF (.NOT.(LO(11).OR.LO(19))) ITY(12)=ITY(11)                      REDM-392
      ITX2=ITY(12)+2*INSL                                               REDM-393
      IF (.NOT.LO(19)) ITX2=ITY(12)                                     REDM-394
      ITX(1)=MAX0(ITX1,ITX2)                                            REDM-395
      ITX(5)=ITX(1)+NPP                                                 REDM-396
      ITX(9)=ITX(5)+NPP                                                 REDM-397
      IF (.NOT.(LO(101).OR.LO(103))) ITX(9)=ITX(5)                      REDM-398
      ITX(13)=ITX(9)+INTC                                               REDM-399
      ITX(2)=ITX(13)+2*INLS                                             REDM-400
      ITX(6)=ITX(2)+NPP                                                 REDM-401
      ITX(10)=ITX(6)+NPP                                                REDM-402
      IF (.NOT.(LO(101).OR.LO(103))) ITX(10)=ITX(6)                     REDM-403
      ITX(14)=ITX(10)+INTC                                              REDM-404
      ITX(7)=ITX(14)+2*INLS                                             REDM-405
      IF (.NOT.LO(14)) ITX(7)=ITX(14)                                   REDM-406
      IF (.NOT.LO(12)) ITX(7)=ITX(10)                                   REDM-407
      ITX(8)=ITX(7)+NPP                                                 REDM-408
      ITX(3)=ITX(8)+NPP                                                 REDM-409
      ITX(4)=ITX(3)+NPP                                                 REDM-410
      ITX(11)=ITX(4)+NPP                                                REDM-411
      ITX(12)=ITX(11)+INTC                                              REDM-412
      ITX(15)=ITX(12)+INTC                                              REDM-413
      IF (.NOT.LO(12)) ITX(15)=ITX(12)                                  REDM-414
      ITX(16)=ITX(15)+INVC                                              REDM-415
      ITXM=ITX(16)+2*INVD+INTC                                          REDM-416
      GO TO 42                                                          REDM-417
   41 ITY(5)=0                                                          REDM-418
      ITX(1)=0                                                          REDM-419
      ITX(2)=14*NCOLL                                                   REDM-420
      ITY(2)=ITX(2)                                                     REDM-421
      ITX(7)=ITX(2)+4*(INTV+INSL)                                       REDM-422
      ITX(3)=ITX(7)+24*NPP                                              REDM-423
      ITX(4)=ITX(7)-24                                                  REDM-424
      ITX(5)=ITX(3)-11                                                  REDM-425
      ITX(6)=ITX(2)-4                                                   REDM-426
      ITXM=ITX(3)+11*INTC                                               REDM-427
   42 IF (.NOT.(LO(52).OR.LO(61))) RETURN                               REDM-428
C REDUCED MATRIX ELEMENTS PUNCHED ON CARDS ON REQUEST.                  REDM-429
C OUTPUT OF REDUCED MATRIX ELEMENTS ON REQUEST.                         REDM-430
      IT=NIV(NCOLL,NCOLL,2)                                             REDM-431
      ITM=6*IT-3                                                        REDM-432
      ITN=ITM+3*IM-4+MOD(IM,2)                                          REDM-433
      IF (LO(52)) WRITE (MW,1004)                                       REDM-434
      DO 45 I1=1,NCOLL                                                  REDM-435
      DO 44 I2=I1,NCOLL                                                 REDM-436
      K1=NIV(I1,I2,1)                                                   REDM-437
      K2=NIV(I1,I2,2)                                                   REDM-438
      IF (LO(52)) WRITE (MW,1005) I1,I2,K1,K2                           REDM-439
      K=K2-K1+1                                                         REDM-440
      IF (LO(61)) WRITE (61,1000) I1,I2,K                               REDM-441
      IF (K.EQ.0) GO TO 44                                              REDM-442
      DO 43 K=K1,K2                                                     REDM-443
      IF (LO(52)) WRITE (MW,1006) K,(IQ(J,K),J=1,3),T(3,K)              REDM-444
      IF (.NOT.LO(61)) GO TO 43                                         REDM-445
      M=IQ(2,K)                                                         REDM-446
      NM=JQ(ITN+7*M+1)                                                  REDM-447
      NS=JQ(ITM+3*M+2)                                                  REDM-448
      NJ=JQ(ITM+3*M+3)                                                  REDM-449
      IF (NS.LE.0) NJ=0                                                 REDM-450
      IF (NS.EQ.-2) NS=-1                                               REDM-451
      IF (NJ.EQ.0.AND.IQ(3,K).NE.0) NJ=1                                REDM-452
      WRITE (61,1007) NM,JQ(ITM+3*M+1),NS,NJ,T(3,K)                     REDM-453
   43 CONTINUE                                                          REDM-454
   44 CONTINUE                                                          REDM-455
   45 CONTINUE                                                          REDM-456
      IF (IT.EQ.0.OR.(.NOT.LO(52))) RETURN                              REDM-457
      WRITE (MW,1008) (I,(JQ(ITM+3*I+J),J=1,3),I=1,IM)                  REDM-458
      WRITE (MW,1009) (I,(JQ(ITN+7*I+J),J=1,7),I=1,INTC)                REDM-459
      ITP=ITN+7*INTC+3+MOD(INTC,2)                                      REDM-460
      WRITE (MW,1010) (I,(JQ(ITP+4*I+J),J=1,4),I=1,INTV)                REDM-461
      RETURN                                                            REDM-462
   46 WRITE (MW,1011) J1,J2,I1,I2                                       REDM-463
      GO TO 59                                                          REDM-464
   47 WRITE (MW,1012) NN                                                REDM-465
      GO TO 59                                                          REDM-466
   48 WRITE (MW,1013) IQ(2,IT),IPI(1,I1),IPI(1,I2)                      REDM-467
      GO TO 59                                                          REDM-468
   49 WRITE (MW,1014)                                                   REDM-469
      GO TO 59                                                          REDM-470
   50 WRITE (MW,1015)                                                   REDM-471
      GO TO 59                                                          REDM-472
   51 WRITE (MW,1016)                                                   REDM-473
      GO TO 59                                                          REDM-474
   52 WRITE (MW,1017)                                                   REDM-475
      GO TO 59                                                          REDM-476
   53 WRITE (MW,1018) N,IJS,JIS                                         REDM-477
      GO TO 59                                                          REDM-478
   54 WRITE (MW,1019) I,J                                               REDM-479
      GO TO 59                                                          REDM-480
   55 WRITE (MW,1020) J                                                 REDM-481
      GO TO 59                                                          REDM-482
   56 WRITE (MW,1021) M,IQ(2,IT),N                                      REDM-483
      GO TO 59                                                          REDM-484
   57 WRITE (MW,1022) M                                                 REDM-485
      GO TO 59                                                          REDM-486
   58 WRITE (MW,1023) NM,IJL,JIL                                        REDM-487
      GO TO 59                                                          REDM-488
   59 WRITE (MW,1024)                                                   REDM-489
      STOP                                                              REDM-490
 1000 FORMAT (3I5)                                                      REDM-491
 1001 FORMAT (' FOR I =',I4,'  AND IP =',I4,I8,' REDUCED MATRIX ELEMENTSREDM-492
     1')                                                                REDM-493
 1002 FORMAT (4I5,F20.12)                                               REDM-494
 1003 FORMAT (10X,'FORM FACTOR =',I4,' L =',I4,4X,'2*S =',I4,4X,'2*J =',REDM-495
     1I4,4X,' REDUCED MATRIX ELEMENT',D20.6)                            REDM-496
 1004 FORMAT (//' NUCLEAR REDUCED MATRIX ELEMENTS:'/)                   REDM-497
 1005 FORMAT (/' STATE',I3,'  WITH STATE',I3,10X,' FROM',I4,' TO',I4/)  REDM-498
 1006 FORMAT (10X,'N =',I3,3X,'FORM FACTOR =',I3,3X,'MULT. =',I3,3X,'SP.REDM-499
     1-O. =',I3,6X,'MATRIX ELEMENT',1P,D15.6)                           REDM-500
 1007 FORMAT (4I5,F20.12)                                               REDM-501
 1008 FORMAT (//5X,' CORRESPONDENCE TO MULTIPOLES:'//(20X,'N =',I3,5X,'LREDM-502
     1 =',I3,5X,'2*S =',I3,5X,'2*J =',I3))                              REDM-503
 1009 FORMAT (//4X,' CORRESPONDENCE TO FORM FACTORS IN THEIR COMPUTATIONREDM-504
     1:'//(10X,'N =',I3,4X,'F.F. =',I6,4X,'MULT. =',I4,4X,'SP.-O. =',I4,REDM-505
     24X,'COUL =',I4,4X,'SPDO =',I4,4X,'COR =',I4,4X,'L =',I4))         REDM-506
 1010 FORMAT (//4X,' CORRESPONDENCE TO FORM FACTORS IN THEIR USE:'//(10XREDM-507
     1,'N =',I3,4X,'ABOVE =',I4,4X,'DISP. =',I4,4X,'SP.-O. =',I4,4X,'L =REDM-508
     2',I4))                                                            REDM-509
 1011 FORMAT (//' INCORRECT ORDER OF INPUT FOR REDUCED MATRIX ELEMENTS :REDM-510
     1',2I6,' INSTEAD OF',2I6)                                          REDM-511
 1012 FORMAT (//' A MAGNETIC COULOMB INTERACTION CANNOT BE USED IF THE CREDM-512
     1OULOMB INTERACTION IS NOT DEFORMED:',I3)                          REDM-513
 1013 FORMAT (/' MULTIPOLE ORDER',I4,' NOT OF THE SAME PARITY AS',2I4)  REDM-514
 1014 FORMAT (' ERROR FOR HARMONIC VIBRATIONAL MODEL.')                 REDM-515
 1015 FORMAT (' ERROR FOR ANHARMONIC VIBRATIONAL MODEL.')               REDM-516
 1016 FORMAT (' ERROR FOR SYMMETRIC ROTATIONAL MODEL.')                 REDM-517
 1017 FORMAT (' ERROR FOR ASYMMETRIC ROTATIONAL MODEL.')                REDM-518
 1018 FORMAT (/' 2*S =',I4,' INCORRECT BETWEEN CHANNELS WITH 2*S =',2I4)REDM-519
 1019 FORMAT (/' LAST FORM FACTOR IDENTIFICATION',I3,'  NEW FORM FACTOR REDM-520
     1IDENTIFICATION',I3,'  TOO LARGE.')                                REDM-521
 1020 FORMAT (/' LAST FORM FACTOR IDENTIFICATION',I3,'  WAS NOT ALREADY REDM-522
     1READ WITH THIS SIGN.')                                            REDM-523
 1021 FORMAT (/' 2*J =',I4,' INCORRECT WITH L =',I4,' AND 2*S =',I4)    REDM-524
 1022 FORMAT (/' J-VALUE =',I4,'  USED AS DEFORMED SPIN-ORBIT CONTROL INREDM-525
     1CORRECT. LIMIT:',I2)                                              REDM-526
 1023 FORMAT (/' 2*TRANSFER OF ANG. MOMENTUM',I4,' NOT BETWEEN',I4,' ANDREDM-527
     1',I4)                                                             REDM-528
 1024 FORMAT (//' IN REDM  ...  STOP  ...')                             REDM-529
      END                                                               REDM-530
C 04/07/06                                                      ECIS06  VIBM-000
      SUBROUTINE VIBM(NIV,IQ,T,IPI,NCOLL,IT,IPH,NVAR,VAR,NBETA,FAC,IDT,LVIBM-001
     1O)                                                                VIBM-002
C NUCLEAR REDUCED MATRIX ELEMENTS FOR THE HARMONIC VIBRATIONAL MODEL.   VIBM-003
C INPUT:     IPI(J,*):PARITY OF NUCLEAR STATES FOR J=1,                 VIBM-004
C                     MULTIPLICITY OF THE PARTICLE FOR J=2,             VIBM-005
C                     MULTIPLICITY OF THE TARGET FOR J=3.               VIBM-006
C            NCOLL:   NUMBER OF COUPLED STATES                          VIBM-007
C            IPH(I,J):DESCRIPTION OF VIBRATIONAL MODEL FOR LEVEL J:     VIBM-008
C                     NUMBER OF PHONONS (0, 1, 2 PHONONS OR 3 FOR       VIBM-009
C                     MIXTURE OF 1 AND 2 PHONONS STATES) FOR I=1.       VIBM-010
C                     ADDRESS OF THE DESCRIPTION OF TWO PHONONS AND     VIBM-011
C                     MIXED STATES WHICH ARE IN THE NVAR,VAR FOR I=2.   VIBM-012
C            NVAR,VAR:EQUIVALENT BY CALL, 1 AND 2 PHONONS MIXING        VIBM-013
C                     COEFFICIENTS.                                     VIBM-014
C            NBETA:   QUANTUM NUMBERS OF DEFORMATIONS IN NBETA(17,*),   VIBM-015
C                     0 IN NBETA(18,*) TO BE USED IN SECOND ORDER       VIBM-016
C                     MONOPOLE CORRECTION, ANYTHING NOT TO BE USED/     VIBM-017
C            NBT1:    NUMBER OF PHONONS.                                VIBM-018
C            FAC:     TABLE AND NUMBER OF LOGARITHMS OF FACTORIALS.     VIBM-019
C            IDT:     LENGTH AVAILABLE IN THIS SUBROUTINE.              VIBM-020
C            LO(I):   LOGICAL CONTROLS:                                 VIBM-021
C               LO(2)  =.TRUE. SECOND ORDER VIBRATIONAL OR CONSTRAINED  VIBM-022
C                              ASYMMETRIC ROTATIONAL MODEL.             VIBM-023
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      VIBM-024
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   VIBM-025
C               LO(117)=.TRUE. FOR ALL CALCULATIONS EXCEPT THE FIRST.   VIBM-026
C OUTPUT:    NIV:     NUMBER AND REFERENCES OF INTERACTION FORM FACTORS VIBM-027
C                     BETWEEN EACH CHANNELS. NIV(I1,I2,K): FIRST I OF   VIBM-028
C                     T(3,I) FOR THE PAIR OF NUCLEAR STATES I1,I2 FOR   VIBM-029
C                     K=1 AND LAST ONE FOR K=2.                         VIBM-030
C            IQ,T:    EQUIVALENT BY CALL OF IQ(6,I) AND T(3,I).         VIBM-031
C            IT:      NUMBER OF NUCLEAR MATRIX ELEMENTS IN IQ,T. FOR A  VIBM-032
C                     GIVEN VALUE OF I:                                 VIBM-033
C                     IQ(1,I): REFERENCE TO TABLE OF FORM FACTORS:      VIBM-034
C                              I FOR BETA(I) AND I+J*(NBT1+1) FOR       VIBM-035
C                              BETA(I)*BETA(J) WITH J LARGER THAN I IN  VIBM-036
C                              THE HARMONIC VIBRATIONAL MODEL (ORDER OF VIBM-037
C                              DERIVATIVE IN THE ANHARMONIC VIBRATIONAL VIBM-038
C                              MODEL)                                   VIBM-039
C                     IQ(2,I): REFERENCE TO TABLE OF ANGULAR MOMENTA,   VIBM-040
C                     IQ(3,I): ADDRESS OF THE ASSOCIATED SPIN-ORBIT FORMVIBM-041
C                              FACTOR OR 0,                             VIBM-042
C                     IQ(4,I): UNUSED,                                  VIBM-043
C                     T(3,I):  REDUCED NUCLEAR MATRIX ELEMENT MULTIPLIEDVIBM-044
C                              BY (-)**(L/2) WHERE L IS THE TRANSFERRED VIBM-045
C                              ANGULAR MOMENTUM                         VIBM-046
C                                                                       VIBM-047
C***********************************************************************VIBM-048
C  THE DEFORMATIONS BETA AND FACTORS 1/SQRT(4*PI) ARE NOT INCLUDED IN   VIBM-049
C THE MATRIX ELEMENTS WHICH ARE COMPUTED HERE. THE FULL EXPRESSIONS ARE:VIBM-050
C (0||Q2||0) = SUM ON BETA**2/(4*PI) WITH IQ=0,                         VIBM-051
C (0||Q1||I) = (-)**I BETA(I)/SQRT(4*PI) WITH IQ=I,                     VIBM-052
C (I||Q1||0) SAME VALUE WITHOUT (-)**I,                                 VIBM-053
C (IP||Q2||I) = (-)**I BETA(I)*BETA(IP)*DJCG(I,IP,0,0|IQ,0)/(2*PI)      VIBM-054
C    PLUS SUM ON BETA**2*SQRT(2*I+1)/(4*PI) WITH IQ=0 WHEN I=IP,        VIBM-055
C (0||Q2||L1,L2,I) = (-)**I BETA(L1)*BETA(L2) DJCG(L1,L2,0,0|I,0)/      VIBM-056
C    (2*PI*SQRT(1+DELTA(L1,L2)))   WITH IQ=I,                           VIBM-057
C (L1,L2,I||Q2||0) SAME VALUE WITHOUT (-)**I,                           VIBM-058
C (IP||Q1||L1,L2,I) = (-)**IQ BETA(*)*(DELTA(IQ,L1)*DELTA(IP,L2)+(-)**  VIBM-059
C    (IP+I+IQ)*DELTA(IQ,L2)*DELTA(IP,L1)) * SQRT((2*I+1)/((2*IQ+1)*     VIBM-060
C    (1+DELTA(L1,L2))*SQRT(4*PI)),                                      VIBM-061
C (L1,L2,I||Q1||IP) SAME EXPRESSION BUT WITH (-)**IP+I+IQ  IN FRONT,    VIBM-062
C (L3,L4,IP||Q2||L1,L2,I)  SUM ON BETA**2*(DELTA(L1,L3)*DELTA(L2,L4)+   VIBM-063
C    (-)**(L1+L2-I)*DELTA(L1,L4)*DELTA(L2,L3)) * SQRT(2*IP+1)/(4*PI*SQRTVIBM-064
C    ((1+DELTA(L1,L2))*(1+DELTA(L3,L4))) WITH IQ=0,WHEN I=IP            VIBM-065
C    PLUS,WHEN TWO PHONONS ARE IDENTICAL,SUM WITH ALL THE POSSIBLE VA-  VIBM-066
C    LUES FOR IQ OF BETA(L5)*BETA(L6)*DJCG(L5,L6,0,0|IQ,0)*DJ6J(L6,IP,  VIBM-067
C    L7,I,L5,IQ) * SQRT((2*I+1)*(2*IP+1))/(2*PI*SQRT((1+DELTA(L1,L2)*(1+VIBM-068
C    DELTA(L3,L4))   WHERE  L7 IS THE COMMON PHONON ,L5 AND L6 THE OTHERVIBM-069
C    PHONONS IN I AND IP, MULTIPLIED BY THE PHASE:                      VIBM-070
C      *(-)**(IP-L1)   IF L1=L3,        *(-)**(L3)       IF L1=L4,      VIBM-071
C      *(-)**(IP+L1-I) IF L2=L3,      *(-)**(L1+L3+L4-I) IF L2=L4.      VIBM-072
C (J||L=IQ||I) IS MULTIPLIED BY A PHASE (-)**((IQ+IPI(I)-IPI(J))/2)     VIBM-073
C AND THE FACTORS BETA/SQRT(4*PI) ARE SHIFTED ON THE FORM FACTORS.      VIBM-074
C                                                                       VIBM-075
C FOR THE COMMON  /COUPL/ SEE CALC.                                     VIBM-076
C                                                                       VIBM-077
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     VIBM-078
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           VIBM-079
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       VIBM-080
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             VIBM-081
C   USED:     NBT1,NFA,NVA.                                             VIBM-082
C                                                                       VIBM-083
C***********************************************************************VIBM-084
      IMPLICIT REAL*8 (A-H,O-Z)                                         VIBM-085
      LOGICAL LIB(4),LO(150)                                            VIBM-086
      DIMENSION NIV(NCOLL,NCOLL,*),IQ(6,*),T(3,*),IPI(11,*),IPH(2,*),NVAVIBM-087
     1R(2,*),VAR(*),NBETA(18,*),FAC(*),IA(6,4),B(4),AA(2,2)             VIBM-088
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   VIBM-089
      COMMON /INOUT/ MR,MW,MS                                           VIBM-090
      IT=1                                                              VIBM-091
      NSP=0                                                             VIBM-092
      IF (LO(13).OR.LO(19)) NSP=10                                      VIBM-093
      DO 39 I1=1,NCOLL                                                  VIBM-094
      AA(1,1)=1.D0                                                      VIBM-095
      AA(1,2)=0.D0                                                      VIBM-096
      IF (IPH(1,I1).LE.2) GO TO 1                                       VIBM-097
      JVAR=IPH(2,I1)+1                                                  VIBM-098
      IVAR=NVAR(2,JVAR)                                                 VIBM-099
      AY=1.74532925D-02*VAR(IVAR)                                       VIBM-100
      AA(1,1)=DCOS(AY)                                                  VIBM-101
      AA(1,2)=DSIN(AY)                                                  VIBM-102
      IF (.NOT.LO(117)) WRITE (MW,1000) I1,VAR(IVAR),AA(1,1),AA(1,2)    VIBM-103
    1 AA(2,1)=AA(1,1)                                                   VIBM-104
      AA(2,2)=AA(1,2)                                                   VIBM-105
      DO 38 I2=I1,NCOLL                                                 VIBM-106
      IF (I1.EQ.I2) GO TO 2                                             VIBM-107
      AA(2,1)=1.D0                                                      VIBM-108
      AA(2,2)=0.D0                                                      VIBM-109
      IF (IPH(1,I2).LE.2) GO TO 2                                       VIBM-110
      IVAR=IPH(2,I2)+1                                                  VIBM-111
      JVAR=NVAR(2,IVAR)                                                 VIBM-112
      IF (JVAR.GT.NVA) GO TO 40                                         VIBM-113
      AY=1.74532925D-02*VAR(JVAR)                                       VIBM-114
      AA(2,1)=DCOS(AY)                                                  VIBM-115
      AA(2,2)=DSIN(AY)                                                  VIBM-116
    2 NIV(I1,I2,1)=IT                                                   VIBM-117
      L1=IPH(1,I1)                                                      VIBM-118
      AX=AA(1,1)                                                        VIBM-119
      IF (L1.GT.2) L1=1                                                 VIBM-120
      IF (DABS(AX).LT.1.D-6) GO TO 27                                   VIBM-121
    3 L2=IPH(1,I2)                                                      VIBM-122
      IF (L2.GT.2) L2=1                                                 VIBM-123
      AY=AX*AA(2,1)                                                     VIBM-124
      IF (DABS(AY).LT.1.D-6) GO TO 26                                   VIBM-125
    4 I=L1+L2+1                                                         VIBM-126
      IF (I.EQ.3.AND.L1.NE.L2) I=6                                      VIBM-127
      IF (L1.GT.L2) GO TO 5                                             VIBM-128
      J1=I1                                                             VIBM-129
      J2=I2                                                             VIBM-130
      GO TO 6                                                           VIBM-131
    5 J1=I2                                                             VIBM-132
      J2=I1                                                             VIBM-133
C  TRANSPOSITION.                                                       VIBM-134
      AY=AY*DFLOAT(1-MOD(IPI(3,I1)+IPI(3,I2)+2*(IPI(1,I1)+IPI(1,I2)+1),4VIBM-135
     1))                                                                VIBM-136
    6 GO TO ( 7 , 9 , 10 , 14 , 18 , 24 ) , I                           VIBM-137
C  (0||Q||0).                                                           VIBM-138
    7 IF ((IPI(3,J1).NE.1).OR.(IPI(3,J2).NE.1)) GO TO 41                VIBM-139
      IF (.NOT.LO(2)) GO TO 26                                          VIBM-140
      DO 8 L=1,NBT1                                                     VIBM-141
      IF (NBETA(18,L).NE.0) GO TO 8                                     VIBM-142
      IF (2*IT.GT.IDT) CALL MEMO('VIBM',IDT,2*IT)                       VIBM-143
      IQ(1,IT)=L*(NBT1+2)                                               VIBM-144
      IQ(2,IT)=0                                                        VIBM-145
      IQ(3,IT)=NSP                                                      VIBM-146
      T(3,IT)=AY                                                        VIBM-147
      IT=IT+1                                                           VIBM-148
    8 CONTINUE                                                          VIBM-149
      GO TO 26                                                          VIBM-150
C  (IP||Q||0)  WITH IP=J2.                                              VIBM-151
    9 IF (2*IT.GT.IDT) CALL MEMO('VIBM',IDT,2*IT)                       VIBM-152
      N2=IPH(2,J2)                                                      VIBM-153
      IF (IPH(1,J2).GT.2) N2=NVAR(1,N2+1)                               VIBM-154
      IF ((IPI(3,J2).NE.(2*NBETA(17,N2)+1)).OR.(IPI(3,J1).NE.1)) GO     VIBM-155
     1TO 41                                                             VIBM-156
      IQ(1,IT)=N2                                                       VIBM-157
      IQ(2,IT)=NBETA(17,N2)                                             VIBM-158
      IQ(3,IT)=NSP                                                      VIBM-159
      T(3,IT)=AY                                                        VIBM-160
      IF (MOD(IABS(IQ(2,IT)+IPI(1,J1)-IPI(1,J2)),4).NE.0) T(3,IT)=-T(3,IVIBM-161
     1T)                                                                VIBM-162
      GO TO 25                                                          VIBM-163
C  (IP||Q||I).                                                          VIBM-164
   10 IF (.NOT.LO(2)) GO TO 26                                          VIBM-165
      N1=IPH(2,J1)                                                      VIBM-166
      IF (IPH(1,J1).GT.2) N1=NVAR(1,N1+1)                               VIBM-167
      N2=IPH(2,J2)                                                      VIBM-168
      IF (IPH(1,J2).GT.2) N2=NVAR(1,N2+1)                               VIBM-169
      IF ((IPI(3,J2).NE.(2*NBETA(17,N2)+1)).OR.(IPI(3,J1).NE.(2*NBETA(17VIBM-170
     1,N1)+1))) GO TO 41                                                VIBM-171
      IF (N1.NE.N2) GO TO 12                                            VIBM-172
      AQ=DSQRT(DFLOAT(2*NBETA(17,N1)+1))                                VIBM-173
      DO 11 L=1,NBT1                                                    VIBM-174
      IF (NBETA(18,L).NE.0) GO TO 11                                    VIBM-175
      IF (2*IT.GT.IDT) CALL MEMO('VIBM',IDT,2*IT)                       VIBM-176
      IQ(1,IT)=L*(NBT1+2)                                               VIBM-177
      IQ(2,IT)=0                                                        VIBM-178
      IQ(3,IT)=NSP                                                      VIBM-179
      T(3,IT)=AQ*AY                                                     VIBM-180
      IT=IT+1                                                           VIBM-181
   11 CONTINUE                                                          VIBM-182
C FACTOR 2 FOR NON IDENTICAL PHONONS ADDED ON THE 10/03/81.             VIBM-183
   12 K1=IABS(NBETA(17,N2)-NBETA(17,N1))+1                              VIBM-184
      K2=NBETA(17,N2)+NBETA(17,N1)+1                                    VIBM-185
      FS=DFLOAT(2*(1-2*MOD(NBETA(17,N1)+IABS(IPI(1,J1)-IPI(1,J2)+K1-1)/2VIBM-186
     1,2)))                                                             VIBM-187
      DO 13 K=K1,K2,2                                                   VIBM-188
      IF (2*IT.GT.IDT) CALL MEMO('VIBM',IDT,2*IT)                       VIBM-189
      J=K-1                                                             VIBM-190
      AQ=FS*DJCG(IPI(3,J1)-1,IPI(3,J2)-1,2*J,0,0,FAC,NFA)               VIBM-191
      IQ(1,IT)=MAX0(N1,N2)*(NBT1+1)+MIN0(N1,N2)                         VIBM-192
      IQ(2,IT)=J                                                        VIBM-193
      IQ(3,IT)=NSP                                                      VIBM-194
      T(3,IT)=AQ*AY                                                     VIBM-195
      FS=-FS                                                            VIBM-196
   13 IT=IT+1                                                           VIBM-197
      GO TO 26                                                          VIBM-198
C  (L1,L2,IP||Q||I) WITH I=J1 AND IP=J2.                                VIBM-199
   14 I=IPH(2,J2)                                                       VIBM-200
      LB1=NVAR(1,I)                                                     VIBM-201
      LB2=NVAR(2,I)                                                     VIBM-202
      N1=IPH(2,J1)                                                      VIBM-203
      IF (IPH(1,J1).GT.2) N1=NVAR(1,N1+1)                               VIBM-204
      IF (IPI(3,J1).NE.(2*NBETA(17,N1)+1)) GO TO 41                     VIBM-205
      LIB(1)=LB1.EQ.N1                                                  VIBM-206
      LIB(2)=LB2.EQ.N1                                                  VIBM-207
      IF (2*IT.GT.IDT) CALL MEMO('VIBM',IDT,2*IT)                       VIBM-208
      IF (LIB(1).AND.LIB(2)) GO TO 16                                   VIBM-209
      IF (LIB(2)) GO TO 15                                              VIBM-210
      IF (.NOT.LIB(1)) GO TO 26                                         VIBM-211
      IQ(1,IT)=LB2                                                      VIBM-212
      IQ(2,IT)=NBETA(17,LB2)                                            VIBM-213
      IQ(3,IT)=NSP                                                      VIBM-214
      T(3,IT)=AY*DFLOAT(1-2*MOD(IABS(IPI(1,J1)-IPI(1,J2)+IQ(2,IT))/2,2))VIBM-215
      GO TO 17                                                          VIBM-216
   15 IQ(1,IT)=LB1                                                      VIBM-217
      IQ(2,IT)=NBETA(17,LB1)                                            VIBM-218
      IQ(3,IT)=NSP                                                      VIBM-219
      T(3,IT)=AY*DFLOAT(1-MOD(IABS(IPI(3,J1)+IPI(3,J2)-2+IPI(1,J1)-IPI(1VIBM-220
     1,J2)-IQ(2,IT)),4))                                                VIBM-221
      GO TO 17                                                          VIBM-222
   16 IF (MOD(IPI(3,J2),4).NE.1) GO TO 26                               VIBM-223
      IQ(1,IT)=N1                                                       VIBM-224
      IQ(2,IT)=NBETA(17,N1)                                             VIBM-225
      IQ(3,IT)=NSP                                                      VIBM-226
      T(3,IT)=DSQRT(2.D0)*AY*DFLOAT(1-MOD(IABS(IPI(1,J1)-IPI(1,J2)+IQ(2,VIBM-227
     1IT)),4))                                                          VIBM-228
   17 T(3,IT)=T(3,IT)*DSQRT(DFLOAT(IPI(3,J2))/DFLOAT(2*IQ(2,IT)+1))     VIBM-229
      GO TO 25                                                          VIBM-230
C  (L3,L4,IP||Q||L1,L2,I).                                              VIBM-231
   18 IF (.NOT.LO(2)) GO TO 26                                          VIBM-232
      I=IPH(2,I1)                                                       VIBM-233
      LB1=NVAR(1,I)                                                     VIBM-234
      LB2=NVAR(2,I)                                                     VIBM-235
      I=IPH(2,I2)                                                       VIBM-236
      LB3=NVAR(1,I)                                                     VIBM-237
      LB4=NVAR(2,I)                                                     VIBM-238
      LIB(1)=LB1.NE.LB3                                                 VIBM-239
      LIB(2)=LB2.NE.LB4                                                 VIBM-240
      LIB(3)=LB1.NE.LB4                                                 VIBM-241
      LIB(4)=LB2.NE.LB3                                                 VIBM-242
      IF (LIB(1).AND.LIB(2).AND.LIB(3).AND.LIB(4)) GO TO 26             VIBM-243
      JA1=(IPI(3,J1)-1)/2                                               VIBM-244
      JA2=(IPI(3,J2)-1)/2                                               VIBM-245
      IA(1,1)=NBETA(17,LB2)                                             VIBM-246
      IA(2,1)=NBETA(17,LB4)                                             VIBM-247
      IA(1,2)=NBETA(17,LB1)                                             VIBM-248
      IA(2,2)=NBETA(17,LB3)                                             VIBM-249
      IA(1,3)=IA(1,1)                                                   VIBM-250
      IA(2,3)=IA(2,2)                                                   VIBM-251
      IA(1,4)=IA(1,2)                                                   VIBM-252
      IA(2,4)=IA(2,1)                                                   VIBM-253
      IA(3,1)=IA(1,2)                                                   VIBM-254
      IA(3,2)=IA(1,1)                                                   VIBM-255
      IA(3,3)=IA(1,2)                                                   VIBM-256
      IA(3,4)=IA(1,1)                                                   VIBM-257
      IA(6,1)=MAX0(LB2,LB4)*(NBT1+1)+MIN0(LB2,LB4)                      VIBM-258
      IA(6,2)=MAX0(LB1,LB3)*(NBT1+1)+MIN0(LB1,LB3)                      VIBM-259
      IA(6,3)=MAX0(LB2,LB3)*(NBT1+1)+MIN0(LB2,LB3)                      VIBM-260
      IA(6,4)=MAX0(LB1,LB4)*(NBT1+1)+MIN0(LB1,LB4)                      VIBM-261
      IMIN=1000                                                         VIBM-262
      IMAX=0                                                            VIBM-263
      DO 19 I=1,4                                                       VIBM-264
      IF (LIB(I)) GO TO 19                                              VIBM-265
      IA(4,I)=IABS(IA(1,I)-IA(2,I))                                     VIBM-266
      IA(5,I)=IA(1,I)+IA(2,I)                                           VIBM-267
      IF (IA(4,I).LT.IMIN) IMIN=IA(4,I)                                 VIBM-268
      IF (IA(5,I).GT.IMAX) IMAX=IA(5,I)                                 VIBM-269
   19 CONTINUE                                                          VIBM-270
      B(1)=DFLOAT(1-2*MOD(JA2+IA(1,2),2))                               VIBM-271
      B(2)=DFLOAT(1-2*MOD(IA(1,2)+IA(2,2)+IA(2,1)+JA1,2))               VIBM-272
      B(3)=DFLOAT(1-2*MOD(IA(2,2),2))                                   VIBM-273
      B(4)=DFLOAT(1-2*MOD(JA2+JA1+IA(1,2),2))                           VIBM-274
      T0=DSQRT(DFLOAT((2*JA1+1)*(2*JA2+1)))*2.D0                        VIBM-275
      IF (LB1.EQ.LB2) T0=DSQRT(0.5D0)*T0                                VIBM-276
      IF (LB3.EQ.LB4) T0=DSQRT(0.5D0)*T0                                VIBM-277
      IF (JA1.NE.JA2) GO TO 21                                          VIBM-278
      TKQ=0.D0                                                          VIBM-279
      IF ((LB1.EQ.LB3).AND.(LB2.EQ.LB4)) TKQ=1.D0                       VIBM-280
      IF ((LB1.EQ.LB4).AND.(LB2.EQ.LB3)) TKQ=TKQ+DFLOAT(1-2*MOD(JA1+IA(1VIBM-281
     1,1)+IA(1,2),2))                                                   VIBM-282
      IF (TKQ.EQ.0.D0) GO TO 21                                         VIBM-283
      IF (LB1.EQ.LB2) TKQ=0.5D0*TKQ                                     VIBM-284
      DO 20 L=1,NBT1                                                    VIBM-285
      IF (NBETA(18,L).NE.0) GO TO 20                                    VIBM-286
      IF (2*IT.GT.IDT) CALL MEMO('VIBM',IDT,2*IT)                       VIBM-287
      IQ(1,IT)=L*(NBT1+2)                                               VIBM-288
      IQ(2,IT)=0                                                        VIBM-289
      IQ(3,IT)=NSP                                                      VIBM-290
      T(3,IT)=TKQ*DSQRT(2.D0*JA1+1.D0)*AY                               VIBM-291
      IT=IT+1                                                           VIBM-292
   20 CONTINUE                                                          VIBM-293
   21 IMIN=MAX0(IMIN,IABS(JA1-JA2))+1                                   VIBM-294
      IMAX=MIN0(IMAX,JA1+JA2)+1                                         VIBM-295
      DO 23 M=IMIN,IMAX                                                 VIBM-296
      J=M-1                                                             VIBM-297
      DO 22 K=1,4                                                       VIBM-298
      IF (LIB(K).OR.(J.LT.IA(4,K)).OR.(J.GT.IA(5,K)).OR.(MOD(J+IA(5,K),2VIBM-299
     1).NE.0)) GO TO 22                                                 VIBM-300
      IF (2*IT.GT.IDT) CALL MEMO('VIBM',IDT,2*IT)                       VIBM-301
      T3=B(K)*DJ6J(2*IA(1,K),2*IA(2,K),2*J,2*JA2,2*JA1,2*IA(3,K),FAC,NFAVIBM-302
     1)*DJCG(2*IA(1,K),2*IA(2,K),2*J,0,0,FAC,NFA)*DFLOAT(1-MOD(IABS(IPI(VIBM-303
     21,J1)-IPI(1,J2)+J),4))                                            VIBM-304
      IF (DABS(T3).LT.1.D-6) GO TO 22                                   VIBM-305
      IQ(1,IT)=IA(6,K)                                                  VIBM-306
      IQ(2,IT)=J                                                        VIBM-307
      IQ(3,IT)=NSP                                                      VIBM-308
      T(3,IT)=T3*T0*AY                                                  VIBM-309
      IT=IT+1                                                           VIBM-310
   22 CONTINUE                                                          VIBM-311
   23 CONTINUE                                                          VIBM-312
      GO TO 26                                                          VIBM-313
C  (L1,L2,IP||Q||0) WITH IP=J2.                                         VIBM-314
   24 IF (.NOT.LO(2)) GO TO 26                                          VIBM-315
      K3=(IPI(3,J2)-1)/2                                                VIBM-316
      IQ(2,IT)=K3                                                       VIBM-317
      I=IPH(2,J2)                                                       VIBM-318
      K1=NVAR(1,I)                                                      VIBM-319
      K2=NVAR(2,I)                                                      VIBM-320
      IQ(1,IT)=MAX0(K1,K2)*(NBT1+1)+MIN0(K1,K2)                         VIBM-321
      IQ(3,IT)=NSP                                                      VIBM-322
      W1=2.D0                                                           VIBM-323
      IF (K1.EQ.K2) W1=DSQRT(W1)                                        VIBM-324
      T(3,IT)=AY*DJCG(2*NBETA(17,K1),2*NBETA(17,K2),IPI(3,J2)-1,0,0,FAC,VIBM-325
     1NFA)*DFLOAT(1-MOD(IABS(IPI(1,J1)-IPI(1,J2)+K3),4))*W1             VIBM-326
   25 IT=IT+1                                                           VIBM-327
   26 IF ((AA(2,2).EQ.0.D0).OR.(L2.EQ.2)) GO TO 27                      VIBM-328
      L2=2                                                              VIBM-329
      AY=AX*AA(2,2)                                                     VIBM-330
      GO TO 4                                                           VIBM-331
   27 IF ((AA(1,2).EQ.0.D0).OR.(L1.EQ.2)) GO TO 28                      VIBM-332
      L1=2                                                              VIBM-333
      AX=AA(1,2)                                                        VIBM-334
      GO TO 3                                                           VIBM-335
   28 ITI=NIV(I1,I2,1)                                                  VIBM-336
      IF (ITI.EQ.IT) GO TO 37                                           VIBM-337
      ITF=IT-1                                                          VIBM-338
      IF (ITF.EQ.ITI) GO TO 32                                          VIBM-339
      IT1=ITI+1                                                         VIBM-340
      IT=ITI                                                            VIBM-341
      DO 31 I=IT1,ITF                                                   VIBM-342
      DO 29 J=ITI,IT                                                    VIBM-343
      IF ((IQ(1,I).NE.IQ(1,J)).OR.(IQ(2,I).NE.IQ(2,J)).OR.(IQ(3,I).NE.IQVIBM-344
     1(3,J))) GO TO 29                                                  VIBM-345
      T(3,J)=T(3,J)+T(3,I)                                              VIBM-346
      GO TO 31                                                          VIBM-347
   29 CONTINUE                                                          VIBM-348
      IT=IT+1                                                           VIBM-349
      DO 30 K=1,3                                                       VIBM-350
   30 IQ(K,IT)=IQ(K,I)                                                  VIBM-351
      T(3,IT)=T(3,I)                                                    VIBM-352
   31 CONTINUE                                                          VIBM-353
      IT=IT+1                                                           VIBM-354
   32 ITF=IT-1                                                          VIBM-355
      DO 36 I=ITI,ITF                                                   VIBM-356
      IF (IT.LE.I) GO TO 37                                             VIBM-357
   33 IF (DABS(T(3,I)).GT.1.D-12) GO TO 36                              VIBM-358
      IT1=I+1                                                           VIBM-359
      IT=IT-1                                                           VIBM-360
      IF (IT1.GT.IT) GO TO 37                                           VIBM-361
      DO 35 J=IT1,IT                                                    VIBM-362
      DO 34 K=1,3                                                       VIBM-363
   34 IQ(K,J-1)=IQ(K,J)                                                 VIBM-364
   35 T(3,J-1)=T(3,J)                                                   VIBM-365
      GO TO 33                                                          VIBM-366
   36 CONTINUE                                                          VIBM-367
   37 NIV(I1,I2,2)=IT-1                                                 VIBM-368
   38 CONTINUE                                                          VIBM-369
   39 CONTINUE                                                          VIBM-370
      IT=IT-1                                                           VIBM-371
      RETURN                                                            VIBM-372
   40 WRITE (MW,1001) JVAR,NVA                                          VIBM-373
      GO TO 42                                                          VIBM-374
   41 WRITE (MW,1002) I1,I2                                             VIBM-375
   42 WRITE (MW,1003)                                                   VIBM-376
      STOP                                                              VIBM-377
 1000 FORMAT (' STATE',I4,F15.5,' DEGREES      AMPLITUDES =',F15.7,'  1 VIBM-378
     1PHONON AND',F15.7,'  2 PHONONS.')                                 VIBM-379
 1001 FORMAT (' NUMBER OF VARIABLES USED:',I5,5X,'EXCEEDS NUMBER OF VARIVIBM-380
     1ABLES READ:',I6)                                                  VIBM-381
 1002 FORMAT (' INCORRECT DESCRIPTION OF LEVEL',I3,'  OR',I3)           VIBM-382
 1003 FORMAT (//' IN VIBM  ...  STOP  ...')                             VIBM-383
      END                                                               VIBM-384
C 04/07/06                                                      ECIS06  ROTM-000
      SUBROUTINE ROTM(NIV,IQ,T,IPI,NCOLL,IPH,NBETA,NVAR,VAR,IT,FAC,IDT,LROTM-001
     1O)                                                                ROTM-002
C NUCLEAR REDUCED MATRIX ELEMENTS FOR THE SYMMETRIC ROTATIONAL MODEL.   ROTM-003
C INPUT:     IPI(J,*):PARITY OF NUCLEAR STATES FOR J=1,                 ROTM-004
C                     MULTIPLICITY OF THE PARTICLE FOR J=2,             ROTM-005
C                     MULTIPLICITY OF THE TARGET FOR J=3.               ROTM-006
C            NCOLL:   NUMBER OF COUPLED STATES                          ROTM-007
C            IPH:     DESCRIPTION OF VIBRATIONAL MODEL (SEE VIBM).      ROTM-008
C            NBETA:   L QUANTUM NUMBERS OF DEFORMATIONS IN NBETA(17,*), ROTM-009
C                     K QUANTUM NUMBERS OF DEFORMATIONS IN NBETA(18,*),.ROTM-010
C            NVAR,VAR:EQUIVALENT BY CALL, MIXTURE COEFFICIENTS OF BANDS.ROTM-011
C                     MODEL.                                            ROTM-012
C            FAC:     TABLE AND NUMBER OF LOGARITHMS OF FACTORIALS.     ROTM-013
C            IDT:     LENGTH AVAILABLE IN THIS SUBROUTINE.              ROTM-014
C            LO(I):   LOGICAL CONTROLS:                                 ROTM-015
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      ROTM-016
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   ROTM-017
C               LO(117)=.TRUE. FOR ALL CALCULATIONS EXCEPT THE FIRST.   ROTM-018
C OUTPUT:    NIV:     NUMBER AND REFERENCES OF INTERACTION FORM FACTORS ROTM-019
C                     BETWEEN EACH CHANNELS. NIV(I1,I2,K): FIRST I OF   ROTM-020
C                     T(3,I) FOR THE PAIR OF NUCLEAR STATES I1,I2 FOR   ROTM-021
C                     K=1 AND LAST ONE FOR K=2.                         ROTM-022
C            IQ,T:    EQUIVALENT BY CALL OF IQ(6,I) AND T(3,I).         ROTM-023
C            IT:      NUMBER OF NUCLEAR MATRIX ELEMENTS IN IQ,T. FOR A  ROTM-024
C                     GIVEN VALUE OF I:                                 ROTM-025
C                     IQ(1,I): REFERENCE TO TABLE OF FORM FACTORS,      ROTM-026
C                              THE CONTROL NUMBER FOR THE FORM FACTOR   ROTM-027
C                              WITH THE VIBRATION N1 AND THE            ROTM-028
C                              MULTIPOLARITY L IS 1000*(L+1)+N1.        ROTM-029
C                     IQ(2,I): REFERENCE TO TABLE OF ANGULAR MOMENTA,   ROTM-030
C                     IQ(3,I): ADDRESS OF THE ASSOCIATED SPIN-ORBIT FORMROTM-031
C                              FACTOR OR 0,                             ROTM-032
C                     IQ(4,I): UNUSED,                                  ROTM-033
C                     T(3,I):  REDUCED NUCLEAR MATRIX ELEMENT:          ROTM-034
C                     (IP||Q||I)=SQRT(2*I+1)*CG(I,IQ,IP,K,0,K),         ROTM-035
C                     (IP+V||Q||I)=SQRT(2*I+1)*CG(I,IQ,IP,K,V,K+V),     ROTM-036
C                     (IP+V||Q||I+V)=SQRT(2*I+1)*CG(I,IQ,IP,K+V,0,K+V). ROTM-037
C                                                                       ROTM-038
C FOR THE COMMON  /COUPL/ SEE CALC.                                     ROTM-039
C                                                                       ROTM-040
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     ROTM-041
C  IQMAX:     MAXIMUM L-EXPANSION IN ROTATIONAL MODEL.                  ROTM-042
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       ROTM-043
C  NSPIN:     TWICE THE K-VALUE OF THE ROTATIONAL BAND.                 ROTM-044
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             ROTM-045
C   USED:     IQMAX,NFA,NSPIN,NVA.                                      ROTM-046
C                                                                       ROTM-047
C***********************************************************************ROTM-048
      IMPLICIT REAL*8 (A-H,O-Z)                                         ROTM-049
      LOGICAL LO(150)                                                   ROTM-050
      DIMENSION NIV(NCOLL,NCOLL,*),IQ(6,*),T(3,*),IPI(11,*),IPH(2,*),NBEROTM-051
     1TA(18,*),NVAR(2,*),VAR(*),FAC(*),AA(2,2)                          ROTM-052
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   ROTM-053
      COMMON /INOUT/ MR,MW,MS                                           ROTM-054
      IT=1                                                              ROTM-055
      NSP=0                                                             ROTM-056
      IF (LO(13).OR.LO(19)) NSP=10                                      ROTM-057
      DO 24 I1=1,NCOLL                                                  ROTM-058
      IA1=IPI(3,I1)-1                                                   ROTM-059
      AA(1,1)=1.D0                                                      ROTM-060
      AA(1,2)=0.D0                                                      ROTM-061
      IF (IPH(1,I1).LE.1) GO TO 1                                       ROTM-062
      JVAR=IPH(2,I1)                                                    ROTM-063
      IVAR=NVAR(2,JVAR)                                                 ROTM-064
      AY=1.74532925D-02*VAR(IVAR)                                       ROTM-065
      AA(1,1)=DCOS(AY)                                                  ROTM-066
      AA(1,2)=DSIN(AY)                                                  ROTM-067
      IF (.NOT.LO(117)) WRITE (MW,1000) I1,VAR(IVAR),AA(1,1),AA(1,2)    ROTM-068
    1 AA(2,1)=AA(1,1)                                                   ROTM-069
      AA(2,2)=AA(1,2)                                                   ROTM-070
      DO 23 I2=I1,NCOLL                                                 ROTM-071
      IA2=IPI(3,I2)-1                                                   ROTM-072
      IF (I1.EQ.I2) GO TO 2                                             ROTM-073
      AA(2,1)=1.D0                                                      ROTM-074
      AA(2,2)=0.D0                                                      ROTM-075
      IF (IPH(1,I2).LE.1) GO TO 2                                       ROTM-076
      IVAR=IPH(2,I2)                                                    ROTM-077
      JVAR=NVAR(2,IVAR)                                                 ROTM-078
      IF (JVAR.GT.NVA) GO TO 25                                         ROTM-079
      AY=1.74532925D-02*VAR(JVAR)                                       ROTM-080
      AA(2,1)=DCOS(AY)                                                  ROTM-081
      AA(2,2)=DSIN(AY)                                                  ROTM-082
    2 NIV(I1,I2,1)=IT                                                   ROTM-083
      L1=IPH(1,I1)                                                      ROTM-084
      AX=AA(1,1)                                                        ROTM-085
      IF (L1.GT.1) L1=0                                                 ROTM-086
      IF (DABS(AX).LT.1.D-6) GO TO 12                                   ROTM-087
    3 L2=IPH(1,I2)                                                      ROTM-088
      IF (L2.GT.1) L2=0                                                 ROTM-089
      AY=AX*AA(2,1)                                                     ROTM-090
      IF (DABS(AY).LT.1.D-6) GO TO 11                                   ROTM-091
    4 IF (L1.NE.L2) GO TO 7                                             ROTM-092
      NSJ=NSPIN                                                         ROTM-093
      IF (L1.EQ.0) GO TO 5                                              ROTM-094
      N3=IPH(2,I1)                                                      ROTM-095
      IF (N3.NE.IPH(2,I2)) GO TO 11                                     ROTM-096
      NSJ=2*NBETA(18,N3)+NSJ                                            ROTM-097
    5 IF (IPI(1,I1).NE.IPI(1,I2)) GO TO 26                              ROTM-098
      IF ((IABS(NSJ).GT.IA2).OR.(IABS(NSJ).GT.IA1)) GO TO 27            ROTM-099
      IQ1=MIN0(IQMAX,(IA1+IA2)/2)                                       ROTM-100
      IQ2=MAX0(2,IABS(IA1-IA2)/2)                                       ROTM-101
      IF (2*(IQ2/2).NE.IQ2) IQ2=IQ2+1                                   ROTM-102
      IF (IQ2.GT.IQ1) GO TO 11                                          ROTM-103
      DO 6 IQZ=IQ2,IQ1,2                                                ROTM-104
      IF (2*IT.GT.IDT) CALL MEMO('ROTM',IDT,2*IT)                       ROTM-105
      IQ(1,IT)=1000*(IQZ+1)                                             ROTM-106
      IQ(2,IT)=IQZ                                                      ROTM-107
      IQ(3,IT)=NSP                                                      ROTM-108
      T(3,IT)=DFLOAT(1-MOD(IQZ,4))*DSQRT(IA1+1.D0)*DJCG(IA1,2*IQZ,IA2,NSROTM-109
     1J,0,FAC,NFA)*AY                                                   ROTM-110
      IF (DABS(T(3,IT)).GT.1.D-6) IT=IT+1                               ROTM-111
    6 CONTINUE                                                          ROTM-112
      GO TO 11                                                          ROTM-113
    7 IF (L1.GT.L2) GO TO 8                                             ROTM-114
      N3=IPH(2,I2)                                                      ROTM-115
      GO TO 9                                                           ROTM-116
C  TRANSPOSITION.                                                       ROTM-117
    8 AY=AY*DFLOAT(1-MOD(IPI(3,I1)+IPI(3,I2)+2*(IPI(1,I1)+IPI(1,I2)+1),4ROTM-118
     1))                                                                ROTM-119
      N3=IPH(2,I1)                                                      ROTM-120
C 0 PHONONS -1 PHONON.                                                  ROTM-121
    9 NSJ=2*NBETA(18,N3)                                                ROTM-122
      IF (MOD(IPI(1,I1)+IPI(1,I2)+NBETA(17,N3),2).NE.0) GO TO 28        ROTM-123
      IF (IABS(NSJ+NSPIN).GT.IA2) GO TO 27                              ROTM-124
      IQ1=(IA1+IA2)/2                                                   ROTM-125
      IQ2=MAX0(IABS(NSJ),IABS(IA1-IA2))/2                               ROTM-126
      IF (MOD(IQ2+NBETA(17,N3),2).NE.0) IQ2=IQ2+1                       ROTM-127
      IF (IQ2.GT.IQ1) GO TO 11                                          ROTM-128
      DO 10 IQZ=IQ2,IQ1,2                                               ROTM-129
      IF (3*IT.GT.IDT) CALL MEMO('ROTM',IDT,3*IT)                       ROTM-130
      IQ(1,IT)=1000*(IQZ+1)+N3                                          ROTM-131
      IQ(2,IT)=IQZ                                                      ROTM-132
      IQ(3,IT)=NSP                                                      ROTM-133
      T(3,IT)=DFLOAT(1-MOD(IQZ+IPI(1,I1)+IPI(1,I2),4))*DSQRT(IA1+1.D0)*DROTM-134
     1JCG(IA1,2*IQZ,IA2,NSPIN,NSJ,FAC,NFA)*AY                           ROTM-135
      IF (DABS(T(3,IT)).GT.1.D-6) IT=IT+1                               ROTM-136
   10 CONTINUE                                                          ROTM-137
   11 IF ((AA(2,2).EQ.0.D0).OR.(L2.EQ.1)) GO TO 12                      ROTM-138
      L2=1                                                              ROTM-139
      AY=AX*AA(2,2)                                                     ROTM-140
      GO TO 4                                                           ROTM-141
   12 IF ((AA(1,2).EQ.0.D0).OR.(L1.EQ.1)) GO TO 13                      ROTM-142
      L1=1                                                              ROTM-143
      AX=AA(1,2)                                                        ROTM-144
      GO TO 3                                                           ROTM-145
   13 ITI=NIV(I1,I2,1)                                                  ROTM-146
      IF (ITI.EQ.IT) GO TO 22                                           ROTM-147
      ITF=IT-1                                                          ROTM-148
      IF (ITF.EQ.ITI) GO TO 17                                          ROTM-149
      IT1=ITI+1                                                         ROTM-150
      IT=ITI                                                            ROTM-151
      DO 16 I=IT1,ITF                                                   ROTM-152
      DO 14 J=ITI,IT                                                    ROTM-153
      IF ((IQ(1,I).NE.IQ(1,J)).OR.(IQ(2,I).NE.IQ(2,J)).OR.(IQ(3,I).NE.IQROTM-154
     1(3,J))) GO TO 14                                                  ROTM-155
      T(3,J)=T(3,J)+T(3,I)                                              ROTM-156
      GO TO 16                                                          ROTM-157
   14 CONTINUE                                                          ROTM-158
      IT=IT+1                                                           ROTM-159
      DO 15 K=1,3                                                       ROTM-160
   15 IQ(K,IT)=IQ(K,I)                                                  ROTM-161
      T(3,IT)=T(3,I)                                                    ROTM-162
   16 CONTINUE                                                          ROTM-163
      IT=IT+1                                                           ROTM-164
   17 ITF=IT-1                                                          ROTM-165
      DO 21 I=ITI,ITF                                                   ROTM-166
      IF (IT.LE.I) GO TO 22                                             ROTM-167
   18 IF (DABS(T(3,I)).GT.1.D-12) GO TO 21                              ROTM-168
      IT1=I+1                                                           ROTM-169
      IT=IT-1                                                           ROTM-170
      IF (IT1.GT.IT) GO TO 22                                           ROTM-171
      DO 20 J=IT1,IT                                                    ROTM-172
      DO 19 K=1,3                                                       ROTM-173
   19 IQ(K,J-1)=IQ(K,J)                                                 ROTM-174
   20 T(3,J-1)=T(3,J)                                                   ROTM-175
      GO TO 18                                                          ROTM-176
   21 CONTINUE                                                          ROTM-177
   22 NIV(I1,I2,2)=IT-1                                                 ROTM-178
   23 CONTINUE                                                          ROTM-179
   24 CONTINUE                                                          ROTM-180
      IT=IT-1                                                           ROTM-181
      RETURN                                                            ROTM-182
   25 WRITE (MW,1001) JVAR,NVA                                          ROTM-183
      GO TO 29                                                          ROTM-184
   26 WRITE (MW,1002) I1,I2                                             ROTM-185
      GO TO 29                                                          ROTM-186
   27 WRITE (MW,1003) I1,I2                                             ROTM-187
      GO TO 29                                                          ROTM-188
   28 WRITE (MW,1004) I1,I2,N3                                          ROTM-189
      GO TO 29                                                          ROTM-190
   29 WRITE (MW,1005)                                                   ROTM-191
      STOP                                                              ROTM-192
 1000 FORMAT (' STATE',I4,F15.5,' DEGREES      AMPLITUDES =',F15.7,' GROROTM-193
     1UND STATE BAND AND',F15.5,' VIBRATIONAL BAND.')                   ROTM-194
 1001 FORMAT (' NUMBER OF VARIABLES USED:',I5,5X,'EXCEEDS NUMBER OF VARIROTM-195
     2ABLES READ:',I6)                                                  ROTM-196
 1002 FORMAT (/' PARITIES OF STATES',I4,'  AND',I4,'  INCORRECT FOR THE ROTM-197
     1ROTATIONAL MODEL.')                                               ROTM-198
 1003 FORMAT (' TOO LARGE MAGNETIC QUANTUM NUMBER BETWEEN LEVELS',I4,' AROTM-199
     1ND',I4)                                                           ROTM-200
 1004 FORMAT (/' PARITIES OF STATES',I4,'  AND',I4,'  INCORRECT FOR THE ROTM-201
     1ROTATIONAL MODEL WITH THE VIBRATION',I4)                          ROTM-202
 1005 FORMAT (//' IN ROTM  ...  STOP  ...')                             ROTM-203
      END                                                               ROTM-204
C 28/02/07                                                      ECIS06  ROAM-000
      SUBROUTINE ROAM(NIV,IQ,T,IPI,NCOLL,IT,BETA,IPH,VAR,VA,FAC,IDT,LO) ROAM-001
C NUCLEAR REDUCED MATRIX ELEMENTS FOR THE ASYMMETRIC ROTATIONAL MODEL.  ROAM-002
C INPUT:     IPI(J,*):PARITY OF NUCLEAR STATES FOR J=1,                 ROAM-003
C                     MULTIPLICITY OF THE PARTICLE FOR J=2,             ROAM-004
C                     MULTIPLICITY OF THE TARGET FOR J=3.               ROAM-005
C            NCOLL:   NUMBER OF COUPLED STATES                          ROAM-006
C            BETA:    DEFORMATIONS FOR L=2 ARE IN BETA(*,1),            ROAM-007
C                     GAMMA VALUES FOR L=2 ARE IN BETA(*,2),            ROAM-008
C                     DEFORMATIONS FOR L=4 ARE IN BETA(*,3),            ROAM-009
C                     ... ETC (SEE DESCRIPTION OF INPUT).               ROAM-010
C            IPH(I,*):NUMBER OF NUCLEAR PARAMETERS FOR I=1,             ROAM-011
C                     THEIR ADDRESS FOR I=2.                            ROAM-012
C            VAR:     EQUIVALENT BY CALL, PARAMETERS FOR SOME MODELS.   ROAM-013
C            FAC:     TABLE AND NUMBER OF LOGARITHMS OF FACTORIALS.     ROAM-014
C            IDT:     LENGTH AVAILABLE IN THIS SUBROUTINE.              ROAM-015
C            LO(I):   LOGICAL CONTROLS:                                 ROAM-016
C               LO(2)  =.TRUE. SECOND ORDER VIBRATIONAL OR CONSTRAINED  ROAM-017
C                              ASYMMETRIC ROTATIONAL MODEL.             ROAM-018
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      ROAM-019
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   ROAM-020
C               LO(117)=.TRUE. FOR ALL CALCULATIONS EXCEPT THE FIRST.   ROAM-021
C OUTPUT:    NIV:     NUMBER AND REFERENCES OF INTERACTION FORM FACTORS ROAM-022
C                     BETWEEN EACH CHANNELS. NIV(I1,I2,K): FIRST I OF   ROAM-023
C                     T(3,I) FOR THE PAIR OF NUCLEAR STATES I1,I2 FOR   ROAM-024
C                     K=1 AND LAST ONE FOR K=2.                         ROAM-025
C            IQ,T:    EQUIVALENT BY CALL OF IQ(6,I) AND T(3,I).         ROAM-026
C            IT:      NUMBER OF NUCLEAR MATRIX ELEMENTS IN IQ,T. FOR A  ROAM-027
C                     GIVEN VALUE OF I:                                 ROAM-028
C                     IQ(1,I): REFERENCE TO TABLE OF FORM FACTORS,      ROAM-029
C                              THE CONTROL NUMBER FOR FORM FACTOR       ROAM-030
C                              (L=2,K=0) IS 2,FOR (L=2,K=2) IS 3, FOR   ROAM-031
C                              (L=4,K=0) IS 4,FOR (L=4,K=2) IS 5 ...    ROAM-032
C                              AND SO ON...                             ROAM-033
C                     IQ(2,I): REFERENCE TO TABLE OF ANGULAR MOMENTA,   ROAM-034
C                     IQ(3,I): ADDRESS OF THE ASSOCIATED SPIN-ORBIT FORMROAM-035
C                              FACTOR OR 0,                             ROAM-036
C                     IQ(4,I): UNUSED,                                  ROAM-037
C                     T(3,I):  REDUCED NUCLEAR MATRIX ELEMENT:          ROAM-038
C                     (IP||Q(IQ,KQ)||I)=SQRT(2*I+1)*CG(I,IQ,IP,K,KQ,KP) ROAM-039
C            VA:      BAND MIXING COEFFICIENTS FOR L=2.                 ROAM-040
C                                                                       ROAM-041
C FOR THE COMMON  /COUPL/ SEE CALC.                                     ROAM-042
C                                                                       ROAM-043
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     ROAM-044
C  IQMAX:     MAXIMUM L-EXPANSION IN ROTATIONAL MODEL.                  ROAM-045
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       ROAM-046
C   USED:     IQMAX,NFA.                                                ROAM-047
C                                                                       ROAM-048
C***********************************************************************ROAM-049
      IMPLICIT REAL*8 (A-H,O-Z)                                         ROAM-050
      LOGICAL LO(150)                                                   ROAM-051
      DIMENSION NIV(NCOLL,NCOLL,*),IQ(6,*),T(3,*),IPI(11,*),BETA(9,*),IPROAM-052
     1H(2,*),VAR(*),VA(*),FAC(*)                                        ROAM-053
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   ROAM-054
      COMMON /INOUT/ MR,MW,MS                                           ROAM-055
      IVAR=0                                                            ROAM-056
      I2=1                                                              ROAM-057
      IF (.NOT.LO(2)) GO TO 4                                           ROAM-058
C VAR(1) IS THE ANGLE GAMMA OF DAVYDOV AND FILIPPOV MODEL.              ROAM-059
C THE SECOND LEVEL MUST BE A THE FIRST 2+ AND THE THIRD ONE,IF PRESENT, ROAM-060
C THE SECOND 2+ .THEIR MIXING COEFFICIENTS ARE COMPUTED FROM VAR(1).    ROAM-061
C THERE CAN BE ANY NUMBER OF LEVELS AFTER THE THIRD ONE.                ROAM-062
      G=VAR(1)-BETA(1,2)                                                ROAM-063
      IF (.NOT.LO(117)) WRITE (MW,1000) G,(BETA(I,2),I=1,8)             ROAM-064
      DO 1 I=1,8                                                        ROAM-065
    1 BETA(I,2)=BETA(I,2)+G                                             ROAM-066
      IF (.NOT.LO(117)) WRITE (MW,1001) (BETA(I,2),I=1,8)               ROAM-067
      G=0.0174532925199433D0*VAR(1)                                     ROAM-068
      G1=DSIN(G)                                                        ROAM-069
      G2=DCOS(G)                                                        ROAM-070
      G3=DSIN(3.D0*G)                                                   ROAM-071
      G4=DCOS(3.D0*G)                                                   ROAM-072
      G=DSQRT(9.D0-8.D0*G3*G3)                                          ROAM-073
      G5=-(G1*G3+3.D0*G2*G4+G)                                          ROAM-074
      G6=3.D0*G1*G4-G2*G3                                               ROAM-075
      VA(1)=1.D0                                                        ROAM-076
      IF (NCOLL.EQ.1) GO TO 2                                           ROAM-077
      G=DSQRT(G6*G6+G5*G5)                                              ROAM-078
      VA(2)=G5/G                                                        ROAM-079
      VA(3)=G6/G                                                        ROAM-080
      IF (NCOLL.EQ.2) GO TO 2                                           ROAM-081
      VA(4)=-VA(3)                                                      ROAM-082
      VA(5)=VA(2)                                                       ROAM-083
    2 I2=MIN0(NCOLL,3)                                                  ROAM-084
      DO 3 I1=1,I2                                                      ROAM-085
      IF (I1.EQ.1.AND.IPI(3,I1).NE.1) GO TO 14                          ROAM-086
      IF (I1.EQ.1) GO TO 3                                              ROAM-087
      IF (IPI(3,I1).NE.5) GO TO 14                                      ROAM-088
      IF (.NOT.LO(117)) WRITE (MW,1002) I1,VA(2*I1-2),VA(2*I1-1)        ROAM-089
    3 CONTINUE                                                          ROAM-090
      IVAR=I2-1                                                         ROAM-091
      I2=4                                                              ROAM-092
      IF (I2.GT.NCOLL) GO TO 7                                          ROAM-093
C LEVELS NOT RELATED TO THE GAMMA DEFORMATION.                          ROAM-094
    4 DO 6 I1=I2,NCOLL                                                  ROAM-095
      IF (IPI(3,I1).EQ.3) GO TO 16                                      ROAM-096
      IVAR=IPH(2,I1)                                                    ROAM-097
      IF (MOD(IPI(3,I1),4).NE.1) VAR(IVAR+1)=90.D0                      ROAM-098
      K1=IVAR+I1                                                        ROAM-099
      VA(K1)=1.D0                                                       ROAM-100
      IF (IPH(1,I1).EQ.0) GO TO 6                                       ROAM-101
      K2=K1+IPH(1,I1)-1                                                 ROAM-102
      DO 5 K=K1,K2                                                      ROAM-103
      IVAR=IVAR+1                                                       ROAM-104
      G=0.0174532925199433D0*VAR(IVAR)                                  ROAM-105
      VA(K+1)=VA(K)*DSIN(G)                                             ROAM-106
    5 VA(K)=VA(K)*DCOS(G)                                               ROAM-107
      IF (.NOT.LO(117)) WRITE (MW,1002) I1,(VA(K),K=K1,K2),VA(K2+1)     ROAM-108
    6 CONTINUE                                                          ROAM-109
C COMPUTATION OF RED. MAT. ELE. FOR I=/<IP AT THE FIRST CALL.           ROAM-110
    7 IT=1                                                              ROAM-111
      NSP=0                                                             ROAM-112
      IF (LO(13).OR.LO(19)) NSP=10                                      ROAM-113
      DO 13 I1=1,NCOLL                                                  ROAM-114
      NT=IPH(1,I1)+1                                                    ROAM-115
      NV=IPH(2,I1)+I1-1                                                 ROAM-116
      IA1=IPI(3,I1)-1                                                   ROAM-117
      NX=IA1/2-2*(IA1/4)                                                ROAM-118
      DO 12 I2=I1,NCOLL                                                 ROAM-119
      IF (IPI(1,I1).NE.IPI(1,I2)) GO TO 15                              ROAM-120
      NIV(I1,I2,1)=IT                                                   ROAM-121
      MT=IPH(1,I2)+1                                                    ROAM-122
      MV=IPH(2,I2)+I2-1                                                 ROAM-123
      IA2=IPI(3,I2)-1                                                   ROAM-124
      MX=IA2/2-2*(IA2/4)                                                ROAM-125
      IQ1=MIN0(IQMAX,(IA1+IA2)/2,8)                                     ROAM-126
      IQ2=MAX0(2,2*((IABS(IA1-IA2)/2+1)/2))                             ROAM-127
      IF (IQ2.GT.IQ1) GO TO 11                                          ROAM-128
C COMPUTATION OF REDUCED MATRIX ELEMENTS.                               ROAM-129
      DO 10 IQZ=IQ2,IQ1,2                                               ROAM-130
      FS=DFLOAT(IQZ-4*((IQZ+2)/4)+1)                                    ROAM-131
      IQY=IQZ/2+1                                                       ROAM-132
      DO 9 MQZ=1,IQY                                                    ROAM-133
      IF (2*IT.GT.IDT) CALL MEMO('ROAM',IDT,2*IT)                       ROAM-134
      IQ(1,IT)=1000*((IQY*(IQY-1))/2+MQZ)                               ROAM-135
      B=0.D0                                                            ROAM-136
      IQ(2,IT)=IQZ                                                      ROAM-137
      IQ(3,IT)=NSP                                                      ROAM-138
      MQ=2*MQZ-2                                                        ROAM-139
      DO 8 N1=1,NT                                                      ROAM-140
      IF (N1-NX.EQ.0) GO TO 8                                           ROAM-141
      N=2*N1-2                                                          ROAM-142
      LM=N-MQ                                                           ROAM-143
      IF (IABS(LM).GE.2*MT) GO TO 8                                     ROAM-144
      L1=1+IABS(LM)/2                                                   ROAM-145
      FQ=DJCG(IA1,2*IQZ,IA2,2*N,-2*MQ,FAC,NFA)*VA(NV+N1)*VA(MV+L1)      ROAM-146
      IF (LM.LT.0.AND.MX.EQ.1) FQ=-FQ                                   ROAM-147
      IF (MQ*N*LM.NE.0) FQ=.7071068D0*FQ                                ROAM-148
      B=B+FQ                                                            ROAM-149
      IF (N*MQ.EQ.0) GO TO 8                                            ROAM-150
      LM=MQ+N                                                           ROAM-151
      IF (LM.GE.2*MT) GO TO 8                                           ROAM-152
      L1=1+LM/2                                                         ROAM-153
      FQ=DJCG(IA1,2*IQZ,IA2,2*N,2*MQ,FAC,NFA)*VA(NV+N1)*VA(MV+L1)       ROAM-154
      IF (MQ*N*LM.NE.0) FQ=.7071068D0*FQ                                ROAM-155
      B=B+FQ                                                            ROAM-156
    8 CONTINUE                                                          ROAM-157
      IF (MQ.NE.0) B=.7071068D0*B                                       ROAM-158
      T(3,IT)=DSQRT(DFLOAT(IA1+1))*B*FS                                 ROAM-159
      IF (DABS(T(3,IT)).GT.1.D-6) IT=IT+1                               ROAM-160
    9 CONTINUE                                                          ROAM-161
   10 CONTINUE                                                          ROAM-162
   11 NIV(I1,I2,2)=IT-1                                                 ROAM-163
   12 CONTINUE                                                          ROAM-164
   13 CONTINUE                                                          ROAM-165
      IT=IT-1                                                           ROAM-166
      RETURN                                                            ROAM-167
   14 WRITE (MW,1003)                                                   ROAM-168
      GO TO 17                                                          ROAM-169
   15 WRITE (MW,1004) I1,I2                                             ROAM-170
      GO TO 17                                                          ROAM-171
   16 WRITE (MW,1005)                                                   ROAM-172
   17 WRITE (MW,1006)                                                   ROAM-173
      STOP                                                              ROAM-174
 1000 FORMAT (/' FOR CONSTRAINED ASYMMETRIC ROTATIONAL MODEL THE BETA(I,ROAM-175
     12) ARE INCREASED BY',F10.5//23X,'V',9X,'W',8X,'VS',8X,'WS',7X,'VSOROAM-176
     2',7X,'WSO',6X,'COUL S.O. COUL'/' INITIAL VALUES ',8F10.5)         ROAM-177
 1001 FORMAT (' MODIFIED VALUES',8F10.5)                                ROAM-178
 1002 FORMAT (/' BAND MIXING COEFFICIENTS FOR THE LEVEL',I4/(6D20.7))   ROAM-179
 1003 FORMAT (/' LEVEL ORDER INCORRECT FOR LINK BETWEEN DEFORMATION AND ROAM-180
     1BAND MIXING'/' USE 0+-2+-2+ AND THEN THE OTHER LEVELS.')          ROAM-181
 1004 FORMAT (/' PARITIES OF STATES',I4,'  AND',I4,'  INCORRECT FOR THE ROAM-182
     1ROTATIONAL MODEL.')                                               ROAM-183
 1005 FORMAT (/' NO SPIN-1 STATE IN THIS MODEL.')                       ROAM-184
 1006 FORMAT (//' IN ROAM  ...  STOP  ...')                             ROAM-185
      END                                                               ROAM-186
C 13/04/06                                                      ECIS06  DJCG-000
      FUNCTION DJCG(J1,J2,J3,M1,M2,FAC,NFA)                             DJCG-001
C CLEBSCH-GORDAN COEFFICIENTS ( J1  J2  M1  M2 | J3  M1+M2 ).           DJCG-002
C INPUT:     J1,..M2: INTEGER DOUBLED VALUES.                           DJCG-003
C            FAC:     TABLE OF LOGARITHM OF FACTORIALS.                 DJCG-004
C            NFA:     LENGTH OF FAC.                                    DJCG-005
C***********************************************************************DJCG-006
      IMPLICIT REAL*8(A-F)                                              DJCG-007
      DIMENSION FAC(*)                                                  DJCG-008
      COMMON /INOUT/ MR,MW,MS                                           DJCG-009
      DJCG=0.D0                                                         DJCG-010
      M3=M1+M2                                                          DJCG-011
      IF (J1+J2+J3.GT.2*NFA) GO TO 18                                   DJCG-012
      IF ((J1.LT.0).OR.(J2.LT.0).OR.(J3.LT.0)) GO TO 16                 DJCG-013
      IY1=J1+M1+2                                                       DJCG-014
      IX1=IY1/2                                                         DJCG-015
      IY2=J2+M2+2                                                       DJCG-016
      IX2=IY2/2                                                         DJCG-017
      IY3=J3-M3+2                                                       DJCG-018
      IX3=IY3/2                                                         DJCG-019
      IF ((IX1.LE.0).OR.(IX2.LE.0).OR.(IX3.LE.0)) RETURN                DJCG-020
      IF ((2*IX1.NE.IY1).OR.(2*IX2.NE.IY2).OR.(2*IX3.NE.IY3)) GO TO 17  DJCG-021
      IY1=IX1-M1                                                        DJCG-022
      IY2=IX2-M2                                                        DJCG-023
      IY3=IX3+M3                                                        DJCG-024
      IF ((IY1.LE.0).OR.(IY2.LE.0).OR.(IY3.LE.0)) RETURN                DJCG-025
C AT THIS POINT IX1,IX2,IX3 ARE TWICE J+M AND IY1,IY2,IY3 TWICE J-M     DJCG-026
C SEARCH FOR A ZERO ARGUMENT.                                           DJCG-027
      IF (J3.EQ.0) GO TO 4                                              DJCG-028
      IF ((J1.EQ.0).OR.(J2.EQ.0)) GO TO 5                               DJCG-029
      IF (M3.EQ.0) GO TO 6                                              DJCG-030
      IF (M2.EQ.0) GO TO 7                                              DJCG-031
      IF (M1.EQ.0) GO TO 8                                              DJCG-032
C GENERAL CASE.                                                         DJCG-033
    1 NX=IX1+IX2+IX3                                                    DJCG-034
      IZ1=NX-IX1-IY1                                                    DJCG-035
      IZ2=NX-IX2-IY2                                                    DJCG-036
      IZ3=NX-IX3-IY3                                                    DJCG-037
      IF ((IZ1.LE.0).OR.(IZ2.LE.0).OR.(IZ3.LE.0)) RETURN                DJCG-038
      NXY=NX-1                                                          DJCG-039
      I1=IX2-IY3                                                        DJCG-040
      I2=IY1-IX3                                                        DJCG-041
C K1 AND K2 ARE THE LIMITS OF THE SUM.                                  DJCG-042
C M1,M2,M3,K1,K3,K4 HAVE THEIR FACTORIALS IN THE DENOMINATOR            DJCG-043
C NXY=J1+J2+J3+1      IZ1,IZ2,IZ3  ARE J1+J2-J3, J1-J2+J3 AND -J1+J2+J3.DJCG-044
      K1=MAX0(I1,I2,0)+1                                                DJCG-045
      K2=MIN0(IY1,IX2,IZ3)                                              DJCG-046
      K3=K1-I1                                                          DJCG-047
      K4=K1-I2                                                          DJCG-048
      N1=IY1-K1+1                                                       DJCG-049
      N2=IX2-K1+1                                                       DJCG-050
      N3=IZ3-K1+1                                                       DJCG-051
      DJCG=DEXP(0.5D0*(FAC(IX3+IY3)-FAC(IX3+IY3-1)-FAC(NXY)+FAC(IZ1)+FACDJCG-052
     1(IZ2)+FAC(IZ3)+FAC(IX1)+FAC(IX2)+FAC(IX3)+FAC(IY1)+FAC(IY2)+FAC(IYDJCG-053
     23))-FAC(N1)-FAC(N2)-FAC(N3)-FAC(K1)-FAC(K3)-FAC(K4))              DJCG-054
      IF (2*(K1/2).EQ.K1) DJCG=-DJCG                                    DJCG-055
      IF (K1.EQ.K2) GO TO 3                                             DJCG-056
      A4=DJCG                                                           DJCG-057
      K=K2-K1                                                           DJCG-058
      K3=K2-I1                                                          DJCG-059
      K4=K2-I2                                                          DJCG-060
      N1=IY1-K2                                                         DJCG-061
      N2=IX2-K2                                                         DJCG-062
      N3=IZ3-K2                                                         DJCG-063
C K2,K3,K4,N1,N2,N3 ARE THE ARGUMENTS OF THE FACTORIALS IN THE LAST TERMDJCG-064
      DO 2 I=1,K                                                        DJCG-065
      A1=DFLOAT((K2-I)*(K3-I)*(K4-I))                                   DJCG-066
      A2=DFLOAT((N1+I)*(N2+I)*(N3+I))                                   DJCG-067
    2 DJCG=A4-DJCG*A2/A1                                                DJCG-068
    3 RETURN                                                            DJCG-069
C J1,J2 OR J3  IS ZERO.                                                 DJCG-070
    4 IF (J1.NE.J2) RETURN                                              DJCG-071
      A1=DFLOAT(J1+1)                                                   DJCG-072
      DJCG=1.D0/DSQRT(A1)                                               DJCG-073
      IF (MOD(IY1,2).EQ.0) DJCG=-DJCG                                   DJCG-074
      RETURN                                                            DJCG-075
    5 IF (J1+J2.NE.J3) RETURN                                           DJCG-076
      DJCG=1.D0                                                         DJCG-077
      RETURN                                                            DJCG-078
C M1,M2 OR M3 IS ZERO; IF THE OTHERS M ARE LARGER THAN 1/2,GENERAL CASE.DJCG-079
    6 IF (IABS(M1)-1) 9 , 10 , 1                                        DJCG-080
    7 IF (IABS(M1).GT.1) GO TO 1                                        DJCG-081
      GO TO 11                                                          DJCG-082
    8 IF (IABS(M3).GT.1) GO TO 1                                        DJCG-083
      GO TO 12                                                          DJCG-084
C ALL THE M ARE ZEROS.                                                  DJCG-085
    9 N5=IX1+IX2+IX3-1                                                  DJCG-086
      IF (2*(N5/2).NE.N5) RETURN                                        DJCG-087
      N2=IX1+IX2-IX3                                                    DJCG-088
      N3=IX2+IX3-IX1                                                    DJCG-089
      N4=IX3+IX1-IX2                                                    DJCG-090
      A1=FAC(2*IX3)-FAC(2*IX3-1)                                        DJCG-091
      KC=1                                                              DJCG-092
      GO TO 14                                                          DJCG-093
C ONE M IS ZERO AND THE OTHERS +-1/2  FORMULA OF DCGS.                  DJCG-094
   10 IQ=IX3-1                                                          DJCG-095
      IZ1=IX1+IX2-2                                                     DJCG-096
      IZ2=IX1-IY2                                                       DJCG-097
      LZ1=J1                                                            DJCG-098
      LZ2=J2                                                            DJCG-099
      LW2=M2                                                            DJCG-100
      LW1=IY1                                                           DJCG-101
      GO TO 13                                                          DJCG-102
   11 IQ=IX2-1                                                          DJCG-103
      IZ1=IX1+IX3-2                                                     DJCG-104
      IZ2=IX3-IY1                                                       DJCG-105
      LZ1=J1                                                            DJCG-106
      LZ2=J3                                                            DJCG-107
      LW2=M1                                                            DJCG-108
      LW1=IY3                                                           DJCG-109
      GO TO 13                                                          DJCG-110
   12 IQ=IX1-1                                                          DJCG-111
      IZ1=IX2+IX3-2                                                     DJCG-112
      IZ2=IX2-IY3                                                       DJCG-113
      LZ1=J2                                                            DJCG-114
      LZ2=J3                                                            DJCG-115
      LW2=-M3                                                           DJCG-116
      LW1=IY2                                                           DJCG-117
   13 N2=IZ1-IQ+1                                                       DJCG-118
      N3=IQ+IZ2+1                                                       DJCG-119
      N4=IQ-IZ2+1                                                       DJCG-120
      IF (N2.LT.1.OR.N3.LT.1.OR.N4.LT.1) RETURN                         DJCG-121
      N5=IZ1+IQ+2                                                       DJCG-122
      A1=FAC(J3+2)-FAC(J3+1)-FAC(LZ1+2)+FAC(LZ1+1)-FAC(LZ2+2)+FAC(LZ2+1)DJCG-123
      KC=2                                                              DJCG-124
C SIMPLE FORMULA.                                                       DJCG-125
   14 IF (N5-1.GT.NFA) GO TO 18                                         DJCG-126
      L1=(N5+1)/2                                                       DJCG-127
      L2=(N2+1)/2                                                       DJCG-128
      L3=(N3+1)/2                                                       DJCG-129
      L4=(N4+1)/2                                                       DJCG-130
      DJCG=DEXP(0.5D0*(A1+FAC(N2)+FAC(N3)+FAC(N4)-FAC(N5))+FAC(L1)-FAC(LDJCG-131
     12)-FAC(L3)-FAC(L4))                                               DJCG-132
      IF (KC.EQ.2) GO TO 15                                             DJCG-133
      IF (MOD(L1+IX1-IX2,2).EQ.0) DJCG=-DJCG                            DJCG-134
      RETURN                                                            DJCG-135
   15 IF (LW2.GT.0) L4=L4+N5+1                                          DJCG-136
      DJCG=2.D0*DJCG                                                    DJCG-137
      IF (MOD(L4+LW1+IX1-IY2,2).NE.0) DJCG=-DJCG                        DJCG-138
      RETURN                                                            DJCG-139
   16 WRITE (MW,1000)                                                   DJCG-140
      RETURN                                                            DJCG-141
   17 WRITE (MW,1001)                                                   DJCG-142
      RETURN                                                            DJCG-143
   18 WRITE (MW,1002)                                                   DJCG-144
      RETURN                                                            DJCG-145
 1000 FORMAT (' NEGATIVE ANGULAR MOMENTUM IN DJCG.')                    DJCG-146
 1001 FORMAT (' INTEGER/HALF-INTEGER RULE BETWEEN QUANTUM NUMBERS TRANSGDJCG-147
     1RESSED IN DJCG.')                                                 DJCG-148
 1002 FORMAT (' FACTORIAL TOO LARGE IN DJCG.')                          DJCG-149
      END                                                               DJCG-150
C 13/04/06                                                      ECIS06  DJ6J-000
      FUNCTION DJ6J(J1,J2,J3,J4,J5,J6,FAC,NFA)                          DJ6J-001
C COMPUTATION OF SIX-J COEFFICIENTS.                                    DJ6J-002
C INPUT:     J1..J6:  DOUBLE VALUE OF ANGULAR MOMENTA.                  DJ6J-003
C            FAC:     TABLE OF LOGARITHM OF FACTORIALS.                 DJ6J-004
C            NFA:     LENGTH OF FAC.                                    DJ6J-005
C OUTPUT:                                                               DJ6J-006
C                                  ( J1  J2  J3 )                       DJ6J-007
C            6-J COEFFICIENTS      )            (                       DJ6J-008
C                                  ( J4  J5  J6 )                       DJ6J-009
C                                                                       DJ6J-010
C***********************************************************************DJ6J-011
      IMPLICIT REAL*8(A-F)                                              DJ6J-012
      DIMENSION IX(6),IA(3,4),IY(4),FAC(*)                              DJ6J-013
      COMMON /INOUT/ MR,MW,MS                                           DJ6J-014
      DATA IA /1,2,3,1,5,6,4,2,6,4,5,3/                                 DJ6J-015
      DJ6J=0.D0                                                         DJ6J-016
      IX(1)=J1                                                          DJ6J-017
      IX(2)=J2                                                          DJ6J-018
      IX(3)=J3                                                          DJ6J-019
      IX(4)=J4                                                          DJ6J-020
      IX(5)=J5                                                          DJ6J-021
      IX(6)=J6                                                          DJ6J-022
C THE QUANTUM NUMBERS MULTIPLIED BY 2 ARE IN THE TABLE IX.              DJ6J-023
C SEARCH FOR A ZERO QUANTUM NUMBER.                                     DJ6J-024
      DO 1 I=1,6                                                        DJ6J-025
      IF (IX(I).LT.0) GO TO 14                                          DJ6J-026
      IF (IX(I).EQ.0) GO TO ( 5 , 6 , 7 , 8 , 9, 10 ),I                 DJ6J-027
    1 CONTINUE                                                          DJ6J-028
C GENERAL CASE.                                                         DJ6J-029
C CHECK OF THE TRIANGULAR RELATIONS AND COMPUTATION OF DELTA.           DJ6J-030
      DO 2 K=1,4                                                        DJ6J-031
      IZ1=IA(1,K)                                                       DJ6J-032
      IZ2=IA(2,K)                                                       DJ6J-033
      IZ3=IA(3,K)                                                       DJ6J-034
      IX1=IX(IZ1)                                                       DJ6J-035
      IX2=IX(IZ2)                                                       DJ6J-036
      IX3=IX(IZ3)                                                       DJ6J-037
      N=IX1+IX2+IX3+2                                                   DJ6J-038
      I1=N/2                                                            DJ6J-039
      IF (2*I1.NE.N) GO TO 12                                           DJ6J-040
      IF (I1.GT.NFA) GO TO 13                                           DJ6J-041
      N1=I1-IX3                                                         DJ6J-042
      N2=I1-IX2                                                         DJ6J-043
      N3=I1-IX1                                                         DJ6J-044
      IF ((I1.LE.0).OR.(N1.LE.0).OR.(N2.LE.0).OR.(N3.LE.0)) GO TO 15    DJ6J-045
      IY(K)=I1+1                                                        DJ6J-046
    2 DJ6J=DJ6J+FAC(N1)-FAC(I1+1)+FAC(N2)+FAC(N3)                       DJ6J-047
      N1=(IX(1)+IX(2)+IX(4)+IX(5))/2                                    DJ6J-048
      N2=(IX(1)+IX(3)+IX(4)+IX(6))/2                                    DJ6J-049
      N3=(IX(2)+IX(3)+IX(5)+IX(6))/2                                    DJ6J-050
C K1 AND K2 ARE THE LIMITS OF THE SUM.                                  DJ6J-051
C K1, L1, L2, L3, L4, M1, M2, M3 ARE THE FACTORIALS OF THE FIRST TERM.  DJ6J-052
      K1=MAX0(IY(1),IY(2),IY(3),IY(4))                                  DJ6J-053
      K2=MIN0(N1,N2,N3)+2                                               DJ6J-054
      L1=K1-IY(1)+1                                                     DJ6J-055
      L2=K1-IY(2)+1                                                     DJ6J-056
      L3=K1-IY(3)+1                                                     DJ6J-057
      L4=K1-IY(4)+1                                                     DJ6J-058
      M1=N1-K1+3                                                        DJ6J-059
      M2=N2-K1+3                                                        DJ6J-060
      M3=N3-K1+3                                                        DJ6J-061
      DJ6J=DEXP(.5D0*DJ6J+FAC(K1)-FAC(L1)-FAC(L2)-FAC(L3)-FAC(L4)-FAC(M1DJ6J-062
     1)-FAC(M2)-FAC(M3))                                                DJ6J-063
      IF (2*(K1/2).NE.K1) DJ6J=-DJ6J                                    DJ6J-064
      IF (K2.EQ.K1) GO TO 4                                             DJ6J-065
      A2=DJ6J                                                           DJ6J-066
      K=K2-K1                                                           DJ6J-067
    3 A1=DFLOAT((M1-K)*(M2-K)*(M3-K))                                   DJ6J-068
      K=K-1                                                             DJ6J-069
      A3=DFLOAT((L1+K)*(L2+K)*(L3+K)*(L4+K))                            DJ6J-070
      DJ6J=A2-DFLOAT(K1+K)*A1*DJ6J/A3                                   DJ6J-071
      IF (K.GT.0) GO TO 3                                               DJ6J-072
    4 RETURN                                                            DJ6J-073
C ONE QUANTUM NUMBER IS ZERO; VERIFICATION OF THE TRIANGULAR RELATION.  DJ6J-074
    5 IF (IX(2).NE.IX(3).OR.IX(5).NE.IX(6)) GO TO 15                    DJ6J-075
      IX(6)=IX(4)                                                       DJ6J-076
      IX(1)=IX(2)                                                       DJ6J-077
      IX(4)=IX(5)                                                       DJ6J-078
      GO TO 11                                                          DJ6J-079
    6 IF (IX(1).NE.IX(3).OR.IX(4).NE.IX(6)) GO TO 15                    DJ6J-080
      IX(6)=IX(5)                                                       DJ6J-081
      GO TO 11                                                          DJ6J-082
    7 IF (IX(1).NE.IX(2).OR.IX(4).NE.IX(5)) GO TO 15                    DJ6J-083
      IF (IX(4).NE.IX(5)) GO TO 15                                      DJ6J-084
      GO TO 11                                                          DJ6J-085
    8 IF (IX(2).NE.IX(6).OR.IX(3).NE.IX(5)) GO TO 15                    DJ6J-086
      IX(6)=IX(1)                                                       DJ6J-087
      IX(1)=IX(5)                                                       DJ6J-088
      IX(4)=IX(2)                                                       DJ6J-089
      GO TO 11                                                          DJ6J-090
    9 IF (IX(1).NE.IX(6).OR.IX(3).NE.IX(4)) GO TO 15                    DJ6J-091
      IX(6)=IX(2)                                                       DJ6J-092
      GO TO 11                                                          DJ6J-093
   10 IF (IX(1).NE.IX(5).OR.IX(2).NE.IX(4)) GO TO 15                    DJ6J-094
      IX(6)=IX(3)                                                       DJ6J-095
C VALUE OF 6-J COEFFICIENT WITH ONE QUANTUM NUMBER ZERO.                DJ6J-096
   11 IF (MIN0(IX(1),IX(4),IX(6)).LT.0) GO TO 14                        DJ6J-097
      IF (IX(6).GT.IX(1)+IX(4).OR.IX(6).LT.IABS(IX(1)-IX(4))) GO TO 15  DJ6J-098
      IF (MAX0(IX(1),IX(4)).GT.NFA) GO TO 13                            DJ6J-099
      K=IX(1)+IX(4)+IX(6)                                               DJ6J-100
      N=K/2                                                             DJ6J-101
      IF (2*N.NE.K) GO TO 12                                            DJ6J-102
      DJ6J=DFLOAT(1-2*MOD(N,2))/DSQRT(DFLOAT((IX(1)+1)*(IX(4)+1)))      DJ6J-103
      RETURN                                                            DJ6J-104
   12 WRITE (MW,1000)                                                   DJ6J-105
      GO TO 15                                                          DJ6J-106
   13 WRITE (MW,1001)                                                   DJ6J-107
      GO TO 15                                                          DJ6J-108
   14 WRITE (MW,1002)                                                   DJ6J-109
   15 DJ6J=0.D0                                                         DJ6J-110
      RETURN                                                            DJ6J-111
 1000 FORMAT (' VIOLATION OF THE INTEGER/HALF-INTEGER RULE BETWEEN QUANTDJ6J-112
     1UM NUMBERS IN DJ6J.')                                             DJ6J-113
 1001 FORMAT (' FACTORIAL TOO LARGE FOR DJ6J.')                         DJ6J-114
 1002 FORMAT (' NEGATIVE ANGULAR MOMENTUM IN DJ6J.')                    DJ6J-115
      END                                                               DJ6J-116
C 27/06/06                                                      ECIS06  DJ9J-000
      FUNCTION DJ9J(J1,J2,J3,J4,J5,J6,J7,J8,J9,AA,ITO)                  DJ9J-001
C COMPUTATION OF 9-J COEFFICIENTS.                                      DJ9J-002
C INPUT:     J1,..J9: INTEGER DOUBLED VALUES.                           DJ9J-003
C OUTPUT:                             | J1  J2  J3 |                    DJ9J-004
C                                     |            |                    DJ9J-005
C   9J(J1,J2,J3,J4,J5,J6,J7,J8,J9) =  | J4  J5  J6 |                    DJ9J-006
C                                     |            |                    DJ9J-007
C                                     | J7  J8  J9 |                    DJ9J-008
C                                                                       DJ9J-009
C WORKING AREA:                                                         DJ9J-010
C            AA:      FOR COMPUTATION OF UNNORMALISED 6-J COEFFICIENTS  DJ9J-011
C                     BY RECURRENCE.                                    DJ9J-012
C            ITO:     LENGTH OF AA.                                     DJ9J-013
C***********************************************************************DJ9J-014
      IMPLICIT REAL*8 (A-H,O-Z)                                         DJ9J-015
      DIMENSION AA(*),J(5),IX(9),JX(3,3),JS(3),JF(3),IA(5,3),IB(3)      DJ9J-016
      EQUIVALENCE (IX(1),JX(1,1)),(IB(1),IB1),(IB(2),IB2),(IB(3),IB3)   DJ9J-017
      COMMON /INOUT/ MR,MW,MS                                           DJ9J-018
      DATA IA /1,2,3,6,9,6,4,5,8,2,8,9,7,1,4/                           DJ9J-019
      DJ9J=0.D0                                                         DJ9J-020
      IX(1)=J1                                                          DJ9J-021
      IX(2)=J2                                                          DJ9J-022
      IX(3)=J3                                                          DJ9J-023
      IX(4)=J4                                                          DJ9J-024
      IX(5)=J5                                                          DJ9J-025
      IX(6)=J6                                                          DJ9J-026
      IX(7)=J7                                                          DJ9J-027
      IX(8)=J8                                                          DJ9J-028
      IX(9)=J9                                                          DJ9J-029
      DO 2 I=1,3                                                        DJ9J-030
      DO 1 K=1,3                                                        DJ9J-031
      IF (JX(K,I).LT.0) GO TO 13                                        DJ9J-032
    1 CONTINUE                                                          DJ9J-033
C CHECK OF TRIANGULAR RELATIONS.                                        DJ9J-034
      IF (MOD(JX(1,I)+JX(2,I)+JX(3,I),2).NE.0.OR.MOD(JX(I,1)+JX(I,2)+JX(DJ9J-035
     1I,3),2).NE.0) GO TO 11                                            DJ9J-036
      IF (IABS(JX(1,I)-JX(2,I)).GT.JX(3,I).OR.JX(1,I)+JX(2,I).LT.JX(3,I)DJ9J-037
     1) RETURN                                                          DJ9J-038
      IF (IABS(JX(I,1)-JX(I,2)).GT.JX(I,3).OR.JX(I,1)+JX(I,2).LT.JX(I,3)DJ9J-039
     1) RETURN                                                          DJ9J-040
    2 CONTINUE                                                          DJ9J-041
C SEARCH OF THE CONFIGURATION FOR WHICH THE SUM ON PRODUCTS OF 6-J      DJ9J-042
C COEFFICIENTS IS THE SMALLEST ONE.                                     DJ9J-043
      K1=MIN0(IX(3),IX(5),IX(7))                                        DJ9J-044
      K2=MIN0(IX(2),IX(4),IX(9))                                        DJ9J-045
      K3=MIN0(IX(1),IX(6),IX(8))                                        DJ9J-046
      KT=MAX0(K1,K2,K3)                                                 DJ9J-047
      IF (KT.EQ.K1) GO TO 6                                             DJ9J-048
      IF (K2.GT.K3) GO TO 4                                             DJ9J-049
      DO 3 I=1,3                                                        DJ9J-050
      II=IX(I)                                                          DJ9J-051
      IX(I)=IX(I+3)                                                     DJ9J-052
      IX(I+3)=IX(I+6)                                                   DJ9J-053
    3 IX(I+6)=II                                                        DJ9J-054
      GO TO 6                                                           DJ9J-055
    4 DO 5 I=1,3                                                        DJ9J-056
      II=IX(I+6)                                                        DJ9J-057
      IX(I+6)=IX(I+3)                                                   DJ9J-058
      IX(I+3)=IX(I)                                                     DJ9J-059
    5 IX(I)=II                                                          DJ9J-060
    6 DO 7 K=1,3                                                        DJ9J-061
      IA1=IA(1,K)                                                       DJ9J-062
      IA2=IA(2,K)                                                       DJ9J-063
      IA4=IA(4,K)                                                       DJ9J-064
      IA5=IA(5,K)                                                       DJ9J-065
      JS(K)=MAX0(IABS(IX(IA1)-IX(IA5)),IABS(IX(IA4)-IX(IA2)))+1         DJ9J-066
    7 JF(K)=MIN0(IX(IA1)+IX(IA5),IX(IA2)+IX(IA4))+1                     DJ9J-067
      KF=MIN0(JF(1),JF(2),JF(3))                                        DJ9J-068
      KT=2+(KF-MAX0(JS(1),JS(2),JS(3)))/2                               DJ9J-069
C LOOP ON THE THREE 6-J COEFFICIENTS.                                   DJ9J-070
      ITX=0                                                             DJ9J-071
      AZ=1.D0                                                           DJ9J-072
      DO 9 K=1,3                                                        DJ9J-073
      IJ=ITX                                                            DJ9J-074
      IB(K)=ITX+(JF(K)-KF)/2                                            DJ9J-075
      DO 8 I=1,5                                                        DJ9J-076
      IA1=IA(I,K)                                                       DJ9J-077
    8 J(I)=IX(IA1)                                                      DJ9J-078
      JT=2+(JF(K)-JS(K))/2                                              DJ9J-079
      ITX=ITX+JT                                                        DJ9J-080
      IF (ITX.GT.ITO) GO TO 12                                          DJ9J-081
      AT=DFLOAT(JF(K))                                                  DJ9J-082
      CALL DX6J(AA(1+IJ),AT,J,JT)                                       DJ9J-083
    9 AZ=AZ*AT*DFLOAT(J(3)+1)                                           DJ9J-084
C SUMMATION ON PRODUCTS OF 6-J.                                         DJ9J-085
      AF=DFLOAT(KF)                                                     DJ9J-086
      DO 10 I=2,KT                                                      DJ9J-087
      DJ9J=DJ9J+AF*AA(I+IB1)*AA(I+IB2)*AA(I+IB3)                        DJ9J-088
   10 AF=AF-2.D0                                                        DJ9J-089
C NORMALISATION.                                                        DJ9J-090
      DJ9J=DJ9J/DSQRT(AZ)                                               DJ9J-091
      RETURN                                                            DJ9J-092
   11 WRITE (MW,1000)                                                   DJ9J-093
      RETURN                                                            DJ9J-094
   12 WRITE (MW,1001)                                                   DJ9J-095
      RETURN                                                            DJ9J-096
   13 WRITE (MW,1002)                                                   DJ9J-097
      RETURN                                                            DJ9J-098
 1000 FORMAT (' INTEGER/HALF-INTEGER RULE BETWEEN QUANTUM NUMBERS TRANSGDJ9J-099
     1RESSED IN DJ9J.')                                                 DJ9J-100
 1001 FORMAT (' TOO MANY 6-J NEEDED IN DJ9J.')                          DJ9J-101
 1002 FORMAT (' NEGATIVE ANGULAR MOMENTUM IN DJ9J.')                    DJ9J-102
      END                                                               DJ9J-103
C 27/06/06                                                      ECIS06  DX6J-000
      SUBROUTINE DX6J(AA,AT,J,JT)                                       DX6J-001
C RECURRENCE COMPUTATION OF UNNORMALISED 6-J COEFFICIENTS.              DX6J-002
C                       ( J(1)  J(2)  J(3) )                            DX6J-003
C 6-J COEFFICIENTS      )                  ( FOR ALL VALUES OF JJ.      DX6J-004
C                       ( J(4)  J(5)   JJ  )                            DX6J-005
C INPUT:     J:       INTEGER DOUBLED VALUES.                           DX6J-006
C            JT:      NUMBER OF 6J COEFFICIENTS PLUS ONE.               DX6J-007
C OUTPUT:    AA:      UNNORMALISED 6J COEFFICIENTS IN AA(2) TO AA(JT)   DX6J-008
C                     STARTING FROM THE LARGEST VALUE OF JJ; AA(1)=0.   DX6J-009
C            AT:      NORMALISATION: THE VALUES AA MUST BE DIVIDED BY   DX6J-010
C                     (-)**(J(1)+J(2)+J(4)+J(5))*SQRT((J(3)+1)*AT).     DX6J-011
C***********************************************************************DX6J-012
      IMPLICIT REAL*8 (A-H,O-Z)                                         DX6J-013
      DIMENSION AA(*),J(5)                                              DX6J-014
      AA(1)=0.D0                                                        DX6J-015
      AA(2)=1.D0                                                        DX6J-016
      IF (JT.LE.2) RETURN                                               DX6J-017
      AL=AT                                                             DX6J-018
      C2=0.D0                                                           DX6J-019
      BK1=DFLOAT(J(1)-J(5))**2                                          DX6J-020
      BK3=DFLOAT(J(2)-J(4))**2                                          DX6J-021
      BK2=DFLOAT(J(1)+J(5)+2)**2                                        DX6J-022
      BK4=DFLOAT(J(2)+J(4)+2)**2                                        DX6J-023
      D1=DFLOAT(J(1)-J(5))*DFLOAT(J(1)+J(5)+2)*DFLOAT(J(4)-J(2))*DFLOAT(DX6J-024
     1J(2)+J(4)+2)/16.D0                                                DX6J-025
      D2=(BK1+BK2+BK3+BK4-DFLOAT(4*J(3)*(J(3)+2)))/8.D0-1.D0            DX6J-026
      BK=(AL+1.D0)**2                                                   DX6J-027
      DO 2 I=3,JT                                                       DX6J-028
      C1=C2                                                             DX6J-029
      BK=BK-AL*4.D0                                                     DX6J-030
      C2=.03125D0*DSQRT((BK3-BK)*(BK1-BK)*(BK2-BK)*(BK4-BK))            DX6J-031
      D4=.5D0*(AL+.5D0*BK-1.D0)                                         DX6J-032
      AA(I)=-(AL*(D1+(D2-D4)*D4)*AA(I-1)+(AL-1.D0)*C1*AA(I-2))/(C2*(AL+1DX6J-033
     1.D0))                                                             DX6J-034
      AL=AL-2.D0                                                        DX6J-035
      AT=AT+AL*AA(I)*AA(I)                                              DX6J-036
      IF (AT.LT.1.D12) GO TO 2                                          DX6J-037
      AT=AT*1.D-24                                                      DX6J-038
      DO 1 II=2,I                                                       DX6J-039
    1 AA(II)=AA(II)*1.D-12                                              DX6J-040
    2 CONTINUE                                                          DX6J-041
      RETURN                                                            DX6J-042
      END                                                               DX6J-043
C 28/02/07                                                      ECIS06  EXTP-000
      SUBROUTINE EXTP(NCOLL,NCOLT,WV,NIV,IQ,IVY,IVQ,IPI,FAC,VAL,NVAL,LL,EXTP-001
     1IPP,PIP,IDT,LO)                                                   EXTP-002
C INPUT AND SETUP OF EXTERNAL FORM FACTORS, ELASTIC AND TRANSITIONS.    EXTP-003
C INPUT:     NCOLL:   NUMBER OF COUPLED NUCLEAR STATES.                 EXTP-004
C            NCOLT:   NUMBER OF NUCLEAR STATES INCLUDING UNCOUPLED ONES.EXTP-005
C            WV:      MASSES OF PARTICLE AND TARGET IN WV(1/2,*).       EXTP-006
C            NIV:     ADDRESSES IN TABLE OF NUCLEAR MATRIX ELEMENTS.    EXTP-007
C            IQ:      TABLE OF REDUCED NUCLEAR MATRIX ELEMENTS.         EXTP-008
C            IVY:     TABLE OF FORM FACTORS (SEE REDM).                 EXTP-009
C            IVQ:     TABLE OF ANGULAR MOMENTA (SEE REDM).              EXTP-010
C            IPI(5,*):REFERENCE TO POTENTIALS.                          EXTP-011
C            FAC:     TABLE OF LOGARITHM OF FACTORIALS.                 EXTP-012
C            IPP,PIP: DISPERSION RELATIONS, EQUIVALENT BY CALL.         EXTP-013
C            IDT:     SIZE OF AVAILABLE WORKING SPACE.                  EXTP-014
C            LO(I):   LOGICAL CONTROLS:                                 EXTP-015
C               LO(6)  =.TRUE. USE DEFORMATION LENGTHS.                 EXTP-016
C               LO(10) =.TRUE. DISPERSION RELATIONS FOR POTENTIALS.     EXTP-017
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            EXTP-018
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. EXTP-019
C               LO(16) =.TRUE. HEAVY-ION DEFINITION OF REDUCED RADII ANDEXTP-020
C                              DEFORMATIONS.                            EXTP-021
C               LO(73) =.TRUE. NO OUTPUT OF EXTERNAL POTENTIALS WHEN    EXTP-022
C                              THEY ARE READ.                           EXTP-023
C               LO(99) =.TRUE. SCHROEDINGER EQUIVALENT TO DIRAC         EXTP-024
C                              EQUATION.                                EXTP-025
C               LO(100)=.TRUE. DIRAC EQUATION.                          EXTP-026
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    EXTP-027
C               LO(102)=.TRUE. THERE IS AN IMAGINARY SPIN-ORBIT         EXTP-028
C                              POTENTIAL.                               EXTP-029
C OUTPUT:    VAL,NVAL:IN EQUIVALENCE BY CALL, FOR PARAMETERS READ HERE. EXTP-030
C                     NVA(1) FIRST ADDRESS AFTER LL.                    EXTP-031
C                     NVA(2) NUMBER OF SETS OF FOLDING PARAMETERS.      EXTP-032
C                     NVA(3) FIRST ADDRESS OF FOLDING PARAMETERS.       EXTP-033
C                     NVA(4) LAST ADDRESS OF FOLDING PARAMETERS.        EXTP-034
C            LL:      ADDRESSES IN VA IN EQUIVALENCE WITH NVA(1,3):     EXTP-035
C                     LL(1,ITYP,K) FIRST ADDRESS OF PARAMETERS WHICH CANEXTP-036
C                     BE VARIED FOR ITYP AND FORM FACTOR K, 1 FOR FORM  EXTP-037
C                     FACTORS NOT USED.                                 EXTP-038
C                     LL(2,ITYP,K) LAST ADDRESS FOR ITYP AND FORM FACTOREXTP-039
C                     K, -1 FOR FORM FACTORS NOT USED.                  EXTP-040
C                                                                       EXTP-041
C FOR THE COMMON  /POTE1/ SEE REDM.                                     EXTP-042
C                                                                       EXTP-043
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE1/:                     EXTP-044
C  INTC:      NUMBER OF FORM FACTORS WITHOUT DEFORMED SPIN-ORBIT        EXTP-045
C             INCLUDING CORRECTION TERMS.                               EXTP-046
C  INLS:      NUMBER OF SPIN-ORBIT FORM FACTORS NOT TAKING INTO ACCOUNT EXTP-047
C             MULTIPLICATION BY 2.                                      EXTP-048
C  INVC:      NUMBER OF COULOMB TRANSITION FORM FACTORS.                EXTP-049
C  INVD:      IDEM FOR COULOMB SPIN-ORBIT.                              EXTP-050
C   USED:     INTC,INLS,INVC,INVD.                                      EXTP-051
C                                                                       EXTP-052
C***********************************************************************EXTP-053
C ITYP 1 REAL VOLUME OR DIRAC SCALAR POTENTIAL.                         EXTP-054
C      2 IMAGINARY VOLUME OR DIRAC SCALAR POTENTIAL.                    EXTP-055
C      3 REAL SURFACE OR DIRAC VECTOR POTENTIAL.                        EXTP-056
C      4 IMAGINARY SURFACE OR DIRAC VECTOR POTENTIAL.                   EXTP-057
C      5 REAL SPIN-ORBIT OR DIRAC TENSOR POTENTIAL.                     EXTP-058
C      6 IMAGINARY SPIN-ORBIT OR DIRAC TENSOR POTENTIAL.                EXTP-059
C      7 COULOMB POTENTIAL.                                             EXTP-060
C      8 COULOMB SPIN-ORBIT POTENTIAL.                                  EXTP-061
C                                                                       EXTP-062
C L1,L2 CONTROLS THE LEVEL TO POTENTIAL ASSIGNMENT.                     EXTP-063
C ML    IS 0 FOR THE POTENTIAL OR THE PLACE OF THE TRANSITION FORM.     EXTP-064
C       FACTOR IN THE SEQUENCE OF REDUCED MATRIX ELEMENTS.              EXTP-065
C       THE FORM FACTORS CONTAIN THE DEFORMATION.                       EXTP-066
C L1X,L2X,MLX  FORM FACTOR COPIED TO L1,L2,ML.                          EXTP-067
C                                                                       EXTP-068
C THE SPIN-ORBIT TRANSITION FORM FACTOR TO BE READ IS THE SECOND ONE    EXTP-069
C MULTIPLIED BY R**2. (MULTIPOLE OF AN ORDINARY WOODS-SAXON POTENTIAL). EXTP-070
C                                                                       EXTP-071
C ITYPX  -1  WOODS-SAXON POTENTIAL.                                     EXTP-072
C        -2  FIRST DERIVATIVE   MULTIPLIED BY R/SQRT(4*PI).             EXTP-073
C        -3  SECOND DERIVATIVE  MULTIPLIED BY R**2/(8*PI).              EXTP-074
C        -4  THIRD DERIVATIVE   MULTIPLIED BY R**3/(48*PI**(3/2)).      EXTP-075
C        -5  DEFORMED WOODS-SAXON POTENTIAL.                            EXTP-076
C        -6  DERIVATIVE OF DEFORMED WOODS-SAXON POTENTIAL.              EXTP-077
C        -7  LAGUERRE POLYNOMIAL.                                       EXTP-078
C        -8  SOLUTION IN REAL WOODS-SAXON POTENTIAL.                    EXTP-079
C        -9  BESSEL EXPANSION.                                          EXTP-080
C       -10  LAGUERRE EXPANSION.                                        EXTP-081
C L2X GIVES THE NUMBER OF DEFORMATIONS, OF NODES, OF BESSEL FUNCTIONS,  EXTP-082
C                      OF LAGUERRE POLYNOMIALS.                         EXTP-083
C MLX IS THE L-VALUE OF BESSEL OR LAGUERRE EXPANSION, OR NUMBER OF BOUNDEXTP-084
C FUNCTIONS: =0 OR 1 FOR ONE WITH THE QUANTUM NUMBERS OF THE TRANSITION,EXTP-085
C            =2 FOR TWO FUNCTIONS WITH THE SAME ITYPX,                  EXTP-086
C            =3 WHEN ITYPX=-8 FOR LAGUERRE POLYNOMIAL AS THE SECOND ONE.EXTP-087
C MLX AND -L1X ARE QUANTUM NUMBERS OF VIBRATIONAL BAND:                 EXTP-088
C -L1X GIVES THE MULTIPLICATION OF STEP IN COMPUTING BOUND FUNCTION,    EXTP-089
C -L1X IS THE ORDER OF DERIVATION OF BESSEL OR LAGUERRE EXPANSION.      EXTP-090
C                                                                       EXTP-091
C ALLOWED VALUES OF ITYPX FOR STANDARD POTENTIALS                       EXTP-092
C ***********************************************                       EXTP-093
C **** ML IS 0 ****                                                     EXTP-094
C ITYPX =    -1       -2,-4    -5       -6       -7,-8    -9,-10        EXTP-095
C ITYP = 1   YES      NO       YES      NO       NO       YES           EXTP-096
C ITYP = 2   YES      NO       YES      NO       NO       YES           EXTP-097
C ITYP = 3   YES      NO       YES      NO       NO       YES           EXTP-098
C ITYP = 4   YES      NO       YES      NO       NO       YES           EXTP-099
C ITYP = 5   YES      NO       YES      NO       NO       YES           EXTP-100
C ITYP = 6   YES      NO       YES      NO       NO       YES           EXTP-101
C ITYP = 7   YES      NO       YES      NO       NO       YES           EXTP-102
C ITYP = 8   YES      NO       YES      NO       NO       YES           EXTP-103
C **** ML IS NOT 0 ****                                                 EXTP-104
C ITYP = 1   YES      YES      YES      YES      YES      YES           EXTP-105
C ITYP = 2   YES      YES      YES      YES      YES      YES           EXTP-106
C ITYP = 3   YES      YES      YES      YES      NO       YES           EXTP-107
C ITYP = 4   YES      YES      YES      YES      NO       YES           EXTP-108
C ITYP = 5   YES      YES      YES      YES      NO       YES           EXTP-109
C ITYP = 6   YES      YES      YES      YES      NO       YES           EXTP-110
C ITYP = 7   NO       YES      YES      YES      NO       YES           EXTP-111
C ITYP = 8   NO       YES      YES      YES      NO       YES           EXTP-112
C NUMBER OF PARAMETERS TO STORE:                                        EXTP-113
C ITYPX = -1,-4       -5        -6        -7        -8        -9,-10    EXTP-114
C INTEGER 6           7         8         15        15        9         EXTP-115
C REAL*8  4           4+L2X     4+L2X     1         23        2+L2X     EXTP-116
C THE ODD NUMBER OF INTEGER NEEDED IS ROUNDED TO NEXT EVEN VALUE        EXTP-117
C THERE IS ONE MORE FOR COULOMB POTENTIALS AND ITYPX=-1 TO -6.          EXTP-118
C THERE ARE 5 MORE PARAMETERS FOR ITYPX=-7 AND MLX=2.                   EXTP-119
C THERE ARE 16 OR 6 MORE PARAMETERS FOR ITYPX=-8 AND MLX=2 OR MLX=3.    EXTP-120
C                                                                       EXTP-121
C FOR THE COMMON  /COUPL/ SEE CALC.                                     EXTP-122
C                                                                       EXTP-123
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     EXTP-124
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       EXTP-125
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             EXTP-126
C   USED:     NFA,NPP.                                                  EXTP-127
C                                                                       EXTP-128
C***********************************************************************EXTP-129
      IMPLICIT REAL*8 (A-H,O-Z)                                         EXTP-130
      LOGICAL LO(150)                                                   EXTP-131
      DIMENSION WV(22,*),NIV(NCOLL,NCOLL,*),IQ(6,*),IVY(7,*),IVQ(3,*),IPEXTP-132
     1I(11,*),FAC(*),VAL(*),NVAL(*),LL(2,8,*),IPP(2,18,*),PIP(18,1),ITZ(EXTP-133
     210)                                                               EXTP-134
      CHARACTER*8 AA(3,8)                                               EXTP-135
      CHARACTER*4 IERM,LAST                                             EXTP-136
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   EXTP-137
      COMMON /INOUT/ MR,MW,MS                                           EXTP-138
      COMMON /POTE1/ ITX(16),IMAX,INTC,INLS,INVC,INVD,ITXM              EXTP-139
      DATA AA /'      RE','AL VOLUM','E/SCALAR',' IMAGINA','RY VOLUM','EEXTP-140
     1/SCALAR','     REA','L SURFAC','E/VECTOR','  IMAGIN','. SURFAC','EEXTP-141
     2/VECTOR','  REAL S','PIN-ORBI','T/TENSOR',' IMAG. S','PIN-ORBI','TEXTP-142
     3/TENSOR','        ','        ',' COULOMB','      SP','IN-ORBIT',' EXTP-143
     4COULOMB'/                                                         EXTP-144
      DATA ITZ /2,2,2,2,3,4,7,7,4,4/                                    EXTP-145
      DATA IERM /'LAST'/                                                EXTP-146
      IF (LO(99)) GO TO 44                                              EXTP-147
      NPX=NPP+INTC                                                      EXTP-148
      NMA=3+8*NPX                                                       EXTP-149
      NVAL(1)=NMA                                                       EXTP-150
      IF (NMA.GT.IDT) CALL MEMO('EXTP',IDT,NMA)                         EXTP-151
C SETTING THE CONTROLS OF INPUT                                         EXTP-152
      NTOT=0                                                            EXTP-153
      DO 9 I=1,NPX                                                      EXTP-154
      DO 1 J=1,8                                                        EXTP-155
      LL(1,J,I)=-1                                                      EXTP-156
    1 LL(2,J,I)=-1                                                      EXTP-157
      IF (I.GT.NPP) GO TO 2                                             EXTP-158
      IF (.NOT.LO(101)) LL(1,5,I)=1                                     EXTP-159
      IF (.NOT.LO(102)) LL(1,6,I)=1                                     EXTP-160
      IF (.NOT.LO(101)) LL(1,8,I)=1                                     EXTP-161
      GO TO 7                                                           EXTP-162
    2 K=I-NPP                                                           EXTP-163
      L=IVY(2,K)                                                        EXTP-164
      IF (IVQ(2,L).GE.0) GO TO 4                                        EXTP-165
      DO 3 L=1,6                                                        EXTP-166
    3 LL(1,L,I)=1                                                       EXTP-167
      LL(1,8,I)=1                                                       EXTP-168
      GO TO 7                                                           EXTP-169
    4 IF (LO(12)) GO TO 5                                               EXTP-170
      LL(1,2,I)=1                                                       EXTP-171
      LL(1,4,I)=1                                                       EXTP-172
    5 IF (LO(100)) GO TO 6                                              EXTP-173
      IF (K.GT.INLS) LL(1,5,I)=1                                        EXTP-174
      IF ((.NOT.LO(14)).OR.K.GT.INLS) LL(1,6,I)=1                       EXTP-175
      IF (K.GT.INVC) LL(1,7,I)=1                                        EXTP-176
      IF (K.GT.INVD) LL(1,8,I)=1                                        EXTP-177
      GO TO 7                                                           EXTP-178
    6 IF (IVY(3,K).EQ.0) LL(1,5,I)=1                                    EXTP-179
      IF ((.NOT.LO(14)).OR.IVY(3,K).EQ.0) LL(1,6,I)=1                   EXTP-180
      IF (IVY(4,K).EQ.0) LL(1,7,I)=1                                    EXTP-181
      IF (IVY(5,K).EQ.0) LL(1,8,I)=1                                    EXTP-182
C COUNT OF FORM FACTORS TO BE READ                                      EXTP-183
    7 DO 8 J=1,8                                                        EXTP-184
      IF (LL(1,J,I).EQ.-1) NTOT=NTOT+1                                  EXTP-185
    8 CONTINUE                                                          EXTP-186
    9 CONTINUE                                                          EXTP-187
      NFOLT=0                                                           EXTP-188
   10 IF (NTOT.LE.0) GO TO 42                                           EXTP-189
C INPUT OF A FORM FACTOR                                                EXTP-190
      READ (MR,1000,ERR= 45 ) L1,L2,ML,ITYP,L1X,L2X,MLX,ITYPX,NST,NFOLD,EXTP-191
     1MINT                                                              EXTP-192
      IF (ITYP.GT.8.OR.IABS(NST).GT.NCOLT.OR.ITYP.LE.0) GO TO 46        EXTP-193
      NFOLT=MAX0(NFOLT,NFOLD)                                           EXTP-194
      IF (IABS(ML).NE.0) GO TO 11                                       EXTP-195
C TEST FOR A POTENTIAL                                                  EXTP-196
      IF (L1.NE.L2.OR.L1.GT.NCOLT) GO TO 47                             EXTP-197
      LZ=IPI(5,L1)                                                      EXTP-198
      IF (NST.EQ.0) NST=L1                                              EXTP-199
      IF (.NOT.LO(73)) WRITE (MW,1001) (AA(K,ITYP),K=1,3),LZ            EXTP-200
      GO TO 14                                                          EXTP-201
C TEST FOR A TRANSITION                                                 EXTP-202
   11 IF (L1.GT.NCOLL.OR.L2.GT.NCOLL) GO TO 48                          EXTP-203
      LY=NIV(L1,L2,1)+IABS(ML)-1                                        EXTP-204
      IF (LY.GT.NIV(L1,L2,2)) GO TO 49                                  EXTP-205
      LX=IQ(1,LY)                                                       EXTP-206
      IF (ML.GT.0) GO TO 12                                             EXTP-207
      LX=IVY(6,LX)                                                      EXTP-208
      IF (LX.LE.0) GO TO 50                                             EXTP-209
   12 IF (LO(100)) GO TO 13                                             EXTP-210
      IF ((ITYP.EQ.5).OR.(ITYP.EQ.6)) LX=IVY(3,LX)                      EXTP-211
      IF (ITYP.GE.7) LX=IVY(ITYP-3,LX)                                  EXTP-212
   13 LZ=LX+NPP                                                         EXTP-213
      IF (NST.EQ.0) NST=1                                               EXTP-214
      IF (.NOT.LO(73)) WRITE (MW,1002) (AA(K,ITYP),K=1,3),L1,L2,ML      EXTP-215
C TEST IT IS NOT ALREADY READ AND THAT THERE IS PLACE                   EXTP-216
   14 IF (LL(1,ITYP,LZ).NE.-1) GO TO 51                                 EXTP-217
      IF (NMA+31.GT.IDT) CALL MEMO('EXTP',IDT,NMA+32)                   EXTP-218
      NTOT=NTOT-1                                                       EXTP-219
      NNA=2*NMA-1                                                       EXTP-220
      NVAL(NNA)=8*LZ+ITYP                                               EXTP-221
      NVAL(NNA+2)=NFOLD                                                 EXTP-222
      IF (ITYPX.LT.0.OR.L1X.LE.0) GO TO 21                              EXTP-223
      NVAL(NNA+5)=NMA                                                   EXTP-224
      NMD=NMA+3                                                         EXTP-225
      LL(1,ITYP,LZ)=NMD                                                 EXTP-226
      VAL(NMD)=1.D0                                                     EXTP-227
      IF (MINT.LT.0) READ (MR,1003,ERR= 59 ) VAL(NMD)                   EXTP-228
C USE OF ALREADY STORED FORM FACTOR/TEST EXISTENCE OF COPIED FORM FACTOREXTP-229
      IF (ITYP.NE.ITYPX) GO TO 52                                       EXTP-230
      IF (ML.NE.0) GO TO 15                                             EXTP-231
      IF (L1X.NE.L2X.OR.L1X.GT.NCOLT) GO TO 53                          EXTP-232
      LZX=IPI(5,L1X)                                                    EXTP-233
      IF (.NOT.LO(73)) WRITE (MW,1004) L1X,ITYPX,L1                     EXTP-234
      GO TO 17                                                          EXTP-235
   15 IF (L1X.GT.NCOLL.OR.L2X.GT.NCOLL) GO TO 54                        EXTP-236
      LYY=NIV(L1X,L2X,1)+MLX-1                                          EXTP-237
      IF (LYY.GT.NIV(L1X,L2X,2)) GO TO 55                               EXTP-238
      LXX=IQ(1,LYY)                                                     EXTP-239
      IF (LO(100)) GO TO 16                                             EXTP-240
      IF ((ITYP.EQ.5).OR.(ITYP.EQ.6)) LXX=IVY(3,LXX)                    EXTP-241
      IF (ITYP.GE.7) LXX=IVY(ITYP-3,LXX)                                EXTP-242
   16 LZX=LXX+NPP                                                       EXTP-243
      IF (.NOT.LO(73)) WRITE (MW,1005) L1X,L2X,MLX,ITYPX,L1,L2,ML       EXTP-244
   17 NMC=LL(1,ITYP,LZX)                                                EXTP-245
      IF (NMC.EQ.-1) GO TO 56                                           EXTP-246
C USE OF ALREADY STORED FORM FACTOR/TEST POSSIBILITY TO COPY            EXTP-247
      NMB=NVAL(2*NMC-2)                                                 EXTP-248
      ITYPX=-NVAL(2*NMB)                                                EXTP-249
      IF (NVAL(2*NMB+1).EQ.0.AND.NFOLD.NE.0) NVAL(2*NMB+1)=-1           EXTP-250
      IF (NVAL(2*NMB+1).NE.0.AND.NFOLD.EQ.0) NVAL(2*NMA+1)=-1           EXTP-251
      IF (ITYPX.NE.-16) GO TO 18                                        EXTP-252
      LZX=(NVAL(2*NMB+2)-1)/8                                           EXTP-253
      GO TO 17                                                          EXTP-254
   18 IF (ITYPX.GT.-5.OR.ML.EQ.0) GO TO 20                              EXTP-255
      IF (ITYPX.NE.-7.AND.ITYPX.NE.-8) GO TO 19                         EXTP-256
      LL(1,ITYP+2,LZ)=1                                                 EXTP-257
      NTOT=NTOT-1                                                       EXTP-258
      NMB=NMB+ITZ(-ITYPX)                                               EXTP-259
      IF (NVAL(2*NMB-1).EQ.1) GO TO 19                                  EXTP-260
      IF (NVAL(2*NMB+2).NE.1.OR.NVAL(2*NMB+6).NE.1) GO TO 20            EXTP-261
      K=IQ(2,LY)                                                        EXTP-262
      VAL(NMD)=DCGS(2*IVQ(1,K),NVAL(2*NMB+3),NVAL(2*NMB+7),FAC,NFA)*DSQREXTP-263
     1T(2.D0*IVQ(1,K)+1.D0)/VAL(NMC)                                    EXTP-264
      IF (VAL(NMD).EQ.0.D0) GO TO 57                                    EXTP-265
      GO TO 20                                                          EXTP-266
   19 IF (IQ(2,LY).NE.IQ(2,LYY)) GO TO 58                               EXTP-267
   20 NVAL(NNA+1)=16                                                    EXTP-268
      NVAL(NNA+3)=8*LZX+ITYP                                            EXTP-269
      NVAL(NNA+4)=NMA                                                   EXTP-270
      NMB=NMA+2                                                         EXTP-271
      IF (.NOT.LO(73)) WRITE (MW,1006) NMA,NMB,(NVAL(NNA+I),I=0,4),NMD,VEXTP-272
     1AL(NMD)                                                           EXTP-273
      LL(2,ITYP,LZ)=NMD                                                 EXTP-274
      NMA=NMD+1                                                         EXTP-275
      GO TO 41                                                          EXTP-276
   21 NVAL(NNA+3)=MINT                                                  EXTP-277
      NVAL(NNA+4)=NST                                                   EXTP-278
      IF (ITYPX.LT.0) GO TO 23                                          EXTP-279
      NVAL(NNA+5)=NMA                                                   EXTP-280
      LL(1,ITYP,LZ)=NMA+3                                               EXTP-281
C FORM FACTOR READ FROM CARDS                                           EXTP-282
      READ (MR,1003,ERR= 59 ) VAL(NMA+3),VAL(NMA+4)                     EXTP-283
      IF (VAL(NMA+3).EQ.0.D0) VAL(NMA+3)=1.D0                           EXTP-284
      IF (VAL(NMA+4).EQ.0.D0) VAL(NMA+4)=1.D0                           EXTP-285
      NM=NMA+5                                                          EXTP-286
   22 NMB=NM+3                                                          EXTP-287
      IF (NMB.GT.IDT) CALL MEMO('EXTP',IDT,NMB)                         EXTP-288
      READ (MR,1007,ERR= 59 ) (VAL(I),I=NM,NMB),LAST                    EXTP-289
      NM=NMB+1                                                          EXTP-290
      IF (LAST.NE.IERM) GO TO 22                                        EXTP-291
      NVN=NMA+2                                                         EXTP-292
      NM1=NVN+1                                                         EXTP-293
      NM2=NVN+2                                                         EXTP-294
      NM3=NVN+3                                                         EXTP-295
      NVAL(2*NMA)=1-(NMB-NVN)/2                                         EXTP-296
      IF (.NOT.LO(73)) WRITE (MW,1008) NMA,NVN,(NVAL(NNA+I-1),I=1,6),NM1EXTP-297
     1,NM2,VAL(NM1),VAL(NM2),NM3,NMB,(VAL(I),I=NM3,NMB)                 EXTP-298
      IF (NVAL(2*NMA).GT.-4) GO TO 60                                   EXTP-299
      LL(2,ITYP,LZ)=NMB                                                 EXTP-300
      NMA=NMB+1                                                         EXTP-301
      GO TO 41                                                          EXTP-302
C STANDARD FORM FACTORS                                                 EXTP-303
   23 IF (ITYPX.LT.-10) GO TO 61                                        EXTP-304
      ITYPY=-ITYPX                                                      EXTP-305
      IF (ITYPY.LT.9) GO TO 24                                          EXTP-306
      IF ((ML.NE.0).AND.(MLX.EQ.0)) MLX=IVY(7,LX)                       EXTP-307
      IF (MLX.LT.0) MLX=0                                               EXTP-308
      GO TO 25                                                          EXTP-309
   24 IF (((ITYPY-1)*(ITYPY-5).NE.0).AND.ML.EQ.0) GO TO 62              EXTP-310
      IF ((ITYPY.EQ.1).AND.(ML.NE.0).AND.(ITYP.GE.7)) GO TO 63          EXTP-311
      IF ((ITYPY.GE.7).AND.(ITYP.GT.2)) GO TO 64                        EXTP-312
   25 NVAL(NNA+1)=ITYPY                                                 EXTP-313
      NMB=NMA+ITZ(ITYPY)                                                EXTP-314
      IF (ITYPY.LT.5) GO TO 26                                          EXTP-315
      NVAL(NNA+5)=L2X                                                   EXTP-316
      NVAL(NNA+6)=MLX                                                   EXTP-317
      NVAL(NNA+7)=-L1X                                                  EXTP-318
      IF (ITYPY.EQ.7.OR.ITYPY.EQ.8) GO TO 32                            EXTP-319
      NVAL(2*NMB-1)=NMA                                                 EXTP-320
   26 NVAL(2*NMB)=NMA                                                   EXTP-321
      LL(1,ITYP,LZ)=NMB+1                                               EXTP-322
      IF (LO(73)) GO TO 27                                              EXTP-323
      IF (ITYPY.GE.9) WRITE (MW,1009) NMA,NMB,(NVAL(NNA+I-1),I=1,9)     EXTP-324
      IF (ITYPY.EQ.6) WRITE (MW,1010) NMA,NMB,(NVAL(NNA+I-1),I=1,9)     EXTP-325
      IF (ITYPY.EQ.5) WRITE (MW,1011) NMA,NMB,(NVAL(NNA+I-1),I=1,7)     EXTP-326
      IF (ITYPY.LT.5) WRITE (MW,1012) NMA,NMB,(NVAL(NNA+I-1),I=1,6)     EXTP-327
   27 IF (ITYPY.GE.9) GO TO 29                                          EXTP-328
      NMA=NMB+1                                                         EXTP-329
      NMB=NMB+4                                                         EXTP-330
      IF (ITYP.GT.6) NMB=NMB+1                                          EXTP-331
      READ (MR,1003,ERR= 59 ) (VAL(I),I=NMA,NMB)                        EXTP-332
      IF (ITYPY.GT.6) GO TO 28                                          EXTP-333
      K=IABS(NST)                                                       EXTP-334
      IF (K.EQ.NST) GO TO 28                                            EXTP-335
      IF (.NOT.LO(73)) WRITE (MW,1013) VAL(NMA),VAL(NMA+1)              EXTP-336
      EX=WV(2,K)**.33333333333333D0                                     EXTP-337
      EY=EX                                                             EXTP-338
      IF (LO(16)) EX=EX+WV(1,K)**.33333333333333D0                      EXTP-339
      EY=EY/EX                                                          EXTP-340
      VAL(NMA+1)=VAL(NMA+1)*EX                                          EXTP-341
      IF ((.NOT.LO(16)).OR.ML.EQ.0) GO TO 28                            EXTP-342
      ITYZ=ITYPY                                                        EXTP-343
      IF (ITYZ.GE.5) ITYZ=ITYZ-4                                        EXTP-344
      ITYW=1                                                            EXTP-345
      K=IQ(2,LY)                                                        EXTP-346
      IF (ITYP.GT.6) ITYW=ITYW*IVQ(1,K)                                 EXTP-347
      IF (LO(6)) ITYW=ITYW-1                                            EXTP-348
      IF (ITYZ.GT.1) VAL(NMA)=VAL(NMA)*EY**((ITYZ-1)*ITYW)              EXTP-349
   28 IF (.NOT.LO(73)) WRITE (MW,1014) NMA,NMB,(VAL(I),I=NMA,NMB)       EXTP-350
      IF (ITYPY.LT.5) GO TO 40                                          EXTP-351
   29 NMA=NMB+1                                                         EXTP-352
      NMC=NMA                                                           EXTP-353
      IF (ITYPY.GE.9) NMC=NMC+2                                         EXTP-354
      NMB=NMC+L2X-1                                                     EXTP-355
      IF (NMB.GT.IDT) CALL MEMO('EXTP',IDT,NMB)                         EXTP-356
      READ (MR,1003,ERR= 59 ) (VAL(I),I=NMA,NMB)                        EXTP-357
      IF ((ITYPY.GE.9).AND.(VAL(NMA).EQ.0.D0)) VAL(NMA)=1.D0            EXTP-358
      IF (NST.GT.0.OR.ITYPY.GE.9) GO TO 31                              EXTP-359
      IF (.NOT.LO(73)) WRITE (MW,1015) (VAL(I),I=NMA,NMB)               EXTP-360
      DO 30 I=NMA,NMB                                                   EXTP-361
      J=I-NMA                                                           EXTP-362
      IF (ITYP.LT.7) J=0                                                EXTP-363
      IF (.NOT.LO(6)) J=J+1                                             EXTP-364
   30 VAL(I)=VAL(I)*EY**J                                               EXTP-365
   31 IF (LO(73)) GO TO 40                                              EXTP-366
      IF (ITYPY.GE.9) WRITE (MW,1016) NMA,NMB,VAL(NMA),VAL(NMA+1),L2X,(IEXTP-367
     1,VAL(I),I=NMC,NMB)                                                EXTP-368
      IF (ITYPY.LT.9) WRITE (MW,1017) NMA,NMB,L2X,(I,VAL(I),I=NMA,NMB)  EXTP-369
      GO TO 40                                                          EXTP-370
   32 LL(1,ITYP+2,LZ)=1                                                 EXTP-371
      NTOT=NTOT-1                                                       EXTP-372
      IF (LO(100)) GO TO 65                                             EXTP-373
      NVAL(NNA+7)=-L1X                                                  EXTP-374
      IF (MLX.EQ.0) MLX=1                                               EXTP-375
      IF ((MLX.LT.0.OR.MLX.GT.3).OR.(MLX.EQ.3.AND.ITYPY.EQ.7)) GO TO 66 EXTP-376
      NVAL(NNA+6)=MLX                                                   EXTP-377
      MLY=MLX                                                           EXTP-378
      NMD=NMA+2                                                         EXTP-379
      IF (.NOT.LO(73)) WRITE (MW,1018) NMA,NMD,(NVAL(NNA+I-1),I=1,6)    EXTP-380
      NMD=NMD+1                                                         EXTP-381
      K=IQ(2,LY)                                                        EXTP-382
      IF (MLX.GT.1) GO TO 34                                            EXTP-383
      DO 33 I=1,3                                                       EXTP-384
   33 NVAL(NNA+7+I)=IVQ(I,K)                                            EXTP-385
      NVAL(NNA+11)=NMA                                                  EXTP-386
      NMB=NMD+2                                                         EXTP-387
      IF (.NOT.LO(73)) WRITE (MW,1019) NMD,NMB,(NVAL(NNA+I),I=6,11)     EXTP-388
      NMC=NMB                                                           EXTP-389
      GO TO 36                                                          EXTP-390
   34 READ (MR,1000) (NVAL(NNA+I),I=7,14),NVC                           EXTP-391
      IF (NVAL(NNA+9).EQ.1.AND.NVC.EQ.0) NVAL(NNA+9)=-3                 EXTP-392
      NMB=NMA+7                                                         EXTP-393
      NVAL(NNA+15)=NMA                                                  EXTP-394
      NMC=NMB+1                                                         EXTP-395
      VAL(NMC)=1.D0                                                     EXTP-396
      IF (NVAL(NNA+9).NE.1.OR.NVAL(NNA+13).NE.1.OR.NVC.EQ.0) GO TO 35   EXTP-397
      VAL(NMC)=DCGS(2*IVQ(1,K),NVAL(NNA+10),NVAL(NNA+14),FAC,NFA)*DSQRT(EXTP-398
     1DFLOAT(2*IVQ(1,K)+1))                                             EXTP-399
      IF (VAL(NMC).EQ.0.D0) GO TO 57                                    EXTP-400
   35 IF (.NOT.LO(73)) WRITE (MW,1020) NMD,NMB,(NVAL(NNA+I),I=6,15),NMC,EXTP-401
     1VAL(NMC)                                                          EXTP-402
   36 NMC=NMC+1                                                         EXTP-403
      LL(1,ITYP,LZ)=NMB+1                                               EXTP-404
      IF (ITYPY.EQ.8) GO TO 39                                          EXTP-405
   37 READ (MR,1003,ERR= 59 ) (VAL(NMC+I-1),I=1,3*MLX)                  EXTP-406
      IF (VAL(NMC+1).EQ.0.D0) VAL(NMC+1)=WV(2,L1)                       EXTP-407
      IF (VAL(NMC+2).EQ.0.D0) VAL(NMC+2)=1.D0                           EXTP-408
      IF (MLX.EQ.1) GO TO 38                                            EXTP-409
      IF (VAL(NMC+3).EQ.0.D0) VAL(NMC+3)=VAL(NMC)                       EXTP-410
      IF (VAL(NMC+4).EQ.0.D0) VAL(NMC+4)=WV(2,L1)                       EXTP-411
      IF (VAL(NMC+5).EQ.0.D0) VAL(NMC+5)=1.D0                           EXTP-412
   38 NMB=NMC+3*MLX-1                                                   EXTP-413
      IF (.NOT.LO(73)) WRITE (MW,1021) NMC,NMB,(VAL(I),I=NMC,NMB)       EXTP-414
      GO TO 40                                                          EXTP-415
   39 NMB=NMC+10                                                        EXTP-416
      READ (MR,1003,ERR= 59 ) (VAL(I),I=NMC,NMB)                        EXTP-417
      IF (VAL(NMC+1).EQ.0.D0) VAL(NMC+1)=WV(2,L1)                       EXTP-418
      IF (VAL(NMC+2).EQ.0.D0) VAL(NMC+2)=1.D0                           EXTP-419
      IF (VAL(NMC+4).EQ.0.D0) VAL(NMC+4)=35.D0                          EXTP-420
      IF (.NOT.LO(73)) WRITE (MW,1022) NMC,NMB,(VAL(I),I=NMC,NMB)       EXTP-421
      IF (MLX.EQ.1.AND.MLY.EQ.2.AND.VAL(NMC-10).LT.0.D0.AND.VAL(NMC).LT.EXTP-422
     10.D0) GO TO 67                                                    EXTP-423
      NMC=NMB+1                                                         EXTP-424
      MLX=MLX-2                                                         EXTP-425
      IF (MLX.EQ.1) GO TO 37                                            EXTP-426
      IF (MLX.EQ.0) GO TO 39                                            EXTP-427
   40 LL(2,ITYP,LZ)=NMB                                                 EXTP-428
      NMA=NMB+1                                                         EXTP-429
   41 IF ((.NOT.LO(10)).OR.LZ.GT.NPP) GO TO 10                          EXTP-430
      NMC=LL(1,ITYP,LZ)                                                 EXTP-431
      EX=VAL(NMC)                                                       EXTP-432
      IF (IPP(1,2,LZ).NE.0.AND.EX.EQ.0.D0.AND.ITYP.EQ.2) GO TO 68       EXTP-433
      IF (IPP(2,2,LZ).NE.0.AND.EX.EQ.0.D0.AND.ITYP.EQ.4) GO TO 69       EXTP-434
      IF (PIP(15,LZ).NE.0.D0.AND.EX.EQ.0.D0.AND.ITYP.EQ.1) GO TO 70     EXTP-435
      IF (PIP(7,LZ).NE.0.D0.AND.EX.EQ.0.D0.AND.ITYP.EQ.5) GO TO 71      EXTP-436
      IF (PIP(8,LZ).NE.0.D0.AND.EX.EQ.0.D0.AND.ITYP.EQ.6) GO TO 72      EXTP-437
      GO TO 10                                                          EXTP-438
   42 NVAL(2)=NFOLT                                                     EXTP-439
      NVAL(3)=NMA                                                       EXTP-440
      NVAL(4)=NMA                                                       EXTP-441
      IF (NFOLT.EQ.0) RETURN                                            EXTP-442
      IF (.NOT.LO(73)) WRITE (MW,1023) NFOLD                            EXTP-443
      DO 43 I=1,NFOLT                                                   EXTP-444
      READ (MR,1003,ERR= 77 ) VAL(NMA),VAL(NMA+1),VAL(NMA+2)            EXTP-445
      IF (.NOT.LO(73)) WRITE (MW,1024) I,VAL(NMA),VAL(NMA+1),VAL(NMA+2) EXTP-446
   43 NVAL(4)=NVAL(4)+3                                                 EXTP-447
      RETURN                                                            EXTP-448
   44 WRITE (MW,1025)                                                   EXTP-449
      GO TO 73                                                          EXTP-450
   45 WRITE (MW,1026)                                                   EXTP-451
      GO TO 73                                                          EXTP-452
   46 WRITE (MW,1027) ITYP,NST,NCOLT                                    EXTP-453
      GO TO 73                                                          EXTP-454
   47 WRITE (MW,1028) ML,L1,L2,NCOLT                                    EXTP-455
      GO TO 73                                                          EXTP-456
   48 WRITE (MW,1029) ML,L1,L2,NCOLL                                    EXTP-457
      GO TO 73                                                          EXTP-458
   49 WRITE (MW,1030) ML,L1,L2                                          EXTP-459
      GO TO 73                                                          EXTP-460
   50 WRITE (MW,1031) L1,L2,ML                                          EXTP-461
      GO TO 73                                                          EXTP-462
   51 WRITE (MW,1032) L1,L2,ML,ITYP                                     EXTP-463
      GO TO 73                                                          EXTP-464
   52 WRITE (MW,1033) L1,L2,ML,ITYP,L1X,L2X,MLX,ITYPX                   EXTP-465
      GO TO 73                                                          EXTP-466
   53 WRITE (MW,1034) MLX,L1X,L2X,NCOLT                                 EXTP-467
      GO TO 73                                                          EXTP-468
   54 WRITE (MW,1035) MLX,L1X,L2X,NCOLL                                 EXTP-469
      GO TO 73                                                          EXTP-470
   55 WRITE (MW,1036) MLX,L1X,L2X,NCOLL                                 EXTP-471
      GO TO 73                                                          EXTP-472
   56 WRITE (MW,1037) MLX,L1X,L2X,ITYPX                                 EXTP-473
      GO TO 73                                                          EXTP-474
   57 WRITE (MW,1038) NVAL(NNA+8),NVAL(NNA+12),K                        EXTP-475
      GO TO 73                                                          EXTP-476
   58 WRITE (MW,1039) ITYPX,IQ(2,LYY),IQ(2,LY)                          EXTP-477
      GO TO 73                                                          EXTP-478
   59 WRITE (MW,1040) ITYP,LZ                                           EXTP-479
      GO TO 73                                                          EXTP-480
   60 K=-NVAL(2*NMA)                                                    EXTP-481
      WRITE (MW,1041) K                                                 EXTP-482
      GO TO 73                                                          EXTP-483
   61 WRITE (MW,1042) ITYPX                                             EXTP-484
      GO TO 73                                                          EXTP-485
   62 WRITE (MW,1043) ITYPX,ITYP                                        EXTP-486
      GO TO 73                                                          EXTP-487
   63 WRITE (MW,1044) ITYPX,ITYP                                        EXTP-488
      GO TO 73                                                          EXTP-489
   64 WRITE (MW,1045) ITYPX,ITYP                                        EXTP-490
      GO TO 73                                                          EXTP-491
   65 WRITE (MW,1046) ITYPX                                             EXTP-492
      GO TO 73                                                          EXTP-493
   66 WRITE (MW,1047) MLX,ITYPX                                         EXTP-494
      GO TO 73                                                          EXTP-495
   67 WRITE (MW,1048) VAL(NMC-10),VAL(NMC)                              EXTP-496
      GO TO 73                                                          EXTP-497
   68 WRITE (MW,1049) LZ,IPP(1,2,LZ),EX                                 EXTP-498
      GO TO 73                                                          EXTP-499
   69 WRITE (MW,1050) LZ,IPP(2,2,LZ),EX                                 EXTP-500
      GO TO 73                                                          EXTP-501
   70 WRITE (MW,1051) LZ,LZ,PIP(15,LZ),EX                               EXTP-502
      GO TO 73                                                          EXTP-503
   71 WRITE (MW,1052) LZ,LZ,PIP(7,LZ),EX                                EXTP-504
      GO TO 73                                                          EXTP-505
   72 WRITE (MW,1053) LZ,LZ,PIP(8,LZ),EX                                EXTP-506
   73 IF (NTOT.EQ.0) GO TO 78                                           EXTP-507
      WRITE (MW,1054) NTOT,NPP                                          EXTP-508
      DO 76 J=1,NPX                                                     EXTP-509
      DO 75 I=1,8                                                       EXTP-510
      IF (LL(1,I,J).NE.-1) GO TO 75                                     EXTP-511
      IF (J.GT.NPP) GO TO 74                                            EXTP-512
      WRITE (MW,1055) (AA(K,I),K=1,3),J                                 EXTP-513
      GO TO 75                                                          EXTP-514
   74 WRITE (MW,1056) (AA(K,I),K=1,3),J-NPP                             EXTP-515
   75 CONTINUE                                                          EXTP-516
   76 CONTINUE                                                          EXTP-517
      GO TO 78                                                          EXTP-518
   77 WRITE (MW,1057) I,NFOLD                                           EXTP-519
   78 WRITE (MW,1058)                                                   EXTP-520
      STOP                                                              EXTP-521
 1000 FORMAT (12I5)                                                     EXTP-522
 1001 FORMAT (/3A8,' POTENTIAL NR(',I2,')')                             EXTP-523
 1002 FORMAT (/3A8,' TRANSITION POTENTIAL FROM LEVEL(',I2,') TO LEVEL(',EXTP-524
     1I2,') AND THE ORDER ML =',I2)                                     EXTP-525
 1003 FORMAT (7F10.5)                                                   EXTP-526
 1004 FORMAT (' THE ELASTIC POTENTIAL NR(',I2,') TYP(',I1,') IS COPIED TEXTP-527
     1O NR(',I2,')')                                                    EXTP-528
 1005 FORMAT (' TRANSITION POTENTIAL L1(',I2,') L2(',I2,') ML(',I2,') TYEXTP-529
     1P(',I2,') IS COPIED TO L1(',I2,') L2(',I2,') ML(',I2,')')         EXTP-530
 1006 FORMAT (' USING PARAMETERS',I6,' TO',I6,' FOR COPY TO:',I5,5X,'(COEXTP-531
     1PY):',I3,5X,'FOLD =',I3,5X,'FROM:',I5,5X,'START:',I5/' USING PARAMEXTP-532
     2ETER',I6,' FOR MULTIPLICATIVE FACTOR',D15.8)                      EXTP-533
 1007 FORMAT (F10.5,F20.10,F10.5,F20.10,A4)                             EXTP-534
 1008 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:'/I5,5X,'NB POIEXTP-535
     1NTS:',I5,5X,'FOLD:',I2,5X,'INTG:',I2,5X,'STEP:',I2,5X,'START:',I5/EXTP-536
     25X,'PARAMETERS',I6,' TO',I6,' TO STORE:'/20X,'STRENGTH:',F15.6,10XEXTP-537
     3,'SCALE:',F15.6/' AND PARAMETERS',I6,' TO',I6,' TO STORE:'/4(6X,'REXTP-538
     4ADIUS',7X,'POTENTIAL',2X)/(4(2X,0P,F10.5,3X,1P,D15.7)))           EXTP-539
 1009 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:'/I5,3X,'TYPE:'EXTP-540
     1,I2,3X,'FOLD:',I2,3X,'INTG:',I2,3X,'STEP:',I2,I6,' FUNCTIONS  L:',EXTP-541
     2I3,I4,' DERIVATIONS  START:',I5)                                  EXTP-542
 1010 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:'/I5,3X,'TYPE:'EXTP-543
     1,I2,3X,'FOLD:',I2,3X,'INTG:',I2,3X,'STEP:',I2,I6,' DEFORMATIONS   EXTP-544
     2LBET:',I5,5X,'KBET:',I5,5X,'START:',I5)                           EXTP-545
 1011 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:'/I5,3X,'TYPE:'EXTP-546
     1,I2,3X,'FOLD:',I2,3X,'INTG:',I2,3X,'STEP:',I2,I6,' DEFORMATIONS',5EXTP-547
     2X,'START:',I5)                                                    EXTP-548
 1012 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:',I4,3X,'TYPE:'EXTP-549
     1,I2,3X,'FOLD:',I2,3X,'INTG:',I2,3X,'STEP:',I2,5X,'START:',I5)     EXTP-550
 1013 FORMAT (' VALUES READ:',F12.6,3X,F9.6)                            EXTP-551
 1014 FORMAT (' USING PARAMETERS',I6,' TO',I6,' FOR'/' DEPTH',F12.6,' MEEXTP-552
     1V  RADIUS',F10.6,' F  DIFFUSENESS',F9.6,' F AT THE POWER (1.+',F9.EXTP-553
     26,')',2X,F9.6,' (3RD COUL. PARM.)'/)                              EXTP-554
 1015 FORMAT (' DEFORMATIONS READ:',8F10.5/(19X,8F10.5))                EXTP-555
 1016 FORMAT (' USING PARAMETERS',I6,' TO',I6,' FOR STRENGTH:',F12.6,10XEXTP-556
     1,'SCALE:',F12.6/' AND TO STORE',I5,' BESSEL FUNCTION OR LEGENDRE PEXTP-557
     2OLYNOMIALS COEFFICIENTS:'/(6(3X,I5,F10.5)))                       EXTP-558
 1017 FORMAT (' USING PARAMETERS',I6,' TO',I6,' FOR',I5,' DEFORMATIONS:'EXTP-559
     1/(6(3X,I5,F10.5)))                                                EXTP-560
 1018 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:',I4,3X,'TYPE:'EXTP-561
     1,I2,3X,'FOLD:',I2,3X,'INTG:',I2,3X,'STEP:',I2,5X,'MULT:',I3)      EXTP-562
 1019 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:',I2,' FUNCTIONEXTP-563
     1S   N =',I2,3X,'L =',I3,3X,'2*S =',I2,3X,'2*J =',I3,5X,'START:',I5EXTP-564
     2)                                                                 EXTP-565
 1020 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:'/I5,' FUNCTIONEXTP-566
     1S',2(2X,'N =',I2,3X,'L =',I3,3X,'2*S =',I2,3X,'2*J =',I3),5X,'STAREXTP-567
     2T:',I5/' USING PARAMETER',I6,' FOR MULTIPLICATIVE FACTOR',D18.8)  EXTP-568
 1021 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:'/(' OSCILLATOREXTP-569
     1 PARAMETER',F10.6,2X,'TOTAL MASS',F12.6,2X,'PARTICLE MASS',F12.6))EXTP-570
 1022 FORMAT (' USING PARAMETERS',I6,' TO',I6,' TO STORE:'/' **** BINDINEXTP-571
     1G ENERGY',F12.6,' MEV ****',2X,'TOTAL MASS',F12.6,2X,'PARTICLE MASEXTP-572
     2S',F12.6,2X,'PRODUCT OF CHARGES',F8.2/' SEARCH ON DEPTH OF REAL POEXTP-573
     3TENTIAL FROM',F12.6,' WITH REDUCED RADIUS',F10.6,' FERMI AND DIFFUEXTP-574
     4SENESS',F10.6,' FERMI'/' SPIN-ORBIT POTENTIAL  DEPTH:',F12.6,' MEVEXTP-575
     5  RADIUS:',F10.6,' F  DIFFUSENESS:',F9.6,' F  COULOMB RADIUS:',F10EXTP-576
     6.6,' F'/)                                                         EXTP-577
 1023 FORMAT (/2X,I3,' SETS OF FOLDING PARAMETERS')                     EXTP-578
 1024 FORMAT (2X,I2,5X,' V =',F12.6,5X,' R =',F9.6,5X,' A =',F9.6)      EXTP-579
 1025 FORMAT (' EXTERNAL FORM FACTORS NOT ALLOWED WITH SCHROEDINDER EQUIEXTP-580
     1VALENT OF DIRAC EQUATION')                                        EXTP-581
 1026 FORMAT (' INPUT ERROR IN THE FIRST CARD DEFINING THE POTENTIAL')  EXTP-582
 1027 FORMAT (/' ITYP =',I5,' NOT ALLOWED OR NST =',I5,' LARGER THAN NCOEXTP-583
     1LT =',I3)                                                         EXTP-584
 1028 FORMAT (' WITH ML =',I2,' L1 =',I3,' IS NOT EQUAL TO L2 =',I3,' OREXTP-585
     1 IS LARGER THAN NCOLT =',I3)                                      EXTP-586
 1029 FORMAT (' WITH ML =',I3,' L1 =',I3,' OR L2 =',I3,' IS LARGER THAN EXTP-587
     1NCOLL =',I3)                                                      EXTP-588
 1030 FORMAT (' ML =',I3,' TOO LARGE BETWEEN LEVELS L1 =',I3,' AND L2 ='EXTP-589
     1,I3)                                                              EXTP-590
 1031 FORMAT (' THERE IS NO CORRECTION TERM OF THE FORM FACTOR FOR L1 ='EXTP-591
     1,I3,'  L2 =',I3,'  ML =',I3)                                      EXTP-592
 1032 FORMAT (' THE FORM FACTOR FOR L1 =',I3,'  L2 =',I3,'  ML =',I3,'  EXTP-593
     1AND ITYP =',I2,' IS ALREADY READ OR DOES NOT HAVE TO BE READ')    EXTP-594
 1033 FORMAT (/' DIFFERENT TYPES NOT ALLOWED TO COPY FOR FORM FACTORS L1EXTP-595
     1/L2/ML/ITYP/L1X/L2X/MLX/ITYPX :'/30X,8I5)                         EXTP-596
 1034 FORMAT (' WITH MLX =',I2,' L1X =',I3,' IS NOT EQUAL TO L2X =',I3,'EXTP-597
     1 OR IS LARGER THAN NCOLT =',I3)                                   EXTP-598
 1035 FORMAT (' WITH MLX =',I3,' L1X =',I3,' OR L2X =',I3,' IS LARGER THEXTP-599
     1AN NCOLL =',I3)                                                   EXTP-600
 1036 FORMAT (' MLX =',I3,' TOO LARGE BETWEEN LEVELS L1X =',I3,' AND L2XEXTP-601
     1 =',I5)                                                           EXTP-602
 1037 FORMAT (' FORM FACTOR DEFINED BY L1X =',I3,'  L2X =',I3,'  MLX =',EXTP-603
     1I3,'  ITYPX =',I3,' NOT YET DEFINED')                             EXTP-604
 1038 FORMAT (' NO PARTICLE-HOLE COUPLING WITH 2*JP =',I3,' AND 2*JH =',EXTP-605
     1I3,' TO L =',I3)                                                  EXTP-606
 1039 FORMAT (' COPY WITH ITYPX =',I3,' NOT ALLOWED BETWEEN TRANSITIONS EXTP-607
     1WITH QUANTUM NUMBERS',I2,' AND',I2)                               EXTP-608
 1040 FORMAT (' INPUT ERROR FOR THE POTENTIAL (',I2,',',I2,')')         EXTP-609
 1041 FORMAT (' NUMBER OF DATA',I4,' LESS THAN 4 WHICH ARENECESSARY TO IEXTP-610
     1NTERPOLATE.')                                                     EXTP-611
 1042 FORMAT (/' ITYPX =',I5,' NOT ALLOWED FOR STANDARD FORM FACTORS')  EXTP-612
 1043 FORMAT (' ITYPX,ITYP =',2I5,'  NOT ALLOWED: CENTRAL POTENTIAL CANNEXTP-613
     1OT BE DERIVATIVE OR BOUND FUNCTION')                              EXTP-614
 1044 FORMAT (' ITYPX,ITYP =',2I5,'  NOT ALLOWED: COULOMB TRANSITION FOREXTP-615
     1M FACTOR MUST BE DERIVATIVE')                                     EXTP-616
 1045 FORMAT (' ITYPX,ITYP =',2I5,'  NOT ALLOWED: BOUND STATE FUNCTION CEXTP-617
     1AN BE ONLY REAL OR IMAGINARY TRANSITION POTENTIAL')               EXTP-618
 1046 FORMAT (' ITYPX =',I3,'  NOT ALLOWED IN DIRAC FORMALISM')         EXTP-619
 1047 FORMAT (' L2X =',I3,'  NOT ALLOWED WITH ITYPX =',I4)              EXTP-620
 1048 FORMAT (' FOR ITYP=-8 AND TWO FUNCTIONS, BOTH ARE UNBOUNDED',2F12.EXTP-621
     16)                                                                EXTP-622
 1049 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED FOR DISPERSION RELATIEXTP-623
     1ONS BECAUSE THE VOLUME IMAGINARY STRENGTH IS 0:'/10X,'NV =',I3,'  EXTP-624
     1WV =',D13.6)                                                      EXTP-625
 1050 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED FOR DISPERSION RELATIEXTP-626
     1ONS BECAUSE THE SURFACE IMAGINARY STRENGTH IS 0:'/10X,'NS =',I3,' EXTP-627
     2 WS =',D13.6)                                                     EXTP-628
 1051 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED WITH VARIATION OF THEEXTP-629
     1 HARTREE-FOCK POTENTIAL OF WHICH THE STRENGTH IS 0':/10X,'PIP(15,'EXTP-630
     2,I2,') =',D13.6,'  V =',D13.6)                                    EXTP-631
 1052 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED WITH VARIATION OF THEEXTP-632
     1 REAL SPIN-ORBIT OF WHICH THE STRENGTH IS 0':/10X,'PIP(7,',I2,') =EXTP-633
     2',D13.6,'  VLS =',D13.6)                                          EXTP-634
 1053 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED WITH VARIATION OF THEEXTP-635
     1 IMAGINARY SPIN-ORBIT OF WHICH THE STRENGTH IS 0':/10X,'PIP(8,',I2EXTP-636
     2,') =',D13.6,'  WLS =',D13.6)                                     EXTP-637
 1054 FORMAT (I6,' FORM FACTORS TO READ, FOR (ITYP, N  )  ( POTENTIALS FEXTP-638
     1OR N SMALLER THAN',I2,' TRANSITIONS AFTER)')                      EXTP-639
 1055 FORMAT (10X,3A8,' MISSING FOR POTENTIAL',I4)                      EXTP-640
 1056 FORMAT (10X,3A8,' MISSING FOR TRANSITION',I4)                     EXTP-641
 1057 FORMAT (' INPUT ERROR FOR THE',I4,'TH SET OF THE',I4,' SETS OF FOLEXTP-642
     1DING PARAMETERS TO BE READ')                                      EXTP-643
 1058 FORMAT (//' IN EXTP  ...  STOP  ...')                             EXTP-644
      END                                                               EXTP-645
C 27/06/06                                                      ECIS06  DCGS-000
      FUNCTION DCGS(L,J1,J2,FAC,NFA)                                    DCGS-001
C COMPUTATION OF SINGULAR CLEBSCH-GORDAN COEFFICIENTS.                  DCGS-002
C INPUT:     L,J1,J2: DOUBLE VALUE OF ANGULAR MOMENTA.                  DCGS-003
C            FAC:     TABLE OF LOGARITHM OF FACTORIALS.                 DCGS-004
C            NFA:     LENGTH OF FAC.                                    DCGS-005
C OUTPUT:                                                               DCGS-006
C                                                                       DCGS-007
C                                 /~~~~~~~~~~~~~~~~   ( J2   L   J1  )  DCGS-008
C  CGS(L,J1,J2) = (-)**(J1+1/2)  / (2*J1+1)*(2*J2+1)  (              )  DCGS-009
C                                                     (-1/2  0   1/2 )  DCGS-010
C  WHEN J1 AND J2 ARE HALF-INTEGERS,                                    DCGS-011
C                              ( J2  L  J1 )                            DCGS-012
C  CGS(L,J1,J2) = (-)**(J1-1)  (           )                            DCGS-013
C                              (  0  0  0  )                            DCGS-014
C  WHEN J1 AND J2  ARE INTEGERS.                                        DCGS-015
C                                                                       DCGS-016
C***********************************************************************DCGS-017
      IMPLICIT REAL*8 (A-H,O-Z)                                         DCGS-018
      DIMENSION FAC(*)                                                  DCGS-019
      IF (L.LT.0.OR.J1.LT.0.OR.J2.LT.0) GO TO 1                         DCGS-020
      LL=L+J1+J2+2                                                      DCGS-021
      LT=LL/2                                                           DCGS-022
      IF (2*LT.NE.LL) GO TO 1                                           DCGS-023
      IF (LT.GE.NFA) GO TO 1                                            DCGS-024
      L1=LT-J1                                                          DCGS-025
      L2=LT-J2                                                          DCGS-026
      L3=LT-L                                                           DCGS-027
      IF (L1.LE.0.OR.L2.LE.0.OR.L3.LE.0) GO TO 1                        DCGS-028
      L4=LT+1                                                           DCGS-029
      N1=(L1+1)/2                                                       DCGS-030
      N2=(L2+1)/2                                                       DCGS-031
      N3=(L3+1)/2                                                       DCGS-032
      N4=(L4+1)/2                                                       DCGS-033
      DCGS=DEXP(FAC(N4)-FAC(N1)-FAC(N2)-FAC(N3)-.5D0*(FAC(L4)-FAC(L1)-FADCGS-034
     1C(L2)-FAC(L3)))                                                   DCGS-035
      IF (2*(N1/2).NE.N1) DCGS=-DCGS                                    DCGS-036
      IF (N4-N1-N2-N3+1) 3 , 2 , 1                                      DCGS-037
    1 DCGS=0.D0                                                         DCGS-038
    2 DCGS=2.D0*DCGS                                                    DCGS-039
    3 RETURN                                                            DCGS-040
      END                                                               DCGS-041
C 21/08/06                                                      ECIS06  CONU-000
      SUBROUTINE CONU(IX,IPI,WV,IPIM,WVM,NCI,XD,SCN,KXT,LO)             CONU-001
C DISCRETISATION OF CONTINUA FOR COMPOUND NUCLEUS.                      CONU-002
C INPUT:     IX:      0 FOR COUNT OF POINTS,                            CONU-003
C                     NOT 0 FOR COMPUTATION OF POINTS, WEIGHTS, ...     CONU-004
C            IPI:     INTEGER VALUES FOR THE DESCRIPTION OF CHANNELS    CONU-005
C                     (SEE CALX).                                       CONU-006
C            WV:      FLOATING VALUES FOR THE DESCRIPTION OF CHANNELS   CONU-007
C                     (SEE CALX).                                       CONU-008
C            SCN:     DESCRIPTIONS OF LEVEL DENSITIES:                  CONU-009
C                     1-SA  2-UX   3-TAU  4-SG   5-E0   6-EX   7-NZ     CONU-010
C                     (SEE INPUT DESCRIPTION).                          CONU-011
C            LO(I):   LOGICAL CONTROLS:                                 CONU-012
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 CONU-013
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     CONU-014
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    CONU-015
C OUTPUT:    IPIM:    IPI FOR CONTINUA OF COMPOUND NUCLEUS.             CONU-016
C            WVM:     WV FOR CONTINUA OF COMPOUND NUCLEUS.              CONU-017
C            NCI:     STARTING AND FINAL ADDRESSES FOR CONTINUA.        CONU-018
C            XD:      STEPS OF DISCRETISATION OF CONTINUA,              CONU-019
C                     ENERGY AND SPIN DEPENDENCE OF LEVEL DENSITIES     CONU-020
C            KXT:     NUMBER OF TRANSMISSION COEFFICIENTS               CONU-021
C                                                                       CONU-022
C FOR THE COMMON  /DCONS/ SEE CALC.                                     CONU-023
C FOR THE COMMON  /NCOMP/ SEE CALX.                                     CONU-024
C                                                                       CONU-025
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     CONU-026
C  CM:        ATOMIC MASS IN MEV.                                       CONU-027
C   USED:     CM.                                                       CONU-028
C                                                                       CONU-029
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     CONU-030
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 CONU-031
C  NCONS:     NUMBER OF LEVEL DENSITIES NEEDED.                         CONU-032
C  NIE:       NUMBER OF UNCOUPLED STATES ADDED FOR DISCRETISATION.      CONU-033
C  NCOLX:     TOTAL NUMBER OF LEVELS WITHOUT DISCRETISATION.            CONU-034
C  ACN1:      RATIO SIZE/STEP FOR DISCRETISATION OF A CONTINUUM.        CONU-035
C  ACN2:      MAXIMUM NUMBER OF STEPS BY MEV FOR A CONTINUUM.           CONU-036
C   DEFINED:  NIE.                                                      CONU-037
C   USED:     NCONT,NCONS,NIE,NCOLX,ACN1,ACN2.                          CONU-038
C***********************************************************************CONU-039
      IMPLICIT REAL*8 (A-H,O-Z)                                         CONU-040
      LOGICAL LO(150)                                                   CONU-041
      DIMENSION IPI(11,*),WV(22,*),IPIM(11,*),WVM(22,*),NCI(2,*),XD(3,*)CONU-042
     1,SCN(7,*)                                                         CONU-043
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            CONU-044
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQCONU-045
     1,ACN1,ACN2,AZ(18)                                                 CONU-046
      COMMON /INOUT/ MR,MW,MS                                           CONU-047
C DISCRETISATION OF CONTINUUM FOR COMPOUND NUCLEUS.                     CONU-048
      NIE=0                                                             CONU-049
      IF (IX.EQ.0) GO TO 1                                              CONU-050
      KXT=IPI(8,NCOLX+1-NCONT)                                          CONU-051
    1 DO 12 I=1,NCONT                                                   CONU-052
      J=I+NCONS-NCONT                                                   CONU-053
      SCNB=DEXP(2.D0*DSQRT(SCN(1,J)*SCN(2,J))-(SCN(6,J)-SCN(5,J))/SCN(3,CONU-054
     1J))*SCN(3,J)/(SCN(1,J)**.5D0*SCN(2,J)**1.5D0)                     CONU-055
      IV=I-NCONT+NCOLX                                                  CONU-056
      NCI(1,I)=NIE+1                                                    CONU-057
      IF (WV(3,IV).LE.0.D0) GO TO 11                                    CONU-058
      NE=0                                                              CONU-059
      E=WV(3,IV)                                                        CONU-060
      ACN3=1.D0/ACN2                                                    CONU-061
      IF (E*ACN2.LT.1.D0) ACN3=E/1.9D0                                  CONU-062
    2 IF (E.LE.0.D0) GO TO 11                                           CONU-063
      NIE=NIE+1                                                         CONU-064
      IF (NE.NE.0) GO TO 4                                              CONU-065
      IF (E.LT.ACN1*ACN3) GO TO 3                                       CONU-066
      ESTP=E/ACN1                                                       CONU-067
      GO TO 5                                                           CONU-068
    3 NE=IDINT(E/ACN3+1.D0)                                             CONU-069
      IF (NE.EQ.1) NE=2                                                 CONU-070
      ACN3=E/DFLOAT(NE)*1.000001D0                                      CONU-071
    4 ESTP=ACN3                                                         CONU-072
    5 IF (E.LT.ESTP) ESTP=E                                             CONU-073
      ECN=E-.5D0*ESTP                                                   CONU-074
      E=E-ESTP                                                          CONU-075
      IF (IX.EQ.0) GO TO 2                                              CONU-076
      DO 6 K=1,22                                                       CONU-077
    6 WVM(K,NIE)=WV(K,IV)                                               CONU-078
      DO 7 K=1,11                                                       CONU-079
    7 IPIM(K,NIE)=IPI(K,IV)                                             CONU-080
      WVM(3,NIE)=ECN                                                    CONU-081
      XD(2,NIE)=ESTP                                                    CONU-082
      IF (LO(8)) GO TO 8                                                CONU-083
      WVM(13,NIE)=WVM(3,NIE)*(WVM(1,NIE)+WVM(2,NIE))/WVM(2,NIE)         CONU-084
      GO TO 9                                                           CONU-085
    8 WVM(13,NIE)=WVM(3,NIE)*(WVM(3,NIE)/(2.D0*CM)+WVM(1,NIE)+WVM(2,NIE)CONU-086
     1)/WVM(2,NIE)                                                      CONU-087
    9 LY=4+IDINT(3.3D0*DSQRT(WVM(3,NIE)))                               CONU-088
      IPIM(10,NIE)=LY-1                                                 CONU-089
      IPIM(8,NIE)=KXT                                                   CONU-090
      KXT=KXT+LY*IPIM(2,NIE)                                            CONU-091
      IF (WV(3,1)-WVM(3,NIE).GT.SCN(6,J)) GO TO 10                      CONU-092
      XD(1,NIE)=XD(2,NIE)*DEXP((WV(3,1)-WVM(3,NIE)-SCN(5,J))/SCN(3,J))/SCONU-093
     1CN(3,J)                                                           CONU-094
      XD(3,NIE)=2.D0*SCN(4,J)**2                                        CONU-095
      GO TO 2                                                           CONU-096
   10 EXD=WV(3,1)-WVM(3,NIE)+SCN(2,J)-SCN(6,J)                          CONU-097
      EBYT=DSQRT(SCN(1,J)*EXD)                                          CONU-098
      XD(1,NIE)=XD(2,NIE)*DEXP(2.D0*EBYT)/(EBYT*EXD*SCNB)               CONU-099
      XD(3,NIE)=2.D0*SCN(4,J)**2*DSQRT(EXD/SCN(2,J))                    CONU-100
      GO TO 2                                                           CONU-101
   11 IF (IX.EQ.0) GO TO 12                                             CONU-102
      JY=NIE-NCI(1,I)+1                                                 CONU-103
      WRITE (MW,1000) I,JY                                              CONU-104
      NCI(2,I)=NIE                                                      CONU-105
   12 CONTINUE                                                          CONU-106
      IF (IX.NE.0) CALL KHCO(NIE,WVM,IPIM,WV,WV(8,1),LO)                CONU-107
      RETURN                                                            CONU-108
 1000 FORMAT (' ***** START OF',I4,'TH CONTINUUM *****',5X,I5,' DISCRETICONU-109
     1SATION POINTS.')                                                  CONU-110
      END                                                               CONU-111
C 20/08/06                                                      ECIS06  GGDR-000
      SUBROUTINE GGDR(IPI,WV,SCN,LO)                                    GGDR-001
C CALCULATIONS RELATED TO GIANT DIPOLE RESONANCE.                       GGDR-002
C INPUT:     IPI(3,*):MULTIPLICITY OF THE TARGET.                       GGDR-003
C            WV(J,*): MASS OF PARTICLE AND TARGET FOR J=1 AND 2,        GGDR-004
C                     CENTRE OF MASS ENERGY IN MEV FOR J=3.             GGDR-005
C            SCN:     DESCRIPTIONS OF LEVEL DENSITIES:                  GGDR-006
C                     1-SA  2-UX   3-TAU  4-SG   5-E0   6-EX   7-NZ     GGDR-007
C            LO(I):   LOGICAL CONTROLS:                                 GGDR-008
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             GGDR-009
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         GGDR-010
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      GGDR-011
C               LO(112)=.TRUE. SPIN-ORBIT OR COMPOUND NUCLEUS PARAMETERSGGDR-012
C                              ARE CHANGED IN SEARCH.                   GGDR-013
C               LO(115)=.TRUE. FIRST COMPUTATION FOR THIS ENERGY.       GGDR-014
C               LO(116)=.TRUE. NO OUTPUT.                               GGDR-015
C OUTPUT:    IN COMMON /NCOMP/.                                         GGDR-016
C                                                                       GGDR-017
C FOR THE COMMON  /NCOMP/ SEE CALX.                                     GGDR-018
C                                                                       GGDR-019
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     GGDR-020
C  NRD:       NUMBER OF GAMMA TRANSMISSION COEFFICIENTS.                GGDR-021
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 GGDR-022
C  BZ:        HAUSER-FESHBACH AND MOLDAUER'S PARAMETERS DESCRIBED BELOW.GGDR-023
C   BZ(1):    SQUARE ROOT OF ELASTIC ENHANCEMENT.                       GGDR-024
C   BZ(2):    IF LO(82)=.TRUE., SPIN CUT-OFF PARAMETER.                 GGDR-025
C             IF LO(82)=.FALSE., PARTICLE DEGREES OF FREEDOM.           GGDR-026
C   BZ(3):    SQUARE ROOT OF LEVEL DENSITY PARAMETER. IF LO(82)=LO(87)= GGDR-027
C             .FALSE., PARAMETER BZ(3) IN MOLDAUER'S FORMULA OF INPUT   GGDR-028
C             DESCRIPTION.                                              GGDR-029
C   BZ(4):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(4) IN SAME FORMULA.GGDR-030
C   BZ(5):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(5) IN SAME FORMULA.GGDR-031
C  TG0:       SLOW S-WAVE NEUTRON GAMMA WIDTH/SPACING FOR NORMALISATION.GGDR-032
C  BN:        NEUTRON SEPARATION ENERGY.                                GGDR-033
C  FNUG:      RADIATIVE DEGREES OF FREEDOM.                             GGDR-034
C  EGD:       ENERGY OF THE GIANT DIPOLE RESONANCE.                     GGDR-035
C  GGD:       RESONANCE WIDTH.                                          GGDR-036
C  TG1:       DERIVED DATA FOR GAMMA IN COMPOUND NUCLEUS.               GGDR-037
C  SGSQ:      DERIVED DATA FOR GAMMA IN COMPOUND NUCLEUS.               GGDR-038
C   DEFINED:  BZ,EGD,GGD,SGSQ.                                          GGDR-039
C   USED:     NRD,NCONT,BZ,TGO,BN,FNUG,EGD,GGD,TG1,SGSQ.                GGDR-040
C                                                                       GGDR-041
C***********************************************************************GGDR-042
      IMPLICIT REAL*8 (A-H,O-Z)                                         GGDR-043
      LOGICAL LO(150)                                                   GGDR-044
      DIMENSION IPI(11,*),WV(22,*),SCN(7)                               GGDR-045
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQGGDR-046
     1,ACN1,ACN2,AZ(6),BZ(5),TG0,BN,FNUG,EGD,GGD,TG1,SGSQ               GGDR-047
      COMMON /INOUT/ MR,MW,MS                                           GGDR-048
      IF (.NOT.LO(81)) RETURN                                           GGDR-049
      BZ(2)=DABS(BZ(2))                                                 GGDR-050
      IF (LO(82)) BZ(3)=BZ(1)*BZ(1)-1.D0                                GGDR-051
      IF (.NOT.(LO(112).OR.LO(115))) RETURN                             GGDR-052
C  GAMMA RAY INPUT.                                                     GGDR-053
      IF ((.NOT.LO(86)).OR.(NRD.NE.0)) RETURN                           GGDR-054
      XFR=0.5D0                                                         GGDR-055
      NA=IDINT(WV(2,1)+WV(1,1)+.5D0)                                    GGDR-056
      AA=DFLOAT(NA)                                                     GGDR-057
      NZ=IDINT(SCN(7)+.1D0)                                             GGDR-058
      NN=NA-NZ                                                          GGDR-059
      ZZ=DFLOAT(NZ*NN)                                                  GGDR-060
      KGD=0                                                             GGDR-061
      IF (EGD.EQ.0.D0) EGD=163.D0*DSQRT(ZZ)/(AA**1.3333333D0)           GGDR-062
      IF (EGD.LT.0.D0) GO TO 1                                          GGDR-063
      KGD=1                                                             GGDR-064
      IF (GGD.LE.0.D0) GGD=5.D0                                         GGDR-065
    1 IF (.NOT.LO(116)) WRITE (MW,1000) NA,NZ,NN,BN,FNUG,SCN(4)         GGDR-066
      ATG0=DABS(TG0)                                                    GGDR-067
      IF (.NOT.LO(116)) WRITE (MW,1001) ATG0                            GGDR-068
      IF (KGD.EQ.0.AND..NOT.LO(116)) WRITE (MW,1002)                    GGDR-069
      IF (KGD.EQ.1.AND..NOT.LO(116)) WRITE (MW,1003) EGD,GGD,XFR        GGDR-070
      SGSQ=2.D0*SCN(4)**2                                               GGDR-071
      ROJ=0.D0                                                          GGDR-072
      ECM=0.D0                                                          GGDR-073
    2 TG=0.D0                                                           GGDR-074
      ELIM=BN+ECM                                                       GGDR-075
      ELO=0.D0                                                          GGDR-076
    3 EHI=ELO+0.05D0                                                    GGDR-077
      IF (EHI.GE.ELIM) EHI=ELIM                                         GGDR-078
      EPS=(EHI+ELO)/2.D0                                                GGDR-079
      ESQ=EPS*EPS                                                       GGDR-080
      TINT=(EHI-ELO)*EPS*ESQ                                            GGDR-081
      EEE=-EGD*EGD+ESQ                                                  GGDR-082
      IF (KGD.EQ.1) TINT=TINT*EPS/(ESQ*GGD*GGD+EEE*EEE)                 GGDR-083
      EXC=BN+ECM-EPS                                                    GGDR-084
      IF (EXC.GT.SCN(6)) GO TO 4                                        GGDR-085
      EBYT=(EXC-SCN(5))/SCN(3)                                          GGDR-086
      TINT=TINT*DEXP(EBYT)/SCN(3)                                       GGDR-087
      GO TO 5                                                           GGDR-088
    4 EXD=EXC+SCN(2)-SCN(6)                                             GGDR-089
      EBYT=DSQRT(SCN(1)*EXD)                                            GGDR-090
      SCNB=DEXP(2.D0*DSQRT(SCN(1)*SCN(2))-(SCN(6)-SCN(5))/SCN(3))*SCN(3)GGDR-091
     1/(SCN(1)**.5D0*SCN(2)**1.5D0)                                     GGDR-092
      TINT=TINT*DEXP(2.D0*EBYT)/(EBYT*EXD*SCNB)                         GGDR-093
    5 TG=TG+TINT                                                        GGDR-094
      IF (EHI.EQ.ELIM) GO TO 6                                          GGDR-095
      ELO=EHI                                                           GGDR-096
      GO TO 3                                                           GGDR-097
    6 IF (ECM.NE.0.D0) GO TO 9                                          GGDR-098
      TEMP=TG                                                           GGDR-099
      JD=IPI(3,1)-1                                                     GGDR-100
      N1=IABS(JD-1)                                                     GGDR-101
      N2=JD+1                                                           GGDR-102
      DO 8 I=N1,N2,2                                                    GGDR-103
      N3=IABS(I-2)                                                      GGDR-104
      N4=I+2                                                            GGDR-105
      DO 7 J=N3,N4,2                                                    GGDR-106
      DEX=-DFLOAT(J+1)**2/(SGSQ*4.D0)                                   GGDR-107
    7 ROJ=ROJ+DEXP(DEX)*DFLOAT(J+1)/SGSQ                                GGDR-108
    8 CONTINUE                                                          GGDR-109
      CTG=ATG0/(TEMP*ROJ)                                               GGDR-110
      ECM=WV(3,1)                                                       GGDR-111
      GO TO 2                                                           GGDR-112
    9 TG1=TG*CTG                                                        GGDR-113
      RETURN                                                            GGDR-114
 1000 FORMAT (/'    GAMMA RAY CHANNEL PARAMETERS :'//'   A=',I3,'  Z=',IGGDR-115
     13,'  N=',I3,5X,F9.3,' MEV  NEUTRON BINDING',5X,F6.2,' RADIATIVE D.GGDR-116
     2 OF F.',5X,'SIGMA=',F6.3)                                         GGDR-117
 1001 FORMAT ('   NORMALISED TO SLOW S-WAVE NEUTRON GAMMA WIDTHS/SPACINGGGDR-118
     1S =',D12.4)                                                       GGDR-119
 1002 FORMAT ('   E1 STRONG COUPLING MODEL.')                           GGDR-120
 1003 FORMAT ('   E1 GIANT RESONANCE AT ',F7.2,' MEV   WIDTH=',F7.2,' MEGGDR-121
     1V',5X,'EXCHANGE FRACTION=',F5.2)                                  GGDR-122
      END                                                               GGDR-123
C 11/01/07                                                      ECIS06  DISP-000
      SUBROUTINE DISP(IPI,WV,IPP,PIP,NVAL,VAL,NIE,LO)                   DISP-001
C COMPUTATION OF THE DEPTHS OF REAL SURFACE AND VOLUME CONTRIBUTIONS    DISP-002
C OBTAINED BY DISPERSION RELATIONS FROM THE IMAGINARY VOLUME AND        DISP-003
C SURFACE POTENTIALS. COMPUTATION OF THE CORRECTIONS TO THE IMAGINARY   DISP-004
C POTENTIALS DUE TO DIFFERENCES OF ENERGY. VARIATION OF HARTREE-FOCK ANDDISP-005
C SPIN-ORBIT POTENTIALS.                                                DISP-006
C INPUT:     IPI(5,I):POTENTIAL FOR THE LEVEL I.                        DISP-007
C            WV(3,I): CENTRE OF MASS ENERGY OF THE LEVEL I.             DISP-008
C            IPP,PIP: EQUIVALENT BY CALL, PARAMETERS OF THE DISPERSION  DISP-009
C                     RELATIONS (SEE INPUT DESCRIPTION).                DISP-010
C            NVAL,VAL:OPTICAL POTENTIALS.                               DISP-011
C            NIE:     TOTAL NUMBER OF LEVELS, NEGATIVE VALUE FOR        DISP-012
C                     COMPOUND CONTINUA.                                DISP-013
C            LO(I):   LOGICAL CONTROLS:                                 DISP-014
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    DISP-015
C               LO(10) =.TRUE. DISPERSION RELATIONS FOR POTENTIALS.     DISP-016
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    DISP-017
C               LO(116)=.TRUE. NO OUTPUT.                               DISP-018
C OUTPUT:    WV(J,I): CORRECTION TO POTENTIALS:                         DISP-019
C                     TO VOLUME/SCALAR IMAGINARY POTENTIAL FOR J=14,    DISP-020
C                     TO VOLUME/SCALAR REAL POTENTIAL FOR J=15,         DISP-021
C                     TO SURFACE/VECTOR IMAGINARY POTENTIAL FOR J=16,   DISP-022
C                     TO SURFACE/VECTOR REAL POTENTIAL FOR J=17,        DISP-023
C                     TO SP-O/TENSOR IMAGINARY POTENTIAL FOR J=18,      DISP-024
C                     TO SP-O/TENSOR REAL POTENTIAL FOR J=19.           DISP-025
C***********************************************************************DISP-026
      IMPLICIT REAL*8 (A-H,O-Z)                                         DISP-027
      LOGICAL LO(150)                                                   DISP-028
      DIMENSION IPI(11,*),WV(22,*),IPP(34,*),PIP(17,*),NVAL(2,*),VAL(42,DISP-029
     1*),WW(9),AV(3,2,3),VV(3),EN(4),WX(9,4)                            DISP-030
      COMMON /INOUT/ MR,MW,MS                                           DISP-031
C INPUT OF DISPERSION COEFFICIENTS.                                     DISP-032
      IF (LO(10).AND.(IPP(2,1).EQ.-1)) CALL LDIS(WV,IPP,PIP,NVAL,VAL,LO)DISP-033
      NCOLT=IABS(NIE)                                                   DISP-034
      IPZ=0                                                             DISP-035
      IF (.NOT.LO(116).AND.LO(10)) WRITE (MW,1000)                      DISP-036
C LOOP ON LEVELS.                                                       DISP-037
      DO 24 IV=1,NCOLT                                                  DISP-038
      DO 1 I=1,9                                                        DISP-039
    1 WW(I)=0.D0                                                        DISP-040
      IPI(11,IV)=MAX0(1,IPI(11,IV))                                     DISP-041
      IP=IPI(5,IV)                                                      DISP-042
      IF (.NOT.LO(10)) GO TO 22                                         DISP-043
      IZ=3                                                              DISP-044
      IF (IPP(1,IP).GE.0) IZ=13                                         DISP-045
      IF (IPP(6,IP).EQ.0) GO TO 7                                       DISP-046
      IF (NCOLT.EQ.NIE) GO TO 6                                         DISP-047
C INPUT OF PARAMETERS FOR A CONTINUUM.                                  DISP-048
      IF (IP.EQ.IPZ) GO TO 2                                            DISP-049
      READ (MR,1001) EN                                                 DISP-050
      READ (MR,1002) WX                                                 DISP-051
      IF (.NOT.LO(116)) WRITE (MW,1003) (EN(I),(WX(J,I),J=1,9),I=1,4)   DISP-052
C INTERPOLATION OF PARAMETERS FOR A CONTINUUM.                          DISP-053
    2 Y=WV(IZ,IV)                                                       DISP-054
      DO 5 L=1,4                                                        DISP-055
      X=0.D0                                                            DISP-056
      DO 3 K=1,4                                                        DISP-057
      IF (K.EQ.L) GO TO 3                                               DISP-058
      X=X*(Y-EN(K))/(EN(L)-EN(K))                                       DISP-059
    3 CONTINUE                                                          DISP-060
      DO 4 I=1,9                                                        DISP-061
    4 WW(I)=WW(I)+X*WX(I,L)                                             DISP-062
    5 CONTINUE                                                          DISP-063
      GO TO 22                                                          DISP-064
C INPUT OF PARAMETERS FOR A STATE.                                      DISP-065
    6 READ (MR,1002) WW                                                 DISP-066
      GO TO 22                                                          DISP-067
C SEARCH ON DEPTHS OF REAL VOLUME, IMAGINARY VOLUME AND IMAGINARY       DISP-068
C SPIN-ORBIT POTENTIALS                                                 DISP-069
    7 IF (LO(7)) GO TO 8                                                DISP-070
      VV(1)=VAL(1,IP)                                                   DISP-071
      VV(2)=VAL(5,IP)                                                   DISP-072
      VV(3)=VAL(21,IP)                                                  DISP-073
      GO TO 9                                                           DISP-074
    8 VV(1)=VAL(NVAL(1,8*IP-5),1)                                       DISP-075
      VV(2)=VAL(NVAL(1,8*IP-4),1)                                       DISP-076
      VV(3)=VAL(NVAL(1,8*IP),1)                                         DISP-077
    9 EF=PIP(5,IP)                                                      DISP-078
      EP=PIP(6,IP)                                                      DISP-079
      EO=EP-EF                                                          DISP-080
      YY=PIP(4,IP)-EF                                                   DISP-081
      Y=WV(IZ,IV)-EF                                                    DISP-082
C SPIN-ORBIT OR TENSOR POTENTIAL.                                       DISP-083
      IF (PIP(9,IP).NE.0.D0) WW(7)=-PIP(9,IP)*(Y-YY)/VV(3)              DISP-084
      IF (PIP(8,IP).NE.0.D0) WW(9)=DEXP(-PIP(8,IP)*(Y-YY))-1.D0         DISP-085
C WORKING ARRAY AV(I,J,K) WITH I=1,2,3 FOR VOLUME/SCALAR/VECTOR         DISP-086
C FORM-FACTOR, J=1,2 FOR TWO TERMS, K=1 FOR REFERENCE POTENTIAL,        DISP-087
C K=2 FOR ACTUAL POTENTIAL, K=3 FOR INTERMEDIATE RESULTS.               DISP-088
      DO 21 I=1,3                                                       DISP-089
      NM=IPP(I+2,IP)                                                    DISP-090
      IF (NM.EQ.0) GO TO 19                                             DISP-091
      N=IABS(NM)                                                        DISP-092
      DO 14 K=1,2                                                       DISP-093
      B=PIP(3*I+K+6,IP)                                                 DISP-094
      DO 10 L=1,2                                                       DISP-095
   10 AV(I,K,L)=0.D0                                                    DISP-096
      IF (DABS(YY).GT.EO) AV(I,K,1)=(DABS(YY)-EO)**N/((DABS(YY)-EO)**N+BDISP-097
     1**N)                                                              DISP-098
      IF (DABS(Y).GT.EO) AV(I,K,2)=(DABS(Y)-EO)**N/((DABS(Y)-EO)**N+B**NDISP-099
     1)                                                                 DISP-100
      IF (LO(109).OR.(I.NE.2)) GO TO 11                                 DISP-101
      IF ((N.GT.0).AND.((PIP(14,IP).NE.0.D0).OR.(PIP(15,IP).NE.0.D0))) GDISP-102
     1O TO 20                                                           DISP-103
   11 AV(I,K,3)=DVWI(Y,EO,N,B,0.D0,0.D0)                                DISP-104
      IF ((I.EQ.3).OR.(N.EQ.NM)) GO TO 15                               DISP-105
      IF (K.EQ.1) GO TO 14                                              DISP-106
C SUM OR DIFFERENCE OF TWO VOLUME TERMS.                                DISP-107
      DO 13 J=1,3                                                       DISP-108
   13 AV(I,1,J)=PIP(3*I+9,IP)*AV(I,1,J)+(1.D0-PIP(3*I+9,IP))*AV(I,2,J)  DISP-109
   14 CONTINUE                                                          DISP-110
   15 IF ((N.LT.0).OR.(I.EQ.2)) GO TO 18                                DISP-111
C VOLUME CORRECTION FOR LARGE ENERGY CONTRIBUTIONS.                     DISP-112
      EA=PIP(7,IP)                                                      DISP-113
      IF (EA.EQ.0.D0) GO TO 18                                          DISP-114
      CN=PIP(12,IP)                                                     DISP-115
      IF (IPP(2,IP).EQ.0) GO TO 16                                      DISP-116
C LARGE NEGATIVE ENERGIES.                                              DISP-117
      N2=IABS(IPP(2,IP))                                                DISP-118
      IF (YY.LT.-EA) AV(1,1,1)=AV(1,1,1)*(1.D0-(YY+EA)**N2/((YY+EA)**N2+DISP-119
     1EA**N2)*DEXP(CN*(DSQRT(EA+EF)-DSQRT(-YY+EF))))                    DISP-120
      IF (Y.LT.-EA) AV(1,1,2)=AV(1,1,2)*(1.D0-(Y+EA)**N2/((Y+EA)**N2+EA*DISP-121
     1*N2)*DEXP(CN*(DSQRT(EA+EF)-DSQRT(-Y+EF))))                        DISP-122
      AV(1,1,3)=AV(1,1,3)+DLNE(IPP(2,IP),N,EA,EF,EP,B,CN,WV(IZ,IV))     DISP-123
   16 IF (PIP(11,IP).EQ.0.D0) GO TO 18                                  DISP-124
C LARGE POSITIVE ENERGY TERM.                                           DISP-125
      EL=EF+EA                                                          DISP-126
      ELL=DSQRT(EL)                                                     DISP-127
      AV(1,2,1)=0.D0                                                    DISP-128
      AV(1,2,2)=0.D0                                                    DISP-129
      IF (YY.GT.EA) AV(1,2,1)=(DSQRT(YY+EF)+ELL*(EL/(YY+EF)-3.D0)/2.D0)*DISP-130
     1DEXP(-CN*(DSQRT(YY+EF)-ELL))                                      DISP-131
      IF (Y.GT.EA) AV(1,2,2)=(DSQRT(Y+EF)+ELL*(EL/(Y+EF)-3.D0)/2.D0)*DEXDISP-132
     1P(-CN*(DSQRT(Y+EF)-ELL))                                          DISP-133
      AV(1,2,3)=DLPE(EL,Y+EF,EF,CN)                                     DISP-134
      XX=(VV(2)-AV(1,2,1)*PIP(11,IP))/AV(1,1,1)                         DISP-135
      DO 17 K=1,3                                                       DISP-136
   17 AV(1,1,K)=XX*AV(1,1,K)+PIP(11,IP)*AV(1,2,K)                       DISP-137
   18 WW(3*I-2)=AV(I,1,2)/AV(I,1,1)-1.D0                                DISP-138
      IF ((I.NE.3).OR.(NM.GT.0)) WW(3*I-1)=AV(I,1,3)/AV(I,1,1)          DISP-139
   19 IF ((I.EQ.1).AND.(PIP(17,IP).NE.0.D0)) WW(3)=DEXP(-PIP(17,IP)*(Y-YDISP-140
     1Y))-1.D0                                                          DISP-141
      GO TO 21                                                          DISP-142
C SURFACE FORM-FACTOR.                                                  DISP-143
   20 CS=PIP(14,IP)                                                     DISP-144
      CN=PIP(15,IP)                                                     DISP-145
      AV(2,1,1)=AV(2,1,1)*DEXP(-CN*YY-CS*DABS(YY))                      DISP-146
      AV(2,1,2)=AV(2,1,2)*DEXP(-CN*Y-CS*DABS(Y))                        DISP-147
      WW(4)=AV(2,1,2)/AV(2,1,1)-1.D0                                    DISP-148
      WW(5)=DVWI(Y,EO,N,B,CS,CN)/AV(2,1,1)                              DISP-149
   21 CONTINUE                                                          DISP-150
   22 DO 23 I=1,9                                                       DISP-151
   23 WV(I+13,IV)=WW(I)                                                 DISP-152
      IPZ=IP                                                            DISP-153
      IF (.NOT.LO(116).AND.LO(10)) WRITE (MW,1004) IP,IV,PIP(4,IP),WV(IZDISP-154
     1,IV),WW                                                           DISP-155
   24 CONTINUE                                                          DISP-156
      RETURN                                                            DISP-157
 1000 FORMAT (' POTENTIAL REFER. ENERGY  ACTUAL ENERGY',10X,'VOLUME/SCALDISP-158
     1AR CORRECTION',21X,'SURFACE/VECTOR CORRECTION'/5X,'LEVEL',37X,'SPIDISP-159
     2N-ORBIT/TENSOR CORRECTION'/38X,2('   IMAGINARY      DISPERSION    DISP-160
     3 REAL',8X))                                                       DISP-161
 1001 FORMAT (4F10.5)                                                   DISP-162
 1002 FORMAT (6F10.5/3F10.5)                                            DISP-163
 1003 FORMAT (' ENERGY FOR INTERPOLATION',20X,'COEFFICIENTS'/1P,7D15.6/6DISP-164
     10X,3D15.6)                                                        DISP-165
 1004 FORMAT (1X,I4,I5,1P,2D14.6,6D15.8/38X,3D15.8)                     DISP-166
      END                                                               DISP-167
C 29/10/06                                                      ECIS06  LDIS-000
      SUBROUTINE LDIS(WV,IPP,PIP,NVAL,VAL,LO)                           LDIS-001
C INPUT OF DISPERSION PARAMETERS.                                       LDIS-002
C INPUT:     WV(J,I): CENTRE OF MASS ENERGY OF THE LEVEL I FOR J=3.     LDIS-003
C                     LABORATORY ENERGY OF THE LEVEL I FOR J=13.        LDIS-004
C            IPP(I,J):FIRST LEVEL USING POTENTIAL J FOR I=1 (TEMPORARY).LDIS-005
C                     -1 TO READ DISPERSION PARAMETERS FOR I=2.         LDIS-006
C            NVAL,VAL:OPTICAL POTENTIALS.                               LDIS-007
C            LO(I):   LOGICAL CONTROLS:                                 LDIS-008
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    LDIS-009
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    LDIS-010
C OUTPUT:    IPP,PIP: EQUIVALENT BY CALL, PARAMETERS OF THE DISPERSION  LDIS-011
C                     RELATIONS (SEE INPUT DESCRIPTION).                LDIS-012
C                                                                       LDIS-013
C FOR THE COMMON  /COUPL/ SEE CALC.                                     LDIS-014
C                                                                       LDIS-015
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     LDIS-016
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             LDIS-017
C   USED:     NPP.                                                      LDIS-018
C                                                                       LDIS-019
C***********************************************************************LDIS-020
      IMPLICIT REAL*8 (A-H,O-Z)                                         LDIS-021
      LOGICAL LO(150)                                                   LDIS-022
      CHARACTER*4 CLEG(6)                                               LDIS-023
      DIMENSION WV(22,*),IPP(34,*),PIP(17,*),NVAL(2,*),VAL(42,*),VV(6)  LDIS-024
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   LDIS-025
      COMMON /INOUT/ MR,MW,MS                                           LDIS-026
      DATA CLEG /' VOL','UME ',' SCA','LAR ',' VEC','TOR '/             LDIS-027
      DO 13 IJ=1,NPP                                                    LDIS-028
C COLLECT SIX DEPTHS OF POTENTIALS.                                     LDIS-029
      IP=IPP(1,IJ)                                                      LDIS-030
      IF (LO(7)) GO TO 2                                                LDIS-031
      DO 1 I=1,6                                                        LDIS-032
    1 VV(I)=VAL(4*I-3,IP)                                               LDIS-033
      GO TO 4                                                           LDIS-034
    2 DO 3 I=1,6                                                        LDIS-035
    3 VV(I)=VAL(NVAL(1,8*IP+I-6),1)                                     LDIS-036
C INPUT OF DISPERSION PARAMETERS.                                       LDIS-037
    4 READ (MR,1000) IPPIP,(IPP(J,IJ),J=2,6)                            LDIS-038
      IF (IPP(6,IJ).NE.1) GO TO 5                                       LDIS-039
      WRITE (MW,1001) IJ                                                LDIS-040
      GO TO 13                                                          LDIS-041
    5 IF (IPPIP.NE.1) IPP(1,IJ)=-IPP(1,IJ)                              LDIS-042
      IF (MOD(IPP(2,IJ),2).NE.0) GO TO 14                               LDIS-043
      READ (MR,1002) (PIP(J,IJ),J=4,17)                                 LDIS-044
      DO 6 I=1,3                                                        LDIS-045
      IF (MOD(IPP(I+2,IJ),2).NE.0) GO TO 14                             LDIS-046
      IF ((IPP(I+2,IJ).NE.0).AND.(VV(2*I).EQ.0.D0)) GO TO 15            LDIS-047
    6 CONTINUE                                                          LDIS-048
      IF ((PIP(8,IJ).NE.0.D0).AND.(VV(5).EQ.0.D0)) GO TO 16             LDIS-049
      IF ((PIP(9,IJ).NE.0.D0).AND.(VV(6).EQ.0.D0)) GO TO 17             LDIS-050
      IF ((PIP(17,IJ).NE.0.D0).AND.(VV(1).EQ.0.D0)) GO TO 18            LDIS-051
      IF (IPP(1,IJ).GT.0) GO TO 7                                       LDIS-052
      WRITE (MW,1003)                                                   LDIS-053
      IZ=3                                                              LDIS-054
      GO TO 8                                                           LDIS-055
    7 WRITE (MW,1004)                                                   LDIS-056
      IZ=13                                                             LDIS-057
    8 IF (PIP(4,IJ).EQ.0.D0) PIP(4,IJ)=WV(IZ,IP)                        LDIS-058
      IF (PIP(5,IJ).EQ.0.D0) PIP(5,IJ)=-6.8D0                           LDIS-059
      IF (PIP(6,IJ).EQ.0.D0) PIP(6,IJ)=PIP(5,IJ)                        LDIS-060
      WRITE (MW,1005) (PIP(I,IP),I=4,6)                                 LDIS-061
      IF (PIP(8,IJ).NE.0.D0) WRITE (MW,1006) VV(5),PIP(8,IJ),PIP(4,IJ)  LDIS-062
      IF (PIP(9,IJ).NE.0.D0) WRITE (MW,1007) VV(6),PIP(9,IJ),PIP(4,IJ)  LDIS-063
      IF (PIP(17,IJ).NE.0.D0) WRITE (MW,1008) VV(1),PIP(17,IJ),PIP(4,IJ)LDIS-064
      I1=1                                                              LDIS-065
      IF (LO(109)) I1=3                                                 LDIS-066
      IF (IPP(3,IJ).LT.0) GO TO 9                                       LDIS-067
      WRITE (MW,1009) CLEG(I1),CLEG(I1+1),IPP(3,IJ),PIP(10,IJ)          LDIS-068
      IF ((IPP(2,IJ).NE.0).OR.(PIP(11,IJ).NE.0.D0)) WRITE (MW,1010) PIP(LDIS-069
     15,IP),PIP(7,IJ),IPP(2,IJ),PIP(11,IJ),PIP(12,IJ)                   LDIS-070
      GO TO 10                                                          LDIS-071
    9 WRITE (MW,1011) CLEG(I1),CLEG(I1+1),IPP(3,IJ),PIP(10,IJ),PIP(11,IPLDIS-072
     1),PIP(12,IJ)                                                      LDIS-073
   10 IF (LO(109)) GO TO 12                                             LDIS-074
      IF (IPP(4,IJ).LT.0) GO TO 11                                      LDIS-075
      WRITE (MW,1012) IPP(4,IJ),PIP(13,IJ),PIP(14,IJ),PIP(15,IJ)        LDIS-076
      GO TO 13                                                          LDIS-077
   11 IF (PIP(14,IJ).EQ.0.D0) PIP(14,IJ)=2.D0*PIP(13,IJ)                LDIS-078
      WRITE (MW,1013) IPP(4,IJ),PIP(13,IJ),PIP(14,IJ)                   LDIS-079
      GO TO 13                                                          LDIS-080
   12 IF (IPP(4,IJ).GE.0) WRITE (MW,1009) CLEG(5),CLEG(6),IPP(4,IJ),PIP(LDIS-081
     113,IJ)                                                            LDIS-082
      IF (IPP(4,IJ).LT.0) WRITE (MW,1011) CLEG(5),CLEG(6),IPP(4,IJ),PIP(LDIS-083
     113,IJ),PIP(14,IJ),PIP(15,IJ)                                      LDIS-084
   13 CONTINUE                                                          LDIS-085
      RETURN                                                            LDIS-086
   14 WRITE (MW,1014) IJ,(IPP(I,IJ),I=2,5)                              LDIS-087
      GO TO 20                                                          LDIS-088
   15 WRITE (MW,1015) IJ,(IPP(I+2,IJ),VV(2*I),I=1,3)                    LDIS-089
      GO TO 19                                                          LDIS-090
   16 WRITE (MW,1016) IJ,IP,PIP(7,IJ),VV(5)                             LDIS-091
      GO TO 19                                                          LDIS-092
   17 WRITE (MW,1017) IJ,IP,PIP(8,IJ),VV(6)                             LDIS-093
      GO TO 19                                                          LDIS-094
   18 WRITE (MW,1018) IJ,IP,PIP(15,IJ),VV(1)                            LDIS-095
   19 WRITE (MW,1019)                                                   LDIS-096
   20 WRITE (MW,1020)                                                   LDIS-097
      STOP                                                              LDIS-098
 1000 FORMAT (14I5)                                                     LDIS-099
 1001 FORMAT (' DISPERSION COEFFICIENTS READ FOR EACH LEVEL: DATA=',I5) LDIS-100
 1002 FORMAT (7F10.5)                                                   LDIS-101
 1003 FORMAT (' USE OF CENTRE OF MASS ENERGIES.')                       LDIS-102
 1004 FORMAT (' USE OF LABORATORY ENERGIES.')                           LDIS-103
 1005 FORMAT (' IMAGINARY DEPTHS READ FOR',F12.6,' MEV   FERMI ENERGY:',LDIS-104
     1F12.6,' MEV   TRESHOLD ENERGY:',F12.6)                            LDIS-105
 1006 FORMAT (' EXPONENTIAL DECREASE OF REAL SPIN-ORBIT POTENTIAL:',3X,FLDIS-106
     112.6,'*EXP(-',F10.6,'(E-',F10.6,')) MEV')                         LDIS-107
 1007 FORMAT (' LINEAR DECREASE OF IMAGINARY SPIN-ORBIT POTENTIAL:',3X,FLDIS-108
     112.6,'-',F10.6,'*(E-',F10.6,') MEV')                              LDIS-109
 1008 FORMAT (' EXPONENTIAL DECREASE OF HARTREE-FOCK POTENTIAL:',6X,F12.LDIS-110
     16,'*EXP(-',F10.6,'(E-',F10.6,')) MEV')                            LDIS-111
 1009 FORMAT (2A4,':   POWER =',I3,5X,'B =',F10.4)                      LDIS-112
 1010 FORMAT (' FOR ENERGIES ''E'' SUCH THAT |',F12.6,'-''E''| >',F12.6,LDIS-113
     1' MEV'/' CORRECTIONS WITH POWER',I3,' FOR NEGATIVES ENERGIES AND CLDIS-114
     2OEFFICIENT',F12.6,' FOR POSITIVE ENERGIES'/15X,'DAMPING FACTOR',F1LDIS-115
     32.6)                                                              LDIS-116
 1011 FORMAT (2A4,':   POWER =',I3,5X,'SUM OF B1 =',F10.4,5X,'AND B2 =',LDIS-117
     1F10.4,5X,'CONTRIBUTION OF B1 =',F10.5)                            LDIS-118
 1012 FORMAT (' SURFACE:   POWER =',I3,5X,'B =',F10.4,5X,' DECREASING RALDIS-119
     1TE =',F10.6,5X,' NON LOCALITY PARAMETER =',F10.4)                 LDIS-120
 1013 FORMAT (' SURFACE:   POWER =',I3,5X,'DIFFERENCE OF B1 =',F10.4,5X,LDIS-121
     1'AND B2 =',F10.4)                                                 LDIS-122
 1014 FORMAT (' FOR DISPERSION RELATIONS OF POTENTIAL',I3,' ALL THE FOLLLDIS-123
     1OWING INTEGERS MUST BE EVEN'/10X,'N2 =',I4,10X,'NV =',I4,10X,'NS =LDIS-124
     2',I4,10X,'NL =',I4)                                               LDIS-125
 1015 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED FOR DISPERSION RELATILDIS-126
     1ONS BECAUSE AN IMAGINARY STRENGTH IS 0:'/10X,'NV =',I3,'  WV =',1PLDIS-127
     2,D13.6,10X,'NS =',I3,'  WS =',D13.6,10X,'NL =',I3,'  LS =',D13.6) LDIS-128
 1016 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED WITH VARIATION OF THELDIS-129
     1 REAL SPIN-ORBIT OF WHICH THE STRENGTH IS 0':/10X,'PIP(7,',I2,') =LDIS-130
     2',1P,D13.6,'  VLS =',D13.6)                                       LDIS-131
 1017 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED WITH VARIATION OF THELDIS-132
     1 IMAGINARY SPIN-ORBIT OF WHICH THE STRENGTH IS 0':/10X,'PIP(8,',I2LDIS-133
     2,') =',1P,D13.6,'  WLS =',D13.6)                                  LDIS-134
 1018 FORMAT (' THE POTENTIAL',I4,' CANNOT BE USED WITH VARIATION OF THELDIS-135
     1 HARTREE-FOCK POTENTIAL OF WHICH THE STRENGTH IS 0':/10X,'PIP(15,'LDIS-136
     2,I2,') =',1P,D13.6,'  V =',D13.6)                                 LDIS-137
 1019 FORMAT (' GIVE VALUES FOR ANOTHER ENERGY'/)                       LDIS-138
 1020 FORMAT (//' IN LDIS  ...  STOP  ...')                             LDIS-139
      END                                                               LDIS-140
C 14/04/06                                                      ECIS06  DCEI-000
      SUBROUTINE DCEI(AR,AI,ZR,ZI)                                      DCEI-001
C COMPLEX EXPONENTIAL INTEGRAL FUNCTION MULTIPLIED BY EXPONENTIAL FOR   DCEI-002
C COMPLEX ARGUMENT: Z = EXP(X)*EI(X).                                   DCEI-003
C INPUT:     AR,AI:   REAL AND IMAGINARY PART OF THE ARGUMENT X.        DCEI-004
C OUTPUT:    ZR,ZI:   REAL AND IMAGINARY PART OF THE RESULT Z.          DCEI-005
C***********************************************************************DCEI-006
      IMPLICIT REAL*8 (A-H,O-Z)                                         DCEI-007
      ZR=0.D0                                                           DCEI-008
      ZI=0.D0                                                           DCEI-009
      IF ((AR.EQ.0.D0).AND.(AI.EQ.0.D0)) RETURN                         DCEI-010
      IF (DABS(AR)+18.5D0.GE.32.D0) GO TO 3                             DCEI-011
      IF (DSQRT(1024.D0-(AR+18.5D0)**2)/1.665D0.LT.DABS(AI)) GO TO 3    DCEI-012
C SERIES EXPANSION.                                                     DCEI-013
      ZR=-.57721566490153D0-DLOG(AR**2+AI**2)*0.5D0                     DCEI-014
      ZI=-DATAN2(AI,AR)                                                 DCEI-015
      YR=1.D0                                                           DCEI-016
      YI=0.D0                                                           DCEI-017
      DO 1 M=1,2000                                                     DCEI-018
      AJ=DFLOAT(M)                                                      DCEI-019
      YZ=YR                                                             DCEI-020
      YR=-(YZ*AR-YI*AI)/AJ                                              DCEI-021
      YI=-(YZ*AI+YI*AR)/AJ                                              DCEI-022
      IF (YR**2+YI**2.LT.1.D-30*(AR**2+AI**2)) GO TO 2                  DCEI-023
      ZR=ZR-YR/AJ                                                       DCEI-024
    1 ZI=ZI-YI/AJ                                                       DCEI-025
    2 YR=DEXP(AR)                                                       DCEI-026
      YI=YR*ZI                                                          DCEI-027
      YR=YR*ZR                                                          DCEI-028
      ZR=YR*DCOS(AI)-YI*DSIN(AI)                                        DCEI-029
      ZI=YI*DCOS(AI)+YR*DSIN(AI)                                        DCEI-030
      RETURN                                                            DCEI-031
C CONTINUED FRACTION.                                                   DCEI-032
    3 DO 4 I=1,20                                                       DCEI-033
      AJ=DFLOAT(21-I)                                                   DCEI-034
      ZR=ZR+AR                                                          DCEI-035
      ZI=ZI+AI                                                          DCEI-036
      Z=ZR**2+ZI**2                                                     DCEI-037
      ZR=AJ*ZR/Z                                                        DCEI-038
      ZI=-AJ*ZI/Z                                                       DCEI-039
      ZR=ZR+1.D0                                                        DCEI-040
      Z=ZR**2+ZI**2                                                     DCEI-041
      ZR=AJ*ZR/Z                                                        DCEI-042
    4 ZI=-AJ*ZI/Z                                                       DCEI-043
      ZR=ZR+AR                                                          DCEI-044
      ZI=ZI+AI                                                          DCEI-045
      Z=ZR**2+ZI**2                                                     DCEI-046
      ZR=ZR/Z                                                           DCEI-047
      ZI=-ZI/Z                                                          DCEI-048
      RETURN                                                            DCEI-049
      END                                                               DCEI-050
C 11/01/07                                                      ECIS06  DREI-000
      FUNCTION DREI(AR)                                                 DREI-001
C REAL EXPONENTIAL INTEGRAL FUNCTION MULTIPLIED BY EXPONENTIAL.         DREI-002
C INPUT:     AR:      ARGUMENT.                                         DREI-003
C***********************************************************************DREI-004
      IMPLICIT REAL*8 (A-H,O-Z)                                         DREI-005
      DREI=0.D0                                                         DREI-006
      IF (AR.EQ.0.D0) RETURN                                            DREI-007
      IF (DABS(AR)+18.5D0.GE.32.D0) GO TO 3                             DREI-008
C SERIES EXPANSION.                                                     DREI-009
      DREI=-.57721566490153D0-DLOG(DABS(AR))                            DREI-010
      YR=1.D0                                                           DREI-011
      DO 1 M=1,2000                                                     DREI-012
      AJ=DFLOAT(M)                                                      DREI-013
      YR=-YR*AR/AJ                                                      DREI-014
      IF (DABS(YR).LT.1.D-15*DABS(AR)) GO TO 2                          DREI-015
    1 DREI=DREI-YR/AJ                                                   DREI-016
    2 DREI=DREI*DEXP(AR)                                                DREI-017
      RETURN                                                            DREI-018
C CONTINUED FRACTION.                                                   DREI-019
    3 DO 4 I=1,20                                                       DREI-020
      AJ=DFLOAT(21-I)                                                   DREI-021
      DREI=DREI+AR                                                      DREI-022
      DREI=AJ/DREI                                                      DREI-023
    4 DREI=AJ/(DREI+1.D0)                                               DREI-024
      DREI=1.D0/(DREI+AR)                                               DREI-025
      RETURN                                                            DREI-026
      END                                                               DREI-027
C 11/01/07                                                      ECIS06  DLNE-000
      FUNCTION DLNE(I2,NV,EA,EF,EP,B,CV,EX)                             DLNE-001
C CONTRIBUTION TO THE REAL VOLUME POTENTIAL OF THE LARGE NEGATIVE       DLNE-002
C ENERGIES.                                                             DLNE-003
C INPUT:     I2:      POWER FOR NEGATIVE CORRECTION, NEGATIVE VALUE     DLNE-004
C                     TO TAKE INTO ACCOUNT THE IMAGINARY POTENTIAL      DLNE-005
C                     ONLY AT THE FIRST POINT.                          DLNE-006
C            NV:      POWER FOR VOLUME OR SCALAR POTENTIAL.             DLNE-007
C            EA:      LARGE ENERGY STARTING VALUE ABOVE FERMI ENERGY.   DLNE-008
C            EF:      FERMI ENERGY.                                     DLNE-009
C            EP:      THRESHOLD ENERGY.                                 DLNE-010
C            B:       CONSTANT FOR VOLUME OR SCALAR POTENTIAL.          DLNE-011
C            CV:      EXPONENTIAL DECREASE IN |EX-EF-EA| FOR LARGE      DLNE-012
C                     ENERGY TERMS, NEGATIVE FOR DECREASE IN            DLNE-013
C                     SQRT|EX-EF-EA|.                                   DLNE-014
C            EX:      ENERGY.                                           DLNE-015
C***********************************************************************DLNE-016
      IMPLICIT REAL*8 (A-H,O-Z)                                         DLNE-017
      DATA PI /3.1415926535897932D0/                                    DLNE-018
      N2=IABS(I2)                                                       DLNE-019
      M2=N2/2                                                           DLNE-020
      MV=NV/2                                                           DLNE-021
      EL=EA-EF                                                          DLNE-022
      AG1X=(EL+EX)**N2/((EL+EX)**N2+EA**N2)                             DLNE-023
      AG2X=(2*EF-EP-EX)**NV/((2*EF-EP-EX)**NV+B**NV)                    DLNE-024
      AG2F=(EF-EP)**NV/((EF-EP)**NV+B**NV)                              DLNE-025
      IF (CV.NE.0.D0) GO TO 1                                           DLNE-026
      IF (I2.LT.0) DLNE=.5D0*DLOG(EA)-AG1X*DLOG(EX+EL)                  DLNE-027
      IF (I2.GT.0) DLNE=.5D0*AG2F*DLOG(EA)-AG1X*AG2X*DLOG(EX+EL)        DLNE-028
      GO TO 3                                                           DLNE-029
    1 IF (CV.GT.0.D0) GO TO 2                                           DLNE-030
      CALL DCEI(0.D0,-CV*DSQRT(EX+EL),BRF,BIF)                          DLNE-031
      CALL DCEI(0.D0,-CV*DSQRT(EA),CRF,CIF)                             DLNE-032
      IF (I2.LT.0) DLNE=2*AG1X*BRF-CRF                                  DLNE-033
      IF (I2.GT.0) DLNE=2*AG1X*AG2X*BRF-AG2F*CRF                        DLNE-034
      GO TO 3                                                           DLNE-035
    2 IF (I2.LT.0) DLNE=AG1X*DREI(CV*(EX+EL))-.5D0*DREI(CV*EA)          DLNE-036
      IF (I2.GT.0) DLNE=(AG1X*AG2X*DREI(CV*(EX+EL))-.5D0*AG2F*DREI(CV*EADLNE-037
     1))                                                                DLNE-038
    3 BN=PI/DFLOAT(2*M2)                                                DLNE-039
      KB=1                                                              DLNE-040
      MP=M2                                                             DLNE-041
      MQ=MV                                                             DLNE-042
      AMP=-EL                                                           DLNE-043
      BMP=EA                                                            DLNE-044
      AMQ=2*EF-EP                                                       DLNE-045
      BMQ=B                                                             DLNE-046
    4 DO 9 I=1,MP                                                       DLNE-047
      CN=(2*I-1)*BN                                                     DLNE-048
      AZR=DCOS(CN)*BMP/MP                                               DLNE-049
      AZI=DSIN(CN)*BMP/MP                                               DLNE-050
      BPR=AMP+BMP*DCOS(CN)                                              DLNE-051
      BPI=BMP*DSIN(CN)                                                  DLNE-052
C RESIDUE AZR+I*AZI, POLE BPR+I*BPI                                     DLNE-053
      CTX=(BPR-EX)**2+BPI**2                                            DLNE-054
      CTF=(BPR-EF)**2+BPI**2                                            DLNE-055
      CR=(BPR-EX)/CTX-(BPR-EF)/CTF                                      DLNE-056
      CI=BPI*(1/CTF-1/CTX)                                              DLNE-057
      BR=CR*AZR-CI*AZI                                                  DLNE-058
      BI=CR*AZI+CI*AZR                                                  DLNE-059
C RESIDUE*(1/(P1(I)-EX)-1/(P1(I)-EF))  BR+I*BI                          DLNE-060
      IF (I2.LT.0) GO TO 5                                              DLNE-061
      AT=(((AMQ-BPR)**2+BPI**2)/BMQ**2)**MQ                             DLNE-062
      CN=DATAN2(-BPI,AMQ-BPR)*MQ*2.D0                                   DLNE-063
      ANR=AT*DCOS(CN)                                                   DLNE-064
      ANI=AT*DSIN(CN)                                                   DLNE-065
      CT=AT**2+2*AT*DCOS(CN)+1.D0                                       DLNE-066
      ER=(AT*DCOS(CN)+AT**2)/CT                                         DLNE-067
      EI=AT*DSIN(CN)/CT                                                 DLNE-068
C VALUE OF THE OTHER FUNCTION AT THE POLE ER+I*EI                       DLNE-069
    5 IF (CV.NE.0.D0) GO TO 6                                           DLNE-070
      CR=-DLOG((EL+BPR)**2+BPI**2)*.5D0                                 DLNE-071
      CI=-DATAN2(BPI,EL+BPR)                                            DLNE-072
      GO TO 8                                                           DLNE-073
    6 IF (CV.GT.0.D0) GO TO 7                                           DLNE-074
      AT=CV*((EL+BPR)**2+BPI**2)**.25D0                                 DLNE-075
      CN=DATAN2(BPI,EL+BPR)/2.D0                                        DLNE-076
      CALL DCEI(-AT*DSIN(CN),AT*DCOS(CN),CR,CI)                         DLNE-077
      CALL DCEI(AT*DSIN(CN),-AT*DCOS(CN),DR,DI)                         DLNE-078
      CR=CR+DR                                                          DLNE-079
      CI=CI+DI                                                          DLNE-080
      GO TO 8                                                           DLNE-081
    7 CALL DCEI(CV*(EL+BPR),CV*BPI,CR,CI)                               DLNE-082
    8 DR=(CR*BR-CI*BI)                                                  DLNE-083
      DI=(CR*BI+CI*BR)                                                  DLNE-084
      IF (I2.GT.0) DR=DR*ER-DI*EI                                       DLNE-085
    9 DLNE=DLNE+DR                                                      DLNE-086
      IF (KB.EQ.2) GO TO 11                                             DLNE-087
      IF (I2.LT.0) GO TO 10                                             DLNE-088
      KB=KB+1                                                           DLNE-089
      BN=PI/DFLOAT(NV)                                                  DLNE-090
      MP=MV                                                             DLNE-091
      MQ=M2                                                             DLNE-092
      AMP=2*EF-EP                                                       DLNE-093
      BMP=B                                                             DLNE-094
      AMQ=-EL                                                           DLNE-095
      BMQ=EA                                                            DLNE-096
      GO TO 4                                                           DLNE-097
   10 DLNE=DLNE*(EF-EP+EA)**NV/((EF-EP+EA)**NV+B**NV)                   DLNE-098
   11 DLNE=DLNE/PI                                                      DLNE-099
      RETURN                                                            DLNE-100
      END                                                               DLNE-101
C 11/01/07                                                      ECIS06  DLPE-000
      FUNCTION DLPE(EL,EX,EF,CN)                                        DLPE-001
C CONTRIBUTION TO THE REAL VOLUME POTENTIAL OF THE LARGE POSITIVE       DLPE-002
C ENERGIES.                                                             DLPE-003
C INPUT:     EA:      LARGE ENERGY STARTING VALUE ABOVE ZERO ENERGY.    DLPE-004
C            EX:      ENERGY.                                           DLPE-005
C            EF:      FERMI ENERGY.                                     DLPE-006
C            CN:      EXPONENTIAL DECREASE IN |EX-EF-EA| FOR LARGE      DLPE-007
C                     ENERGY TERMS, NEGATIVE FOR DECREASE IN            DLPE-008
C                     SQRT|EX-EF-EA|.                                   DLPE-009
C***********************************************************************DLPE-010
      IMPLICIT REAL*8 (A-H,O-Z)                                         DLPE-011
      DATA PI /3.1415926535897932D0/                                    DLPE-012
      DLPE=0.D0                                                         DLPE-013
      IF (EX.EQ.EF) RETURN                                              DLPE-014
      FF=DSQRT(DABS(EF))                                                DLPE-015
      FL=DSQRT(DABS(EL))                                                DLPE-016
      FX=DSQRT(DABS(EX))                                                DLPE-017
      IF (CN.NE.0.D0) GO TO 5                                           DLPE-018
      DLPE=2.D0*FF*DATAN2(FF,FL)+0.5D0*EL*FL/EF*DLOG(1.D0-EF/EL)-1.5D0*FDLPE-019
     1L*DLOG(DABS(EL-EF))                                               DLPE-020
      IF (EX.GT.0.D0) GO TO 3                                           DLPE-021
      IF (DABS(EX).GT.EL*1.D-5) GO TO 1                                 DLPE-022
      DLPE=DLPE+.5D0*FL*(1.D0+EX/EL/2.D0+(EX/EL)**2/3.D0)               DLPE-023
      GO TO 2                                                           DLPE-024
    1 DLPE=DLPE-0.5D0*EL*FL/EX*DLOG(DABS(1-EX/EL))                      DLPE-025
    2 DLPE=DLPE-2.D0*FX*(DATAN2(FX,FL))+1.5D0*FL*DLOG(DABS(EL-EX))      DLPE-026
      GO TO 16                                                          DLPE-027
    3 IF (DABS(EX).GT.EL*1.D-5) GO TO 4                                 DLPE-028
      DLPE=DLPE+.5D0*FL*(1.D0+EX/EL/2.D0+(EX/EL)**2/3.D0)-FX*(DLOG(DABS(DLPE-029
     1FL-FX)/(FL+FX)))+1.5D0*FL*(DLOG(DABS(EL-EX)))                     DLPE-030
      GO TO 16                                                          DLPE-031
    4 DLPE=DLPE+(FX+1.5D0*FL-0.5D0*EL*FL/EX)*DLOG(FL+FX)+EL*FL/EX*DLOG(FDLPE-032
     1L)                                                                DLPE-033
      IF (DABS(EX-EL).GT.1.D-3) DLPE=DLPE-(FX-1.5D0*FL+0.5D0*EL*FL/EX)*DDLPE-034
     1LOG(DABS(FL-FX))                                                  DLPE-035
      GO TO 16                                                          DLPE-036
    5 IF (CN.GT.0.D0) GO TO 9                                           DLPE-037
      A1=DREI(-CN*FL)                                                   DLPE-038
      A2=DREI(CN*(FX-FL))                                               DLPE-039
      IF (EX.GT.0.D0) GO TO 6                                           DLPE-040
      CALL DCEI(-CN*FL,-CN*FX,A3,A4)                                    DLPE-041
      DLPE=2.D0*FX*A4-3.D0*FL*A3                                        DLPE-042
      IF (EX.GT.-1.D-4) GO TO 7                                         DLPE-043
      DLPE=DLPE+EL*FL/EX*(A3-A1)                                        DLPE-044
      GO TO 8                                                           DLPE-045
    6 A3=DREI(-CN*(FL+FX))                                              DLPE-046
      DLPE=FX*(A2-A3)-1.5D0*FL*(A2+A3)                                  DLPE-047
      IF (EX.LT.1.D-4) GO TO 7                                          DLPE-048
      DLPE=DLPE+.5D0*EL*FL/EX*(A2+A3-2.D0*A1)                           DLPE-049
      GO TO 8                                                           DLPE-050
C USING UP TO THE FOURTH DERIVATIVE OF THE EXPONENTIAL FUNCTION.        DLPE-051
    7 DLPE=DLPE+.5D0*EL*FL*((A1*CN**2+CN/FL+1.D0/EL)*(1.D0+CN**2*EX/12.DDLPE-052
     10)+(CN/FL+3.D0/EL)/EL*EX/6.D0)                                    DLPE-053
    8 CALL DCEI(-CN*FL,-CN*FF,B1,B2)                                    DLPE-054
      DLPE=DLPE-FF*2.D0*B2-EL*FL/EF*(B1-A1)+3.D0*FL*B1                  DLPE-055
      GO TO 16                                                          DLPE-056
    9 IF (EX.LT.0.D0) FX=0.D0                                           DLPE-057
      AV=FX-1.5D0*FL                                                    DLPE-058
      AW=.5D0*EL*FL                                                     DLPE-059
      A2=DREI(CN*(EL-EF))                                               DLPE-060
      A3=DREI(CN*(EL-EX))                                               DLPE-061
      A8=DREI(CN*(EL))                                                  DLPE-062
      A4=(A8-A2)*AW/EF+(A3-A2)*AV                                       DLPE-063
      IF (DABS(EX).GT.1.D-4) GO TO 10                                   DLPE-064
      A4=A4-((A8*CN-1.D0/EL)*(1.D0-.5D0*EX*CN)-0.5D0/EL**2*EX)*AW       DLPE-065
      GO TO 11                                                          DLPE-066
   10 A4=A4-(A8-A3)*AW/EX                                               DLPE-067
   11 A5=A4                                                             DLPE-068
      IMAX=32                                                           DLPE-069
      DO 14 J=1,15                                                      DLPE-070
      A1=0.D0                                                           DLPE-071
      GX=1.D0/EL/DFLOAT(IMAX)                                           DLPE-072
      GY=GX*1.5D0                                                       DLPE-073
      GU=0.D0                                                           DLPE-074
      DO 13 I=1,IMAX                                                    DLPE-075
      IF (I.EQ.IMAX) GY=GX/2.D0                                         DLPE-076
      GU=GU+GX                                                          DLPE-077
      IF (DABS((1.D0-GU*EF)*GU).LT.1.D-6) GO TO 13                      DLPE-078
      IF (EX.GT.0.D0) GO TO 12                                          DLPE-079
      A1=A1+GY*(DSQRT(1.D0/GU))*(1.D0/(1.D0-GU*EX)-1.D0/(1.D0-GU*EF))*DEDLPE-080
     1XP(-CN*(1/GU-EL))/GU                                              DLPE-081
      GO TO 13                                                          DLPE-082
   12 A1=A1+GY/(DSQRT(1.D0/GU)+FX)*DEXP(-CN*(1/GU-EL))/GU**2            DLPE-083
      A1=A1-GY*(DSQRT(1.D0/GU)-FX)/(1.D0-GU*EF)*DEXP(-CN*(1/GU-EL))/GU  DLPE-084
   13 GY=GX                                                             DLPE-085
      DLPE=A1+A4                                                        DLPE-086
      IF (DABS(1.D0-A5/DLPE).LT.1.D-5) GO TO 15                         DLPE-087
      A5=DLPE                                                           DLPE-088
   14 IMAX=2*IMAX                                                       DLPE-089
   15 DLPE=(DLPE-A5)/2+DLPE                                             DLPE-090
   16 DLPE=DLPE/PI                                                      DLPE-091
      RETURN                                                            DLPE-092
      END                                                               DLPE-093
C 12/01/07                                                      ECIS06  DVWI-000
      FUNCTION DVWI(E,EO,NV,B,CS,CR)                                    DVWI-001
C CONTRIBUTION TO THE REAL POTENTIAL OF A DISPERSIVE IMAGINARY TERM     DVWI-002
C '(E-EO)**NV/((E-EO)**NV+BV**NV)' WITH A DAMPING FACTOR                DVWI-003
C 'EXP[-CS*|E-EO|-CR*(E-EO)]'. WITH 'EY=E-E0' FOR POSITIVE VALUES AND   DVWI-004
C 'EY=-E-E0' FOR NEGATIVE VALUES, THE POLES ARE:                        DVWI-005
C 'EY+B*DEXP( I *PI*(2*J-1)/NV)' FOR J=1 TO NV AND THEIR RESIDUES ARE:  DVWI-006
C '2 B*DEXP( I *PI*(2*J-1)/NV)/NV' EVENTUALLY MULTIPLIED BY THE DAMPING DVWI-007
C FACTOR.                                                               DVWI-008
C INPUT:     E:       ENERGY MINUS THE FERMI ENERGY.                    DVWI-009
C            EO:      THRESHOLD ENERGY MINUS THE FERMI ENERGY.          DVWI-010
C            NV:      POWER IN THE EXPRESSION GIVEN ABOVE.              DVWI-011
C            B:       CONSTANT IN THE EXPRESSION GIVEN ABOVE.           DVWI-012
C            CS:      EXPONENTIAL DECREASE IN |E-EF|.                   DVWI-013
C            CR:      EXPONENTIAL DECREASE IN (E-EF).                   DVWI-014
C***********************************************************************DVWI-015
      IMPLICIT REAL*8 (A-H,O-Z)                                         DVWI-016
      DATA PI /3.1415926535897932D0/                                    DVWI-017
      M=NV/2                                                            DVWI-018
      IF ((CR.NE.0.D0).OR.(CS.NE.0.D0)) GO TO 2                         DVWI-019
C WITHOUT DAMPING. NO INTEGRAL BETWEEN -E-EO AND E-EO.                  DVWI-020
      DVWI=(DLOG(DABS(E+EO)/B)*(E+EO)**NV/((E+EO)**NV+B**NV)-DLOG(DABS(EDVWI-021
     1-EO)/B)*(E-EO)**NV/((E-EO)**NV+B**NV))                            DVWI-022
C LOOP ON POLES IN THE COMPLEX UPPER PLANE.                             DVWI-023
      DO 1 J=1,M                                                        DVWI-024
      BT=PI*DFLOAT(2*J-1)/DFLOAT(NV)                                    DVWI-025
      H=((E-EO)**2+2.D0*B*(E-EO)*DCOS(BT)+B**2)*M/B                     DVWI-026
      G=((E+EO)**2-2.D0*B*(E+EO)*DCOS(BT)+B**2)*M/B                     DVWI-027
    1 DVWI=DVWI+((E-EO)/H+(E+EO)/G)*DSIN(BT)*BT                         DVWI-028
      GO TO 4                                                           DVWI-029
    2 H=DFLOAT(M)*(E-EO)**NV/((E-EO)**NV+B**NV)*DREI((CS+CR)*(EO-E))    DVWI-030
      G=-DFLOAT(M)*(E+EO)**NV/((E+EO)**NV+B**NV)*DREI((CS-CR)*(EO+E))   DVWI-031
C LOOP ON POLES IN THE COMPLEX UPPER PLANE.                             DVWI-032
      DO 3 J=1,M                                                        DVWI-033
      BT=PI*DFLOAT(2*J-1)/DFLOAT(NV)                                    DVWI-034
      AT=B*DCOS(BT)                                                     DVWI-035
      AZ=B*DSIN(BT)                                                     DVWI-036
      CALL DCEI((CS+CR)*AT,(CS+CR)*AZ,BR,BI)                            DVWI-037
      H=H+((BR*AT-BI*AZ)*(E-EO)+BR*B**2)/((E-EO+AT)**2+AZ**2)           DVWI-038
      CALL DCEI((CS-CR)*AT,(CS-CR)*AZ,BR,BI)                            DVWI-039
    3 G=G+((BR*AT-BI*AZ)*(E+EO)-BR*B**2)/((E+EO-AT)**2+AZ**2)           DVWI-040
      DVWI=(DEXP(-(CS+CR)*EO)*H+DEXP(-(CS-CR)*EO)*G)/DFLOAT(M)          DVWI-041
    4 DVWI=DVWI/PI                                                      DVWI-042
      RETURN                                                            DVWI-043
      END                                                               DVWI-044
C 07/03/07                                                      ECIS06  CAL1-000
      SUBROUTINE CAL1(NW,CW,DW,LO)                                      CAL1-001
C THIS SUBROUTINE COMPUTES FORM FACTORS (POTE), LOOKS FOR QUANTUM       CAL1-002
C NUMBERS (QUAN), CHECKS FOR CONVERGENCE WITH RESPECT TO TOTAL SPIN,    CAL1-003
C COMPUTES HELICITY AMPLITUDES (SCHE) AND COMPUTES CHI2 (RESU).         CAL1-004
C INPUT:     NW:      WORKING AREA FOR INTEGERS.                        CAL1-005
C            CW:      WORKING AREA FOR CHARACTERS.                      CAL1-006
C            DW:      WORKING AREA FOR DOUBLE PRECISION.                CAL1-007
C                     NW,CW,DW ARE IN EQUIVALENCE BY CALL.              CAL1-008
C            LO(I):   LOGICAL CONTROLS:                                 CAL1-009
C               LO(21) =.TRUE. USUAL COUPLED EQUATIONS.                 CAL1-010
C               LO(23) =.TRUE. NO USE OF PADE AND SHIFT TO USUAL COUPLEDCAL1-011
C                              EQUATIONS WHEN THERE IS NO CONVERGENCE.  CAL1-012
C               LO(24) =.TRUE. COMPUTE THE COUPLINGS AT EACH ITERATION. CAL1-013
C               LO(25) =.TRUE. COMPLETE CALCULATION UP TO THE END - (F: CAL1-014
C                              ONE ITERATION IF TWO ARE ENOUGH).        CAL1-015
C               LO(28) =.TRUE. COMPUTATION UP TO J-CONVERGENCE-(F: STOP CAL1-016
C                              WHEN ALL COUPLING TERMS NEGLIGIBLE).     CAL1-017
C               LO(43) =.TRUE. INTERPOLATION ON TOTAL SPIN.             CAL1-018
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     CAL1-019
C               LO(51) =.TRUE. OUTPUT OF POTENTIALS.                    CAL1-020
C               LO(54) =.TRUE. OUTPUT LENGTH USED IN THE WORKING FIELD. CAL1-021
C               LO(63) =.TRUE. PENETRABILITIES WRITTEN ON FILE 63.      CAL1-022
C               LO(74) =.TRUE. OUTPUT OF TIME IN DIFFERENT STEPS.       CAL1-023
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             CAL1-024
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         CAL1-025
C               LO(100)=.TRUE. DIRAC EQUATION.                          CAL1-026
C               LO(104)=.TRUE. CONVERGENCE IS OBTAINED IN THE ITERATION.CAL1-027
C               LO(107)=.TRUE. ALL THE COUPLINGS CALCULATED BEFOREHAND. CAL1-028
C               LO(108)=.TRUE. DIAGONAL COULOMB CORRECTIONS ARE NEEDED. CAL1-029
C               LO(110)=.TRUE. DERIVATIVES ARE NEEDED.                  CAL1-030
C               LO(115)=.TRUE. FIRST COMPUTATION FOR THIS ENERGY.       CAL1-031
C               LO(117)=.TRUE. FOR ALL CALCULATIONS EXCEPT THE FIRST.   CAL1-032
C               LO(118)=.TRUE. FOR LAST RESULTS.                        CAL1-033
C               LO(119)=.TRUE. RESULTS WITH THE LAST CALCULATION.       CAL1-034
C               LO(120)=.TRUE. OUTPUT AND LAST CALCULATION BEST ONE.    CAL1-035
C               LO(122)=.TRUE. IDENTICAL PARTICLES WITHOUT SPIN.        CAL1-036
C               LO(124)=.TRUE. COMPUTE TRANSMISSION COEFFICIENTS.       CAL1-037
C               LO(125)=.TRUE. USUAL COUPLED EQUATIONS.                 CAL1-038
C               LO(127)=.TRUE. COULOMB CORRECTIONS IN ASYMPTOTIC REGION.CAL1-039
C               LO(128)=.TRUE. NO COPY OF UNCOUPLED FUNCTIONS AND       CAL1-040
C                              PHASE-SHIFTS.                            CAL1-041
C               LO(131)=.TRUE. TOTAL SPIN IS TOO LARGE FOR COMPOUND     CAL1-042
C                              NUCLEUS.                                 CAL1-043
C OUTPUT:     LO:     LOGICAL CONTROLS. DEFINED HERE:                   CAL1-044
C                     LO(24), LO(107), LO(115), LO(117), LO(125),       CAL1-045
C                     LO(127), LO(128) AND LO(131).                     CAL1-046
C                                                                       CAL1-047
C FOR THE COMMON  /ADDRE/, /COUPL/, /DCONS/ AND /INTEG/ SEE CALC.       CAL1-048
C FOR THE COMMON  /CONVE/ SEE CALX.                                     CAL1-049
C FOR THE COMMON  /NOEQU/ SEE QUAN.                                     CAL1-050
C FOR THE COMMON  /POTE2/ SEE REDM.                                     CAL1-051
C                                                                       CAL1-052
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ADDRE/:                     CAL1-053
C  NJIT:      DATA FOR INTERPOLATION ON TOTAL SPIN.                     CAL1-054
C  NWV:       NON INTEGER VALUES FOR THE CHANNELS.                      CAL1-055
C  NIPP:      DISPERSION PARAMETERS.                                    CAL1-056
C  NFIS:      FISSION DATA FOR COMPOUND NUCLEUS.                        CAL1-057
C  NGAM:      GAMMA DATA FOR COMPOUND NUCLEUS.                          CAL1-058
C  NNIV:      ADDRESSES OF REDUCED NUCLEAR MATRIX ELEMENTS AND COULOMB  CAL1-059
C             INTEGRALS IN NIV(NCOLL,NCOLL,3).                          CAL1-060
C  NPOT:      OPTICAL POTENTIAL PARAMETERS.                             CAL1-061
C  NBETA:     DEFORMATION PARAMETERS.                                   CAL1-062
C  NFM:       HELICITIES AND OBSERVABLES (SEE DEPH,LECD AND OBSE).      CAL1-063
C  NTGX:      BEGINNING OF CHI2 AND NORMALISATION OF DATA.              CAL1-064
C  NDONN:     EXPERIMENTAL DATA.                                        CAL1-065
C  NNVI:      TABLE OF ADDRESSES OF COUPLING COEFFICIENTS.              CAL1-066
C  NNWI:      SAME AS NNVI FOR SYMMETRISED EQUATIONS.                   CAL1-067
C  NCC:       TABLE OF ENERGIES, L*(L+1) AND L*S  (SEE QUAN).           CAL1-068
C  MCC:       SAME AS NCC FOR SYMMETRISED EQUATIONS.                    CAL1-069
C  NXA:       TABLE OF COEFFICIENTS OF SYMMETRISATION.                  CAL1-070
C  NAM1:      COMPUTATION OF OBSERVABLES (SEE OBSE).                    CAL1-071
C  NFAC:      TABLE OF LOG OF FACTORIALS FOR GEOMETRIC COEFFICIENTS.    CAL1-072
C  NFG:       COULOMB FUNCTIONS AND FINITE INTEGRALS.                   CAL1-073
C  NXG:       COULOMB PHASES AND INFINITE INTEGRALS.                    CAL1-074
C  NRES:      FUNCTIONS FOR THE SEARCH.                                 CAL1-075
C  NT:        TABLE OF REDUCED NUCLEAR MATRIX ELEMENTS.                 CAL1-076
C  NIVQ:      TABLE OF MULTIPOLES.                                      CAL1-077
C  NIVY:      TABLE OF FORM FACTOR IDENTIFICATION IVY (FOR COMPUTATION).CAL1-078
C  NIVZ:      TABLE OF FORM FACTOR IDENTIFICATION IVZ (FOR USE).        CAL1-079
C  NCOI:      ADDRESS OF THE TABLE FOR DISCRETISATION OF CONTINUUM.     CAL1-080
C  MIPI:      ADDRESS OF "IPIM" FOR THE DISCRETISATION OF CONTINUUM.    CAL1-081
C  NXD:       ADDRESS OF WEIGHTS AND STEPS OF CONTINUUM.                CAL1-082
C  MWV:       SAME AS NWV FOR THE DISCRETISATION OF CONTINUUM.          CAL1-083
C  NIXT:      TRANSMISSION COEFFICIENTS OF UNCOUPLED STATES.            CAL1-084
C  NTY:       TEMPORARY RESULTS OF COMPOUND NUCLEUS FOR INTERPOLATION.  CAL1-085
C  NSM:       STANDARD AND HELICITY SCATTERING MATRIX ELEMENTS.         CAL1-086
C  NTX:       PARTIAL REACTION CROSS SECTIONS AND COMPOUND NUCLEUS.     CAL1-087
C  NRY:       COMPOUND NUCLEUS COEFFICIENTS.                            CAL1-088
C  NRCO:      STRENGTH OF COULOMB CENTRAL POTENTIALS FOR CORRECTIONS.   CAL1-089
C  NRDO:      STRENGTH OF COULOMB TRANSITION POTENTIALS FOR CORRECTIONS.CAL1-090
C  NVC1:      REAL POTENTIALS.                                          CAL1-091
C  NVC2:      IMAGINARY POTENTIALS.                                     CAL1-092
C  NNC:       FIRST FREE ADDRESS AFTER COMPUTATION OF POTENTIALS.       CAL1-093
C  NCX:       FIRST FREE ADDRESS FOR COMPUTATION OF POTENTIALS.         CAL1-094
C   USED:     NJIT,NWV,NIPP,NFIS,NGAM,NNIV,NPOT,NBETA,NFM,NTGX,NDONN,   CAL1-095
C             NNVI,NNWI,NCC,MCC,NXA,NAM1,NFAC,NFG,NXG,NRES,NT,NIVQ,NIVY,CAL1-096
C             NIVZ,NCOI,MIPI,NXD,MWV,NIXT,NTY,NSM,NTX,NRY,NRCO,NRDO,    CAL1-097
C             NVC1,NVC2,NNC,NCX.                                        CAL1-098
C                                                                       CAL1-099
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     CAL1-100
C  H:         STEP SIZE FOR INTEGRATION.                                CAL1-101
C  BJM:       CONVERGENCE COEFFICIENT OF IMAGINARY POTENTIAL.           CAL1-102
C  EITER:     CONVERGENCE CRITERION FOR S-MATRIX.                       CAL1-103
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         CAL1-104
C  CONJ:      CONVERGENCE CRITERION FOR THE SCATTERING AMPLITUDES.      CAL1-105
C  HCONV:     ACONV*H*H CONVERGENCE CRITERION FOR SECOND MEMBERS.       CAL1-106
C   USED:     H,BJM,EITER,ACONV,CONJ.                                   CAL1-107
C                                                                       CAL1-108
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     CAL1-109
C  IQM:       MAXIMUM L-VALUE OF DEFORMATION IN ROTATIONAL MODEL.       CAL1-110
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           CAL1-111
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       CAL1-112
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             CAL1-113
C   USED:     IQM,NBT1,NFA,NPP.                                         CAL1-114
C                                                                       CAL1-115
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     CAL1-116
C  CHB:       PLANCK CONSTANT /(2*PI) IN MEV*FERMI.                     CAL1-117
C  CMB:       ATOMIC MASS CM DIVIDED BY H-BAR*C.                        CAL1-118
C  CCZ:       COULOMB ALPHA CONSTANT.                                   CAL1-119
C  XZ:        CONVERSION FACTOR TO MILLIBARNS.                          CAL1-120
C   USED:     CHB,CMB,CCZ,XZ.                                           CAL1-121
C                                                                       CAL1-122
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INTEG/:                     CAL1-123
C  IDMT:      TOTAL WORKING FIELD LENGTH AS SINGLE PRECISION.           CAL1-124
C  NPLACE:    MAXIMUM WORKING FIELD USED.                               CAL1-125
C  NCOLL:     NUMBER OF COUPLED CHANNELS.                               CAL1-126
C  NJMAX:     MAXIMUM NUMBER OF J-VALUES.                               CAL1-127
C  ITERM:     MAXIMUM NUMBER OF ITERATIONS.                             CAL1-128
C  JDM:       MINIMUM NUMBER OF TOTAL SPIN.                             CAL1-129
C  JIT:       NUMBER OF RATES OF INTERPOLATION ON TOTAL SPIN.           CAL1-130
C  KMIN:      MINIMUM NUMBER OF J VALUES FOR COMPOUND NUCLEUS.          CAL1-131
C  KMAX:      MAXIMUM NUMBER OF J VALUES FOR COMPOUND NUCLEUS.          CAL1-132
C  NCOLS:     NUMBER OF CHANNELS WITH ANGULAR DISTRIBUTIONS.            CAL1-133
C  NCOLT:     NUMBER OF CHANNELS INCLUDING UNCOUPLED STATES.            CAL1-134
C  LMX:       DIFFERENCE BETWEEN NUMBER OF J AND OF COULOMB FUNCTIONS.  CAL1-135
C  LMAX1:     NUMBER OF L-VALUES FOR COULOMB FUNCTIONS.                 CAL1-136
C  NLT:       MEMORIES NEEDED FOR LEGENDRE POLYNOMIALS.                 CAL1-137
C  ISM:       NUMBER OF INTEGRATION STEPS.                              CAL1-138
C  NJC:       MAXIMUM NUMBER OF OBSERVABLES AT EQUIDISTANT ANGLES.      CAL1-139
C  JTX:       MAXIMUM NUMBER OF CALCULATED VALUES FOR A PLOT.           CAL1-140
C  KCC:       NUMBER OF INDEPENDENT AMPLITUDES WITH UNCOUPLED STATES.   CAL1-141
C  MS1:       LARGEST PARTICLE MULTIPLICITY.                            CAL1-142
C  MS2:       LARGEST TARGET MULTIPLICITY.                              CAL1-143
C  KBA:       NUMBER OF INDEPENDENT AMPLITUDES WITHOUT UNCOUPLED STATES.CAL1-144
C  KAB:       MAXIMUM NUMBER OF EQUATIONS.                              CAL1-145
C  KBC:       MAXIMUM NUMBER OF SOLUTIONS.                              CAL1-146
C  JTH:       MAXIMUM NUMBER OF ANGLES FOR A PLOT.                      CAL1-147
C  NCOLR:     NUMBER OF EXPERIMENTAL ANGULAR DISTRIBUTIONS.             CAL1-148
C  LMAX2:     NUMBER OF L VALUES FOR COULOMB PHASES.                    CAL1-149
C  ITEMM:     MAXIMUM NUMBER OF ITERATIONS AT THE BEGINNING OF A RUN.   CAL1-150
C  KXT:       NUMBER OF PENETRABILITIES FOR UNCOUPLED STATES.           CAL1-151
C  LMAX3:     EFFECTIVE NUMBER OF COULOMB FUNCTIONS.                    CAL1-152
C  NRZ:       NUMBER OF RESULTS TO SAVE FOR MINIMUM CHI2..              CAL1-153
C  NTZ:       NUMBER OF MEMORIES TO INITIALISE TO ZERO FOR SCATTERING   CAL1-154
C             MATRIX AND COMPOUND NUCLEUS RESULTS..                     CAL1-155
C  IPM:       NUMBER PF J VALUES USED FOR SCATTERING MATRIX (IN CAL1).  CAL1-156
C  IPK:       NUMBER PF J VALUES USED FOR COMPOUND NUCLEUS (IN CAL1).   CAL1-157
C  MCM(1):    MAXIMUM ANGULAR MOMENTUM FOR CENTRAL COULOMB CORRECTIONS. CAL1-158
C  MCM(2):    MAXIMUM ANGULAR MOMENTUM FOR SPIN-ORBIT COULOMB CORRECT.  CAL1-159
C  NCT(1):    NUMBER OF EQUATIONS FOR POSITIVE PARITY.                  CAL1-160
C  NCT(2):    NUMBER OF EQUATIONS FOR NEGATIVE PARITY.                  CAL1-161
C  NCT(3):    NUMBER OF SOLUTIONS FOR POSITIVE PARITY.                  CAL1-162
C  NCT(4):    NUMBER OF SOLUTIONS FOR NEGATIVE PARITY.                  CAL1-163
C  NCT(5):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, POSITIVE PARITY. CAL1-164
C  NCT(6):    NUMBER OF COMPOUND NUCLEUS COEFFICIENTS, NEGATIVE PARITY. CAL1-165
C   DEFINED:  NPLACE,ITERM,IPM,IPK.                                     CAL1-166
C   USED:     IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOLS,    CAL1-167
C             NCOLT,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,  CAL1-168
C             JTH,NCOLR,LMAX2,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM,NCT.  CAL1-169
C                                                                       CAL1-170
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NOEQU/:                     CAL1-171
C  NCXN:      NUMBER OF SOLUTIONS NEEDED.                               CAL1-172
C  NC:        NUMBER OF EQUATIONS FOR IDENTICAL PARTICLES.              CAL1-173
C  NCIN:      NUMBER OF SOLUTIONS FOR IDENTICAL PARTICLES.              CAL1-174
C  NIN:       NUMBER OF COUPLING POTENTIALS.                            CAL1-175
C  JPI:       PARITY 0 OR 1.                                            CAL1-176
C  IPJ:       VALUE OF J+1 OR J+1/2 WHERE J IS THE CHANNEL SPIN.        CAL1-177
C  R1(2):     MAXIMUM OF SCATTERING AND COMPOUND COEFFICIENT.           CAL1-178
C  NAJ:       TWICE THE CHANNEL SPIN J.                                 CAL1-179
C   DEFINED:  NCXN,NIN,JPI,IPJ,NAJ.                                     CAL1-180
C   USED:     NCXN,NC,NCIN,NIN,R1.                                      CAL1-181
C                                                                       CAL1-182
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     CAL1-183
C  NPX:       NUMBER OF POTENTIALS TAKING INTO ACCOUNT DISPERSION.      CAL1-184
C   USED:     NPX.                                                      CAL1-185
C                                                                       CAL1-186
C***********************************************************************CAL1-187
      IMPLICIT REAL*8 (A-H,O-Z)                                         CAL1-188
      LOGICAL LO(150)                                                   CAL1-189
      CHARACTER*4 CW(2,*)                                               CAL1-190
      CHARACTER*1 JP                                                    CAL1-191
      DIMENSION NW(2,*),DW(*)                                           CAL1-192
      COMMON /ADDRE/ NIPH,NJIT,NWV,NIPP,NPAR,NPAA,NSCN,NFIS,NGAM,NNIV,NPCAL1-193
     1OT,NBETA,NFM,NTGX,NDONN,NNVI,NDE,NISE,NRC,NIW,NNWI,NCC,MCC,NXA,NAMCAL1-194
     21,NFAC,NFG,NXG,NRES,NXX,NT,NIVQ,NIVY,NIVZ,NCOI,MIPI,NXD,MWV,NIXT,NCAL1-195
     3TY,NSM,NTX,NRY,NRCO,NRDO,NVC1,NVC2,NNC,NCX                        CAL1-196
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       CAL1-197
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   CAL1-198
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            CAL1-199
      COMMON /INOUT/ MR,MW,MS                                           CAL1-200
      COMMON /INTEG/ IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOCAL1-201
     1LS,NCOLT,NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,JTCAL1-202
     2H,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM(2),CAL1-203
     3NCT(6)                                                            CAL1-204
      COMMON /NCOMP/ NSP(5),NCONT,NCOJ(3),NCOLX,NDP,NDQ,ACN(20)         CAL1-205
      COMMON /NOEQU/ NCXN,NIC,NCI,NC,NCIN,NIN,JPI,IPJ,R1(2),NAJ         CAL1-206
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         CAL1-207
      LMD=2                                                             CAL1-208
      IF (LO(100).OR.LO(133)) LMD=3                                     CAL1-209
      JMIN=MOD(NW(2,1)+NW(1,2),2)                                       CAL1-210
      NFAM=NNC                                                          CAL1-211
      NPAD=NFAM+KAB*(2*KBC+10)                                          CAL1-212
      IF (LO(124)) NPAD=NFAM+KAB*(2*KAB+10)                             CAL1-213
      NR5=NPAD+2*ITEMM*(KAB+2)                                          CAL1-214
      IF (LO(21).OR.LO(22)) NR5=NPAD                                    CAL1-215
      NWW=NR5+2*KAB                                                     CAL1-216
      NXC=NWW+4*ISM*KAB                                                 CAL1-217
      IF (LO(120).AND.(.NOT.LO(51))) GO TO 2                            CAL1-218
      IF (LO(119)) GO TO 22                                             CAL1-219
      IF (LO(100)) NXC=NXC+4*ISM*KAB                                    CAL1-220
      IF (LO(21)) NXC=NR5                                               CAL1-221
      ID1=IDMT-NCX                                                      CAL1-222
C COMPUTATION OF POTENTIALS AND FORM FACTORS.                           CAL1-223
      N=NCX-1                                                           CAL1-224
      DO 1 I=NRCO,N                                                     CAL1-225
    1 DW(I)=0.D0                                                        CAL1-226
      CALL POTE(DW(NBETA),NW(1,NBETA),NW(1,NIVQ),NW(1,NIVY),NW(1,NIVZ),DCAL1-227
     1W(NPOT),NW(1,NPOT),DW(NWV),DW(MWV),ISM,NCOLL,NCOLX-NCONT,NCOLT,ID1CAL1-228
     2,NW,NW(1,MIPI),NW(1,NIPP),MCM,LO,DW(NVC1),DW(NRCO),DW(NRDO),DW(NIXCAL1-229
     3T),DW(NCX),NW(1,NCX))                                             CAL1-230
    2 IF (LO(120)) GO TO 22                                             CAL1-231
      NPLACE=MAX0(NPLACE,NXC+ID1)                                       CAL1-232
      JPI=0                                                             CAL1-233
      IP1=1                                                             CAL1-234
      IF (LO(122)) IP1=2                                                CAL1-235
      NPT=0                                                             CAL1-236
      N=NTY+NTZ-1                                                       CAL1-237
      DO 3 I=NTY,N                                                      CAL1-238
    3 DW(I)=0.D0                                                        CAL1-239
      IF ((.NOT.LO(81)).OR.LO(82)) GO TO 4                              CAL1-240
      NX=NNC+2*ISM                                                      CAL1-241
      N=NX+2*(ISM+2)                                                    CAL1-242
      IF (N.GT.IDMT) CALL MEMO('CAL1',IDMT,N)                           CAL1-243
      NPLACE=MAX0(NPLACE,N)                                             CAL1-244
C LOOP ON THE PARITIES  JPI IS THE PARITY (0 OR 1).                     CAL1-245
    4 IPJ=1                                                             CAL1-246
      AJM=-1.D0                                                         CAL1-247
      LO(127)=.FALSE.                                                   CAL1-248
      LO(131)=.NOT.LO(81)                                               CAL1-249
      ITERM=ITEMM                                                       CAL1-250
      KB=(KAB+1)/2                                                      CAL1-251
      DO 5 K=1,KB                                                       CAL1-252
      NW(1,NCC+K-1)=0                                                   CAL1-253
    5 NW(2,NCC+K-1)=0                                                   CAL1-254
C LOOP ON THE VALUES OF J.                                              CAL1-255
C SEARCH FOR QUANTUM NUMBERS AND COUPLING COEFFICIENTS.                 CAL1-256
    6 LO(125)=LO(21)                                                    CAL1-257
      NAJ=JMIN+2*IPJ-2                                                  CAL1-258
      AJ=0.5D0*DFLOAT(NAJ)                                              CAL1-259
      ITERR=0                                                           CAL1-260
    7 CALL QUAN(NCOLL,DW(NWV),NW,NW(1,NNIV),NW(1,NT),DW(NT),NW(1,NIVQ),NCAL1-261
     1W(1,NIVZ),NW(1,NCC),NW(1,NXC),DW(NXC),IU,NW(1,NNVI),KAB,KBC,DW(NXACAL1-262
     2),DW(NFAC),NFA,IDMT-NXC-200,LMD,LO)                               CAL1-263
      IF (NCIN.EQ.0) GO TO 15                                           CAL1-264
      AJM=AJ                                                            CAL1-265
      NX=NXC+IU*LMD                                                     CAL1-266
      IPX=IPJ                                                           CAL1-267
      LO(131)=LO(131).OR.IPJ.GT.KMAX                                    CAL1-268
      NX1=NX                                                            CAL1-269
      NCXN=NCIN                                                         CAL1-270
      IF (LO(124)) NCXN=NC                                              CAL1-271
      NWR=2*NX1+20*KAB*KAB-1                                            CAL1-272
      IF (NWR+10*KAB**2.GT.IDMT) CALL MEMO('CAL1',IDMT,NWR+10*KAB**2)   CAL1-273
      CALL MTCH(NW(1,NNWI),NCOLL,KAB,DW(NWV),NW(1,MCC),DW(NXG),NW(1,NXC)CAL1-274
     1,DW(NXC),DW(NX1),ISM,LMAX2,NW(1,NNIV),NW(1,NIVZ),DW(NFG),LMAX1,LMACAL1-275
     2X3,NW(1,NWR),DW(NRCO),DW(NRDO),DW(NFAM),LMD,LO)                   CAL1-276
      IF (LO(127)) GO TO 12                                             CAL1-277
      IF (LO(44)) NX=NX+4*KAB*KAB                                       CAL1-278
      IF (LO(74)) CALL HORA                                             CAL1-279
C NX FIRST ADDRESS WHICH CAN BE USED.                                   CAL1-280
      IF (LO(125)) GO TO 12                                             CAL1-281
C ITERATIONS.                                                           CAL1-282
      NFAR=NFAM+10*KAB                                                  CAL1-283
      NFAI=NFAR+NCXN*KAB                                                CAL1-284
      IF (LO(100)) GO TO 8                                              CAL1-285
      NWR=2*NX+4*(ISM+2)-1                                              CAL1-286
      NR4=NWR+2*NC*ISM                                                  CAL1-287
      IF (LO(110)) NR4=NWR+4*NC*ISM                                     CAL1-288
      N=NR4+2*ISM                                                       CAL1-289
      GO TO 9                                                           CAL1-290
    8 NWR=NX+2*(ISM+2)                                                  CAL1-291
      NR4=NWR+4*NC*ISM                                                  CAL1-292
      NIN=4*NIN                                                         CAL1-293
C  N IS THE FIRST FREE ADDRESS AND NIN THE NUMBER OF COUPLING POTENTIALSCAL1-294
C WHICH CAN BE STORED.                                                  CAL1-295
      N=NR4+4*ISM                                                       CAL1-296
    9 N3=N                                                              CAL1-297
      IF (N.GT.IDMT) CALL MEMO('CAL1',IDMT,N)                           CAL1-298
      LO(107)=(.NOT.LO(24)).AND.ITERM.GT.1                              CAL1-299
      IF (BJM.NE.0.D0) NIN=NIN+NC                                       CAL1-300
      IF (LO(107)) N3=N3+NIN*ISM                                        CAL1-301
      IF (LO(54)) WRITE (MW,1000) N3,AJM                                CAL1-302
      IF (N3.LE.IDMT) GO TO 10                                          CAL1-303
      LO(107)=.FALSE.                                                   CAL1-304
      LO(24)=.TRUE.                                                     CAL1-305
      N3=N                                                              CAL1-306
      WRITE (MW,1001)                                                   CAL1-307
   10 NPLACE=MAX0(NPLACE,N3)                                            CAL1-308
      IF (LO(100)) GO TO 11                                             CAL1-309
      CALL INTI(DW(NFAM),DW(NX),DW(NWW),DW(NWR),DW(NR4),DW(NPAD),NW(1,NRCAL1-310
     15),ISM,KAB,DW(N),ITERM,NC,DW(NVC1),NW(1,NNWI),NW(1,MCC),NW(1,NXC),CAL1-311
     2DW(NXC),LMD,DW(NX1),NCXN,NNI,ITERR,LO)                            CAL1-312
      IF (LO(104).OR.ITERM.EQ.1) GO TO 13                               CAL1-313
      IF (.NOT.LO(23)) GO TO 13                                         CAL1-314
      IF (LO(110)) WRITE (MW,1002) AJM,JPI                              CAL1-315
      LO(125)=.TRUE.                                                    CAL1-316
      LO(128)=.TRUE.                                                    CAL1-317
      GO TO 7                                                           CAL1-318
   11 CALL INTR(DW(NFAM),DW(NX),DW(NWW),DW(NWR),DW(NR4),DW(NPAD),NW(1,NRCAL1-319
     15),ISM,KAB,DW(N),ITERM,NC,DW(NVC1),DW(NVC2),NW(1,NNWI),NW(1,MCC),NCAL1-320
     2W(1,NXC),DW(NXC),DW(NX1),NCXN,NNI,ITERR,LO)                       CAL1-321
      GO TO 13                                                          CAL1-322
C USUAL COUPLED CHANNELS CALCULATION.                                   CAL1-323
C NWR IS THE FIRST ADDRESS TO STORE POTENTIALS AND NM THE MAXIMUM       CAL1-324
C NUMBER OF POINTS   FOR ARGUMENTS  SEE INCH.                           CAL1-325
   12 NWR=NX+6*KAB*KAB                                                  CAL1-326
      IF (LO(54)) WRITE (MW,1000) NWR,AJM                               CAL1-327
      NFAI=NX+KAB*KAB                                                   CAL1-328
      NFAR=NFAI+3*KAB*KAB                                               CAL1-329
      IF (LO(127)) GO TO 13                                             CAL1-330
      N=NWR+2*NC*NC*(ISM+1)                                             CAL1-331
      IF (N.GT.IDMT) CALL MEMO('CAL1',IDMT,N)                           CAL1-332
      NM=(IDMT-NWR)/(2*NC*NC)-1                                         CAL1-333
      NM=MIN0(NM,ISM)                                                   CAL1-334
      IF (LO(54).AND.NM.NE.ISM) WRITE (MW,1003) NM                      CAL1-335
      N3=NWR+2*(NM+1)*NC*NC                                             CAL1-336
      NPLACE=MAX0(NPLACE,N3,NFAR+3*KAB*KAB)                             CAL1-337
      CALL INCH(DW(NVC1),NW(1,MCC),NW(1,NXC),DW(NXC),LMD,NW(1,NNWI),DW(NCAL1-338
     1FAM),DW(NX1),DW(NX),DW(NWR),ISM,KAB,NC,NCXN,NM,ITERM,NW(1,NWR),LO)CAL1-339
   13 IF (LO(74)) CALL HORA                                             CAL1-340
C NFAR AND NFAI  ADDRESSES OF REAL AND IMAGINARY PARTS OF S-MATRIX.     CAL1-341
      NMX=NWR+(4+NCIN)*(NC+KXT)                                         CAL1-342
      N=NMX+MAX0(4*NC*NC,LMAX2+4*IPJ)                                   CAL1-343
      IF (N.GT.IDMT) CALL MEMO('CAL1',IDMT,N)                           CAL1-344
      NPT=NPT+1                                                         CAL1-345
      CALL SCAM(DW(NSM),DW(NTY),DW(NTX),DW(NRY),NJMAX,KMAX,NW(1,MCC),NW(CAL1-346
     11,NCC),DW(NFAR),DW(NFAI),DW(NWV),NCOLL,NCOLS,KAB,KCC,NW,NW(1,MIPI)CAL1-347
     2,DW(NGAM),DW(NFIS),DW(NIXT),NW(1,NCOI),DW(NXD),DW(NMX),DW(NMX),DW(CAL1-348
     3NWR),NCT,NCIN+4,DW(NXA),KBC,IDMT-NMX,LO)                          CAL1-349
      IF (LO(131)) GO TO 14                                             CAL1-350
      LO(131)=R1(2).LT.CONJ.AND.IPJ.GT.KMIN                             CAL1-351
      IF (.NOT.LO(131)) IPK=IPJ                                         CAL1-352
      IF (LO(131).AND.(LO(118).OR.LO(115))) WRITE (MW,1004) AJM,R1(2)   CAL1-353
   14 IF (LO(74)) CALL HORA                                             CAL1-354
      IF (LO(21)) GO TO 15                                              CAL1-355
C REDUCTION OF MAXIMUM NUMBER OF ITERATIONS IF 2 WHERE SUFFICIENT(ITERR)CAL1-356
      IF ((.NOT.LO(25)).AND.(ITERR.LE.2).AND.(IPJ.GT.JDM)) ITERM=1      CAL1-357
C CHECKS OF CONVERGENCE.                                                CAL1-358
      IF ((NNI.EQ.NC).AND.(IPJ.GT.JDM)) LO(127)=.TRUE.                  CAL1-359
      IF ((.NOT.LO(28)).AND.NNI.EQ.NC.AND.IPJ.GT.JDM+1) GO TO 18        CAL1-360
C INCREASE OF THE TOTAL ANGULAR MOMENTUM.                               CAL1-361
   15 IF (.NOT.LO(43)) GO TO 17                                         CAL1-362
      DO 16 I=1,JIT                                                     CAL1-363
      IF (IPJ.LE.NW(1,NJIT+I-1)) GO TO 17                               CAL1-364
   16 IPJ=IPJ+NW(2,NJIT+I-1)*IP1                                        CAL1-365
   17 IPJ=IPJ+IP1                                                       CAL1-366
      IF (IPJ.GT.LMAX3-LMX) LO(127)=.TRUE.                              CAL1-367
      IF (.NOT.LO(108)) LO(127)=.FALSE.                                 CAL1-368
      IF ((IPJ.LE.NJMAX).AND.((R1(1).GE.CONJ).OR.(IPJ.LE.JDM).OR.(NCIN.ECAL1-369
     1Q.0))) GO TO 6                                                    CAL1-370
C CHANGE OF PARITY.                                                     CAL1-371
   18 NAJ=JMIN+2*IPX-2                                                  CAL1-372
      IF (LO(118).OR.LO(115)) WRITE (MW,1005) AJM,R1(1)                 CAL1-373
      IF (JPI.EQ.1) GO TO 19                                            CAL1-374
      JPI=JPI+1                                                         CAL1-375
      IPY=IPX                                                           CAL1-376
      IPZ=IPK                                                           CAL1-377
      GO TO 4                                                           CAL1-378
   19 IPM=MAX0(IPX,IPY)                                                 CAL1-379
      IPK=MAX0(IPK,IPZ)                                                 CAL1-380
      IF (.NOT.LO(63)) GO TO 22                                         CAL1-381
      WRITE (63,1006) DW(NWV),DW(NWV+12),DW(NWV+1),NW(2,2),NPT          CAL1-382
      REWIND 99                                                         CAL1-383
      DO 21 I=1,NPT                                                     CAL1-384
      READ (99,1007) U1,JP,K3                                           CAL1-385
      WRITE (63,1007) U1,JP,K3                                          CAL1-386
      DO 20 K=1,K3                                                      CAL1-387
      READ (99,1008) K1,K2,U1,U2                                        CAL1-388
   20 WRITE (63,1008) K1,K2,U1,U2                                       CAL1-389
   21 CONTINUE                                                          CAL1-390
C     CLOSE (99)                                                        CAL1-391
   22 KCB=MAX0(NCT(5),NCT(6))                                           CAL1-392
      NDX=NXC+4*KCB                                                     CAL1-393
      NDY=NDX+JTH                                                       CAL1-394
      NDZ=NDY+JTH                                                       CAL1-395
      NMY=NDZ+JTX                                                       CAL1-396
      NGA=NMY+3*NJC                                                     CAL1-397
      NMA=NGA+4*KBC*KAB                                                 CAL1-398
      NMC=NMA+MS1*MS2*KCB                                               CAL1-399
      N=NMC+2*IPM                                                       CAL1-400
      IF (N.GT.IDMT) CALL MEMO('CAL1',IDMT,N)                           CAL1-401
      CALL SCHE(DW(NSM),NJMAX,KMAX,NW,MS1,MS2,NW(1,NFM),DW(NTX),DW(NMC),CAL1-402
     1NW(1,NXC),DW(NGA),DW(NXG),LMAX2,DW(NWV),KAB,KBA,KCB,JMIN,IPM,IPK,DCAL1-403
     2W(NTY),NCOLL,NCOLS,NCT,DW(NRY),DW(NMA),JIT,NW(1,NJIT),NLT,IDMT-NMCCAL1-404
     3,LO)                                                              CAL1-405
      ID1=IDMT-NGA                                                      CAL1-406
C FOR ARGUMENTS    SEE CALX AND RESU.                                   CAL1-407
      CALL RESU(NW,DW(NSM),DW(NTX),DW(NSM),NJMAX,KMAX,NCOLL,NCOLS,NW(1,NCAL1-408
     1FM),CW(1,NFM),NW(1,NTGX),DW(NTGX),IPM,IPK,DW(NDONN),NCOLR,NW(1,NAMCAL1-409
     21),DW(NAM1),DW(NWV),DW(MWV),DW(NRY),NW(1,NCOI),DW(NXD),JMIN,NRZ,NJCAL1-410
     3C,DW(NRES),DW(NGA),DW(NMY),DW(NDX),DW(NDY),DW(NDZ),ID1,LO)        CAL1-411
      NPLACE=MAX0(NPLACE,NGA+ID1)                                       CAL1-412
      IF (LO(74)) CALL HORA                                             CAL1-413
      LO(117)=.TRUE.                                                    CAL1-414
      LO(115)=.FALSE.                                                   CAL1-415
      RETURN                                                            CAL1-416
 1000 FORMAT (10X,'REQUIRED WORKING FIELD',I10,'  FOR J =',F7.1)        CAL1-417
 1001 FORMAT (/' WORKING FIELD TOO SMALL TO STORE ALL THE POTENTIALS'/1XCAL1-418
     1,52('*')//' THE 24TH CONTROL IS SET .TRUE.'//)                    CAL1-419
 1002 FORMAT (' WARNING: FOR J =',F6.1,' PARITY (-1)**',I1,' THE DERIVATCAL1-420
     1IVE TERMS ARE NEGLECTED.')                                        CAL1-421
 1003 FORMAT ('+',60X,'COMPUTATION OF POTENTIALS BY',I5,'  AT A TIME')  CAL1-422
 1004 FORMAT (' MAXIMUM J-VALUE =',F6.1,' FOR COMPOUND NUCLEUS',6X,'MAXICAL1-423
     1MUM COEFFICIENT AT THE END',D12.3)                                CAL1-424
 1005 FORMAT (' MAXIMUM J-VALUE =',F6.1,16X,'MAXIMUM SCATTERING COEFFICICAL1-425
     1ENT AT THE END',D12.3)                                            CAL1-426
 1006 FORMAT ('<TLJ     >',F10.2,1P,D20.8,0P,F10.2,2I5)                 CAL1-427
 1007 FORMAT (1X,F9.1,4X,A1,1X,I4)                                      CAL1-428
 1008 FORMAT (1X,I2,I6,F9.1,2X,1P,D18.8,0P)                             CAL1-429
      END                                                               CAL1-430
C 19/04/07                                                      ECIS06  POTE-000
      SUBROUTINE POTE(BETA,NBETA,IVQ,IVY,IVZ,VAL,NVAL,WV,WVM,ISM,NCOLL,NPOTE-001
     1COLD,NCOLT,IDT,IPI,IPIM,IPP,MCM,LO,V,VCO,VDO,TL,Q,NP)             POTE-002
C COMPUTATION AND OUTPUT OF FORM FACTORS.                               POTE-003
C INPUT:     BETA:    DEFORMATIONS OF THE TARGET.                       POTE-004
C            NBETA:   EQUIVALENT BY CALL WITH BETA.                     POTE-005
C            IVQ:     TABLE OF ANGULAR MOMENTA OF FORM FACTORS.         POTE-006
C            IVY:     TABLE FOR COMPUTATION OF FORM FACTORS.            POTE-007
C            IVZ:     TABLE FOR USE OF FORM FACTORS.                    POTE-008
C            VAL,NVAL:OPTICAL MODEL AND FOLDING PARAMETERS.             POTE-009
C            WV,WVM:  DESCRIPTION OF THE CHANNELS (SEE CALX).           POTE-010
C            ISM:     NUMBER OF POINTS.                                 POTE-011
C            NCOLL:   NUMBER OF COUPLED NUCLEAR STATES.                 POTE-012
C            NCOLD:   TOTAL NUMBER OF STATES WITHOUT CONTINUUM.         POTE-013
C            NCOLT:   TOTAL NUMBER OF STATES WITH CONTINUUM.            POTE-014
C            IDT:     MAXIMUM WORKING FIELD Q.                          POTE-015
C            IPI,IPIM:DESCRIPTION OF THE CHANNELS (SEE CALX).           POTE-016
C            IPP:     CROSS-REFERENCE TO POTENTIALS IN IPI(1,*).        POTE-017
C            MCM:     ANGULAR MOMENTUM LIMITS ON COULOMB CORRECTIONS.   POTE-018
C            LO:      LOGICAL CONTROLS:                                 POTE-019
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).POTE-020
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     POTE-021
C                              ROTATIONAL MODEL.                        POTE-022
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    POTE-023
C               LO(10) =.TRUE. DISPERSION RELATIONS FOR POTENTIALS.     POTE-024
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              POTE-025
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            POTE-026
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      POTE-027
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. POTE-028
C               LO(17) =.TRUE. FOLDING MODEL.                           POTE-029
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   POTE-030
C               LO(51) =.TRUE. OUTPUT OF POTENTIALS.                    POTE-031
C               LO(62) =.TRUE. POTENTIALS WRITTEN ON FILE 62.           POTE-032
C               LO(74) =.TRUE. OUTPUT OF TIME IN DIFFERENT STEPS.       POTE-033
C               LO(93) =.TRUE. NO RECOIL CORRECTION FOR REACTIONS.      POTE-034
C               LO(93) =.TRUE. NO RECOIL CORRECTION FOR REACTIONS WITH  POTE-035
C                              SMALL DIFFERENCES (LESS THAN .5) OF      POTE-036
C                              TARGET MASSES.                           POTE-037
C               LO(99) =.TRUE. SCHROEDINGER EQUIVALENT TO DIRAC         POTE-038
C                              EQUATION.                                POTE-039
C               LO(100)=.TRUE. DIRAC EQUATION.                          POTE-040
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    POTE-041
C               LO(102)=.TRUE. THERE IS AN IMAGINARY SPIN-ORBIT         POTE-042
C                              POTENTIAL.                               POTE-043
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. POTE-044
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    POTE-045
C               LO(117)=.TRUE. FOR ALL CALCULATIONS EXCEPT THE FIRST.   POTE-046
C               LO(120)=.TRUE. OUTPUT AND LAST CALCULATION BEST ONE.    POTE-047
C               LO(129)=.TRUE. REAL SPIN-ORBIT OR DIRAC EQUATION.       POTE-048
C               LO(130)=.TRUE. IMAGINARY SPIN-ORBIT OR DIRAC EQUATION.  POTE-049
C               LO(133)=.TRUE. STORE SCALAR AND COULOMB POTENTIAL       POTE-050
C                              INDEPENDENTLY.                           POTE-051
C OUTPUT:    TL:      TRANSMISSION COEFFICIENTS FOR UNCOUPLED STATES.   POTE-052
C            V(I,J):  POTENTIAL AND TRANSITION FORM FACTORS.            POTE-053
C            VCO(2,I):STRENGTH OF COULOMB POTENTIAL TAILS, SCALAR IN    POTE-054
C                     VCO(1,I), SPIN-ORBIT IN VCO(2,I).                 POTE-055
C            VDO(2,I):STRENGTH OF COULOMB TRANSITION TAILS, SCALAR IN   POTE-056
C                     VDO(1,I), SPIN-ORBIT IN VDO(2,I).                 POTE-057
C            IDT:     RETURNS THE PLACE USED.                           POTE-058
C WORKING AREA:                                                         POTE-059
C            NP,Q:    IN EQUIVALENCE BY CALL.                           POTE-060
C                                                                       POTE-061
C***********************************************************************POTE-062
C     DISPOSITION OF FORM-FACTORS IN THE AREA V(I,*):                   POTE-063
C                                                                       POTE-064
C                     FOR SCHROEDINGER EQUATIONS:                       POTE-065
C     AFTER ITY(1) (=0) REAL CENTRAL POTENTIALS IN ORDER IPI(11,*)      POTE-066
C     AFTER ITY(3) REAL SPIN-ORBIT FORM FACTORS IN THE SAME ORDER.      POTE-067
C     AFTER ITY(5) REAL TRANSITION FORM FACTORS IN ORDER IVZ(1,*).      POTE-068
C     AFTER ITY(7) REAL DERIVED SPIN-ORBIT FORM FACTORS IN ORDER        POTE-069
C           IVZ(1,*) WITH THE R**-2 FORM FACTOR AT THE SAME ADDRESS+INLSPOTE-070
C     AFTER ITY(9) COULOMB CENTRAL POTENTIAL IF NEEDED SEPARATED IN THE POTE-071
C           ORDER OF REAL POTENTIALS.                                   POTE-072
C     AFTER ITY(10) COULOMB SPIN-ORBIT POTENTIAL IF NEEDED SEPARATED IN POTE-073
C           THE ORDER OF SPIN-ORBIT POTENTIALS.                         POTE-074
C     IMAGINARY POTENTIALS AND FORM FACTOR FOLLOW WITH THE SAME ORDER   POTE-075
C           FROM ITY(2), ITY(4), ITY(6) AND ITY(8)                      POTE-076
C                                                                       POTE-077
C                     FOR DIRAC EQUATIONS:                              POTE-078
C     AFTER ITY(1) (=0) FOR EACH LEVEL, 14 FORM FACTORS V(*,I,*) WHICH  POTE-079
C           ARE CENTRAL POTENTIAL FOR I=1,2   SPIN-ORBIT POTENTIAL FOR  POTE-080
C           I=3,4  D=E+M+V-W FOR I=5,6   E-M-V-W FOR I=7,8  D**(1/2) FORPOTE-081
C           I=9,10 D**(-1) FOR I=11,12  AND  - D( TENSOR ) FOR I=13,14  POTE-082
C     AFTER ITX(6) THE INVT SETS OF COMPLEX SCALAR + VECTOR FORM FACTORSPOTE-083
C           FOLLOWED BY THE INSL SETS OF TENSOR FORM FACTORS            POTE-084
C***********************************************************************POTE-085
C                                                                       POTE-086
C FOR THE COMMONS /COUPL/ AND /DCONS/ SEE CALC.                         POTE-087
C FOR THE COMMONS /POTE1/ AND /POTE2/ SEE REDM.                         POTE-088
C                                                                       POTE-089
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     POTE-090
C  CHB:       PLANCK CONSTANT /(2*PI) IN MEV*FERMI.                     POTE-091
C  CCZ:       COULOMB ALPHA CONSTANT.                                   POTE-092
C   USED:     CHB,CCZ.                                                  POTE-093
C                                                                       POTE-094
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     POTE-095
C  IQM:       MAXIMUM L-VALUE OF DEFORMATION IN ROTATIONAL MODEL.       POTE-096
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           POTE-097
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             POTE-098
C   USED:     IQM,NBT1,NPP.                                             POTE-099
C                                                                       POTE-100
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE1/:                     POTE-101
C  ITX(16):   STARTING ADDRESS OF DIFFERENT FORM FACTORS.               POTE-102
C             FOR SCHROEDINGER EQUATION, ITX(I)+1 IS THE STARTING       POTE-103
C             ADDRESS OF THE FORM FACTOR READ IN EXTP WITH ITYP=I       POTE-104
C             (POTENTIAL FOR I=1 TO 8, TRANSITION FOR I=9 TO 16).       POTE-105
C             FOR DIRAC EQUATIONS, ITX(1)=0,                            POTE-106
C             ITX(2)+1=ADDRESS OFF FIRST TRANSITION FORM FACTOR,        POTE-107
C             ITX(7)=ADDRESS OF LAST TRANSITION FORM FACTOR,            POTE-108
C             ITX(3)=ADDRESS OF LAST TEMPORARY CENTRAL POTENTIAL,       POTE-109
C             ITX(4)=ITX(7)-24,ITX(5)=ITX(3)-11,ITX(6)=ITX(2)-4.        POTE-110
C             ALL ARE USED FOR SCHROEDINGER, THE FIRST 8 FOR DIRAC.     POTE-111
C  IMAX:      MAXIMUM ANGULAR MOMENTUM.                                 POTE-112
C  INTC:      NUMBER OF FORM FACTORS WITHOUT DEFORMED SPIN-ORBIT        POTE-113
C             INCLUDING CORRECTION TERMS.                               POTE-114
C  INLS:      NUMBER OF SPIN-ORBIT FORM FACTORS NOT TAKING INTO ACCOUNT POTE-115
C             MULTIPLICATION BY 2.                                      POTE-116
C  INVD:      IDEM FOR COULOMB SPIN-ORBIT.                              POTE-117
C  ITXM:      TOTAL NUMBER OF FORM FACTORS.                             POTE-118
C   USED:     ITX,IMAX,INTC,INLS,INVD,ITXM.                             POTE-119
C                                                                       POTE-120
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     POTE-121
C  ITY(1):    STARTING ADDRESS OF REAL CENTRAL POTENTIAL (IT IS 0).     POTE-122
C  ITY(2):    STARTING ADDRESS OF IMAGINARY CENTRAL POTENTIAL.          POTE-123
C  ITY(3):    STARTING ADDRESS OF REAL SPIN-ORBIT POTENTIAL.            POTE-124
C  ITY(4):    STARTING ADDRESS OF IMAGINARY SPIN-ORBIT POTENTIAL.       POTE-125
C  ITY(5):    STARTING ADDRESS OF REAL CENTRAL TRANSITION.              POTE-126
C  ITY(6):    STARTING ADDRESS OF IMAGINARY CENTRAL TRANSITION.         POTE-127
C  ITY(7):    STARTING ADDRESS OF REAL SPIN-ORBIT TRANSITION.           POTE-128
C  ITY(8):    STARTING ADDRESS OF IMAGINARY SPIN-ORBIT TRANSITION.      POTE-129
C  ITY(9):    STARTING ADDRESS OF COULOMB CENTRAL POTENTIAL.            POTE-130
C  ITY(10):   STARTING ADDRESS OF COULOMB SPIN-ORBIT POTENTIAL.         POTE-131
C  ITY(11):   STARTING ADDRESS OF COULOMB CENTRAL TRANSITION.           POTE-132
C  ITY(12):   STARTING ADDRESS OF COULOMB SPIN-ORBIT TRANSITION.        POTE-133
C        ITY(2)=14*NCOLL AND ITY(5)=0 ONLY ARE USED FOR DIRAC EQUATIONS.POTE-134
C  INVT:      NUMBER OF TRANSITION FORM FACTORS WITHOUT SPIN-ORBIT.     POTE-135
C  INTV:      SAME AS INVT, TAKING INTO ACCOUNT DISPERSION.             POTE-136
C  INSL:      NUMBER OF SPIN-ORBIT FORM TRANSITION FACTORS NOT TAKING   POTE-137
C             INTO ACCOUNT MULTIPLICATION BY 2.                         POTE-138
C  NPX:       NUMBER OF POTENTIALS TAKING INTO ACCOUNT DISPERSION.      POTE-139
C   USED:     ITY,INVT,INTV,INSL,NPX.                                   POTE-140
C                                                                       POTE-141
C***********************************************************************POTE-142
      IMPLICIT REAL*8 (A-H,O-Z)                                         POTE-143
      LOGICAL LO(150)                                                   POTE-144
      DIMENSION BETA(9,*),NBETA(18,*),V(ISM,*),IVQ(3,*),IVY(7,*),IVZ(4,*POTE-145
     1),NP(2,*),ILO(16),Q(*),VAL(42,*),NVAL(*),VCO(2,*),VDO(2,*),WV(22,*POTE-146
     2),WVM(22,*),IPI(11,*),IPIM(11,*),IPP(34,*),TL(*),MCM(*),IPIX(11),PPOTE-147
     3GN(10),XGN(10),W(24),WVX(22)                                      POTE-148
      CHARACTER*4 BB(2)                                                 POTE-149
      CHARACTER*8 AA(3,8)                                               POTE-150
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   POTE-151
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            POTE-152
      COMMON /POTE1/ ITX(16),IMAX,INTC,INLS,INVC,INVD,ITXM              POTE-153
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         POTE-154
      COMMON /INOUT/ MR,MW,MS                                           POTE-155
      DATA PGN( 1),PGN( 2) / 1.52753387130726D-01, 1.49172986472604D-01/POTE-156
      DATA PGN( 3),PGN( 4) / 1.42096109318382D-01, 1.31688638449177D-01/POTE-157
      DATA PGN( 5),PGN( 6) / 1.18194531961518D-01, 1.01930119817240D-01/POTE-158
      DATA PGN( 7),PGN( 8) / 8.32767415767047D-02, 6.26720483341091D-02/POTE-159
      DATA PGN( 9),PGN(10) / 4.06014298003869D-02, 1.76140071391521D-02/POTE-160
      DATA XGN( 1),XGN( 2) / 7.65265211334973D-02, 2.27785851141645D-01/POTE-161
      DATA XGN( 3),XGN( 4) / 3.73706088715420D-01, 5.10867001950827D-01/POTE-162
      DATA XGN( 5),XGN( 6) / 6.36053680726515D-01, 7.46331906460151D-01/POTE-163
      DATA XGN( 7),XGN( 8) / 8.39116971822219D-01, 9.12234428251326D-01/POTE-164
      DATA XGN( 9),XGN(10) / 9.63971927277914D-01, 9.93128599185095D-01/POTE-165
      DATA BB /'    ','LAST'/                                           POTE-166
      DATA AA/'      RE','AL VOLUM','E/SCALAR',' IMAGINA','RY VOLUM','E/POTE-167
     1SCALAR','     REA','L SURFAC','E/VECTOR','  IMAGIN','. SURFAC','E/POTE-168
     2VECTOR','  REAL S','PIN-ORBI','T/TENSOR',' IMAG. S','PIN-ORBI','T/POTE-169
     3TENSOR','        ','        ',' COULOMB','      SP','IN-ORBIT',' CPOTE-170
     4OULOMB'/                                                          POTE-171
      DATA ILO /62,62,62,62,101,102,62,103,62,12,62,12,13,14,11,19/     POTE-172
      IDY=0                                                             POTE-173
      IF (LO(120)) GO TO 4                                              POTE-174
      ITM=ITXM                                                          POTE-175
      IF (LO(100)) ITM=ITM-ITX(7)                                       POTE-176
      IF (LO(7)) GO TO 3                                                POTE-177
      INVZ=INTC                                                         POTE-178
      INY=1                                                             POTE-179
      IF (LO(109)) INY=3                                                POTE-180
      DO 2 IP=1,NPP                                                     POTE-181
      K=IABS(IPP(1,IP))                                                 POTE-182
      INVY=INVZ+INY                                                     POTE-183
      N1=(INVY+1)/2+1                                                   POTE-184
      N2=N1+MAX0(IMAX,IQM)+1                                            POTE-185
      ID1=INVY+27                                                       POTE-186
      IDX=10                                                            POTE-187
      IF (LO(3)) IDX=36                                                 POTE-188
      IF (.NOT.LO(1)) IDX=1                                             POTE-189
      IDX=MAX0(IDX*ID1+10*INVY,6*ISM)+N2                                POTE-190
      IF (IDX.GT.IDT) CALL MEMO('POTE',IDT,IDX)                         POTE-191
      IK=IP                                                             POTE-192
      IF (LO(100)) IK=ITX(4)+24*IP+1                                    POTE-193
      CALL ROTP(BETA,NBETA,IK,IVY,VAL(1,IP),ID1,ISM,WV(1,K),INVZ,INVY,INPOTE-194
     1Y,PGN,XGN,LO,V,V(1,ITX(3)+1),NP,Q(N1),Q(N2),Q(10*INVY+N2))        POTE-195
C  TO USE THE FOLDING MODEL, THE SPIN-ORBIT POTENTIALS AND THE FIRST    POTE-196
C SPIN-ORBIT NON DIAGONAL FORM FACTORS ARE NOT DERIVED ( V(R) INSTEAD OFPOTE-197
C (1/R)*(D/DR)(V(R)) )  FOR SCHROEDINGER EQUATIONS. FOR DIRAC EQUATIONS POTE-198
C THE DERIVATIVES ARE COMPUTED BUT NOT USED.                            POTE-199
      IDY=MAX0(IDX,IDY)                                                 POTE-200
      IF (LO(74)) CALL HORA                                             POTE-201
      IF (.NOT.LO(17)) GO TO 2                                          POTE-202
C  *******  FOLDING MODEL  **********                                   POTE-203
      IST=5+ISM+IDINT(2.D0*(DABS(VAL(41,IP))+2.D0*DABS(VAL(42,IP)))/WV(8POTE-204
     1,K))                                                              POTE-205
      IF (VAL(40,IP)*VAL(41,IP).EQ.0.D0) IST=ISM+5                      POTE-206
C THE WORKING SPACE IN P IS SHIFTED FROM V WITH THE ORIGINS IN TABLE IT.POTE-207
      NNF=1+ISM*ITM                                                     POTE-208
      IDZ=NNF+4*ITM                                                     POTE-209
      IDX=IDZ+4*IST                                                     POTE-210
      IF (INVZ.NE.0) IDX=IDX+2*IST*IMAX                                 POTE-211
      IDY=MAX0(IDY,IDX)                                                 POTE-212
      IF (IDX.GT.IDT) CALL MEMO('POTE',IDT,IDX)                         POTE-213
      DO 1 J=1,NNF                                                      POTE-214
    1 Q(J)=0.D0                                                         POTE-215
      CALL FOLD(V(1,IK),Q,VAL(34,IP),3,IP,ISM,IST,IVY,INVZ,Q(IDZ),PGN,XGPOTE-216
     1N,WV,NP(1,NNF),LO)                                                POTE-217
      IF (LO(74)) CALL HORA                                             POTE-218
    2 INVZ=0                                                            POTE-219
      GO TO 4                                                           POTE-220
    3 NNF=2*ITM                                                         POTE-221
      IF (NNF.GT.IDT) CALL MEMO('POTE',IDT,NNF)                         POTE-222
      IDZ=IDT-NNF                                                       POTE-223
      IK=1                                                              POTE-224
      IF (LO(100)) IK=ITX(7)+1                                          POTE-225
      CALL STDP(V(1,IK),IVY,ISM,VAL,NVAL,IDZ,IDX,Q(NNF+1),WV,PGN,XGN,NPPPOTE-226
     1,NP,Q(NNF+1),LO)                                                  POTE-227
      IDY=MAX0(IDY,IDX+2*NNF)                                           POTE-228
    4 IF (.NOT.LO(62)) GO TO 14                                         POTE-229
      NPT=8*(NPP+INTC)                                                  POTE-230
      IF (.NOT.LO(101)) NPT=NPT-NPP                                     POTE-231
      IF (.NOT.LO(102)) NPT=NPT-NPP                                     POTE-232
      IF (.NOT.LO(103)) NPT=NPT-NPP                                     POTE-233
      IF (.NOT.LO(11)) NPT=NPT-INTC                                     POTE-234
      IF (.NOT.LO(12)) NPT=NPT-2*INTC                                   POTE-235
      IF (.NOT.LO(13)) NPT=NPT-INTC                                     POTE-236
      IF (.NOT.LO(14)) NPT=NPT-INTC                                     POTE-237
      IF (.NOT.LO(19)) NPT=NPT-INTC                                     POTE-238
      WRITE (62,1000) WV(1,1),WV(13,1),WV(2,1),IPI(4,1),NPT             POTE-239
      IST=2*(ISM/2)                                                     POTE-240
      IDX=IST                                                           POTE-241
      IDY=MAX0(IDY,IDX)                                                 POTE-242
      IF (IDX.GT.IDT) CALL MEMO('POTE',IDT,IDX)                         POTE-243
C PUNCH THE FORM FACTORS.                                               POTE-244
      DO 5 I=1,IST                                                      POTE-245
    5 Q(I)=I*WV(8,1)                                                    POTE-246
      IR=0                                                              POTE-247
      DO 8 IP=1,NPP                                                     POTE-248
      DO 7 IJ=1,8                                                       POTE-249
      IS=1                                                              POTE-250
      IL=ILO(IJ)                                                        POTE-251
      IF (.NOT.LO(IL)) GO TO 7                                          POTE-252
      JI=IP+ITX(IJ)                                                     POTE-253
      IF (LO(100)) JI=ITX(7)+IJ+24*(IP-1)                               POTE-254
      IR=IR+1                                                           POTE-255
      WRITE (MW,1001) (AA(J,IJ),J=1,3),IP,IR                            POTE-256
      WRITE (62,1001) (AA(J,IJ),J=1,3),IP,IR                            POTE-257
      DO 6 I=1,IST,2                                                    POTE-258
      IF (I.EQ.IST-1) IS=2                                              POTE-259
      WRITE (MW,1002) Q(I),V(I,JI),Q(I+1),V(I+1,JI),BB(IS),IR           POTE-260
    6 WRITE (62,1003) Q(I),V(I,JI),Q(I+1),V(I+1,JI),BB(IS),IR           POTE-261
    7 CONTINUE                                                          POTE-262
    8 CONTINUE                                                          POTE-263
      IF (INTC.EQ.0) GO TO 14                                           POTE-264
      DO 13 IQ=1,INTC                                                   POTE-265
      DO 12 IJ=9,16                                                     POTE-266
      IS=1                                                              POTE-267
      IL=ILO(IJ)                                                        POTE-268
      IF (.NOT.LO(IL)) GO TO 12                                         POTE-269
      IP=IQ                                                             POTE-270
      IF (IJ.EQ.13.OR.IJ.EQ.14) IP=IVY(3,IQ)+INLS                       POTE-271
      IF (IJ.GE.15) IP=IVY(IJ-11,IQ)                                    POTE-272
      IF (IP.LE.0) GO TO 12                                             POTE-273
      JI=IP+ITX(IJ)                                                     POTE-274
      IF (LO(100)) JI=ITX(7)+24*NPP+11*IQ+IJ-19                         POTE-275
      IR=IR+1                                                           POTE-276
      WRITE (MW,1004) (AA(J,IJ-8),J=1,3),IQ,IR                          POTE-277
      WRITE (62,1004) (AA(J,IJ-8),J=1,3),IQ,IR                          POTE-278
      IF (.NOT.LO(100).AND.(IJ.GE.13).AND.(IJ.NE.15)) GO TO 10          POTE-279
      DO 9 I=1,IST,2                                                    POTE-280
      IF (I.EQ.IST-1) IS=2                                              POTE-281
      WRITE (MW,1002) Q(I),V(I,JI),Q(I+1),V(I+1,JI),BB(IS),IR           POTE-282
    9 WRITE (62,1003) Q(I),V(I,JI),Q(I+1),V(I+1,JI),BB(IS),IR           POTE-283
      GO TO 12                                                          POTE-284
   10 IF (IJ.EQ.16) JI=JI+INVD                                          POTE-285
      DO 11 I=1,IST,2                                                   POTE-286
      A1=-V(I,JI)*Q(I)**2                                               POTE-287
      A2=-V(I+1,JI)*Q(I+1)**2                                           POTE-288
      IF (I.EQ.IST-1) IS=2                                              POTE-289
      WRITE (MW,1002) Q(I),A1,Q(I+1),A2,BB(IS),IR                       POTE-290
   11 WRITE (62,1003) Q(I),A1,Q(I+1),A2,BB(IS),IR                       POTE-291
   12 CONTINUE                                                          POTE-292
   13 CONTINUE                                                          POTE-293
   14 IF (LO(120)) GO TO 68                                             POTE-294
      IF (INTC.EQ.INVT) GO TO 26                                        POTE-295
C ADDITION OF CORRECTION TERMS OF FORM FACTORS.                         POTE-296
      DO 25 K=1,INVT                                                    POTE-297
      IF (IVY(6,K).LE.0) GO TO 25                                       POTE-298
      K1=IVY(6,K)                                                       POTE-299
      L=IVY(7,K)+2                                                      POTE-300
      DO 24 N=1,8                                                       POTE-301
      IL=ILO(N+8)                                                       POTE-302
      IF ((IL.NE.62).AND.(.NOT.LO(IL))) GO TO 24                        POTE-303
      L1=L                                                              POTE-304
      M=0                                                               POTE-305
      IF (LO(100)) GO TO 17                                             POTE-306
      IF (N.GT.6) GO TO 16                                              POTE-307
      IF (N.GT.4) GO TO 15                                              POTE-308
      K2=ITX(N+8)+K                                                     POTE-309
      K3=ITX(N+8)+K1                                                    POTE-310
      GO TO 19                                                          POTE-311
   15 IF (IVY(3,K).EQ.0) GO TO 24                                       POTE-312
      K2=ITX(N+8)+IVY(3,K)+INLS                                         POTE-313
      K3=ITX(N+8)+IVY(3,K1)+INLS                                        POTE-314
      L1=L1+2                                                           POTE-315
      M=-INLS                                                           POTE-316
      GO TO 19                                                          POTE-317
   16 IF (IVY(N-3,K).EQ.0) GO TO 24                                     POTE-318
      K2=ITX(N+8)+IVY(N-3,K)                                            POTE-319
      K3=ITX(N+8)+IVY(N-3,K1)                                           POTE-320
      IF (N.EQ.8) M=INVD                                                POTE-321
      GO TO 18                                                          POTE-322
   17 IF ((N.GT.4).AND.(N.NE.7)) M=MIN0(11-N,4)                         POTE-323
      K2=ITX(5)+11*K+N                                                  POTE-324
      K3=K2+11*(K1-K)                                                   POTE-325
      IF (N.LE.6) GO TO 19                                              POTE-326
   18 CI=V(ISM,K3)                                                      POTE-327
      CR=V(ISM,K2)                                                      POTE-328
      GO TO 21                                                          POTE-329
   19 DD=0.D0                                                           POTE-330
      CI=0.D0                                                           POTE-331
      CR=0.D0                                                           POTE-332
      DO 20 IS=1,ISM                                                    POTE-333
      DD=DD+WV(8,1)                                                     POTE-334
      CI=CI+V(IS,K3)*DD**L1                                             POTE-335
   20 CR=CR+V(IS,K2)*DD**L1                                             POTE-336
   21 IF ((CI.EQ.0.D0).OR.(CR.EQ.0.D0)) GO TO 24                        POTE-337
      CR=CR/CI                                                          POTE-338
      IF (.NOT.LO(117)) WRITE (MW,1005) K,N,CR                          POTE-339
   22 DO 23 IS=1,ISM                                                    POTE-340
   23 V(IS,K2)=V(IS,K2)-CR*V(IS,K3)                                     POTE-341
      IF (M.EQ.0) GO TO 24                                              POTE-342
      K2=K2+M                                                           POTE-343
      K3=K3+M                                                           POTE-344
      M=0                                                               POTE-345
      GO TO 22                                                          POTE-346
   24 CONTINUE                                                          POTE-347
   25 CONTINUE                                                          POTE-348
   26 RM=ISM*WV(8,1)                                                    POTE-349
      IF (LO(74)) CALL HORA                                             POTE-350
C STORAGE OF OPTICAL POTENTIALS.                                        POTE-351
      DO 44 KJ=1,NCOLT                                                  POTE-352
      JJ=MOD(KJ+NCOLL-1,NCOLT)+1                                        POTE-353
      IF (JJ.GT.NCOLD) GO TO 29                                         POTE-354
      DO 27 I=1,11                                                      POTE-355
   27 IPIX(I)=IPI(I,JJ)                                                 POTE-356
      DO 28 I=1,22                                                      POTE-357
   28 WVX(I)=WV(I,JJ)                                                   POTE-358
      GO TO 32                                                          POTE-359
   29 DO 30 I=1,11                                                      POTE-360
   30 IPIX(I)=IPIM(I,JJ-NCOLD)                                          POTE-361
      DO 31 I=1,22                                                      POTE-362
   31 WVX(I)=WVM(I,JJ-NCOLD)                                            POTE-363
   32 XP=CHB/(2.D0*WVX(6))                                              POTE-364
      XQ=XP**2                                                          POTE-365
      IF (LO(100)) GO TO 38                                             POTE-366
C POTENTIALS FOR SCHROEDINGER EQUATION.                                 POTE-367
      IF (JJ.GT.NCOLL) GO TO 33                                         POTE-368
      I1=IPIX(11)                                                       POTE-369
      I2=I1+ITY(2)                                                      POTE-370
      I3=I1+ITY(3)                                                      POTE-371
      I4=I1+ITY(4)                                                      POTE-372
      I5=I1+ITY(9)                                                      POTE-373
      I6=I1+ITY(10)                                                     POTE-374
      IF (LO(133)) GO TO 34                                             POTE-375
      GO TO 36                                                          POTE-376
   33 I1=1                                                              POTE-377
      I2=2                                                              POTE-378
      I3=3                                                              POTE-379
      I4=4                                                              POTE-380
      I5=5                                                              POTE-381
      I6=6                                                              POTE-382
      IF (LO(133)) GO TO 34                                             POTE-383
      I5=1                                                              POTE-384
      I6=3                                                              POTE-385
      GO TO 36                                                          POTE-386
   34 DO 35 IS=1,ISM                                                    POTE-387
      IF (LO(103)) V(IS,I6)=0.D0                                        POTE-388
   35 V(IS,I5)=0.D0                                                     POTE-389
   36 J=IPIX(5)                                                         POTE-390
      DO 37 IS=1,ISM                                                    POTE-391
      V(IS,I1)=V(IS,J+ITX(1))*(1.D0+WVX(16))+V(IS,J+ITX(3))*(1.D0+WVX(19POTE-392
     1))+WVX(15)*V(IS,J+ITX(2))+WVX(18)*V(IS,J+ITX(4))                  POTE-393
      V(IS,I2)=V(IS,J+ITX(2))*(1.D0+WVX(14))+V(IS,J+ITX(4))*(1.D0+WVX(17POTE-394
     1))                                                                POTE-395
      IF (LO(129)) V(IS,I3)=V(IS,J+ITX(5))*(1.D0+WVX(22))+WVX(21)*V(IS,JPOTE-396
     1+ITX(6))                                                          POTE-397
      IF (LO(130)) V(IS,I4)=V(IS,J+ITX(6))*(1.D0+WVX(20))               POTE-398
      IF (LO(103)) V(IS,I6)=V(IS,I6)+V(IS,J+ITX(8))*XQ                  POTE-399
   37 V(IS,I5)=V(IS,I5)-V(IS,J+ITX(7))                                  POTE-400
      IF (LO(103)) VCO(2,I1)=V(ISM,J+ITX(8))*RM**3/WVX(6)               POTE-401
      IF (.NOT.LO(99)) GO TO 43                                         POTE-402
      VCO(1,I1)=RM*V(ISM,J+ITX(7))*CHB/(2.D0*WVX(7)*WVX(6))             POTE-403
      VCO(2,I1)=VCO(2,I1)+VCO(1,I1)*CHB/(WVX(6)+WVX(7))                 POTE-404
      GO TO 43                                                          POTE-405
C POTENTIALS FOR DIRAC EQUATION:                                        POTE-406
C AT THIS POINT:   AFTER V(1,ITX(7)),                                   POTE-407
C V(*,N,1) SCALAR POTENTIAL V FOR N=1,2 VECTOR POTENTIAL W FOR N=3,4    POTE-408
C          TENSOR POTENTIAL T FOR N=5,6 COULOMB POTENTIALS FOR N=7,8    POTE-409
C          THEIR FIRST DERIVATIVES FOR N=9,16                           POTE-410
C          THEIR SECOND DERIVATIVES FOR N=17,24                         POTE-411
C THE FIRST DERIVATIVES OF NON-COULOMB POTENTIALS HAVE A REVERSED SIGN. POTE-412
   38 M=ITX(4)+24*IPIX(5)                                               POTE-413
      J=JJ                                                              POTE-414
      IF (J.GT.NCOLL) J=1                                               POTE-415
      N=14*J-14                                                         POTE-416
      RR=0.D0                                                           POTE-417
      DO 42 IS=1,ISM                                                    POTE-418
      RR=RR+WVX(8)                                                      POTE-419
      DO 39 K=1,24                                                      POTE-420
   39 W(K)=V(IS,K+M)                                                    POTE-421
      IF (.NOT.LO(10)) GO TO 41                                         POTE-422
      DO 40 K=1,24,8                                                    POTE-423
      W(K)=(1.D0+WVX(16))*W(K)+WVX(15)*W(K+1)                           POTE-424
      W(K+1)=W(K+1)+WVX(14)*W(K+1)                                      POTE-425
      W(K+2)=(1.D0+WVX(19))*W(K+2)+WVX(18)*W(K+3)                       POTE-426
      W(K+3)=W(K+3)+WVX(17)*W(K+3)                                      POTE-427
      W(K+4)=(1.D0+WVX(22))*W(K+4)+WVX(21)*W(K+5)                       POTE-428
   40 W(K+5)=(1.D0+WVX(20))*W(K+5)                                      POTE-429
   41 W(3)=W(3)+W(7)                                                    POTE-430
      W(11)=W(11)+W(15)                                                 POTE-431
      W(19)=W(19)+W(23)                                                 POTE-432
      W(13)=(W(13)+W(16))/WVX(6)                                        POTE-433
      W(21)=(W(21)+W(24))/WVX(6)                                        POTE-434
      W(14)=W(14)/WVX(6)                                                POTE-435
      W(22)=W(22)/WVX(6)                                                POTE-436
      W(15)=WVX(6)+WVX(7)+W(1)-W(3)                                     POTE-437
      W(16)=W(2)-W(4)                                                   POTE-438
      V(IS,N+7)=(WVX(7)-WVX(6)-W(1)-W(3))/CHB                           POTE-439
      V(IS,N+8)=-(W(2)+W(4))/CHB                                        POTE-440
      DD=W(15)**2+W(16)**2                                              POTE-441
      W(5)=W(15)/DD                                                     POTE-442
      W(6)=-W(16)/DD                                                    POTE-443
      DD=DSQRT(DSQRT(DD)/(WVX(6)+WVX(7)))                               POTE-444
      AR=.5D0*DATAN2(W(16),W(15))                                       POTE-445
      V(IS,N+9)=DD*DCOS(AR)                                             POTE-446
      V(IS,N+10)=DD*DSIN(AR)                                            POTE-447
      AR=W(11)-W(9)                                                     POTE-448
      AI=W(12)-W(10)                                                    POTE-449
      BR=W(17)-W(19)                                                    POTE-450
      BI=W(18)-W(20)                                                    POTE-451
      CR=AR*W(5)-AI*W(6)+W(13)                                          POTE-452
      CI=AR*W(6)+AI*W(5)+W(14)                                          POTE-453
      ER=BR*W(5)-BI*W(6)+W(13)*(CR+CR-W(13))-W(14)*(CI+CI-W(14))-W(21)+2POTE-454
     1.D0*CR/RR                                                         POTE-455
      EI=BR*W(6)+BI*W(5)+W(13)*(CI+CI-W(14))+W(14)*(CR+CR-W(13))-W(22)+2POTE-456
     1.D0*CI/RR                                                         POTE-457
      V(IS,N+1)=-W(1)-W(3)*WVX(7)/WVX(6)-(W(1)*W(1)-W(2)*W(2)-W(3)*W(3)+POTE-458
     1W(4)*W(4))/(2.D0*WVX(6))-(.75D0*(CR**2-CI**2)-.5D0*ER)*XP*CHB     POTE-459
      V(IS,N+2)=-W(2)-W(4)*WVX(7)/WVX(6)-(W(1)*W(2)-W(3)*W(4))/WVX(6)-(1POTE-460
     1.5D0*CR*CI-.5D0*EI)*XP*CHB                                        POTE-461
      V(IS,N+3)=.5D0*CR*XP*CHB/RR                                       POTE-462
      V(IS,N+4)=.5D0*CI*XP*CHB/RR                                       POTE-463
      V(IS,N+5)=W(15)/CHB                                               POTE-464
      V(IS,N+6)=W(16)/CHB                                               POTE-465
      V(IS,N+11)=W(5)*CHB                                               POTE-466
      V(IS,N+12)=W(6)*CHB                                               POTE-467
      V(IS,N+13)=W(13)/CHB                                              POTE-468
   42 V(IS,N+14)=W(14)/CHB                                              POTE-469
      VCO(1,J)=W(7)*RR/CHB                                              POTE-470
      VCO(2,J)=RR*(W(7)/(WVX(6)+WVX(7))+W(8)/WVX(6))                    POTE-471
   43 IF (JJ.LE.NCOLL) GO TO 44                                         POTE-472
      NX1=2*ISM+5                                                       POTE-473
      NX2=NX1+10*(IPIX(10)+2)                                           POTE-474
      HH=WV(8,1)                                                        POTE-475
      IF (NX2.GT.IDT) CALL MEMO('POTE',IDT,NX2)                         POTE-476
      IF ((.NOT.LO(93)).OR.(DABS(WV(2,1)-WVX(2)).GT.0.5D0)) HH=HH*WV(2,1POTE-477
     1)/WVX(2)                                                          POTE-478
      CALL TLNC(HH,IPIX,WVX,TL(IPIX(8)+1),ISM,Q,Q(NX1),IPIX(10)+2,NP(1,NPOTE-479
     1X2),Q(NX2),IDT-NX2,V,VCO,LO)                                      POTE-480
   44 CONTINUE                                                          POTE-481
      IF (INTV.EQ.0) GO TO 68                                           POTE-482
C STORAGE OF TRANSITION FORM FACTORS.                                   POTE-483
      DO 67 J=1,INTV                                                    POTE-484
      IJ=IVZ(1,J)                                                       POTE-485
      IF (.NOT.LO(100)) GO TO 45                                        POTE-486
      IK=ITX(6)+4*J                                                     POTE-487
      KI=ITX(5)+11*IJ                                                   POTE-488
   45 L=IVY(4,IJ)                                                       POTE-489
      IF (L.EQ.0) GO TO 50                                              POTE-490
      K=IVY(2,IJ)                                                       POTE-491
      IF (IVQ(2,K).GE.0) GO TO 50                                       POTE-492
C MAGNETIC COULOMB TRANSITION.                                          POTE-493
      DD=2.D0*(WV(8,1)/WV(10,1))**2/CHB                                 POTE-494
      IF (LO(100)) GO TO 47                                             POTE-495
      DO 46 IS=1,ISM                                                    POTE-496
      IF (LO(12)) V(IS,J+ITY(6))=0.D0                                   POTE-497
   46 V(IS,J+ITY(11))=-V(IS,L+ITX(15))*DD                               POTE-498
      IF (IVY(7,IJ).LE.MCM(1)) VDO(1,J)=V(ISM,L+ITX(15))*DD*RM**(IVY(7,IPOTE-499
     1J)+1)                                                             POTE-500
      GO TO 67                                                          POTE-501
   47 DO 49 IS=1,ISM                                                    POTE-502
      DO 48 M=1,4                                                       POTE-503
   48 V(IS,IK+M)=0.D0                                                   POTE-504
   49 V(IS,IK+3)=V(IS,KI+7)*DD                                          POTE-505
      IF (IVY(7,IJ).LE.MCM(1)) VDO(1,J)=V(ISM,KI+7)*DD*RM**(IVY(7,IJ)+1)POTE-506
      GO TO 67                                                          POTE-507
C CENTRAL TRANSITION FORM-FACTOR.                                       POTE-508
   50 I1=IVZ(2,J)/(NCOLL+1)                                             POTE-509
      I2=MOD(IVZ(2,J),NCOLL+1)                                          POTE-510
      DO 51 K=1,9                                                       POTE-511
      WVX(K)=WV(K+13,1)                                                 POTE-512
      IF (I2.NE.0) WVX(K)=.5D0*(WV(K+13,I1)+WV(K+13,I2))                POTE-513
      IF (.NOT.LO(10)) WVX(K)=0.D0                                      POTE-514
   51 CONTINUE                                                          POTE-515
      IF (LO(100)) GO TO 54                                             POTE-516
      DO 52 IS=1,ISM                                                    POTE-517
      IF (LO(12)) V(IS,J+ITY(6))=V(IS,IJ+ITX(10))+V(IS,IJ+ITX(12))+WVX(1POTE-518
     1)*V(IS,IJ+ITX(10))+WVX(4)*V(IS,IJ+ITX(12))                        POTE-519
   52 V(IS,J+ITY(5))=V(IS,IJ+ITX(9))*(1.D0+WVX(3))+V(IS,IJ+ITX(11))*(1.DPOTE-520
     10+WVX(6))+WVX(2)*V(IS,IJ+ITX(10))+WVX(5)*V(IS,IJ+ITX(12))         POTE-521
      IF (L.EQ.0) GO TO 59                                              POTE-522
C COULOMB TRANSITION FORM FACTOR FOR SCHROEDINGER EQUATION.             POTE-523
      DO 53 IS=1,ISM                                                    POTE-524
   53 V(IS,J+ITY(11))=V(IS,J+ITY(11))-V(IS,L+ITX(15))                   POTE-525
      IF (IVY(7,IJ).LE.MCM(1)) VDO(1,J)=V(ISM,L+ITX(15))*RM**(IVY(7,IJ)+POTE-526
     11)                                                                POTE-527
      GO TO 59                                                          POTE-528
   54 DO 55 IS=1,ISM                                                    POTE-529
      V(IS,IK+1)=V(IS,KI+1)+WVX(2)*V(IS,KI+2)                           POTE-530
      V(IS,IK+2)=V(IS,KI+2)+WVX(1)*V(IS,KI+2)                           POTE-531
      V(IS,IK+3)=V(IS,KI+3)+WVX(4)*V(IS,KI+4)                           POTE-532
   55 V(IS,IK+4)=V(IS,KI+4)+WVX(3)*V(IS,KI+4)                           POTE-533
      IF (L.EQ.0) GO TO 57                                              POTE-534
C COULOMB TRANSITION FORM FACTOR FOR DIRAC EQUATION.                    POTE-535
      DO 56 IS=1,ISM                                                    POTE-536
   56 V(IS,IK+3)=V(IS,IK+3)+V(IS,KI+7)                                  POTE-537
      IF (IVY(7,IJ).LE.MCM(1)) VDO(1,J)=V(ISM,KI+7)*RR**(IVY(7,IJ)+1)   POTE-538
   57 DO 58 IS=1,ISM                                                    POTE-539
      CR=V(IS,IK+1)                                                     POTE-540
      CI=V(IS,IK+2)                                                     POTE-541
      V(IS,IK+1)=XP*(V(IS,IK+3)+CR)                                     POTE-542
      V(IS,IK+2)=XP*(V(IS,IK+4)+CI)                                     POTE-543
      V(IS,IK+3)=XP*(V(IS,IK+3)-CR)                                     POTE-544
   58 V(IS,IK+4)=XP*(V(IS,IK+4)-CI)                                     POTE-545
   59 IF (J.GT.INVT) GO TO 67                                           POTE-546
C SPIN-ORBIT TRANSITION FORM FACTOR FOR SCHROEDINGER EQUATION.          POTE-547
      L=IVY(3,IJ)                                                       POTE-548
      IF (L.EQ.0) GO TO 67                                              POTE-549
      IF (LO(100)) GO TO 64                                             POTE-550
      DO 60 IS=1,ISM                                                    POTE-551
      V(IS,L+ITY(7))=V(IS,L+ITX(13))*(1.D0+WVX(9))+V(IS,L+ITX(14))*WVX(8POTE-552
     1)                                                                 POTE-553
   60 V(IS,L+ITY(7)+INSL)=V(IS,L+INLS+ITX(13))*(1.D0+WVX(9))+V(IS,L+ITX(POTE-554
     114))*WVX(8)                                                       POTE-555
      IF (.NOT.LO(14)) GO TO 62                                         POTE-556
      DO 61 IS=1,ISM                                                    POTE-557
      V(IS,L+ITY(8))=V(IS,L+ITX(14))*(1.D0+WVX(7))                      POTE-558
   61 V(IS,L+ITY(8)+INSL)=V(IS,L+INLS+ITX(14))*(1.D0+WVX(7))            POTE-559
   62 K=IVY(5,IJ)                                                       POTE-560
      IF (K.EQ.0) GO TO 67                                              POTE-561
      DO 63 IS=1,ISM                                                    POTE-562
      V(IS,L+ITY(12))=V(IS,L+ITY(12))+V(IS,K+ITX(16))*XQ                POTE-563
   63 V(IS,L+ITY(12)+INSL)=V(IS,L+ITY(12)+INSL)+V(IS,K+INVD+ITX(16))*XQ POTE-564
      IF (IVY(7,IJ).LE.MCM(2)) VDO(2,L)=-V(ISM,K+INVD+ITX(16))*RM**(IVY(POTE-565
     17,IJ)+3)*XQ                                                       POTE-566
      GO TO 67                                                          POTE-567
C SPIN-ORBIT TRANSITION FORM FACTOR FOR DIRAC EQUATION.                 POTE-568
   64 IL=ITX(6)+4*(L+INTV)                                              POTE-569
      RR=0.D0                                                           POTE-570
      DO 65 IS=1,ISM                                                    POTE-571
      RR=RR+WV(8,1)                                                     POTE-572
      V(IS,IL+1)=-XQ*V(IS,KI+9)*(1.D0+WVX(6))                           POTE-573
      V(IS,IL+2)=-XQ*V(IS,KI+10)*(1.D0+WVX(5))                          POTE-574
      V(IS,IL+3)=XQ*V(IS,KI+5)/RR*(1.D0+WVX(6))                         POTE-575
   65 V(IS,IL+4)=XQ*V(IS,KI+6)/RR*(1.D0+WVX(5))                         POTE-576
      IF (IVY(5,IJ).EQ.0) GO TO 67                                      POTE-577
      RR=0.D0                                                           POTE-578
      DO 66 IS=1,ISM                                                    POTE-579
      RR=RR+WV(8,1)                                                     POTE-580
      V(IS,IL+1)=V(IS,IL+1)-XQ*V(IS,KI+11)                              POTE-581
   66 V(IS,IL+3)=V(IS,IL+3)+XQ*V(IS,KI+8)/RR                            POTE-582
      IF (IVY(7,IJ).LE.MCM(2)) VDO(2,L)=XP*V(ISM,KI+8)*RR**(IVY(7,IJ)+1 POTE-583
     1)                                                                 POTE-584
   67 CONTINUE                                                          POTE-585
C OUTPUT OF POTENTIALS.                                                 POTE-586
   68 IF (.NOT.LO(51)) GO TO 77                                         POTE-587
      IF (LO(100)) GO TO 74                                             POTE-588
      DO 69 J=1,NPX                                                     POTE-589
      WRITE (MW,1006) J                                                 POTE-590
      WRITE (MW,1007) (I,V(I,J+ITY(1)),V(I,J+ITY(2)),I=1,ISM)           POTE-591
      IF (LO(133)) WRITE (MW,1008) (I,V(I,J+ITY(9)),I=1,ISM)            POTE-592
      IF (LO(129)) WRITE (MW,1009) (I,V(I,J+ITY(3)),I=1,ISM)            POTE-593
      IF (LO(130)) WRITE (MW,1010) (I,V(I,J+ITY(4)),I=1,ISM)            POTE-594
      IF (LO(133).AND.LO(103)) WRITE (MW,1011) (I,V(I,J+ITY(10)),I=1,ISMPOTE-595
     1)                                                                 POTE-596
   69 CONTINUE                                                          POTE-597
      IF (ITY(2).EQ.ITY(5)) GO TO 72                                    POTE-598
      NVX=ITY(2)-ITY(5)                                                 POTE-599
      WRITE (MW,1012)                                                   POTE-600
      NVB=MIN0(NVX,6)                                                   POTE-601
      DO 70 I=1,ISM                                                     POTE-602
      WRITE (MW,1013) I,(J,V(I,J+ITY(5)),J=1,NVB)                       POTE-603
      IF (NVB.NE.NVX) WRITE (MW,1014) (J,V(I,J+ITY(5)),J=7,NVX)         POTE-604
   70 CONTINUE                                                          POTE-605
      ITMX=ITX(1)                                                       POTE-606
      IF (LO(133)) ITMX=ITY(9)                                          POTE-607
      IF (ITMX.EQ.ITY(6)) GO TO 72                                      POTE-608
      MVX=ITMX-ITY(6)                                                   POTE-609
      WRITE (MW,1015)                                                   POTE-610
      NVB=MIN0(MVX,6)                                                   POTE-611
      DO 71 I=1,ISM                                                     POTE-612
      WRITE (MW,1013) I,(J,V(I,J+ITY(6)),J=1,NVB)                       POTE-613
      IF (NVB.NE.MVX) WRITE (MW,1014) (J,V(I,J+ITY(6)),J=7,MVX)         POTE-614
   71 CONTINUE                                                          POTE-615
   72 IF (.NOT.LO(133)) GO TO 77                                        POTE-616
      IF (ITX(1).EQ.ITY(11)) GO TO 77                                   POTE-617
      MVX=ITX(1)-ITY(11)                                                POTE-618
      WRITE (MW,1016)                                                   POTE-619
      NVB=MIN0(MVX,6)                                                   POTE-620
      DO 73 I=1,ISM                                                     POTE-621
      WRITE (MW,1013) I,(J,V(I,J+ITY(11)),J=1,NVB)                      POTE-622
      IF (NVB.NE.MVX) WRITE (MW,1014) (J,V(I,J+ITY(11)),J=7,MVX)        POTE-623
   73 CONTINUE                                                          POTE-624
      GO TO 77                                                          POTE-625
   74 N=0                                                               POTE-626
      DO 75 L=1,NCOLL                                                   POTE-627
      WRITE (MW,1017) L                                                 POTE-628
      WRITE (MW,1018) (I,(V(I,N+J),J=1,6),I=1,ISM)                      POTE-629
      WRITE (MW,1019) L                                                 POTE-630
      WRITE (MW,1018) (I,(V(I,N+J),J=7,12),I=1,ISM)                     POTE-631
      IF (LO(101).OR.LO(103)) WRITE (MW,1020) L,(I,(V(I,N+J),J=13,14),I=POTE-632
     11,ISM)                                                            POTE-633
   75 N=N+14                                                            POTE-634
      L=INTV+INSL                                                       POTE-635
      IF (L.EQ.0) GO TO 77                                              POTE-636
      N=ITX(2)                                                          POTE-637
      DO 76 K=1,L                                                       POTE-638
      IF (K.LE.INTV) WRITE (MW,1021) K                                  POTE-639
      IF (K.GT.INTV) WRITE (MW,1022) K                                  POTE-640
      WRITE (MW,1023) (I,(V(I,N+J),J=1,4),I=1,ISM)                      POTE-641
   76 N=N+4                                                             POTE-642
   77 IDT=IDY                                                           POTE-643
      RETURN                                                            POTE-644
 1000 FORMAT ('<POTENTI.>',F10.2,1P,D20.8,0P,F10.2,2I5)                 POTE-645
 1001 FORMAT (2X,3A8,' POTENTIAL ***',I2,' ***',5X,I5)                  POTE-646
 1002 FORMAT (2X,F10.5,1P,D20.6,0P,F10.5,1P,D20.6,A4,I6)                POTE-647
 1003 FORMAT (F10.5,1P,D20.6,0P,F10.5,1P,D20.6,A4,I6)                   POTE-648
 1004 FORMAT (2X,3A8,' TRANSITION POTENTIAL ***',I2,' ***',5X,I5)       POTE-649
 1005 FORMAT (' FORM FACTOR',I4,'  POTENTIAL',I3,'  RATIO OF CORRECTING POTE-650
     1DEFORMATION',1P,D15.6)                                            POTE-651
 1006 FORMAT (//' POTENTIAL ****',I2,' ****')                           POTE-652
 1007 FORMAT (//' CENTRAL POTENTIAL:'//(3(5X,I5,1P,2D14.5,' I')))       POTE-653
 1008 FORMAT (//' COULOMB POTENTIAL:'//(6(2X,I4,1P,D14.5)))             POTE-654
 1009 FORMAT (//' REAL SPIN-ORBIT POTENTIAL:'//(6(2X,I4,1P,D14.5)))     POTE-655
 1010 FORMAT (//' IMAGINARY SPIN-ORBIT POTENTIAL:'//(6(2X,I4,1P,D14.5)))POTE-656
 1011 FORMAT (//' COULOMB SPIN-ORBIT POTENTIAL:'//(6(2X,I4,1P,D14.5)))  POTE-657
 1012 FORMAT (//' REAL MULTIPOLES:'/)                                   POTE-658
 1013 FORMAT (4X,I4,6(I4,1P,D14.5))                                     POTE-659
 1014 FORMAT ((8X,6(I4,1P,D14.5)))                                      POTE-660
 1015 FORMAT (//' IMAGINARY MULTIPOLES:'/)                              POTE-661
 1016 FORMAT (//' COULOMB MULTIPOLES:'/)                                POTE-662
 1017 FORMAT (//' POTENTIALS OF SCHROEDINGER''S EQUATION FOR CHANNEL',I3POTE-663
     1/15X,'CENTRAL',27X,'SPIN-ORBIT',28X,'D(R)')                       POTE-664
 1018 FORMAT (2X,I3,1P,2D14.7,' I',5X,2D14.7,' I',5X,2D14.7,' I')       POTE-665
 1019 FORMAT (/17X,'E(R)',28X,'SQRT(D(R))',25X,'D(R)**(-1)',3X,'FOR CHANPOTE-666
     1NEL',I3)                                                          POTE-667
 1020 FORMAT (/45X,'TENSOR POTENTIAL',36X,'FOR CHANNEL',I3/(3(2X,I3,1P,2POTE-668
     1D14.7,' I')))                                                     POTE-669
 1021 FORMAT (//' SCALAR AND VECTOR MULTIPOLES',I6/)                    POTE-670
 1022 FORMAT (//' TENSOR MULTIPOLES',I6/)                               POTE-671
 1023 FORMAT (5X,I5,1P,2D26.7,' I',10X,2D16.7,' I')                     POTE-672
      END                                                               POTE-673
C 07/03/07                                                      ECIS06  ROTP-000
      SUBROUTINE ROTP(BETA,NBETA,IP,IVY,VAL,ID1,ISM,WV,INVZ,IQ1,INY,PGN,ROTP-001
     1XGN,LO,V,VA,IV,PP,B,P)                                            ROTP-002
C INPUT:     BETA:    VIBRATIONAL DEFORMATIONS. FROM BETA(1,NBT1+1),    ROTP-003
C                     STATIC DEFORMATIONS (ROTATIONAL MODEL).           ROTP-004
C            NBETA:   QUANTUM NUMBERS OF DEFORMATIONS (IN EQUIVALENCE   ROTP-005
C                     BY CALL WITH BETA).                               ROTP-006
C            IP:      POTENTIAL NUMBER (SCHROEDINGER EQUATION), ADDRESS ROTP-007
C                     TO TEMPORARILY STORAGE OF DIRAC POTENTIALS IN V.  ROTP-008
C            IVY:     DESCRIPTION OF FORM FACTORS                       ROTP-009
C                     (SEE THIRD PART OF IQ IN REDM).                   ROTP-010
C            VAL:     OPTICAL PARAMETERS..                              ROTP-011
C            ID1:     FIRST DIMENSION OF THE WORKING SPACE P.           ROTP-012
C            ISM:     NUMBER OF STEPS FOR INTEGRATION.                  ROTP-013
C            WV:      INFORMATIONS FOR ROTZ, STEP SIZE IN WV(8).        ROTP-014
C            INVZ:    NUMBER OF TRANSITION FORM FACTORS.                ROTP-015
C            IQ1:     INY + NUMBER OF TRANSITION FORM FACTORS.          ROTP-016
C            INY:     1 + NUMBER OF DERIVATIVES OF CENTRAL              ROTP-017
C                     POTENTIALS ( SCHROEDINGER: 1, DIRAC: 2)           ROTP-018
C            PGN,XGN: WEIGHTS, ABSCISSAE OF LEGENDRE INTEGRAL.          ROTP-019
C            LO(I):   LOGICAL CONTROLS:                                 ROTP-020
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).ROTP-021
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     ROTP-022
C                              ROTATIONAL MODEL.                        ROTP-023
C               LO(6)  =.TRUE. USE DEFORMATION LENGTHS.                 ROTP-024
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    ROTP-025
C               LO(9)  =.TRUE. SYMMETRISED WOODS-SAXON FORM FACTORS WHENROTP-026
C                              THE RADIUS IS NEGATIVE.                  ROTP-027
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              ROTP-028
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            ROTP-029
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      ROTP-030
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. ROTP-031
C               LO(17) =.TRUE. FOLDING MODEL.                           ROTP-032
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   ROTP-033
C               LO(99) =.TRUE. SCHROEDINGER EQUIVALENT TO DIRAC         ROTP-034
C                              EQUATION.                                ROTP-035
C               LO(100)=.TRUE. DIRAC EQUATION.                          ROTP-036
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    ROTP-037
C               LO(102)=.TRUE. THERE IS AN IMAGINARY SPIN-ORBIT         ROTP-038
C                              POTENTIAL.                               ROTP-039
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. ROTP-040
C               LO(109)=.TRUE. FOR DIRAC POTENTIALS.                    ROTP-041
C OUTPUT:    V:       POTENTIALS AND TRANSITION FORM FACTORS,           ROTP-042
C                     ONLY POTENTIALS AND DERIVATIVES FOR DIRAC.        ROTP-043
C            VA:      TRANSITION FORM FACTORS FOR DIRAC EQUATION.       ROTP-044
C WORKING AREAS:                                                        ROTP-045
C            IV:      ORDER OF DERIVATIVE OF THE IQ1 FORM FACTORS.      ROTP-046
C            PP:      INTERMEDIATE RESULTS, WEIGHTS, .... IN ROTD.      ROTP-047
C            B:       FOR DEFORMATIONS.                                 ROTP-048
C            P:       WEIGHTS COMPUTED IN ROTD.                         ROTP-049
C                                                                       ROTP-050
C FOR THE COMMONS /COUPL/ AND /DCONS/ SEE CALC.                         ROTP-051
C FOR THE COMMON  /POTE1/ SEE REDM.                                     ROTP-052
C                                                                       ROTP-053
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     ROTP-054
C  IQM:       MAXIMUM L-VALUE OF DEFORMATION IN ROTATIONAL MODEL.       ROTP-055
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           ROTP-056
C   USED:     IQM,NBT1.                                                 ROTP-057
C                                                                       ROTP-058
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     ROTP-059
C  CCZ:       COULOMB ALPHA CONSTANT.                                   ROTP-060
C   USED:     CCZ.                                                      ROTP-061
C                                                                       ROTP-062
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE1/:                     ROTP-063
C  ITX(16):   STARTING ADDRESS OF DIFFERENT FORM FACTORS (SEE REDM).    ROTP-064
C  IMAX:      MAXIMUM ANGULAR MOMENTUM.                                 ROTP-065
C  INLS:      NUMBER OF SPIN-ORBIT FORM FACTORS NOT TAKING INTO ACCOUNT ROTP-066
C             MULTIPLICATION BY 2.                                      ROTP-067
C  INVD:      IDEM FOR COULOMB SPIN-ORBIT.                              ROTP-068
C   USED:     ITX,IMAX,INLS,INVD.                                       ROTP-069
C                                                                       ROTP-070
C***********************************************************************ROTP-071
      IMPLICIT REAL*8 (A-H,O-Z)                                         ROTP-072
      LOGICAL LO(150),LQ(8,5)                                           ROTP-073
      DIMENSION BETA(9,*),NBETA(18,*),V(ISM,*),VA(ISM,11,*),IVY(7,*),IV(ROTP-074
     1*),PP(*),B(10,*),P(ID1,*),VAL(4,9),PGN(10),XGN(10),IZ(8,2),EP(8),ZROTP-075
     2Z(2),DD(2),Q(8,36),VR(6,10),LDL(8),SRD(4),WV(22),PW(8)            ROTP-076
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   ROTP-077
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            ROTP-078
      COMMON /POTE1/ ITX(16),IMAX,INTC,INLS,INVC,INVD,ITXM              ROTP-079
      COMMON /INOUT/ MR,MW,MS                                           ROTP-080
      DATA LDL /7,12,7,12,13,14,11,19/                                  ROTP-081
      DATA SRD /1.D0,1.D0,2.D0,6.D0/                                    ROTP-082
C CHECKS OF DIFFUSENESSES.                                              ROTP-083
      DO 2 I=1,8                                                        ROTP-084
      J=LDL(I)                                                          ROTP-085
      LQ(I,5)=.NOT.LO(J)                                                ROTP-086
      PW(I)=1.D0+VAL(4,I)                                               ROTP-087
      IF (J.EQ.7) LQ(I,5)=LO(J)                                         ROTP-088
      LQ(I,1)=VAL(1,I).EQ.0.D0                                          ROTP-089
      LQ(I,2)=(I.LE.6).OR.(VAL(1,I)*VAL(3,I).NE.0.D0)                   ROTP-090
      LQ(I,3)=LQ(I,1).OR.(.NOT.LQ(I,2))                                 ROTP-091
      LQ(I,2)=LQ(I,2).OR.LQ(I,1)                                        ROTP-092
      IF (LQ(I,1)) GO TO 2                                              ROTP-093
      LQ(I,4)=(.NOT.LO(9)).OR.(VAL(2,I).GE.0.D0)                        ROTP-094
      IF (.NOT.LQ(I,2)) GO TO 1                                         ROTP-095
      IF (VAL(3,I).GE.0.02D0*WV(8)) GO TO 1                             ROTP-096
      WRITE (MW,1000) VAL(3,I),I,IP                                     ROTP-097
      VAL(3,I)=DMAX1(-VAL(3,I),0.02D0*WV(8))                            ROTP-098
    1 IF (VAL(2,I).GE.WV(8).OR.LO(9)) GO TO 2                           ROTP-099
      WRITE (MW,1001) VAL(2,I),I,IP                                     ROTP-100
      VAL(2,I)=DMAX1(-VAL(2,I),WV(8))                                   ROTP-101
    2 CONTINUE                                                          ROTP-102
      LQ(1,2)=LQ(7,2).AND.LQ(8,2)                                       ROTP-103
      IDG=0                                                             ROTP-104
      INX=INY+1                                                         ROTP-105
      SR=1.D0                                                           ROTP-106
      DO 11 I=1,IQ1                                                     ROTP-107
      IV(I)=I+3                                                         ROTP-108
      IF (I.LE.INY) GO TO 8                                             ROTP-109
      K=MOD(IVY(1,I-INY),1000)                                          ROTP-110
      IF (K.EQ.0.OR.LO(3)) GO TO 6                                      ROTP-111
      IF (K.GT.NBT1) GO TO 4                                            ROTP-112
      IV(I)=2                                                           ROTP-113
      IDG=MAX0(IDG,1)                                                   ROTP-114
      DO 3 J=1,8                                                        ROTP-115
      IF (.NOT.LO(6)) SR=DABS(VAL(2,J))                                 ROTP-116
    3 B(J,I)=0.282095D0*BETA(J,K)*SR                                    ROTP-117
      GO TO 10                                                          ROTP-118
    4 K1=MOD(K,NBT1+1)                                                  ROTP-119
      K2=K/(NBT1+1)                                                     ROTP-120
      IDG=MAX0(IDG,2)                                                   ROTP-121
      IV(I)=3                                                           ROTP-122
      DO 5 J=1,8                                                        ROTP-123
      IF (.NOT.LO(6)) SR=DABS(VAL(2,J))                                 ROTP-124
    5 B(J,I)=0.0397887D0*BETA(J,K1)*BETA(J,K2)*SR*SR                    ROTP-125
      GO TO 10                                                          ROTP-126
    6 IV(I)=K+1                                                         ROTP-127
      IDG=MAX0(IDG,K)                                                   ROTP-128
      IF (LO(1)) GO TO 8                                                ROTP-129
      DO 7 J=1,8                                                        ROTP-130
      IF (.NOT.LO(6)) SR=DABS(VAL(2,J))                                 ROTP-131
    7 B(J,I)=SR**K*0.282095D0*BETA(J,K+1)/SRD(K+1)                      ROTP-132
      GO TO 10                                                          ROTP-133
    8 DO 9 J=1,8                                                        ROTP-134
    9 B(J,I)=1.D0                                                       ROTP-135
   10 B(9,I)=B(5,I)                                                     ROTP-136
   11 B(10,I)=B(6,I)                                                    ROTP-137
      IV(1)=1                                                           ROTP-138
C SET UP OF FORM FACTOR COMPUTATION.                                    ROTP-139
      IDS=1                                                             ROTP-140
      IDR=1                                                             ROTP-141
      IF (LO(17).OR.LO(99)) IDS=0                                       ROTP-142
      IF (LO(109)) IDR=0                                                ROTP-143
      IDT=IDR+IDS                                                       ROTP-144
      DO 12 I=1,8                                                       ROTP-145
      IDZ=IDG                                                           ROTP-146
      IF (LQ(I,5)) IDZ=0                                                ROTP-147
      IZ(I,2)=IDZ+1                                                     ROTP-148
      IF (LQ(I,3)) GO TO 12                                             ROTP-149
      EP(I)=DEXP(WV(8)/VAL(3,I))                                        ROTP-150
      IF ((I.EQ.3).OR.(I.EQ.4)) IDZ=IDZ+IDR                             ROTP-151
      IF ((I.EQ.5).OR.(I.EQ.6).OR.(I.EQ.8)) IDZ=IDZ+IDS                 ROTP-152
      IF (LO(109)) IDZ=MAX0(IDZ,2)                                      ROTP-153
   12 IZ(I,1)=IDZ                                                       ROTP-154
C LQ(I,1) IS .TRUE. IF THE FORM FACTOR IS NOT USED.                     ROTP-155
C LQ(I,2) IS .TRUE. FOR COULOMB FORM FACTOR WITH DIFFUSENESS.           ROTP-156
C LQ(I,3) IS .FALSE. FOR ANY WOODS-SAXON FORM FACTORS.                  ROTP-157
C LQ(I,4) IS .FALSE. FOR SYMMETRISED WOODS-SAXON FORM FACTORS.          ROTP-158
C LQ(I,5) IS .FALSE. FOR DEFORMED FORM FACTORS.                         ROTP-159
      CALL ROTD(NBETA,BETA(1,NBT1+1),IVY,IV,PP,P,Q,VAL,ID1,INVZ,IMAX,IQ1ROTP-160
     1,IQM,INY,IDT,LQ,DD,PGN,XGN,LO)                                    ROTP-161
      ZZ(1)=CCZ*VAL(1,7)                                                ROTP-162
      ZZ(2)=CCZ*VAL(1,8)                                                ROTP-163
      IF (DD(1).NE.0.D0) ZZ(1)=ZZ(1)/DD(1)                              ROTP-164
      IF (DD(2).NE.0.D0) ZZ(2)=ZZ(2)/DD(2)                              ROTP-165
      DO 14 J=1,10                                                      ROTP-166
      DO 13 I=1,6                                                       ROTP-167
   13 VR(I,J)=0.D0                                                      ROTP-168
   14 CONTINUE                                                          ROTP-169
      R=0.D0                                                            ROTP-170
      DO 52 IS=1,ISM                                                    ROTP-171
      R=R+WV(8)                                                         ROTP-172
      DO 16 I=1,IQ1                                                     ROTP-173
      DO 15 J=17,27                                                     ROTP-174
   15 P(J,I)=0.D0                                                       ROTP-175
   16 CONTINUE                                                          ROTP-176
C INTEGRATION LOOP.                                                     ROTP-177
      DO 43 J=1,IDT                                                     ROTP-178
      DO 26 I=1,8                                                       ROTP-179
      IF (LQ(I,3)) GO TO 26                                             ROTP-180
      Q(I,J)=Q(I,J)+WV(8)                                               ROTP-181
      IF (P(I,J).NE.0.D0) GO TO 17                                      ROTP-182
      IF (Q(I,J)+50.D0*VAL(3,I).GT.0.D0) P(I,J)=DEXP(Q(I,J)/VAL(3,I))   ROTP-183
      GO TO 18                                                          ROTP-184
   17 IF (P(I,J).LT.1.D15) P(I,J)=P(I,J)*EP(I)                          ROTP-185
   18 IF ((.NOT.LQ(I,4)).AND.P(I+8,J).GT.1.D-15) P(I+8,J)=P(I+8,J)/EP(I)ROTP-186
      IDV=IZ(I,1)                                                       ROTP-187
      CALL WOSA(VR(1,I),VAL(3,I),VAL(4,I),P(I,J),Q(I,J),IDV+2,LQ(I,4))  ROTP-188
      DO 19 K=1,IDV+2                                                   ROTP-189
   19 VR(K,I)=VR(K,I)*VAL(1,I)                                          ROTP-190
      IF ((I.LT.3).OR.(I.GE.7).OR.(IDT.EQ.0)) GO TO 25                  ROTP-191
      IF (I.GT.4) GO TO 21                                              ROTP-192
      IF (IDR.EQ.0) GO TO 25                                            ROTP-193
      DO 20 K=1,IDV                                                     ROTP-194
   20 VR(K,I)=4.D0*VR(K+1,I)*VAL(3,I)                                   ROTP-195
      GO TO 25                                                          ROTP-196
   21 IF (IDS.EQ.0) GO TO 25                                            ROTP-197
      IF (LO(100)) GO TO 23                                             ROTP-198
      DO 22 K=1,IDV                                                     ROTP-199
      VR(K,I+4)=VR(K,I)/R**2                                            ROTP-200
   22 VR(K,I)=VR(K+1,I)/R                                               ROTP-201
      GO TO 25                                                          ROTP-202
   23 DO 24 K=1,IDV                                                     ROTP-203
   24 VR(K,I+4)=VR(K+1,I)                                               ROTP-204
   25 IF (.NOT.LO(109)) GO TO 26                                        ROTP-205
      VR(5,I)=VR(2,I)                                                   ROTP-206
      VR(6,I)=VR(3,I)                                                   ROTP-207
   26 CONTINUE                                                          ROTP-208
      IF (.NOT.LO(99)) GO TO 27                                         ROTP-209
      CALL ROTZ(VR,XGN,WV,R,Q,VAL,J,IV,B,P,ID1,IQ1,LO)                  ROTP-210
      GO TO 43                                                          ROTP-211
   27 DO 29 L=1,IQ1                                                     ROTP-212
      K=IV(L)                                                           ROTP-213
      DO 28 M=1,10                                                      ROTP-214
   28 P(M+16,L)=P(M+16,L)+VR(K,M)*P(L+27,J)*B(M,L)                      ROTP-215
   29 CONTINUE                                                          ROTP-216
      IF (LQ(1,2)) GO TO 43                                             ROTP-217
C DEFORMED COULOMB POTENTIAL.                                           ROTP-218
      DO 42 I=7,8                                                       ROTP-219
      IF (LQ(I,2)) GO TO 42                                             ROTP-220
      C=P(I,J)/R                                                        ROTP-221
      IF (I.EQ.8.AND.(.NOT.(LO(17).OR.LO(100)))) GO TO 31               ROTP-222
      IF (R.LT.P(I,J)) GO TO 30                                         ROTP-223
      P(I+16,1)=P(I+16,1)+ZZ(I-6)*(P(I,J)**2)*C*P(28,J)                 ROTP-224
      IF (.NOT.LO(100)) GO TO 32                                        ROTP-225
      P(I+16,2)=P(I+16,2)+ZZ(I-6)*P(I,J)*C**2*P(28,J)                   ROTP-226
      P(I+16,3)=P(I+16,3)+ZZ(I-6)*2.D0*C**3*P(28,J)                     ROTP-227
      GO TO 32                                                          ROTP-228
   30 P(I+16,1)=P(I+16,1)+(0.5D0*P(I,J)*P(I,J)-R*R/6.D0)*ZZ(I-6)*P(28,J)ROTP-229
     1*3.D0                                                             ROTP-230
      IF (.NOT.LO(100)) GO TO 32                                        ROTP-231
      P(I+16,2)=P(I+16,2)+R*ZZ(I-6)*P(28,J)                             ROTP-232
      P(I+16,3)=P(I+16,3)-ZZ(I-6)*P(28,J)                               ROTP-233
      GO TO 32                                                          ROTP-234
   31 C1=ZZ(I-6)*P(28,J)                                                ROTP-235
      IF (R.GT.P(I,J)) C1=C1*C**3                                       ROTP-236
      P(24,1)=P(24,1)+C1                                                ROTP-237
   32 IF (INVZ.EQ.0) GO TO 42                                           ROTP-238
      IF (.NOT.LO(8*I-45)) GO TO 42                                     ROTP-239
      DO 41 K=INX,IQ1                                                   ROTP-240
      L=IVY(7,K-INY)+1                                                  ROTP-241
      IF ((IVY(I-3,K-INY).EQ.0).OR.(L.EQ.1)) GO TO 41                   ROTP-242
      D=L                                                               ROTP-243
      N=IV(K)                                                           ROTP-244
      IF (R.LT.P(I,J)) GO TO 33                                         ROTP-245
      C1=(P(I,J)**2)*(C**L)*3.D0/((D+2.D0)*(2.D0*D-1.D0))               ROTP-246
      IF (N.GT.1) C1=C1*(D+2.D0)/P(I,J)                                 ROTP-247
      IF (N.GT.2) C1=C1*(D+1.D0)/P(I,J)                                 ROTP-248
      IF (N.GT.3) C1=C1*D/P(I,J)                                        ROTP-249
      GO TO 35                                                          ROTP-250
   33 IF (L.NE.3) GO TO 34                                              ROTP-251
      IF (N.EQ.1) C1=R*R*(0.2D0+DLOG(C))*0.6D0                          ROTP-252
      IF (N.GE.2) C1=0.6D0*R/C                                          ROTP-253
      IF (N.GE.3) C1=-C1/P(I,J)                                         ROTP-254
      IF (N.GE.4) C1=-2.D0*C1/P(I,J)                                    ROTP-255
      GO TO 35                                                          ROTP-256
   34 IF (N.EQ.1) C1=R*R*(1.D0/(D+2.D0)-1.D0/(C**(L-3)*(2.D0*D-1.D0)))*3ROTP-257
     1.D0/(D-3.D0)                                                      ROTP-258
      IF (N.GE.2) C1=R/C**(L-2)*3.D0/(2.D0*D-1.D0)                      ROTP-259
      IF (N.GE.3) C1=-C1*(D-2.D0)/P(I,J)                                ROTP-260
      IF (N.EQ.4) C1=-C1*(D-1.D0)/P(I,J)                                ROTP-261
   35 IF (I.EQ.7.OR.LO(17)) GO TO 40                                    ROTP-262
      IF (R.LT.P(I,J)) GO TO 36                                         ROTP-263
      C2=-D*C1/R                                                        ROTP-264
      GO TO 38                                                          ROTP-265
   36 IF (L.NE.3) GO TO 37                                              ROTP-266
      IF (N.EQ.1) C2=-1.2D0*(0.3D0*R-DLOG(C))*R                         ROTP-267
      IF (N.GE.2) C2=2.D0*C1/R                                          ROTP-268
      GO TO 38                                                          ROTP-269
   37 IF (N.EQ.1) C2=(2.D0/(D+2.D0)-(D-1.D0)/(C**(L-3)*(2.D0*D-1.D0)))*3ROTP-270
     1.D0/(D-3.D0)*R                                                    ROTP-271
      IF (N.NE.1)  C2=(D-1.D0)*C1/R                                     ROTP-272
   38 IF (LO(100)) GO TO 39                                             ROTP-273
      P(27,K)=P(27,K)-ZZ(2)*C1*P(K+27,J)*B(I,K)/R**2                    ROTP-274
      P(24,K)=P(24,K)-ZZ(2)*C2*P(K+27,J)*B(I,K)/R                       ROTP-275
      GO TO 41                                                          ROTP-276
   39 P(27,K)=P(27,K)-ZZ(2)*C2*P(K+27,J)*B(I,K)                         ROTP-277
      P(24,K)=P(24,K)+ZZ(2)*C1*P(K+27,J)*B(I,K)                         ROTP-278
      GO TO 41                                                          ROTP-279
   40 P(I+16,K)=P(I+16,K)+ZZ(I-6)*C1*P(K+27,J)*B(I,K)                   ROTP-280
   41 CONTINUE                                                          ROTP-281
   42 CONTINUE                                                          ROTP-282
   43 CONTINUE                                                          ROTP-283
C STORAGE OF FORM FACTORS.                                              ROTP-284
      IF (LO(100)) GO TO 47                                             ROTP-285
      V(IS,IP+ITX(1))=P(17,1)                                           ROTP-286
      V(IS,IP+ITX(2))=P(18,1)                                           ROTP-287
      V(IS,IP+ITX(3))=P(19,1)                                           ROTP-288
      V(IS,IP+ITX(4))=P(20,1)                                           ROTP-289
      IF (LO(101)) V(IS,IP+ITX(5))=P(21,1)                              ROTP-290
      IF (LO(102)) V(IS,IP+ITX(6))=P(22,1)                              ROTP-291
      V(IS,IP+ITX(7))=P(23,1)                                           ROTP-292
      IF (LO(103)) V(IS,IP+ITX(8))=P(24,1)                              ROTP-293
      IF (INVZ.LE.0) GO TO 52                                           ROTP-294
      DO 46 J=1,INVZ                                                    ROTP-295
      K=J+INY                                                           ROTP-296
      V(IS,J+ITX(9))=P(17,K)                                            ROTP-297
      V(IS,J+ITX(11))=P(19,K)                                           ROTP-298
      IF (.NOT.LO(12)) GO TO 44                                         ROTP-299
      V(IS,J+ITX(10))=P(18,K)                                           ROTP-300
      V(IS,J+ITX(12))=P(20,K)                                           ROTP-301
   44 IJ=IVY(4,J)                                                       ROTP-302
      IF (IJ.NE.0) V(IS,IJ+ITX(15))=P(23,K)                             ROTP-303
      IJ=IVY(3,J)                                                       ROTP-304
      IF (IJ.EQ.0) GO TO 45                                             ROTP-305
      V(IS,IJ+ITX(13))=P(21,K)                                          ROTP-306
      V(IS,IJ+ITX(13)+INLS)=-P(25,K)                                    ROTP-307
      IF (.NOT.LO(14)) GO TO 45                                         ROTP-308
      V(IS,IJ+ITX(14))=P(22,K)                                          ROTP-309
      V(IS,IJ+ITX(14)+INLS)=-P(26,K)                                    ROTP-310
   45 IJ=IVY(5,J)                                                       ROTP-311
      IF (IJ.EQ.0) GO TO 46                                             ROTP-312
      V(IS,IJ+ITX(16))=P(24,K)                                          ROTP-313
      V(IS,IJ+ITX(16)+INVD)=P(27,K)                                     ROTP-314
   46 CONTINUE                                                          ROTP-315
      GO TO 52                                                          ROTP-316
   47 K=IP                                                              ROTP-317
      DO 49 I=1,3                                                       ROTP-318
      DO 48 J=17,24                                                     ROTP-319
      V(IS,K)=P(J,I)                                                    ROTP-320
   48 K=K+1                                                             ROTP-321
   49 CONTINUE                                                          ROTP-322
      IF (INVZ.EQ.0) GO TO 52                                           ROTP-323
      DO 51 K=1,INVZ                                                    ROTP-324
      DO 50 J=1,11                                                      ROTP-325
   50 VA(IS,J,K)=P(J+16,K+3)                                            ROTP-326
   51 CONTINUE                                                          ROTP-327
   52 CONTINUE                                                          ROTP-328
C COULOMB POTENTIALS WITH DIFFUSE CHARGE DISTRIBUTION.                  ROTP-329
      IF (LQ(7,3).AND.LQ(8,3)) RETURN                                   ROTP-330
      DO 58 I=7,8                                                       ROTP-331
      IF (LQ(I,3)) GO TO 58                                             ROTP-332
      I1=IP+ITX(I)                                                      ROTP-333
      IF (I.EQ.8.AND.(.NOT.(LO(17).OR.LO(100)))) GO TO 53               ROTP-334
      IF (LO(100)) I1=IP+I-1                                            ROTP-335
      CALL COPO(V(1,I1),V(1,I1),P,ISM,WV(8),0,VAL(1,I),VAL(1,9),CCZ,ZT,.ROTP-336
     1FALSE.,.FALSE.)                                                   ROTP-337
      IF (.NOT.LO(100)) GO TO 54                                        ROTP-338
      CALL DERI(V(1,I1+8),V(1,I1),WV(8),ISM,.TRUE.)                     ROTP-339
      CALL DERI(V(1,I1+16),V(1,I1+8),WV(8),ISM,.TRUE.)                  ROTP-340
      GO TO 54                                                          ROTP-341
   53 CALL COPO(P,V(1,I1),P,ISM,WV(8),0,VAL(1,I),VAL(1,9),CCZ,ZT,.FALSE.ROTP-342
     1,.FALSE.)                                                         ROTP-343
      CALL DERI(V(1,I1),P,WV(8),ISM,.FALSE.)                            ROTP-344
   54 IF (INVZ.EQ.0.OR.(.NOT.LO(8*I-45))) GO TO 58                      ROTP-345
      DO 57 J=1,INVZ                                                    ROTP-346
      N=IVY(I-3,J)                                                      ROTP-347
      L=IVY(7,J)                                                        ROTP-348
      IF ((N.EQ.0).OR.(L.EQ.0)) GO TO 57                                ROTP-349
      I1=N+ITX(I+8)                                                     ROTP-350
      IF (LO(100)) I1=ITX(5)+11*J+I                                     ROTP-351
      I2=I1                                                             ROTP-352
      IF (.NOT.(LO(100).OR.(I.NE.8).OR.LO(17))) I2=I2+INVD              ROTP-353
      CALL COPO(V(1,I2),V(1,I1),P,ISM,WV(8),L,VAL(1,I),VAL(1,9),CCZ,ZT,.ROTP-354
     1FALSE.,.TRUE.)                                                    ROTP-355
      IF ((I.EQ.7).OR.LO(17)) GO TO 57                                  ROTP-356
      IF (.NOT.LO(100)) GO TO 55                                        ROTP-357
      CALL DERI(V(1,I1+3),V(1,I1),WV(8),ISM,.TRUE.)                     ROTP-358
      GO TO 57                                                          ROTP-359
   55 CALL DERI(V(1,I1),V(1,I2),WV(8),ISM,.FALSE.)                      ROTP-360
      RR=0.D0                                                           ROTP-361
      DO 56 IS=1,ISM                                                    ROTP-362
      RR=RR+WV(8)                                                       ROTP-363
   56 V(IS,I2)=-V(IS,I2)/RR**2                                          ROTP-364
   57 CONTINUE                                                          ROTP-365
   58 CONTINUE                                                          ROTP-366
      RETURN                                                            ROTP-367
 1000 FORMAT (' TOO SMALL DIFFUSENESS =',1P,D15.6,' FOR THE POTENTIAL',2ROTP-368
     1I4,'   CHANGED INTO ITS MINIMUM VALUE.')                          ROTP-369
 1001 FORMAT (' TOO SMALL COULOMB RADIUS =',1P,D15.6,' FOR THE POTENTIALROTP-370
     1',2I4,'   CHANGED INTO ITS MINIMUM VALUE.')                       ROTP-371
      END                                                               ROTP-372
C 02/03/07                                                      ECIS06  ROTD-000
      SUBROUTINE ROTD(NBETA,BETA,IVY,IV,PP,P,Q,VAL,ID1,INVZ,IMAX,IQ1,IQMROTD-001
     1,INY,IDT,LQ,DD,PGN,XGN,LO)                                        ROTD-002
C ***** SYMMETRIC ROTATIONAL MODEL:                                     ROTD-003
C A 20-POINTS GAUSS-LEGENDRE INTEGRATION METHOD IS USED, REDUCED TO 10  ROTD-004
C VALUES BY SYMMETRY.                                                   ROTD-005
C                                                                       ROTD-006
C ***** ASYMMETRIC ROTATIONAL MODEL:                                    ROTD-007
C 36 VALUES OF (THETA,PHI) HAVE BEEN CHOSEN. THE VALUES OF THETA ARE    ROTD-008
C N*PI/14. AND FOR EACH VALUE OF "N" THERE ARE N+1 VALUES OF PHI EQUI-  ROTD-009
C DISTANT BETWEEN 0. AND PI/2. THE MATRIX, THE ELEMENTS OF WHICH ARE THEROTD-010
C ROTATION MATRIX ELEMENTS FOR THESE ANGLES AND L GIVEN IN NL, K IN NK  ROTD-011
C HAS BEEN INVERTED. THE COEFFICIENTS OF THE 15 LOWEST (L,K) ARE STORED ROTD-012
C IN POIDS. THE 15 REDUCED ROTATION MATRIX ELEMENTS FOR THE 8 VALUES OF ROTD-013
C THETA ARE IN RB.                                                      ROTD-014
C                                                                       ROTD-015
C ***** VIBRATIONAL MODEL:                                              ROTD-016
C THE ANGULAR INTEGRATION IS REDUCED TO ONE POINT.                      ROTD-017
C                                                                       ROTD-018
C INPUT:     NBETA:   INFORMATIONS ON VIBRATIONS.                       ROTD-019
C            BETA:    STATIC DEFORMATIONS.                              ROTD-020
C            IVY:     INFORMATIONS ON FORM FACTORS.                     ROTD-021
C            IV:      ORDER OF DERIVATIVE OF EACH FORM FACTOR.          ROTD-022
C            VAL:     OPTICAL PARAMETERS.                               ROTD-023
C            ID1:     FIRST DIMENSION OF THE WORKING SPACE P.           ROTD-024
C            INVZ:    NUMBER OF TRANSITION FORM FACTORS.                ROTD-025
C            IMAX:    MAXIMUM ANGULAR MOMENTUM.                         ROTD-026
C            IQ1:     INY + NUMBER OF TRANSITION FORM FACTORS.          ROTD-027
C            IQM:     MAXIMUM MULTIPOLARITY OF STATIC DEFORM.           ROTD-028
C            INY:     1 + NUMBER OF DERIVATIVES OF CENTRAL              ROTD-029
C                     POTENTIALS ( SCHROEDINGER: 1, DIRAC: 2).          ROTD-030
C            LQ:      LOCAL LOGICAL CONTROLS (SEE ROTP).                ROTD-031
C            PGN:     WEIGHT OF LEGENDRE INTEGRAL.                      ROTD-032
C            XGN:     ABSCISSAE OF LEGENDRE INTEGRAL.                   ROTD-033
C            LO(I):   LOGICAL CONTROLS:                                 ROTD-034
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).ROTD-035
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     ROTD-036
C                              ROTATIONAL MODEL.                        ROTD-037
C               LO(6)  =.TRUE. USE DEFORMATION LENGTHS.                 ROTD-038
C OUTPUT:    P(K,J):  WEIGHT AT POINT J OF FORM FACTOR I AT K=I+27.     ROTD-039
C            Q(K,J)   RADII IN FERMIS. IN ROTATIONAL MODEL, J=13,24 IS  ROTD-040
C                     FIRST DERIVATIVE/SIN(THETA) AND J=25,36 2ND       ROTD-041
C                     DERIVATIVE + 1ST DERIVATIVE/TG(THETA), USED FOR   ROTD-042
C                     SCHROEDINGER EQUIVALENT OF DIRAC EQUATION.        ROTD-043
C            IDT:     NUMBER OF INTEGRATION POINTS.                     ROTD-044
C            DD:      CHARGE INTEGRALS.                                 ROTD-045
C WORKING AREA:                                                         ROTD-046
C            PP:      FOR LEGENDRE POLYNOMIALS.                         ROTD-047
C***********************************************************************ROTD-048
      IMPLICIT REAL*8 (A-H,O-Z)                                         ROTD-049
      LOGICAL LO(150),LQ(8,5)                                           ROTD-050
      DIMENSION NBETA(18,*),BETA(9,*),IVY(7,*),IV(*),PP(*),P(ID1,*),Q(8,ROTD-051
     1*),VAL(4,8),DD(2),PGN(10),XGN(10),FF(660),POIDS(36,15),RB(15,8),NLROTD-052
     2(36),NK(36)                                                       ROTD-053
      EQUIVALENCE (POIDS(1,1),FF(1)),(RB(1,1),FF(541))                  ROTD-054
      DATA FF(  1),FF(  2) / 5.12820512820513D-03, 2.43496936475441D-02/ROTD-055
      DATA FF(  3),FF(  4) / 2.43496936475441D-02, 2.12528237972895D-02/ROTD-056
      DATA FF(  5),FF(  6) / 5.53147440814732D-02, 2.12528237972895D-02/ROTD-057
      DATA FF(  7),FF(  8) / 2.53452023906582D-02, 4.44873368571440D-02/ROTD-058
      DATA FF(  9),FF( 10) / 4.44873368571440D-02, 2.53452023906582D-02/ROTD-059
      DATA FF( 11),FF( 12) / 1.86559801758989D-02, 4.85184708058446D-02/ROTD-060
      DATA FF( 13),FF( 14) / 4.12568870375796D-02, 4.85184708058446D-02/ROTD-061
      DATA FF( 15),FF( 16) / 1.86559801758989D-02, 2.45925296747690D-02/ROTD-062
      DATA FF( 17),FF( 18) / 3.46398560932081D-02, 4.17933479732147D-02/ROTD-063
      DATA FF( 19),FF( 20) / 4.17933479732147D-02, 3.46398560932081D-02/ROTD-064
      DATA FF( 21),FF( 22) / 2.45925296747690D-02, 1.19673178236678D-02/ROTD-065
      DATA FF( 23),FF( 24) / 4.47278246564596D-02, 3.42917677140348D-02/ROTD-066
      DATA FF( 25),FF( 26) / 3.69076912422490D-02, 3.42917677140348D-02/ROTD-067
      DATA FF( 27),FF( 28) / 4.47278246564596D-02, 1.19673178236678D-02/ROTD-068
      DATA FF( 29),FF( 30) / 1.22068028124735D-02, 1.07129429826274D-02/ROTD-069
      DATA FF( 31),FF( 32) / 1.70796570854178D-02, 1.60746817649944D-02/ROTD-070
      DATA FF( 33),FF( 34) / 1.60746817649944D-02, 1.70796570854178D-02/ROTD-071
      DATA FF( 35),FF( 36) / 1.07129429826274D-02, 1.22068028124735D-02/ROTD-072
      DATA FF( 37),FF( 38) / 1.16509780810355D-02, 5.02196040257258D-02/ROTD-073
      DATA FF( 39),FF( 40) / 5.02196040257258D-02, 3.27291637647035D-02/ROTD-074
      DATA FF( 41),FF( 42) / 9.18762267773519D-02, 3.27291637647035D-02/ROTD-075
      DATA FF( 43),FF( 44) / 2.59023523875124D-02, 3.90112947467209D-02/ROTD-076
      DATA FF( 45),FF( 46) / 3.90112947467209D-02, 2.59023523875124D-02/ROTD-077
      DATA FF( 47),FF( 48) /-1.94110577743667D-03, 1.63152196117813D-02/ROTD-078
      DATA FF( 49),FF( 50) / 4.25393417813309D-03, 1.63152196117813D-02/ROTD-079
      DATA FF( 51),FF( 52) /-1.94110577743667D-03,-2.10440960549142D-03/ROTD-080
      DATA FF( 53),FF( 54) /-2.95605747812527D-02,-1.76788269194279D-02/ROTD-081
      DATA FF( 55),FF( 56) /-1.76788269194279D-02,-2.95605747812527D-02/ROTD-082
      DATA FF( 57),FF( 58) /-2.10440960549142D-03,-2.76725877126884D-02/ROTD-083
      DATA FF( 59),FF( 60) /-2.18051394343160D-02,-3.71237658735663D-02/ROTD-084
      DATA FF( 61),FF( 62) /-3.47941600457989D-02,-3.71237658735663D-02/ROTD-085
      DATA FF( 63),FF( 64) /-2.18051394343160D-02,-2.76725877126884D-02/ROTD-086
      DATA FF( 65),FF( 66) /-2.37727476826438D-03,-2.57698170677382D-02/ROTD-087
      DATA FF( 67),FF( 68) /-1.69793430277171D-02,-1.76582790639056D-02/ROTD-088
      DATA FF( 69),FF( 70) /-1.76582790639056D-02,-1.69793430277171D-02/ROTD-089
      DATA FF( 71),FF( 72) /-2.57698170677382D-02,-2.37727476826438D-03/ROTD-090
      DATA FF( 73),FF( 74) /               0.D+00, 1.72605997389226D-03/ROTD-091
      DATA FF( 75),FF( 76) /-1.72605997389226D-03, 1.25329145074895D-02/ROTD-092
      DATA FF( 77),FF( 78) /               0.D+00,-1.25329145074895D-02/ROTD-093
      DATA FF( 79),FF( 80) / 2.24225003695212D-02, 2.96494182999275D-02/ROTD-094
      DATA FF( 81),FF( 82) /-2.96494182999275D-02,-2.24225003695212D-02/ROTD-095
      DATA FF( 83),FF( 84) / 3.91319410166702D-02, 4.84852241623139D-02/ROTD-096
      DATA FF( 85),FF( 86) /               0.D+00,-4.84852241623139D-02/ROTD-097
      DATA FF( 87),FF( 88) /-3.91319410166702D-02, 3.97624306723559D-02/ROTD-098
      DATA FF( 89),FF( 90) / 8.10325074410309D-02, 2.28106411006477D-02/ROTD-099
      DATA FF( 91),FF( 92) /-2.28106411006477D-02,-8.10325074410309D-02/ROTD-100
      DATA FF( 93),FF( 94) /-3.97624306723559D-02, 5.59851854712431D-02/ROTD-101
      DATA FF( 95),FF( 96) / 6.92750919115029D-02, 5.27666983806334D-02/ROTD-102
      DATA FF( 97),FF( 98) /               0.D+00,-5.27666983806334D-02/ROTD-103
      DATA FF( 99),FF(100) /-6.92750919115029D-02,-5.59851854712431D-02/ROTD-104
      DATA FF(101),FF(102) / 1.57386702462217D-02, 4.84030198418523D-02/ROTD-105
      DATA FF(103),FF(104) / 2.47182393346187D-02, 9.25890190803834D-03/ROTD-106
      DATA FF(105),FF(106) /-9.25890190803834D-03,-2.47182393346187D-02/ROTD-107
      DATA FF(107),FF(108) /-4.84030198418523D-02,-1.57386702462217D-02/ROTD-108
      DATA FF(109),FF(110) / 1.62578391680559D-02, 5.49097361991748D-02/ROTD-109
      DATA FF(111),FF(112) / 5.49097361991748D-02, 8.83119316755724D-03/ROTD-110
      DATA FF(113),FF(114) / 4.65475180836232D-02, 8.83119316755724D-03/ROTD-111
      DATA FF(115),FF(116) /-1.52665570705068D-02,-4.45213321560779D-02/ROTD-112
      DATA FF(117),FF(118) /-4.45213321560779D-02,-1.52665570705068D-02/ROTD-113
      DATA FF(119),FF(120) /-3.25206220517009D-02,-5.00345998670453D-02/ROTD-114
      DATA FF(121),FF(122) /-5.61452437357254D-02,-5.00345998670453D-02/ROTD-115
      DATA FF(123),FF(124) /-3.25206220517009D-02,-5.34880433627418D-03/ROTD-116
      DATA FF(125),FF(126) /-2.71365320807763D-02,-2.11168478505607D-02/ROTD-117
      DATA FF(127),FF(128) /-2.11168478505607D-02,-2.71365320807763D-02/ROTD-118
      DATA FF(129),FF(130) /-5.34880433627418D-03, 5.38896697941338D-03/ROTD-119
      DATA FF(131),FF(132) / 2.71262358172909D-02, 2.30796535753636D-02/ROTD-120
      DATA FF(133),FF(134) / 2.05455707964392D-02, 2.30796535753636D-02/ROTD-121
      DATA FF(135),FF(136) / 2.71262358172909D-02, 5.38896697941338D-03/ROTD-122
      DATA FF(137),FF(138) / 1.18873085059175D-02, 1.57695500564231D-02/ROTD-123
      DATA FF(139),FF(140) / 1.69343260833909D-02, 1.84154828722142D-02/ROTD-124
      DATA FF(141),FF(142) / 1.84154828722142D-02, 1.69343260833909D-02/ROTD-125
      DATA FF(143),FF(144) / 1.57695500564231D-02, 1.18873085059175D-02/ROTD-126
      DATA FF(145),FF(146) /               0.D+00, 8.48270535877333D-03/ROTD-127
      DATA FF(147),FF(148) /-8.48270535877333D-03, 5.07879724674491D-02/ROTD-128
      DATA FF(149),FF(150) /               0.D+00,-5.07879724674491D-02/ROTD-129
      DATA FF(151),FF(152) / 6.07576950711252D-02, 9.00787083612551D-02/ROTD-130
      DATA FF(153),FF(154) /-9.00787083612551D-02,-6.07576950711252D-02/ROTD-131
      DATA FF(155),FF(156) / 6.45377024914683D-02, 6.34461864848980D-02/ROTD-132
      DATA FF(157),FF(158) /               0.D+00,-6.34461864848980D-02/ROTD-133
      DATA FF(159),FF(160) /-6.45377024914683D-02,-5.65537884945032D-03/ROTD-134
      DATA FF(161),FF(162) / 4.77376504465041D-02,-6.49930325424402D-03/ROTD-135
      DATA FF(163),FF(164) / 6.49930325424402D-03,-4.77376504465041D-02/ROTD-136
      DATA FF(165),FF(166) / 5.65537884945032D-03, 1.24655233750459D-03/ROTD-137
      DATA FF(167),FF(168) /-8.76714858478633D-02,-1.18181266709155D-02/ROTD-138
      DATA FF(169),FF(170) /               0.D+00, 1.18181266709155D-02/ROTD-139
      DATA FF(171),FF(172) / 8.76714858478633D-02,-1.24655233750459D-03/ROTD-140
      DATA FF(173),FF(174) /-3.84487336410874D-02,-7.62058619698479D-03/ROTD-141
      DATA FF(175),FF(176) /-3.01133238640137D-02,-1.08854252444356D-02/ROTD-142
      DATA FF(177),FF(178) / 1.08854252444356D-02, 3.01133238640137D-02/ROTD-143
      DATA FF(179),FF(180) / 7.62058619698479D-03, 3.84487336410874D-02/ROTD-144
      DATA FF(181),FF(182),FF(183),FF(184)/3*0.D0, 1.36660942007569D-03/ROTD-145
      DATA FF(185),FF(186) /-2.73321884015139D-03, 1.36660942007569D-03/ROTD-146
      DATA FF(187),FF(188) / 1.10470452782256D-02,-1.10470452782256D-02/ROTD-147
      DATA FF(189),FF(190) /-1.10470452782256D-02, 1.10470452782256D-02/ROTD-148
      DATA FF(191),FF(192) / 2.19899348965421D-02, 7.44598962747265D-03/ROTD-149
      DATA FF(193),FF(194) /-5.88718490480295D-02, 7.44598962747265D-03/ROTD-150
      DATA FF(195),FF(196) / 2.19899348965421D-02, 4.68819219798074D-02/ROTD-151
      DATA FF(197),FF(198) / 1.75997201070024D-02,-6.44816420868098D-02/ROTD-152
      DATA FF(199),FF(200) /-6.44816420868098D-02, 1.75997201070024D-02/ROTD-153
      DATA FF(201),FF(202) / 4.68819219798074D-02, 3.99738678988680D-02/ROTD-154
      DATA FF(203),FF(204) / 7.12682217154704D-02,-6.36366236436914D-02/ROTD-155
      DATA FF(205),FF(206) /-9.52109319412941D-02,-6.36366236436914D-02/ROTD-156
      DATA FF(207),FF(208) / 7.12682217154704D-02, 3.99738678988680D-02/ROTD-157
      DATA FF(209),FF(210) / 3.48854645305456D-02, 1.59406059510446D-02/ROTD-158
      DATA FF(211),FF(212) /-3.85251092517111D-03,-4.69735595564191D-02/ROTD-159
      DATA FF(213),FF(214) /-4.69735595564191D-02,-3.85251092517111D-03/ROTD-160
      DATA FF(215),FF(216) / 1.59406059510446D-02, 3.48854645305456D-02/ROTD-161
      DATA FF(217),FF(218) / 2.09351688388115D-02, 4.48693101517502D-02/ROTD-162
      DATA FF(219),FF(220) / 4.48693101517502D-02,-2.58717911400513D-02/ROTD-163
      DATA FF(221),FF(222) /-2.81401919724747D-02,-2.58717911400513D-02/ROTD-164
      DATA FF(223),FF(224) /-2.67091832939234D-02,-6.48487928844068D-02/ROTD-165
      DATA FF(225),FF(226) /-6.48487928844068D-02,-2.67091832939234D-02/ROTD-166
      DATA FF(227),FF(228) / 7.16351218404911D-03, 1.79021864804572D-02/ROTD-167
      DATA FF(229),FF(230) / 2.15963617795819D-02, 1.79021864804572D-02/ROTD-168
      DATA FF(231),FF(232) / 7.16351218404911D-03, 2.39109798331374D-02/ROTD-169
      DATA FF(233),FF(234) / 4.82363267486100D-02, 4.45971408837992D-02/ROTD-170
      DATA FF(235),FF(236) / 4.45971408837992D-02, 4.82363267486100D-02/ROTD-171
      DATA FF(237),FF(238) / 2.39109798331374D-02,-8.59824516528979D-04/ROTD-172
      DATA FF(239),FF(240) /-8.77138104825350D-03,-1.02303358111611D-03/ROTD-173
      DATA FF(241),FF(242) /-4.79305557318445D-03,-1.02303358111611D-03/ROTD-174
      DATA FF(243),FF(244) /-8.77138104825350D-03,-8.59824516528979D-04/ROTD-175
      DATA FF(245),FF(246) /-1.06844320272751D-02,-1.45408758222938D-02/ROTD-176
      DATA FF(247),FF(248) /-1.99395576475419D-02,-1.82297258567795D-02/ROTD-177
      DATA FF(249),FF(250) /-1.82297258567795D-02,-1.99395576475419D-02/ROTD-178
      DATA FF(251),FF(252) /-1.45408758222938D-02,-1.06844320272751D-02/ROTD-179
      DATA FF(253),FF(254) /               0.D+00, 2.01805115490348D-02/ROTD-180
      DATA FF(255),FF(256) /-2.01805115490348D-02, 8.57318720924763D-02/ROTD-181
      DATA FF(257),FF(258) /               0.D+00,-8.57318720924763D-02/ROTD-182
      DATA FF(259),FF(260) / 3.23094559967599D-02, 8.19417704703203D-02/ROTD-183
      DATA FF(261),FF(262) /-8.19417704703203D-02,-3.23094559967599D-02/ROTD-184
      DATA FF(263),FF(264) /-1.46857629097277D-02,-6.79023750172081D-02/ROTD-185
      DATA FF(265),FF(266) /               0.D+00, 6.79023750172081D-02/ROTD-186
      DATA FF(267),FF(268) / 1.46857629097277D-02,-6.96933563711756D-02/ROTD-187
      DATA FF(269),FF(270) /-4.17790846324735D-02,-3.84574445723291D-02/ROTD-188
      DATA FF(271),FF(272) / 3.84574445723291D-02, 4.17790846324735D-02/ROTD-189
      DATA FF(273),FF(274) / 6.96933563711756D-02, 3.99606295249026D-02/ROTD-190
      DATA FF(275),FF(276) /-3.02669933372692D-02, 1.78196010140318D-02/ROTD-191
      DATA FF(277),FF(278) /               0.D+00,-1.78196010140318D-02/ROTD-192
      DATA FF(279),FF(280) / 3.02669933372692D-02,-3.99606295249026D-02/ROTD-193
      DATA FF(281),FF(282) /-1.85102966735610D-03, 5.84883614463197D-02/ROTD-194
      DATA FF(283),FF(284) / 2.06176299500674D-02, 5.03674288697549D-03/ROTD-195
      DATA FF(285),FF(286) /-5.03674288697549D-03,-2.06176299500674D-02/ROTD-196
      DATA FF(287),FF(288) /-5.84883614463197D-02, 1.85102966735610D-03/ROTD-197
      DATA FF(289),FF(290),FF(291),FF(292)/3*0.D0, 8.75524578710006D-03/ROTD-198
      DATA FF(293),FF(294) /-1.75104915742001D-02, 8.75524578710006D-03/ROTD-199
      DATA FF(295),FF(296) / 5.09492763472956D-02,-5.09492763472956D-02/ROTD-200
      DATA FF(297),FF(298) /-5.09492763472956D-02, 5.09492763472956D-02/ROTD-201
      DATA FF(299),FF(300) / 5.07686792912787D-02, 3.43411087448840D-02/ROTD-202
      DATA FF(301),FF(302) /-1.70219576072325D-01, 3.43411087448840D-02/ROTD-203
      DATA FF(303),FF(304) / 5.07686792912787D-02, 5.95241999935498D-02/ROTD-204
      DATA FF(305),FF(306) /-1.56733778150275D-02,-4.38508221785223D-02/ROTD-205
      DATA FF(307),FF(308) /-4.38508221785223D-02,-1.56733778150275D-02/ROTD-206
      DATA FF(309),FF(310) / 5.95241999935498D-02,-6.35546557275261D-02/ROTD-207
      DATA FF(311),FF(312) / 5.26475282909628D-02,-1.74503883012358D-02/ROTD-208
      DATA FF(313),FF(314) / 5.67150314755984D-02,-1.74503883012358D-02/ROTD-209
      DATA FF(315),FF(316) / 5.26475282909628D-02,-6.35546557275261D-02/ROTD-210
      DATA FF(317),FF(318) / 1.43084825509049D-02,-7.77375076960055D-02/ROTD-211
      DATA FF(319),FF(320) / 2.99695551646778D-02, 3.34594699804229D-02/ROTD-212
      DATA FF(321),FF(322) / 3.34594699804229D-02, 2.99695551646778D-02/ROTD-213
      DATA FF(323),FF(324) /-7.77375076960055D-02, 1.43084825509049D-02/ROTD-214
      DATA FF(325),FF(326),FF(327),FF(328),FF(329),FF(330) / 6*0.D+00 / ROTD-215
      DATA FF(331),FF(332) / 2.45227713022227D-03,-4.90455426044453D-03/ROTD-216
      DATA FF(333),FF(334) / 4.90455426044453D-03,-2.45227713022227D-03/ROTD-217
      DATA FF(335),FF(336) / 1.70476858680581D-02,-2.41090685616840D-02/ROTD-218
      DATA FF(337),FF(338) /               0.D+00, 2.41090685616840D-02/ROTD-219
      DATA FF(339),FF(340) /-1.70476858680581D-02, 2.87679007598782D-02/ROTD-220
      DATA FF(341),FF(342) /-6.25948031834043D-03,-7.67073502036074D-02/ROTD-221
      DATA FF(343),FF(344) / 7.67073502036074D-02, 6.25948031834043D-03/ROTD-222
      DATA FF(345),FF(346) /-2.87679007598782D-02, 6.77534129025308D-02/ROTD-223
      DATA FF(347),FF(348) /-2.45662401760060D-02,-9.29568496692793D-02/ROTD-224
      DATA FF(349),FF(350) /               0.D+00, 9.29568496692793D-02/ROTD-225
      DATA FF(351),FF(352) / 2.45662401760060D-02,-6.77534129025308D-02/ROTD-226
      DATA FF(353),FF(354) / 1.40653464342708D-02, 3.44626025062703D-02/ROTD-227
      DATA FF(355),FF(356) /-6.14715612078917D-02,-3.05058349395271D-02/ROTD-228
      DATA FF(357),FF(358) / 3.05058349395271D-02, 6.14715612078917D-02/ROTD-229
      DATA FF(359),FF(360) /-3.44626025062703D-02,-1.40653464342708D-02/ROTD-230
      DATA FF(361),FF(362) / 2.68196038675183D-02, 2.31031610463596D-02/ROTD-231
      DATA FF(363),FF(364) / 2.31031610463596D-02,-4.28485793267828D-02/ROTD-232
      DATA FF(365),FF(366) /-7.35437975772992D-02,-4.28485793267828D-02/ROTD-233
      DATA FF(367),FF(368) / 8.24684503593131D-03, 1.06081754814925D-02/ROTD-234
      DATA FF(369),FF(370) / 1.06081754814925D-02, 8.24684503593131D-03/ROTD-235
      DATA FF(371),FF(372) / 2.51256208268608D-02, 4.43395667660788D-02/ROTD-236
      DATA FF(373),FF(374) / 5.39942159127383D-02, 4.43395667660788D-02/ROTD-237
      DATA FF(375),FF(376) / 2.51256208268608D-02,-2.19715194066651D-02/ROTD-238
      DATA FF(377),FF(378) /-3.13725579969708D-02,-4.08834934180796D-02/ROTD-239
      DATA FF(379),FF(380) /-4.08834934180796D-02,-3.13725579969708D-02/ROTD-240
      DATA FF(381),FF(382) /-2.19715194066651D-02,-1.88427973024923D-03/ROTD-241
      DATA FF(383),FF(384) /-2.16035578956301D-02,-1.17587068801884D-02/ROTD-242
      DATA FF(385),FF(386) /-1.12062882635935D-02,-1.17587068801884D-02/ROTD-243
      DATA FF(387),FF(388) /-2.16035578956301D-02,-1.88427973024923D-03/ROTD-244
      DATA FF(389),FF(390) / 5.74971871310925D-03, 2.25181635560216D-02/ROTD-245
      DATA FF(391),FF(392) / 1.76219271299887D-02, 1.69776491290416D-02/ROTD-246
      DATA FF(393),FF(394) / 1.69776491290416D-02, 1.76219271299887D-02/ROTD-247
      DATA FF(395),FF(396) / 2.25181635560216D-02, 5.74971871310925D-03/ROTD-248
      DATA FF(397),FF(398) /               0.D+00, 3.55735538800802D-02/ROTD-249
      DATA FF(399),FF(400) /-3.55735538800802D-02, 8.33786715099005D-02/ROTD-250
      DATA FF(401),FF(402) /               0.D+00,-8.33786715099005D-02/ROTD-251
      DATA FF(403),FF(404) /-4.89348970296868D-02,-2.91035565005004D-04/ROTD-252
      DATA FF(405),FF(406) / 2.91035565005004D-04, 4.89348970296868D-02/ROTD-253
      DATA FF(407),FF(408) /-2.62016346104983D-02,-8.33457375352782D-02/ROTD-254
      DATA FF(409),FF(410) /               0.D+00, 8.33457375352782D-02/ROTD-255
      DATA FF(411),FF(412) / 2.62016346104983D-02, 2.62738780028789D-02/ROTD-256
      DATA FF(413),FF(414) / 8.32340348860637D-02, 3.18724837249571D-02/ROTD-257
      DATA FF(415),FF(416) /-3.18724837249571D-02,-8.32340348860637D-02/ROTD-258
      DATA FF(417),FF(418) /-2.62738780028789D-02, 2.62547109771934D-02/ROTD-259
      DATA FF(419),FF(420) / 7.98302855528211D-03, 4.48364778698653D-03/ROTD-260
      DATA FF(421),FF(422) /               0.D+00,-4.48364778698653D-03/ROTD-261
      DATA FF(423),FF(424) /-7.98302855528211D-03,-2.62547109771934D-02/ROTD-262
      DATA FF(425),FF(426) /-2.51077741509568D-02,-2.87429639697600D-02/ROTD-263
      DATA FF(427),FF(428) /-1.79981066009081D-02,-7.87642513464656D-03/ROTD-264
      DATA FF(429),FF(430) / 7.87642513464656D-03, 1.79981066009081D-02/ROTD-265
      DATA FF(431),FF(432) / 2.87429639697600D-02, 2.51077741509568D-02/ROTD-266
      DATA FF(433),FF(434),FF(435),FF(436)/3*0.D0, 2.38959949710526D-02/ROTD-267
      DATA FF(437),FF(438) /-4.77919899421051D-02, 2.38959949710526D-02/ROTD-268
      DATA FF(439),FF(440) / 7.91176151667601D-02,-7.91176151667601D-02/ROTD-269
      DATA FF(441),FF(442) /-7.91176151667601D-02, 7.91176151667601D-02/ROTD-270
      DATA FF(443),FF(444) /-1.24626161171327D-02, 5.33272858981795D-02/ROTD-271
      DATA FF(445),FF(446) /-8.17293395620937D-02, 5.33272858981795D-02/ROTD-272
      DATA FF(447),FF(448) /-1.24626161171327D-02,-1.44916866191644D-02/ROTD-273
      DATA FF(449),FF(450) /-9.04220344262881D-02, 1.04913721045452D-01/ROTD-274
      DATA FF(451),FF(452) / 1.04913721045452D-01,-9.04220344262881D-02/ROTD-275
      DATA FF(453),FF(454) /-1.44916866191644D-02,-5.73533998264151D-02/ROTD-276
      DATA FF(455),FF(456) / 7.23959359228724D-02,-1.77393445770836D-02/ROTD-277
      DATA FF(457),FF(458) / 5.39361696125263D-03,-1.77393445770836D-02/ROTD-278
      DATA FF(459),FF(460) / 7.23959359228724D-02,-5.73533998264151D-02/ROTD-279
      DATA FF(461),FF(462) / 5.42648795710159D-02,-2.39248769146420D-02/ROTD-280
      DATA FF(463),FF(464) / 7.38288973327365D-04,-3.10782916297012D-02/ROTD-281
      DATA FF(465),FF(466) /-3.10782916297012D-02, 7.38288973327365D-04/ROTD-282
      DATA FF(467),FF(468) /-2.39248769146420D-02, 5.42648795710159D-02/ROTD-283
      DATA FF(469),FF(470),FF(471),FF(472),FF(473),FF(474) / 6*0.D+00 / ROTD-284
      DATA FF(475),FF(476) / 1.58592251779111D-02,-3.17184503558222D-02/ROTD-285
      DATA FF(477),FF(478) / 3.17184503558222D-02,-1.58592251779111D-02/ROTD-286
      DATA FF(479),FF(480) / 6.36434740587254D-02,-9.00054641703897D-02/ROTD-287
      DATA FF(481),FF(482) /               0.D+00, 9.00054641703897D-02/ROTD-288
      DATA FF(483),FF(484) /-6.36434740587254D-02, 2.20893694492763D-02/ROTD-289
      DATA FF(485),FF(486) / 2.93554190800171D-02,-1.48336186023447D-01/ROTD-290
      DATA FF(487),FF(488) / 1.48336186023447D-01,-2.93554190800171D-02/ROTD-291
      DATA FF(489),FF(490) /-2.20893694492763D-02, 4.17889616928183D-02/ROTD-292
      DATA FF(491),FF(492) /-9.17122054842361D-02, 7.52722761872573D-02/ROTD-293
      DATA FF(493),FF(494) /               0.D+00,-7.52722761872573D-02/ROTD-294
      DATA FF(495),FF(496) / 9.17122054842361D-02,-4.17889616928183D-02/ROTD-295
      DATA FF(497),FF(498) /-6.41790551032870D-02, 5.94260666825252D-02/ROTD-296
      DATA FF(499),FF(500) / 7.67785691121092D-03, 2.62939467857734D-02/ROTD-297
      DATA FF(501),FF(502) /-2.62939467857734D-02,-7.67785691121092D-03/ROTD-298
      DATA FF(503),FF(504) /-5.94260666825252D-02, 6.41790551032870D-02/ROTD-299
      DATA FF(505),FF(506),FF(507),FF(508),FF(509),FF(510) / 6*0.D+00 / ROTD-300
      DATA FF(511),FF(512),FF(513),FF(514)                 / 4*0.D+00 / ROTD-301
      DATA FF(515),FF(516) / 6.25351913613187D-03,-1.25070382722637D-02/ROTD-302
      DATA FF(517),FF(518) / 1.25070382722637D-02,-1.25070382722637D-02/ROTD-303
      DATA FF(519),FF(520) / 6.25351913613187D-03, 3.11758837931106D-02/ROTD-304
      DATA FF(521),FF(522) /-5.04436396065700D-02, 1.92677558134594D-02/ROTD-305
      DATA FF(523),FF(524) / 1.92677558134594D-02,-5.04436396065700D-02/ROTD-306
      DATA FF(525),FF(526) / 3.11758837931106D-02, 3.58893219026970D-02/ROTD-307
      DATA FF(527),FF(528) /-1.67264809607312D-02,-9.33778447285944D-02/ROTD-308
      DATA FF(529),FF(530) / 1.48430007573257D-01,-9.33778447285944D-02/ROTD-309
      DATA FF(531),FF(532) /-1.67264809607312D-02, 3.58893219026970D-02/ROTD-310
      DATA FF(533),FF(534) / 4.68575275756458D-02,-4.50757375114331D-02/ROTD-311
      DATA FF(535),FF(536) /-3.00076119100051D-02, 2.82258218457924D-02/ROTD-312
      DATA FF(537),FF(538) / 2.82258218457924D-02,-3.00076119100051D-02/ROTD-313
      DATA FF(539),FF(540) /-4.50757375114331D-02, 4.68575275756458D-02/ROTD-314
      DATA FF(541),FF(542),FF(543),FF(544) / 2*1.D+00, 0.D+00, 1.D+00 / ROTD-315
      DATA FF(545),FF(546),FF(547),FF(548) / 2*0.D+00, 1.D+00, 0.D+00 / ROTD-316
      DATA FF(549),FF(550),FF(551),FF(552) / 2*0.D+00, 1.D+00, 0.D+00 / ROTD-317
      DATA FF(553),FF(554),FF(555),FF(556) / 3*0.D+00, 1.D+00         / ROTD-318
      DATA FF(557),FF(558) / 9.25726650926814D-01, 3.03219677861538D-02/ROTD-319
      DATA FF(559),FF(560) / 7.63148756611001D-01, 1.10652387063757D-01/ROTD-320
      DATA FF(561),FF(562) / 1.28207234895501D-03, 5.36257386538795D-01/ROTD-321
      DATA FF(563),FF(564) / 2.17289580469363D-01, 8.13196358030030D-03/ROTD-322
      DATA FF(565),FF(566) / 5.76608786636350D-05, 2.78047174877667D-01/ROTD-323
      DATA FF(567),FF(568) / 3.29131159509191D-01, 2.49657214768430D-02/ROTD-324
      DATA FF(569),FF(570) / 5.20868271692270D-04, 2.66389008100408D-06/ROTD-325
      DATA FF(571),FF(572) /               1.D+00, 7.17617351394050D-01/ROTD-326
      DATA FF(573),FF(574) / 1.15282233550037D-01, 2.13774427323495D-01/ROTD-327
      DATA FF(575),FF(576) / 3.48423989314638D-01, 1.85320103458231D-02/ROTD-328
      DATA FF(577),FF(578) /-2.35732455017163D-01, 4.90294315725551D-01/ROTD-329
      DATA FF(579),FF(580) / 9.85729671840697D-02, 3.16881041332955D-03/ROTD-330
      DATA FF(581),FF(582) /-4.09576022206791D-01, 4.20201210269288D-01/ROTD-331
      DATA FF(583),FF(584) / 2.34245007796887D-01, 2.41313741208102D-02/ROTD-332
      DATA FF(585),FF(586) / 5.56591156140697D-04,               1.D+00/ROTD-333
      DATA FF(587),FF(588) / 4.16890700467236D-01, 2.38053374687832D-01/ROTD-334
      DATA FF(589),FF(590) /-2.82554557772787D-01, 5.03833139973589D-01/ROTD-335
      DATA FF(591),FF(592) / 7.90217156752737D-02,-3.59733444374334D-01/ROTD-336
      DATA FF(593),FF(594) / 2.89718584757935D-01, 3.03418532856755D-01/ROTD-337
      DATA FF(595),FF(596) / 2.79017946123459D-02, 7.08378251175649D-02/ROTD-338
      DATA FF(597),FF(598) /-1.72370094784044D-01, 4.12885596178737D-01/ROTD-339
      DATA FF(599),FF(600) / 1.55306184423031D-01, 1.01200845906307D-02/ROTD-340
      DATA FF(601),FF(602) /               1.D+00, 8.31092995327642D-02/ROTD-341
      DATA FF(603),FF(604) / 3.74319061007963D-01,-4.21630141495484D-01/ROTD-342
      DATA FF(605),FF(606) / 4.15874017677357D-01, 1.95380697242947D-01/ROTD-343
      DATA FF(607),FF(608) / 1.11600329703613D-01,-1.97772479536753D-01/ROTD-344
      DATA FF(609),FF(610) / 4.29387782672098D-01, 1.08476318674788D-01/ROTD-345
      DATA FF(611),FF(612) / 2.63594691134320D-01,-2.34078763472890D-01/ROTD-346
      DATA FF(613),FF(614) / 7.77527093709932D-02, 3.57086142014797D-01/ROTD-347
      DATA FF(615),FF(616) / 6.18663570444226D-02,               1.D+00/ROTD-348
      DATA FF(617),FF(618) /-2.17617351394050D-01, 4.97090202145758D-01/ROTD-349
      DATA FF(619),FF(620) /-1.75906698838214D-01, 1.01968005344553D-01/ROTD-350
      DATA FF(621),FF(622) / 3.44562631700107D-01, 3.21522932835539D-01/ROTD-351
      DATA FF(623),FF(624) /-3.16879195937032D-01, 2.47505734203973D-01/ROTD-352
      DATA FF(625),FF(626) / 2.54047379389696D-01,-2.23915517573357D-01/ROTD-353
      DATA FF(627),FF(628) / 2.47297362843729D-01,-3.04922989721535D-01/ROTD-354
      DATA FF(629),FF(630) / 3.15711860946547D-01, 1.92409975848431D-01/ROTD-355
      DATA FF(631),FF(632) /               1.D+00,-4.25726650926814D-01/ROTD-356
      DATA FF(633),FF(634) / 5.82050467909641D-01, 2.00043214171989D-01/ROTD-357
      DATA FF(635),FF(636) /-2.45486828370620D-01, 4.72409970427464D-01/ROTD-358
      DATA FF(637),FF(638) /-3.40709996864496D-02, 5.77157388195865D-02/ROTD-359
      DATA FF(639),FF(640) /-1.44294709220167D-01, 4.07841145692130D-01/ROTD-360
      DATA FF(641),FF(642) /-9.23304365056544D-02, 7.92778608560820D-02/ROTD-361
      DATA FF(643),FF(644) /-3.36435261948797D-02,-7.14935648162744D-02/ROTD-362
      DATA FF(645),FF(646) / 3.61684038642514D-01,               1.D+00/ROTD-363
      DATA FF(647),FF(648) /              -5.D-01, 6.12372435695795D-01/ROTD-364
      DATA FF(649),FF(650) /             3.75D-01,-3.95284707521047D-01/ROTD-365
      DATA FF(651),FF(652) / 5.22912516583797D-01,           -3.125D-01/ROTD-366
      DATA FF(653),FF(654) / 3.20217211436237D-01,-3.50780380010057D-01/ROTD-367
      DATA FF(655),FF(656) / 4.74958879799083D-01,         2.734375D-01/ROTD-368
      DATA FF(657),FF(658) /-2.77316239832795D-01, 2.90851726077911D-01/ROTD-369
      DATA FF(659),FF(660) /-3.23629924643875D-01, 4.43148525027868D-01/ROTD-370
      DATA NL/0,2,2,4,4,4,6,6,6,6,8,8,8,8,8,10,10,10,10,10,10,12,12,12,1ROTD-371
     12,12,12,12,14,14,14,14,14,14,14,14/                               ROTD-372
      DATA NK/0,0,2,0,2,4,0,2,4,6,0,2,4,6,8,0,2,4,6,8,10,0,2,4,6,8,10,12ROTD-373
     1,0,2,4,6,8,10,12,14/                                              ROTD-374
      DATA PI /3.1415926535897932D0/                                    ROTD-375
      DD(1)=0.D0                                                        ROTD-376
      DD(2)=0.D0                                                        ROTD-377
      IF (LO(1)) GO TO 4                                                ROTD-378
      IDT=1                                                             ROTD-379
      DO 2 J=1,8                                                        ROTD-380
      IF (LQ(J,1)) GO TO 2                                              ROTD-381
      IF (LQ(J,3)) GO TO 1                                              ROTD-382
      P(J,1)=0.D0                                                       ROTD-383
      Q(J,1)=-VAL(2,J)                                                  ROTD-384
      P(J+8,1)=1.D-16                                                   ROTD-385
      IF (LQ(J,4)) GO TO 2                                              ROTD-386
      Q(J,1)=VAL(2,J)                                                   ROTD-387
      IF (Q(J,1).GT.-36.D0*VAL(3,J)) P(J+8,1)=DEXP(Q(J,1)/VAL(3,J))     ROTD-388
      GO TO 2                                                           ROTD-389
    1 P(J,1)=VAL(2,J)                                                   ROTD-390
      DD(J-6)=P(J,1)**3                                                 ROTD-391
    2 CONTINUE                                                          ROTD-392
      DO 3 I=1,IQ1                                                      ROTD-393
    3 P(I+27,1)=1.D0                                                    ROTD-394
      RETURN                                                            ROTD-395
    4 IF (LO(3)) GO TO 18                                               ROTD-396
C *** SYMMETRIC ROTATIONAL MODEL ***************                        ROTD-397
      IDT=10                                                            ROTD-398
      IQ=IQM                                                            ROTD-399
      IF (INVZ.NE.0) IQ=MAX0(IQ,IMAX)                                   ROTD-400
      IQ2=IQM/2                                                         ROTD-401
      SR=1.D0                                                           ROTD-402
      DO 6 J=1,8                                                        ROTD-403
      IF (LQ(J,1)) GO TO 6                                              ROTD-404
      IF (LO(6)) SR=1.D0/VAL(2,J)                                       ROTD-405
      IF (.NOT.LQ(J,4)) SR=DABS(SR)                                     ROTD-406
      DO 5 I=1,IQ2                                                      ROTD-407
    5 P(16+J,2*I)=SR*BETA(J,I)*DSQRT(DFLOAT(4*I+1)/(4.D0*PI))           ROTD-408
    6 CONTINUE                                                          ROTD-409
      DO 17 I=1,10                                                      ROTD-410
      PP(2)=XGN(I)                                                      ROTD-411
      PP(1)=1.D0                                                        ROTD-412
      DO 7 J=2,IQ                                                       ROTD-413
      C=1.D0/DFLOAT(J)                                                  ROTD-414
    7 PP(J+1)=(2.D0-C)*PP(2)*PP(J)+(C-1.D0)*PP(J-1)                     ROTD-415
      C1=1.D0-PP(2)**2                                                  ROTD-416
      DO 11 J=1,8                                                       ROTD-417
      IF (LQ(J,1)) GO TO 11                                             ROTD-418
      P(J,I)=0.D0                                                       ROTD-419
      Q(J,I+12)=0.D0                                                    ROTD-420
      Q(J,I+24)=0.D0                                                    ROTD-421
      Q(J,I)=1.D0                                                       ROTD-422
      DO 8 K=2,IQM,2                                                    ROTD-423
      C=K                                                               ROTD-424
      Q(J,I)=Q(J,I)+P(16+J,K)*PP(K+1)                                   ROTD-425
      Q(J,I+12)=Q(J,I+12)-C*P(16+J,K)*(PP(2)*PP(K+1)-PP(K))/C1          ROTD-426
    8 Q(J,I+24)=Q(J,I+24)-P(16+J,K)*PP(K+1)*C*(C+1.D0)                  ROTD-427
      C2=VAL(2,J)                                                       ROTD-428
      IF (.NOT.LQ(J,4)) C2=-C2                                          ROTD-429
      DO 9 K=1,3                                                        ROTD-430
    9 Q(J,I+12*K-12)=-Q(J,I+12*K-12)*C2                                 ROTD-431
      IF (LQ(J,3)) GO TO 10                                             ROTD-432
      P(J+8,I)=1.D-16                                                   ROTD-433
      IF (LQ(J,4)) GO TO 11                                             ROTD-434
      IF (Q(J,I).GT.-36.D0*VAL(3,J)) P(J+8,I)=DEXP(Q(J,I)/VAL(3,J))     ROTD-435
      GO TO 11                                                          ROTD-436
   10 P(J,I)=-Q(J,I)                                                    ROTD-437
      DD(J-6)=DD(J-6)+PGN(I)*(P(J,I)**3)                                ROTD-438
   11 CONTINUE                                                          ROTD-439
      DO 16 IJ=1,IQ1                                                    ROTD-440
      K=1                                                               ROTD-441
      IF (IJ.GT.INY) K=IVY(1,IJ-INY)/1000                               ROTD-442
      C=PP(K)                                                           ROTD-443
      IF ((IV(IJ).EQ.1).OR.(IJ.LE.INY)) GO TO 16                        ROTD-444
      KB=MOD(IVY(1,IJ-INY),1000)                                        ROTD-445
      KL=NBETA(17,KB)                                                   ROTD-446
      KK=NBETA(18,KB)                                                   ROTD-447
      IF (IVY(6,IJ-INY).LT.0) KL=MOD(KL,2)                              ROTD-448
      IF (KK.NE.0) GO TO 12                                             ROTD-449
      C=C*PP(KL+1)*DSQRT(DFLOAT(2*KL+1))                                ROTD-450
      GO TO 16                                                          ROTD-451
C COMPUTATION OF Y(K-1,KK) * Y(KL,KK)                                   ROTD-452
   12 C=DSQRT(2.D0*KL+1.D0)                                             ROTD-453
      DO 13 KB=1,KK                                                     ROTD-454
   13 C=C*C1*DFLOAT(2*KB-1)**2/DSQRT(DFLOAT((KL+KB)*(K-KB)*(KL-KB+1)*(K+ROTD-455
     1KB-1)))                                                           ROTD-456
      KZ=K-1-KK                                                         ROTD-457
      DO 15 J=1,2                                                       ROTD-458
      IF (KZ.LE.0) GO TO 15                                             ROTD-459
      D=0.D0                                                            ROTD-460
      DO 14 KB=1,KZ                                                     ROTD-461
      C2=D                                                              ROTD-462
      D=C                                                               ROTD-463
   14 C=C2+(D*PP(2)-C2)*DFLOAT(2*(KK+KB)-1)/DFLOAT(KB)                  ROTD-464
   15 KZ=KL-KK                                                          ROTD-465
   16 P(IJ+27,I)=PGN(I)*C*DSQRT(DFLOAT(2*K-1))                          ROTD-466
   17 CONTINUE                                                          ROTD-467
      RETURN                                                            ROTD-468
C *** ASYMMETRIC ROTATIONAL MODEL ***************                       ROTD-469
   18 IDT=36                                                            ROTD-470
      DO 21 J=1,8                                                       ROTD-471
      DO 20 I=1,IQM                                                     ROTD-472
      IF (NK(I+1).EQ.0) GO TO 19                                        ROTD-473
      P(16+J,I+1)=P(16+J,I)*DSIN(PI*BETA(J,I)/180.D0)                   ROTD-474
      P(16+J,I)=P(16+J,I)*DCOS(PI*BETA(J,I)/180.D0)                     ROTD-475
      GO TO 20                                                          ROTD-476
   19 P(16+J,I+1)=BETA(J,I)*DSQRT(DFLOAT(2*NL(I+1)+1)/(4.D0*PI))        ROTD-477
   20 CONTINUE                                                          ROTD-478
   21 CONTINUE                                                          ROTD-479
      SR=1.D0                                                           ROTD-480
      DO 23 J=1,8                                                       ROTD-481
      IF (LQ(J,1)) GO TO 23                                             ROTD-482
      IF (LO(6)) SR=1.D0/VAL(2,J)                                       ROTD-483
      IF (.NOT.LQ(J,4)) SR=DABS(SR)                                     ROTD-484
      DO 22 I=1,IQM                                                     ROTD-485
      IF (NK(I+1).NE.0) P(16+J,I+1)=P(16+J,I+1)*1.414213562D0           ROTD-486
   22 P(16+J,I+1)=SR*P(16+J,I+1)                                        ROTD-487
   23 CONTINUE                                                          ROTD-488
      I=0                                                               ROTD-489
      DO 29 L=1,8                                                       ROTD-490
      PHI=PI/DFLOAT(4*MAX0(1,L-1))                                      ROTD-491
      DO 28 M=1,L                                                       ROTD-492
      I=I+1                                                             ROTD-493
      DO 24 J=1,IQ1                                                     ROTD-494
      K=1                                                               ROTD-495
      IF (J.GT.INY) K=IVY(1,J-INY)/1000                                 ROTD-496
   24 P(J+27,I)=POIDS(I,K)                                              ROTD-497
      DO 27 J=1,8                                                       ROTD-498
      IF (LQ(J,1)) GO TO 27                                             ROTD-499
      P(J,I)=0.D0                                                       ROTD-500
      R=1.D0                                                            ROTD-501
      DO 25 K=1,IQM                                                     ROTD-502
   25 R=R+P(16+J,K+1)*RB(K+1,L)*DCOS(DFLOAT(NK(K+1)*NK(I))*PHI)         ROTD-503
      Q(J,I)=-R*VAL(2,J)                                                ROTD-504
      IF (LQ(J,3)) GO TO 26                                             ROTD-505
      P(J+8,I)=1.D-16                                                   ROTD-506
      IF (LQ(J,4)) GO TO 27                                             ROTD-507
      Q(J,I)=-Q(J,I)                                                    ROTD-508
      IF (Q(J,I).GT.-36.D0*VAL(3,J)) P(J+8,I)=DEXP(Q(J,I)/VAL(3,J))     ROTD-509
      GO TO 27                                                          ROTD-510
   26 P(J,I)=R*DABS(VAL(2,J))                                           ROTD-511
      DD(J-6)=DD(J-6)+POIDS(I,1)*(P(J,I)**3)                            ROTD-512
   27 CONTINUE                                                          ROTD-513
   28 CONTINUE                                                          ROTD-514
   29 CONTINUE                                                          ROTD-515
      RETURN                                                            ROTD-516
      END                                                               ROTD-517
C 29/10/06                                                      ECIS06  ROTZ-000
      SUBROUTINE ROTZ(VR,XGN,WV,R,Q,VAL,J,IV,B,P,ID1,IQ1,LO)            ROTZ-001
C DEFORMATION OF THE SCHROEDINGER EQUATION WHICH IS EQUIVALENT TO THE   ROTZ-002
C DIRAC EQUATION ONLY FOR ELASTIC SCATTERING:                           ROTZ-003
C     NO ASYMMETRIC ROTATIONAL MODEL,                                   ROTZ-004
C     NO DIFFUSENESS OF COULOMB CHARGE AND NO COULOMB DEFORMATION,      ROTZ-005
C     NO VIBRATIONAL BAND IN ROTATIONAL MODEL,                          ROTZ-006
C     ONLY FIRST ORDER VIBRATIONAL MODEL.                               ROTZ-007
C INPUT:     VR(I,J): POTENTIAL FOR I=1, -1RST DERIVATIVE FOR I=5       ROTZ-008
C                     AND SECOND DERIVATIVE FOR I=6.                    ROTZ-009
C            XGN:     ABSCISSAE FOR LEGENDRE INTEGRATION.               ROTZ-010
C            WV:      MASS IN WV(6), ENERGY IN WV(7).                   ROTZ-011
C            R:       RADIUS.                                           ROTZ-012
C            Q(I,J,K):DERIVATIVES DR/DTHETA FOR K=2 AND 3.              ROTZ-013
C            VAL:     OPTICAL MODEL.                                    ROTZ-014
C            J:       POINT OF LEGENDRE ANGULAR INTEGRAL.               ROTZ-015
C            IV:      NUMBER OF PHONONS PLUS ONE.                       ROTZ-016
C            B:       DEFORMATIONS.                                     ROTZ-017
C            P(I,J):  PREVIOUS RESULTS FOR I=17 TO 26 AND WEIGHTS       ROTZ-018
C                     FOR I=28 AND UP IN THE ROTATIONAL MODEL.          ROTZ-019
C            ID1:     FIRST DIMENSION OF P.                             ROTZ-020
C            IQ1:     NUMBER OF TRANSITION FORM FACTORS PLUS 3.         ROTZ-021
C            LO(I):   LOGICAL CONTROLS:                                 ROTZ-022
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).ROTZ-023
C OUTPUT:    P(I,J)   FOR I=17 TO 26, POTENTIAL FOR J=1 AND             ROTZ-024
C                     TRANSITION FORM FACTORS FOR J=4 TO IQ1.           ROTZ-025
C                                                                       ROTZ-026
C FOR THE COMMON  /DCONS/ SEE CALC.                                     ROTZ-027
C                                                                       ROTZ-028
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     ROTZ-029
C  CCZ:       COULOMB ALPHA CONSTANT.                                   ROTZ-030
C   USED:     CCZ.                                                      ROTZ-031
C                                                                       ROTZ-032
C***********************************************************************ROTZ-033
      IMPLICIT REAL*8 (A-H,O-Z)                                         ROTZ-034
      LOGICAL LO(150)                                                   ROTZ-035
      DIMENSION VR(6,10),XGN(10),WV(22),Q(8,12,*),VAL(32),IV(*),B(10,*),ROTZ-036
     1P(ID1,*)                                                          ROTZ-037
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            ROTZ-038
      COMMON /INOUT/ MR,MW,MS                                           ROTZ-039
      XP=CHB**2/(2.D0*WV(6))                                            ROTZ-040
      DO 2 I=7,8                                                        ROTZ-041
      IF (R.GT.VAL(4*I-2)) GO TO 1                                      ROTZ-042
      VR(1,I)=CCZ*VAL(4*I-3)*(1.5D0-.5D0*(R*R)/VAL(4*I-2)**2)/VAL(4*I-2)ROTZ-043
      VR(6,I)=-CCZ*VAL(4*I-3)/VAL(4*I-2)**3                             ROTZ-044
      VR(5,I)=-VR(6,I)*R                                                ROTZ-045
      GO TO 2                                                           ROTZ-046
    1 VR(1,I)=CCZ*VAL(3*I-2)/R                                          ROTZ-047
      VR(5,I)=VR(1,I)/R                                                 ROTZ-048
      VR(6,I)=2.D0*VR(5,I)/R                                            ROTZ-049
    2 CONTINUE                                                          ROTZ-050
C COMPUTATION OF D(R) AND INVERSE                                       ROTZ-051
      C1=WV(7)+WV(6)+VR(1,1)-VR(1,3)-VR(1,7)                            ROTZ-052
      C2=VR(1,2)-VR(1,4)                                                ROTZ-053
      DD=C1**2+C2**2                                                    ROTZ-054
      DR=C1/DD                                                          ROTZ-055
      DI=-C2/DD                                                         ROTZ-056
      C3=WV(7)-WV(6)-VR(1,1)-VR(1,3)-VR(1,7)                            ROTZ-057
      C4=-VR(1,2)-VR(1,4)                                               ROTZ-058
      C5=(C1*C3-C2*C4-WV(7)**2+WV(6)**2)/(2.D0*WV(6))                   ROTZ-059
      C6=(C1*C4+C2*C3)/(2.D0*WV(6))                                     ROTZ-060
      D1=VR(5,3)-VR(5,1)+VR(5,7)                                        ROTZ-061
      D2=VR(5,4)-VR(5,2)                                                ROTZ-062
      CR=D1*DR-D2*DI+(VR(5,5)+VR(5,8))/WV(6)                            ROTZ-063
      CI=D2*DR+D1*DI+VR(5,6)/WV(6)                                      ROTZ-064
      CC=VR(1,7)*WV(7)/WV(6)                                            ROTZ-065
      BR=VR(6,1)-VR(6,7)-VR(6,3)                                        ROTZ-066
      BI=VR(6,2)-VR(6,4)                                                ROTZ-067
C SQUARE OF GRADIENT  AND LAPLACIAN     RADIAL TERM.                    ROTZ-068
      ER=BR*DR-BI*DI+(VR(5,5)+VR(5,8))/WV(6)*(CR+CR-(VR(5,5)+VR(5,8))/WVROTZ-069
     1(8))-VR(5,6)/WV(6)*(CI+CI-VR(5,6)/WV(6))-(VR(6,5)+VR(6,8))/WV(6)+2ROTZ-070
     2.D0*CR/R                                                          ROTZ-071
      EI=BR*DI+BI*DR+(VR(5,5)+VR(5,8))/WV(6)*(CI+CI-VR(5,6)/WV(6))+VR(5,ROTZ-072
     16)/WV(6)*(CR+CR-(VR(5,5)+VR(5,8))/WV(6))-VR(6,6)/WV(6)+2.D0*CI/R  ROTZ-073
      C5=C5-(.75D0*(CR**2-CI**2)-.5D0*ER)*XP                            ROTZ-074
      C6=C6-(1.5D0*CR*CI-.5D0*EI)*XP                                    ROTZ-075
      IF (.NOT.LO(1)) GO TO 5                                           ROTZ-076
C ROTATIONAL MODEL.                                                     ROTZ-077
      C=1.D0-XGN(J)**2                                                  ROTZ-078
      DO 3 I=1,8                                                        ROTZ-079
      VR(4,I)=(VR(6,I)*Q(I,J,2)**2*C+VR(5,I)*Q(I,J,3))/R**2             ROTZ-080
    3 VR(3,I)=VR(5,I)*Q(I,J,2)/R                                        ROTZ-081
C SQUARE OF GRADIENT IS D/DR.D/DR + 1/R**2 D/DTH.D/DTH.                 ROTZ-082
      C3=VR(3,1)-VR(3,3)-VR(3,7)                                        ROTZ-083
      C4=VR(3,2)-VR(3,4)                                                ROTZ-084
      C7=C3*DR-C4*DI                                                    ROTZ-085
      C8=C3*DI+C4*DR                                                    ROTZ-086
      C3=(VR(3,5)+VR(3,8))/WV(6)                                        ROTZ-087
      C4=VR(3,6)/WV(6)                                                  ROTZ-088
      C5=C5-(.75D0*(C7**2-C8**2)+.5D0*(C7*C3-C8*C4)+.75D0*(C3**2-C4**2))ROTZ-089
     1*C*XP                                                             ROTZ-090
      C6=C6-(1.5D0*C7*C8+.5D0*(C7*C4+C8*C3)+1.5D0*C3*C4)*C*XP           ROTZ-091
C LAPLACIAN IS D**2/DR**2 + 2/R D/DR + 1/R**2 (D**2/DTH**2+D/DTH/TG ).  ROTZ-092
      C3=VR(4,1)-VR(4,3)-VR(4,7)                                        ROTZ-093
      C4=VR(4,2)-VR(4,4)                                                ROTZ-094
      C5=C5+.5D0*(C3*DR-C4*DI+(VR(4,5)+VR(4,8))/WV(6))*XP               ROTZ-095
      C6=C6+.5D0*(C4*DR+C3*DI+VR(4,6)/WV(6))*XP                         ROTZ-096
C C5 + I C6   CENTRAL TERM,                                             ROTZ-097
C CR + I CI   SPIN-ORBIT TERM,                                          ROTZ-098
C DR + I DI   1/DENOMINATOR.                                            ROTZ-099
      P(17,1)=P(17,1)+(C5+CC)*P(28,J)                                   ROTZ-100
      P(18,1)=P(18,1)+C6*P(28,J)                                        ROTZ-101
      P(21,1)=P(21,1)+.5D0*XP*(CR-VR(5,8)/WV(6))*P(28,J)/R              ROTZ-102
      P(22,1)=P(22,1)+.5D0*XP*CI*P(28,J)/R                              ROTZ-103
      P(23,1)=P(23,1)+CC*P(28,J)                                        ROTZ-104
      P(24,1)=P(24,1)+VR(5,8)/R*P(28,J)                                 ROTZ-105
      IF (IQ1.LT.4) RETURN                                              ROTZ-106
C LOGARITHM OF D(R) C9 + I C0.                                          ROTZ-107
      C9=.5D0*DLOG(C1**2+C2**2)-(VR(1,5)+VR(1,8))/WV(6)                 ROTZ-108
      C0=DATAN2(C2,C1)-VR(1,6)/WV(6)                                    ROTZ-109
      DO 4 I=4,IQ1                                                      ROTZ-110
      IF (IV(I).GT.1) GO TO 7                                           ROTZ-111
      P(17,I)=P(17,I)+(C5+CC)*P(I+27,J)                                 ROTZ-112
      P(18,I)=P(18,I)+C6*P(I+27,J)                                      ROTZ-113
      P(21,I)=P(21,I)+.5D0*XP*(CR-VR(5,8)/WV(6))*P(I+27,J)/R            ROTZ-114
      P(22,I)=P(22,I)+.5D0*XP*CI*P(I+27,J)/R                            ROTZ-115
      P(23,I)=P(23,1)+CC*P(I+27,J)                                      ROTZ-116
      P(24,I)=P(24,1)+VR(5,8)/R*P(I+27,J)                               ROTZ-117
      P(25,I)=P(25,I)-.5D0*XP*C9*P(I+27,J)/R**2                         ROTZ-118
    4 P(26,I)=P(26,I)-.5D0*XP*C0*P(I+27,J)/R**2                         ROTZ-119
      RETURN                                                            ROTZ-120
C COMPUTATION OF ZEROTH ORDER.                                          ROTZ-121
    5 P(17,1)=C5+CC                                                     ROTZ-122
      P(18,1)=C6                                                        ROTZ-123
      P(21,1)=.5D0*(CR-VR(5,8)/WV(6))*XP/R                              ROTZ-124
      P(22,1)=.5D0*CI*XP/R                                              ROTZ-125
      P(23,1)=CC                                                        ROTZ-126
      P(24,1)=VR(5,8)/R                                                 ROTZ-127
      IF (IQ1.LT.4) RETURN                                              ROTZ-128
      DO 6 I=4,IQ1                                                      ROTZ-129
C COMPUTATION OF FIRST ORDER.                                           ROTZ-130
      IF (IV(I).NE.2) GO TO 8                                           ROTZ-131
      C1R=VR(5,1)*B(1,I)-VR(5,3)*B(3,I)                                 ROTZ-132
      C2R=VR(5,2)*B(2,I)-VR(5,4)*B(4,I)                                 ROTZ-133
      DRR=-(DR*DR-DI*DI)*C1R+2.D0*DR*DI*C2R                             ROTZ-134
      DIR=-(DR*DR-DI*DI)*C2R-2.D0*DR*DI*C1R                             ROTZ-135
      C3R=-VR(5,1)*B(1,I)-VR(5,3)*B(3,I)                                ROTZ-136
      C4R=-VR(5,2)*B(2,I)-VR(5,4)*B(4,I)                                ROTZ-137
      C5R=(C1R*C3-C2R*C4+C1*C3R-C2*C4R)/(2.D0*WV(6))                    ROTZ-138
      C6R=(C1R*C4+C2R*C3+C1*C4R+C2*C3R)/(2.D0*WV(6))                    ROTZ-139
      D1R=VR(6,3)*B(3,I)-VR(6,1)*B(1,I)                                 ROTZ-140
      D2R=VR(6,4)*B(4,I)-VR(6,2)*B(2,I)                                 ROTZ-141
      CRR=D1R*DR-D2R*DI+D1*DRR-D2*DIR+VR(6,5)*B(5,I)/WV(6)              ROTZ-142
      CIR=D2R*DR+D1R*DI+D2*DRR+D1*DIR+VR(6,6)*B(6,I)/WV(6)              ROTZ-143
      AR=BR*DRR-BI*DIR+(VR(5,5)+VR(5,8))/WV(6)*(CRR+CRR-VR(6,5)*B(5,I)/WROTZ-144
     1V(8))-VR(5,6)/WV(6)*(CIR+CIR-VR(6,6)*B(6,I)/WV(6))+VR(6,5)*B(5,I)/ROTZ-145
     2WV(6)*(CR+CR-(VR(5,5)+VR(5,8))/WV(6))-VR(6,6)*B(6,I)/WV(6)*(CI+CI-ROTZ-146
     3VR(5,6)/WV(6))+2.D0*CRR/R                                         ROTZ-147
      AI=BR*DIR+BI*DRR+(VR(5,5)+VR(5,8))/WV(6)*(CIR+CIR-VR(6,6)*B(6,I)/WROTZ-148
     1V(8))+VR(5,6)/WV(6)*(CRR+CRR-VR(6,5)*B(5,I)/WV(6))+VR(6,5)*B(5,I)/ROTZ-149
     2WV(6)*(CI+CI-VR(5,6)/WV(6))+VR(6,6)*B(6,I)/WV(6)*(CR+CR-VR(6,5)/WVROTZ-150
     3(8))+2.D0*CIR/R                                                   ROTZ-151
      P(17,I)=C5R-(1.5D0*(CR*CRR-CI*CIR)-.5D0*AR)*XP                    ROTZ-152
      P(18,I)=C6R-(1.5D0*(CRR*CI+CR*CIR)-.5D0*AI)*XP                    ROTZ-153
      P(21,I)=.5D0*CRR*XP/R                                             ROTZ-154
      P(22,I)=.5D0*CIR*XP/R                                             ROTZ-155
      P(23,I)=0.D0                                                      ROTZ-156
      P(24,I)=0.D0                                                      ROTZ-157
      P(25,I)=-.5D0*XP*(C1R*DR-C2R*DI-VR(5,5)*B(5,I)/WV(6))/R**2        ROTZ-158
    6 P(26,I)=-.5D0*XP*(C1R*DI+C2R*DR-VR(5,6)*B(6,I)/WV(6))/R**2        ROTZ-159
      RETURN                                                            ROTZ-160
    7 WRITE (MW,1000)                                                   ROTZ-161
      GO TO 9                                                           ROTZ-162
    8 WRITE (MW,1001)                                                   ROTZ-163
    9 WRITE (MW,1002)                                                   ROTZ-164
      STOP                                                              ROTZ-165
 1000 FORMAT (' NO VIBRATIONAL BAND IN ROTATIONAL MODEL.')              ROTZ-166
 1001 FORMAT (' ONLY FIRST ORDER VIBRATIONAL MODEL.')                   ROTZ-167
 1002 FORMAT (//' IN ROTZ  ...  STOP  ...')                             ROTZ-168
      END                                                               ROTZ-169


C 15/11/06                                                      ECIS06  WOSA-000
C     SUBROUTINE WOSA(V,A,P,CC,R,N,LX)                                  WOSA-001

      SUBROUTINE WOSA(VRR,A,P,CC,R,N,LX)                                RCN



C COMPUTATION OF WOODS-SAXON FORM-FACTORS AT SOME POWER AND THEIR       WOSA-002
C DERIVATIVES.                                                          WOSA-003
C LIMITED TO THE SIXTH DERIVATIVE (THE FOURTH ONE ONLY IS USED IN ECIS).WOSA-004
C INPUT:     A:       DIFFUSENESS.                                      WOSA-005
C            P:       THE WOOD-SAXON PARAMETERS ARE AT THE POWER (1+P). WOSA-006
C            CC:      VALUE OF EXP(-(R-RR/A) WHERE R IS THE RADIUS.     WOSA-007
C            R:       VALUE OF RADIUS OF THE FORM FACTOR.               WOSA-008
C            N:       NUMBER OF VALUES (ONE PLUS HIGHEST DERIVATIVE).   WOSA-009
C            LX:      LOGICAL FALSE FOR SYMMETRISED FORM-FACTORS.       WOSA-010
C OUTPUT:    V:       FORM-FACTORS AND ITS DERIVATIVES.                 WOSA-011
C***********************************************************************WOSA-012
      IMPLICIT REAL*8 (A-H,O-Z)                                         WOSA-013
      LOGICAL LX                                                        WOSA-014
      DIMENSION V(7),VV(7,2),VRR(*)                                     WOSA-015
      COMMON /INOUT/ MR,MW,MS                                           WOSA-016
      IF (N.GT.7) GO TO 6                                               WOSA-017
      C=CC                                                              WOSA-018
      K=1                                                               WOSA-019
C FORM-FACTOR AND ITS DERIVATIVES.                                      WOSA-020
    1 B=1.D0/(1.D0+C)                                                   WOSA-021
      V(1)=B**(P+1.D0)                                                  WOSA-022
      IF (N.EQ.1) GO TO 2                                               WOSA-023
      V(2)=B*(P+1.D0)*C*V(1)/A                                          WOSA-024
      IF (N.EQ.2) GO TO 2                                               WOSA-025
      V(3)=B*(P*C+C-1.D0)*V(2)/A                                        WOSA-026
      IF (N.EQ.3) GO TO 2                                               WOSA-027
      V(4)=B*((P*C+C-2.D0)*V(3)-V(2)/A)/A                               WOSA-028
      IF (N.EQ.4) GO TO 2                                               WOSA-029
      V(5)=B*((P*C+2.D0*C-2.D0)*V(4)-(P*C+C+1.D0)*V(3)/A)/A             WOSA-030
      IF (N.EQ.5) GO TO 2                                               WOSA-031
      V(6)=B*((P*C+2.D0*C-3.D0)*V(5)-((P*C+C+3.D0)*V(4)+V(3)/A)/A)/A    WOSA-032
      IF (N.EQ.6) GO TO 2                                               WOSA-033
      V(7)=B*((P*C+3.D0*C-3.D0)*V(6)-((2.D0*P*C+3.D0*C+3.D0)*V(5)-(P*C+CWOSA-034
     1-1.D0)*V(4)/A)/A)/A                                               WOSA-035



    2 DO 21L=1,N                                                        RCN
      VRR(L)=V(L)                                                       RCN   
   21 CONTINUE                                                          RCN

      IF (LX) RETURN                                                    WOSA-036
C STORAGE OF INTERMEDIATE RESULTS FOR SYMMETRISATION.                   WOSA-037
      DO 3 I=1,N                                                        WOSA-038
    3 VV(I,K)=V(I)                                                      WOSA-039
      C=DEXP(-2.D0*DABS(R)/A)/C                                         WOSA-040
      K=K+1                                                             WOSA-041
      IF (K.EQ.2) GO TO 1                                               WOSA-042
C SYMMETRISATION.                                                       WOSA-043
      DO 5 L=1,7                                                        WOSA-044
      V(L)=VV(L,1)*VV(1,2)                                              WOSA-045
      IF (L.EQ.1) GO TO 5                                               WOSA-046
      A1=1.D0                                                           WOSA-047
      DO 4 J=2,L                                                        WOSA-048
      A1=-A1*DFLOAT(L-J+1)/DFLOAT(J-1)                                  WOSA-049
    4 V(L)=V(L)+A1*VV(L-J+1,1)*VV(J,2)                                  WOSA-050
    5 CONTINUE                                                          WOSA-051

      DO 51 L=1,7                                                       RCN
      VRR(L)=V(L)                                                       RCN   
   51 CONTINUE                                                          RCN

      RETURN                                                            WOSA-052
    6 WRITE (MW,1000) N                                                 WOSA-053
      STOP                                                              WOSA-054
 1000 FORMAT (5X,I5,' VALUES ASKED IN SUBROUTINE WOSA TOO LARGE (LIMITATWOSA-055
     1ION TO 7.'///' IN WOSA  ...  STOP  ...')                          WOSA-056
      END                                                               WOSA-057
C 27/06/06                                                      ECIS06  COPO-000
      SUBROUTINE COPO(W,V,Q,ISM,H,L,VAL,VAC,CCZ,ZT,LT,LZ)               COPO-001
C COMPUTES THE COULOMB POTENTIAL OF THE CHARGE DISTRIBUTION STORED IN V.COPO-002
C INPUT:     V:       CHARGE DISTRIBUTION UNNORMALISED.                 COPO-003
C            H:       STEP SIZE.                                        COPO-004
C            ISM:     NUMBER OF POINTS.                                 COPO-005
C            L:       ANGULAR MOMENTUM, RETURN 0 IF L IS NEGATIVE.      COPO-006
C            VAL:     PRODUCT OF CHARGES IS IN VAL(1).                  COPO-007
C            VAC:     PARAMETER OF CHARGE DISTRIBUTION.                 COPO-008
C            LT:      LOGICAL  .TRUE.  FORM FACTOR ALREADY NORMALISED   COPO-009
C                    .FALSE.  NORMALISATION STORED FROM THE CENTRAL.    COPO-010
C            LZ:      LOGICAL  .TRUE. TO USE THE NORMALISATION STORED   COPO-011
C                     EVEN IF L=0.                                      COPO-012
C OUTPUT:    W:       FORM FACTOR WHICH CAN BE AT THE SAME PLACE AS V.  COPO-013
C            ZT:      NORMALISATION FACTOR.                             COPO-014
C WORKING AREA:                                                         COPO-015
C            Q:       WHICH CAN BE AT THE SAME PLACE AS W.              COPO-016
C***********************************************************************COPO-017
      IMPLICIT REAL*8 (A-H,O-Z)                                         COPO-018
      DIMENSION W(*),V(*),Q(ISM,5)                                      COPO-019


C     DIMENSION W(*),V(*),Q(ISM,5),VAL(*)                               COPO-019


      LOGICAL LT,LZ                                                     COPO-020
      IF (L.GE.0) GO TO 2                                               COPO-021
      DO 1 IS=1,ISM                                                     COPO-022
    1 V(IS)=0.D0                                                        COPO-023
      RETURN                                                            COPO-024
    2 RR=0.D0                                                           COPO-025
      DO 3 IS=1,ISM                                                     COPO-026
      RR=RR+H                                                           COPO-027
      V(IS)=V(IS)*(1.D0+VAC*RR*RR)                                      COPO-028
      Q(IS,4)=RR**L                                                     COPO-029
      Q(IS,3)=Q(IS,4)/RR                                                COPO-030
      Q(IS,5)=Q(IS,4)*RR                                                COPO-031
    3 Q(IS,1)=Q(IS,5)*RR                                                COPO-032
      V(ISM)=0.D0                                                       COPO-033
      V(ISM-1)=0.D0                                                     COPO-034
      Q(1,1)=Q(1,1)*V(1)                                                COPO-035
      Q(ISM,2)=0.D0                                                     COPO-036
      DO 4 IS=2,ISM                                                     COPO-037
      JS=ISM+1-IS                                                       COPO-038
      Q(IS,1)=Q(IS-1,1)+Q(IS,1)*V(IS)                                   COPO-039
    4 Q(JS,2)=Q(JS+1,2)+V(JS+1)/Q(JS+1,3)                               COPO-040
      C=DFLOAT(2*L+1)                                                   COPO-041
      ZZ=1.D0/C                                                         COPO-042
      IF (LT) GO TO 6                                                   COPO-043
      IF (L.NE.0.OR.LZ) GO TO 5                                         COPO-044
      ZT=CCZ*VAL/Q(ISM,1)                                               COPO-045


C     ZT=CCZ*VAL(1)/Q(ISM,1)                                            COPO-045


    5 ZZ=ZT*ZZ                                                          COPO-046
    6 C=C*H/12.D0                                                       COPO-047
      DO 7 IS=1,ISM                                                     COPO-048
    7 W(IS)=(Q(IS,1)/Q(IS,5)+Q(IS,2)*Q(IS,4)+C*V(IS))*ZZ                COPO-049
      RETURN                                                            COPO-050
      END                                                               COPO-051
C 07/03/07                                                      ECIS06  STDP-000
      SUBROUTINE STDP(V,IVY,ISM,VAL,NVAL,NX,IDX,X,WV,PGN,XGN,NPP,IZZ,P,LSTDP-001
     1O)                                                                STDP-002
C COMPUTES FORM FACTORS INDEPENDENTLY OF MODELS.                        STDP-003
C INPUT:     IVY:     TABLE OF FORM FACTORS (SEE REDM).                 STDP-004
C            ISM:     NUMBER OF INTEGRATION STEPS.                      STDP-005
C            VAL,NVAL:FOR OPTICAL MODEL PARAMETERS TO USE HERE.         STDP-006
C            NX:      LENGTH OF WORKING SPACE.                          STDP-007
C            WV:      STEP SIZE IN WV(8,*).                             STDP-008
C            PGN:     WEIGHTS OF GAUSS-LEGENDRE INTEGRATION             STDP-009
C            XGN:   : ABSCISSAE OF GAUSS-LEGENDRE INTEGRATION.          STDP-010
C            NPP:     NUMBER OF OPTICAL POTENTIALS.                     STDP-011
C            ACONV:   VALUE BELOW WHICH THE FOLDING IS NEGLECTED.       STDP-012
C            LO(I):   LOGICAL CONTROLS:                                 STDP-013
C               LO(6)  =.TRUE. USE DEFORMATION LENGTHS.                 STDP-014
C               LO(9)  =.TRUE. SYMMETRISED WOODS-SAXON FORM FACTORS WHENSTDP-015
C                              THE RADIUS IS NEGATIVE.                  STDP-016
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            STDP-017
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. STDP-018
C               LO(100)=.TRUE. DIRAC EQUATION.                          STDP-019
C OUTPUT:    V:       ELASTIC AND INELASTIC FORM FACTORS IN THE SEQUENCESTDP-020
C                     CENTRAL-REAL, SPIN-ORBIT-REAL, TRANSITION REAL,   STDP-021
C                     TRANSITION SPIN-ORBIT-REAL, IMAGINARY POTENTIALS  STDP-022
C                     FOLLOWED BY COULOMB, COULOMB TRANSITION POTENTIALSSTDP-023
C            IDX:     LENGTH OF WORKING FIELD USED.                     STDP-024
C WORKING AREAS:                                                        STDP-025
C            X,P:     TO COMPUTE BOUND FUNCTIONS, FOLD COULOMB POTENTIALSTDP-026
C                     AND COMPUTE ROTATIONAL FORM FACTORS AND BESSEL    STDP-027
C                     FUNCTIONS, IN EQUIVALENCE BY CALL.                STDP-028
C            IZZ:     FOR FOLDING.                                      STDP-029
C                                                                       STDP-030
C FOR THE COMMON  /DCONS/ SEE CALC.                                     STDP-031
C FOR THE COMMON  /POTE1/ SEE REDM.                                     STDP-032
C                                                                       STDP-033
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     STDP-034
C  CCZ:       COULOMB ALPHA CONSTANT.                                   STDP-035
C   USED:     CCZ.                                                      STDP-036
C                                                                       STDP-037
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE1/:                     STDP-038
C  ITX(16):   STARTING ADDRESS OF DIFFERENT FORM FACTORS (SEE REDM).    STDP-039
C  IMAX:      MAXIMUM ANGULAR MOMENTUM.                                 STDP-040
C  INTC:      NUMBER OF FORM FACTORS WITHOUT DEFORMED SPIN-ORBIT        STDP-041
C             INCLUDING CORRECTION TERMS.                               STDP-042
C  INLS:      NUMBER OF SPIN-ORBIT FORM FACTORS NOT TAKING INTO ACCOUNT STDP-043
C             MULTIPLICATION BY 2.                                      STDP-044
C  INVD:      IDEM FOR COULOMB SPIN-ORBIT.                              STDP-045
C  ITXM:      TOTAL NUMBER OF FORM FACTORS.                             STDP-046
C   USED:     ITX,IMAX,INTC,INLS,INVD,ITXM.                             STDP-047
C                                                                       STDP-048
C***********************************************************************STDP-049
      IMPLICIT REAL*8 (A-H,O-Z)                                         STDP-050
      LOGICAL LO(150),LT(9)                                             STDP-051
      DIMENSION V(ISM,*),IVY(7,*),VAL(*),NVAL(2,*),X(3,*),WV(22,*),PGN(1STDP-052
     10),XGN(10),IZZ(4,*),P(*),NIJ(3),ITZ(10),ZB(77),ZB1(40),ZB2(37),Y(3STDP-053
     2),VR(5),CL(8)                                                     STDP-054
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       STDP-055
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            STDP-056
      COMMON /INOUT/ MR,MW,MS                                           STDP-057
      COMMON /POTE1/ ITX(16),IMAX,INTC,INLS,INVC,INVD,ITXM              STDP-058
      EQUIVALENCE (ZB1,ZB),(ZB2,ZB(41))                                 STDP-059
      DATA NIJ /1,24,11/                                                STDP-060
      DATA PIS2 /1.5707963267949D0/                                     STDP-061
      DATA ITZ /3,3,3,3,4,5,3,3,5,5/                                    STDP-062
      DATA ZB1 /4.49340945790906D0,7.72525183693771D0,5.76345919689455D0STDP-063
     1,9.09501133047635D0,12.3229409705666D0,6.98793200050052D0,10.41711STDP-064
     285473794D0,13.6980231532492D0,16.9236212852138D0,8.18256145257124DSTDP-065
     30,11.7049071545704D0,15.0396647076165D0,18.3012559595420D0,21.5254STDP-066
     4177333999D0,9.35581211104275D0,12.9665301727743D0,16.3547096393505STDP-067
     5D0,19.6531521018212D0,22.9045506479037D0,26.1277501372255D0,10.512STDP-068
     68354080940D0,14.2073924588425D0,17.6479748701659D0,20.983463068944STDP-069
     78D0,24.2627680423970D0,27.5078683649043D0,30.7303807316466D0,11.65STDP-070
     870321925164D0,15.4312892102684D0,18.9229991985461D0,22.29534801913STDP-071
     908D0,25.6028559538106D0,28.8703733470427D0,32.1111962396826D0,35.3STDP-072
     A331941827165D0,12.7907817119721D0,16.6410028815122D0,20.1824707649STDP-073
     B492D0,23.5912748179830D0,26.9270407788180D0/                      STDP-074
      DATA ZB2 /30.2172627093614D0,33.4768008195015D0,36.7145291272447D0STDP-075
     1,39.9361278108677D0,13.9158226105049D0,17.8386431992053D0,21.42848STDP-076
     269721154D0,24.8732139238751D0,28.2371343599681D0,31.5501883818318DSTDP-077
     30,34.8286965376857D0,38.0824790873276D0,41.3178646902445D0,44.5391STDP-078
     4446334095D0,15.0334693037434D0,19.0258535361278D0,22.6627206581361STDP-079
     5D0,26.1427676433791D0,29.5346341078439D0,32.8705345976875D0,36.168STDP-080
     61571359112D0,39.4382144800081D0,42.6876512846611D0,45.921201763835STDP-081
     76D0,49.1422214247461D0,16.1447429423013D0,20.2039426328117D0,23.88STDP-082
     865307559684D0,27.4012592588663D0,30.8207940864510D0,34.17947466648STDP-083
     932D0,37.4962736357858D0,40.7827470981251D0,44.0464252109438D0,47.2STDP-084
     A924656052694D0,50.5245397255712D0,53.7453428657930D0/             STDP-085
C MEANING OF INTERNAL LOGICAL LT:                                       STDP-086
C LT(1) SPIN-ORBIT TRANSITION (SCHROEDINGER),                           STDP-087
C LT(2) SPIN-ORBIT POTENTIAL DERIVATIVE,                                STDP-088
C LT(3) FORM FACTOR GIVEN BY POINTS OR BOUND STATE,                     STDP-089
C LT(4) COMPUTATION OF A COULOMB POTENTIAL FROM THE CHARGE DENSITY,     STDP-090
C LT(5) ZERO DIFFUSENESS COULOMB,                                       STDP-091
C LT(6) SURFACE POTENTIAL,                                              STDP-092
C LT(7) FIRST OR SECOND PASSAGE IN WOODS-SAXON/BESSEL LOOP,             STDP-093
C LT(8) WOODS-SAXON FORM FACTOR,                                        STDP-094
C LT(9) NOT SYMMETRIC.                                                  STDP-095
      IDX=0                                                             STDP-096
      HM=1000.D0                                                        STDP-097
      NFO=0                                                             STDP-098
      N=ITXM                                                            STDP-099
      IF (LO(100)) N=N-ITX(7)                                           STDP-100
      DO 2 I=1,N                                                        STDP-101
      DO 1 J=1,4                                                        STDP-102
    1 IZZ(J,I)=0                                                        STDP-103
    2 CONTINUE                                                          STDP-104
      IF (INTC.EQ.0) GO TO 8                                            STDP-105
      NTT=24*NPP                                                        STDP-106
      DO 7 I=1,INTC                                                     STDP-107
      IF (LO(100)) GO TO 5                                              STDP-108
      DO 3 J=9,12                                                       STDP-109
      IF ((.NOT.LO(12)).AND.(MOD(J,2).EQ.0)) GO TO 3                    STDP-110
      K=ITX(J)+I                                                        STDP-111
      IZZ(3,K)=IVY(7,I)                                                 STDP-112
    3 CONTINUE                                                          STDP-113
      K=IVY(3,I)                                                        STDP-114
      IF (K.EQ.0) GO TO 4                                               STDP-115
      IZZ(3,K+ITX(13))=IVY(7,I)                                         STDP-116
      IF (LO(14)) IZZ(3,K+ITX(10))=IVY(7,I)                             STDP-117
    4 K=IVY(4,I)                                                        STDP-118
      IF (K.NE.0) IZZ(3,K+ITX(15))=IVY(7,I)                             STDP-119
      K=IVY(5,I)                                                        STDP-120
      IF (K.NE.0) IZZ(3,K+ITX(16))=IVY(7,I)                             STDP-121
      GO TO 7                                                           STDP-122
    5 DO 6 J=1,11                                                       STDP-123
    6 IZZ(3,NTT+J)=IVY(7,I)                                             STDP-124
    7 NTT=NTT+11                                                        STDP-125
    8 NMA=NVAL(1,1)                                                     STDP-126
    9 IF (NMA.GE.NVAL(1,2)) GO TO 97                                    STDP-127
      I1=NVAL(1,NMA)                                                    STDP-128
      IV=NVAL(2,NMA)                                                    STDP-129
      ITV=MOD(I1-1,8)+1                                                 STDP-130
      J1=(I1-1)/8                                                       STDP-131
      ITT=ITV                                                           STDP-132
      LT(1)=(ITV-5)*(ITV-6)*(ITV-8).EQ.0                                STDP-133
      INL=0                                                             STDP-134
      IF (J1.GT.NPP) ITT=ITV+8                                          STDP-135
      IF (LO(100)) GO TO 10                                             STDP-136
      JI=1                                                              STDP-137
      IJ=1                                                              STDP-138
      IF (J1.GT.NPP) J1=J1-NPP                                          STDP-139
      L1=J1+ITX(ITT)                                                    STDP-140
      IF ((ITT.EQ.13).OR.(ITT.EQ.14)) INL=INLS                          STDP-141
      IF (ITT.EQ.16) INL=INVD                                           STDP-142
      IF (INL.NE.0) IJ=2                                                STDP-143
      GO TO 13                                                          STDP-144
   10 IF (J1.LE.NPP) GO TO 11                                           STDP-145
      JI=3                                                              STDP-146
      IF (LT(1)) INL=4                                                  STDP-147
      IF (ITT.EQ.16) INL=3                                              STDP-148
      L1=24*NPP+11*(J1-NPP-1)+ITV                                       STDP-149
      GO TO 12                                                          STDP-150
   11 INL=8                                                             STDP-151
      JI=2                                                              STDP-152
      L1=ITV+24*(J1-1)                                                  STDP-153
   12 IJ=1+INL/3                                                        STDP-154
   13 IF (IV.NE.16) GO TO 16                                            STDP-155
C FORM FACTOR COPIED.                                                   STDP-156
      L3=0                                                              STDP-157
      L2=L1+NIJ(JI)*(NVAL(2,NMA+1)-I1)/8                                STDP-158
      DO 15 J=1,IJ                                                      STDP-159
      DO 14 IS=1,ISM                                                    STDP-160
   14 V(IS,L1+L3)=V(IS,L2+L3)*VAL(NMA+3)                                STDP-161
   15 L3=L3+INL                                                         STDP-162
      IZZ(1,L1)=-NVAL(1,NMA+1)                                          STDP-163
      IZZ(2,L1)=IZZ(2,L2)                                               STDP-164
      IZZ(4,L1)=IZZ(4,L2)                                               STDP-165
      GO TO 96                                                          STDP-166
   16 J=MAX0(IV,1)                                                      STDP-167
      NMB=NMA+ITZ(J)                                                    STDP-168
      LT(7)=.FALSE.                                                     STDP-169
      IF (IV.GE.7) GO TO 19                                             STDP-170
      IF (VAL(NMB).NE.0.D0) GO TO 19                                    STDP-171
C ZERO FORM FACTORS AND GO TO NEXT.                                     STDP-172
      L2=L1                                                             STDP-173
      DO 18 J=1,IJ                                                      STDP-174
      DO 17 IS=1,ISM                                                    STDP-175
   17 V(IS,L2)=0.D0                                                     STDP-176
   18 L2=L2+INL                                                         STDP-177
      GO TO 96                                                          STDP-178
   19 LT(1)=LT(1).AND.(.NOT.LO(100))                                    STDP-179
      LT(2)=LT(1).AND.(ITV.EQ.ITT).AND.(NVAL(1,NMA+1).EQ.0)             STDP-180
      LT(3)=.FALSE.                                                     STDP-181
      LT(4)=ITV.GT.6                                                    STDP-182
      LT(8)=(IV.GT.0).AND.(IV.LT.7)                                     STDP-183
      K=IABS(NVAL(1,NMA+2))                                             STDP-184
      HH=WV(8,K)                                                        STDP-185
      H=HH                                                              STDP-186
      HM=DMIN1(H,HM)                                                    STDP-187
      IZZ(1,L1)=-NVAL(1,NMA+1)                                          STDP-188
      IZZ(2,L1)=ITT                                                     STDP-189
      IZZ(4,L1)=K                                                       STDP-190
      IF (NVAL(1,NMA+1).EQ.0) GO TO 20                                  STDP-191
      IJ=1                                                              STDP-192
      NFO=MAX0(NFO,NVAL(1,NMA+1))                                       STDP-193
   20 L=IZZ(3,L1)                                                       STDP-194
      JI=IJ                                                             STDP-195
      IF (LT(2)) JI=JI+1                                                STDP-196
      IF ((IV.GT.0).AND.(IV.LT.9)) GO TO 28                             STDP-197
      AP=VAL(NMB)                                                       STDP-198
      IF (IV.GE.9) GO TO 33                                             STDP-199
      LT(2)=LT(2).AND.(NVAL(2,NMA+1).NE.0)                              STDP-200
      LT(4)=LT(4).AND.((NVAL(2,NMA+1).NE.0))                            STDP-201
C FORM FACTOR INTERPOLATED.                                             STDP-202
      IR=0                                                              STDP-203
      DO 25 IS=1,ISM                                                    STDP-204
      X0=IS*H*VAL(NMB+1)                                                STDP-205
   21 IF (X0.LT.VAL(NMB+IR+6)) GO TO 22                                 STDP-206
      IF (IR.GE.-2*IV-8) GO TO 22                                       STDP-207
      IR=IR+1                                                           STDP-208
      GO TO 21                                                          STDP-209
   22 V(IS,L1)=0.D0                                                     STDP-210
      DO 24 K=2,8,2                                                     STDP-211
      X1=1.D0                                                           STDP-212
      DO 23 J=2,8,2                                                     STDP-213
      IF (K.EQ.J) GO TO 23                                              STDP-214
      X1=X1*(X0-VAL(NMB+IR+J))/(VAL(NMB+IR+K)-VAL(NMB+IR+J))            STDP-215
   23 CONTINUE                                                          STDP-216
   24 V(IS,L1)=V(IS,L1)+X1*VAL(NMB+IR+K+1)                              STDP-217
   25 V(IS,L1)=VAL(NMB)*V(IS,L1)                                        STDP-218
      IF (IJ.EQ.1) GO TO 31                                             STDP-219
   26 L2=L1                                                             STDP-220
      DO 27 J=2,IJ                                                      STDP-221
      CALL DERI(V(1,L2+INL),V(1,L2),H,ISM,.TRUE.)                       STDP-222
   27 L2=L2+INL                                                         STDP-223
      IF (IV.GT.0) GO TO 94                                             STDP-224
      GO TO 31                                                          STDP-225
   28 IF (LT(8)) GO TO 37                                               STDP-226
C BOUND STATE FORM FACTOR.                                              STDP-227
      K=NVAL(1,NMB)                                                     STDP-228
      IVM=NVAL(2,NMB-1)                                                 STDP-229
      IVX=IV                                                            STDP-230
      JV=NVAL(1,NMB+1)/2+1                                              STDP-231
      NMC=NMB+3                                                         STDP-232
      IF (K.EQ.1) GO TO 29                                              STDP-233
      JV=JV+ISM                                                         STDP-234
      IF (JV.GT.NX) CALL MEMO('STDF',NX,JV)                             STDP-235
      IDX=IDX-2*JV                                                      STDP-236
      CALL STBF(P,NVAL(2,NMB),ISM,VAL(NMC+3),IVM,NX-JV,IDX,P(JV+1),IVX,HSTDP-237
     1H,IZZ(1,ITXM+1),LO)                                               STDP-238
      NMC=NMC+8*IV-50                                                   STDP-239
      IF (K.EQ.3) IVX=IVX-1                                             STDP-240
      NMB=NMB+2                                                         STDP-241
   29 CALL STBF(V(1,L1),NVAL(2,NMB),ISM,VAL(NMC),IVM,NX-JV,IDX,P(JV+1),ISTDP-242
     1VX,HH,IZZ(1,ITXM+1),LO)                                           STDP-243
      IF (K.EQ.1) GO TO 96                                              STDP-244
      IDX=IDX+JV                                                        STDP-245
      DO 30 IS=1,ISM                                                    STDP-246
   30 V(IS,L1)=V(IS,L1)*P(IS)*VAL(NMB+3)                                STDP-247
      GO TO 96                                                          STDP-248
   31 LT(3)=.TRUE.                                                      STDP-249
      IF (.NOT.LT(2).OR.LT(4)) GO TO 32                                 STDP-250
      IDX=MAX0(IDX,ISM)                                                 STDP-251
      IF (IDX.GT.2*NX) CALL MEMO('STDF',NX,(IDX+1)/2)                   STDP-252
      CALL DERI(P,V(1,L1),H,ISM,.TRUE.)                                 STDP-253
   32 IF (LT(2).OR.(NVAL(2,NMA+1).NE.0)) GO TO 52                       STDP-254
      IF (IJ.EQ.1) GO TO 96                                             STDP-255
      GO TO 94                                                          STDP-256
C BESSEL EXPANSION.                                                     STDP-257
   33 NMC=NMB+1                                                         STDP-258
      L2X=NVAL(2,NMA+2)                                                 STDP-259
      LL=NVAL(1,NMA+3)                                                  STDP-260
      IF (IV.EQ.9) GO TO 34                                             STDP-261
      JL=NVAL(2,NMA+3)                                                  STDP-262
      LJ=JI+JL-1                                                        STDP-263
      IF (VAL(NMC).EQ.0.D0) VAL(NMC)=1.D0                               STDP-264
      GO TO 52                                                          STDP-265
   34 LJ=LL+JI+NVAL(2,NMA+3)                                            STDP-266
      IDX=MAX0(IDX,3*MAX0(L2X,LJ))                                      STDP-267
      IF (IDX.GT.2*NX) CALL MEMO('STDF',NX,(IDX+1)/2)                   STDP-268
C COMPUTATION OF ZEROS OF BESSEL FUNCTIONS - THE L+1 ZEROS FOR L=1 TO   STDP-269
C L=11 ARE IN DATA ZB. THE OTHERS ARE COMPUTED WITH MC MAHON'S FORMULA  STDP-270
C PAGE 371, HANDBOOK OF MATH. FUNCTIONS, ABRAMOVITZ AND STEGUN.         STDP-271
      IF (VAL(NMC).EQ.0.D0) VAL(NMC)=ISM*H                              STDP-272
      DO 36 II=1,L2X                                                    STDP-273
      IF ((LL.NE.0).AND.((LL.LT.12).AND.(II.LE.LL+1))) GO TO 35         STDP-274
      X(1,II)=(2*II+LL)*PIS2                                            STDP-275
      IF (LL.EQ.0) GO TO 36                                             STDP-276
      A1=2.D0*X(1,II)                                                   STDP-277
      A2=DFLOAT(LL*(LL+1))                                              STDP-278
      X(1,II)=X(1,II)-A2*(1.D0+(7.D0*A2-6.D0+((166.D0*A2-408.D0)*A2+360.STDP-279
     1D0+(((6949.D0*A2-33252.D0)*A2+81180.D0)*A2-75600.D0)/(7.D0*A1**2))STDP-280
     2/(5.D0*A1**2))/(3.D0*A1**2))/A1                                   STDP-281
      GO TO 36                                                          STDP-282
   35 K=(LL*(LL+1))/2+II-1                                              STDP-283
      X(1,II)=ZB(K)                                                     STDP-284
   36 X(1,II)=X(1,II)/VAL(NMC)                                          STDP-285
      LM=LL+1                                                           STDP-286
      LT(6)=LT(2).AND.(NVAL(2,NMA+1).EQ.0)                              STDP-287
      GO TO 52                                                          STDP-288
C WOODS-SAXON AND ITS DERIVATIVES TO SOME POWER.                        STDP-289
   37 NMC=NMB+4                                                         STDP-290
      LT(5)=((VAL(NMB+2).EQ.0.D0).AND.LT(4))                            STDP-291
      LT(4)=((VAL(NMB+2).NE.0.D0).AND.LT(4))                            STDP-292
      LT(6)=(((ITV.EQ.3).OR.(ITV.EQ.4)).AND.(.NOT.LO(100)))             STDP-293
      LT(9)=(.NOT.LO(9)).OR.(VAL(NMB+1).GE.0.D0).OR.LT(5)               STDP-294
      IF (ITV.GT.6) NMC=NMC+1                                           STDP-295
      IF (LT(5)) GO TO 38                                               STDP-296
      SEP=DEXP(HH/VAL(NMB+2))                                           STDP-297
      IF (VAL(NMB+2).GT.0.02D0*H)  GO TO 39                             STDP-298
      WRITE (MW,1000) VAL(NMB+2),NMA,I                                  STDP-299
      VAL(NMB+2)=DMAX1(-VAL(NMB+2),0.02D0*H)                            STDP-300
      GO TO 39                                                          STDP-301
   38 IF (VAL(NMB+1).GE.H) GO TO 39                                     STDP-302
      WRITE (MW,1001) VAL(NMB+1),NMA,I                                  STDP-303
      VAL(NMB+1)=DMAX1(-VAL(NMB+1),H)                                   STDP-304
   39 IF (IV.LE.4) GO TO 49                                             STDP-305
C INITIALISATION OF DO LOOPS FOR DEFORMED POTENTIALS.                   STDP-306
      IQM=NVAL(2,NMA+2)                                                 STDP-307
      IX=20                                                             STDP-308
      IQ=MAX0(L,IQM)                                                    STDP-309
      IF (IV.EQ.6) IQ=MAX0(IQ,NVAL(2,NMA+2))                            STDP-310
      IDX=MAX0(IDX,3*IQ+120)                                            STDP-311
      IF (IDX.GT.2*NX) CALL MEMO('STDF',NX,(IDX+1)/2)                   STDP-312
      A2=0.D0                                                           STDP-313
      A1=1.D0                                                           STDP-314
      IF (LO(6)) A1=DABS(VAL(NMB+1))                                    STDP-315
      DO 40 I=1,IQM                                                     STDP-316
   40 X(1,40+I)=VAL(NMC+I-1)*DSQRT(DFLOAT(2*I+1)/(8.D0*PIS2))/A1        STDP-317
      DO 48 II=1,20                                                     STDP-318
      I=1+MOD(II-1,10)                                                  STDP-319
      X(2,22)=XGN(I)                                                    STDP-320
      IF (I.NE.II) X(2,22)=-X(2,22)                                     STDP-321
      X(2,21)=1.D0                                                      STDP-322
      DO 41 J=2,IQ                                                      STDP-323
   41 X(2,J+21)=(DFLOAT(2*J-1)*X(2,22)*X(2,J+20)+DFLOAT(1-J)*X(2,J+19))/STDP-324
     1DFLOAT(J)                                                         STDP-325
      X(3,II+20)=0.5D0*PGN(I)                                           STDP-326
      X(2,II)=0.D0                                                      STDP-327
      A5=X(2,L+21)                                                      STDP-328
      IF (IV.EQ.5) GO TO 46                                             STDP-329
      KL=NVAL(2,NMA+2)                                                  STDP-330
      IF (NVAL(1,NMA+3).NE.0) GO TO 42                                  STDP-331
      A5=A5*X(2,KL+21)*DSQRT(DFLOAT(2*KL+1))                            STDP-332
      GO TO 46                                                          STDP-333
C COMPUTATION OF Y(L,KK) * Y(KL,KK).                                    STDP-334
   42 A5=DSQRT(DFLOAT(2*KL+1))                                          STDP-335
      KK=NVAL(1,NMA+3)                                                  STDP-336
      DO 43 N=1,KK                                                      STDP-337
   43 A5=A5*(1.D0-XGN(I)**2)*DFLOAT(2*N-1)**2/DSQRT(DFLOAT((KL+N)*(L+N)*STDP-338
     1(KL-N+1)*(L-N+1)))                                                STDP-339
      KZ=L-KK                                                           STDP-340
      DO 45 J=1,2                                                       STDP-341
      IF (KZ.LE.0) GO TO 45                                             STDP-342
      A4=0.D0                                                           STDP-343
      DO 44 K=1,KZ                                                      STDP-344
      A3=A4                                                             STDP-345
      A4=A5                                                             STDP-346
   44 A5=A3+(A4*X(2,22)-A3)*(2.D0*(KK+K)-1.D0)/K                        STDP-347
   45 KZ=KL-KK                                                          STDP-348
   46 X(3,II)=X(3,II+20)*A5*DSQRT(2.D0*L+1.D0)                          STDP-349
      RR=1.D0                                                           STDP-350
      DO 47 K=1,IQM                                                     STDP-351
   47 RR=RR+X(1,40+K)*X(2,K+21)                                         STDP-352
      X(2,II)=-RR*DABS(VAL(NMB+1))                                      STDP-353
      X(1,II)=0.D0                                                      STDP-354
      X(1,20+II)=1.D-16                                                 STDP-355
      IF (.NOT.LT(5)) GO TO 48                                          STDP-356
      X(2,II)=DABS(X(2,II))                                             STDP-357
      A2=A2+X(2,II)**3*X(3,20+II)                                       STDP-358
   48 CONTINUE                                                          STDP-359
      GO TO 50                                                          STDP-360
C INITIALISATION OF DO LOOPS FOR NOT DEFORMED POTENTIALS.               STDP-361
   49 IQM=0                                                             STDP-362
      IX=1                                                              STDP-363
      IDX=MAX0(IDX,33)                                                  STDP-364
      IF (IDX.GT.2*NX) CALL MEMO('STDF',NX,(IDX+1)/2)                   STDP-365
      X(1,1)=0.D0                                                       STDP-366
      X(2,1)=-DABS(VAL(NMB+1))                                          STDP-367
      X(3,1)=1.D0                                                       STDP-368
      IF (.NOT.LT(5)) GO TO 50                                          STDP-369
      X(2,1)=-X(2,1)                                                    STDP-370
      A2=X(2,1)**3                                                      STDP-371
   50 IV1=1+MOD(IV-1,4)                                                 STDP-372
      AP=VAL(NMB)                                                       STDP-373
      AN=VAL(NMB+1)                                                     STDP-374
      IF (LO(6)) AN=AN/DABS(VAL(NMB+1))                                 STDP-375
      IF (.NOT.LT(9)) AN=-AN                                            STDP-376
      IF (IV1.GT.1) AP=AP*AN/DSQRT(8.D0*PIS2)                           STDP-377
      IF (IV1.GT.2) AP=AP*AN*0.5D0                                      STDP-378
      IF (IV1.GT.3) AP=AP*AN/3.D0                                       STDP-379
      IF (VAL(NMB+3).GT.-1.D0) GO TO 51                                 STDP-380
      WRITE (MW,1002) VAL(NMB+3),NMA                                    STDP-381
      VAL(NMB+3)=-.8D0                                                  STDP-382
   51 A1=VAL(NMB+3)                                                     STDP-383
      A5=DFLOAT(L+1)                                                    STDP-384
      IV2=IV1                                                           STDP-385
      IV3=IV2-1                                                         STDP-386
      IV2=IV3+JI                                                        STDP-387
      IF (LT(6)) IV2=IV2+1                                              STDP-388
      IF (ITV.GT.6) AP=AP*CCZ                                           STDP-389
      IF (LT(5)) AP=AP/A2                                               STDP-390
   52 IF (LT(4)) JI=1                                                   STDP-391
      RR=0.D0                                                           STDP-392
      AN=0.D0                                                           STDP-393
      A6=0.D0                                                           STDP-394
      DO 87 IS=1,ISM                                                    STDP-395
      RR=RR+HH                                                          STDP-396
      IF (LT(3)) GO TO 86                                               STDP-397
      DO 53 I=1,3                                                       STDP-398
   53 Y(I)=0.D0                                                         STDP-399
      IF (IV.GE.9) GO TO 67                                             STDP-400
C INTEGRATION LOOP.                                                     STDP-401
      DO 66 I=1,IX                                                      STDP-402
      IF (LT(5)) GO TO 57                                               STDP-403
      X(2,I)=X(2,I)+HH                                                  STDP-404
      IF (X(1,I).NE.0.D0) GO TO 54                                      STDP-405
      IF (X(2,I)+50.D0*VAL(NMB+2).GT.0.D0) X(1,I)=DEXP(X(2,I)/VAL(NMB+2)STDP-406
     1)                                                                 STDP-407
      GO TO 55                                                          STDP-408
   54 IF (X(1,I).LT.1.D15) X(1,I)=X(1,I)*SEP                            STDP-409
   55 CALL WOSA(VR,VAL(NMB+2),A1,X(1,I),X(2,I),IV2,LT(9))               STDP-410
      IF (LT(6)) VR(IV1)=VR(IV2)*4.D0*VAL(NMB+2)                        STDP-411
      IF (LT(4)) A6=A6+VR(1)*RR**2*X(3,I+20)*(1.D0+VAL(NMB+4)*RR**2)    STDP-412
      DO 56 J=1,JI                                                      STDP-413
   56 Y(J)=Y(J)+VR(IV3+J)*X(3,I)                                        STDP-414
      GO TO 66                                                          STDP-415
C DEFORMED COULOMB POTENTIAL.                                           STDP-416
   57 A4=X(2,I)/RR                                                      STDP-417
      IF (ITV.NE.ITT) GO TO 59                                          STDP-418
      IF (A4.GT.1.D0) GO TO 58                                          STDP-419
      Y(1)=Y(1)+(X(2,I)**2)*A4*X(3,I)                                   STDP-420
      Y(2)=Y(2)+X(2,I)*A4**2*X(3,I)                                     STDP-421
      Y(3)=Y(3)+2.D0*A4**3*X(3,I)                                       STDP-422
      GO TO 66                                                          STDP-423
   58 Y(1)=Y(1)+(0.5D0*X(2,I)*X(2,I)-RR*RR/6.D0)*X(3,I)*3.D0            STDP-424
      Y(2)=Y(2)+RR*X(3,I)                                               STDP-425
      Y(3)=Y(3)-X(3,I)                                                  STDP-426
      GO TO 66                                                          STDP-427
   59 IF (A4.GT.1.D0) GO TO 60                                          STDP-428
      A3=(X(2,I)**2)*(A4**(L+1))*3.D0/((A5+2.D0)*(2.D0*A5-1.D0))        STDP-429
      IF (IV1.GT.1) A3=A3*(A5+2.D0)/X(2,I)                              STDP-430
      IF (IV1.GT.2) A3=A3*(A5+1.D0)/X(2,I)                              STDP-431
      IF (IV1.GT.3) A3=A3*A5/X(2,I)                                     STDP-432
      GO TO 62                                                          STDP-433
   60 IF (L.NE.2) GO TO 61                                              STDP-434
      IF (IV1.EQ.1) A3=RR*RR*(0.2D0+DLOG(A4))*0.6D0                     STDP-435
      IF (IV1.GE.2) A3=0.6D0*RR/A4                                      STDP-436
      IF (IV1.GE.3) A3=-A3/X(2,I)                                       STDP-437
      IF (IV1.GE.4) A3=-2.D0*A3/X(2,I)                                  STDP-438
      GO TO 62                                                          STDP-439
   61 IF (IV1.EQ.1) A3=RR*RR*(1.D0/(A5+2.D0)-1.D0/(A4**(L-2)*(2.D0*A5-1.STDP-440
     1D0)))*3.D0/(A5-3.D0)                                              STDP-441
      IF (IV1.GE.2) A3=RR/A4**(L-1)*3.D0/(2.D0*A5-1.D0)                 STDP-442
      IF (IV1.GE.3) A3=-A3*(A5-2.D0)/X(2,I)                             STDP-443
      IF (IV1.EQ.4) A3=-A3*(A5-1.D0)/X(2,I)                             STDP-444
   62 Y(1)=Y(1)+A3*X(3,I)                                               STDP-445
      IF (JI.EQ.1) GO TO 66                                             STDP-446
      IF (A4.GT.1.D0) GO TO 63                                          STDP-447
      A3=-A5*A3/RR                                                      STDP-448
      GO TO 65                                                          STDP-449
   63 IF (L.NE.2) GO TO 64                                              STDP-450
      IF (IV2.EQ.1) A3=-1.2D0*(0.3D0*RR-DLOG(A4))*RR                    STDP-451
      IF (IV2.GE.2) A3=2.D0*A3/RR                                       STDP-452
      GO TO 65                                                          STDP-453
   64 IF (IV2.EQ.1) A3=(2.D0/(A5+2.D0)-(A5-1.D0)/(A4**(L-2)*(2.D0*A5-1.DSTDP-454
     10)))*3.D0/(A5-3.D0)*RR                                            STDP-455
      IF (IV2.NE.1) A3=(A5-1.D0)*A3/RR                                  STDP-456
   65 Y(2)=Y(2)-A3*X(3,I)                                               STDP-457
   66 CONTINUE                                                          STDP-458
      GO TO 84                                                          STDP-459
C COMPUTATION OF BESSEL FUNCTIONS.                                      STDP-460
   67 IF (IV.GT.9) GO TO 76                                             STDP-461
      IF (RR.GT.VAL(NMC)) GO TO 87                                      STDP-462
      DO 75 II=1,L2X                                                    STDP-463
      A1=RR*X(1,II)                                                     STDP-464
      X(2,1)=DSIN(A1)/A1                                                STDP-465
      IF (LJ.EQ.1) GO TO 72                                             STDP-466
      K=IDINT(1.D0+A1)                                                  STDP-467
      IF (K.LT.LJ) GO TO 69                                             STDP-468
      X(2,2)=(X(2,1)-DCOS(A1))/A1                                       STDP-469
      IF (LJ.EQ.2) GO TO 72                                             STDP-470
      DO 68 J=3,LJ                                                      STDP-471
   68 X(2,J)=(2*J-3)*X(2,J-1)/A1-X(2,J-2)                               STDP-472
      GO TO 72                                                          STDP-473
   69 A3=LJ                                                             STDP-474
      A4=DMAX1(DSQRT(10.5D0*A1)-0.5D0,A3)                               STDP-475
      K=IDINT(A4+3.D0+21.D0*A1/(A4+A4+1.D0))                            STDP-476
      A2=0.D0                                                           STDP-477
   70 A2=A1/(2.D0*K+1.D0-A2*A1)                                         STDP-478
      IF (K.LE.LJ) X(2,K+1)=A2                                          STDP-479
      K=K-1                                                             STDP-480
      IF (K.GE.1) GO TO 70                                              STDP-481
      DO 71 K=2,LJ                                                      STDP-482
   71 X(2,K)=X(2,K)*X(2,K-1)                                            STDP-483
C COMPUTATION OF DERIVATIVES OF BESSEL FUNCTIONS (- DERIVATIVE).        STDP-484
   72 JL=LJ-1                                                           STDP-485
      DO 74 J=LM,LJ                                                     STDP-486
      KK=JI+J-LJ                                                        STDP-487
      IF (KK.GE.1) Y(KK)=Y(KK)+VAL(NMC+II)*X(2,LM)                      STDP-488
      IF (KK.EQ.JI) GO TO 75                                            STDP-489
      A3=0.D0                                                           STDP-490
      A5=0.D0                                                           STDP-491
      DO 73 K=1,JL                                                      STDP-492
      A2=(A5+1.D0)*X(2,K+1)-A5*A3                                       STDP-493
      A3=X(2,K)                                                         STDP-494
      X(2,K)=X(1,II)*A2/(2.D0*A5+1.D0)                                  STDP-495
   73 A5=A5+1.D0                                                        STDP-496
   74 JL=JL-1                                                           STDP-497
   75 CONTINUE                                                          STDP-498
      GO TO 84                                                          STDP-499
C COMPUTATION OF LAGUERRE POLYNOMIALS X**LL L(2X**2) DEXP(-X**2).       STDP-500
   76 DO 83 J=1,L2X,2                                                   STDP-501
      IF (J.NE.1) GO TO 77                                              STDP-502
      A1=RR/VAL(NMC)                                                    STDP-503
      A2=A1*A1                                                          STDP-504
      CL(1)=A1**LL*DEXP(-0.5D0*A2)                                      STDP-505
      CL(2)=(LL+1.5D0-A2)*CL(1)                                         STDP-506
      GO TO 78                                                          STDP-507
   77 CL(1)=(CL(2)*(DFLOAT(LL+2*J)-2.5D0-A2)-CL(1)*(DFLOAT(LL+J)-1.5D0))STDP-508
     1/DFLOAT(J-1)                                                      STDP-509
      CL(2)=(CL(1)*(DFLOAT(LL+2*J)-0.5D0-A2)-CL(2)*(DFLOAT(LL+J)-0.5D0))STDP-510
     1/DFLOAT(J)                                                        STDP-511
   78 IF (JL.NE.0) GO TO 79                                             STDP-512
      Y(1)=Y(1)+CL(1)*VAL(NMC+J)                                        STDP-513
      IF (J.LT.L2X) Y(1)=Y(1)+CL(2)*VAL(NMC+J+1)                        STDP-514
   79 IF (LJ.EQ.0) GO TO 83                                             STDP-515
      DO 80 L=3,6                                                       STDP-516
   80 CL(L)=0.D0                                                        STDP-517
C -DERIVATIVE OF LAGUERRE POLYNOMIALS X**LL L(2X**2) DEXP(-X**2).       STDP-518
      DO 82 K=1,LJ                                                      STDP-519
      DO 81 L=1,6                                                       STDP-520
   81 CL(L+2)=CL(L)                                                     STDP-521
      CL(1)=((DFLOAT(LL+2*J+K)-A2)*CL(3)-DFLOAT(2*J)*CL(4)-DFLOAT(2*(K-1STDP-522
     1)*(K-2))*CL(7))/A1+DFLOAT(4*(K-1))*CL(5)                          STDP-523
      CL(2)=-((DFLOAT(LL+2*J+1-K)-A2)*CL(4)-DFLOAT(2*J+1+2*LL)*CL(3)-DFLSTDP-524
     1OAT(2*(K-1)*(K-2))*CL(8))/A1-DFLOAT(4*(K-1))*CL(6)                STDP-525
      IF (K.LT.JL) GO TO 83                                             STDP-526
      Y(K+1-JL)=Y(K+1-JL)+CL(1)*VAL(NMC+J)                              STDP-527
      IF (J.LT.L2X) Y(K+1-JL)=Y(K+1-JL)+CL(2)*VAL(NMC+J+1)              STDP-528
   82 CONTINUE                                                          STDP-529
   83 CONTINUE                                                          STDP-530
   84 L2=L1                                                             STDP-531
      DO 85 J=1,JI                                                      STDP-532
      V(IS,L2)=AP*Y(J)                                                  STDP-533
   85 L2=L2+INL                                                         STDP-534
      GO TO 87                                                          STDP-535
   86 Y(1)=V(IS,L1)/AP                                                  STDP-536
      IF (LT(2).AND.(.NOT.LT(4))) V(IS,L1)=P(IS)                        STDP-537
   87 AN=AN+AP*Y(1)*RR**(L+2)                                           STDP-538
      IF (LT(7)) GO TO 94                                               STDP-539
      IF (.NOT.LT(4)) GO TO 89                                          STDP-540
C FOLDING OF CHARGE DISTRIBUTION WITH COULOMB POTENTIAL.                STDP-541
      IDX=MAX0(IDX,5*ISM)                                               STDP-542
      IF (IDX.GT.2*NX) CALL MEMO('STDF',NX,(IDX+1)/2)                   STDP-543
      A7=0.D0                                                           STDP-544
      IF (LT(8)) A7=VAL(NMB+4)                                          STDP-545
      CALL COPO(V(1,L1),V(1,L1),X,ISM,HH,L,AP,A7,CCZ,A6,.TRUE.,.FALSE.) STDP-546
      IF (A6.EQ.0.D0) A6=DABS(V(ISM,L1)*DFLOAT(2*L+1)*(ISM*HH)**(L+1)/(CSTDP-547
     1CZ*VAL(NMB)))                                                     STDP-548
      DO 88 IS=1,ISM                                                    STDP-549
   88 V(IS,L1)=V(IS,L1)/A6                                              STDP-550
   89 IF (NVAL(2,NMA+1).EQ.0) GO TO 93                                  STDP-551
      AN=DABS(AN*HH/AP)                                                 STDP-552
      IF (ITV.GT.6) AN=DABS(V(ISM,L1)*DFLOAT(2*L+1)*(ISM*HH)**(L+1)/(CCZSTDP-553
     1*VAL(NMB)))                                                       STDP-554
      IF (LT(2).AND.(ITT.EQ.8).AND.(NVAL(1,NMA+1).EQ.0).AND.(VAL(NMB+2).STDP-555
     1EQ.0.D0).AND.LT(8)) AN=AN*HH*ISM                                  STDP-556
      IF (NVAL(2,NMA+1).GT.0) GO TO 90                                  STDP-557
      NVAL(2,NMA+1)=-NVAL(2,NMA+1)                                      STDP-558
      AP=VAL(NMB)                                                       STDP-559
      VAL(NMB)=AP*AN                                                    STDP-560
      WRITE (MW,1003) AP,VAL(NMB),ITT,J1                                STDP-561
      GO TO 93                                                          STDP-562
   90 L2=L1                                                             STDP-563
      DO 92 J=1,IJ                                                      STDP-564
      DO 91 IS=1,ISM                                                    STDP-565
   91 V(IS,L2)=V(IS,L2)/AN                                              STDP-566
   92 L2=L2+INL                                                         STDP-567
   93 IF (.NOT.LT(4)) GO TO 94                                          STDP-568
      LT(4)=.FALSE.                                                     STDP-569
      LT(7)=.TRUE.                                                      STDP-570
      IF (LT(2)) GO TO 31                                               STDP-571
      IF (IJ.NE.1) GO TO 26                                             STDP-572
   94 IF (.NOT.LT(1).OR.(NVAL(1,NMA+1).NE.0)) GO TO 96                  STDP-573
      RR=0.D0                                                           STDP-574
      DO 95 IS=1,ISM                                                    STDP-575
      RR=RR+H                                                           STDP-576
      A1=V(IS,L1+INL)                                                   STDP-577
      V(IS,L1+INL)=-V(IS,L1)/RR**2                                      STDP-578
   95 V(IS,L1)=A1/RR                                                    STDP-579
   96 NMA=NVAL(2,I1-6)+1                                                STDP-580
      GO TO 9                                                           STDP-581
   97 IF (NFO.EQ.0) RETURN                                              STDP-582
C FOLDING.                                                              STDP-583
      NNF=ISM*ITXM+1                                                    STDP-584
      IF (LO(100)) NNF=NNF-ISM*ITX(7)                                   STDP-585
      DO 98 I=1,NNF                                                     STDP-586
   98 P(I)=0.D0                                                         STDP-587
      N1=NVAL(2,1)                                                      STDP-588
      IST=0                                                             STDP-589
      DO 99 N=1,NFO                                                     STDP-590
      IS=5+ISM+IDINT(2.D0*(DABS(VAL(N1+3*N-2))+2.D0*DABS(VAL(N1+3*N-1)))STDP-591
     1/HM)                                                              STDP-592
      IF (VAL(N1+3*N-3)*VAL(N1+3*N-2).EQ.0.D0) IS=ISM+5                 STDP-593
   99 IST=MAX0(IS,IST)                                                  STDP-594
      IDY=NNF+2*IST*(IMAX+1)                                            STDP-595
      IDX=MAX0(IDY,IDX)                                                 STDP-596
      IF (IDX.GT.2*NX) CALL MEMO('STDF',NX,(IDX+1)/2)                   STDP-597
      CALL FOLD(V,P,VAL(N1),NFO,1,ISM,IST,IVY,INTC,P(NNF),PGN,XGN,WV,IZZSTDP-598
     1,LO)                                                              STDP-599
      RETURN                                                            STDP-600
 1000 FORMAT (' TOO SMALL DIFFUSENESS =',D15.8,'   CHANGED INTO MINIMUM STDP-601
     1VALUE IN STDP FOR NMA =',I5,' AND I =',I2)                        STDP-602
 1001 FORMAT (' TOO SMALL COULOMB RADIUS =',D15.8,'   CHANGED INTO MINIMSTDP-603
     1UM VALUE IN STDP FOR NMA =',I5,' AND I =',I2)                     STDP-604
 1002 FORMAT (' POWER 1+',D15.6,'  CHANGED TO .2 FOR NMA =',I4)         STDP-605
 1003 FORMAT (' STRENGTH',D15.6,' REPLACED BY THE INTEGRAL',D15.6,' FOR STDP-606
     1THE FORM FACTOR',I4,' OF THE POTENTIAL',I4)                       STDP-607
      END                                                               STDP-608
C 07/03/06                                                      ECIS06  STBF-000
      SUBROUTINE STBF(V,IVX,ISM,VAL,IVM,NX,IDX,XX,IV,HH,IEX,LO)         STBF-001
C COMPUTES BOUND STATE FORM FACTORS.                                    STBF-002
C INPUT:     IVX:     TABLE OF QUANTUM NUMBERS.                         STBF-003
C            ISM:     NUMBER OF INTEGRATION STEPS.                      STBF-004
C            VAL(J):  OSCILLATOR PARAMETER OR BINDING ENERGY FOR J=1,   STBF-005
C                     TOTAL MASS FOR J=2,                               STBF-006
C                     MASS OF BOUND PARTICLE FOR J=3,                   STBF-007
C                     PRODUCT OF CHARGES FOR J=4,                       STBF-008
C                     REAL POTENTIAL FOR UNBOUND STATES OR STARTING     STBF-009
C                     VALUE FOR THE SEARCH ON BOUND STATE FOR J=5,      STBF-010
C                     REDUCED RADIUS OF REAL POTENTIAL FOR J=6,         STBF-011
C                     DIFFUSENESS OF RADIUS OF REAL POTENTIAL FOR J=7,  STBF-012
C                     DEPTH OF SPIN-ORBIT POTENTIAL FOR J=8,            STBF-013
C                     REDUCED RADIUS OF SPIN-ORBIT POTENTIAL FOR J=9,   STBF-014
C                     DIFFUSENESS OF SPIN-ORBIT POTENTIAL FOR J=10,     STBF-015
C                     REDUCED RADIUS OF COULOMB POTENTIAL FOR J=11.     STBF-016
C            IVM:     STEP FACTOR FOR WOODS-SAXON WAVE FUNCTIONS.       STBF-017
C            NX:      LENGTH OF WORKING SPACE.                          STBF-018
C            IV:      IV=8 FOR SOLUTION IN A WOODS-SAXON POTENTIAL.     STBF-019
C            HH:      STEP SIZE FOR INTEGRATION.                        STBF-020
C            LO(I):   LOGICAL CONTROLS:                                 STBF-021
C               LO(51) =.TRUE. OUTPUT OF POTENTIALS.                    STBF-022
C               LO(47) =.TRUE. NO RECOIL CORRECTION FOR BOUND STATES.   STBF-023
C OUTPUT:    V(ISM):  BOUND STATE WAVE FUNCTION.                        STBF-024
C            IDX:     LENGTH OF WORKING FIELD USED.                     STBF-025
C WORKING AREA:                                                         STBF-026
C            XX:      TO COMPUTE BOUND FUNCTIONS.                       STBF-027
C            IEX:     FOR COULOMB FUNCTION, IN EQUIVALENCE WITH XX.     STBF-028
C                                                                       STBF-029
C FOR THE COMMON  /DCONS/ SEE CALC.                                     STBF-030
C                                                                       STBF-031
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     STBF-032
C  CCZ:       COULOMB ALPHA CONSTANT.                                   STBF-033
C  CK:        H-BAR*C.                                                  STBF-034
C   USED:     CCZ,CK.                                                   STBF-035
C                                                                       STBF-036
C***********************************************************************STBF-037
      IMPLICIT REAL*8 (A-H,O-Z)                                         STBF-038
      LOGICAL LO(150)                                                   STBF-039
      DIMENSION V(*),IVX(4),VAL(11),XX(*),IEX(*)                        STBF-040
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            STBF-041
      COMMON /INOUT/ MR,MW,MS                                           STBF-042
      L=IVX(2)                                                          STBF-043
      H=HH                                                              STBF-044
      IF ((.NOT.LO(47)).AND.(VAL(3).NE.VAL(2))) H=H*VAL(2)/(VAL(2)-VAL(3STBF-045
     1))                                                                STBF-046
      IF (IV.EQ.8) GO TO 7                                              STBF-047
      N=IVX(1)                                                          STBF-048
C COMPUTATION OF THE NORMALISATION OF LAGUERRE POLYNOMIALS              STBF-049
      A1=2.256758334191D0                                               STBF-050
      A3=L                                                              STBF-051
      IF (L.EQ.0) GO TO 2                                               STBF-052
      DO 1 I=1,L                                                        STBF-053
    1 A1=A1/(DFLOAT(I)+.5D0)                                            STBF-054
    2 IF (N.EQ.0) GO TO 4                                               STBF-055
      DO 3 I=1,N                                                        STBF-056
      A2=DFLOAT(I)                                                      STBF-057
    3 A1=A1*(A2+A3+.5D0)/A2                                             STBF-058
    4 A1=DSQRT(A1)                                                      STBF-059
C COMPUTATION OF LAGUERRE POLYNOMIALS                                   STBF-060
      RR=0.D0                                                           STBF-061
      DO 6 IS=1,ISM                                                     STBF-062
      RR=RR+H                                                           STBF-063
      X1=(VAL(1)*RR)**2                                                 STBF-064
      X3=A1*DEXP(.5D0*(A3*DLOG(X1)-X1))                                 STBF-065
      IF (N.EQ.0) GO TO 6                                               STBF-066
      X2=X3                                                             STBF-067
      DO  5 I=1,N                                                       STBF-068
      A2=DFLOAT(I)                                                      STBF-069
      X2=2.D0*X2*DFLOAT(I-N-1)*X1/(A2*(2.D0*(A3+A2)+1.D0))              STBF-070
    5 X3=X3+X2                                                          STBF-071
    6 V(IS)=X3                                                          STBF-072
      RETURN                                                            STBF-073
C BOUND STATE IN WOODS-SAXON POTENTIAL                                  STBF-074
C CONTROL OF STORAGE AND STEP SIZE                                      STBF-075
    7 IREB=IVM                                                          STBF-076
      IF (IREB.EQ.0) IREB=4                                             STBF-077
      KN=IREB*ISM                                                       STBF-078
      IDX=MAX0(IDX,3*KN+3)                                              STBF-079
      IF (IDX.GT.NX) CALL MEMO('STBF',NX,IDX)                           STBF-080
      A4=IREB                                                           STBF-081
      A4=H/A4                                                           STBF-082
      Y3=(VAL(2)-VAL(3))**0.33333333333333D0                            STBF-083
      A2=Y3*VAL(6)                                                      STBF-084
      KR=IDINT(A2/A4)                                                   STBF-085
      Y2=VAL(1)                                                         STBF-086
      IF (Y2.EQ.0.D0) Y2=0.01D0                                         STBF-087
      JL=IVX(4)                                                         STBF-088
      IF (IVX(3).EQ.0) JL=2*L                                           STBF-089
      IF (LO(51)) WRITE (MW,1000) IVX,KN,IREB,KR,Y2,(VAL(I),I=2,11)     STBF-090
      A1=A4*A4                                                          STBF-091
      Y1=VAL(3)*(VAL(2)-VAL(3))/VAL(2)                                  STBF-092
      Y5=CK*Y1*A1                                                       STBF-093
      A5=Y2*Y5                                                          STBF-094
      RR=DSQRT(DABS(A5))/A4                                             STBF-095
      X5=0.5D0*CK*CCZ*Y1*VAL(4)/RR                                      STBF-096
      IF (VAL(1).GT.0.D0) GO TO 8                                       STBF-097
C MATCHING OF UNBOUND FUNCTIONS                                         STBF-098
      IDX=MAX0(IDX,6*L+6)                                               STBF-099
      IF (IDX.GT.NX) CALL MEMO('STBF',NX,IDX)                           STBF-100
      CALL FCOU(L,X5,RR*A4*KN,XX(L+2),XX(2*L+3),XX(3*L+4),XX(4*L+5),IEX,STBF-101
     1XX(5*L+6))                                                        STBF-102
      Z1=XX(2*L+2)                                                      STBF-103
      Z2=XX(4*L+4)                                                      STBF-104
      CALL FCOU(L,X5,RR*A4*(KN-2),XX(L+2),XX(2*L+3),XX(3*L+4),XX(4*L+5),STBF-105
     1IEX,XX(5*L+6))                                                    STBF-106
      Z3=XX(2*L+2)                                                      STBF-107
      Z4=XX(4*L+4)                                                      STBF-108
    8 X1=Y3*VAL(11)                                                     STBF-109
      A3=Y3*VAL(9)                                                      STBF-110
      Y3=2.D0*VAL(8)*Y5                                                 STBF-111
      Y4=IVX(3)*(IVX(3)+2)-JL*(JL+2)+4*L*(L+1)                          STBF-112
      Y4=.25D0*Y4                                                       STBF-113
      A6=DFLOAT(L*(L+1))                                                STBF-114
      A6=A6*A1                                                          STBF-115
      X4=X5*2.D0*A1*RR                                                  STBF-116
      X3=0.D0                                                           STBF-117
      K1=KN+1                                                           STBF-118
      K2=KN+2                                                           STBF-119
C COMPUTATION OF OPTICAL POTENTIALS                                     STBF-120
      DO 10 I=1,K1                                                      STBF-121
      X3=X3+A4                                                          STBF-122
      X2=DEXP((X3-A3)/VAL(10))                                          STBF-123
      XX(K2+I)=A6/(X3*X3)+Y4*Y3*X2/((1.D0+X2)**2*X3*VAL(10))+A5         STBF-124
      XX(2*K2+I)=-1.D0/(1.D0+DEXP((X3-A2)/VAL(7)))                      STBF-125
      IF (X3.GT.X1) GO TO 9                                             STBF-126
      XX(K2+I)=XX(K2+I)+X4*(1.5D0-0.5D0*X3*X3/(X1*X1))/X1               STBF-127
      GO TO 10                                                          STBF-128
    9 XX(K2+I)=XX(K2+I)+X4/X3                                           STBF-129
   10 CONTINUE                                                          STBF-130
      IF (VAL(1).LT.0.D0) GO TO 15                                      STBF-131
C MATCHING CONDITIONS                                                   STBF-132
      X1=(X3-A4)*RR                                                     STBF-133
      X3=X3*RR                                                          STBF-134
      A6=A6/A1                                                          STBF-135
      N=IDINT(5.D0*(X3-X1)+1.D0)                                        STBF-136
      Y3=N                                                              STBF-137
      Y3=(X3-X1)/Y3                                                     STBF-138
      IG=IDINT(1.D0/Y3)                                                 STBF-139
      JG=MIN0(100,IG)                                                   STBF-140
      A5=Y3*Y3                                                          STBF-141
      A3=1.D0                                                           STBF-142
      DO 12 I=1,20                                                      STBF-143
      M=2*I*JG                                                          STBF-144
      A4=X3+Y3*DFLOAT(M)                                                STBF-145
      Y1=DEXP(Y3)                                                       STBF-146
      Y4=0.5D0/Y3+0.5D0                                                 STBF-147
      Y2=(A6/(A4*A4)+2.D0*X5/A4+1.D0)*A5                                STBF-148
      DO 11 J=1,M                                                       STBF-149
      Y1=(2.D0+Y2/(1.D0-Y2/12.D0))-1.D0/Y1                              STBF-150
      A2=Y2                                                             STBF-151
      A4=A4-Y3                                                          STBF-152
      Y2=(A6/(A4*A4)+2.D0*X5/A4+1.D0)*A5                                STBF-153
      A1=Y1*(1.D0-A2/12.D0)/(1.D0-Y2/12.D0)                             STBF-154
   11 Y4=Y4/(A1*A1)+1.D0                                                STBF-155
      IF (DABS(Y1-A3).LT.0.1D-4*DABS(Y1-1.D0)) GO TO 13                 STBF-156
   12 A3=Y1                                                             STBF-157
      IF (LO(51)) WRITE (MW,1001)                                       STBF-158
   13 Y4=(Y4-0.5D0)*Y3                                                  STBF-159
      IF (LO(51)) WRITE (MW,1002) I,M                                   STBF-160
      X2=1.D0/Y1                                                        STBF-161
      X3=1.D0                                                           STBF-162
      X4=Y2                                                             STBF-163
      DO 14 I=1,N                                                       STBF-164
      X1=X2                                                             STBF-165
      X2=X3                                                             STBF-166
      X3=(2.D0+X4/(1.D0-X4/12.D0))*X2-X1                                STBF-167
      A4=A4-Y3                                                          STBF-168
   14 X4=(A6/(A4*A4)+2.D0*X5/A4+1.D0)*A5                                STBF-169
      A3=X3*(1.D0-Y2/12.D0)/(1.D0-X4/12.D0)                             STBF-170
      GO TO 16                                                          STBF-171
   15 KR=K1                                                             STBF-172
   16 KS=IDINT(2.D0+DSQRT(A6/12.D0))                                    STBF-173
C STARTING VALUES                                                       STBF-174
      DO 17 I=1,KS                                                      STBF-175
   17 XX(I)=0.D0                                                        STBF-176
      XX(KS)=1.D0                                                       STBF-177
      IF (L.EQ.1) XX(KS-1)=-.2D0                                        STBF-178
      A4=VAL(5)                                                         STBF-179
      IK=2*IVX(1)                                                       STBF-180
      IST=0                                                             STBF-181
      X1=0.D0                                                           STBF-182
      Y1=-1.D0                                                          STBF-183
      IN1=0                                                             STBF-184
      IN2=0                                                             STBF-185
C SEARCH FOR THE EIGENVALUE                                             STBF-186
   18 X3=X1+A4                                                          STBF-187
   19 IST=IST+1                                                         STBF-188
      IN3=0                                                             STBF-189
      X4=X3*Y5                                                          STBF-190
C UPWARDS INTEGRATION                                                   STBF-191
      DO 20 I=KS,KR                                                     STBF-192
      X5=X4*XX(2*K2+I-1)+XX(K2+I-1)                                     STBF-193
      XX(I+1)=(2.D0+X5/(1.D0-X5/12.D0))*XX(I)-XX(I-1)                   STBF-194
      IF (XX(I+1)*XX(I).LT.0.D0) IN3=IN3+2                              STBF-195
   20 CONTINUE                                                          STBF-196
      IF (VAL(1).LT.0.D0) GO TO 29                                      STBF-197
      A1=XX(KR)                                                         STBF-198
      A2=XX(KR+1)                                                       STBF-199
      XX(K2)=1.D0                                                       STBF-200
      XX(K1)=A3*(1.D0-(X4*XX(3*KN+4)+XX(2*KN+2))/12.D0)/(1.D0-(X4*XX(3*KSTBF-201
     1N+5)+XX(2*KN+3))/12.D0)                                           STBF-202
C BACKWARDS INTEGRATION                                                 STBF-203
      DO 21 I=KR,KN                                                     STBF-204
      J=KN+KR-I                                                         STBF-205
      X5=X4*XX(2*K2+J)+XX(K2+J)                                         STBF-206
      IF (XX(J+1)*XX(J+2).LT.0.D0) IN3=IN3+2                            STBF-207
   21 XX(J)=(2.D0+X5/(1.D0-X5/12.D0))*XX(J+1)-XX(J+2)                   STBF-208
      Y3=A1/A2-XX(KR)/XX(KR+1)                                          STBF-209
      IF (Y3.GT.0.D0) IN3=IN3+1                                         STBF-210
      IF (LO(51)) WRITE (MW,1003) IST,IN3,X3,Y3                         STBF-211
      IF (DABS(Y3).LE.1.D-10.OR.X2.EQ.X3.OR.X1.EQ.X3) GO TO 27          STBF-212
      IF (IN2.NE.0) GO TO 24                                            STBF-213
      IF (IN3.GT.IK) GO TO 22                                           STBF-214
      Y1=Y3                                                             STBF-215
      X1=X3                                                             STBF-216
      IN1=IN3                                                           STBF-217
      A4=X1                                                             STBF-218
      GO TO 18                                                          STBF-219
   22 IF (LO(51)) WRITE (MW,1004) IK,IN1,IN3                            STBF-220
      X2=X3                                                             STBF-221
      IN2=IN3                                                           STBF-222
      Y2=Y3                                                             STBF-223
C INTERPOLATION OF SOLUTION                                             STBF-224
   23 X3=X1+0.5D0*(X2-X1)                                               STBF-225
      IF (IN2.EQ.IN1+1) X3=(Y1*X2-Y2*X1)/(Y1-Y2)                        STBF-226
      GO TO 19                                                          STBF-227
   24 X4=(Y1*Y2*X3*(X2-X1)+Y1*Y3*X2*(X1-X3)+Y2*Y3*X1*(X3-X2))/(Y1*Y2*(X2STBF-228
     1-X1)+Y1*Y3*(X1-X3)+Y2*Y3*(X3-X2))                                 STBF-229
      IF (IN2.GT.IN1+2) X4=1.D20                                        STBF-230
      IF (IN3.GT.IK) GO TO 25                                           STBF-231
      X1=X3                                                             STBF-232
      Y1=Y3                                                             STBF-233
      IN1=IN3                                                           STBF-234
      GO TO 26                                                          STBF-235
   25 X2=X3                                                             STBF-236
      Y2=Y3                                                             STBF-237
      IN2=IN3                                                           STBF-238
   26 IF ((X1-X4)*(X4-X2).LT.0.D0) GO TO 23                             STBF-239
      X3=X4                                                             STBF-240
      GO TO 19                                                          STBF-241
   27 Y3=A1/XX(KR)                                                      STBF-242
      DO 28 I=KR,K2                                                     STBF-243
   28 XX(I)=Y3*XX(I)                                                    STBF-244
   29 DO 30 I=1,KN                                                      STBF-245
   30 XX(I)=(XX(I)+10.D0*XX(I+1)+XX(I+2))/12.D0                         STBF-246
      IF (VAL(1).GT.0.D0) GO TO 31                                      STBF-247
      X1=XX(KN)*Z4-XX(KN-2)*Z2                                          STBF-248
      X2=XX(KN-2)*Z1-XX(KN)*Z3                                          STBF-249
      X3=Z1*Z4-Z2*Z3                                                    STBF-250
      Y2=DATAN2(X2,X1)                                                  STBF-251
      Y1=(X1**2+X2**2)/X3**2                                            STBF-252
      X3=VAL(5)                                                         STBF-253
      GO TO 33                                                          STBF-254
   31 Y1=0.D0                                                           STBF-255
      DO 32 I=1,KN                                                      STBF-256
   32 Y1=Y1+XX(I)**2                                                    STBF-257
      Y1=Y1-0.5D0*XX(KN)**2                                             STBF-258
      Y2=Y4*XX(KN)**2/RR                                                STBF-259
      Y3=IREB                                                           STBF-260
      Y1=Y1*H/Y3+Y2                                                     STBF-261
      Y2=100.D0*Y2/Y1                                                   STBF-262
   33 Y1=1.D0/DSQRT(Y1)                                                 STBF-263
      IS=0                                                              STBF-264
      RR=0.D0                                                           STBF-265
      DO 34 I=IREB,KN,IREB                                              STBF-266
      IS=IS+1                                                           STBF-267
      RR=RR+H                                                           STBF-268
   34 V(IS)=Y1*XX(I)/RR                                                 STBF-269
      IF (LO(51)) WRITE (MW,1005) X3,Y2,(IS,V(IS),IS=1,ISM)             STBF-270
      RETURN                                                            STBF-271
 1000 FORMAT (//' WOODS-SAXON POTENTIAL EIGENFUNCTION WITH N =',I2,3X,'LSTBF-272
     1 =',I3,3X,'2*S =',I2,3X,'2*J =',I3,3X,I4,' STEPS (DIVIDED BY',I3,'STBF-273
     2) MATCHING AT THE',I4,'TH'/' **** BINDING ENERGY',F12.6,' MEV ****STBF-274
     3',4X,'TOTAL MASS',F12.6,4X,'PARTICLE MASS',F12.6,4X,'PRODUCT OF CHSTBF-275
     4ARGES',F8.2/' SEARCH ON DEPTH OF REAL POTENTIAL FROM',F12.6,' WITHSTBF-276
     5 REDUCED RADIUS',F10.6,' FERMI AND DIFFUSENESS',F10.6,' FERMI'/' SSTBF-277
     6PIN-ORBIT POTENTIAL DEPTH:',F12.6,' MEV RADIUS:',F10.6,' FERMI DIFSTBF-278
     7FUSENESS:',F9.6,' FERMI COULOMB RADIUS:',F10.6,' FERMI')          STBF-279
 1001 FORMAT (10X,'NO CONVERGENCE ON MATCHING VALUES')                  STBF-280
 1002 FORMAT (10X,'MATCHING VALUE OBTAINED FOR I=',I3,' WITH',I6,' POINTSTBF-281
     1S')                                                               STBF-282
 1003 FORMAT (2X,I3,5X,'2*N (+0/1) =',I3,5X,'V =',D20.10,5X,'D =',D20.10STBF-283
     1)                                                                 STBF-284
 1004 FORMAT (' INTERPOLATION FOR 2*N =',I4,5X,'BETWEEN',I4,' AND',I4)  STBF-285
 1005 FORMAT (//' DEPTH USED',D20.10,' MEV',15X,'TAIL PERCENTAGE OR PHASSTBF-286
     1E-SHIFT',F10.5//(6(I6,D15.6)))                                    STBF-287
      END                                                               STBF-288
C 28/02/07                                                      ECIS06  DERI-000
      SUBROUTINE DERI(X,Y,H,N,LT)                                       DERI-001
C NUMERICAL DERIVATION OF THE FUNCTION Y KNOWN IN N POINTS WITH STEP H  DERI-002
C IT NEEDS AT LEAST 7 POINTS AND RETURNS IN X THE VALUE OF -D(Y)/DR     DERI-003
C IF LT IS FALSE, THE RESULT IS DIVIDED BY R..                          DERI-004
C INPUT:     Y:       FUNCTION TO BE DERIVED.                           DERI-005
C            H:       STEP SIZE OF Y.                                   DERI-006
C            N:       NUMBER OF POINTS OF Y.                            DERI-007
C            LT:      IF LT=.FALSE., THE RESULT IS DIVIDED BY R.        DERI-008
C OUTPUT:    X:       RESULT.                                           DERI-009
C***********************************************************************DERI-010
      IMPLICIT REAL*8 (A-H,O-Z)                                         DERI-011
      LOGICAL LT                                                        DERI-012
      DIMENSION X(*),Y(*)                                               DERI-013
      COMMON /INOUT/ MR,MW,MS                                           DERI-014
      N3=N-3                                                            DERI-015
      IF (N3.GE.4) GO TO 1                                              DERI-016
      WRITE (MW,1000) N                                                 DERI-017
      STOP                                                              DERI-018
    1 HH=-H*60.D0                                                       DERI-019
      X(1)=(-147.D0*Y(1)+360.D0*Y(2)-450.D0*Y(3)+400.D0*Y(4)-225.D0*Y(5)DERI-020
     1+72.D0*Y(6)-10.D0*Y(7))/HH                                        DERI-021
      X(2)=(-10.D0*Y(1)-77.D0*Y(2)+150.D0*Y(3)-100.D0*Y(4)+50.D0*Y(5)-15DERI-022
     1.D0*Y(6)+2.D0*Y(7))/HH                                            DERI-023
      X(3)=(2.D0*Y(1)-24.D0*Y(2)-35.D0*Y(3)+80.D0*Y(4)-30.D0*Y(5)+8.D0*YDERI-024
     1(6)-Y(7))/HH                                                      DERI-025
      DO 2 I=4,N3                                                       DERI-026
    2 X(I)=(45.D0*(Y(I+1)-Y(I-1))-9.D0*(Y(I+2)-Y(I-2))+Y(I+3)-Y(I-3))/HHDERI-027
      X(N-2)=(Y(N-6)-8.D0*Y(N-5)+30.D0*Y(N-4)-80.D0*Y(N3)+35.D0*Y(N-2)+2DERI-028
     14.D0*Y(N-1)-2.D0*Y(N))/HH                                         DERI-029
      X(N-1)=(-2.D0*Y(N-6)+15.D0*Y(N-5)-50.D0*Y(N-4)+100.D0*Y(N3)-150.D0DERI-030
     1*Y(N-2)+77.D0*Y(N-1)+10.D0*Y(N))/HH                               DERI-031
      X(N)=(10.D0*Y(N-6)-72.D0*Y(N-5)+225.D0*Y(N-4)-400.D0*Y(N3)+450.D0*DERI-032
     1Y(N-2)-360.D0*Y(N-1)+147.D0*Y(N))/HH                              DERI-033
      IF (LT) RETURN                                                    DERI-034
      R=0.D0                                                            DERI-035
      DO 3 I=1,N                                                        DERI-036
      R=R+H                                                             DERI-037
    3 X(I)=X(I)/R                                                       DERI-038
      RETURN                                                            DERI-039
 1000 FORMAT (5X,I5,' POINTS INSUFFICIENT FOR DERIVATION'///' IN DERI  .DERI-040
     1..  STOP  ...')                                                   DERI-041
      END                                                               DERI-042
C 20/08/06                                                      ECIS06  FOLD-000
      SUBROUTINE FOLD(V1,V2,VAL,NFO,IP,ISM,IST,IVY,INVZ,FR,PGN,XGN,WV,IZFOLD-001
     1Z,LO)                                                             FOLD-002
C V1 ARE THE POTENTIALS AND FORM FACTORS, UNFOLDED AS INPUT, FOLDED AS  FOLD-003
C OUTPUT. V2 ARE WORKING FIELDS IN WHICH 0. ARE STORED BEFORE THE CALL. FOLD-004
C INPUT:     V1:      POTENTIALS OR FORM FACTORS TO BE FOLDED.          FOLD-005
C            VAL(I,J):FOLDING PARAMETERS FOR THE FOLDING SETS J.        FOLD-006
C            NFO:     NUMBER OF SETS OF FOLDING PARAMETERS              FOLD-007
C            IP:      POTENTIAL TO BE FOLDED IF LO(7)=.FALSE.           FOLD-008
C            ISM:     NUMBER OF POINTS.                                 FOLD-009
C            IST:     MAXIMUM NUMBER OF STEPS FOR FOLDING FUNCTIONS.    FOLD-010
C            IVY:     TABLE OF FORM FACTORS (SEE REDM).                 FOLD-011
C            INVZ:    NUMBER OF TRANSITION FORM FACTORS TO FOLD.        FOLD-012
C            PGN:     WEIGHTS OF GAUSS-LEGENDRE INTEGRATION.            FOLD-013
C            XGN:   : ABSCISSAE OF GAUSS-LEGENDRE INTEGRATION.          FOLD-014
C            WV(J):   STEP SIZE FOR J=8.                                FOLD-015
C            LO(I):   LOGICAL CONTROLS:                                 FOLD-016
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    FOLD-017
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              FOLD-018
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            FOLD-019
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      FOLD-020
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. FOLD-021
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   FOLD-022
C               LO(100)=.TRUE. DIRAC EQUATION.                          FOLD-023
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    FOLD-024
C               LO(102)=.TRUE. THERE IS AN IMAGINARY SPIN-ORBIT         FOLD-025
C                              POTENTIAL.                               FOLD-026
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. FOLD-027
C OUTPUT:    V1:     :POTENTIALS OR FORM FACTORS FOLDED.                FOLD-028
C WORKING AREAS:                                                        FOLD-029
C            V2:      AREA INITIALISED TO 0.                            FOLD-030
C            FR(I,*): GAUSSIAN OR SAXON FOLDING FUNCTIONS FOR J=1,IMT.  FOLD-031
C                     FOR YUKAWA OR HULTHEN FOLDING: H-FUNCTIONS FOR    FOLD-032
C                     J=1,IMT, J-FUNCTIONS FOR J=IMT+1,2*IMT;           FOLD-033
C                     THESE FUNCTIONS ARE MULTIPLIED BY                 FOLD-034
C                     R*R*EXP(+\-R/VA). INTEGRALS WITH H AND J-FUNCTIONSFOLD-035
C                     FOR J=2*IMT+1,2*IMT+2.                            FOLD-036
C            IZZ(I,*):ADDRESS OF FOLDING PARAMETERS BELOW FOR I=1,      FOLD-037
C                     TYPE OF FORM FACTOR FROM 1 TO 16 FOR I=2,         FOLD-038
C                     ANGULAR MOMENTUM FOR I=3,                         FOLD-039
C                     ADDRESS OF STEP SIZE FOR I=4.                     FOLD-040
C                    (THIS PART IS AN INPUT WITH EXTERNAL FORM FACTORS) FOLD-041
C                                                                       FOLD-042
C FOR THE COMMON  /CONVE/ SEE CALX.                                     FOLD-043
C FOR THE COMMON  /POTE1/ SEE REDM.                                     FOLD-044
C                                                                       FOLD-045
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     FOLD-046
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         FOLD-047
C   USED:     ACONV.                                                    FOLD-048
C                                                                       FOLD-049
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE1/:                     FOLD-050
C  ITX(16):   STARTING ADDRESS OF DIFFERENT FORM FACTORS (SEE REDM).    FOLD-051
C  INTC:      NUMBER OF FORM FACTORS WITHOUT DEFORMED SPIN-ORBIT        FOLD-052
C             INCLUDING CORRECTION TERMS.                               FOLD-053
C  INLS:      NUMBER OF SPIN-ORBIT FORM FACTORS NOT TAKING INTO ACCOUNT FOLD-054
C             MULTIPLICATION BY 2.                                      FOLD-055
C  INVD:      IDEM FOR COULOMB SPIN-ORBIT.                              FOLD-056
C  ITXM:      TOTAL NUMBER OF FORM FACTORS.                             FOLD-057
C   USED:     ITX,INTC,INLS,INVD,ITXM.                                  FOLD-058
C                                                                       FOLD-059
C FOLDING CONVENTIONS : VAL(*,1-3) REAL POTENTIAL, IMAGINARY, COULOMB.  FOLD-060
C IF VAL(1,*)=0  NO FOLDING.                                            FOLD-061
C IF VAL(3,*)=0 GAUSSIAN FORM FACTOR WITH RANGE VAL(2,*).               FOLD-062
C IF VAL(2,*)=0 HULTHEN FORM FACTOR WITH RANGES VAL(1,*) AND VAL(3,*).  FOLD-063
C IF VAL(2,*)=VAL(3,*)=0 YUKAWA FORM FACTOR WITH RANGE VAL(1,*).        FOLD-064
C ALL OTHER CASES  SAXON FORM FACTOR WITH RADIUS VAL(2,*) AND DIFFUSE-  FOLD-065
C NESS VAL(3,*) - ALL FORM FACTORS ARE NORMALISED - VAL(1,*) IS USED    FOLD-066
C ONLY FOR HULTHEN FORM FACTOR.                                         FOLD-067
C THE DIFFUSENESS OF A SAXON FORM FACTOR AND THE RANGES OF A HULTHEN OR FOLD-068
C YUKAWA FORM FACTOR ARE POSITIVE BY TAKING THE ABSOLUTE VALUE.         FOLD-069
C                                                                       FOLD-070
C***********************************************************************FOLD-071
      IMPLICIT REAL*8 (A-H,O-Z)                                         FOLD-072
      LOGICAL LO(150)                                                   FOLD-073
      DIMENSION V1(ISM,*),V2(ISM,*),VAL(3,3),IVY(7,*),FR(IST,*),PGN(10),FOLD-074
     1XGN(10),WV(22,*),IZZ(4,*),MM(3)                                   FOLD-075
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       FOLD-076
      COMMON /INOUT/ MR,MW,MS                                           FOLD-077
      COMMON /POTE1/ ITX(16),IMAX,INTC,INLS,INVC,INVD,ITXM              FOLD-078
      DATA PIM2 /6.2831853070D0/                                        FOLD-079
      AC=-DLOG(ACONV)                                                   FOLD-080
      JSL=ISM+1                                                         FOLD-081
      ITXN=ITXM                                                         FOLD-082
      IF (LO(100)) ITXN=ITXN-ITX(2)                                     FOLD-083
      IF (LO(7)) GO TO 9                                                FOLD-084
C INITIALISATION OF THE TABLE IZZ WHEN POTENTIALS ARE NOT EXTERNAL.     FOLD-085
      MM(1)=1                                                           FOLD-086
      MM(2)=2                                                           FOLD-087
      MM(3)=3                                                           FOLD-088
      IF ((VAL(1,2).EQ.VAL(1,1)).AND.(VAL(2,2).EQ.VAL(2,1)).AND.(VAL(3,2FOLD-089
     1).EQ.VAL(3,1))) MM(2)=1                                           FOLD-090
      IF ((VAL(1,3).EQ.VAL(1,2)).AND.(VAL(2,3).EQ.VAL(2,2)).AND.(VAL(3,3FOLD-091
     1).EQ.VAL(3,2))) MM(3)=2                                           FOLD-092
      IF ((VAL(1,3).EQ.VAL(1,1)).AND.(VAL(2,3).EQ.VAL(2,1)).AND.(VAL(3,3FOLD-093
     1).EQ.VAL(3,1))) MM(3)=1                                           FOLD-094
      NFOX=MAX0(MM(1),MM(2),MM(3))                                      FOLD-095
      DO 2 J=1,ITXN                                                     FOLD-096
      DO 1 I=1,3                                                        FOLD-097
    1 IZZ(I,J)=0                                                        FOLD-098
    2 IZZ(4,J)=IP                                                       FOLD-099
      DO 3 I=1,8                                                        FOLD-100
      IF ((I.EQ.5).AND.(.NOT.LO(101))) GO TO 3                          FOLD-101
      IF ((I.EQ.6).AND.(.NOT.LO(102))) GO TO 3                          FOLD-102
      IF ((I.EQ.8).AND.(.NOT.LO(103))) GO TO 3                          FOLD-103
      M=MOD(I+1,2)+1                                                    FOLD-104
      IF (I.GT.6) M=3                                                   FOLD-105
      N=I                                                               FOLD-106
      IF (.NOT.LO(100)) N=1+ITX(I)                                      FOLD-107
      IZZ(1,N)=-MM(M)                                                   FOLD-108
      IZZ(2,N)=I                                                        FOLD-109
    3 CONTINUE                                                          FOLD-110
      IF (INVZ.EQ.0) GO TO 9                                            FOLD-111
      IJ=ITX(3)-ITX(7)                                                  FOLD-112
      DO 8 J=1,INTC                                                     FOLD-113
      DO 7 I=1,8                                                        FOLD-114
      M=MOD(I+1,2)+1                                                    FOLD-115
      N=I+IJ                                                            FOLD-116
      IF (I.GT.6) GO TO 5                                               FOLD-117
      IF (I.GT.4) GO TO 4                                               FOLD-118
      IF ((M.EQ.2).AND.(.NOT.LO(12))) GO TO 7                           FOLD-119
      IF (.NOT.LO(100)) N=J+ITX(I+8)                                    FOLD-120
      GO TO 6                                                           FOLD-121
    4 IF (.NOT.LO(8+I)) GO TO 7                                         FOLD-122
      IF (.NOT.LO(100)) N=IVY(3,J)+ITX(I+8)                             FOLD-123
      GO TO 6                                                           FOLD-124
    5 IF (.NOT.LO(8*I-45)) GO TO 7                                      FOLD-125
      IF (.NOT.LO(100)) N=ITX(I+8)+IVY(I-3,J)                           FOLD-126
      M=3                                                               FOLD-127
    6 IZZ(1,N)=-MM(M)                                                   FOLD-128
      IZZ(2,N)=I+8                                                      FOLD-129
      IZZ(3,N)=IVY(7,J)                                                 FOLD-130
    7 CONTINUE                                                          FOLD-131
    8 IJ=IJ+11                                                          FOLD-132
C CLASSIFICATION OF STEP SIZES.                                         FOLD-133
    9 DO 11 I=2,ITXN                                                    FOLD-134
      IF (IZZ(1,I).EQ.0) GO TO 11                                       FOLD-135
      DO 10 J=2,I                                                       FOLD-136
      IF (IZZ(1,J-1).NE.IZZ(1,I)) GO TO 10                              FOLD-137
      IF (IZZ(4,J-1).EQ.IZZ(4,I)) GO TO 10                              FOLD-138
      I1=IZZ(4,I)                                                       FOLD-139
      J1=IZZ(4,J-1)                                                     FOLD-140
      IF (WV(8,I1).NE.WV(8,J1)) GO TO 10                                FOLD-141
      IZZ(4,I)=J1                                                       FOLD-142
      GO TO 11                                                          FOLD-143
   10 CONTINUE                                                          FOLD-144
   11 CONTINUE                                                          FOLD-145
      NFOT=-NFO                                                         FOLD-146
C FOR EXTERNAL POTENTIALS, ADD 1 FOR DUMMY FOLDING.                     FOLD-147
      IF (LO(7)) NFOX=NFO+1                                             FOLD-148
C LOOP ON FOLDINGS.                                                     FOLD-149
      DO 64 II=1,NFOX                                                   FOLD-150
      IF (II.GT.NFO) GO TO 54                                           FOLD-151
      IC=0                                                              FOLD-152
      DO 12 J=1,3                                                       FOLD-153
      IF (VAL(J,II).NE.0.D0) IC=IC+2**(3-J)                             FOLD-154
      IF (VAL(J,II).GE.0.D0) GO TO 12                                   FOLD-155
      WRITE (MW,1000) VAL(J,II),J,II                                    FOLD-156
      VAL(J,II)=-VAL(J,II)                                              FOLD-157
   12 CONTINUE                                                          FOLD-158
      IF (IC.LT.4) GO TO 64                                             FOLD-159
      IH=0                                                              FOLD-160
   13 IMT=1                                                             FOLD-161
      JH=0                                                              FOLD-162
      KH=0                                                              FOLD-163
C SEPARATION OF FOLDINGS WITH RESPECT TO THE STEP SIZE.                 FOLD-164
      DO 14 J=1,ITXN                                                    FOLD-165
      IF (IZZ(1,J)+II.NE.0) GO TO 14                                    FOLD-166
      IF (IZZ(4,J).LT.IH) GO TO 14                                      FOLD-167
      KH=KH+1                                                           FOLD-168
      IF ((JH.NE.0).AND.(IZZ(4,J).GT.IH)) GO TO 14                      FOLD-169
      JH=JH+1                                                           FOLD-170
      IH=IZZ(4,J)                                                       FOLD-171
      IZZ(1,J)=NFOT-1                                                   FOLD-172
      IMT=MAX0(IMT,IZZ(3,J)+1)                                          FOLD-173
   14 CONTINUE                                                          FOLD-174
      IF (JH.EQ.0) GO TO 64                                             FOLD-175
      NFOT=NFOT-1                                                       FOLD-176
      HH=WV(8,IH)                                                       FOLD-177
C COMPUTATION OF THE STRENGTH OF THE FOLDING FUNCTIONS.                 FOLD-178
      CN=1.D0                                                           FOLD-179
      IF (IC.GT.5) GO TO 15                                             FOLD-180
C YUKAWA FOLDING.                                                       FOLD-181
      IF (VAL(3,II).EQ.VAL(1,II)) VAL(3,II)=.99D0*VAL(1,II)             FOLD-182
      CN=HH/(2.D0*PIM2*(VAL(1,II)**2-VAL(3,II)**2))                     FOLD-183
      JST=ISM+5                                                         FOLD-184
      GO TO 18                                                          FOLD-185
   15 IF (IC.EQ.7) GO TO 16                                             FOLD-186
C GAUSSIAN FOLDING.                                                     FOLD-187
      ISY=1+IDINT(VAL(2,II)*DSQRT(AC)/HH)                               FOLD-188
      CN=HH/(0.5D0*PIM2*DSQRT(0.5D0*PIM2)*VAL(2,II)**3)                 FOLD-189
      GO TO 18                                                          FOLD-190
C SAXON FOLDING.                                                        FOLD-191
   16 IS=1+IDINT((VAL(2,II)+10.D0*VAL(3,II))/HH)                        FOLD-192
      ISY=1+IDINT((VAL(2,II)+2.D0*VAL(3,II)*AC)/HH)                     FOLD-193
      CN=0.D0                                                           FOLD-194
      DO 17 K=1,IS                                                      FOLD-195
      RR=HH*K                                                           FOLD-196
   17 CN=CN+RR*RR/(1.D0+DEXP((RR-VAL(2,II))/VAL(3,II)))                 FOLD-197
      CN=.5D0/(PIM2*CN)                                                 FOLD-198
C GAUSSIAN OR SAXON FOLDING.                                            FOLD-199
   18 AN=DFLOAT(IMT-1)                                                  FOLD-200
      IF (IC.LT.6) GO TO 36                                             FOLD-201
C DO LOOP ON THE POINTS OF POTENTIALS.                                  FOLD-202
      FS=0.D0                                                           FOLD-203
      IS=0                                                              FOLD-204
   19 IS=IS+1                                                           FOLD-205
      JST=IS+ISY                                                        FOLD-206
      JSM=MIN0(ISM,JST)                                                 FOLD-207
      R=VAL(2,II)                                                       FOLD-208
      A=VAL(3,II)                                                       FOLD-209
      X1=HH*DFLOAT(IS)                                                  FOLD-210
      IF (JST.LE.ISM) GO TO 20                                          FOLD-211
      JSZ=MAX0(ISM,1+IS+2*IDINT((R+2.D0*A)/HH))                         FOLD-212
      JST=MIN0(JST,JSZ+4)                                               FOLD-213
      ISZ=JSZ-1                                                         FOLD-214
      ISX=JST-JSZ                                                       FOLD-215
C LOOP ON THE POINTS OF THE FOLDING FUNCTION FOR WHICH THE SYMMETRY     FOLD-216
C BETWEEN THE TWO ARGUMENTS IS USED.                                    FOLD-217
   20 JI=IS-1                                                           FOLD-218
   21 JI=JI+1                                                           FOLD-219
      A3=HH*JI                                                          FOLD-220
      A4=2.D0*X1*A3                                                     FOLD-221
      Y=X1*X1+A3*A3                                                     FOLD-222
      IF (A.EQ.0.D0) GO TO 25                                           FOLD-223
C SAXON FOLDING FUNCTION  BY A 20-POINTS GAUSSIAN INTEGRATION           FOLD-224
C THE SAXON FORM FACTOR ITSELF IS THE VARIABLE.                         FOLD-225
      DO 22 K=1,IMT                                                     FOLD-226
   22 FR(JI,K)=0.D0                                                     FOLD-227
      R1=DMIN1(70.D0,(DABS(X1-A3)-R)/A)                                 FOLD-228
      R2=DMIN1(70.D0,(X1+A3-R)/A)                                       FOLD-229
      E1=1.D0/(1.D0+DEXP(R1))                                           FOLD-230
      E2=1.D0/(1.D0+DEXP(R2))                                           FOLD-231
      EM=0.5D0*(E1+E2)                                                  FOLD-232
      ES=0.5D0*(E1-E2)                                                  FOLD-233
      P1=ES*2.D0*A*PIM2/A4                                              FOLD-234
      DO 24 IJ=1,10                                                     FOLD-235
      PP=P1*PGN(IJ)                                                     FOLD-236
      E1=1.D0/(EM+ES*XGN(IJ))-1.D0                                      FOLD-237
      E2=1.D0/(EM-ES*XGN(IJ))-1.D0                                      FOLD-238
      U1=R+A*DLOG(E1)                                                   FOLD-239
      U2=R+A*DLOG(E2)                                                   FOLD-240
      R1=PP*U1*(1.D0+E1)/E1                                             FOLD-241
      R2=PP*U2*(1.D0+E2)/E2                                             FOLD-242
      FR(JI,1)=FR(JI,1)+R1+R2                                           FOLD-243
      IF (IMT.EQ.1) GO TO 24                                            FOLD-244
      E1=(Y-U1*U1)/A4                                                   FOLD-245
      E2=(Y-U2*U2)/A4                                                   FOLD-246
      R3=R1*E1                                                          FOLD-247
      R4=R2*E2                                                          FOLD-248
      FR(JI,2)=FR(JI,2)+R3+R4                                           FOLD-249
      IF (IMT.EQ.2) GO TO 24                                            FOLD-250
C RECURRENCE FOR LEGENDRE POLYNOMIALS.                                  FOLD-251
      DO 23 K=3,IMT                                                     FOLD-252
      R5=R1                                                             FOLD-253
      R6=R2                                                             FOLD-254
      R1=R3                                                             FOLD-255
      R2=R4                                                             FOLD-256
      R3=(DFLOAT(2*K-3)*R1*E1-R5*DFLOAT(K-2))/DFLOAT(K-1)               FOLD-257
      R4=(DFLOAT(2*K-3)*R2*E2-R6*DFLOAT(K-2))/DFLOAT(K-1)               FOLD-258
   23 FR(JI,K)=FR(JI,K)+R3+R4                                           FOLD-259
   24 CONTINUE                                                          FOLD-260
      GO TO 29                                                          FOLD-261
C GAUSSIAN FOLDING FUNCTION.                                            FOLD-262
   25 A4=A4/(R*R)                                                       FOLD-263
      Y=Y/(R*R)                                                         FOLD-264
      B1=DEXP(A4-Y)                                                     FOLD-265
      B2=0.D0                                                           FOLD-266
      IF (A4+Y.LT.50.) B2=DEXP(-A4-Y)                                   FOLD-267
      DN=1.D0/A4                                                        FOLD-268
   26 FR(JI,1)=PIM2*(B1-B2)*DN                                          FOLD-269
      IF (IMT.EQ.1) GO TO 29                                            FOLD-270
C DOWNWARDS RECURRENCE FOR SMALL ARGUMENTS.                             FOLD-271
      Q=DMAX1(DSQRT(10.5D0*A4)-0.5D0,AN)                                FOLD-272
      K=IDINT(Q+3.D0+21.D0*A4/(Q+Q+1.D0))                               FOLD-273
      A1=0.D0                                                           FOLD-274
   27 A1=A4/(2.D0*K+1.D0+A4*A1)                                         FOLD-275
      IF (K.LT.IMT) FR(JI,K+1)=A1                                       FOLD-276
      K=K-1                                                             FOLD-277
      IF (K.GT.0) GO TO 27                                              FOLD-278
      DO 28 K=2,IMT                                                     FOLD-279
   28 FR(JI,K)=FR(JI,K)*FR(JI,K-1)                                      FOLD-280
   29 IF (IC.LT.6) GO TO 39                                             FOLD-281
      IF (JI.LT.JST) GO TO 21                                           FOLD-282
      IK=1                                                              FOLD-283
      GO TO 46                                                          FOLD-284
   30 IK=2                                                              FOLD-285
      IF (JST.LE.ISM) GO TO 46                                          FOLD-286
C FORM THE COULOMB POTENTIALS,ASYMPTOTIC CORRECTION.                    FOLD-287
C THE FORM FACTORS ARE ASSUMED TO DECREASE AS (R)**(-L-1).              FOLD-288
      A1=DFLOAT(ISM)                                                    FOLD-289
      DO 32 I=JSL,JST                                                   FOLD-290
      Y=A1/DFLOAT(I)                                                    FOLD-291
      A4=DFLOAT(ISM*I)*HH**2                                            FOLD-292
      DO 31 J=1,IMT                                                     FOLD-293
      FR(I,J)=FR(I,J)*A4                                                FOLD-294
   31 A4=A4*Y                                                           FOLD-295
   32 CONTINUE                                                          FOLD-296
C CORRECTION OF THE LAST VALUE BY SUM BETWEEN ISM AND JSZ AND A PADE    FOLD-297
C APPROXIMATION LIMITED TO FOUR TERMS (BETWEEN JSZ+1 AND JST).          FOLD-298
      DO 35 I=1,IMT                                                     FOLD-299
      A1=0.D0                                                           FOLD-300
      A2=0.D0                                                           FOLD-301
      A3=0.D0                                                           FOLD-302
      A4=0.D0                                                           FOLD-303
      Y=0.D0                                                            FOLD-304
      IF (JSL.GT.ISZ) GO TO 34                                          FOLD-305
      DO 33 J=JSL,ISZ                                                   FOLD-306
   33 Y=Y+FR(J,I)                                                       FOLD-307
   34 IF (ISX.EQ.0.OR.FR(JSZ,I).EQ.0.D0) GO TO 35                       FOLD-308
      A1=-FR(JSZ+1,I)/FR(JSZ,I)                                         FOLD-309
      IF (ISX.EQ.1.OR.FR(JSZ+1,I).EQ.0.D0) GO TO 35                     FOLD-310
      B1=FR(JSZ+2,I)/FR(JSZ+1,I)                                        FOLD-311
      A2=-A1-B1                                                         FOLD-312
      IF (ISX.EQ.2.OR.A2.EQ.0.D0) GO TO 35                              FOLD-313
      B2=FR(JSZ+3,I)/FR(JSZ+1,I)                                        FOLD-314
      C1=-(B1*A1+B2)/A2                                                 FOLD-315
      A3=B1-C1                                                          FOLD-316
      IF (ISX.EQ.3.OR.A3.EQ.0.D0) GO TO 35                              FOLD-317
      A4=C1-(B2+(B2*A1+FR(JSZ+4,I)/FR(JSZ+1,I))/A2)/A3                  FOLD-318
   35 FR(JSL,I)=Y+FR(JSZ,I)/(1.D0+A1/(1.D0+A2/(1.D0+A3/(1.D0+A4))))     FOLD-319
      GO TO 46                                                          FOLD-320
C LOOP ON THE TWO YUKAWA FORM FACTORS.                                  FOLD-321
   36 FS=1.D0                                                           FOLD-322
      VA=VAL(1,II)                                                      FOLD-323
   37 IF (VA.EQ.0.D0) GO TO 53                                          FOLD-324
C COMPUTATION OF BESSEL FUNCTIONS MULTIPLIED BY R*R AND EXP(R/VA).      FOLD-325
      JI=0                                                              FOLD-326
      B1=1.D0                                                           FOLD-327
      B2=1.D0                                                           FOLD-328
      B4=DEXP(-HH/VA)                                                   FOLD-329
   38 JI=JI+1                                                           FOLD-330
      A2=HH*DFLOAT(JI)                                                  FOLD-331
      A4=A2/VA                                                          FOLD-332
      B2=B2*B4**2                                                       FOLD-333
      FR(JI,IMT+1)=FS*A2                                                FOLD-334
      DN=A2*VA                                                          FOLD-335
      GO TO 26                                                          FOLD-336
C UPWARDS RECURRENCE FOR THE IRREGULAR FUNCTION.                        FOLD-337
   39 FR(JI,IMT+2)=FR(JI,IMT+1)*(1.D0+1.D0/A4)                          FOLD-338
      IF (IMT.EQ.2) GO TO 41                                            FOLD-339
      DO 40 K=3,IMT                                                     FOLD-340
   40 FR(JI,K+IMT)=FR(JI,K-2+IMT)+FR(JI,K-1+IMT)*(2*K-3)/A4             FOLD-341
   41 IF (JI.LT.JST) GO TO 38                                           FOLD-342
C CORRECTIONS FOR SINGULAR FIRST DERIVATIVE (YUKAWA FORM FACTOR).       FOLD-343
      VR=-FS*HH*PIM2/6.D0                                               FOLD-344
      IK=1                                                              FOLD-345
      GO TO 46                                                          FOLD-346
C CORRECTION FOR COULOMB POTENTIALS.                                    FOLD-347
   42 A6=DFLOAT(ISM)                                                    FOLD-348
      DO 44 I=JSL,JST                                                   FOLD-349
      Y=A6/DFLOAT(I)                                                    FOLD-350
      A1=Y                                                              FOLD-351
      DO 43 J=1,IMT                                                     FOLD-352
      FR(I,J+IMT)=FR(I,J+IMT)*A1                                        FOLD-353
   43 A1=A1*Y                                                           FOLD-354
   44 CONTINUE                                                          FOLD-355
C ESTIMATION OF THE LAST VALUE BY A PADE OF FOUR TERMS.                 FOLD-356
      DO 45 I=1,IMT                                                     FOLD-357
      A6=-FR(JSL+1,I+IMT)/FR(JSL,I+IMT)                                 FOLD-358
      IF (I.EQ.1) GO TO 45                                              FOLD-359
      B2=FR(JSL+2,I+IMT)/FR(JSL+1,I+IMT)                                FOLD-360
      A2=-A6-B2                                                         FOLD-361
      B3=FR(JSL+3,I+IMT)/FR(JSL+1,I+IMT)                                FOLD-362
      C1=-(B2*A6+B3)/A2                                                 FOLD-363
      A4=B2-C1                                                          FOLD-364
      A1=C1-(B3+(B3*A6+FR(JSL+4,I+IMT)/FR(JSL+1,I+IMT))/A2)/A4          FOLD-365
      A6=A6/(1.D0+B4*A2/(1.D0+B4*A4/(1.D0+B4*A1)))                      FOLD-366
   45 FR(JSL,I+IMT)=FR(JSL,I+IMT)/(1.D0+B4*A6)                          FOLD-367
      IK=2                                                              FOLD-368
C FOLDING OF THE POTENTIALS.                                            FOLD-369
   46 DO 51 K=1,ITXN                                                    FOLD-370
      IF (IZZ(1,K).NE.NFOT) GO TO 51                                    FOLD-371
      IF ((IK.EQ.1).AND.MOD(IZZ(2,K),8).GT.6) GO TO 51                  FOLD-372
      IF ((IK.EQ.2).AND.MOD(IZZ(2,K),8).LE.6) GO TO 51                  FOLD-373
      N=IZZ(3,K)+1                                                      FOLD-374
      IF (IC.LT.6) GO TO 48                                             FOLD-375
      DO 47 JS=IS,JSM                                                   FOLD-376
      B1=(HH*DFLOAT(JS))**2                                             FOLD-377
      IF (JS.EQ.IS) GO TO 47                                            FOLD-378
      V2(JS,K)=V2(JS,K)+V1(IS,K)*FR(JS,N)*X1**2                         FOLD-379
   47 V2(IS,K)=V2(IS,K)+V1(JS,K)*FR(JS,N)*B1                            FOLD-380
      IF ((IK.EQ.2).AND.(JST.GT.ISM)) V2(IS,K)=V2(IS,K)+V1(ISM,K)*FR(JSLFOLD-381
     1,N)                                                               FOLD-382
      GO TO 51                                                          FOLD-383
   48 B2=0.D0                                                           FOLD-384
      B3=FR(JSL,N+IMT)*V1(ISM,K)                                        FOLD-385
      DO 49 IS=1,ISM                                                    FOLD-386
      JS=JSL-IS                                                         FOLD-387
      FR(JS,2*IMT+1)=B3*B4                                              FOLD-388
      B2=B2*B4+FR(IS,N)*V1(IS,K)                                        FOLD-389
      B3=B3*B4+FR(JS,N+IMT)*V1(JS,K)                                    FOLD-390
   49 FR(IS,2*IMT+2)=B2                                                 FOLD-391
      DO 50 IS=1,ISM                                                    FOLD-392
      RR=(IS*HH)**2                                                     FOLD-393
   50 V2(IS,K)=V2(IS,K)+(FR(IS,N)*FR(IS,2*IMT+1)+FR(IS,N+IMT)*FR(IS,2*IMFOLD-394
     1T+2))/RR+V1(IS,K)*VR                                              FOLD-395
   51 CONTINUE                                                          FOLD-396
      IF (IC.LT.6) GO TO 52                                             FOLD-397
      IF (IK.EQ.1) GO TO 30                                             FOLD-398
      IF (IS.LT.ISM) GO TO 19                                           FOLD-399
   52 IF (IK.EQ.1) GO TO 42                                             FOLD-400
   53 FS=-FS                                                            FOLD-401
      IF (FS.GE.0.D0) GO TO 55                                          FOLD-402
      VA=VAL(3,II)                                                      FOLD-403
      GO TO 37                                                          FOLD-404
C TRANSFER OF POTENTIALS FROM WORKING SPACE.                            FOLD-405
   54 NFOT=1                                                            FOLD-406
   55 DO 63 J=1,ITXN                                                    FOLD-407
      IF (IZZ(1,J).NE.NFOT) GO TO 63                                    FOLD-408
      IF (NFOT.EQ.1) GO TO 57                                           FOLD-409
      DO 56 IS=1,ISM                                                    FOLD-410
   56 V1(IS,J)=CN*V2(IS,J)                                              FOLD-411
      GO TO 58                                                          FOLD-412
C STEP SIZE FOR DUMMY FOLDING.                                          FOLD-413
   57 IH=IZZ(4,J)                                                       FOLD-414
      HH=WV(8,IH)                                                       FOLD-415
   58 IF (.NOT.LO(100).OR.(IZZ(2,J).GT.8)) GO TO 59                     FOLD-416
      CALL DERI(V1(1,J+8),V1(1,J),HH,ISM,.TRUE.)                        FOLD-417
      CALL DERI(V1(1,J+16),V1(1,J+8),HH,ISM,.TRUE.)                     FOLD-418
      GO TO 63                                                          FOLD-419
   59 IX=MOD(IZZ(2,J)-1,8)+1                                            FOLD-420
      IF ((IX.LT.5).OR.(IX.EQ.7)) GO TO 63                              FOLD-421
      IML=0                                                             FOLD-422
      INL=0                                                             FOLD-423
      IF (LO(100)) GO TO 60                                             FOLD-424
      IF (IZZ(2,J).LE.8) GO TO 61                                       FOLD-425
      INL=INLS                                                          FOLD-426
      IF (IX.EQ.8) INL=INVD                                             FOLD-427
      GO TO 61                                                          FOLD-428
   60 IF (IZZ(2,J).LE.8) GO TO 63                                       FOLD-429
      IML=4                                                             FOLD-430
      IF (IX.EQ.8) IML=3                                                FOLD-431
   61 CALL DERI(V2(1,J),V1(1,J),HH,ISM,LO(100))                         FOLD-432
      DO 62 IS=1,ISM                                                    FOLD-433
      IF (INL.EQ.0) GO TO 62                                            FOLD-434
      AY=DFLOAT(IS)*HH                                                  FOLD-435
      V1(IS,J+INL)=-V1(IS,J)/AY**2                                      FOLD-436
   62 V1(IS,J+IML)=V2(IS,J)                                             FOLD-437
   63 CONTINUE                                                          FOLD-438
      IF (KH.NE.JH.AND.NFOT.NE.1) GO TO 13                              FOLD-439
   64 CONTINUE                                                          FOLD-440
      RETURN                                                            FOLD-441
 1000 FORMAT (' NEGATIVE VALUE',D15.5,4X,'OF FOLDING PARAMETER VAL(',I3,FOLD-442
     1',',I3,')')                                                       FOLD-443
      END                                                               FOLD-444
C 28/02/07                                                      ECIS06  TLNC-000
      SUBROUTINE TLNC(HH,IPI,WV,TL,ISM,X,FF,LM,NN,DD,IL,V,VCO,LO)       TLNC-001
C TRANSMISSION COEFFICIENTS OF UNCOUPLED STATES FOR COMPOUND NUCLEUS.   TLNC-002
C INPUT:     HH:      STEP SIZE FOR THE GROUND STATE.                   TLNC-003
C            IPI,WV:  IPI AND WV FOR THIS STATE (SEE CALX).             TLNC-004
C            ISM:     NUMBER OF STEPS.                                  TLNC-005
C            LM:      NUMBER OF COULOMB FUNCTIONS NEEDED.               TLNC-006
C            IL:      LENGTH OF WORKING SPACE.                          TLNC-007
C            V:       POTENTIALS REAL AND IMAGINARY.                    TLNC-008
C            VCO:     STRENGTH OF LONG RANGE COULOMB CORRECTION.        TLNC-009
C            LO(I):   LOGICAL CONTROLS:                                 TLNC-010
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   TLNC-011
C               LO(26) =.TRUE. INTEGRATION STABILISED FOR LONG RANGE    TLNC-012
C                              CONSTANT POTENTIAL.                      TLNC-013
C               LO(27) =.TRUE. NUMEROV'S METHOD FOR SINGLE EQUATIONS.   TLNC-014
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     TLNC-015
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. TLNC-016
C               LO(129)=.TRUE. REAL SPIN-ORBIT OR DIRAC EQUATION.       TLNC-017
C               LO(130)=.TRUE. IMAGINARY SPIN-ORBIT OR DIRAC EQUATION.  TLNC-018
C               LO(133)=.TRUE. STORE SCALAR AND COULOMB POTENTIAL       TLNC-019
C                              INDEPENDENTLY.                           TLNC-020
C OUTPUT:    TL:      TRANSMISSION COEFFICIENTS OF UNCOUPLED LEVELS.    TLNC-021
C WORKING AREAS:                                                        TLNC-022
C            X:       FOR THE INTEGRATION.                              TLNC-023
C            FF:      FOR COULOMB FUNCTIONS AND CORRECTIONS.            TLNC-024
C            NN:      NEEDED BY SUBROUTINE FCOU.                        TLNC-025
C            DD:      NEEDED BY SUBROUTINE CORI.                        TLNC-026
C***********************************************************************TLNC-027
      IMPLICIT REAL*8 (A-H,O-Z)                                         TLNC-028
      LOGICAL LO(150)                                                   TLNC-029
      DIMENSION IPI(11),WV(22),TL(*),X(2,*),FF(LM,*),NN(*),DD(*),V(ISM,*TLNC-030
     1),VCO(2),FAM(4),B(4),G(4),AV(5)                                   TLNC-031
      IF (WV(3).LE.0.D0) RETURN                                         TLNC-032
      J=0                                                               TLNC-033
      CALL FCOU(IPI(10),WV(5),ISM*WV(8)*WV(11),FF,FF(1,2),FF(1,3),FF(1,4TLNC-034
     1),NN,FF(1,5))                                                     TLNC-035
      JC=0                                                              TLNC-036
      IF (.NOT.(LO(103).OR.LO(44))) GO TO 1                             TLNC-037
      JC=5                                                              TLNC-038
      RM=ISM*WV(8)*WV(11)                                               TLNC-039
      CALL CORI(WV(5),WV(5),RM,RM,DD,FF(1,5),FF(1,5),FF,FF,DD(200),LM,LMTLNC-040
     1,IL,LM,FF(1,6))                                                   TLNC-041
    1 L=IPI(10)+1                                                       TLNC-042
      IF (L.LE.0) RETURN                                                TLNC-043
      IJ=IPI(2)                                                         TLNC-044
      VPR=WV(9)**2                                                      TLNC-045
      VPC=WV(10)**2                                                     TLNC-046
      DO 24 LJ=1,L                                                      TLNC-047
      DO 23 JL=1,IJ                                                     TLNC-048
      JJ=2*(LJ+JL)-IJ-3                                                 TLNC-049
      J=J+1                                                             TLNC-050
      TL(J)=0.D0                                                        TLNC-051
      IF (JJ.LT.IJ+1-2*LJ) GO TO 23                                     TLNC-052
      L1=LJ-1                                                           TLNC-053
      CLL=DFLOAT(LJ*(LJ-1))                                             TLNC-054
      CLS=.25D0*DFLOAT(JJ*(JJ+2)-IJ*IJ+1)-CLL                           TLNC-055
C VALUES OF LONG RANGE TAILS OF CENTRAL POTENTIALS.                     TLNC-056
      F2=VCO(1)**2                                                      TLNC-057
      F3=VCO(2)*CLS                                                     TLNC-058
      IF (WV(3).GT.0.D0.AND.JC.GT.0) GO TO 2                            TLNC-059
      F2=0.D0                                                           TLNC-060
      F3=0.D0                                                           TLNC-061
C INTEGRATION REGION - SET UP OF POTENTIAL IN FIVE POINTS FOR           TLNC-062
C TRANSFORMATION OF MATCHING VALUES.                                    TLNC-063
    2 B1=HH*HH/48.D0                                                    TLNC-064
      C1=DFLOAT(ISM-1)*HH                                               TLNC-065
      A1=WV(11)**2                                                      TLNC-066
      IF (WV(3).LT.0.D0) A1=-A1                                         TLNC-067
      DO 3 K=1,5                                                        TLNC-068
      AV(K)=B1*(2.D0*WV(11)*WV(5)/C1-A1+(CLL-F2-F3/C1)/C1**2)           TLNC-069
    3 C1=C1+0.5D0*HH                                                    TLNC-070
C COMPUTATION OF COULOMB CORRECTIONS.                                   TLNC-071
      DO 4 K=1,4                                                        TLNC-072
    4 B(K)=FF(L1+1,K)                                                   TLNC-073
      IF (JC.LE.0) GO TO 8                                              TLNC-074
      IF (WV(5).NE.0.D0) GO TO 5                                        TLNC-075
      F2=F3*WV(11)                                                      TLNC-076
      F3=0.D0                                                           TLNC-077
    5 DO 6 K=1,4                                                        TLNC-078
    6 G(K)=-FF(L1+1,K+JC)*F2                                            TLNC-079
      IF (F3.EQ.0.D0) GO TO 7                                           TLNC-080
      B1=2.D0*WV(5)*DFLOAT(L1*(L1+1))                                   TLNC-081
      B2=DFLOAT(L1+1)**2+WV(5)**2                                       TLNC-082
      C1=-(DFLOAT(2*L1+1)*B2+2*WV(5)**2)/B1                             TLNC-083
      C2=DFLOAT(2*L1+3)*B2/B1                                           TLNC-084
      A1=DFLOAT(ISM)*WV(11)*WV(8)                                       TLNC-085
      D1=(B2+DFLOAT(L1+1)*WV(5)/A1)/A1/B1                               TLNC-086
      D2=-WV(5)*DSQRT(B2)/B1/A1                                         TLNC-087
      A1=B2/B1/A1                                                       TLNC-088
      A3=F3*WV(11)                                                      TLNC-089
      G(1)=G(1)-A3*(C1*FF(L1+1,1+JC)+C2*FF(L1+2,1+JC)-D1*FF(L1+1,1)**2-DTLNC-090
     12*2.D0*FF(L1+1,1)*FF(L1+2,1)-A1*FF(L1+2,1)**2)                    TLNC-091
      G(2)=G(2)-A3*(C1*FF(L1+1,2+JC)+C2*FF(L1+2,2+JC)-D1*FF(L1+1,1)*FF(LTLNC-092
     11+1,3)-D2*(FF(L1+1,1)*FF(L1+2,3)+FF(L1+2,1)*FF(L1+1,3))-A1*FF(L1+2TLNC-093
     2,1)*FF(L1+2,3))                                                   TLNC-094
      G(4)=G(4)-A3*(C1*FF(L1+1,4+JC)+C2*FF(L1+2,4+JC)-D1*FF(L1+1,3)**2-DTLNC-095
     12*2.D0*FF(L1+1,3)*FF(L1+2,3)-A1*FF(L1+2,3)**2)                    TLNC-096
    7 A4=1.D0+(G(1)*G(4)-G(2)**2)                                       TLNC-097
      G(3)=B(1)                                                         TLNC-098
      B(1)=(B(1)*(1.D0-G(2))+G(1)*B(3))/A4                              TLNC-099
      B(3)=(-G(3)*G(4)+(1.D0+G(2))*B(3))/A4                             TLNC-100
      G(3)=B(2)                                                         TLNC-101
      B(2)=(B(2)*(1.D0-G(2))+G(1)*B(4))/A4                              TLNC-102
      B(4)=(-G(3)*G(4)+(1.D0+G(2))*B(4))/A4                             TLNC-103
    8 A1=(1.D0-AV(2))/(2.D0+10.D0*AV(2))                                TLNC-104
      B1=(1.D0-AV(4))/(2.D0+10.D0*AV(4))                                TLNC-105
      A2=A1*(1.D0-AV(1))/(1.D0-4.D0*AV(1))                              TLNC-106
      B2=B1*(1.D0-AV(5))/(1.D0-4.D0*AV(5))                              TLNC-107
      C1=(2.D0+10.D0*AV(3))-(1.D0-AV(3))*(A1+B1)                        TLNC-108
      A1=(16.D0-144.D0*AV(2))/(2.D0+10.D0*AV(2))                        TLNC-109
      B1=(16.D0-144.D0*AV(4))/(2.D0+10.D0*AV(4))                        TLNC-110
      C2=(7.D0+A1*(1.D0-AV(1)))/(1.D0-4.D0*AV(1))                       TLNC-111
      D2=(7.D0+B1*(1.D0-AV(5)))/(1.D0-4.D0*AV(5))                       TLNC-112
      D1=(B1-A1)*(1.D0-AV(3))                                           TLNC-113
      A1=A2*D2+B2*C2                                                    TLNC-114
      B1=(C1*D2+D1*B2)/A1                                               TLNC-115
      B2=30.D0*HH*B2*WV(11)/A1                                          TLNC-116
      FAM(1)=B1*B(1)-B2*B(2)                                            TLNC-117
      FAM(3)=B1*B(3)-B2*B(4)                                            TLNC-118
      B1=(C2*C1-A2*D1)/A1                                               TLNC-119
      A2=-30.D0*HH*A2*WV(11)/A1                                         TLNC-120
      FAM(2)=B1*B(1)-A2*B(2)                                            TLNC-121
      FAM(4)=B1*B(3)-A2*B(4)                                            TLNC-122
      CSO=2.D0*VPR*CLS                                                  TLNC-123
C COMPUTATION OF THE REGULAR SOLUTION.                                  TLNC-124
      DO 9 IS=1,ISM                                                     TLNC-125
      X(1,IS+2)=WV(12)-CLL/DFLOAT(IS)**2+VPR*V(IS,1)                    TLNC-126
    9 X(2,IS+2)=VPR*V(IS,2)                                             TLNC-127
      IF ((.NOT.LO(101)).OR.(CSO.EQ.0.D0)) GO TO 12                     TLNC-128
      DO 10 IS=1,ISM                                                    TLNC-129
   10 X(1,IS+2)=X(1,IS+2)+CSO*V(IS,3)                                   TLNC-130
      IF (.NOT.LO(102)) GO TO 12                                        TLNC-131
      DO 11 IS=1,ISM                                                    TLNC-132
   11 X(2,IS+2)=X(2,IS+2)+CSO*V(IS,4)                                   TLNC-133
   12 IF (.NOT.LO(133)) GO TO 16                                        TLNC-134
      IF (WV(5).EQ.0.D0) GO TO 14                                       TLNC-135
      DO 13 IS=1,ISM                                                    TLNC-136
   13 X(1,IS+2)=X(1,IS+2)+VPC*V(IS,5)                                   TLNC-137
   14 IF (.NOT.LO(103)) GO TO 16                                        TLNC-138
      VPD=2.D0*CLS*VPC                                                  TLNC-139
      IF (VPD*VCO(2).EQ.0.D0) GO TO 16                                  TLNC-140
      DO 15 IS=1,ISM                                                    TLNC-141
   15 X(1,IS+2)=X(1,IS+2)+VPD*V(IS,6)                                   TLNC-142
   16 CONTINUE                                                          TLNC-143
      IF (LO(27)) GO TO 18                                              TLNC-144
C MODIFIED NUMEROV METHOD.                                              TLNC-145
      DO 17 IS=1,ISM                                                    TLNC-146
      A1=X(1,IS+2)**2-X(2,IS+2)**2                                      TLNC-147
      IF (LO(26)) A1=A1-X(1,IS+2)**3/30.D0                              TLNC-148
      X(2,IS+2)=X(2,IS+2)*(1.D0-X(1,IS+2)/6.D0)                         TLNC-149
   17 X(1,IS+2)=X(1,IS+2)-A1/12.D0                                      TLNC-150
      GO TO 20                                                          TLNC-151
C NUMEROV METHOD.                                                       TLNC-152
   18 DO 19 IS=1,ISM                                                    TLNC-153
      A2=(12.D0+X(1,IS+2))**2+X(2,IS+2)**2                              TLNC-154
      A1=12.D0*(X(1,IS+2)*(12.D0+X(1,IS+2))+X(2,IS+2)**2)/A2            TLNC-155
      IF (LO(26)) A1=A1+X(1,IS+2)**3/240.D0                             TLNC-156
      X(1,IS+2)=A1                                                      TLNC-157
   19 X(2,IS+2)=144.D0*X(2,IS+2)/A2                                     TLNC-158
   20 X(1,1)=0.D0                                                       TLNC-159
      X(2,1)=0.D0                                                       TLNC-160
      X(1,2)=1.D-15                                                     TLNC-161
      X(2,2)=0.D0                                                       TLNC-162
      DO 22 IS=1,ISM                                                    TLNC-163
      B1=X(1,IS+1)*X(1,IS+2)-X(2,IS+1)*X(2,IS+2)                        TLNC-164
      B2=X(2,IS+1)*X(1,IS+2)+X(1,IS+1)*X(2,IS+2)                        TLNC-165
      X(1,IS+2)=X(1,IS+1)+X(1,IS+1)-X(1,IS)-B1                          TLNC-166
      X(2,IS+2)=X(2,IS+1)+X(2,IS+1)-X(2,IS)-B2                          TLNC-167
      IF (DABS(X(1,IS+2)).LT.1.D15) GO TO 22                            TLNC-168
C RENORMALISATION OF LARGE FUNCTION VALUES.                             TLNC-169
      JS=2*IS+4                                                         TLNC-170
      DO 21 I=3,JS                                                      TLNC-171
   21 X(I,1)=X(I,1)*1.D-30                                              TLNC-172
   22 CONTINUE                                                          TLNC-173
C END OF INTEGRATION.                                                   TLNC-174
C MATCHING.                                                             TLNC-175
      A1=X(1,ISM)*FAM(4)-FAM(3)*X(1,ISM+2)                              TLNC-176
      A2=X(2,ISM)*FAM(4)-FAM(3)*X(2,ISM+2)                              TLNC-177
      B1=X(1,ISM)*FAM(2)-FAM(1)*X(1,ISM+2)                              TLNC-178
      B2=X(2,ISM)*FAM(2)-FAM(1)*X(2,ISM+2)                              TLNC-179
      A2=A2+B1                                                          TLNC-180
      A1=A1-B2                                                          TLNC-181
      A3=A1*A1+A2*A2                                                    TLNC-182
      A1=-A1/A3                                                         TLNC-183
      A2=A2/A3                                                          TLNC-184
      CR=A1*B1-A2*B2                                                    TLNC-185
      CI=B1*A2+B2*A1                                                    TLNC-186
      TL(J)=DMAX1(0.D0,4.D0*(CI-CR**2-CI**2))                           TLNC-187
   23 CONTINUE                                                          TLNC-188
   24 CONTINUE                                                          TLNC-189
      RETURN                                                            TLNC-190
      END                                                               TLNC-191
C 20/08/06                                                      ECIS06  QUAN-000
      SUBROUTINE QUAN(NCOLL,WV,IPI,NIV,IQ,TQ,IVQ,IVZ,MC,NAT,AT,IT,NVI,KAQUAN-001
     1B,KBC,AA,FAC,NFA,NMAX,JD,LO)                                      QUAN-002
C INPUT:     NCOLL:   NUMBER OF COUPLED NUCLEAR STATES.                 QUAN-003
C            WV:      DESCRIPTION OF THE CHANNELS. SEE CALX.            QUAN-004
C            IPI:     PROJECTILE AND TARGET MULTIPLICITY, PARITY        QUAN-005
C                     AND MAXIMUM ANGULAR MOMENTUM.  SEE CALX.          QUAN-006
C            NIV:     FIRST/LAST ADDRESS IN THE TABLE OF                QUAN-007
C                     REDUCED NUCLEAR MATRIX ELEMENTS.  SEE REDM.       QUAN-008
C            IQ,TQ:   TABLE OF REDUCED NUCLEAR MATRIX ELEMENTS.         QUAN-009
C            IVQ:     TABLE OF MULTIPOLES.  SEE REDM.                   QUAN-010
C            IVZ:     TABLE OF FORM FACTORS.  SEE REDM.                 QUAN-011
C            KAB:     MAXIMUM NUMBER OF COUPLED CHANNELS.               QUAN-012
C            KBC:     MAXIMUM NUMBER OF SOLUTIONS.                      QUAN-013
C            FAC:     TABLE OF LOGARITHMS OF FACTORIALS.                QUAN-014
C            NFA:     LENGTH OF FAC.                                    QUAN-015
C            NMAX:    AVAILABLE LENGTH OF AT/NAT(LESS 100 FOR 9J).      QUAN-016
C            JD:      FIRST DIMENSION OF TABLES NAT AND AT.             QUAN-017
C            LO(I):   LOGICAL CONTROLS:                                 QUAN-018
C               LO(12) =.TRUE. DEFORMED IMAGINARY POTENTIAL.            QUAN-019
C               LO(13) =.TRUE. DEFORMED REAL SPIN-ORBIT OR TENSOR.      QUAN-020
C               LO(14) =.TRUE. DEFORMED IMAGINARY SPIN-ORBIT OR TENSOR. QUAN-021
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   QUAN-022
C               LO(58) =.TRUE. OUTPUT OF THE COEFFICIENTS OF EACH FORM  QUAN-023
C                              FACTOR FOR ALL SETS OF EQUATIONS.        QUAN-024
C               LO(100)=.TRUE. DIRAC EQUATION.                          QUAN-025
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    QUAN-026
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. QUAN-027
C               LO(110)=.TRUE. DERIVATIVES ARE NEEDED.                  QUAN-028
C               LO(123)=.TRUE. IDENTICAL PARTICLES WITH SPIN.           QUAN-029
C               LO(127)=.TRUE. COULOMB CORRECTIONS IN ASYMPTOTIC REGION.QUAN-030
C               LO(128)=.TRUE. NO COPY OF UNCOUPLED FUNCTIONS AND       QUAN-031
C                              PHASE-SHIFTS.                            QUAN-032
C OUTPUT:    MC:      NUCLEAR STATE INDICATIONS. FOR IC=1,NC:           QUAN-033
C                     MC(IC,1): NUCLEAR STATE NUMBERS.                  QUAN-034
C                     MC(IC,2): ORBITAL MOMENTUM LC.                    QUAN-035
C                     MC(IC,3): TWICE ORBITAL SPIN.                     QUAN-036
C                     MC(IC,4): REFERENCE TO POTENTIAL OR COPY.         QUAN-037
C                     MC(IC,5): LC*(LC+1).                              QUAN-038
C                     MC(IC,6): EIGENVALUE OF L.S.                      QUAN-039
C            NAT,AT:  IN EQUIVALENCE BY CALL. TABLE OF COUPLING         QUAN-040
C                     COEFFICIENTS. FOR I=1,IT:                         QUAN-041
C                     NAT(1,I): ADDRESS OF THE REAL FORM FACTOR,        QUAN-042
C                     NAT(2,I): ADDRESS OF THE IMAGINARY FORM FACTOR,   QUAN-043
C                     AT(2,I):  GEOMETRICAL COEFFICIENT,                QUAN-044
C                     AND ONLY FOR DIRAC EQUATION:                      QUAN-045
C                     AT(3,I):  IDEM FOR SMALL COMPONENTS,              QUAN-046
C            IT:      NUMBER OF NON ZERO COUPLING COEFFICIENTS.         QUAN-047
C            NVI:     ADDRESS IN THE TABLE AT(I), ANALOGOUS TO THE NIV  QUAN-048
C                     ADDRESSES: NVI(I1,I2,1) TO NVI(I1,I2,2)           QUAN-049
C                     FOR THE NON DERIVATIVES COUPLINGS, NVI(I1,I2,2)+1 QUAN-050
C                     TO NVI(I1,I2,3)  FOR THE DERIVATIVE COUPLINGS.    QUAN-051
C                     FOR SMALL COMPONENTS OF DIRAC EQUATION, IDEM WITH QUAN-052
C                     NVI(I1,I2,4) TO NVI(I1,I2,6).                     QUAN-053
C            AA:      COEFFICIENTS OF THE SYMMETRISATION FOR IDENTICAL  QUAN-054
C                     PARTICLE AND TARGET, MC RESULTS ARE IN MC(*,*+7), QUAN-055
C                     NAT AND AT RESULTS ARE AFTER THE USUAL ONES, NVI  QUAN-056
C                     RESULTS ARE IN NVI(*,*,*+3), NC AND NCIN ARE      QUAN-057
C                     DIFFERENT FROM NIC AND NCI.                       QUAN-058
C            LO(I):   LOGICAL CONTROLS: DEFINED HERE: LO(110).          QUAN-059
C WORKING AREA:                                                         QUAN-060
C            AT(I,J): FOR J>IT, WORKING AREA USED IN DJ9J.              QUAN-061
C                                                                       QUAN-062
C THE COMMON /NOEQU/ IS USED IN CAL1, QUAN, MTCH AND SCAM.              QUAN-063
C                                                                       QUAN-064
C FOR THE COMMON  /NCOMP/ SEE CALX.                                     QUAN-065
C FOR THE COMMON  /POTE2/ SEE REDM.                                     QUAN-066
C                                                                       QUAN-067
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     QUAN-068
C  AZ(6):     DEFORMED SPIN-ORBIT PARAMETERS. (SEE INPUT DESCRIPTION    QUAN-069
C             AND COMMENTS IN THIS SUBROUTINE).                         QUAN-070
C                                                                       QUAN-071
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NOEQU/:                     QUAN-072
C  NCXN:      NUMBER OF SOLUTIONS NEEDED.                               QUAN-073
C  NIC:       NUMBER OF EQUATIONS AT THE CHANNEL SPIN.                  QUAN-074
C  NCI:       NUMBER OF SOLUTIONS AT THE CHANNEL SPIN.                  QUAN-075
C  NC:        NUMBER OF EQUATIONS FOR IDENTICAL PARTICLES.              QUAN-076
C  NCIN:      NUMBER OF SOLUTIONS FOR IDENTICAL PARTICLES.              QUAN-077
C  NIN:       NUMBER OF COUPLING POTENTIALS.                            QUAN-078
C  JPI:       PARITY 0 OR 1.                                            QUAN-079
C  IPJ:       VALUE OF J+1 OR J+1/2 WHERE J IS THE CHANNEL SPIN.        QUAN-080
C  R1(2):     MAXIMUM OF SCATTERING AND COMPOUND COEFFICIENT.           QUAN-081
C  NAJ:       TWICE THE CHANNEL SPIN J.                                 QUAN-082
C   DEFINED:  NIC,NCI,NC,NCIN,NIN.                                      QUAN-083
C   USED:     NIC,NCI,NC,NCIN,NIN,JPI,NAJ.                              QUAN-084
C   NOT USED: NCXN,IPJ,R1.                                              QUAN-085
C                                                                       QUAN-086
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     QUAN-087
C  ITY(5):    STARTING ADDRESS OF REAL CENTRAL TRANSITION.              QUAN-088
C             ITY(5)=0 IS USED FOR DIRAC EQUATIONS.                     QUAN-089
C  INTV:      NUMBER OF TRANSITION FORM FACTORS WITHOUT SPIN-ORBIT,     QUAN-090
C             TAKING INTO ACCOUNT DISPERSION.                           QUAN-091
C  INSL:      NUMBER OF SPIN-ORBIT FORM TRANSITION FACTORS NOT TAKING   QUAN-092
C             INTO ACCOUNT MULTIPLICATION BY 2.                         QUAN-093
C   USED:     ITY(5),INTV,INSL.                                         QUAN-094
C                                                                       QUAN-095
C***********************************************************************QUAN-096
      IMPLICIT REAL*8 (A-H,O-Z)                                         QUAN-097
      LOGICAL LO(150),LLO,LLC,LLP                                       QUAN-098
      DIMENSION WV(22,*),IPI(11,*),NIV(NCOLL,NCOLL,3),IQ(6,*),TQ(3,*),IVQUAN-099
     1Q(3,*),IVZ(4,*),MC(KAB,12),NAT(2*JD,*),AT(JD,*),NVI(KAB,KAB,6),AA(QUAN-100
     2KBC,*),FAC(*)                                                     QUAN-101
      CHARACTER*1 IP(2)                                                 QUAN-102
      COMMON /INOUT/ MR,MW,MS                                           QUAN-103
      COMMON /NCOMP/ NSP(12),ACN(2),AZ(6),BZ(12)                        QUAN-104
      COMMON /NOEQU/ NCXN,NIC,NCI,NC,NCIN,NIN,JPI,IPJ,R1(2),NAJ         QUAN-105
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         QUAN-106
      DATA IP /'+','-'/                                                 QUAN-107
      LLC=LO(133).AND.LO(11)                                            QUAN-108
      LLP=LO(133).AND.LO(19)                                            QUAN-109
C FIND QUANTUM NUMBER OF COUPLED CHANNELS.                              QUAN-110
      NC=0                                                              QUAN-111
      AJ=.5D0*DFLOAT(NAJ)                                               QUAN-112
      DO 6 I=1,NCOLL                                                    QUAN-113
      NJ1=NAJ-IPI(3,I)+1                                                QUAN-114
      NJ2=IABS(NJ1)                                                     QUAN-115
      NJ=IPI(3,I)                                                       QUAN-116
      NL=IPI(2,I)                                                       QUAN-117
      DO 5 J=1,NJ                                                       QUAN-118
      L1=(NAJ-NJ-NL)/2+J                                                QUAN-119
      L2=IABS(L1)                                                       QUAN-120
      DO 4 K=1,NL                                                       QUAN-121
      IF (MOD(L1+IPI(1,I)+JPI,2).NE.0) GO TO 3                          QUAN-122
      IF ((L1.LT.L2).OR.(NJ1.LT.NJ2).OR.(L1.GT.IPI(10,I))) GO TO 3      QUAN-123
      NC=NC+1                                                           QUAN-124
      MC(NC,4)=IPI(11,I)                                                QUAN-125
      IF (LO(128)) GO TO 2                                              QUAN-126
      IF (LO(100)) MC(NC,4)=I                                           QUAN-127
      DO 1 M=NC,KAB                                                     QUAN-128
      IF (MC(M,1).NE.I) GO TO 1                                         QUAN-129
      IF (MC(M,2).NE.L1) GO TO 1                                        QUAN-130
      IF (MC(M,3).NE.NJ1) GO TO 1                                       QUAN-131
      MC(NC,4)=-M                                                       QUAN-132
      GO TO 2                                                           QUAN-133
    1 CONTINUE                                                          QUAN-134
    2 MC(NC,1)=I                                                        QUAN-135
      MC(NC,2)=L1                                                       QUAN-136
      MC(NC,3)=NJ1                                                      QUAN-137
      MC(NC,5)=MC(NC,2)*(MC(NC,2)+1)                                    QUAN-138
      MC(NC,6)=((NJ1-IPI(2,I)+1)*(NJ1+IPI(2,I)+1))/4-MC(NC,5)           QUAN-139
    3 L1=L1+1                                                           QUAN-140
    4 CONTINUE                                                          QUAN-141
    5 NJ1=NJ1+2                                                         QUAN-142
      IF (I.NE.1) GO TO 6                                               QUAN-143
      NCIN=NC                                                           QUAN-144
      IF (NCIN.EQ.0) RETURN                                             QUAN-145
    6 CONTINUE                                                          QUAN-146
      IF (.NOT.LO(58)) GO TO 8                                          QUAN-147
      WRITE (MW,1000) AJ,IP(JPI+1),NC,NCIN                              QUAN-148
      DO 7 J=1,NC                                                       QUAN-149
      SJ=0.5D0*DFLOAT(MC(J,3))                                          QUAN-150
    7 WRITE (MW,1001) J,MC(J,1),MC(J,2),SJ,MC(J,4),MC(J,5),MC(J,6)      QUAN-151
C COMPUTATION OF COUPLING COEFFICIENTS FOR THE FORM FACTORS             QUAN-152
C WHEN THE SPIN-ORBIT IS DEFORMED,THERE IS NO SYMMETRY, THE TOTAL       QUAN-153
C TABLE IS CALCULATED. WITH NO SPIN-ORBIT DEFORMATION,ONLY ONE HALF IS  QUAN-154
C CALCULATED. LO(110) RETURNS .TRUE. IF THEY ARE DERIVATIVE COUPLINGS.  QUAN-155
    8 LO(110)=.FALSE.                                                   QUAN-156
      IT=0                                                              QUAN-157
      NIN=0                                                             QUAN-158
      INVZ=INTV+ITY(5)                                                  QUAN-159
      DO 41 I1=1,NC                                                     QUAN-160
      J1=MC(I1,1)                                                       QUAN-161
      K1=IPI(11,J1)                                                     QUAN-162
      IF (LO(100)) K1=J1                                                QUAN-163
      IF (LO(127)) MC(I1,4)=K1                                          QUAN-164
      DO 40 I2=1,I1                                                     QUAN-165
      J2=MC(I2,1)                                                       QUAN-166
      A2=WV(9,J1)*WV(9,J2)                                              QUAN-167
      A3=WV(10,J1)*WV(10,J2)                                            QUAN-168
      IT1=IT+1                                                          QUAN-169
      NVI(I2,I1,1)=IT1                                                  QUAN-170
      K1=NIV(J2,J1,1)                                                   QUAN-171
      K2=NIV(J2,J1,2)                                                   QUAN-172
      IF (K1.GT.K2) GO TO 32                                            QUAN-173
      IF (2*(K2-K1+3+IT).GT.NMAX) CALL MEMO('QUAN',NMAX,2*(K2-K1+3+IT)) QUAN-174
      IL=2*MC(I2,2)                                                     QUAN-175
      ILP=2*MC(I1,2)                                                    QUAN-176
      ISJ=MC(I2,3)                                                      QUAN-177
      ISJP=MC(I1,3)                                                     QUAN-178
      IAI=IPI(3,J2)-1                                                   QUAN-179
      IAIP=IPI(3,J1)-1                                                  QUAN-180
      IS=IPI(2,J2)-1                                                    QUAN-181
      ISP=IPI(2,J1)-1                                                   QUAN-182
      DO 22 K=K1,K2                                                     QUAN-183
      NI=IQ(2,K)                                                        QUAN-184
C COEFFICIENT OF A CENTRAL MULTIPOLE WITH ANGULAR MOMENTUM IQ=IVQ(1,NI) QUAN-185
C TRANSFER OF SPIN IS=IVQ(2,NI)/2 AND OF TOTAL MOMENTUM IJ=IVQ(3,NI)/2  QUAN-186
C NOTING THE SPIN S,THE ORBITAL ANGULAR MOMENTUM L,THE TOTAL SPIN OF THEQUAN-187
C PARTICLE J,THE SPIN OF THE TARGET AI,THE EIGENVALUE OF L.S G......    QUAN-188
C AND "K"=SQRT(2*K+1)   THE MOST GENERAL EXPRESSION OF (I2||IQ||I1) IS  QUAN-189
C  (-)**(AJ+AI2+1+J1+(L2+IQ-L1)/2)*"L1"*"L2"*"J1"*"J2"*"IQ"*"IJ"*       QUAN-190
C CGS(IQ,L2,L1)*C6J(J1,IJ,J2,AI2,AJ,AI1)*C9J(L2,L1,IQ,S2,S1,IS,J2,J1,IJ)QUAN-191
C IN A MACROSCOPIC MODEL, IS=0 AND IJ=IQ, THE EXPRESSIONS USED ARE      QUAN-192
C  (-)**(AJ+AI2+1-S+(L1+L2+IQ)/2)*"L1"*"L2"*"J1"*"J2"*"IQ"*CGS(IQ,L2,L1)QUAN-193
C    *C6J(J1,IQ,J2,AI2,AJ,AI1)*C6J(L1,IQ,L2,J2,S,J1)                    QUAN-194
C FOR S=1/2 (-)**(AJ+AI2-J2+(L1-L2+IQ)/2)*"IQ"*CGS(IQ,J2,J1)            QUAN-195
C FOR S=0   (-)**(AJ+AI2+1+(L1+L2+IQ)/2)*"L1"*"L2"*"IQ"*CGS(IQ,L2,L1)*  QUAN-196
C           C6J(L1,IQ,L2,AI2,AJ,AI1).                                   QUAN-197
      IIQ=2*IVQ(1,NI)                                                   QUAN-198
      DO 16 IX=2,JD                                                     QUAN-199
      CX=0.D0                                                           QUAN-200
      CMATEL=0.D0                                                       QUAN-201
      IF ((IIQ.GT.IL+ILP).OR.(IIQ.LT.IABS(IL-ILP))) GO TO 13            QUAN-202
      FX=1.D0                                                           QUAN-203
      KK=MC(I1,2)+MC(I2,2)+IVQ(1,NI)                                    QUAN-204
      IIS=IVQ(2,NI)                                                     QUAN-205
      IF (IIS.LT.0) GO TO 11                                            QUAN-206
      IIJ=IVQ(3,NI)                                                     QUAN-207
      CMATEL=DJ6J(ISJ,IIJ,ISJP,IAIP,NAJ,IAI,FAC,NFA)                    QUAN-208
      A1=DFLOAT(IIJ+1)                                                  QUAN-209
      IF (IS.GT.1.OR.IIS.NE.0) GO TO 9                                  QUAN-210
      CMATEL=CMATEL*DCGS(IIJ,ISJP,ISJ,FAC,NFA)                          QUAN-211
      KK=KK+NAJ+IAIP                                                    QUAN-212
      IF (IS.EQ.1) KK=KK+2+IL-ISJP                                      QUAN-213
      IF (IS.NE.1) A1=A1*DFLOAT((ISJ+1)*(ISJP+1))                       QUAN-214
      GO TO 12                                                          QUAN-215
    9 A1=A1*DFLOAT((IL+1)*(ILP+1))                                      QUAN-216
      A1=A1*DFLOAT((ISJ+1)*(ISJP+1))                                    QUAN-217
      KK=(NAJ+IAIP-IS)+KK                                               QUAN-218
      CMATEL=CMATEL*DCGS(IIQ,ILP,IL,FAC,NFA)                            QUAN-219
      IF (IIS.NE.0) GO TO 10                                            QUAN-220
      FX=DJ6J(IL,ISJ,IS,ISJP,ILP,IIJ,FAC,NFA)                           QUAN-221
      GO TO 12                                                          QUAN-222
   10 CMATEL=CMATEL*DJ9J(IL,ILP,IIQ,IS,ISP,IIS,ISJ,ISJP,IIJ,AT(1,IT+1),1QUAN-223
     100)                                                               QUAN-224
      A1=A1*DFLOAT((IIQ+1)*(IIS+1))                                     QUAN-225
      KK=KK+ISJP+ILP+IS                                                 QUAN-226
      GO TO 12                                                          QUAN-227
C MAGNETIC COULOMB EXCITATION OF THE PARTICLE:                          QUAN-228
   11 IIJ=IIQ-2                                                         QUAN-229
      IF (IIQ.GT.IL+ILP+2.OR.IIQ.LT.IABS(IL-ILP)+2) GO TO 13            QUAN-230
      CMATEL=DJ6J(ISJ,ISJP,IIJ,ILP,IL,IS,FAC,NFA)*DJ6J(ISJ,ISJP,IIQ-2,IAQUAN-231
     1IP,IAI,NAJ,FAC,NFA)*DCGS(IIQ,ILP,IL,FAC,NFA)                      QUAN-232
      KK=KK+NAJ+IAIP-IS-2                                               QUAN-233
      A1=DFLOAT((IIQ+1)**3)*DFLOAT((ISJ+1)*(ISJP+1))*DFLOAT((IL+1)*(ILP+QUAN-234
     11))*DFLOAT((IL+ILP+IIQ+2)*(IL+ILP-IIJ))*(IL-ILP+IIQ)*(ILP-IL+IIQ)/QUAN-235
     2DFLOAT((IIQ-1)*IIJ)**2/16.D0                                      QUAN-236
   12 IF (MOD(KK,4).EQ.0) CMATEL=-CMATEL                                QUAN-237
      CMATEL=TQ(3,K)*CMATEL*DSQRT(A1)                                   QUAN-238
      CX=CMATEL*FX                                                      QUAN-239
   13 IF (IX.EQ.3) GO TO 14                                             QUAN-240
      IT=IT+1                                                           QUAN-241
      NAT(1,IT)=IQ(1,K)                                                 QUAN-242
      NAT(2,IT)=0                                                       QUAN-243
   14 AT(IX,IT)=CX*A2                                                   QUAN-244
      IF (.NOT.LO(100)) GO TO 17                                        QUAN-245
      IF (IX.EQ.3) GO TO 22                                             QUAN-246
      IF (IIQ.NE.IIJ) GO TO 15                                          QUAN-247
      AT(3,IT)=AT(2,IT)                                                 QUAN-248
      IF (IIS.NE.0) AT(3,IT)=-AT(3,IT)                                  QUAN-249
      GO TO 22                                                          QUAN-250
   15 IL=2*ISJ-IL                                                       QUAN-251
   16 ILP=2*ISJP-ILP                                                    QUAN-252
   17 NAT(1,IT)=NAT(1,IT)+ITY(5)                                        QUAN-253
      IF (LO(133)) AT(3,IT)=0.D0                                        QUAN-254
      IF (LLC) AT(3,IT)=CX*A3                                           QUAN-255
      IF (LO(12)) NAT(2,IT)=NAT(1,IT)                                   QUAN-256
      IF (IQ(3,K).EQ.0) GO TO 22                                        QUAN-257
C DEFORMED SPIN-ORBIT:                                                  QUAN-258
C FORM FACTOR (1/R)(D/DR)V(R)         COEFFICIENT:  (I2||IQ||I1)*G1     QUAN-259
C PARAMETRISATION:  (I2||IQ||I1)*(AZ(3)*G1+AZ(4)*G2+AZ(1)).             QUAN-260
      A=CX*(MC(I2,6)*AZ(3)+MC(I1,6)*AZ(4)+AZ(1))                        QUAN-261
      IF (DABS(A).LT.1.D-10) GO TO 18                                   QUAN-262
      IT=IT+1                                                           QUAN-263
      NAT(1,IT)=IQ(3,K)+INVZ                                            QUAN-264
      NAT(2,IT)=0                                                       QUAN-265
      IF (LO(14)) NAT(2,IT)=NAT(1,IT)                                   QUAN-266
      AT(2,IT)=2.D0*A*A2                                                QUAN-267
      IF (LO(133)) AT(3,IT)=0.D0                                        QUAN-268
      IF (LLP) AT(3,IT)=2.D0*A*A3                                       QUAN-269
C FORM FACTOR V(R)/R**2   COEFFICIENT: (I2||IQ||I1)*(S*(IQ*(IQ+1)-L1*(L1QUAN-270
C   +1)-L2*(L2+1)+G2*(1+G1)/(2*S))+XXX)                                 QUAN-271
C PARAMETRISATION:   (I2||IQ||I1)*AZ(5)*(S*(IQ*(IQ+1)*AZ(2)........     QUAN-272
C XXX IS -SQRT(F1*F2)*C6J(L1,J1,S-1,J2,L2,IQ)/(2*S*C6J(L1,J1,S,J2,L2,IQ)QUAN-273
C  WITH F=(L*L+L-(J-S)*(J-S+1))*((J+S)*(J+S+1)-L*L-L)                   QUAN-274
C  FOR S=1/2  XXX=0                                                     QUAN-275
C  FOR S=1  XXX=-4*L1*L2*(L1+1)*(L2+1)/IQ*IQ+IQ-L1*L1-L1-L2*L2-L2)      QUAN-276
C WHEN J1=L1 AND J2=L2 , ELSE  XXX=0.                                   QUAN-277
   18 AZI=DFLOAT(IVQ(1,NI)*(IVQ(1,NI)+1))                               QUAN-278
      ASPI=DFLOAT(IS)                                                   QUAN-279
      SMATEL=(0.5D0*DFLOAT(IPI(2,J1)-1)*(AZ(2)*AZI-DFLOAT(MC(I1,5)+MC(I2QUAN-280
     1,5)))+DFLOAT(MC(I1,6))*(1.D0+DFLOAT(MC(I2,6))/ASPI))*FX           QUAN-281
      IF (IS-2) 21 , 19 , 20                                            QUAN-282
   19 IF (IL.NE.ISJ.OR.ILP.NE.ISJP) GO TO 21                            QUAN-283
      A1=AZI-MC(I1,5)-MC(I2,5)                                          QUAN-284
      IF (A1.EQ.0.D0) GO TO 20                                          QUAN-285
      SMATEL=SMATEL-4.D0*DFLOAT(MC(I1,5)*MC(I2,5))*FX/A1                QUAN-286
      GO TO 21                                                          QUAN-287
   20 G1=DFLOAT((MC(I1,3)-IPI(2,J1))/2)                                 QUAN-288
      G2=DFLOAT((MC(I1,3)+IPI(2,J1))/2)                                 QUAN-289
      F1=(DFLOAT(MC(I1,5))-G1*(G1+1.D0))*(G2*(G2+1.D0)-DFLOAT(MC(I1,5)))QUAN-290
      G1=DFLOAT((MC(I2,3)-IPI(2,J1))/2)                                 QUAN-291
      G2=DFLOAT((MC(I2,3)+IPI(2,J1))/2)                                 QUAN-292
      F2=(DFLOAT(MC(I2,5))-G1*(G1+1.D0))*(G2*(G2+1.D0)-DFLOAT(MC(I2,5)))QUAN-293
      F3=F1*F2                                                          QUAN-294
      IF (F3.GT.0.D0) SMATEL=SMATEL-DSQRT(F3)*DJ6J(IL,ISJ,IS-2,ISJP,ILP,QUAN-295
     1IIQ,FAC,NFA)/ASPI                                                 QUAN-296
   21 A=CMATEL*AZ(5)*SMATEL                                             QUAN-297
      IF (DABS(A).LT.1.D-10) GO TO 22                                   QUAN-298
      IT=IT+1                                                           QUAN-299
      NAT(1,IT)=IQ(3,K)+INVZ+INSL                                       QUAN-300
      NAT(2,IT)=0                                                       QUAN-301
      IF (LO(14)) NAT(2,IT)=NAT(1,IT)                                   QUAN-302
      AT(2,IT)=2.D0*A*A2                                                QUAN-303
      IF (LO(133)) AT(3,IT)=0.D0                                        QUAN-304
      IF (LLP) AT(3,IT)=2.D0*A*A3                                       QUAN-305
   22 CONTINUE                                                          QUAN-306
      LLO=.FALSE.                                                       QUAN-307
   23 IF (IT-IT1) 32 , 27 , 24                                          QUAN-308
C  SUMMATION OF COEFFICIENTS RELATED TO THE SAME FORM FACTOR.           QUAN-309
   24 IT2=IT-1                                                          QUAN-310
      DO 26 I=IT1,IT2                                                   QUAN-311
      DO 25 J=I,IT2                                                     QUAN-312
      IF ((NAT(1,I).NE.NAT(1,J+1)).OR.(NAT(2,I).NE.NAT(2,J+1))) GO TO 25QUAN-313
      AT(2,I)=AT(2,I)+AT(2,J+1)                                         QUAN-314
      AT(2,J+1)=0.D0                                                    QUAN-315
      IF (JD.EQ.2) GO TO 25                                             QUAN-316
      AT(3,I)=AT(3,I)+AT(3,J+1)                                         QUAN-317
      AT(3,J+1)=0.D0                                                    QUAN-318
   25 CONTINUE                                                          QUAN-319
   26 CONTINUE                                                          QUAN-320
C ELIMINATION OF TOO SMALL COEFFICIENTS.                                QUAN-321
   27 IT2=IT                                                            QUAN-322
      IT=IT1-1                                                          QUAN-323
      NMR=0                                                             QUAN-324
      NMI=0                                                             QUAN-325
      DO 28 I=IT1,IT2                                                   QUAN-326
      CX=DABS(AT(2,I))                                                  QUAN-327
      IF (JD.EQ.3) CX=CX+DABS(AT(3,I))                                  QUAN-328
      IF (CX.LT.1.D-10) GO TO 28                                        QUAN-329
      IT=IT+1                                                           QUAN-330
      NAT(1,IT)=NAT(1,I)                                                QUAN-331
      NAT(2,IT)=NAT(2,I)                                                QUAN-332
      AT(2,IT)=AT(2,I)                                                  QUAN-333
      IF (JD.EQ.3) AT(3,IT)=AT(3,I)                                     QUAN-334
      NMR=NMR+1                                                         QUAN-335
      IF (NAT(2,IT).NE.0) NMI=NMI+1                                     QUAN-336
   28 CONTINUE                                                          QUAN-337
      IF (NMR.NE.0) NIN=NIN+1                                           QUAN-338
      IF (NMI.NE.0) NIN=NIN+1                                           QUAN-339
      IF (LLO) GO TO 36                                                 QUAN-340
      IF (.NOT.(LO(13).OR.LO(19))) GO TO 32                             QUAN-341
      NVI(I2,I1,2)=IT                                                   QUAN-342
C COEFFICIENTS OF THE DERIVATIVE COUPLING                               QUAN-343
C FORM FACTOR  V(R)/R**2  COEFFICIENT: (I2||IQ||I1)*(G1-G2)             QUAN-344
C PARAMETRISATION: (I2||IQ||I1)*(G1-G2)*AZ(6).                          QUAN-345
      IT2=IT                                                            QUAN-346
      IF (LO(100)) GO TO 30                                             QUAN-347
      DO 29 I=IT1,IT2                                                   QUAN-348
      IF (NAT(1,I).GT.INVZ) GO TO 29                                    QUAN-349
      IJ=NAT(1,I)-ITY(5)                                                QUAN-350
      IF (IVZ(3,IJ).EQ.0) GO TO 29                                      QUAN-351
      A=DFLOAT(MC(I2,6)-MC(I1,6))*AZ(6)*2.D0                            QUAN-352
      IF (A.EQ.0.D0) GO TO 29                                           QUAN-353
      LO(110)=.TRUE.                                                    QUAN-354
      IT=IT+1                                                           QUAN-355
      NAT(1,IT)=IVZ(3,IJ)+INVZ+INSL                                     QUAN-356
      NAT(2,IT)=0                                                       QUAN-357
      IF (LO(14)) NAT(2,IT)=NAT(1,IT)                                   QUAN-358
      AT(2,IT)=AT(2,I)*A                                                QUAN-359
      IF (JD.EQ.3) AT(3,IT)=0.D0                                        QUAN-360
      IF (LLP) AT(3,IT)=AT(3,I)*A                                       QUAN-361
   29 CONTINUE                                                          QUAN-362
      GO TO 33                                                          QUAN-363
   30 DO 31 I=IT1,IT2                                                   QUAN-364
      IJ=NAT(1,I)                                                       QUAN-365
      IF (IVZ(3,IJ).EQ.0) GO TO 31                                      QUAN-366
      LO(110)=.TRUE.                                                    QUAN-367
      IT=IT+1                                                           QUAN-368
      NAT(1,IT)=IVZ(3,IJ)+INTV                                          QUAN-369
      NAT(2,IT)=0                                                       QUAN-370
      AT(2,IT)=AT(2,I)                                                  QUAN-371
      AT(3,IT)=AT(2,IT)*DFLOAT(MC(I2,6)-MC(I1,6))                       QUAN-372
   31 CONTINUE                                                          QUAN-373
      IF (IT.GT.IT2) NIN=NIN+1                                          QUAN-374
      GO TO 33                                                          QUAN-375
   32 NVI(I2,I1,2)=IT                                                   QUAN-376
   33 NVI(I2,I1,3)=IT                                                   QUAN-377
      IF (LO(100).OR.(NVI(I2,I1,3).EQ.NVI(I2,I1,2))) GO TO 38           QUAN-378
C COPY OF THE COEFFICIENTS AND CORRECTIONS IN ORDER TO OBTAIN           QUAN-379
C AN HERMITIAN INTERACTION.                                             QUAN-380
      K1=NVI(I2,I1,1)                                                   QUAN-381
      K2=NVI(I2,I1,2)                                                   QUAN-382
      IT1=IT+1                                                          QUAN-383
      NVI(I1,I2,1)=IT1                                                  QUAN-384
      DO 34 K=K1,K2                                                     QUAN-385
      IT=IT+1                                                           QUAN-386
      NAT(1,IT)=NAT(1,K)                                                QUAN-387
      NAT(2,IT)=NAT(2,K)                                                QUAN-388
      IF (JD.EQ.3) AT(3,IT)=AT(3,K)                                     QUAN-389
   34 AT(2,IT)=AT(2,K)                                                  QUAN-390
      K1=K2+1                                                           QUAN-391
      K2=NVI(I2,I1,3)                                                   QUAN-392
      DO 35 K=K1,K2                                                     QUAN-393
      IT=IT+1                                                           QUAN-394
      NAT(1,IT)=NAT(1,K)-INSL                                           QUAN-395
      NAT(2,IT)=0                                                       QUAN-396
      IF (NAT(2,K).NE.0) NAT(2,IT)=NAT(2,K)-INSL                        QUAN-397
      AT(2,IT)=-AT(2,K)                                                 QUAN-398
      IF (JD.EQ.3) AT(3,IT)=-AT(3,K)                                    QUAN-399
      IT=IT+1                                                           QUAN-400
      NAT(1,IT)=NAT(1,K)                                                QUAN-401
      NAT(2,IT)=NAT(2,K)                                                QUAN-402
      IF (JD.EQ.3) AT(3,IT)=AT(3,K)                                     QUAN-403
   35 AT(2,IT)=AT(2,K)                                                  QUAN-404
      LLO=.TRUE.                                                        QUAN-405
      GO TO 23                                                          QUAN-406
   36 NVI(I1,I2,2)=IT                                                   QUAN-407
      DO 37 K=K1,K2                                                     QUAN-408
      IT=IT+1                                                           QUAN-409
      NAT(1,IT)=NAT(1,K)                                                QUAN-410
      NAT(2,IT)=NAT(2,K)                                                QUAN-411
      IF (JD.EQ.3) AT(3,IT)=-AT(3,K)                                    QUAN-412
   37 AT(2,IT)=-AT(2,K)                                                 QUAN-413
      NVI(I1,I2,3)=IT                                                   QUAN-414
      NIN=NIN+2                                                         QUAN-415
      IF (LO(14)) NIN=NIN+2                                             QUAN-416
      GO TO 40                                                          QUAN-417
C SYMMETRISATION OF THE TABLE WHEN THERE IS NO DEFORMED SPIN-ORBIT.     QUAN-418
   38 DO 39 K=1,3                                                       QUAN-419
   39 NVI(I1,I2,K)=NVI(I2,I1,K)                                         QUAN-420
   40 CONTINUE                                                          QUAN-421
   41 CONTINUE                                                          QUAN-422
      IF (.NOT.LO(58)) GO TO 42                                         QUAN-423
C OUTPUT OF COUPLING COEFFICIENTS.                                      QUAN-424
      WRITE (MW,1002) ((J,I,(NVI(J,I,K),K=1,3),I=1,NC),J=1,NC)          QUAN-425
      IF (IT.EQ.0) GO TO 42                                             QUAN-426
      IF (JD.EQ.2) WRITE (MW,1003) (I,NAT(1,I),NAT(2,I),AT(2,I),I=1,IT) QUAN-427
      IF (JD.EQ.3) WRITE (MW,1004) (I,NAT(1,I),NAT(2,I),AT(2,I),AT(3,I),QUAN-428
     1I=1,IT)                                                           QUAN-429
   42 NCI=NCIN                                                          QUAN-430
      NIC=NC                                                            QUAN-431
      IF (.NOT.LO(123)) RETURN                                          QUAN-432
C FIND QUANTUM NUMBER OF COUPLED CHANNELS FOR IDENTICAL PARTICLES. NOT  QUAN-433
C USED FOR DIRAC FORMALISM (INCORRECT MEANING OF MC(*,10[3]) IN MTCH).  QUAN-434
      NCIN=0                                                            QUAN-435
      JA=NAJ/2                                                          QUAN-436
      ISI=IPI(2,1)-1                                                    QUAN-437
      NSM=ISI+1                                                         QUAN-438
      NSB=JPI+1                                                         QUAN-439
      DO 44 IS=NSB,NSM,2                                                QUAN-440
      LP=JA+IS                                                          QUAN-441
      LM=IABS(JA-IS+1)+1                                                QUAN-442
      DO 43 L=LM,LP                                                     QUAN-443
      IF (MOD(L+JPI,2).NE.1) GO TO 43                                   QUAN-444
      NCIN=NCIN+1                                                       QUAN-445
      MC(NCIN,10)=IPI(11,1)                                             QUAN-446
      MC(NCIN,7)=1                                                      QUAN-447
      MC(NCIN,8)=L-1                                                    QUAN-448
      MC(NCIN,9)=2*IS-2                                                 QUAN-449
      MC(NCIN,11)=MC(NCIN,8)*(MC(NCIN,8)+1)                             QUAN-450
      MC(NCIN,12)=(JA*(JA+1)-L*(L-1)-IS*(IS-1))/2                       QUAN-451
   43 CONTINUE                                                          QUAN-452
   44 CONTINUE                                                          QUAN-453
      NC=NCIN                                                           QUAN-454
      IF (LO(58)) WRITE (MW,1005) NCI,NCIN                              QUAN-455
      IF (NCIN.EQ.0) RETURN                                             QUAN-456
      IF (NIC.EQ.NCI) GO TO 46                                          QUAN-457
      N=NCI+1                                                           QUAN-458
      DO 45 I=N,NIC                                                     QUAN-459
      NC=NC+1                                                           QUAN-460
      MC(NC,7)=MC(I,1)                                                  QUAN-461
      MC(NC,8)=MC(I,2)                                                  QUAN-462
      MC(NC,9)=MC(I,3)                                                  QUAN-463
      MC(NC,10)=MC(I,4)                                                 QUAN-464
      MC(NC,11)=MC(I,5)                                                 QUAN-465
   45 MC(NC,12)=MC(I,6)                                                 QUAN-466
   46 IF (.NOT.LO(58)) GO TO 48                                         QUAN-467
      WRITE (MW,1000) AJ,IP(JPI+1),NC,NCIN                              QUAN-468
      DO 47 J=1,NC                                                      QUAN-469
      SJ=0.5D0*DFLOAT(MC(J,9))                                          QUAN-470
   47 WRITE (MW,1001) J,MC(J,7),MC(J,8),SJ,MC(J,10),MC(J,11),MC(J,12)   QUAN-471
C COMPUTATION OF TRANSFORMATION COEFFICIENTS.                           QUAN-472
   48 ITI=IT+1                                                          QUAN-473
      DO 50 J=1,NCIN                                                    QUAN-474
      DO 49 I=1,NCI                                                     QUAN-475
      AA(I,J)=0.D0                                                      QUAN-476
      IF (MC(J,8).NE.MC(I,2)) GO TO 49                                  QUAN-477
      IJ=MC(I,3)                                                        QUAN-478
      IS=MC(J,9)                                                        QUAN-479
      AA(I,J)=DFLOAT(1-MOD(2*MC(I,2)+NAJ+2*ISI,4))*DSQRT((IJ+1.D0)*(IS+1QUAN-480
     1.D0))*DJ6J(2*MC(I,2),ISI,IJ,ISI,NAJ,IS,FAC,NFA)                   QUAN-481
   49 CONTINUE                                                          QUAN-482
   50 CONTINUE                                                          QUAN-483
      LO(110)=.FALSE.                                                   QUAN-484
      NIN=0                                                             QUAN-485
      NI=NCI-NCIN                                                       QUAN-486
      IBB=2                                                             QUAN-487
      IF (.NOT.((LO(101).OR.LO(103)).AND.LO(100))) IBB=1                QUAN-488
      DO 70 I1=1,NC                                                     QUAN-489
      IF (I1.GT.NCIN) GO TO 51                                          QUAN-490
      J1=1                                                              QUAN-491
      K1=NCI                                                            QUAN-492
      GO TO 52                                                          QUAN-493
   51 J1=I1+NI                                                          QUAN-494
      K1=J1                                                             QUAN-495
   52 DO 69 I2=1,NC                                                     QUAN-496
      IF ((I2.GT.I1).AND.(IBB.EQ.1)) GO TO 70                           QUAN-497
      DO 67 IB=1,IBB                                                    QUAN-498
      IF (I2.GT.NCIN) GO TO 53                                          QUAN-499
      J2=1                                                              QUAN-500
      K2=NCI                                                            QUAN-501
      GO TO 54                                                          QUAN-502
   53 J2=I2+NI                                                          QUAN-503
      K2=J2                                                             QUAN-504
   54 IT1=IT+1                                                          QUAN-505
      IF (IB.EQ.1) NVI(I2,I1,4)=IT1                                     QUAN-506
      DO 58 L1=J1,K1                                                    QUAN-507
      A1=1.D0                                                           QUAN-508
      IF (L1.LE.NCI) A1=AA(L1,I1)                                       QUAN-509
      IF (A1.EQ.0.D0) GO TO 58                                          QUAN-510
      DO 57 L2=J2,K2                                                    QUAN-511
      A2=1.D0                                                           QUAN-512
      IF (L2.LE.NCI) A2=AA(L2,I2)                                       QUAN-513
      IF (A2.EQ.0.D0) GO TO 57                                          QUAN-514
      M1=NVI(L2,L1,IB)                                                  QUAN-515
      M2=NVI(L2,L1,IB+1)                                                QUAN-516
      IF (IB.EQ.2) M1=M1+1                                              QUAN-517
      IF (M1.GT.M2) GO TO 57                                            QUAN-518
      IF (2*(M2-M1+3+IT).GT.NMAX) CALL MEMO('QUAN',NMAX,2*(M2-M1+3+IT)) QUAN-519
      DO 56 M=M1,M2                                                     QUAN-520
      IT=IT+1                                                           QUAN-521
      NAT(1,IT)=NAT(1,M)                                                QUAN-522
      NAT(2,IT)=NAT(2,M)                                                QUAN-523
      DO 55 IX=2,JD                                                     QUAN-524
   55 AT(IX,IT)=AT(IX,M)*A1*A2                                          QUAN-525
   56 CONTINUE                                                          QUAN-526
   57 CONTINUE                                                          QUAN-527
   58 CONTINUE                                                          QUAN-528
      IF (IT-IT1) 66 , 63 , 59                                          QUAN-529
C  SUMMATION OF COEFFICIENTS RELATED TO THE SAME FORM FACTOR.           QUAN-530
   59 IT2=IT-1                                                          QUAN-531
      DO 62 I=IT1,IT2                                                   QUAN-532
      DO 61 J=I,IT2                                                     QUAN-533
      IF ((NAT(1,I).NE.NAT(1,J+1)).OR.(NAT(2,I).NE.NAT(2,J+1))) GO TO 61QUAN-534
      DO 60 IX=2,JD                                                     QUAN-535
      AT(IX,I)=AT(IX,I)+AT(IX,J+1)                                      QUAN-536
   60 AT(IX,J+1)=0.D0                                                   QUAN-537
   61 CONTINUE                                                          QUAN-538
   62 CONTINUE                                                          QUAN-539
C ELIMINATION OF TOO SMALL COEFFICIENTS.                                QUAN-540
   63 IT2=IT                                                            QUAN-541
      IT=IT1-1                                                          QUAN-542
      NMR=0                                                             QUAN-543
      NMI=0                                                             QUAN-544
      DO 65 I=IT1,IT2                                                   QUAN-545
      CX=DABS(AT(2,I))                                                  QUAN-546
      IF (LO(100)) CX=CX+DABS(AT(3,I))                                  QUAN-547
      IF (CX.LT.1.D-10) GO TO 65                                        QUAN-548
      IT=IT+1                                                           QUAN-549
      NAT(1,IT)=NAT(1,I)                                                QUAN-550
      NAT(2,IT)=NAT(2,I)                                                QUAN-551
      DO 64 IX=2,JD                                                     QUAN-552
   64 AT(IX,IT)=AT(IX,I)                                                QUAN-553
      IF (LO(100)) AT(3,IT)=AT(3,I)                                     QUAN-554
      NMR=NMR+1                                                         QUAN-555
      IF (NAT(2,IT).NE.0) NMI=NMI+1                                     QUAN-556
   65 CONTINUE                                                          QUAN-557
      IF (NMR.NE.0) NIN=NIN+1                                           QUAN-558
      IF (NMI.NE.0) NIN=NIN+1                                           QUAN-559
      IF ((IB.EQ.2).AND.(NMR.NE.0)) LO(110)=.TRUE.                      QUAN-560
   66 NVI(I2,I1,IB+4)=IT                                                QUAN-561
   67 CONTINUE                                                          QUAN-562
      IF (IBB.EQ.2) GO TO 70                                            QUAN-563
      NVI(I2,I1,6)=IT                                                   QUAN-564
C SYMMETRISATION OF THE TABLE WHEN THERE IS NO DEFORMED SPIN-ORBIT.     QUAN-565
      DO 68 K=4,6                                                       QUAN-566
   68 NVI(I1,I2,K)=NVI(I2,I1,K)                                         QUAN-567
   69 CONTINUE                                                          QUAN-568
   70 CONTINUE                                                          QUAN-569
      IF (.NOT.LO(58)) RETURN                                           QUAN-570
C OUTPUT OF COUPLING COEFFICIENTS.                                      QUAN-571
      WRITE (MW,1002) ((I,J,(NVI(I,J,K),K=4,6),I=1,NC),J=1,NC)          QUAN-572
      IF (IT.LT.ITI) RETURN                                             QUAN-573
      IF (.NOT.LO(100)) WRITE (MW,1003) (I,NAT(1,I),NAT(2,I),AT(2,I),I=IQUAN-574
     1TI,IT)                                                            QUAN-575
      IF (LO(100)) WRITE (MW,1004) (I,NAT(1,I),NAT(2,I),AT(2,I),AT(3,I),QUAN-576
     1I=ITI,IT)                                                         QUAN-577
      RETURN                                                            QUAN-578
 1000 FORMAT (/' CHANNEL SPIN AND PARITY',F6.1,A1,I11,' COUPLED CHANNELSQUAN-579
     1 AND',I3,' SOLUTIONS'//8X,' I',3X,' V',3X,' L',3X,' J',9X,' POT',5QUAN-580
     2X,' CL',6X,' CJ'/)                                                QUAN-581
 1001 FORMAT (5X,3I5,F6.1,I11,2I9)                                      QUAN-582
 1002 FORMAT (/' PAIRS OF CHANNELS N1 N2, AND COUPLING COEFFICIENT NUMBEQUAN-583
     1RS NVI(N1,N2,K),K=1,3'/(1X,6(I3,I3,',',3I4,';')))                 QUAN-584
 1003 FORMAT (//5X,'COEFFICIENTS'/(4(2X,3I3,1P,D15.6)))                 QUAN-585
 1004 FORMAT (//5X,'COEFFICIENTS'/(3(2X,3I3,1P,2D15.6)))                QUAN-586
 1005 FORMAT (/' NUMBER OF SOLUTIONS REDUCED FROM',I3,' TO',I3)         QUAN-587
      END                                                               QUAN-588
C 08/03/07                                                      ECIS06  MTCH-000
      SUBROUTINE MTCH(NVI,NCOLL,KAB,WV,MC,BG,NAT,AT,AA,ISM,LMAX2,NIV,IVZMTCH-001
     1,FG,LMAX1,LMAX3,KR,VCO,VDO,FAM,JD,LO)                             MTCH-002
C COMPUTATION OF COULOMB CORRECTIONS AS INTEGRALS FROM THE MATCHING     MTCH-003
C POINT IF LO(127)=.FALSE. OR FROM THE ORIGIN IF LO(127)=.TRUE..        MTCH-004
C INPUT:     NVI:     ADDRESSES OF COUPLINGS IN TABLE AT.               MTCH-005
C            NCOLL:   NUMBER OF NUCLEAR STATES.                         MTCH-006
C            KAB:     MAXIMUM NUMBER OF COUPLED CHANNELS.               MTCH-007
C            WV:      WAVE NUMBERS AND COULOMB PARAMETERS.              MTCH-008
C            MC:      NUCLEAR STATE NUMBER AND ANGULAR MOMENTUM.        MTCH-009
C            BG:      TABLE OF COULOMB INTEGRALS FROM 0 TO INFINITY     MTCH-010
C                     FOR COUPLED EQUATIONS OR WHEN LO(127)=.TRUE..     MTCH-011
C            NAT,AT:  TABLE OF COUPLING COEFFICIENTS.                   MTCH-012
C            ISM:     NUMBER OF INTEGRATION POINTS.                     MTCH-013
C            LMAX2:   FIRST DIMENSION OF TABLE BG.                      MTCH-014
C            NIV:     ADDRESS IN THE TABLE OF REDUCED MATRIX ELEMENT.   MTCH-015
C            IVZ:     TABLE FOR USE OF FORM FACTORS (SEE REDM 3RD PART).MTCH-016
C            FG:      COULOMB FUNCTIONS.                                MTCH-017
C            LMAX1:   FIRST DIMENSION OF TABLE FG.                      MTCH-018
C            LMAX3:   MAXIMUM NUMBER OF COULOMB INTEGRALS FROM THE      MTCH-019
C                     MATCHING POINT TO INFINITY.                       MTCH-020
C            VCO:     STRENGTH OF TAILS OF COULOMB POTENTIALS.          MTCH-021
C            VDO:     STRENGTH OF TAILS OF COULOMB TRANSITIONS.         MTCH-022
C            FAM(I,J):OUTPUT OF PREVIOUS CALL FROM WHICH J=1 TO 10 ARE  MTCH-023
C                     NEEDED IF UNCOUPLED SOLUTIONS ARE COPIED.         MTCH-024
C            JD:      FIRST DIMENSION OF NAT,ST.                        MTCH-025
C            LO(I):   LOGICAL CONTROLS:                                 MTCH-026
C               LO(11) =.TRUE. DEFORMED COULOMB POTENTIAL.              MTCH-027
C               LO(19) =.TRUE. DEFORMED COULOMB SPIN-ORBIT POTENTIAL.   MTCH-028
C               LO(29) =.TRUE. NO DIAGONAL TERMS IN SECOND MEMBER.      MTCH-029
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     MTCH-030
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   MTCH-031
C               LO(58) =.TRUE. OUTPUT OF THE COEFFICIENTS OF EACH FORM  MTCH-032
C                              FACTOR FOR ALL SETS OF EQUATIONS.        MTCH-033
C               LO(100)=.TRUE. DIRAC EQUATION.                          MTCH-034
C               LO(125)=.TRUE. USUAL COUPLED EQUATIONS.                 MTCH-035
C               LO(127)=.TRUE. COULOMB CORRECTIONS IN ASYMPTOTIC REGION.MTCH-036
C OUTPUT:    AA:      COULOMB INTEGRALS FROM THE MATCHING POINT TO      MTCH-037
C                     INFINITY FOR ITERATIONS LO(125)=.FALSE..          MTCH-038
C            FAM(I,J):MATCHING VALUES AND WAVE NUMBER FOR J=1 TO 6,     MTCH-039
C                     COEFFICIENT OF CENTRAL POTENTIAL FOR J=7,         MTCH-040
C                     COEFFICIENT OF SPIN-ORBIT POTENTIAL FOR J=9,      MTCH-041
C                     ENERGY FOR J=8, CENTRIFUGAL POTENTIAL FOR J=10.   MTCH-042
C                     IF LO(133)=.TRUE.,COEFFICIENT OF COULOMB POTENTIALMTCH-043
C                     FOR J=11 AND OF SPIN-ORBIT COULOMB FOR J=12.      MTCH-044
C WORKING AREAS:                                                        MTCH-045
C            AA(1,1,I):FOR I=7,10 IF LO(127) OR LO(125)=.TRUE.          MTCH-046
C            KR:      WORKING AREA IN SUBROUTINE LINS.                  MTCH-047
C                                                                       MTCH-048
C LOCAL TABLES LA(3,11) AND BA(2,11) ARE SET FOR COULOMB CORRECTIONS    MTCH-049
C LIMITED BY MCM(1)=5 AND MCM(2)=4.                                     MTCH-050
C                                                                       MTCH-051
C FOR THE COMMON  /DCONS/ SEE CALC.                                     MTCH-052
C FOR THE COMMON  /NOEQU/ SEE QUAN.                                     MTCH-053
C FOR THE COMMON  /POTE2/ SEE REDM.                                     MTCH-054
C                                                                       MTCH-055
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     MTCH-056
C  CHB:       PLANCK CONSTANT /(2*PI) IN MEV*FERMI.                     MTCH-057
C   USED:     CHB.                                                      MTCH-058
C                                                                       MTCH-059
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NOEQU/:                     MTCH-060
C  NCXN:      NUMBER OF SOLUTIONS NEEDED.                               MTCH-061
C  NC:        NUMBER OF EQUATIONS FOR IDENTICAL PARTICLES.              MTCH-062
C   USED:     NCXN,NC.                                                  MTCH-063
C                                                                       MTCH-064
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     MTCH-065
C  ITY(5):    STARTING ADDRESS OF REAL CENTRAL TRANSITION.              MTCH-066
C        ITY(5)=0 IS USED FOR DIRAC EQUATIONS.                          MTCH-067
C  INTV:      NUMBER OF TRANSITION FORM FACTORS WITHOUT SPIN-ORBIT,     MTCH-068
C             TAKING INTO ACCOUNT DISPERSION.                           MTCH-069
C  INSL:      NUMBER OF SPIN-ORBIT FORM TRANSITION FACTORS NOT TAKING   MTCH-070
C                  INTO ACCOUNT MULTIPLICATION BY 2.                    MTCH-071
C   USED:     ITY(5),INTV,INSL.                                         MTCH-072
C                                                                       MTCH-073
C***********************************************************************MTCH-074
      IMPLICIT REAL*8 (A-H,O-Z)                                         MTCH-075
      LOGICAL LO(150),LV                                                MTCH-076
      DIMENSION NVI(KAB,KAB,3),WV(22,*),MC(KAB,6),BG(LMAX2,*),NAT(2*JD,*MTCH-077
     1),AT(JD,*),AA(KAB,KAB,*),NIV(NCOLL,NCOLL,3),IVZ(4,*),FG(LMAX1,4,*)MTCH-078
     2,VCO(2,*),VDO(2,*),FAM(KAB,12),B(4),C(4),G(4),AB(4,2),KR(*),AV(5),MTCH-079
     3LA(3,11),BA(2,11),N1(4),N2(4),N3(4),N4(4)                         MTCH-080
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            MTCH-081
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         MTCH-082
      COMMON /NOEQU/ NCXN,NIC,NCI,NC,NCIN,NIN,JPI,IPJ,R1(2),NAJ         MTCH-083
      COMMON /INOUT/ MR,MW,MS                                           MTCH-084
      DATA N1,N2 /1,1,3,3,1,3,1,3/                                      MTCH-085
      DATA N3,N4 /1,1,2,2,1,2,1,2/                                      MTCH-086
      LV=LO(44).AND.(LO(57).OR.LO(58))                                  MTCH-087
      LL4=4                                                             MTCH-088
      IF (LO(127)) LL4=1                                                MTCH-089
      IF (LV) WRITE (MW,1000)                                           MTCH-090
C LOOPS ON EQUATIONS.                                                   MTCH-091
      DO 55 IC=1,NC                                                     MTCH-092
      I1=MC(IC,1)                                                       MTCH-093
      K1=MC(IC,4)                                                       MTCH-094
      L1=MC(IC,2)                                                       MTCH-095
      IF (K1.GE.0.OR.LO(127)) GO TO 2                                   MTCH-096
C TRANSFER OF INFORMATIONS WHEN UNCOUPLED FUNCTIONS ARE NOT RECOMPUTED. MTCH-097
      K1=-K1                                                            MTCH-098
      IF (.NOT.LO(100)) MC(IC,6)=0                                      MTCH-099
      IF (K1.EQ.IC) GO TO 5                                             MTCH-100
      DO 1 I=1,10                                                       MTCH-101
    1 FAM(IC,I)=FAM(K1,I)                                               MTCH-102
      GO TO 5                                                           MTCH-103
C VALUES OF LONG RANGE TAILS OF CENTRAL POTENTIALS.                     MTCH-104
    2 F2=VCO(1,K1)**2                                                   MTCH-105
      F3=VCO(2,K1)*MC(IC,6)                                             MTCH-106
      JC=0                                                              MTCH-107
      IF (I1.LE.NCOLL) JC=NIV(I1,I1,3)                                  MTCH-108
      IF (WV(3,I1).GT.0.D0.AND.JC.GT.0) GO TO 3                         MTCH-109
      F2=0.D0                                                           MTCH-110
      F3=0.D0                                                           MTCH-111
    3 IF (LO(127)) GO TO 5                                              MTCH-112
C INTEGRATION REGION - SET UP OF POTENTIAL IN FIVE POINTS FOR           MTCH-113
C TRANSFORMATION OF MATCHING VALUES.                                    MTCH-114
      B1=WV(8,1)*WV(8,1)/48.D0                                          MTCH-115
      C1=(ISM-1)*WV(8,1)                                                MTCH-116
      A1=WV(11,I1)**2                                                   MTCH-117
      IF (WV(3,I1).LT.0.D0) A1=-A1                                      MTCH-118
      DO 4 I=1,5                                                        MTCH-119
      AV(I)=B1*(2.D0*WV(11,I1)*WV(5,I1)/C1-A1+(MC(IC,5)-F2-F3/C1)/C1**2)MTCH-120
    4 C1=C1+0.5D0*WV(8,1)                                               MTCH-121
C COMPUTATION OF COULOMB CORRECTIONS.                                   MTCH-122
    5 AZ=ISM*WV(8,I1)                                                   MTCH-123
      DO 47 IP=1,IC                                                     MTCH-124
      DO 7 K=1,2                                                        MTCH-125
      DO 6 I=1,4                                                        MTCH-126
    6 AB(I,K)=0.D0                                                      MTCH-127
    7 CONTINUE                                                          MTCH-128
      I2=MC(IP,1)                                                       MTCH-129
      ILM=1                                                             MTCH-130
      IF (.NOT.LO(44)) GO TO 44                                         MTCH-131
      L2=MC(IP,2)                                                       MTCH-132
      I3=NIV(I2,I1,3)                                                   MTCH-133
      IF (I3.EQ.0) GO TO 44                                             MTCH-134
      AY=DSQRT(WV(11,I1)*WV(11,I2))                                     MTCH-135
      AW=AY*AZ                                                          MTCH-136
C SCAN THE COUPLINGS BETWEEN EQUATIONS.                                 MTCH-137
      IS=0                                                              MTCH-138
      IF ((.NOT.LO(100)).AND.LO(19).AND.(IC.NE.IP)) ILM=2               MTCH-139
      K1=NVI(IP,IC,1)                                                   MTCH-140
      K2=NVI(IP,IC,2)                                                   MTCH-141
      IF ((.NOT.LO(11)).OR.(K1.GT.K2)) GO TO 16                         MTCH-142
      IML=1                                                             MTCH-143
C CENTRAL CONTRIBUTION.                                                 MTCH-144
      I=1                                                               MTCH-145
    8 IF (VDO(1,I).EQ.0.D0) GO TO 30                                    MTCH-146
      II=I+ITY(5)                                                       MTCH-147
      DO 9 K=K1,K2                                                      MTCH-148
      IF (NAT(1,K).EQ.II) GO TO 10                                      MTCH-149
    9 CONTINUE                                                          MTCH-150
      GO TO 30                                                          MTCH-151
   10 IF ((AT(2,K).EQ.0.D0).AND.(.NOT.LO(100))) GO TO 30                MTCH-152
      LA1=MC(IC,2)                                                      MTCH-153
      LA2=MC(IP,2)                                                      MTCH-154
      LA3=IVZ(4,I)                                                      MTCH-155
      ZT=AT(2,K)*AY**LA3*VDO(1,I)/WV(8,I1)**2                           MTCH-156
      IF (LO(100)) ZT=ZT*.5D0*DSQRT((1.D0+WV(6,I1)/WV(7,I1))*(1.D0+WV(6,MTCH-157
     1I2)/WV(7,I1)))                                                    MTCH-158
      IM=1                                                              MTCH-159
   11 IF (IM.LT.5) YT=ZT                                                MTCH-160
      IF ((YT.EQ.0.D0).AND.(ZT.EQ.0.D0)) GO TO 14                       MTCH-161
      IF (IS.EQ.0) GO TO 13                                             MTCH-162
      DO 12 J=1,IS                                                      MTCH-163
      IF ((LA(1,J).NE.LA1).OR.(LA(2,J).NE.LA2).OR.(LA(3,J).NE.LA3)) GO TMTCH-164
     1O 12                                                              MTCH-165
      BA(1,J)=BA(1,J)+ZT                                                MTCH-166
      BA(2,J)=BA(2,J)+YT                                                MTCH-167
      GO TO 14                                                          MTCH-168
   12 CONTINUE                                                          MTCH-169
   13 IS=IS+1                                                           MTCH-170
      LA(1,IS)=LA1                                                      MTCH-171
      LA(2,IS)=LA2                                                      MTCH-172
      LA(3,IS)=LA3                                                      MTCH-173
      BA(1,IS)=ZT                                                       MTCH-174
      BA(2,IS)=YT                                                       MTCH-175
   14 GO TO ( 15 , 30 , 20 , 30 , 27 , 28 , 29 , 30 ),IM                MTCH-176
   15 IF (.NOT.LO(100)) GO TO 30                                        MTCH-177
C VECTOR CONTRIBUTION IN DIRAC EQUATION.                                MTCH-178
      IM=2                                                              MTCH-179
      LA1=MC(IC,3)-MC(IC,2)                                             MTCH-180
      LA2=MC(IP,3)-MC(IP,2)                                             MTCH-181
      LA3=IVZ(4,I)                                                      MTCH-182
      ZT=AT(4,K)*AY**LA3*VDO(1,I)*CHB**2*WV(11,I1)*WV(11,I2)/(2.D0*WV(7,MTCH-183
     1I1)*(WV(6,I2)+WV(7,I1))*WV(8,I1)**2)                              MTCH-184
      IF ((LA1-MC(IC,2))*(LA2-MC(IP,2)).LT.0) ZT=-ZT                    MTCH-185
      GO TO 11                                                          MTCH-186
   16 IF (.NOT.LO(19)) GO TO 31                                         MTCH-187
      K3=NVI(IP,IC,3)                                                   MTCH-188
C TENSOR CONTRIBUTION IN DIRAC EQUATION.                                MTCH-189
      IF (.NOT.LO(100)) GO TO 21                                        MTCH-190
      IML=2                                                             MTCH-191
      K4=K2+1                                                           MTCH-192
      IF (K4.GT.K3) GO TO 31                                            MTCH-193
      I=1                                                               MTCH-194
   17 IF (VDO(2,I).EQ.0.D0) GO TO 30                                    MTCH-195
      DO 18 K=K4,K3                                                     MTCH-196
      IF (NAT(1,K).EQ.IVZ(3,I)+INTV) GO TO 19                           MTCH-197
   18 CONTINUE                                                          MTCH-198
      GO TO 30                                                          MTCH-199
   19 IM=3                                                              MTCH-200
      LA1=MC(IC,3)-MC(IC,2)                                             MTCH-201
      LA2=MC(IP,2)                                                      MTCH-202
      LA3=IVZ(4,I)+1                                                    MTCH-203
      ZT=.5D0*(AT(4,K)+DFLOAT(LA3)*AT(2,K))*AY**LA3*VDO(2,I)*CHB*WV(11,IMTCH-204
     11)/(WV(8,I1)**2*WV(7,I1))                                         MTCH-205
      IF ((LA1-MC(IC,2)).GT.0) ZT=-ZT                                   MTCH-206
      GO TO 11                                                          MTCH-207
   20 IM=4                                                              MTCH-208
      LA1=MC(IC,2)                                                      MTCH-209
      LA2=MC(IP,3)-LA2                                                  MTCH-210
      ZT=-.5D0*(AT(4,K)-DFLOAT(LA3)*AT(2,K))*AY**LA3*VDO(2,I)*CHB*WV(11,MTCH-211
     1I2)/(WV(8,I2)**2*WV(7,I1))                                        MTCH-212
      IF ((LA2-MC(IP,2)).GT.0) ZT=-ZT                                   MTCH-213
      GO TO 11                                                          MTCH-214
   21 I=1                                                               MTCH-215
      IML=3                                                             MTCH-216
C SPIN-ORBIT CONTRIBUTION IN SCHROEDINGER EQUATION.                     MTCH-217
      KP1=NVI(IC,IP,1)                                                  MTCH-218
      KP2=NVI(IC,IP,2)                                                  MTCH-219
      KP3=NVI(IC,IP,3)                                                  MTCH-220
   22 IF (VDO(2,I).EQ.0.D0) GO TO 30                                    MTCH-221
      II=IVZ(3,I)+ITY(5)+INSL+INTV                                      MTCH-222
      AX1=0.D0                                                          MTCH-223
      AX2=0.D0                                                          MTCH-224
      AX3=0.D0                                                          MTCH-225
      IF (K1.GT.K3) GO TO 24                                            MTCH-226
      DO 23 K=K1,K3                                                     MTCH-227
      IF (NAT(1,K)+INSL.EQ.II) AX1=AT(2,K)                              MTCH-228
      IF ((K.LE.K2).AND.(NAT(1,K).EQ.II)) AX2=AT(2,K)                   MTCH-229
      IF ((K.GT.K2).AND.(NAT(1,K).EQ.II)) AX3=AT(2,K)                   MTCH-230
   23 CONTINUE                                                          MTCH-231
   24 AY1=0.D0                                                          MTCH-232
      AY2=0.D0                                                          MTCH-233
      AY3=0.D0                                                          MTCH-234
      IF (KP1.GT.KP3) GO TO 26                                          MTCH-235
      DO 25 K=KP1,KP3                                                   MTCH-236
      IF (NAT(1,K)+INSL.EQ.II) AY1=AT(2,K)                              MTCH-237
      IF ((K.LE.KP2).AND.(NAT(1,K).EQ.II)) AY2=AT(2,K)                  MTCH-238
      IF ((K.GT.KP2).AND.(NAT(1,K).EQ.II)) AY3=AT(2,K)                  MTCH-239
   25 CONTINUE                                                          MTCH-240
   26 IF ((K1.GT.K3).AND.(KP1.GT.KP3)) GO TO 30                         MTCH-241
      LA1=MC(IC,2)                                                      MTCH-242
      LA2=MC(IP,2)                                                      MTCH-243
      LA3=IVZ(4,I)+2                                                    MTCH-244
      IF (LA3.GT.LA1+LA2) GO TO 30                                      MTCH-245
      XT=AY**LA3*VDO(2,I)/WV(8,I1)**2                                   MTCH-246
      ZT=(AX2-DFLOAT(LA3-1)*AX1+DFLOAT(LA1+1)*AX3)*XT                   MTCH-247
      YT=(AY2-DFLOAT(LA3-1)*AY1+DFLOAT(LA2+1)*AY3)*XT                   MTCH-248
      IM=5                                                              MTCH-249
      GO TO 11                                                          MTCH-250
   27 LA3=LA3-1                                                         MTCH-251
      XT=XT/AY                                                          MTCH-252
      ZT=AX3*WV(11,I1)*WV(5,I1)/DFLOAT(LA1+1)*XT                        MTCH-253
      YT=AY3*WV(11,I2)*WV(5,I2)/DFLOAT(LA2+1)*XT                        MTCH-254
      IM=6                                                              MTCH-255
      GO TO 11                                                          MTCH-256
   28 LA2=LA2+1                                                         MTCH-257
      YT=-AY3*DSQRT(1.D0+(WV(5,I2)/DFLOAT(LA2))**2)*WV(11,I2)*XT        MTCH-258
      ZT=0.D0                                                           MTCH-259
      IM=7                                                              MTCH-260
      GO TO 11                                                          MTCH-261
   29 LA1=LA1+1                                                         MTCH-262
      LA2=LA2-1                                                         MTCH-263
      ZT=-AX3*DSQRT(1.D0+(WV(5,I1)/DFLOAT(LA1))**2)*WV(11,I1)*XT        MTCH-264
      YT=0.D0                                                           MTCH-265
      IM=8                                                              MTCH-266
      GO TO 11                                                          MTCH-267
   30 I=I+1                                                             MTCH-268
      IF (I.LE.INTV) GO TO ( 8 , 17 , 22 ),IML                          MTCH-269
      IF (IML.EQ.1) GO TO 16                                            MTCH-270
   31 IF (IS.EQ.0) GO TO 44                                             MTCH-271
      DO 43 IK=1,IS                                                     MTCH-272
      IF (DABS(BA(1,IK))+DABS(BA(2,IK)).LT.1.D-8) GO TO 43              MTCH-273
      LI=LA(1,IK)                                                       MTCH-274
      LF=LA(2,IK)                                                       MTCH-275
      LL=LA(3,IK)                                                       MTCH-276
      EI=WV(5,I1)                                                       MTCH-277
      EF=WV(5,I2)                                                       MTCH-278
      XI=WV(11,I1)*AZ                                                   MTCH-279
      XF=WV(11,I2)*AZ                                                   MTCH-280
      L3=(LI+LF-LL+3)/2                                                 MTCH-281
      IF (L3.LE.0) GO TO 43                                             MTCH-282
      CALL CORA(LL,LI,LF,EI,EF,XI,XF,B,C,LO(127))                       MTCH-283
C ORDER IN C   (LI,LF),(LI,LF+1),(LI+1,LF),(LI+1,LF+1).                 MTCH-284
C ORDER IN FG   F(EI)*F(EF),G(EI)*F(EF),F(EI)*G(EF),G(EI)*G(EF).        MTCH-285
      IF (LO(127)) GO TO 40                                             MTCH-286
      IF (L3+3.GT.LMAX3) GO TO 64                                       MTCH-287
C INTEGRATION REGION - INTEGRALS FROM MATCHING POINT TO INFINITY.       MTCH-288
C COMPUTATION OF THE INTEGRALS FROM THE MATCHING POINT USING B AND C.   MTCH-289
      DO 33 I=1,4                                                       MTCH-290
      G(I)=0.D0                                                         MTCH-291
      DO 32 J=1,4                                                       MTCH-292
   32 G(I)=G(I)+B(J)*FG(L3+J-1,I,I3)-C(J)*FG(L3+N3(J),N2(I),I1)*FG(L3+N4MTCH-293
     1(J),N1(I),I2)                                                     MTCH-294
   33 CONTINUE                                                          MTCH-295
      DO 35 I=1,ILM                                                     MTCH-296
      DO 34 J=1,4                                                       MTCH-297
   34 AB(J,I)=AB(J,I)+BA(I,IK)*G(J)                                     MTCH-298
   35 CONTINUE                                                          MTCH-299
      IF (LO(125).OR.(LO(29).AND.(IP.EQ.IC))) GO TO 38                  MTCH-300
      C0=-DFLOAT(LL+1)/AZ+6.D0/WV(8,I1)                                 MTCH-301
      DO 37 I=1,ILM                                                     MTCH-302
      YT=BA(I,IK)*WV(8,I1)**2*AY/(12.D0*AW**(LL+1))                     MTCH-303
C WITH THE GREEN'S FUNCTIONS METHOD,WE MUST ADD H**2*FP(R)/12           MTCH-304
C WHICH IS VRE(ISM-1)*(KI*FP(I)*G(F)+KF*F(I)*GP(F)-(LL+1)/R)/12.        MTCH-305
C FINITE STEP CORRECTIONS.                                              MTCH-306
      DO 36 J=1,4                                                       MTCH-307
   36 AB(J,I)=AB(J,I)-YT*(WV(11,I1)*FG(LI+1,N2(J)+1,I1)*FG(LF+1,N1(J),I2MTCH-308
     1)+WV(11,I2)*FG(LI+1,N2(J),I1)*FG(LF+1,N1(J)+1,I2)+C0*FG(LI+1,N2(J)MTCH-309
     2,I1)*FG(LF+1,N1(J),I2))                                           MTCH-310
   37 CONTINUE                                                          MTCH-311
      GO TO 43                                                          MTCH-312
C CORRECTION OF THE POTENTIAL IN FIVE POINTS FOR MATCHING VALUES.       MTCH-313
   38 C1=DFLOAT(ISM-1)*WV(8,I1)*AY                                      MTCH-314
      DO 39 I=1,5                                                       MTCH-315
      AV(I)=AV(I)+BA(1,IK)*AY*WV(8,I1)**2/C1**(LL+1)/48.D0              MTCH-316
   39 C1=C1+0.5D0*WV(8,I1)*AY                                           MTCH-317
      GO TO 43                                                          MTCH-318
C COMPUTATION OF INTEGRALS FROM 0 TO INFINITY USING B.                  MTCH-319
   40 AX=0.D0                                                           MTCH-320
      IF (L3+3.GT.LMAX2) GO TO 65                                       MTCH-321
      DO 41 I=1,4                                                       MTCH-322
   41 AX=AX+B(I)*BG(L3+I-1,I3)                                          MTCH-323
      DO 42 I=1,ILM                                                     MTCH-324
   42 AB(1,I)=AB(1,I)+BA(I,IK)*AX                                       MTCH-325
   43 CONTINUE                                                          MTCH-326
C LIMITATION FOR TOO LARGE INTEGRAL OF IRREGULAR FUNCTIONS.             MTCH-327
   44 IF (DABS(AB(4,1)).GT.WV(11,I1)) AB(4,1)=AB(1,1)                   MTCH-328
      IF ((ILM.EQ.2).AND.(DABS(AB(4,2)).GT.WV(11,I2))) AB(4,2)=AB(1,2)  MTCH-329
      IF (.NOT.LV) GO TO 45                                             MTCH-330
      WRITE (MW,1001) IC,IP,L1,L2,(AB(I,1),I=1,LL4)                     MTCH-331
      IF (ILM.EQ.2) WRITE (MW,1001) IP,IC,L2,L1,(AB(I,2),I=1,LL4)       MTCH-332
C BUILD UP OF MATRIX OF CORRECTIONS.                                    MTCH-333
   45 DO 46 L=1,LL4                                                     MTCH-334
      IF (IC.NE.IP) AA(IP,IC,L)=AB(L,ILM)                               MTCH-335
   46 AA(IC,IP,L)=AB(L,1)                                               MTCH-336
      IF (LO(127).OR.(IC.EQ.IP)) GO TO 47                               MTCH-337
      AA(IP,IC,2)=AB(3,ILM)                                             MTCH-338
      AA(IP,IC,3)=AB(2,ILM)                                             MTCH-339
   47 CONTINUE                                                          MTCH-340
      IF (.NOT.LO(127)) GO TO 48                                        MTCH-341
      IF (JC.LE.0) GO TO 55                                             MTCH-342
      IF (WV(5,I1).EQ.0.D0) F2=F3*WV(11,I1)                             MTCH-343
      AA(IC,IC,1)=AA(IC,IC,1)-F2*BG(L1+1,JC)*WV(11,I1)                  MTCH-344
      IF ((WV(5,I1).EQ.0.D0).OR.(F3.EQ.0.D0)) GO TO 55                  MTCH-345
      B1=2.D0*WV(5,I1)*DFLOAT(L1*(L1+1))                                MTCH-346
      B2=DFLOAT(L1+1)**2+WV(5,I1)**2                                    MTCH-347
      C1=-(DFLOAT(2*L1+1)*B2+2*WV(5,I1)**2)/B1                          MTCH-348
      C2=DFLOAT(2*L1+3)*B2/B1                                           MTCH-349
      AA(IC,IC,1)=AA(IC,IC,1)-F3*(C1*BG(L1+1,JC)+C2*BG(L1+2,JC))*WV(11,IMTCH-350
     11)**2                                                             MTCH-351
      GO TO 55                                                          MTCH-352
   48 IF (MC(IC,4).LT.0) GO TO 55                                       MTCH-353
C MATCHING VALUES.                                                      MTCH-354
      DO 49 K=1,4                                                       MTCH-355
   49 B(K)=FG(L1+1,K,I1)                                                MTCH-356
      IF (JC.LE.0) GO TO 53                                             MTCH-357
      IF ((.NOT.LO(29)).AND.(F2.EQ.0.D0.AND.F3.EQ.0.D0)) GO TO 53       MTCH-358
      IF (WV(5,I1).NE.0.D0) GO TO 50                                    MTCH-359
      F2=F3*WV(11,I1)                                                   MTCH-360
      F3=0.D0                                                           MTCH-361
   50 DO 51 K=1,4                                                       MTCH-362
   51 G(K)=-FG(L1+1,K,JC)*F2+AB(K,1)/WV(11,I1)                          MTCH-363
      IF (F3.EQ.0.D0) GO TO 52                                          MTCH-364
      B1=2.D0*WV(5,I1)*DFLOAT(L1*(L1+1))                                MTCH-365
      B2=DFLOAT(L1+1)**2+WV(5,I1)**2                                    MTCH-366
      C1=-(DFLOAT(2*L1+1)*B2+2*WV(5,I1)**2)/B1                          MTCH-367
      C2=DFLOAT(2*L1+3)*B2/B1                                           MTCH-368
      A1=DFLOAT(ISM)*WV(8,I1)*WV(11,I1)                                 MTCH-369
      D1=(B2+DFLOAT(L1+1)*WV(5,I1)/A1)/A1/B1                            MTCH-370
      D2=-WV(5,I1)*DSQRT(B2)/B1/A1                                      MTCH-371
      A1=B2/B1/A1                                                       MTCH-372
      A3=F3*WV(11,I1)                                                   MTCH-373
      G(1)=G(1)-A3*(C1*FG(L1+1,1,JC)+C2*FG(L1+2,1,JC)-D1*FG(L1+1,1,I1)**MTCH-374
     12-D2*2.D0*FG(L1+1,1,I1)*FG(L1+2,1,I1)-A1*FG(L1+2,1,I1)**2)        MTCH-375
      G(2)=G(2)-A3*(C1*FG(L1+1,2,JC)+C2*FG(L1+2,2,JC)-D1*FG(L1+1,1,I1)*FMTCH-376
     1G(L1+1,3,I1)-D2*(FG(L1+1,1,I1)*FG(L1+2,3,I1)+FG(L1+2,1,I1)*FG(L1+1MTCH-377
     2,3,I1))-A1*FG(L1+2,1,I1)*FG(L1+2,3,I1))                           MTCH-378
      G(4)=G(4)-A3*(C1*FG(L1+1,4,JC)+C2*FG(L1+2,4,JC)-D1*FG(L1+1,3,I1)**MTCH-379
     12-D2*2.D0*FG(L1+1,3,I1)*FG(L1+2,3,I1)-A1*FG(L1+2,3,I1)**2)        MTCH-380
   52 A4=1.D0+(G(1)*G(4)-G(2)**2)                                       MTCH-381
      G(3)=B(1)                                                         MTCH-382
      B(1)=(B(1)*(1.D0-G(2))+G(1)*B(3))/A4                              MTCH-383
      B(3)=(-G(3)*G(4)+(1.D0+G(2))*B(3))/A4                             MTCH-384
      G(3)=B(2)                                                         MTCH-385
      B(2)=(B(2)*(1.D0-G(2))+G(1)*B(4))/A4                              MTCH-386
      B(4)=(-G(3)*G(4)+(1.D0+G(2))*B(4))/A4                             MTCH-387
   53 A1=(1.D0-AV(2))/(2.D0+10.D0*AV(2))                                MTCH-388
      B1=(1.D0-AV(4))/(2.D0+10.D0*AV(4))                                MTCH-389
      A2=A1*(1.D0-AV(1))/(1.D0-4.D0*AV(1))                              MTCH-390
      B2=B1*(1.D0-AV(5))/(1.D0-4.D0*AV(5))                              MTCH-391
      C1=(2.D0+10.D0*AV(3))-(1.D0-AV(3))*(A1+B1)                        MTCH-392
      A1=(16.D0-144.D0*AV(2))/(2.D0+10.D0*AV(2))                        MTCH-393
      B1=(16.D0-144.D0*AV(4))/(2.D0+10.D0*AV(4))                        MTCH-394
      C2=(7.D0+A1*(1.D0-AV(1)))/(1.D0-4.D0*AV(1))                       MTCH-395
      D2=(7.D0+B1*(1.D0-AV(5)))/(1.D0-4.D0*AV(5))                       MTCH-396
      D1=(B1-A1)*(1.D0-AV(3))                                           MTCH-397
      A1=A2*D2+B2*C2                                                    MTCH-398
      B1=(C1*D2+D1*B2)/A1                                               MTCH-399
      B2=30.D0*WV(8,1)*B2*WV(11,I1)/A1                                  MTCH-400
      FAM(IC,1)=B1*B(1)-B2*B(2)                                         MTCH-401
      FAM(IC,3)=B1*B(3)-B2*B(4)                                         MTCH-402
      B1=(C2*C1-A2*D1)/A1                                               MTCH-403
      A2=-30.D0*WV(8,1)*A2*WV(11,I1)/A1                                 MTCH-404
      FAM(IC,2)=B1*B(1)-A2*B(2)                                         MTCH-405
      FAM(IC,4)=B1*B(3)-A2*B(4)                                         MTCH-406
      FAM(IC,5)=WV(11,I1)                                               MTCH-407
      IF (LO(100)) FAM(IC,5)=FAM(IC,5)*CHB/(WV(7,I1)+WV(6,I1))          MTCH-408
      BT=FAM(IC,2)*FAM(IC,3)-FAM(IC,1)*FAM(IC,4)                        MTCH-409
      IF (BT.EQ.0.D0) BT=1.D0                                           MTCH-410
      DO 54 I=1,4                                                       MTCH-411
   54 FAM(IC,I)=FAM(IC,I)/BT                                            MTCH-412
      FAM(IC,6)=FAM(IC,5)/BT                                            MTCH-413
      IF (LO(100)) FAM(IC,5)=FAM(IC,5)*WV(8,I1)                         MTCH-414
      FAM(IC,7)=WV(9,I1)**2                                             MTCH-415
      FAM(IC,9)=2.D0*FAM(IC,7)*DFLOAT(MC(IC,6))                         MTCH-416
      FAM(IC,8)=WV(12,I1)                                               MTCH-417
      FAM(IC,10)=DFLOAT(MC(IC,5))                                       MTCH-418
      FAM(IC,11)=WV(10,I1)**2                                           MTCH-419
      FAM(IC,12)=2.D0*FAM(IC,11)*DFLOAT(MC(IC,6))                       MTCH-420
      IF (.NOT.LO(103)) FAM(IC,12)=0.D0                                 MTCH-421
      IF (WV(5,I1).EQ.0.D0) FAM(IC,11)=0.D0                             MTCH-422
   55 CONTINUE                                                          MTCH-423
      DO 58 IC=1,NC                                                     MTCH-424
      I1=MC(IC,1)                                                       MTCH-425
      DO 57 L=1,LL4                                                     MTCH-426
      DO 56 IP=1,NC                                                     MTCH-427
   56 AA(IC,IP,L)=AA(IC,IP,L)/WV(11,I1)                                 MTCH-428
   57 CONTINUE                                                          MTCH-429
   58 CONTINUE                                                          MTCH-430
      IF (.NOT.LO(127)) RETURN                                          MTCH-431
      IF (.NOT.LO(125)) GO TO 61                                        MTCH-432
C TRANSPOSITION IF COUPLED EQUATIONS ARE USED.                          MTCH-433
      DO 60 IC=1,NC                                                     MTCH-434
      DO 59 IP=1,IC                                                     MTCH-435
      AX=AA(IP,IC,1)                                                    MTCH-436
      AA(IP,IC,1)=AA(IC,IP,1)                                           MTCH-437
   59 AA(IC,IP,1)=AX                                                    MTCH-438
   60 CONTINUE                                                          MTCH-439
C LINEAR SYSTEM FOR COMPUTATION OF THE S-MATRIX FROM THE K-MATRIX.      MTCH-440
   61 DO 63 IC=1,NC                                                     MTCH-441
      DO 62 IP=1,NC                                                     MTCH-442
      AA(IC,IP,2)=0.D0                                                  MTCH-443
      AA(IC,IP,4)=0.D0                                                  MTCH-444
   62 AA(IC,IP,5)=-AA(IC,IP,1)                                          MTCH-445
   63 AA(IC,IC,4)=1.D0                                                  MTCH-446
      CALL LINS(AA(1,1,4),KAB,AA,KAB,AA(1,1,5),KAB,AA(1,1,2),KAB,NC,NCXNMTCH-447
     1,KR,IER)                                                          MTCH-448
      RETURN                                                            MTCH-449
   64 WRITE (MW,1002) L3,LI,LF,LMAX3                                    MTCH-450
      RETURN                                                            MTCH-451
   65 WRITE (MW,1003) L3,LMAX2                                          MTCH-452
      RETURN                                                            MTCH-453
 1000 FORMAT (/' CHANNELS  L-VALUES     COULOMB INTEGRALS: F*F,G*F,F*G AMTCH-454
     1ND G*G:')                                                         MTCH-455
 1001 FORMAT (2X,2I3,2X,2I4,3X,4D18.10)                                 MTCH-456
 1002 FORMAT (' STARTING VALUES',I3,' FOR INTEGRALS AND',2I4,' FOR COULOMTCH-457
     1MB FUNCTIONS TOO LARGE . LIMITATION AT',I4)                       MTCH-458
 1003 FORMAT (' STARTING VALUE',I4,' TOO LARGE FOR COULOMB INTEGRALS WHIMTCH-459
     1CH ARE COMPUTED UP TO',I5)                                        MTCH-460
      END                                                               MTCH-461
C 09/03/07                                                      ECIS06  LINS-000
      SUBROUTINE LINS(A,IA,B,IB,X,IX,Y,IY,N,M,K,IER)                    LINS-001
C LINS: JLSB2 VERSION 01 18/12/68 MATH L003 OF SACLAY                   LINS-002
C SOLUTION OF DOUBLE PRECISION COMPLEX LINEAR SYSTEMS WITH REAL AND     LINS-003
C IMAGINARY PARTS IN DIFFERENT AREAS.                                   LINS-004
C INPUT:     A:       REAL COMPONENT OF MATRIX.                         LINS-005
C            IA:      FIRST DIMENSION OF AREA A.                        LINS-006
C            B:       IMAGINARY COMPONENT OF MATRIX.                    LINS-007
C            IB:      FIRST DIMENSION OF AREA B.                        LINS-008
C            X:       REAL SECOND MEMBERS.                              LINS-009
C            IX:      FIRST DIMENSION OF AREA X.                        LINS-010
C            Y:       IMAGINARY SECOND MEMBERS.                         LINS-011
C            IY:      FIRST DIMENSION OF AREA Y.                        LINS-012
C            N:       ORDER OF THE SYSTEM.                              LINS-013
C            M:       NUMBER OF SECOND MEMBERS.                         LINS-014
C OUTPUT:    X,Y:     SECOND MEMBERS ARE REPLACED BY SOLUTIONS.         LINS-015
C            IER:     RETURNS DIAGNOSTIC: 0 NON SINGULAR MATRIX,        LINS-016
C                                         1 SINGULAR MATRIX,            LINS-017
C                                         2 QUASI SINGULAR MATRIX.      LINS-018
C WORKING AREAS:                                                        LINS-019
C            K:       WORKING FIELD OF DIMENSION >/= N.                 LINS-020
C***********************************************************************LINS-021
      IMPLICIT REAL*8 (A-H,O-Z)                                         LINS-022
      DIMENSION A(IA,*),B(IB,*),X(IX,*),Y(IY,*),K(*)                    LINS-023
      COMMON /INOUT/ MR,MW,MS                                           LINS-024
      IER=0                                                             LINS-025
      DO 1 I=1,N                                                        LINS-026
    1 K(I)=I                                                            LINS-027
      DO 14 I=1,N                                                       LINS-028
      AMAX=DABS(A(I,I))+DABS(B(I,I))                                    LINS-029
      JMAX=I                                                            LINS-030
      I1=I+1                                                            LINS-031
      IF (I.EQ.N) GO TO 3                                               LINS-032
      DO 2 J=I1,N                                                       LINS-033
      AMAY=DABS(A(I,J))+DABS(B(I,J))                                    LINS-034
      IF (AMAX.GE.AMAY) GO TO 2                                         LINS-035
      AMAX=AMAY                                                         LINS-036
      JMAX=J                                                            LINS-037
    2 CONTINUE                                                          LINS-038
    3 IF (AMAX.EQ.0.D0) GO TO 21                                        LINS-039
      IF (JMAX.EQ.I) GO TO 5                                            LINS-040
      DO 4 I2=1,N                                                       LINS-041
      AUX=B(I2,I)                                                       LINS-042
      B(I2,I)=B(I2,JMAX)                                                LINS-043
      B(I2,JMAX)=AUX                                                    LINS-044
      AUX=A(I2,I)                                                       LINS-045
      A(I2,I)=A(I2,JMAX)                                                LINS-046
    4 A(I2,JMAX)=AUX                                                    LINS-047
      NAB=K(JMAX)                                                       LINS-048
      K(JMAX)=K(I)                                                      LINS-049
      K(I)=NAB                                                          LINS-050
    5 IF (I.EQ.1) GO TO 7                                               LINS-051
      SR=0.D0                                                           LINS-052
      SI=0.D0                                                           LINS-053
      T=0.D0                                                            LINS-054
      I4=I-1                                                            LINS-055
      DO 6 IT=1,I4                                                      LINS-056
      PR=A(IT,I)*A(I,IT)-B(IT,I)*B(I,IT)                                LINS-057
      PI=A(IT,I)*B(I,IT)+A(I,IT)*B(IT,I)                                LINS-058
      SR=SR+PR                                                          LINS-059
      SI=SI+PI                                                          LINS-060
    6 T=T+DABS(PR)+DABS(PI)                                             LINS-061
      ERA=1.D-16*(T+DABS(A(I,I)-SR)+DABS(B(I,I)-SI))                    LINS-062
      IF (AMAX.GT.ERA) GO TO 7                                          LINS-063
      IER=2                                                             LINS-064
      WRITE (MW,1000)                                                   LINS-065
      GO TO 22                                                          LINS-066
    7 IF (I.EQ.N) GO TO 9                                               LINS-067
      DO 8 J=I1,N                                                       LINS-068
      AA=A(I,J)                                                         LINS-069
      BB=B(I,J)                                                         LINS-070
      AI=A(I,I)                                                         LINS-071
      BI=B(I,I)                                                         LINS-072
      D=AI*AI+BI*BI                                                     LINS-073
      A(I,J)=(AA*AI+BB*BI)/D                                            LINS-074
    8 B(I,J)=(BB*AI-AA*BI)/D                                            LINS-075
    9 DO 10 J=1,M                                                       LINS-076
      AA=X(I,J)                                                         LINS-077
      BB=Y(I,J)                                                         LINS-078
      AI=A(I,I)                                                         LINS-079
      BI=B(I,I)                                                         LINS-080
      D=AI*AI+BI*BI                                                     LINS-081
      X(I,J)=(AA*AI+BB*BI)/D                                            LINS-082
   10 Y(I,J)=(BB*AI-AA*BI)/D                                            LINS-083
      IF (I.EQ.N) GO TO 14                                              LINS-084
      DO 13 I3 =I1,N                                                    LINS-085
      DO 11 J3 =I1,N                                                    LINS-086
      B(I3,J3)=B(I3,J3)-A(I3,I)*B(I,J3)-B(I3,I)*A(I,J3)                 LINS-087
   11 A(I3,J3)=A(I3,J3)-A(I3,I)*A(I,J3)+B(I3,I)*B(I,J3)                 LINS-088
      DO 12 J3 =1,M                                                     LINS-089
      Y(I3,J3)=Y(I3,J3)-A(I3,I)*Y(I,J3)-B(I3,I)*X(I,J3)                 LINS-090
   12 X(I3,J3)=X(I3,J3)-A(I3,I)*X(I,J3)+B(I3,I)*Y(I,J3)                 LINS-091
   13 CONTINUE                                                          LINS-092
   14 CONTINUE                                                          LINS-093
      IF (N.EQ.1) GO TO 22                                              LINS-094
      DO 17 KC=1,M                                                      LINS-095
      J=N                                                               LINS-096
   15 I=J-1                                                             LINS-097
   16 X(I,KC)=X(I,KC)-X(J,KC)*A(I,J)+Y(J,KC)*B(I,J)                     LINS-098
      Y(I,KC)=Y(I,KC)-X(J,KC)*B(I,J)-Y(J,KC)*A(I,J)                     LINS-099
      I=I-1                                                             LINS-100
      IF (I.NE.0) GO TO 16                                              LINS-101
      J=J-1                                                             LINS-102
      IF (J.NE.1) GO TO 15                                              LINS-103
   17 CONTINUE                                                          LINS-104
      DO 20 I=1,N                                                       LINS-105
   18 J=K(I)                                                            LINS-106
      IF (J.LE.I) GO TO 20                                              LINS-107
      K(I)=K(J)                                                         LINS-108
      K(J)=J                                                            LINS-109
      DO 19 MP=1,M                                                      LINS-110
      AUX=Y(J,MP)                                                       LINS-111
      Y(J,MP)=Y(I,MP)                                                   LINS-112
      Y(I,MP)=AUX                                                       LINS-113
      AUX=X(J,MP)                                                       LINS-114
      X(J,MP)=X(I,MP)                                                   LINS-115
   19 X(I,MP)=AUX                                                       LINS-116
      GO TO 18                                                          LINS-117
   20 CONTINUE                                                          LINS-118
      GO TO 22                                                          LINS-119
   21 IER=1                                                             LINS-120
      WRITE (MW,1001)                                                   LINS-121
   22 RETURN                                                            LINS-122
 1000 FORMAT (' *****  LINS  ***** QUASI SINGULAR MATRIX.')             LINS-123
 1001 FORMAT (' *****  LINS  *****       SINGULAR MATRIX.')             LINS-124
      END                                                               LINS-125
C 02/02/06                                                      ECIS06  CORA-000
      SUBROUTINE CORA(LQ,L1,L2,EI,FI,VI,WI,B,C,LT)                      CORA-001
C COEFFICIENTS FOR COULOMB INTEGRALS                                    CORA-002
C M(L1,L2,LQ,R)=SUM FROM R TO INFINITY OF H(L1)*K(L2)/R**(LQ+1)         CORA-003
C EXPRESSED AS SUM ON I OF B(I)*M(L+I-2,L+I-2,1) + C1(R)*H(L)*K(L)      CORA-004
C + C2(R)*H(L)*K(L+1) + C3(R)*H(L+1)*K(L) + C4(R)*H(L+1)*K(L+1)         CORA-005
C WHERE H AND K ARE REGULAR OR IRREGULAR COULOMB FUNCTIONS              CORA-006
C L=INTEGER PART OF (L1+L2-LQ+3)/2 AND I RANGES FROM 1 TO 4.            CORA-007
C INPUT:     LQ:      LQ IN THE EXPRESSIONS ABOVE.                      CORA-008
C            L1,L2:   L1, L2 IN THE EXPRESSIONS ABOVE.                  CORA-009
C            EI,EF:   COULOMB PARAMETERS.                               CORA-010
C            VI,WI:   PRODUCT OF R WITH THE WAVE NUMBERS.               CORA-011
C            LT:      .TRUE. FOR ONLY INTEGRALS FROM 0 TO INFINITY.     CORA-012
C OUTPUT:    B(4):    COEFFICIENTS B IN THE EXPRESSIONS ABOVE.          CORA-013
C            C(4):    COEFFICIENTS C.                                   CORA-014
C                                                                       CORA-015
C THESE RESULTS ARE OBTAINED BY EXPRESSING                              CORA-016
C H(L1)*K(L2)/R**(LQ+1)- SUM ON I OF B(I)*H(L+I-2)*K(L+I-2)/R**2        CORA-017
C AS P1*H(L)*K(L) + P2*H(L)*K(L+1) + P3*H(L+1)*K(L) + P4*H(L+1)*Q(L+1)  CORA-018
C WHERE P1,P2,P3,P4 ARE POLYNOMIAL IN 1/R AND IDENTIFICATION TERM BY    CORA-019
C TERM STARTING FROM THE HIGHEST DEGREE IN 1/R WITH THE DERIVATIVE OF   CORA-020
C  Q1*H(L)*K(L) + Q2*H(L)*K(L+1) + Q3*H(L+1)*K(L) + Q4*H(L+1)*Q(L+1)    CORA-021
C THIS AS BEEN DONE USING AMP ( J.-M. DROUFFE, AMP LANGUAGE REFERENCE   CORA-022
C MANUAL - VERSION 6 - NOTE CEA-N-2297 1982).                           CORA-023
C                                                                       CORA-024
C THE NON RELATIVISTIC RESULTS FOR LQ=6 L2-L1=0,2,4 AND ALL THE         CORA-025
C COEFFICIENTS UP TO LQ=5 HAVE BEEN OBTAINED. THIS ALLOW TRANSFER OF    CORA-026
C ANGULAR MOMENTUM UP TO 5 FOR CENTRAL TERM AND 4 FOR SPIN-ORBIT.       CORA-027
C                                                                       CORA-028
C***********************************************************************CORA-029
      IMPLICIT REAL*8 (A-H,O-Z)                                         CORA-030
      DIMENSION B(4),C(4)                                               CORA-031
      LOGICAL LT                                                        CORA-032
      COMMON /INOUT/ MR,MW,MS                                           CORA-033
      DO 1 I=1,4                                                        CORA-034
      B(I)=0.D0                                                         CORA-035
    1 C(I)=0.D0                                                         CORA-036
      IF (L1.LE.L2) GO TO 2                                             CORA-037
      LL=L1-L2+1                                                        CORA-038
      E=FI                                                              CORA-039
      F=EI                                                              CORA-040
      V=WI                                                              CORA-041
      W=VI                                                              CORA-042
      GO TO 3                                                           CORA-043
    2 LL=L2-L1+1                                                        CORA-044
      E=EI                                                              CORA-045
      F=FI                                                              CORA-046
      V=VI                                                              CORA-047
      W=WI                                                              CORA-048
    3 IF ((LQ.GT.6).OR.(LL*(LQ-LL+2).LE.0)) GO TO 71                    CORA-049
      A=DFLOAT((L1+L2-LQ+5)/2)                                          CORA-050
      S=V/W                                                             CORA-051
      X=E*S-F                                                           CORA-052
      IF (DABS(X).LT.1.D-14) X=0.D0                                     CORA-053
      U=S**2-1.D0                                                       CORA-054
      IF (DABS(U).LT.1.D-14) U=0.D0                                     CORA-055
      IF ((X.EQ.0.D0).AND.(E.EQ.0.D0)) GO TO 49                         CORA-056
      P=S**2*(A**2+E**2)                                                CORA-057
      Q=A**2+F**2                                                       CORA-058
      Y=E*S+F                                                           CORA-059
      Z=E**2-F**2                                                       CORA-060
      IF (DABS(Z).LT.1.D-14) Z=0.D0                                     CORA-061
      IF (X.EQ.0.D0.AND.Z.EQ.0.D0) Z=1.D0                               CORA-062
      DEN=2.D0*X**2*(P-Q)+8.D0*Z*S**2                                   CORA-063
      Z=U                                                               CORA-064
      IF (X.EQ.0.D0.AND.Z.EQ.0.D0) Z=-1.D0/(E*F)                        CORA-065
      GO TO ( 4 , 9 , 13 , 20 , 28 , 41 ) , LQ                          CORA-066
    4 GO TO ( 5 , 6 ) , LL                                              CORA-067
C MULTIPOLE LQ=1 L1=L2.                                                 CORA-068
    5 B(1)=1.D0                                                         CORA-069
      RETURN                                                            CORA-070
    6 IF ((E.NE.F).OR.(V.NE.W)) GO TO 7                                 CORA-071
C MULTIPOLE LQ=1 L1=L2-1 WITH E=F AND V=W.                              CORA-072
      B1=DSQRT((A-1.D0)**2+E**2)                                        CORA-073
      B(2)=-(A-.5D0)*Q/(E*B1)                                           CORA-074
      B(3)=(A+.5D0)*Q/(E*B1)                                            CORA-075
      IF (LT) RETURN                                                    CORA-076
      C(1)=(Q+(2.D0*A-1.D0)*E/V)/(2.D0*E*V*B1)                          CORA-077
      C(3)=-DSQRT(Q)/(2.D0*V*A*B1)                                      CORA-078
      C(2)=C(3)*(2.D0*A-1.D0)                                           CORA-079
      C(4)=Q/(2.D0*E*V*B1)                                              CORA-080
      GO TO 70                                                          CORA-081
C MULTIPOLE LQ=1 L1=L2-1.                                               CORA-082
    7 A1=-2.D0*F*(2.D0*(A-1.D0)*Q-A**2*U)                               CORA-083
      A2=F*(4.D0*Q*(A-1.D0)*((6.D0*A+1.D0)*Q-4.D0*A**2+1.D0)+U*((((16.D0CORA-084
     1*A-24.D0)*A+4.D0)*A**2-2.D0)*Q+A**2*(2.D0*A-1.D0-U*(A-1.D0)**2)*(4CORA-085
     2.D0*A+2.D0)))                                                     CORA-086
      A3=-F*(A-1.D0)*((24.D0*A-4.D0)*Q+16.D0*A**2-4.D0+U*(((8.D0*A+8.D0)CORA-087
     1*A+2.D0)*A-2.D0))                                                 CORA-088
      A4=4.D0*(A-1.D0)*F                                                CORA-089
      IF (X.EQ.0.D0) GO TO 8                                            CORA-090
      A1=A1-X*(Q*(A-1.D0)*(2.D0*A+6.D0)+A**2*(4.D0+A*U)+X*((2.D0*A-2.D0)CORA-091
     1*F+A*X))                                                          CORA-092
      A2=A2+X*(Q*((A-1.D0)*(A+5.D0)*(12.D0*A+2.D0)*Q-(((40.D0*A-16.D0)*ACORA-093
     1-34.D0)*A-8.D0)*A-6.D0+(((((8.D0*A+12.D0)*A-38.D0)*A+8.D0)*A+5.D0)CORA-094
     2*A-4.D0)*U+(((16.D0*A+40.D0)*A-44.D0)*A-12.D0)*F*X+(((4.D0*A+20.D0CORA-095
     3)*A-13.D0)*A-8.D0)*X**2)+(2.D0*A+1.D0)*(A**2*(4.D0-8.D0*A+((6.D0*ACORA-096
     4-7.D0)*A+4.D0)*U+A*(A-1.D0)**2*U**2)+X*(((4.D0*A+6.D0)*A-2.D0+(A-1CORA-097
     5.D0)*((4.D0*A-4.D0)*A+2.D0)*U)*F+X*(A*(((2.D0*A-2.D0)*A+1.D0)*U-(4CORA-098
     6.D0*A-6.D0)*A+1.D0)+(4.D0*A-2.D0)*F*X+A*X**2))))                  CORA-099
      A3=A3+X*(A-1.D0)*(((8.D0*A-8.D0)*A+6.D0)*A+2.D0-(2.D0*A+6.D0)*(6.DCORA-100
     10*A-1.D0)*Q-((((4.D0*A+12.D0)*A+5.D0)*A-3.D0)*A-2.D0)*U-2.D0*X*(((CORA-101
     24.D0*A+8.D0)*A-3.D0)*F-X))                                        CORA-102
      A4=A4+X*2.D0*(A**2-1.D0)                                          CORA-103
    8 BD=.5D0*DEN*DSQRT((A-1.D0)**2+E**2)                               CORA-104
      IF (.NOT.LT) C(1)=.5D0-A                                          CORA-105
      GO TO 48                                                          CORA-106
    9 GO TO ( 10 , 11 , 12 ) , LL                                       CORA-107
C MULTIPOLE LQ=2 L1=L2.                                                 CORA-108
   10 A1=2.D0*Z*A**2*Y                                                  CORA-109
      A2=-Z*Y*(2.D0*A+1.D0)*(((A-1.D0)*A-.5D0)*Y**2+2.D0*A**2*(A-1.D0)**CORA-110
     12*(S**2+1.D0))                                                    CORA-111
      A3=2.D0*Z*(2.D0*A+1.D0)*(A-1.D0)**2*Y                             CORA-112
      A4=0.D0                                                           CORA-113
      BD=DEN*(A-1.D0)/DSQRT(S)                                          CORA-114
      IF (.NOT.LT) C(1)=-1.D0                                           CORA-115
      IF (X.EQ.0) GO TO 48                                              CORA-116
      A1=A1+X*(4.D0*F*E*S-2.D0*A*(A+Q+A*S**2+P))                        CORA-117
      A2=A2+X*((A+.5D0)*((((4.D0*A-6.D0)*A+2.D0)*A-1.D0)*(Q+P*S**2)+4.D0CORA-118
     1*(2.D0*A-3.D0)*F*E*S*(Q+P+S**2+1.D0)+(((4.D0*A+2.D0)*A-14.D0)*A+1.CORA-119
     2D0)*(Q*S**2+P)+A**2*((S**4+1.D0)*((2.D0*A-6.D0)*A+5.D0)-S**2*(4.D0CORA-120
     3*(A+1.D0)*A-14.D0)))+P*Q*((8.D0*A-4.D0)*A+8.D0))                  CORA-121
      A3=A3-2.D0*X*(A-1.D0)*((2.D0*A-3.D0)*(F**2+E**2*S**2)+4.D0*(2.D0*ACORA-122
     1+1.D0)*F*E*S+(S**2+1.D0)*(A+1.D0)*((6.D0*A+1.D0)*A-3.D0))         CORA-123
      A4=4.D0*(A-1.D0)*X                                                CORA-124
      GO TO 48                                                          CORA-125
C MULTIPOLE LQ=2 L1=L2-1.                                               CORA-126
   11 B1=X*(A-1.D0)-E*S                                                 CORA-127
      B3=-(A-1.D0)**2                                                   CORA-128
      B2=B3/(A-.5D0)                                                    CORA-129
      BD=-DEN*A*(A-1.D0)*(2.D0*A-3.D0)*DSQRT(S*((A-1.D0)**2+E**2))/(2.D0CORA-130
     1*A-1.D0)                                                          CORA-131
      IF (LT) GO TO 15                                                  CORA-132
      C(1)=B1+2.D0*A*(A-1.D0)**2/W                                      CORA-133
      C(2)=B3                                                           CORA-134
      C(3)=B2                                                           CORA-135
      GO TO 15                                                          CORA-136
C MULTIPOLE LQ=2 L1=L2-2.                                               CORA-137
   12 B1=Q                                                              CORA-138
      B3=-3.D0*E*S-X*(A-1.D0)                                           CORA-139
      B4=(A-1.D0)/(A-.5D0)                                              CORA-140
      BD=-3.D0*DEN*A*DSQRT(S*Q*((A-1.D0)**2+E**2))/(2.D0*A-1.D0)        CORA-141
      IF (LT) GO TO 17                                                  CORA-142
      C(1)=B1                                                           CORA-143
      C(2)=B3-2.D0*A*(A-1.D0)/W                                         CORA-144
      C(4)=B4                                                           CORA-145
      GO TO 17                                                          CORA-146
   13 GO TO ( 14 , 16 , 18 , 19 ) , LL                                  CORA-147
C MULTIPOLE LQ=3 L1=L2.                                                 CORA-148
   14 B1=Y/(A-1.D0)                                                     CORA-149
      B2=1.D0                                                           CORA-150
      B3=1.D0                                                           CORA-151
      BD=DEN*A*(2.D0*A-3.D0)                                            CORA-152
      IF (LT) GO TO 15                                                  CORA-153
      C(1)=B1-2.D0*A/W                                                  CORA-154
      C(2)=B3                                                           CORA-155
      C(3)=B2                                                           CORA-156
   15 A1=-2.D0*A**2*Y*B1*Z                                              CORA-157
      A2=Y*((2.D0*A+1.D0)*((2.D0*(A**2-A)**2*(1.D0+S**2)+Y**2*(A**2-A-.5CORA-158
     1D0))*B1-Y*(P*B2+Q*B3)))*Z                                         CORA-159
      A3=-Y*((2.D0*A-1.D0)*(-Y*(B2+B3))+(4.D0*A+2.D0)*(A-1.D0)**2*B1)*Z CORA-160
      A4=0.D0                                                           CORA-161
      IF (X.EQ.0.D0) GO TO 48                                           CORA-162
      A1=A1+X*2.D0*P*(A*X-2.D0*F)*B2                                    CORA-163
      A2=A2+X*P*(2.D0*Q*((2.D0*A+3.D0)*(A+1.D0)*F+((2.D0*A+3.D0)*A-4.D0)CORA-164
     1*E*S)-2.D0*P*(2.D0*A-3.D0)*(2.D0*A+1.D0)*F+(2.D0*A+1.D0)*((((2.D0*CORA-165
     2A-1.D0)*A-8.D0)*A+5.D0)*F-S*((A+1.D0)*((6.D0*A-9.D0)*A+1.D0)*E-S*(CORA-166
     3(6.D0*A-7.D0)*(A**2-1.D0)*F-S*((((2.D0*A-5.D0)*A+2.D0)*A-1.D0)*E))CORA-167
     4)))*B2                                                            CORA-168
      A3=A3+X*(2.D0*P*((2.D0*A-3.D0)*(A-1.D0)*E*S+F*((2.D0*A-3.D0)*A-4.DCORA-169
     10))-2.D0*Q*E*S*(2.D0*A+3.D0)*(2.D0*A-1.D0)-(2.D0*A-1.D0)*((((2.D0*CORA-170
     2A+5.D0)*A+2.D0)*A+1.D0)*F-S*((6.D0*A+7.D0)*(A**2-1.D0)*E-S*((A-1.DCORA-171
     30)*((6.D0*A+9.D0)*A+1.D0)*F-S*((((2.D0*A+1.D0)*A-8.D0)*A-5.D0)*E))CORA-172
     4)))*B2                                                            CORA-173
      IF (LQ.EQ.3) GO TO 47                                             CORA-174
      A4=A4+X*2.D0*(2.D0*E*S-A*X)*B2                                    CORA-175
      GO TO 46                                                          CORA-176
C MULTIPOLE LQ=3 L1=L2-1.                                               CORA-177
   16 B1=Q/(A-1.D0)                                                     CORA-178
      B3=-X                                                             CORA-179
      B4=1.D0/(A+1.D0)                                                  CORA-180
      BD=-3.D0*DEN*A*DSQRT(Q)                                           CORA-181
      IF (LT) GO TO 17                                                  CORA-182
      C(1)=B1                                                           CORA-183
      C(2)=B3-2.D0*A/W                                                  CORA-184
      C(4)=B4                                                           CORA-185
   17 A1=-2.D0*A**2*Y*B1*Z                                              CORA-186
      A2=Y*((2.D0*A+1.D0)*((2.D0*(A**2-A)**2*(1.D0+S**2)+Y**2*(A**2-A-.5CORA-187
     1D0))*B1-Y*Q*B3)+(4.D0*A-2.D0)*(A+1.D0)**2*P*Q*B4)*Z               CORA-188
      A3=-Y*((2.D0*A-1.D0)*((2.D0*(A**2+A)**2*(1.D0+S**2)+Y**2*(A**2+A-.CORA-189
     15D0))*B4-Y*B3)+(4.D0*A+2.D0)*(A-1.D0)**2*B1)*Z                    CORA-190
      A4=2.D0*A**2*Y*B4*Z                                               CORA-191
      IF (X.EQ.0.D0) GO TO 48                                           CORA-192
      A1=A1-X*4.D0*P*Q*(A+1.D0)*B4                                      CORA-193
      A2=A2+X*2.D0*P*Q*(A+1.D0)*((2.D0*A+3.D0)*(Q+P)+(2.D0*A-1.D0)*(4.D0CORA-194
     1*E*F*S+(1.D0+S**2)*((2.D0*A-4.D0)*A-3.D0)))*B4                    CORA-195
      A3=A3+X*(-4.D0*P*Q*((2.D0*A+1.D0)*A+2.D0)-(2.D0*A-1.D0)*(2.D0*S*E*CORA-196
     1F*(2.D0*A+3.D0)*(Q+P+S**2+1.D0)-A**2*(((A+3.D0)*A+2.5D0)*(1.D0+S**CORA-197
     24)-S**2*((2.D0*A-2.D0)*A-7.D0))+A*(A-1.D0)*(2.D0*A+3.D0)*(1.D0+S**CORA-198
     32)*(P+Q)-(S**2-1.D0)*((2.D0*A+4.D0)*A+.5D0)*(Q-P)))*B4            CORA-199
      A4=A4+X*2.D0*((A-1.D0)*(P+Q)+Y**2)*B4                             CORA-200
      GO TO 46                                                          CORA-201
C MULTIPOLE LQ=3 L1=L2-2.                                               CORA-202
   18 B1=-Q*(2.D0*A-1.D0)*((2.D0*A-3.D0)*(A+1.D0)*X+(A-3.D0)*Y)/(A-1.D0)CORA-203
      B2=6.D0*Q*(A-1.D0)                                                CORA-204
      B3=((A-1.D0)*(6.D0*A-3.D0)*Q+(2.D0*A-1.D0)*((A+1.D0)*X+2.D0*Y)*(2.CORA-205
     1D0*A-3.D0)*X-(A-1.D0)*(6.D0*A-9.D0)*P)                            CORA-206
      B4=-((2.D0*A-1.D0)*X+Y)*(2.D0*A-3.D0)                             CORA-207
      BD=12.D0*A**2*(2.D0*A-3.D0)*DEN*S*DSQRT(Q*((A-1.D0)**2+E**2))     CORA-208
      IF (LT) GO TO 45                                                  CORA-209
      C(1)=B1-6.D0*Q*A*(A-1.D0)*(2.D0*A-1.D0)/W                         CORA-210
      C(2)=B3+A*(4.D0*A-6.D0)*(2.D0*A-1.D0)*((A+1.D0)*X+2.D0*Y+3.D0*A*(ACORA-211
     1-1.D0)/W)/W                                                       CORA-212
      C(3)=B2                                                           CORA-213
      C(4)=B4-6.D0*A*(A-1.D0)*(2.D0*A-3.D0)/W                           CORA-214
      GO TO 45                                                          CORA-215
C MULTIPOLE LQ=3 L1=L2-3.                                               CORA-216
   19 B1=-Q*(3.D0*E*S*Y+A*(3.D0*X*Y+2.D0*(A+1.D0)*(X**2+2.D0*A-1.D0-2.D0CORA-217
     1*(A-1.D0)*S**2)))                                                 CORA-218
      B2=3.D0*Q*(A*X+Y)                                                 CORA-219
      B4=-(3.D0*F*Y+A*(3.D0*X*Y+2.D0*(A-1.D0)*(X**2+2.D0*A+2.D0-(2.D0*A+CORA-220
     11.D0)*S**2)))                                                     CORA-221
      B3=-X*B4*(A+1.D0)+3.D0*Q*(Y+A*X)+A*(3.D0*A+1.5D0)*(1.D0-S**2)*((3.CORA-222
     1D0*A-2.D0)*Y+((A-2.D0)*A+2.D0)*X)                                 CORA-223
      BD=30.D0*A**2*DEN*S*DSQRT(Q*((A-1.D0)**2+E**2)*((A+1.D0)**2+F**2))CORA-224
      IF (LT) GO TO 45                                                  CORA-225
      C(1)=B1-3.D0*Q*(2.D0*A-1.D0)*((6.D0*A+4.D0)*F+(A+1.D0)*(A+4.D0)*X+CORA-226
     14.D0*A*(A**2-1.D0)/W)/W                                           CORA-227
      C(2)=B3+((4.D0*A**2*(A**2-1.D0)*(2.D0*A-1.D0-S**2*(2.D0*A+1.D0))+(CORA-228
     118.D0*A**2-3.D0)*Y**2+A*(12.D0*A**2+3.D0)*X*Y+(A**2-1.D0)*(4.D0*A*CORA-229
     2*2-3.D0)*X**2)+3.D0*A*(4.D0*A**2-1.D0)*(5.D0*A*Y+(A**2+4.D0)*X+4.DCORA-230
     30*A*(A**2-1.D0)/W)/W)/W                                           CORA-231
      C(3)=B2+12.D0*Q*(A**2-1.D0)/W                                     CORA-232
      C(4)=B4-3.D0*(2.D0*A+1.D0)*((6.D0*A-4.D0)*F+A*(A+1.D0)*X+4.D0*A*(ACORA-233
     1**2-1.D0)/W)/W                                                    CORA-234
      GO TO 45                                                          CORA-235
   20 GO TO ( 21 , 22 , 23 , 24 , 26 ) , LL                             CORA-236
C MULTIPOLE LQ=4 L1=L2.                                                 CORA-237
   21 B1=-P*Q*(2.D0*A+3.D0)/(A-1.D0)                                    CORA-238
      B2=-Q*(3.D0*E*S+A*X)                                              CORA-239
      B3=-P*(3.D0*F-A*X)                                                CORA-240
      B4=-((P+Q)*(A+1.5D0)-1.5D0*Y**2)/(A+1.D0)                         CORA-241
      BD=3.D0*DEN*A**2*(2.D0*A+3.D0)*(A+2.D0)*DSQRT(S*P*Q)              CORA-242
      IF (LT) GO TO 45                                                  CORA-243
      C(1)=B1                                                           CORA-244
      C(2)=(B3+P*A*(2.D0*A+3.D0)/W)                                     CORA-245
      C(3)=(B2+Q*A*(2.D0*A+3.D0)/W)                                     CORA-246
      C(4)=(B4-3.D0*A*(Y-A*(2.D0*A+3.D0)/W)/W)                          CORA-247
      GO TO 45                                                          CORA-248
C MULTIPOLE LQ=4 L1=L2-1.                                               CORA-249
   22 B1=Q*(3.D0*E*S-A*X)*(4.D0*A+6.D0)/(A-1.D0)                        CORA-250
      B2=18.D0*Q                                                        CORA-251
      B3=((2.D0*A+3.D0)*(3.D0*Q+(2.D0*A-3.D0)*X**2)-(6.D0*A-9.D0)*P)    CORA-252
      B4=(3.D0*F-A*X)*(4.D0*A-6.D0)/(A+1.D0)                            CORA-253
      BD=12.D0*DEN*A**2*DSQRT(S*Q)*(4.D0*A**2-9.D0)                     CORA-254
      IF (LT) GO TO 45                                                  CORA-255
      C(1)=B1-6.D0*Q*A*(2.D0*A+3.D0)/W                                  CORA-256
      C(2)=B3+2.D0*A*(4.D0*A**2-9.D0)*(X+3.D0*A/W)/W                    CORA-257
      C(3)=B2                                                           CORA-258
      C(4)=B4-6.D0*A*(2.D0*A-3.D0)/W                                    CORA-259
      GO TO 45                                                          CORA-260
C MULTIPOLE LQ=4 L1=L2-2.                                               CORA-261
   23 B1=((2.D0*A-E**2)*S**2+(A+2.D0)*(2.D0*E*F*S-A*(2.D0*A+2.D0+F**2)/(CORA-262
     1A-1.D0))/(A+1.D0))                                                CORA-263
      B2=6.D0*Q*((A+1.D0)*X-3.D0*F)                                     CORA-264
      B3=(-X*(4.D0*A+6.D0)*B1*(A**2-1.D0)+3.D0*(P*((2.D0*A+5.D0)*X-3.D0*CORA-265
     1Y)+(1.D0-S**2)*A*(A+2.D0)*(2.D0*A+3.D0)*(A*X+E*S)))               CORA-266
      B4=((4.D0*A+6.D0)*(B1*(A-1.D0)+3.D0*A*(S**2-1.D0))+3.D0*Y*(3.D0*Y-CORA-267
     1(2.D0*A+5.D0)*X)/(A+1.D0))                                        CORA-268
      B1=Q*(A+1.D0)*(4.D0*A+6.D0)*B1                                    CORA-269
      BD=60.D0*DEN*A**2*(A+2.D0)*(2.D0*A+3.D0)*DSQRT(S*Q*((A+1.D0)**2+F*CORA-270
     1*2))                                                              CORA-271
      IF (LT) GO TO 45                                                  CORA-272
      C(1)=B1-6.D0*Q*(A+2.D0)*(2.D0*A+3.D0)*(E*S+A*(X+4.D0*(A+1.D0)/W))/CORA-273
     1W                                                                 CORA-274
      C(2)=B3+2.D0*(2.D0*A+3.D0)*(6.D0*E*F*S+A*(F*((2.D0*A+13.D0)*X+6.D0CORA-275
     1*F)+(A+1.D0)*(2.D0*A*(2.D0*A+4.D0-(2.D0*A+1.D0)*S**2)+(2.D0*A+1.D0CORA-276
     2)*X**2))+3.D0*A*(A+2.D0)*(2.D0*A+1.D0)*((A+1.D0)*X+5.D0*F+A*(4.D0*CORA-277
     2A+4.D0)/W)/W)/W                                                   CORA-278
      C(3)=B2+12.D0*Q*(A+1.D0)*(2.D0*A+3.D0)/W                          CORA-279
      C(4)=B4-(12.D0*A+6.D0)*((A+6.D0)*F+A*(A+1.D0)*(X+(4.D0*A+6.D0)/W))CORA-280
     1/W                                                                CORA-281
      GO TO 45                                                          CORA-282
C MULTIPOLE LQ=4 L1=L2-3.                                               CORA-283
   24 B1=F*Q*(12.D0*(Q-(2.D0*A-1.D0)*(2.D0*A-5.D0))/((2.D0*A-3.D0)*(A-1.CORA-284
     1D0))+(26.D0*A-10.D0)*U)                                           CORA-285
      B2=Q*(36.D0*(Q+4.D0*A**2-5.D0)/(2.D0*A-3.D0)-30.D0*(A**2-1.D0)*U)/CORA-286
     1(2.D0*A+3.D0)                                                     CORA-287
      B3=B2+U*(A**2*(6.D0*A+3.D0)*((4.D0*A+10.D0)+5.D0*(A**2-1.D0)*U)-18CORA-288
     1.D0*Q*A*(3.D0*A+4.D0))/(2.D0*A+3.D0)                              CORA-289
      B4=F*(12.D0*(Q-(2.D0*A+5.D0)*(2.D0*A+1.D0))+U*(4.D0*A+2.D0)*((13.DCORA-290
     10*A+22.D0)*A-15.D0))/((A+1.D0)*(2.D0*A+3.D0))                     CORA-291
      IF (X.EQ.0.D0) GO TO 25                                           CORA-292
      B1=B1-2.D0*Q*X*((6.D0*Q*(A-2.D0)+(((28.D0*A-30.D0)*A-46.D0)*A+30.DCORA-293
     10))/((2.D0*A-3.D0)*(A-1.D0))-(A+1.D0)*((9.D0*A-5.D0)*U-2.D0*X**2))CORA-294
      B2=B2-12.D0*Q*X*(F-X*(A+1.D0))/(2.D0*A+3.D0)                      CORA-295
      B3=B3+X*(24.D0*Q*(A*X-F)+(2.D0*A+1.D0)*(12.D0*(2.D0*A+5.D0)*F-((44CORA-296
     1.D0*A+80.D0)*A-30.D0)*F*U+X*A*(28.D0*A+52.D0-U*(24.D0*A+2.D0)*(A+1CORA-297
     2.D0))+12.D0*F*X**2+4.D0*A*X**3*(A+1.D0)))/(2.D0*A+3.D0)           CORA-298
      B4=B4-X*(12.D0*(A-1.D0)*Q+(4.D0*A+2.D0)*(6.D0*F*X+A*(14.D0*A+26.D0CORA-299
     1-(A+1.D0)*((9.D0*A+1.D0)*U-2.D0*X**2))))/((2.D0*A+3.D0)*(A+1.D0)) CORA-300
   25 BD=360.D0*DEN*A**2*S*DSQRT(S*Q*((A+1.D0)**2+F**2)*((A-1.D0)**2+E**CORA-301
     12))                                                               CORA-302
      IF (LT) GO TO 45                                                  CORA-303
      C(1)=B1+Q*(12.D0*(A*(2.D0*A-1.D0)*(2.D0*A-5.D0)-Q*(9.D0*A-12.D0))/CORA-304
     1(2.D0*A-3.D0)+30.D0*A*U*(A**2-1.D0)-24.D0*(2.D0*A-1.D0)*(F*(7.D0*ACORA-305
     2+5.D0)+5.D0*A*(A**2-1.D0)/W)/W)/W                                 CORA-306
      C(2)=B3+(F*(48.D0*Q-8.D0*A*U*(2.D0*A+1.D0)*(7.D0*A-5.D0))+6.D0*(10CORA-307
     1.D0*Q*(11.D0*A**2-2.D0)-A**2*(2.D0*A+1.D0)*(30.D0*(2.D0*A-1.D0)+5.CORA-308
     2D0*U*(A**2-1.D0)-(8.D0*A-4.D0)*(12.D0*F+5.D0*(A**2-1.D0)/W)/W))/W)CORA-309
     3/W                                                                CORA-310
      C(3)=B2+24.D0*Q*(2.D0*F+5.D0*(A**2-1.D0)/W)/W                     CORA-311
      C(4)=B4+((12.D0*A*(2.D0*A+1.D0)*(2.D0*A+5.D0)-36.D0*Q*(3.D0*A+4.D0CORA-312
     1)+30.D0*A*U*(2.D0*A+1.D0)*(A**2-1.D0))/(2.D0*A+3.D0)-24.D0*(2.D0*ACORA-313
     2+1.D0)*(F*(7.D0*A-5.D0)+5.D0*A*(A**2-1.D0)/W)/W)/W                CORA-314
      IF (X.EQ.0.D0) GO TO 45                                           CORA-315
      C(1)=C(1)-12.D0*X*Q*((A+2.D0)*(3.D0*F+(A+1.D0)*X)+(4.D0*A-2.D0)*(ACORA-316
     1+1.D0)*(A+5.D0)/W)/W                                              CORA-317
      C(2)=C(2)+X*((12.D0*Q*(5.D0*A+6.D0)+(2.D0*A+1.D0)*(12.D0*F*X*(A+2.CORA-318
     1D0)-2.D0*A*(4.D0*A+10.D0+(A+1.D0)*(U*(9.D0*A-5.D0)-2.D0*X**2))))+1CORA-319
     22.D0*(2.D0*A+1.D0)*(F*((7.D0*A+24.D0)*A-10.D0)+A*(A+1.D0)*((A+2.D0CORA-320
     3)*X+(4.D0*A-2.D0)*(A+5.D0)/W))/W)/W                               CORA-321
      C(3)=C(3)+24.D0*X*Q*(A+1.D0)/W                                    CORA-322
      C(4)=C(4)-12.D0*X*(2.D0*A+1.D0)*((3.D0*F*(A+2.D0)+A*X*(A+1.D0))/(2CORA-323
     1.D0*A+3.D0)+2.D0*A*(A+1.D0)/W)/W                                  CORA-324
      GO TO 45                                                          CORA-325
C MULTIPOLE LQ=4 L1=L2-4.                                               CORA-326
   26 B1=6.D0*Q*(Q*((42.D0*A+3.D0)*U-36.D0)+A*(24.D0*A-12.D0-U*((34.D0*ACORA-327
     1+3.D0)*A+8.D0)-(8.D0*A+12.D0)*(A**2-1.D0)*U**2))                  CORA-328
      B2=18.D0*Q*(12.D0-U*(9.D0*A+1.D0))*F                              CORA-329
      B3=9.D0*F*(Q*(24.D0-U*(38.D0*A+2.D0))+U*A*(2.D0*A+1.D0)*(A+1.D0)*(CORA-330
     14.D0+(17.D0*A-12.D0)*U))                                          CORA-331
      B4=6.D0*(Q*((42.D0*A+3.D0)*U-36.D0)+A*(2.D0*A+1.D0)*(12.D0-(17.D0*CORA-332
     1A-2.D0)*U-U**2*(4.D0*A+6.D0)*(A-1.D0)))                           CORA-333
      IF (X.EQ.0.D0) GO TO 27                                           CORA-334
      B1=B1-Q*X*(X*(24.D0*Q+(56.D0*A+188.D0)*A+108.D0)+108.D0*(2.D0*A+3.CORA-335
     1D0)*F-2.D0*(2.D0*A+3.D0)*(58.D0*A+7.D0)*F*U-2.D0*(A+1.D0)*(2.D0*A+CORA-336
     23.D0)*(15.D0*A+4.D0)*U*X+12.D0*(2.D0*A+3.D0)*F*X**2+4.D0*(A+1.D0)*CORA-337
     3(2.D0*A+3.D0)*X**3)                                               CORA-338
      B2=B2+Q*X*(24.D0*F*X+(A+1.D0)*(108.D0-(66.D0*A+24.D0)*U+12.D0*X**2CORA-339
     1))                                                                CORA-340
      B3=B3+X*(24.D0*F*Q*X+(A+1.D0)*(Q*(324.D0+36.D0*X**2-(498.D0*A+42.DCORA-341
     10)*U)+(2.D0*A+1.D0)*(F*X*(108.D0-(152.D0*A+24.D0)*U+12.D0*X**2)-A*CORA-342
     2(72.D0-(168.D0*A-12.D0)*U-((57.D0*A+24.D0)*A-36.D0)*U**2-X**2*(28.CORA-343
     3D0-(36.D0*A+20.D0)*U+4.D0*X**2)))))                               CORA-344
      B4=B4+X*(X*(A*(2.D0*A+1.D0)*(30.D0*A+20.D0)*U-24.D0*Q)-(8.D0*A+4.DCORA-345
     10)*(F*(27.D0-(29.D0*A+6.D0)*U)+X*(7.D0*A+3.D0*F*X+A*X**2)))       CORA-346
   27 BD=2520.D0*DEN*A**2*S*DSQRT(S*Q*((A+1.D0)**2+F**2)*((A-1.D0)**2+E*CORA-347
     1*2)*((A+2.D0)**2+F**2))                                           CORA-348
      IF (LT) GO TO 45                                                  CORA-349
      C(1)=B1+18.D0*Q*(F*((A-1.D0)*(8.D0*A-4.D0)-20.D0*Q+(2.D0*A+3.D0)*(CORA-350
     1(17.D0*A-3.D0)*A-4.D0)*U)-4.D0*(15.D0*Q*((4.D0*A+4.D0)*A-1.D0)-A*(CORA-351
     22.D0*A-1.D0)*((34.D0*A+55.D0)*A+16.D0)-(2.D0*A+3.D0)*(2.D0*A*U*(A+CORA-352
     31.D0)*(A-1.D0)*(A+2.D0)-5.D0*(2.D0*A-1.D0)*(F*((5.D0*A+5.D0)*A+4.DCORA-353
     40)+2.D0*A*(A**2-1.D0)*(A+2.D0)/W)/W))/W)/W                        CORA-354
      C(2)=B3+(360.D0*Q**2-72.D0*Q*(4.D0*A**2+1.D0)-24.D0*(A+1.D0)*U*(Q*CORA-355
     1((66.D0*A-12.D0)*A-9.D0)-A**2*(2.D0*A+1.D0)*(34.D0*A-19.D0+U*(A-1.CORA-356
     2D0)*(2.D0*A+3.D0)))+18.D0*(20.D0*Q*F*((20.D0*A+14.D0)*A-3.D0)-(A+1CORA-357
     3.D0)*(A*F*((4.D0*A**2-1.D0)*140.D0+U*(10.D0*A+15.D0)*(2.D0*A+1.D0)CORA-358
     4*(5.D0*A-4.D0))-4.D0*(10.D0*Q*(((30.D0*A+19.D0)*A-1.D0)*A-6.D0)-A*CORA-359
     5*2*(2.D0*A+1.D0)*((2.D0*A-1.D0)*(84.D0*A+56.D0)+(2.D0*A+3.D0)*((2.CORA-360
     6D0*A-2.D0)*(A+2.D0)*U-(10.D0*A-5.D0)*(7.D0*F+2.D0*(A-1.D0)*(A+2.D0CORA-361
     7)/W)/W)))/W))/W)/W                                                CORA-362
      C(3)=B2+72.D0*Q*(5.D0*Q-4.D0*A**2-1.D0-(2.D0*A+3.D0)*((A**2-1.D0)*CORA-363
     1U-5.D0*(F*(3.D0*A-1.D0)+2.D0*(A**2-1.D0)*(A+2.D0)/W)/W))/W        CORA-364
      C(4)=B4-18.D0*(20.D0*Q*F-(A+1.D0)*((2.D0*A+1.D0)*F*(4.D0+U*(17.D0*CORA-365
     1A-12.D0))-4.D0*(15.D0*Q*(4.D0*A-1.D0)-(2.D0*A+1.D0)*(A*(34.D0*A-19CORA-366
     2.D0)+(2.D0*A+3.D0)*(A*(A-1.D0)*U-5.D0*(F*(5.D0*A-4.D0)+2.D0*A*(A-1CORA-367
     3.D0)*(A+2.D0)/W)/W)))/W))/W                                       CORA-368
      IF (X.EQ.0.D0) GO TO 45                                           CORA-369
      C(1)=C(1)-6.D0*Q*X*((A+2.D0)*(60.D0*Q-(44.D0*A-10.D0)*A-6.D0-(2.D0CORA-370
     1*A+3.D0)*((A+1.D0)*((11.D0*A-6.D0)*U-2.D0*X**2)-12.D0*F*X))+(8.D0*CORA-371
     2A+12.D0)*(((20.D0*A+90.D0)*A-5.D0)*F+(A+1.D0)*(A+2.D0)*((2.D0*A+5.CORA-372
     3D0)*X+(10.D0*A-5.D0)*(A+6.D0)/W))/W)/W                            CORA-373
      C(2)=C(2)+X*((2.D0*A+3.D0)*(240.D0*F*Q+(A+1.D0)*(144.D0*Q*X-(2.D0*CORA-374
     1A+1.D0)*((24.D0-24.D0*X**2+(182.D0*A-72.D0)*U)*F+A*X*(44.D0+(30.D0CORA-375
     2*A+8.D0)*U-4.D0*X**2))))+(A+1.D0)*(Q*((2400.D0*A+8400.D0)*A-360.D0CORA-376
     3)-(24.D0*A+12.D0)*(A*((102.D0*A+357.D0)*A-114.D0)-(2.D0*A+3.D0)*((CORA-377
     4A+2.D0)*(10.D0*F*X+A*(X**2-(5.5D0*A-3.D0)*U))+(F*((60.D0*A+270.D0)CORA-378
     5*A-120.D0)+A*(A+2.D0)*(X*(4.D0*A+10.D0)+(20.D0*A-10.D0)*(A+6.D0)/WCORA-379
     6))/W)))/W)/W                                                      CORA-380
      C(3)=C(3)+24.D0*X*Q*(2.D0*A+3.D0)*(5.D0*F+(A+1.D0)*(X+5.D0*(A+2.D0CORA-381
     1)/W))/W                                                           CORA-382
      C(4)=C(4)-6.D0*X*(A+1.D0)*(60.D0*Q-(2.D0*A+1.D0)*(22.D0*A+(11.D0*ACORA-383
     1+4.D0)*A*U-12.D0*F*X-2.D0*A*X**2-(8.D0*A+12.D0)*(10.D0*F+A*(X+5.D0CORA-384
     2*(A+2.D0)/W))/W))/W                                               CORA-385
      GO TO 45                                                          CORA-386
   28 GO TO ( 29 , 31 , 33 , 35 , 37 , 39 ) , LL                        CORA-387
C MULTIPOLE LQ=5 L1=L2.                                                 CORA-388
   29 BD=12.D0*DEN*A**2*(A+2.D0)*(2.D0*A+5.D0)*(4.D0*A**2-9.D0)*S*DSQRT(CORA-389
     1P*Q)                                                              CORA-390
      B1=28.D0*P*Q*F*(2.D0*A+3.D0)/(A-1.D0)                             CORA-391
      B2=Q*(84.D0*Q-A*(48.D0*A-72.D0-U*(A+2.D0)*(6.D0*A+27.D0)))        CORA-392
      B3=P*(84.D0*Q-A*(6.D0*A-9.D0)*(8.D0+(A+2.D0)*U))                  CORA-393
      B4=(4.D0*A-6.D0)*(14.D0*Q+A*(24.D0+(7.D0*A+12.D0)*U))*F/(A+1.D0)  CORA-394
      IF (X.EQ.0.D0) GO TO 30                                           CORA-395
      B1=B1+(28.D0*A+42.D0)*X*P*Q/(A-1.D0)                              CORA-396
      B2=B2+Q*X*((28.D0*A+126.D0)*F+((4.D0*A+22.D0)*A+42.D0)*X)         CORA-397
      B3=B3-P*X*(2.D0*A-3.D0)*(14.D0*F-2.D0*A*X)                        CORA-398
      B4=B4+X*(4.D0*A-6.D0)*(21.D0*Q-A*(14.D0*A-12.D0+(A**2-3.D0)*U)-X*(CORA-399
     1(2.D0*A-7.D0)*F+A*X))/(A+1.D0)                                    CORA-400
   30 IF (LT) GO TO 45                                                  CORA-401
      C(1)=B1-P*Q*(A+2.D0)*(24.D0*A+36.D0)/W                            CORA-402
      C(2)=B3-P*(4.D0*A**2-9.D0)*(8.D0*F-A*(6.D0*A+12.D0)/W)/W          CORA-403
      C(3)=B2-Q*(4.D0*A**2-9.D0)*(8.D0*F-A*(6.D0*A+12.D0)/W)/W          CORA-404
      C(4)=B4-(12.D0*A-18.D0)*((2.D0*A-4.D0)*Q+A*(A*(8.D0+(A+2.D0)*U)+(8CORA-405
     1.D0*A+12.D0)*(F-(A+2.D0)*A/W)/W))/W                               CORA-406
      IF (X.EQ.0.D0) GO TO 45                                           CORA-407
      C(3)=C(3)-X*Q*(8.D0*A**2-18.D0)*(A+4.D0)/W                        CORA-408
      C(2)=C(2)+X*P*A*(8.D0*A**2-18.D0)/W                               CORA-409
      C(4)=C(4)-X*(12.D0*A-18.D0)*((2.D0*A-4.D0)*F+A*(X+(4.D0*A+6.D0)/W)CORA-410
     1)/W                                                               CORA-411
      GO TO 45                                                          CORA-412
C MULTIPOLE LQ=5 L1=L2-1.                                               CORA-413
   31 BD=-60.D0*A**2*(2.D0*A+5.D0)*(2.D0*A+3.D0)*(A+3.D0)*(A+2.D0)*DEN*SCORA-414
     1*DSQRT(P*Q*((A+1.D0)**2+F**2))                                    CORA-415
      B1=P*Q*(4.D0*A+6.D0)*((28.D0*Q-(12.D0*A-56.D0)*A+40.D0)/(A-1.D0)-(CORA-416
     12.D0*A+5.D0)*(A+1.D0)*U)                                          CORA-417
      B2=Q*F*(168.D0*Q+480.D0*A+240.D0+((48.D0*A+120.D0)*A+30.D0)*U)    CORA-418
      B3=P*F*(168.D0*Q+480.D0*A+240.D0-(12.D0*A+6.D0)*((2.D0*A+2.D0)*A-5CORA-419
     1.D0)*U)                                                           CORA-420
      B4=((2.D0*A-3.D0)*(56.D0*Q-(24.D0*A-208.D0)*A+80.D0-(((4.D0*A-18.DCORA-421
     10)*A-52.D0)*A-10.D0)*U)*Q+A**2*(2.D0*A+1.D0)*(480.D0-((24.D0*A-56.CORA-422
     2D0)*A-180.D0)*U-(2.D0*A+5.D0)*(2.D0*A+3.D0)*(A+1.D0)*U**2))/(A+1.DCORA-423
     30)                                                                CORA-424
      IF (X.EQ.0.D0) GO TO 32                                           CORA-425
      B1=B1-X*P*Q*(4.D0*A+6.D0)*(7.D0*F-X*(A+1.D0))                     CORA-426
      B2=B2+X*Q*((14.D0*A+210.D0)*Q-(56.D0*A-380.D0)*A+240.D0-(6.D0*A+6.CORA-427
     1D0)*(A**2-5.D0)*U-(12.D0*A-36.D0)*F*X-(6.D0*A+6.D0)*X**2)         CORA-428
      B3=B3-X*P*((98.D0*A-42.D0)*Q-(2.D0*A+1.D0)*(A*(24.D0*A-116.D0+(A+1CORA-429
     1.D0)*((7.D0*A+16.D0)*U-2.D0*X**2))+(14.D0*A-6.D0)*F*X))           CORA-430
      B4=B4-X*((2.D0*A-3.D0)*(((2.D0*A+1.D0)*(24.D0*A-80)+(14.D0*A-70.D0CORA-431
     1)*Q)*F-((2.D0*A-22.D0)*A+12.D0)*Q*X)+(4.D0*A+2.D0)*((((11.D0*A+17.CORA-432
     2D0)*A+1.D0)*A+15.D0)*F*U-X*((A-1.D0)*(2.D0*A-3.D0)*F*X+A*((14.D0*ACORA-433
     3-18.D0)*A+58.D0+(A+1.D0)*((A+2.D0)*(A-4.D0)*U+X**2)))))/(A+1.D0)  CORA-434
   32 IF (LT) GO TO 45                                                  CORA-435
      C(1)=B1-12.D0*P*Q*(2.D0*A+3.D0)*(A+2.D0)*(2.D0*F-(2.D0*A+5.D0)*(A+CORA-436
     11.D0)/W)/W                                                        CORA-437
      C(2)=B3-P*(4.D0*A+6.D0)*((16.D0*A-24.D0)*Q+(2.D0*A+1.D0)*(40.D0*A-CORA-438
     1A*(2.D0*A+5.D0)*(A+1.D0)*(U-(6.D0*A+12.D0)/W**2)+(30.D0*A+60.D0)*FCORA-439
     2/W))/W                                                            CORA-440
      C(3)=B2-Q*(4.D0*A+6.D0)*((16.D0*A-24.D0)*Q+(2.D0*A+1.D0)*(40.D0*A+CORA-441
     1(30.D0*A+60.D0)*F/W)+A*(A+1.D0)*(6.D0*A+15.D0)*(U-(10.D0*A+20.D0)/CORA-442
     2W**2))/W                                                          CORA-443
      C(4)=B4-6.D0*(F*(((8.D0*A-28.D0)*A+24.D0)*Q+A*(4.D0*A+2.D0)*(((2.DCORA-444
     10*A+2.D0)*A-5.D0)*U-40.D0))-(2.D0*A+3.D0)*((((4.D0*A+6.D0)*A+62.D0CORA-445
     2)*A+20.D0)*Q+A*(2.D0*A+1.D0)*((2.D0*A+5.D0)*(A+1.D0)*U*A-40.D0*A-(CORA-446
     310.D0*A+20.D0)*(4.D0*F+A*(A+1.D0)*(2.D0*A+5.D0)/W)/W))/W)/W       CORA-447
      IF (X.EQ.0.D0) GO TO 45                                           CORA-448
      C(1)=C(1)+X*P*Q*(12.D0*A+18.D0)*(A+1.D0)*(A+2.D0)/W               CORA-449
      C(2)=C(2)+X*P*(4.D0*A+6.D0)*(((8.D0*A-8.D0)*A-6.D0)*F-A*(A+1.D0)*(CORA-450
     12.D0*A+1.D0)*(X+(3.D0*A+6.D0)/W))/W                               CORA-451
      C(3)=C(3)-X*Q*(24.D0*A+36.D0)*((2.D0*A-3.D0)*F+(A+1.D0)*(X+(5.D0*ACORA-452
     1+10.D0)/W))/W                                                     CORA-453
      C(4)=C(4)+6.D0*X*((A-2.D0)*(A-3.D0)*(2.D0*A-3.D0)*Q+(2.D0*A+1.D0)*CORA-454
     1(((8.D0*A-12.D0)*A+40.D0)*A+((2.D0*A-2.D0)*A+6.D0)*F*X+A*(A+1.D0)*CORA-455
     2((A**2-5.D0)*U+X**2)+(4.D0*A+6.D0)*(((2.D0*A+2.D0)*A+10.D0)*F+A*(ACORA-456
     3+1.D0)*(X+(5.D0*A+10.D0)/W))/W))/W                                CORA-457
      GO TO 45                                                          CORA-458
C MULTIPOLE LQ=5 L1=L2-2.                                               CORA-459
   33 DN=720.D0*A**2*(4.D0*A**2-9.D0)*(2.D0*A+5.D0)*(A+2.D0)            CORA-460
      BD=DEN*DN*S*DSQRT(Q*((A+1.D0)**2+F**2))/2.D0                      CORA-461
      B1=2.D0*(2.D0*A+3.D0)*(24.D0*((2.D0*A+5.D0)*(A+2.D0)+7.D0*Q)/(A-1.CORA-462
     1D0)-(2.D0*A-3.D0)*(11.D0*A-10.D0)*U)*F                            CORA-463
      B2=-6.D0*(24.D0*(2.D0*A**2.D0-15.D0*A-10.D0)-168.D0*Q+5.D0*(A+1.D0CORA-464
     1)*(2.D0*A**2+A-6.D0)*U)                                           CORA-465
      B3=((1008.D0*Q-144.D0*(2.D0*A**2-15.D0*A-10.D0))*Q-(2.D0*A-3.D0)*UCORA-466
     1*(6.D0*(17.D0*A**2-9.D0*A+10.D0)*Q+A**2*(2.D0*A+1.D0)*(24.D0*(A+10CORA-467
     2.D0)-15.D0*(A+1.D0)*(A+2.D0)*U)))                                 CORA-468
      B4=2.D0*(2.D0*A-3.D0)*(168.D0*Q+(2.D0*A+1.D0)*(24.D0*(A+10.D0)-(11CORA-469
     1.D0*A**2-A-30.D0)*U))*F/(A+1.D0)                                  CORA-470
      IF (X.EQ.0.D0) GO TO 34                                           CORA-471
      B1=B1+X*2.D0*(2.D0*A+3.D0)*((20.D0*A**3-198.D0*A**2+316.D0*A+240.DCORA-472
     10-42.D0*(2.D0*A-5.D0)*Q)/(A-1.D0)+(2.D0*A-3.D0)*(12.D0*F*X+(A+1.D0CORA-473
     2)*((9.D0*A+10.D0)*U-2.D0*X**2)))                                  CORA-474
      B2=B2-X*12.D0*(7.D0*(2.D0*A-3.D0)*F-(A+1.D0)*(2.D0*A-3.D0)*X)     CORA-475
      B3=B3-X*(2.D0*A-3.D0)*((420.D0*F-36.D0*(5.D0*A-2.D0)*X)*Q+(2.D0*A+CORA-476
     11.D0)*(48.D0*(A+10.D0)*F-(40.D0*A**2-38.D0*A-60.D0)*F*U+4.D0*(5.D0CORA-477
     2*A-58.D0)*A*X+12.D0*(2.D0*A-1.D0)*F*X**2+A*(A+1.D0)*X*(8.D0*(3.D0*CORA-478
     3A+4.D0)*U-4.D0*X**2)))                                            CORA-479
      B4=B4-X*2.D0*(2.D0*A-3.D0)*(42.D0*(2.D0*A-1.D0)*Q-(2.D0*A+1.D0)*(6CORA-480
     1.D0*(2.D0*A-1.D0)*F*X+A*((10.D0*A-116.D0)+(A+1.D0)*((9.D0*A+16.D0)CORA-481
     2*U-2.D0*X**2))))/(A+1.D0)                                         CORA-482
   34 IF (LT) GO TO 45                                                  CORA-483
      B1=B1*Q                                                           CORA-484
      B2=B2*Q                                                           CORA-485
      C(1)=B1-6.D0*Q*(A+2.D0)*(2.D0*A+3.D0)*(8.D0*A*(2.D0*A+5.D0)+24.D0*CORA-486
     1Q-5.D0*A*(A+1.D0)*(2.D0*A-3.D0)*U+4.D0*(2.D0*A-3.D0)*(2.D0*A+5.D0)CORA-487
     2*(F+5.D0*A*(A+1.D0)/W)/W)/W                                       CORA-488
      C(2)=B3-(4.D0*A**2-9.D0)*(8.D0*(12.D0*Q+A*(A+10.D0)*(2.D0*A+1.D0)*CORA-489
     1U)*F-(6.D0*A+12.D0)*((A+1.D0)*(20.D0*Q-A**2*(10.D0*A+5.D0)*U)+(8.DCORA-490
     20*A+4.D0)*A*(2.D0*A+5.D0)*(6.D0*F+5.D0*A*(A+1.D0)/W)/W)/W)/W      CORA-491
      C(3)=B2-Q*24.D0*(4.D0*A**2-9.D0)*(4.D0*F-5.D0*(A+1.D0)*(A+2.D0)/W)CORA-492
     1/W                                                                CORA-493
      C(4)=B4-6.D0*(2.D0*A-3.D0)*(24.D0*(A-2.D0)*Q+A*(2.D0*A+1.D0)*(8.D0CORA-494
     1*(A+10.D0)-5.D0*(A+1.D0)*(A+2.D0)*U)+4.D0*(2.D0*A+3.D0)*(2.D0*A+1.CORA-495
     2D0)*((A+10.D0)*F+5.D0*A*(A+1.D0)*(A+2.D0)/W)/W)/W                 CORA-496
      IF (X.EQ.0.D0) GO TO 45                                           CORA-497
      C(1)=C(1)+X*Q*(12.D0*A+24.D0)*(4.D0*A**2-9.D0)*(3.D0*F-(A+1.D0)*(XCORA-498
     1+(4.D0*A+10.D0)/W))/W                                             CORA-499
      C(2)=C(2)+X*(8.D0*A**2-18.D0)*(36.D0*(A-1.D0)*Q-(2.D0*A+1.D0)*(6.DCORA-500
     10*(A-2.D0)*F*X-A*(8.D0*(A+10.D0)-(A+1.D0)*((9.D0*A+10.D0)*U-2.D0*XCORA-501
     2**2))-6.D0*(A+2.D0)*((A+10.D0)*F+A*(A+1.D0)*(X+(4.D0*A+10.D0)/W))/CORA-502
     3W))/W                                                             CORA-503
      C(3)=C(3)+X*Q*24.D0*(4.D0*A**2-9.D0)*(A+1.D0)/W                   CORA-504
      C(4)=C(4)+X*12.D0*(2.D0*A+1.D0)*(2.D0*A-3.D0)*(3.D0*(A-2.D0)*F-A*(CORA-505
     1A+1.D0)*(X+(4.D0*A+6.D0)/W))/W                                    CORA-506
      GO TO 45                                                          CORA-507
C MULTIPOLE LQ=5 L1=L2-3.                                               CORA-508
   35 BD=-2520.D0*DEN*A**2*(A+2.D0)*(A+3.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)CORA-509
     1*S*DSQRT(Q*((A+1.D0)**2+F**2)*((A+2.D0)**2+F**2))                 CORA-510
      B1=Q*(4.D0*A+6.D0)*(((24.D0*((A+36.D0)*A+40.D0)+168.D0*Q)*Q+48.D0*CORA-511
     1A*(A+2.D0)*(A+3.D0)*(2.D0*A+5.D0))/(A-1.D0)-(A*(((80.D0*A+620.D0)*CORA-512
     2A+966.D0)*A+540.D0)+((28.D0*A-26.D0)*A+60.D0)*Q-6.D0*A*(A+1.D0)*(ACORA-513
     3+2.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*U)*U)                          CORA-514
      B2=6.D0*F*Q*(48.D0*((2.D0*A+21.D0)*A+20.D0)+168.D0*Q-(((16.D0*A+36CORA-515
     1.D0)*A-22.D0)*A-60.D0)*U)                                         CORA-516
      B3=6.D0*F*((48.D0*((2.D0*A+21.D0)*A+20.D0)+168.D0*Q-(10.D0*A-12.D0CORA-517
     1)*(4.D0*A**2+5.D0)*U)*Q+A*(A+1.D0)*(2.D0*A+1.D0)*(((16.D0*A+168.D0CORA-518
     2)*A+720.D0)-(2.D0*A+3.D0)*(A+2.D0)*(8.D0*A+45.D0)*U)*U)           CORA-519
      B4=((2.D0*A-3.D0)*(48.D0*((A+48.D0)*A+40.D0)+336.D0*Q)*Q/(A+1.D0)-CORA-520
     1(4.D0*A**2-9.D0)*(28.D0*A-40.D0)*Q*U+A*(2.D0*A+1.D0)*(96.D0*((2.D0CORA-521
     2*A+21.D0)*A+90.D0)-(4.D0*A+6.D0)*(((40.D0*A+282.D0)*A+180.D0)-(A+2CORA-522
     3.D0)*(2.D0*A+3.D0)*(6.D0*A+15.D0)*U)*U))                          CORA-523
      IF (X.EQ.0.D0) GO TO 36                                           CORA-524
      B1=B1+X*Q*(4.D0*A+6.D0)*((((28.D0*A+402.D0)*A+704.D0)*A+360.D0)*X-CORA-525
     1((88.D0*A+700.D0)*A+600.D0)*F-126.D0*F*Q+(54.D0*A+24.D0)*Q*X+(2.D0CORA-526
     2*A+3.D0)*(((5.D0*A-53.D0)*A-70.D0)*F*U-(8.D0*A+2.D0)*F*X**2-(A+1.DCORA-527
     30)*(A+2.D0)*((15.D0*A+25.D0)*U-2.D0*X**2)*X))                     CORA-528
      B2=B2-X*6.D0*Q*((((8.D0*A+372.D0)*A+696.D0)*A+360.D0)+(70.D0*A+42.CORA-529
     1D0)*Q-(2.D0*A+3.D0)*((10.D0*A+6.D0)*F*X+(A+1.D0)*(A+2.D0)*((11.D0*CORA-530
     2A+25.D0)*U-2.D0*X**2)))                                           CORA-531
      B3=B3+X*((48.D0*((13.D0*A-7.D0)*A-3.D0)*F*X-(((144.D0*A+6696.D0)*ACORA-532
     1+1104.D0)*A-3600.D0)-84.D0*(13.D0*A-9.D0)*Q)*Q+(A+1.D0)*(((((352.DCORA-533
     20*A+224.D0)*A+1518.D0)*A+1260.D0)*U-12.D0*((20.D0*A-14.D0)*A-3.D0)CORA-534
     3*X**2)*Q+(2.D0*A+1.D0)*((2.D0*A-3.D0)*((88.D0*A+720.D0)+(16.D0*A+2CORA-535
     44.D0)*X**2)*F*X+A*((((280.D0*A+2292.D0)*A+2772.D0)*A+1080.D0)*U-(1CORA-536
     592.D0*A+2016.D0)*A-8640.D0-28.D0*((2.D0*A+31.D0)*A+24.D0)*X**2)-(2CORA-537
     6.D0*A+3.D0)*(((16.D0*A-230.D0)*A-300.D0)*F*U*X+A*(A+2.D0)*(((57.D0CORA-538
     7*A+171.D0)*A+90.D0)*U**2-(36.D0*A+62.D0)*U*X**2+4.D0*X**4)))))    CORA-539
      B4=B4-X*((4.D0*A-6.D0)*(126.D0*A+42.D0)*F*Q/(A+1.D0)-36.D0*(2.D0*ACORA-540
     1-3.D0)*(3.D0*A+1.D0)*Q*X-(4.D0*A+2.D0)*(A*((28.D0*A+434.D0)*A+336.CORA-541
     2D0)*X-(2.D0*A-3.D0)*(44.D0*A+360.D0)*F+(2.D0*A+3.D0)*(((5.D0*A-79.CORA-542
     3D0)*A-150.D0)*F*U-(8.D0*A-12.D0)*F*X**2-A*(A+2.D0)*((15.D0*A+31.D0CORA-543
     4)*U-2.D0*X**2)*X)))                                               CORA-544
   36 IF (LT) GO TO 45                                                  CORA-545
      C(1)=B1-12.D0*Q*(2.D0*A+3.D0)*(A+2.D0)*((12.D0*Q+(2.D0*A+3.D0)*((8CORA-546
     1.D0*A+41.D0)*A+15.D0)*U)*F-(4.D0*A+10.D0)*((A+3.D0)*4.D0*F+((33.D0CORA-547
     2+13.D0*A)*Q-A*(A+3.D0)*(4.D0*A-6.D0)-(2.D0*A+3.D0)*(3.D0*A*(A+1.D0CORA-548
     3)*(A+2.D0)*U-10.D0*(A+3.D0)*((4.D0*A+1.D0)*F+3.D0*A*(A+1.D0)*(A+2.CORA-549
     4D0)/W)/W))/W))/W                                                  CORA-550
      C(3)=B2-12.D0*Q*(2.D0*A+3.D0)*((((32.D0*A+288.D0)*A+456.D0)*A+240.CORA-551
     1D0)+8.D0*(2.D0*A-3.D0)*Q-(A+2.D0)*(2.D0*A+3.D0)*(3.D0*(A+1.D0)*(2.CORA-552
     2D0*A+5.D0)*U-10.D0*((2.D0*A+11.D0)*F+3.D0*(2.D0*A+5.D0)*(A+1.D0)*(CORA-553
     3A+2.D0)/W)/W))/W                                                  CORA-554
      C(2)=B3-(4.D0*A+6.D0)*((((192.D0*A+1728.D0)*A+2736.D0)*A+1440.D0+4CORA-555
     18.D0*(2.D0*A-3.D0)*Q)*Q-(A+1.D0)*((((176.D0*A+964.D0)*A+2166.D0)*ACORA-556
     2+540.D0)*Q-A**2*(2.D0*A+1.D0)*(((16.D0*A+168.D0)*A+720.D0)+6.D0*(ACORA-557
     3+2.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*U))*U-6.D0*(A+2.D0)*((2.D0*A+3.CORA-558
     4D0)*((A+1.D0)*(2.D0*A+1.D0)*(20.D0*A+75.D0)*A*U-(20.D0*A+110.D0)*QCORA-559
     5)*F+(A+1.D0)*(2.D0*A+5.D0)*(6.D0*(28.D0*A**2*(2.D0*A+1.D0)*(A+3.D0CORA-560
     6)-((52.D0*A+161.D0)*A+30.D0)*Q+A**2*(A+2.D0)*(2.D0*A+1.D0)*(2.D0*ACORA-561
     7+3.D0)*U)-10.D0*A*(A+3.D0)*(2.D0*A+1.D0)*(2.D0*A+3.D0)*(14.D0*F+6.CORA-562
     8D0*A*(A+2.D0)/W)/W)/W)/W)/W                                       CORA-563
      C(4)=B4+12.D0*(((2.D0*A+1.D0)*(A+1.D0)*(((16.D0*A+168.D0)*A+720.D0CORA-564
     1)-(A+2.D0)*(2.D0*A+3.D0)*(8.D0*A+45.D0)*U)-12.D0*(2.D0*A-3.D0)*(A-CORA-565
     22.D0)*Q)*F+(2.D0*A+3.D0)*(A+1.D0)*(((52.D0*A+266.D0)*A+660.D0)*Q-ACORA-566
     3*(2.D0*A+1.D0)*((8.D0*A+84.D0)*A+360.D0)-(A+2.D0)*(2.D0*A+1.D0)*(2CORA-567
     4.D0*A+3.D0)*(3.D0*A*(2.D0*A+5.D0)*U-10.D0*((8.D0*A+30.D0)*F+3.D0*ACORA-568
     5*(2.D0*A+5.D0)*(A+2.D0)/W)/W))/W)/W                               CORA-569
      IF (X.EQ.0.D0) GO TO 45                                           CORA-570
      C(1)=C(1)+6.D0*Q*X*(2.D0*A+3.D0)*(A+2.D0)*(((40.D0*A+300.D0)*A+476CORA-571
     1.D0)*A+240.D0+(18.D0*A-6.D0)*Q-(2.D0*A+3.D0)*((2.D0*A-10.D0)*F*X+(CORA-572
     2A+1.D0)*(A+2.D0)*((11.D0*A+15.D0)*U-2.D0*X**2)-(8.D0*A+20.D0)*((3.CORA-573
     3D0*A+13.D0)*F+(A+1.D0)*(A+2.D0)*(X+(5.D0*A+15.D0)/W))/W))/W       CORA-574
      C(2)=C(2)+X*(4.D0*A+6.D0)*(12.D0*(2.D0*A-3.D0)*(4.D0*A-1.D0)*F*Q-(CORA-575
     1A+1.D0)*(((60.D0*A-42.D0)*A+180.D0)*Q*X+(2.D0*A+1.D0)*(((32.D0*A+3CORA-576
     236.D0)*A+1440.D0)*F-(2.D0*A+3.D0)*((28.D0*A+202.D0)*A+180.D0)*F*U+CORA-577
     3A*(((40.D0*A+308.D0)*A+120.D0)-(A+2.D0)*(2.D0*A+3.D0)*((15.D0*A+25CORA-578
     4.D0)*U-2.D0*X**2))*X-(2.D0*A+3.D0)*(2.D0*A-24.D0)*F*X**2)+(3.D0*A+CORA-579
     56.D0)*(((92.D0*A+406.D0)*A+780.D0)*Q-(2.D0*A+1.D0)*(A*((8.D0*A+84.CORA-580
     6D0)*A+360.D0)+(2.D0*A+3.D0)*(A*(A+2.D0)*((11.D0*A+15.D0)*U-2.D0*X*CORA-581
     7*2)-(6.D0*A+40.D0)*F*X-(8.D0*A+20.D0)*((30.D0+8.D0*A)*F+A*(A+2.D0)CORA-582
     8*(X+(5.D0*A+15.D0)/W))/W)))/W))/W                                 CORA-583
      C(3)=C(3)+24.D0*X*Q*(2.D0*A+3.D0)**2*((2.D0*A-3.D0)*F-(A+1.D0)*(A+CORA-584
     12.D0)*(X+5.D0*(A+2.D0)/W))/W                                      CORA-585
      C(4)=C(4)+X*6.D0*(A+1.D0)*(18.D0*(A-2.D0)*(2.D0*A-3.D0)*Q+(2.D0*A+CORA-586
     11.D0)*(A*((40.D0*A+308.D0)*A+120.D0)-(2.D0*A+3.D0)*((2.D0*A-24.D0)CORA-587
     2*F*X+A*(A+2.D0)*((11.D0*A+25.D0)*U-2.D0*X**2)-4.D0*(2.D0*A+3.D0)*(CORA-588
     3(20.D0+3.D0*A)*F+A*(A+2.D0)*(X+5.D0*(A+2.D0)/W))/W)))/W           CORA-589
      GO TO 45                                                          CORA-590
C MULTIPOLE LQ=5 L1=L2-4.                                               CORA-591
   37 BD=10080.D0*DEN*A**2*(2.D0*A+5.D0)*(A+2.D0)*S**2*DSQRT(Q*((A+1.D0)CORA-592
     1**2+F**2)*((A+2.D0)**2+F**2)*((A-1.D0)**2+E**2))                  CORA-593
      B1=Q*(((336.D0*Q+48.D0*((8.D0*A+22.D0)*A+47.D0))*Q-96.D0*(2.D0*A-1CORA-594
     1.D0)*(A+2.D0)*(2.D0*A+5.D0)*(3.D0*A-7.D0))/((A-1.D0)*(2.D0*A-3.D0)CORA-595
     2)+(4.D0*(((162.D0*A+683.D0)*A+538.D0)*A-280.D0)-4.D0*(7.D0*A-38.D0CORA-596
     3)*Q-(2.D0*A+3.D0)*(((163.D0*A+497.D0)*A-16.D0)*A-140.D0)*U)*U)*F  CORA-597
      B2=3.D0*Q*(((96.D0*((((12.D0*A+56.D0)*A+29.D0)*A-70.D0)*A-70.D0)+(CORA-598
     148.D0*((4.D0*A+28.D0)*A+47.D0)+336.D0*Q)*Q)/(2.D0*A-3.D0)-4.D0*(((CORA-599
     2((66.D0*A+307.D0)*A+172.D0)*A-280.D0)*A-280.D0)+(A-2.D0)*(4.D0*A-1CORA-600
     39.D0)*Q)*U)/(2.D0*A+3.D0)+35.D0*(A**2-1.D0)*(A+2.D0)**2*U**2)     CORA-601
      B3=(((1008.D0*Q+144.D0*((4.D0*A+28.D0)*A+47.D0))*Q+288.D0*((((12.DCORA-602
     10*A+56.D0)*A+29.D0)*A-70.D0)*A-70.D0))*Q/(2.D0*A-3.D0)-12.D0*(((((CORA-603
     2178.D0*A+967.D0)*A+1410.D0)*A+428.D0)*A-280.D0)+(A-2.D0)*(10.D0*A-CORA-604
     319.D0)*Q)*Q*U+(3.D0*A+3.D0)*(((((458.D0*A+2185.D0)*A+2899.D0)*A-35CORA-605
     42.D0)*A-420.D0)*Q*U+(4.D0*A+2.D0)*A**2*(8.D0*((6.D0*A+37.D0)*A+70.CORA-606
     5D0)-(((62.D0*A+349.D0)*A+524.D0)*A-140.D0)*U))*U)/(2.D0*A+3.D0)-52CORA-607
     6.5D0*A**2*(A**2-1.D0)*(A+2.D0)**2*(2.D0*A+1.D0)*U**3              CORA-608
      B4=(((336.D0*Q+48.D0*((8.D0*A+34.D0)*A+47.D0)-(4.D0*A-8.D0)*((14.DCORA-609
     10*A-41.D0)*A+57.D0)*U)*Q/(A+1.D0)+(2.D0*A+1.D0)*(4.D0*(((162.D0*A+CORA-610
     2863.D0)*A+1070.D0)*A-840.D0)*U-96.D0*((6.D0*A+37.D0)*A+70.D0)))/(2CORA-611
     3.D0*A+3.D0)-(2.D0*A+1.D0)*(((163.D0*A+631.D0)*A+256.D0)*A-420.D0)*CORA-612
     4U**2)*F                                                           CORA-613
      IF (X.EQ.0.D0) GO TO 38                                           CORA-614
      B1=B1+X*Q*(8.D0*((((((180.D0*A+604.D0)*A-425.D0)*A-1813.D0)*A-394.CORA-615
     1D0)*A+840.D0)+(((34.D0*A+147.D0)*A-193.D0)*A-450.D0)*Q+42.D0*(A-2.CORA-616
     2D0)*Q**2)/((1.D0-A)*(2.D0*A-3.D0))+96.D0*F*Q*X+16.D0*((((26.D0*A+1CORA-617
     326.D0)*A+133.D0)*A-13.D0)*A-70.D0)*U+4.D0*((41.D0*A+115.D0)*A+170.CORA-618
     4D0)*Q*U+4.D0*((2.D0*A-1.D0)*A-54.D0)*F*X-8.D0*(5.D0*A+2.D0)*Q*X**2CORA-619
     5-(((152.D0*A+892.D0)*A+1380.D0)*A+664.D0)*X**2+(2.D0*A+3.D0)*(4.D0CORA-620
     6*((20.D0*A+97.D0)*A+62.D0)*F*U*X+4.D0*(A-2.D0)*F*X**3+(A+1.D0)*(A+CORA-621
     72.D0)*(((44.D0*A+36.D0)*U-4.D0*X**2)*X**2-((87.D0*A+67.D0)*A-70.D0CORA-622
     8)*U**2)))                                                         CORA-623
      B2=B2-12.D0*X*Q*((28.D0*F*Q+2.D0*((18.D0*A+83.D0)*A+56.D0)*F-(((34CORA-624
     1.D0*A+217.D0)*A+341.D0)*A+166.D0)*X-4.D0*(3.D0*A+1.D0)*Q*X)/(2.D0*CORA-625
     2A+3.D0)+(((9.D0*A+58.D0)*A+44.D0)*U+2.D0*A*X**2)*F+(A+1.D0)*(A+2.DCORA-626
     30)*(9.D0*(A+1.D0)*U-X**2)*X)                                      CORA-627
      B3=B3+X*(((96.D0*(5.D0*A-3.D0)*Q+4.D0*(((170.D0*A+1101.D0)*A+901.DCORA-628
     10)*A+162.D0)-24.D0*((10.D0*A-5.D0)*A-2.D0)*F*X)*Q*X-4.D0*((((22.D0CORA-629
     2*A+543.D0)*A+629.D0)*A+510.D0)*U+168.D0*Q)*F*Q+(A+1.D0)*(4.D0*(((2CORA-630
     36.D0*A-5.D0)*A+18.D0)*X**2-(((166.D0*A+627.D0)*A+1415.D0)*A+558.D0CORA-631
     4)*U)*Q*X+(2.D0*A+1.D0)*((96.D0*((6.D0*A+37.D0)*A+70.D0)-4.D0*((2.DCORA-632
     50*A-105.D0)*A-498.D0)*X**2-8.D0*(((138.D0*A+751.D0)*A+1012.D0)*A-4CORA-633
     620.D0)*U)*F+A*(4.D0*((38.D0*A+197.D0)*A+154.D0)*X**2-(((572.D0*A+2CORA-634
     7362.D0)*A+960.D0)*A-40.D0)*U+8.D0*((90.D0*A+491.D0)*A+674.D0))*X))CORA-635
     8)/(2.D0*A+3.D0)-24.D0*(17.D0*A+50.D0)*F*Q+(A+1.D0)*(2.D0*A+1.D0)*(CORA-636
     9(((373.D0*A+1411.D0)*A+544.D0)*A-420.D0)*F*U**2-4.D0*((23.D0*A+125CORA-637
     A.D0)*A+54.D0)*F*U*X**2-4.D0*(A-6.D0)*F*X**4+A*(A+2.D0)*(((141.D0*ACORA-638
     B+199.D0)*A-22.D0)*U**2-(50.D0*A+48.D0)*U*X**2+4.D0*X**4)*X))      CORA-639
      B4=B4+X*(((48.D0*((4.D0*A-4.D0)*A-1.D0)*F*X-8.D0*(((34.D0*A+225.D0CORA-640
     1)*A-61.D0)*A-168.D0)-336.D0*(A-1.D0)*Q)*Q/(A+1.D0)+4.D0*((((82.D0*CORA-641
     2A+315.D0)*A+902.D0)*A+396.D0)*U-A*(20.D0*A-26.D0)*X**2)*Q+4.D0*(2.CORA-642
     3D0*A+1.D0)*(((2.D0*A-105.D0)*A-498.D0)*F*X+A*((((104.D0*A+430.D0)*CORA-643
     4A+171.D0)*A-10.D0)*U-2.D0*((90.D0*A+491.D0)*A+674.D0)-((38.D0*A+19CORA-644
     57.D0)*A+154.D0)*X**2)))/(2.D0*A+3.D0)+(2.D0*A+1.D0)*(4.D0*((20.D0*CORA-645
     6A+107.D0)*A+54.D0)*F*U*X+4.D0*(A-6.D0)*F*X**3+A*(A+2.D0)*(4.D0*(11CORA-646
     7.D0*A+12.D0)*U*X**2-((87.D0*A+145.D0)*A-22.D0)*U**2-4.D0*X**4)))  CORA-647
   38 IF (LT) GO TO 45                                                  CORA-648
      C(1)=B1-3.D0*Q*(A+2.D0)*(((16.D0*((56.D0*A+62.D0)*A-177.D0)+48.D0*CORA-649
     1Q)*Q-32.D0*A*(2.D0*A-1.D0)*(2.D0*A+5.D0)*(3.D0*A-7.D0))/(2.D0*A-3.CORA-650
     2D0)+(4.D0*A*(((62.D0*A+159.D0)*A+29.D0)*A+70.D0)-4.D0*((97.D0*A+22CORA-651
     39.D0)*A-6.D0)*Q+35.D0*A*(A**2-1.D0)*(2.D0*A+3.D0)*(A+2.D0)*U)*U-4.CORA-652
     4D0*(2.D0*A+5.D0)*((4.D0*(2.D0*A-1.D0)*(3.D0*A-7.D0)-92.D0*Q+(2.D0*CORA-653
     5A+3.D0)*((67.D0*A-17.D0)*A-14.D0)*U)*F-5.D0*(4.D0*((59.D0*A+59.D0)CORA-654
     6*A-18.D0)*Q-4.D0*A*(2.D0*A-1.D0)*(3.D0*A+1.D0)*(11.D0*A+14.D0)-(2*CORA-655
     7A+3.D0)*(7.D0*A*(A**2-1.D0)*(A+2.D0)*U-6.D0*(2.D0*A-1.D0)*(((17.D0CORA-656
     8*A+17.D0)*A+14.D0)*F+7.D0*A*(A**2-1.D0)*(A+2.D0)/W)/W))/W)/W)/W   CORA-657
      C(2)=B3+(((96.D0*((12.D0*A+56.D0)*A+59.D0-Q)-8.D0*(((188.D0*A+864.CORA-658
     1D0)*A+889.D0)*A-18.D0)*U)*Q+A*(A+1.D0)*(2.D0*A+1.D0)*(16.D0*((6.D0CORA-659
     2*A+37.D0)*A+70.D0)*U+4.D0*(2.D0*A+3.D0)*((67.D0*A+136.D0)*A-140.D0CORA-660
     3)*U**2))*F+3.D0*(A+2.D0)*(40.D0*((19.D0*A+46.D0)*Q-((12.D0*A+32.D0CORA-661
     4)*A+7.D0)*A-14.D0)*Q-(A+1.D0)*(20.D0*(((132.D0*A+292.D0)*A-97.D0)*CORA-662
     5A-42.D0)*Q-A**2*(2.D0*A+1.D0)*(20.D0*((66.D0*A+127.D0)*A-98.D0)+35CORA-663
     6.D0*(A-1.D0)*(2.D0*A+3.D0)*(A+2.D0)*U))*U+4.D0*(2.D0*A+5.D0)*(36.DCORA-664
     70*((54.D0*A+37.D0)*A-10.D0)*Q*F-(A+1.D0)*(A*(2.D0*A+1.D0)*(672.D0*CORA-665
     8(2.D0*A-1.D0)+6.D0*(2.D0*A+3.D0)*(17.D0*A-14.D0)*U)*F-5.D0*(14.D0*CORA-666
     9(((86.D0*A+55.D0)*A-3.D0)*A-18.D0)*Q-A**2*(2.D0*A+1.D0)*(112.D0*(2CORA-667
     A.D0*A-1.D0)*(3.D0*A+2.D0)+(2.D0*A+3.D0)*(7.D0*(A-1.D0)*(A+2.D0)*U-CORA-668
     B6.D0*(2.D0*A-1.D0)*(24.D0*F+7.D0*(A-1.D0)*(A+2.D0)/W)/W)))/W))/W)/CORA-669
     CW)/W                                                              CORA-670
      C(3)=B2+12.D0*Q*((8.D0*((12.D0*A+56.D0)*A+59.D0)-8.D0*Q-(2.D0*A+3.CORA-671
     1D0)*((32.D0*A+98.D0)*A-4.D0)*U)*F+5.D0*(A+2.D0)*((38.D0*A+92.D0)*QCORA-672
     2-(((24.D0*A+64.D0)*A+14.D0)*A+28.D0)-(2.D0*A+3.D0)*(7.D0*(A**2-1.DCORA-673
     30)*(A+2.D0)*U-6.D0*(2.D0*A+5.D0)*((10.D0*A-4.D0)*F+7.D0*(A**2-1.D0CORA-674
     4)*(A+2.D0)/W)/W))/W)/W                                            CORA-675
      C(4)=B4-3.D0*(((16.D0*(((56.D0*A+330.D0)*A+619.D0)*A+354.D0+(3.D0*CORA-676
     1A-6.D0)*Q)*Q-(A+1.D0)*(4.D0*(((194.D0*A+935.D0)*A+1292.D0)*A-36.D0CORA-677
     2)*Q*U+A*(2.D0*A+1.D0)*(32.D0*((6.D0*A+37.D0)*A+70.D0)-4.D0*(((62.DCORA-678
     30*A+349.D0)*A+524.D0)*A-140.D0)*U-35.D0*(A-1.D0)*(2.D0*A+3.D0)*(A+CORA-679
     42.D0)**2*U**2))))/(2.D0*A+3.D0)+4.D0*(4.D0*((46.D0*A+213.D0)*A+230CORA-680
     5.D0)*Q*F-(A+1.D0)*((2.D0*A+1.D0)*((24.D0*A+148.D0)*A+280.D0+(2.D0*CORA-681
     6A+3.D0)*((67.D0*A+136.D0)*A-140.D0)*U)*F-5.D0*(A+2.D0)*(4.D0*((118CORA-682
     7.D0*A+257.D0)*A-90.D0)*Q-4.D0*A*(2.D0*A+1.D0)*((66.D0*A+127.D0)*A-CORA-683
     898.D0)-(2.D0*A+1.D0)*(2.D0*A+3.D0)*(7.D0*A*(A-1.D0)*(A+2.D0)*U-6.DCORA-684
     90*(2.D0*A+5.D0)*((17.D0*A-14.D0)*F+7.D0*A*(A+2.D0)*(A-1.D0)/W)/W))CORA-685
     A/W))/W)/W                                                         CORA-686
      IF (X.EQ.0.D0) GO TO 45                                           CORA-687
      C(1)=C(1)-Q*X*(3.D0*A+6.D0)*(8.D0*((38.D0*A+167.D0)*A+171.D0-3.D0*CORA-688
     1Q)*F+4.D0*(((26.D0*A+145.D0)*A+231.D0)*A+106.D0)*X+(40.D0*A+64.D0)CORA-689
     2*Q*X+(2.D0*A+3.D0)*((8.D0*A+32.D0)*F*X**2-4.D0*((35.D0*A+101.D0)*ACORA-690
     3+6.D0)*F*U+4.D0*(A+1.D0)*(A+2.D0)*(X**3-(9.D0*A+4.D0)*U*X))-4.D0*(CORA-691
     42.D0*A+5.D0)*((((44.D0*A+94.D0)*A-22.D0)*A+28.D0)-4.D0*(19.D0*A+44CORA-692
     5.D0)*Q-(2.D0*A+3.D0)*(4.D0*(3.D0*A+8.D0)*F*X+(A+1.D0)*(A+2.D0)*(2.CORA-693
     6D0*X**2-(13.D0*A-7.D0)*U)+10.D0*(((11.D0*A+59.D0)*A-6.D0)*F+(A+1.DCORA-694
     70)*(A+2.D0)*((A+3.D0)*X+(3.D0*A+21.D0)*(2.D0*A-1.D0)/W))/W))/W)/W CORA-695
      C(2)=C(2)+X*(8.D0*(((196.D0*A+1104.D0)*A+1901.D0)*A+1026.D0+(15.D0CORA-696
     1*A-18.D0)*Q+12.D0*(5.D0*A+4.D0)*F*X)*Q+(A+1.D0)*(32.D0*((4.D0*A+11CORA-697
     2.D0)*A+18.D0)*Q*X**2-8.D0*(((212.D0*A+966.D0)*A+1267.D0)*A+54.D0)*CORA-698
     3Q*U+(2.D0*A+1.D0)*(8.D0*((38.D0*A+213.D0)*A+318.D0)*F*X+4.D0*A*(((CORA-699
     4(106.D0*A+599.D0)*A+912.D0)*A-140.D0)*U+((26.D0*A+107.D0)*A+46.D0)CORA-700
     5*X**2-8.D0*((6.D0*A+37.D0)*A+70.D0))+(2.D0*A+3.D0)*(8.D0*(A+6.D0)*CORA-701
     6F*X**3-4.D0*((47.D0*A+170.D0)*A+48.D0)*F*U*X+A*(A+2.D0)*(((87.D0*ACORA-702
     7+67.D0)*A-70.D0)*U**2-4.D0*(11.D0*A+9.D0)*U*X**2+4.D0*X**4))))+3.DCORA-703
     80*(A+2.D0)*(32.D0*((24.D0*A+107.D0)*A+110.D0)*F*Q+(A+1.D0)*(96.D0*CORA-704
     9((4.D0*A+17.D0)*A+20.D0)*Q*X-(8.D0*A+4.D0)*(2.D0*((6.D0*A+37.D0)*ACORA-705
     A+70.D0)*F+A*((22.D0*A+125.D0)*A+194.D0)*X+(2.D0*A+3.D0)*(((61.D0*ACORA-706
     B+143.D0)*A-70.D0)*F*U+A*(A+2.D0)*((9.D0*A+4.D0)*U-X**2)*X-(6.D0*A+CORA-707
     C20.D0)*F*X**2))+(8.D0*A+20.D0)*(((532.D0*A+2246.D0)*A-180.D0)*Q-(2CORA-708
     D.D0*A+1.D0)*(4.D0*A*((66.D0*A+295.D0)*A-98.D0)-(2.D0*A+3.D0)*((22.CORA-709
     ED0*A+60.D0)*F*X+A*(A+2.D0)*(2.D0*X**2-(13.D0*A-7.D0)*U)+10.D0*(((1CORA-710
     F7.D0*A+93.D0)*A-42.D0)*F+A*(A+2.D0)*((A+3.D0)*X+3.D0*(A+7.D0)*(2.DCORA-711
     G0*A-1.D0)/W))/W)))/W))/W)/W                                       CORA-712
      C(3)=C(3)+12.D0*Q*X*(2.D0*(((28.D0*A+148.D0)*A+221.D0)*A+106.D0)+(CORA-713
     16.D0*A-4.D0)*Q+(2.D0*A+3.D0)*((2.D0*A+12.D0)*F*X+(A+2.D0)*((A+1.D0CORA-714
     2)*(2.D0*X**2-(13.D0*A+8.D0)*U)+5.D0*((10.D0*A+28.D0)*F+2.D0*(A+1.DCORA-715
     30)*(A+2.D0)*(X+(6.D0*A+15.D0)/W))/W)))/W                          CORA-716
      C(4)=C(4)+3.D0*X*((24.D0*(2.D0*A-1.D0)*(A-2.D0)*F*Q-(4.D0*A+4.D0)*CORA-717
     1(((20.D0*A+46.D0)*A+108.D0)*Q*X+(2.D0*A+1.D0)*(((76.D0*A+426.D0)*ACORA-718
     2+636.D0)*F+A*((26.D0*A+107.D0)*A+46.D0)*X)))/(2.D0*A+3.D0)+(4.D0*ACORA-719
     3+4.D0)*((2.D0*A+1.D0)*((35.D0*A+130.D0)*A+48.D0)*F*U+(2.D0*A+1.D0)CORA-720
     4*(A*(A+2.D0)*(9.D0*(A+1.D0)*U-X**2)*X-(2.D0*A+12.D0)*F*X**2)-(4.D0CORA-721
     5*((38.D0*A+169.D0)*A+210.D0)*Q-(2.D0*A+1.D0)*(A*((44.D0*A+250.D0)*CORA-722
     6A+388.D0)-(2.D0*A+3.D0)*((12.D0*A+40.D0)*F*X-(A+2.D0)*(A*((13.D0*ACORA-723
     7+8.D0)*U-2.D0*X**2)-10.D0*((11.D0*A+30.D0)*F+A*(A+2.D0)*(X+(6.D0*ACORA-724
     8+15.D0)/W))/W))))/W))/W                                           CORA-725
      GO TO 45                                                          CORA-726
C MULTIPOLE LQ=5 L1=L2-5.                                               CORA-727
   39 BD=181440.D0*DEN*S**2*DSQRT(Q*((A+1.D0)**2+F**2)*((A+2.D0)**2+F**2CORA-728
     1)*((A-1.D0)**2+E**2)*((A+3.D0)**2+F**2))*A**2                     CORA-729
      B1=Q*(2304.D0*A*(2.D0*A-1.D0)-6912.D0*Q+864.D0*(9.D0*A+1.D0)*Q*U-2CORA-730
     188.D0*A*((22.D0*A+3.D0)*A+5.D0)*U+8.D0*A*(((530.D0*A+611.D0)*A+12.CORA-731
     2D0)*A+72.D0)*U**2-8.D0*((602.D0*A+683.D0)*A-60.D0)*Q*U**2+96.D0*A*CORA-732
     3(A**2-1.D0)*(2.D0*A+5.D0)*(2.D0*A+3.D0)*U**3)                     CORA-733
      B2=24.D0*Q*F*(288.D0-(204.D0*A+36.D0)*U+((89.D0*A+141.D0)*A-20.D0)CORA-734
     1*U**2)                                                            CORA-735
      B3=12.D0*F*(Q*(576.D0-24.D0*(37.D0*A+3.D0)*U+((718.D0*A+582.D0)*A-CORA-736
     140.D0)*U**2)+A*(A+1.D0)*(2.D0*A+1.D0)*U*(96.D0-(148.D0*A+12.D0)*U-CORA-737
     2((137.D0*A+148.D0)*A-180.D0)*U**2))                               CORA-738
      B4=Q*(864.D0*(9.D0*A+1.D0)*U-6912.D0-8.D0*(602.D0*A**2+613.D0*A-60CORA-739
     1.D0)*U**2)+A*(2.D0*A+1.D0)*(2304.D0-288.D0*(11.D0*A-1.D0)*U+8.D0*(CORA-740
     2(265.D0*A+174.D0)*A-54.D0)*U**2+48.D0*(2.D0*A+3.D0)*(2.D0*A+5.D0)*CORA-741
     3(A-1.D0)*U**3)                                                    CORA-742
      IF (X.EQ.0.D0) GO TO 40                                           CORA-743
      B1=B1+X*Q*((1176.D0*F*U+((2040.D0*A+2616.D0)*U-1200.D0-48.D0*X**2)CORA-744
     1*X)*Q+(((2944.D0*A+4432.D0)*A+912.D0)*X+8.D0*((794.D0*A+1535.D0)*ACORA-745
     2+222.D0)*F)*U-(16.D0*((94.D0*A+385.D0)*A+216.D0)+((368.D0*A+1016.DCORA-746
     30)*A+600.D0)*X**2)*X+(2*A+3.D0)*((((608.D0*A+632.D0)*U-600.D0-24.DCORA-747
     40*X**2)*X**2-3456.D0-((1950.D0*A+2614.D0)*A-140.D0)*U**2)*F+(A+1.DCORA-748
     50)*((120.D0*A+152.D0)*U*X**3-((414.D0*A+798.D0)*A+20.D0)*U**2*X-8.CORA-749
     6D0*X**5)))                                                        CORA-750
      B2=B2+X*Q*(1200.D0*F*X-1176.D0*Q*U-24.D0*((33.D0*A+120.D0)*A+38.D0CORA-751
     1)*U-24.D0*(53.D0*A+60.D0)*F*U*X+48.D0*F*X**3+(A+1.D0)*(3456.D0+((7CORA-752
     238.D0*A+1722.D0)*A+60.D0)*U**2+24.D0*(25.D0-(13.D0*A+19.D0)*U+X**2CORA-753
     3)*X**2))                                                          CORA-754
      B3=B3+X*((1200.D0*F*X-24.D0*((597.D0*A+720.D0)*A+74.D0)*U-1176.D0*CORA-755
     1Q*U-(2808.D0*A+2616.D0)*F*U*X+48.D0*F*X**3)*Q+(A+1.D0)*((10368.D0-CORA-756
     224.D0*(113.D0*A+79.D0)*U*X**2+(72.D0*X**2+1800.D0)*X**2+((11782.D0CORA-757
     3*A+10730.D0)*A-420.D0)*U**2)*Q+(2*A+1.D0)*((((3090.D0*A+3898.D0)*ACORA-758
     4+60.D0)*U**2+3456.D0+600.D0*X**2-304.D0*(14.D0*A+3.D0)*U-(680.D0*ACORA-759
     5+456.D0)*U*X**2+24.D0*X**4)*F*X+A*(((8.D0*X**2+184.D0)*X**2+752.D0CORA-760
     6)*X**2-2304.D0-((3.D0*(((187.D0*A+479.D0)*A-6.D0)*A-240.D0)*U+4.D0CORA-761
     7*((1175.D0*A+624.D0)*A-108.D0))*U-96.D0*(55.D0*A-3.D0))*U+(((570.DCORA-762
     80*A+1278.D0)*A+356.D0)*U-60.D0*A-440.D0-44.D0*(3.D0*A+4.D0)*X**2)*CORA-763
     9U*X**2))))                                                        CORA-764
      B4=B4+X*((1176.D0*F*U-1200.D0*X+120.D0*(17.D0*A+12.D0)*U*X-48.D0*XCORA-765
     1**3)*Q+(2.D0*A+1.D0)*((8.D0*(397.D0*A+114.D0)*U-3456.D0-10.D0*((19CORA-766
     25.D0*A+289.D0)*A+6.D0)*U**2-600.D0*X**2+8.D0*(76.D0*A+57.D0)*U*X**CORA-767
     32-24.D0*X**4)*F+A*X*(440.D0*U-752.D0-((414.D0*A+1050.D0)*A+356.D0)CORA-768
     4*U**2-184.D0*X**2+8.D0*(15.D0*A+22.D0)*U*X**2-8.D0*X**4)))        CORA-769
   40 IF (LT) GO TO 45                                                  CORA-770
      C(1)=B1+24.D0*Q*((60.D0*((9.D0*A+5.D0)*U-8.D0)*Q+96.D0*(A-1.D0)*(2CORA-771
     1.D0*A-1.D0)-4.D0*(((74.D0*A+15.D0)*A+28.D0)*A+3.D0)*U-(2.D0*A+3.D0CORA-772
     2)*(A+2.D0)*((137.D0*A-37.D0)*A-30.D0)*U**2)*F+4.D0*(30.D0*((8.D0*ACORA-773
     3-6.D0)*A+5.D0-7.D0*Q)*Q+(A+2.D0)*(5.D0*((128.D0*A+80.D0)*A-33.D0)*CORA-774
     4Q-A*(((676.D0*A+544.D0)*A-201.D0)*A-144.D0))*U-(6.D0*A-6.D0)*((2.DCORA-775
     50*A-1.D0)*(4.D0*A-6.D0)*A+(A+1.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*A*(CORA-776
     6A+2.D0)*U**2)+5.D0*((12.D0*(2.D0*A-1.D0)*(((50.D0*A+153.D0)*A+136.CORA-777
     7D0)*A+39.D0)-84.D0*((10.D0*A+19.D0)*A+3.D0)*Q)*F+(A+2.D0)*((2.D0*ACORA-778
     8+3.D0)*(2.D0*A+5.D0)*((37.D0*A-17.D0)*A-6.D0)*U*F+6.D0*(A*(2.D0*A-CORA-779
     91.D0)*(((236.D0*A+648.D0)*A+625.D0)*A+66.D0)-3.D0*(((140.D0*A+294.CORA-780
     AD0)*A+196.D0)*A-105.D0)*Q+(2.D0*A+3.D0)*(2.D0*A+5.D0)*(A*(A**2-1.DCORA-781
     B0)*(2.D0*A+6.D0)*U-(14.D0*A-7.D0)*(((7.D0*A+5.D0)*A+6.D0)*F+A*(A**CORA-782
     C2-1.D0)*(2.D0*A+6.D0)/W)/W))/W))/W)/W)/W                          CORA-783
      C(2)=B3+8.D0*((1440.D0*Q-288.D0*(4.D0*A**2+1.D0)+12.D0*(((168.D0*ACORA-784
     1+132.D0)*A+62.D0)*A+3.D0)*U-30.D0*(68.D0*A+30.D0)*Q*U)*Q+(A+1.D0)*CORA-785
     2(8.D0*A+12.D0)*(((338.D0*A-83.D0)*A-45.D0)*Q*U-(2.D0*A+1.D0)*A**2*CORA-786
     3(12.D0+(169.D0*A-99.D0)*U+(A-1.D0)*(6.D0*A+15.D0)*U**2))*U+3.D0*((CORA-787
     4(840.D0*Q-120.D0*(4.D0*A**2+5.D0))*Q-(2.D0*A+3.D0)*(40.D0*((65.D0*CORA-788
     5A+30.D0)*A-11.D0)*Q-5.D0*A*(2.D0*A+1.D0)*(A+1.D0)*(12.D0*(25.D0*A-CORA-789
     613.D0)+(A+2.D0)*(37.D0*A-30.D0)*U))*U)*F+4.D0*((630.D0*((10.D0*A+1CORA-790
     75.D0)*A+2.D0)*Q-90.D0*((((200.D0*A+420.D0)*A+162.D0)*A-63.D0)*A-26CORA-791
     8.D0))*Q+(2.D0*A+3.D0)*((A+1.D0)*(1512.D0*(4.D0*A**2-1.D0)*A**2-(A+CORA-792
     92.D0)*(30.D0*((44.D0*A-18.D0)*A-5.D0)*Q-6.D0*A**2*(2.D0*A+1.D0)*(1CORA-793
     A18.D0*A-83.D0+(A-1.D0)*(2.D0*A+5.D0)*U))*U)+5.D0*(42.D0*(((70.D0*ACORA-794
     B+129.D0)*A+53.D0)*A-30.D0)*Q*F-(A+1.D0)*(A*(2.D0*A+1.D0)*(252.D0*(CORA-795
     C2.D0*A-1.D0)*(4.D0*A+5.D0)+7.D0*(A+2.D0)*(2.D0*A+5.D0)*(7.D0*A-6.DCORA-796
     D0)*U)*F-6.D0*(A+2.D0)*(14.D0*(((56.D0*A+36.D0)*A+4.D0)*A-15.D0)*Q-CORA-797
     EA**2*(2.D0*A+1.D0)*((4.D0*A+3.D0)*54.D0*(2.D0*A-1.D0)+(2.D0*A+5.D0CORA-798
     F)*((A-1.D0)*(2.D0*A+6.D0)*U-7.D0*(2.D0*A-1.D0)*(9.D0*F+(A-1.D0)*(2CORA-799
     G.D0*A+6.D0)/W)/W)))/W))/W))/W)/W)/W                               CORA-800
      C(3)=B2+96.D0*Q*((120.D0-25.D0*(4.D0*A+3.D0)*U)*Q-24.D0*(4.D0*A**2CORA-801
     1+1.D0)+((((88.D0*A+72.D0)*A+12.D0)*A+3.D0)+3.D0*(A**2-1.D0)*(2.D0*CORA-802
     2A+3.D0)*(2.D0*A+5.D0)*U)*U+5.D0*((42.D0*Q-(24.D0*A**2+30.D0))*F-(ACORA-803
     3+2.D0)*((2.D0*A+3.D0)*(25.D0*A-11.D0)*U*F-6.D0*(21.D0*(4.D0*A+1.D0CORA-804
     4)*Q-3.D0*(((32.D0*A+20.D0)*A-4.D0)*A-13.D0)-(2.D0*A+3.D0)*(2.D0*A+CORA-805
     55.D0)*((A**2-1.D0)*U-7.D0*((5.D0*A-3.D0)*F+(A**2-1.D0)*(2.D0*A+6.DCORA-806
     60)/W)/W))/W))/W)/W                                                CORA-807
      C(4)=B4+24.D0*((60.D0*((9.D0*A+5.D0)*U-8.D0)*Q+(A+1.D0)*(2.D0*A+1.CORA-808
     1D0)*(96.D0-4.D0*(37.D0*A+3.D0)*U-((137.D0*A+148.D0)*A-180.D0)*U**2CORA-809
     2))*F+4.D0*((30.D0*((8.D0*A+6.D0)*A+5.D0)-210.D0*Q)*Q+(2.D0*A+3.D0)CORA-810
     3*((A+1.D0)*(10.D0*(32.D0*A-11.D0)*Q*U-(2.D0*A+1.D0)*(A*(12.D0+(169CORA-811
     4.D0*A-99.D0)*U)+3.D0*(A-1.D0)*(2.D0*A+5.D0)*A*U**2))-5.D0*(84.D0*(CORA-812
     55.D0*A+1.D0)*Q*F-(A+1.D0)*((2.D0*A+1.D0)*(12.D0*(25.D0*A-13.D0)+(ACORA-813
     6+2.D0)*(37.D0*A-30.D0)*U)*F-6.D0*(A+2.D0)*(105.D0*(2.D0*A-1.D0)*Q-CORA-814
     7(2.D0*A+1.D0)*((118.D0*A-83.D0)*A+(2.D0*A+5.D0)*(A*(A-1.D0)*U-7.D0CORA-815
     8*((7.D0*A-6.D0)*F+A*(A-1.D0)*(2.D0*A+6.D0)/W)/W)))/W))/W))/W)/W   CORA-816
      IF (X.EQ.0.D0) GO TO 45                                           CORA-817
      C(1)=C(1)-Q*X*(720.D0*(((6.D0*A+23.D0)*A+19.D0)+Q)*F*X+(A+2.D0)*(7CORA-818
     120.D0*Q*X**2-384.D0*((22.D0*A-5.D0)*A+3.D0)+11520.D0*Q+24.D0*(((43CORA-819
     20.D0*A+255.D0)*A+29.D0)*A+6.D0)*U-72.D0*(173.D0*A+107.D0)*Q*U+120.CORA-820
     3D0*((2.D0*A+17.D0)*A+9.D0)*X**2+(2.D0*A+3.D0)*(144.D0*F*X**3-24.D0CORA-821
     4*(95.D0*A+71.D0)*F*U*X+(A+1.D0)*(6.D0*((123.D0*A+137.D0)*A-120.D0)CORA-822
     5*U**2-24.D0*(13.D0*A+14.D0)*U*X**2+24.D0*X**4)))-24.D0*((2.D0*A+5.CORA-823
     6D0)*((20.D0*((10.D0*A-7.D0)*A+9.D0)-420.D0*Q)*F+(A+2.D0)*((10.D0*(CORA-824
     7(14.D0*A-1.D0)*A+3.D0)-180.D0*Q)*X+(2.D0*A+3.D0)*((199.D0*A-31.D0)CORA-825
     8*F*U-20.D0*F*X**2+(A+1.D0)*((21.D0*A+13.D0)*U-2.D0*X**2)*X)))+5.D0CORA-826
     9*(A+2.D0)*(4*((((220.D0*A+1340.D0)*A+973.D0)*A+123.D0)*A-234.D0)-8CORA-827
     A4.D0*((10.D0*A+55.D0)*A+21.D0)*Q+(2.D0*A+3.D0)*(2.D0*A+5.D0)*((A+1CORA-828
     B.D0)*(A+3.D0)*((15.D0*A-8.D0)*U-2.D0*X**2)-30.D0*(A+3.D0)*F*X-6.D0CORA-829
     C*(21.D0*((2.D0*A+13.D0)*A-3.D0)*F+(A+1.D0)*(A+3.D0)*((2.D0*A+7.D0)CORA-830
     D*X+(14.D0*A-7.D0)*(A+8.D0)/W))/W))/W)/W)/W                        CORA-831
      C(2)=C(2)+X*(720.D0*((12.D0*A+32.D0)*A+19.D0+Q)*Q*X+(2.D0*A+3.D0)*CORA-832
     1((7680.D0+480.D0*X**2-48.D0*(222.D0*A+107.D0)*U)*F*Q+(A+1.D0)*((28CORA-833
     28.D0*X**2-48.D0*(127.D0*A+71.D0)*U)*Q*X+(2.D0*A+1.D0)*(((48.D0*X**CORA-834
     32+720.D0)*X**2-768.D0+(32.D0*(62.D0*A+3.D0)+16.D0*((168.D0*A+139.DCORA-835
     40)*A-90.D0)*U-(920.D0*A+672.D0)*X**2)*U)*F+A*X*((8.D0*X**2+40.D0-(CORA-836
     5120.D0*A+152.D0)*U)*X**2+((414.D0*A+798.D0)*A+20.D0)*U**2-1408.D0+CORA-837
     6(2280.D0*A+736.D0)*U))))+6.D0*((A+2.D0)*((4200.D0*Q-200.D0*((20.D0CORA-838
     7*A+8.D0)*A+9.D0))*Q+(2.D0*A+3.D0)*(1200.D0*F*Q*X+(A+1.D0)*((400.D0CORA-839
     8*X**2-(4960.D0*A-620.D0)*U)*Q+(2.D0*A+1.D0)*((40.D0*X**2-200.D0-(5CORA-840
     948.D0*A+260.D0)*U)*F*X+A*((((123.D0*A+137.D0)*A-120.D0)*U+(2452.D0CORA-841
     A*A-792.D0))*U+96.D0+4.D0*X**2*(X**2-35.D0-(13.D0*A+14.D0)*U))))))+CORA-842
     B(8.D0*A+12.D0)*(420.D0*((10.D0*A+45.D0)*A+14.D0)*F*Q-(A+1.D0)*(240CORA-843
     C.D0*(2.D0*A+1.D0)*((10.D0*A+45.D0)*A-13.D0)*F-(A+2.D0)*(450.D0*(2.CORA-844
     DD0*A+5.D0)*Q*X+(2.D0*A+1.D0)*(2.D0*A+5.D0)*(30.D0*F*X**2-(274.D0*ACORA-845
     E-120.D0)*F*U+A*X*(2.D0*X**2-220.D0-(21.D0*A+13.D0)*U))+5.D0*(42.D0CORA-846
     F*((42.D0*A+231.D0)*A-45.D0)*Q-(2.D0*A+1.D0)*(8.D0*A*((118.D0*A+649CORA-847
     G.D0)*A-249.D0)+(A+3.D0)*(2.D0*A+5.D0)*(A*(15.D0*A-8.D0)*U-42.D0*F*CORA-848
     HX-2.D0*A*X**2))+(12.D0*A+6.D0)*(2.D0*A+5.D0)*(28.D0*((2.D0*A+13.D0CORA-849
     I)*A-6.D0)*F+A*(A+3.D0)*((2.D0*A+7.D0)*X+(14.D0*A-7.D0)*(A+8.D0)/W)CORA-850
     J)/W)/W)))/W)/W)/W                                                 CORA-851
      C(3)=C(3)+24.D0*X*Q*((30.D0*Q+10.D0*((4.D0*A+16.D0)*A+9.D0))*X+(2.CORA-852
     1D0*A+3.D0)*((160.D0-(124.D0*A+114.D0)*U+10.D0*X**2)*F+(A+1.D0)*(2.CORA-853
     2D0*X**2-(21.D0*A+28.D0)*U)*X)+(5.D0*A+10.D0)*(126.D0*Q-2.D0*((52.DCORA-854
     30*A+4.D0)*A+15.D0)+(2.D0*A+3.D0)*(18.D0*F*X+(A+1.D0)*(2.D0*X**2-(1CORA-855
     45.D0*A+13.D0)*U))+(12.D0*A+18.D0)*(2.D0*A+5.D0)*(14.D0*F+(A+1.D0)*CORA-856
     5(X+(7.D0*A+21.D0)/W))/W)/W)/W                                     CORA-857
      C(4)=C(4)-X*(720.D0*F*Q*X+(A+1.D0)*((11520.D0+720.D0*X**2-72.D0*(1CORA-858
     173.D0*A+114.D0)*U)*Q-(2.D0*A+1.D0)*((24.D0*(95.D0*A+84.D0)*U-2160.CORA-859
     2D0-144.D0*X**2)*F*X+A*(4224.D0-24.D0*(215.D0*A+92.D0)*U-6.D0*((123CORA-860
     3.D0*A+287.D0)*A+10.D0)*U**2-120.D0*X**2+24.D0*(13.D0*A+19.D0)*U*X*CORA-861
     4*2-24.D0*X**4)))+24.D0*(2.D0*A+3.D0)*(420.D0*F*Q+(A+1.D0)*(180.D0*CORA-862
     5Q*X-7.D0*A*(2.D0*A+1.D0)*(3.D0*A+4.D0)*U*X-(2.D0*A+1.D0)*((100.D0+CORA-863
     6(199.D0*A+130.D0)*U-20.D0*X**2)*F+A*X*(70.D0-2.D0*X**2))+5.D0*(A+2CORA-864
     7.D0)*(420.D0*Q+(2.D0*A+1.D0)*(30.D0*F*X+A*(2.D0*X**2-220.D0-(15.D0CORA-865
     8*A+13.D0)*U)+6.D0*(2.D0*A+5.D0)*(21.D0*F+A*(X+(7.D0*A+21.D0)/W))/WCORA-866
     9))/W))/W)/W                                                       CORA-867
      GO TO 45                                                          CORA-868
   41 IF ((X.NE.0.D0).OR.(MOD(LL,2).NE.1).OR.(LL.EQ.7)) GO TO 72        CORA-869
      GO TO ( 42 , 71 , 43 , 71 , 44 , 71 , 71 ) , LL                   CORA-870
C MULTIPOLE LQ=6 L1=L2.                                                 CORA-871
   42 BD=120.D0*DEN*A**2*(2.D0*A+7.D0)*(2.D0*A+5.D0)*(A+2.D0)*(A+3.D0)*(CORA-872
     1A+4.D0)*DSQRT(S*Q*P*((A+1.D0)**2+F**2)*((A+1.D0)**2+E**2))*S**2   CORA-873
      B1=P*Q*((8.D0*(((154.D0*A-205.D0)*A-376.D0)*A-140.D0+((47.D0*A-282CORA-874
     1.D0)*A-143.D0-63.D0*Q)*Q)+4.D0*((((47.D0*A+26.D0)*A-553.D0)*A-752.CORA-875
     2D0)*A-280.D0-((79.D0*A+282.D0)*A+143.D0)*Q)*U)/(A-1.D0)+2.D0*(2.D0CORA-876
     3*A+7.D0)*(2.D0*A+5.D0)*(A+1.D0)**2*U**2)                          CORA-877
      B2=(240.D0*(2.D0*A+1.D0)**2*(A-14.D0)+24.D0*((20.D0*A-336.D0)*A-14CORA-878
     13.D0)*Q-1512.D0*Q**2-6.D0*((((36.D0*A+836.D0)*A+2797.D0)*A+2374.D0CORA-879
     2)*A+560.D0+(((18.D0*A+275.D0)*A+726.D0)*A+286.D0)*Q+(A+1.D0)*(((26CORA-880
     3.D0*A+146.D0)*A+210.D0)*A+35.D0)*U)*U)/(2.D0*A+3.D0)              CORA-881
      B3=P*F*(B2+A*(2.D0*A+4.D0)*U*(54.D0*Q+6.D0*(38.D0*A+29.D0)+3.D0*(ACORA-882
     1+1.D0)*(9.D0*A+29.D0)*U))                                         CORA-883
      B2=Q*F*B2                                                         CORA-884
      B4=(((((((32.D0*A-216.D0)*A-1692.D0)*A-2272.D0)*A+454.D0)*A+1402.DCORA-885
     10)*A+210.D0)*Q*U**2+(2.D0*A-3.D0)*((16.D0*A+8.D0)*((107.D0*A-444.DCORA-886
     20)*A-140.D0)+8.D0*((((47.D0*A-176.D0)*A-924.D0)*A-724.D0)*A-140.D0CORA-887
     3)*U+(8.D0*((47.D0*A-390.D0)*A-143.D0)-4.D0*((142.D0*A+390.D0)*A+14CORA-888
     43.D0)*U-504.D0*Q)*Q)*Q+A**2*(2.D0*A+1.D0)*(480.D0*(2.D0*A+1.D0)*(ACORA-889
     5-14.D0)+(4.D0*(((214.D0*A-849.D0)*A-3808.D0)*A-2100.D0)+((((204.D0CORA-890
     6*A+752.D0)*A-232.D0)*A-2550.D0)*A-1680.D0)*U)*U))/((A+1.D0)*(2.D0*CORA-891
     7A+3.D0))+A**2*(2.D0*A+5.D0)*(2.D0*A+7.D0)*(2.D0*A+1.D0)*(A+1.D0)*UCORA-892
     8**3                                                               CORA-893
      IF (LT) GO TO 45                                                  CORA-894
      C(1)=B1+12.D0*P*Q*(A+2.D0)*((58.D0+76.D0*A+18.D0*Q+(A+1.D0)*(9.D0*CORA-895
     1A+29.D0)*U)*F-(2.D0*A+5.D0)*((28.D0*A+32.D0)*A+14.D0+(4.D0*A-6.D0)CORA-896
     2*Q+(A+1.D0)*((A+1.D0)*(2.D0*A+7.D0)*U+10.D0*(A+3.D0)*(2.D0*F-(A+1.CORA-897
     3D0)*(2.D0*A+7.D0)/W)/W))/W)/W                                     CORA-898
      C(2)=B3-2.D0*P*(2.D0*A*((((48.D0*A+16.D0)*A-570.D0)*A-703.D0)*A-21CORA-899
     10.D0)*U+(2.D0*A-3.D0)*((((4.D0*A-34.D0)*A-172.D0)*A-116.D0)*U+8.D0CORA-900
     2*((5.D0*A-48.D0)*A-29.D0)-72.D0*Q)*Q-A*(2.D0*A+1.D0)*(40.D0*(2.D0*CORA-901
     3A+1.D0)*(14.D0-A)-(2.D0*A+7.D0)*(2.D0*A+5.D0)*(A+1.D0)**2*U**2)-6.CORA-902
     4D0*(A+2.D0)*(5.D0*((14.D0-A)*(2.D0*A+1.D0)**2-(A-2.D0)*(2.D0*A-3.DCORA-903
     50)*Q-(A+1.D0)*(2.D0*A+1.D0)*((A+1.D0)*A-7.D0)*U)*F+(2.D0*A+5.D0)*(CORA-904
     6(((4.D0*A+6.D0)*A+92.D0)*A+60.D0)*Q+(2.D0*A+1.D0)*((A-14.D0)*A*(4.CORA-905
     7D0*A+2.D0)+(A+1.D0)*(A*(A+1.D0)*(2.D0*A+7.D0)*U-10.D0*(A+3.D0)*(7.CORA-906
     8D0*F+(2.D0*A+7.D0)*A*(A+1.D0)/W)/W)))/W)/W)/W                     CORA-907
      C(3)=B2+2.D0*Q*(A*((((16.D0*A+600.D0)*A+2332.D0)*A+2298.D0)*A+700.CORA-908
     1D0)*U+(2.D0*A-3.D0)*((((4.D0*A+70.D0)*A+212.D0)*A+116.D0)*U-8.D0*(CORA-909
     2(5.D0*A-48.D0)*A-29.D0)+72.D0*Q)*Q+40.D0*(2.D0*A+1.D0)**2*A*(14.D0CORA-910
     3-A)+3.D0*A*(2.D0*A+5.D0)*(2.D0*A+7.D0)*(A+1.D0)**2*U**2+6.D0*(A+2.CORA-911
     4D0)*(5.D0*((14.D0-A)*(2.D0*A+1.D0)**2-(A-2.D0)*(2.D0*A-3.D0)*Q+(A+CORA-912
     51.D0)*((8.D0*A+28.D0)*A+7.D0)*U)*F+(2.D0*A+5.D0)*((((4.D0*A+6.D0)*CORA-913
     6A+92.D0)*A+60.D0)*Q+2.D0*(A-14.D0)*A*(2.D0*A+1.D0)**2-5.D0*A*(A+1.CORA-914
     7D0)**2*(2.D0*A+7.D0)*U-10.D0*(A+3.D0)*(A+1.D0)*(2.D0*A+1.D0)*(7.D0CORA-915
     8*F+(2.D0*A+7.D0)*A*(A+1.D0)/W)/W)/W)/W)/W                         CORA-916
      C(4)=B4+6.D0*(2.D0*F*((2.D0*A-3.D0)*(A-2.D0)*(((18.D0*A+58.D0)*A+2CORA-917
     19.D0)*U+58.D0*(2.D0*A+1.D0)+18.D0*Q)*Q+A*(2.D0*A+1.D0)*(40.D0*(2.DCORA-918
     20*A+1.D0)*(A-14.D0)+(((58.D0*A-123.D0)*A-906.D0)*A-560.D0)*U+(A+1.CORA-919
     3D0)*(((9.D0*A+43.D0)*A+34.D0)*A-35.D0)*U**2))/(2.D0*A+3.D0)-((((((CORA-920
     416.D0*A**2+60.D0)*A+820.D0)*A+794.D0)*A+140.D0)*U+4.D0*(2.D0*A-3.DCORA-921
     50)*(2.D0*A-5.D0)*(A-2.D0)*Q)*Q-(2.D0*A+1.D0)*(A**2*(40.D0*(14.D0-ACORA-922
     6)*(2.D0*A+1.D0)-(A+1.D0)**2*(2.D0*A+5.D0)*(2.D0*A+7.D0)*U**2)-4.D0CORA-923
     7*(((24.D0*A-44.D0)*A+257.D0)*A+70.D0)*Q-(((48.D0*A-8.D0)*A-566.D0)CORA-924
     8*A-420.D0)*A**2*U+10.D0*(A+2.D0)*(4.D0*((14.D0-A)*(2.D0*A+1.D0)*A-CORA-925
     9((2.D0*A+2.D0)*A+15.D0)*Q-A*(A+1.D0)*((A+1.D0)*A-7.D0)*U)*F+(2.D0*CORA-926
     AA+5.D0)*(2.D0*(A-14.D0)*(2.D0*A+1.D0)*A**2+2.D0*(((2.D0*A+9.D0)*A+CORA-927
     B43.D0)*A+21.D0)*Q+A*(A+1.D0)*(A*(A+1.D0)*(2.D0*A+7.D0)*U+(4.D0*A+2CORA-928
     C.D0)*(A+3.D0)*((A+7.D0)*2.D0*F+(2.D0*A+7.D0)*A*(A+1.D0)/W)/W))/W)/CORA-929
     DW))/W)/W                                                          CORA-930
      GO TO 45                                                          CORA-931
C MULTIPOLE LQ=6 L1=L2-2.                                               CORA-932
   43 BD=2520.D0*DEN*A**2*(2.D0*A+5.D0)*(2.D0*A+7.D0)*(A+2.D0)*(A+3.D0)*CORA-933
     1(A+4.D0)*S*DSQRT(S*Q*P*((A+1.D0)**2+F**2)*((A+2.D0)**2+F**2))     CORA-934
      B1=2*P*Q*(120.D0*((((2.D0*A+57.D0)*A-117.D0)*A-306.D0)*A-140.D0+((CORA-935
     111.D0*A-129.D0)*A-113.D0-21.D0*Q)*Q)/(A-1.D0)-((((74.D0*A-865.D0)*CORA-936
     2A-5208.D0)*A-7344.D0)*A-3360.D0)*U+((266.D0*A+863.D0)*A+312.D0)*Q*CORA-937
     3U-3.D0*(A+1.D0)*(A+2.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)CORA-938
     4*U**2)                                                            CORA-939
      B2=6.D0*Q*F*((120.D0*((2.D0*A-147.D0)*A-113.D0-21.D0*Q)*Q+60.D0*((CORA-940
     1((4.D0*A-56.D0)*A-261.D0)*A-259.D0)*A-56.D0)*U+(((86.D0*A-573.D0)*CORA-941
     2A-2171.D0)*A-312.D0)*Q*U-16800.D0*(A+1.D0)*(2.D0*A+1.D0))/(2.D0*A+CORA-942
     33.D0)+(A+2.D0)*(((43.D0*A+193.D0)*A+210.D0)*A+105.D0)*U**2)       CORA-943
      B3=3*P*((240.D0*((2.D0*A-147.D0)*A-113.D0-21.D0*Q)*Q+40.D0*(A+1.D0CORA-944
     1)*(2.D0*A+1.D0)*(((2.D0*A+63.D0)*A+69.D0)*A-168.D0)*U+(((892.D0*A+CORA-945
     21374.D0)*A-2182.D0)*A-624.D0)*Q*U-33600.D0*(A+1.D0)*(2.D0*A+1.D0))CORA-946
     3/(2.D0*A+3.D0)-(A+1.D0)*(A+2.D0)*(2.D0*A+1.D0)*((19.D0*A-6.D0)*A-2CORA-947
     410.D0)*U**2)*F                                                    CORA-948
      B4=(((2.D0*A-3.D0)*(240.D0*((((2.D0*A+69.D0)*A-369.D0)*A-534.D0)*ACORA-949
     1-140.D0+((11.D0*A-165.D0)*A-113.D0-21.D0*Q)*Q)*Q+((((532.D0*A-1326CORA-950
     2.D0)*A-5422.D0)*A-624.D0)*Q-((((148.D0*A-4110.D0)*A+4130.D0)*A+451CORA-951
     320.D0)*A+40512.D0)*A-6720.D0)*Q*U)/(A+1.D0)+240.D0*A**2*(2.D0*A+1.CORA-952
     4D0)*((A+2.D0)*((2.D0*A+59.D0)*A-189.D0)*U-840.D0))/(2.D0*A+3.D0)-(CORA-953
     52.D0*(((((24.D0*A-26.D0)*A+317.D0)*A+2298.D0)*A+2001.D0)*A+630.D0)CORA-954
     6*Q+A**2*(2.D0*A+1.D0)*(((74.D0*A-1068.D0)*A-4812.D0)*A-3360.D0+3*(CORA-955
     7A+2.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)*U))*U**2)       CORA-956
      IF (LT) GO TO 45                                                  CORA-957
      C(1)=B1+6.D0*P*Q*(A+2.D0)*((360.D0*Q+40.D0*((2.D0*A+53.D0)*A+57.D0CORA-958
     1)-(2.D0*A+3.D0)*((19.D0*A+37.D0)*A-72.D0)*U)*F-(4.D0*A+10.D0)*(20.CORA-959
     2D0*(2.D0*A-3.D0)*Q+10.D0*(((2.D0*A+45.D0)*A+75.D0)*A+42.D0)-(A+1.DCORA-960
     30)*(A+2.D0)*(6.D0*A+9.D0)*(2.D0*A+7.D0)*U+(A+3.D0)*(20.D0*A+30.D0)CORA-961
     4*((A+16.D0)*F+(A+2.D0)*(6.D0*A+21.D0)*(A+1.D0)/W)/W)/W)/W         CORA-962
      C(2)=B3+2.D0*P*((2.D0*A-3.D0)*(240.D0*(3.D0*Q-(A-21.D0)*A+19.D0)-(CORA-963
     1A+1.D0)*((116.D0*A+166.D0)*A-432.D0)*U)*Q+A*(A+1.D0)*(2.D0*A+1.D0)CORA-964
     2*(16800.D0-(20.D0*(((2.D0*A+63.D0)*A+174.D0)*A+42.D0)-(A+2.D0)*(6.CORA-965
     3D0*A+9.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)*U)*U)-(3.D0*A+6.D0)*((20.D0CORA-966
     4*(A-2.D0)*(2.D0*A-3.D0)*Q-(A+1.D0)*(2.D0*A+1.D0)*(840.D0-(2.D0*A+3CORA-967
     5.D0)*((A+30.D0)*A+84.D0)*U))*5.D0*F-(4.D0*A+10.D0)*(A+1.D0)*(30.D0CORA-968
     6*((2.D0*A+7.D0)*A+48.D0)*Q-(2.D0*A+1.D0)*(A*(840.D0+(3.D0*A+6.D0)*CORA-969
     7(2.D0*A+3.D0)*(2.D0*A+7.D0)*U)-(A+3.D0)*(20.D0*A+30.D0)*((7.D0*A+4CORA-970
     82.D0)*F+A*(A+2.D0)*(6.D0*A+21.D0)/W)/W))/W)/W)/W                  CORA-971
      C(3)=B2+6.D0*Q*((2.D0*A-3.D0)*(80.D0*(3.D0*Q-(A-21.D0)*A+19.D0)-((CORA-972
     1(12.D0*A-26.D0)*A-222.D0)*A-144.D0)*U)*Q-40.D0*A*((((4.D0*A-6.D0)*CORA-973
     2A-90.D0)*A-138.D0)*A-63.D0)*U+A*(A+1.D0)*(5600.D0*(2.D0*A+1.D0)-3.CORA-974
     3D0*(A+2.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)*U**2)+10.D0*CORA-975
     4(A+2.D0)*((420.D0*(A+1.D0)*(2.D0*A+1.D0)-10.D0*(A-2.D0)*(2.D0*A-3.CORA-976
     5D0)*Q-(2.D0*A+3.D0)*(((10.D0*A+34.D0)*A+21.D0)*A+42.D0)*U)*F+(6.D0CORA-977
     6*A+15.D0)*((A+1.D0)*(((4.D0*A+14.D0)*A+96.D0)*Q+A*((A+2.D0)*(2.D0*CORA-978
     7A+3.D0)*(2.D0*A+7.D0)*U-56.D0*(2.D0*A+1.D0)))-14.D0*(A+3.D0)*(2.D0CORA-979
     7*A+3.D0)*((3.D0*A-2.D0)*F+A*(A+2.D0)*(2.D0*A+7.D0)*(A+1.D0)/W)/W)/CORA-980
     8W)/W)/W                                                           CORA-981
      C(4)=B4+6.D0*(((A-2.D0)*(2.D0*A-3.D0)*(40.D0*(9.D0*Q+(2.D0*A+73.D0CORA-982
     1)*A+57.D0)-(((38.D0*A-49.D0)*A-433.D0)*A-216.D0)*U)*Q+A*(A+1.D0)*(CORA-983
     22.D0*A+1.D0)*(40.D0*(((2.D0*A+63.D0)*A+69.D0)*A-168.D0)*U-33600.D0CORA-984
     3-(A+2.D0)*(2.D0*A+3.D0)*((19.D0*A-6.D0)*A-210.D0)*U**2))*F/(2.D0*ACORA-985
     4+3.D0)-(20.D0*(((((4.D0*A+132.D0)*A+35.D0)*A+1509.D0)*A+1812.D0)*ACORA-986
     5+420.D0+(A-2.D0)*(4.D0*A-6.D0)*(2.D0*A-5.D0)*Q)*Q-(A+1.D0)*(4.D0*(CORA-987
     6((((12.D0*A+80.D0)*A+625.D0)*A+1710.D0)*A+1158.D0)*A+630.D0)*Q*U+ACORA-988
     7**2*(2.D0*A+1.D0)*(16800.D0-(20.D0*(((2.D0*A+63.D0)*A+174.D0)*A+42CORA-989
     8.D0)-(3.D0*A+6.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)*U)*U)CORA-990
     9)+(10.D0*A+20.D0)*((((((4.D0*A+132.D0)*A+371.D0)*A+1173.D0)*A+720.CORA-991
     AD0)*Q-A*(A+1.D0)*(2.D0*A+1.D0)*(840.D0-(2.D0*A+3.D0)*((A+30.D0)*A+CORA-992
     B84.D0)*U))*2.D0*F+(6.D0*A+15.D0)*(A+1.D0)*(((((8.D0*A+60.D0)*A+220CORA-993
     C.D0)*A-30.D0)*A+252.D0)*Q+A*(2.D0*A+1.D0)*(280.D0*A+(2.D0*A+3.D0)*CORA-994
     D(A*(A+2.D0)*(2.D0*A+7.D0)*U-14.D0*(A+3.D0)*((2.D0*A+12.D0)*F+A*(A+CORA-995
     E2.D0)*(2.D0*A+7.D0)/W)/W)))/W)/W)/W)/W                            CORA-996
      GO TO 45                                                          CORA-997
C MULTIPOLE LQ=6 L1=L2-4.                                               CORA-998
   44 BD=181440.D0*DEN*A**2*(A+2.D0)*(A+3.D0)*(A+4.D0)*(2.D0*A+5.D0)*(2.CORA-999
     1D0*A+7.D0)*S*DSQRT(S*Q*((A+1.D0)**2+F**2)*((A+2.D0)**2+F**2)*((A+3CORA1000
     2.D0)**2+F**2))                                                    CORA1001
      B1=-Q*((4320.D0*((7.D0*Q+(A+78.D0)*A+103.D0)*Q+((10.D0*A+255.D0)*ACORA1002
     1+638.D0)*A+420.D0)*Q+2880.D0*A*(A+2.D0)*(A+3.D0)*(A+4.D0)*(2.D0*A+CORA1003
     25.D0)*(2.D0*A+7.D0))/(A-1.D0)-72.D0*((5.D0*((14.D0*A-13.D0)*A+30.DCORA1004
     30)*Q+(((38.D0*A+833.D0)*A+243.D0)*A+678.D0)*A+2520.D0)*Q+A*(((((14CORA1005
     48.D0*A+2304.D0)*A+13879.D0)*A+31194.D0)*A+31336.D0)*A+13440.D0))*UCORA1006
     5+(A+2.D0)*(4.D0*A+10.D0)*(A*((((814.D0*A+8467.D0)*A+23265.D0)*A+30CORA1007
     6834.D0)*A+16632.D0)+(((338.D0*A+1757.D0)*A+8199.D0)*A+8190.D0)*Q-2CORA1008
     74.D0*A*(A+1.D0)*(A+3.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)CORA1009
     8*U)*U**2)                                                         CORA1010
      B2=-6.D0*Q*F*(2160.D0*((4.D0*A+84.D0)*A+103.D0+7.D0*Q)*Q/(2.D0*A+3CORA1011
     1.D0)+1440.D0*(((2.D0*A+33.D0)*A+226.D0)*A+210.D0)-(A+2.D0)*(12.D0*CORA1012
     2(((62.D0*A+623.D0)*A+126.D0)*A-1260.D0)+180.D0*(4.D0*A-5.D0)*Q+(A+CORA1013
     33.D0)*(2.D0*A+5.D0)*((41.D0*A+591.D0)*A+910.D0)*U)*U)             CORA1014
      B3=-3.D0*F*(((30240.D0*Q+4320.D0*((4.D0*A+84.D0)*A+103.D0)-360.D0*CORA1015
     1(4.D0*A**2+5.D0)*(5.D0*A-6.D0)*U)*Q-24.D0*(((((284.D0*A+3480.D0)*ACORA1016
     2+25.D0)*A-690.D0)*A+396.D0)*A-7560.D0)*U)*Q/(2.D0*A+3.D0)+2880.D0*CORA1017
     3(((2.D0*A+33.D0)*A+226.D0)*A+210.D0)*Q+(2.D0*A+4.D0)*((((98.D0*A-2CORA1018
     4563.D0)*A-7346.D0)*A-19775.D0)*A-13650.D0)*Q*U**2+A*(A+1.D0)*(2.D0CORA1019
     5*A+1.D0)*(480.D0*(((2.D0*A+33.D0)*A+226.D0)*A+840.D0)+(A+2.D0)*((ACORA1020
     6+3.D0)*(2.D0*A+5.D0)*((233.D0*A+1798.D0)*A+2520.D0)*U-4.D0*(((262.CORA1021
     7D0*A+3523.D0)*A+16926.D0)*A+17640.D0))*U)*U)                      CORA1022
      B4=-(4320.D0*(2.D0*A-3.D0)*((7.D0*Q+(A+90.D0)*A+103.D0)*Q+7.D0*(((CORA1023
     12.D0*A+57.D0)*A+118.D0)*A+60.D0))*Q/((A+1.D0)*(2.D0*A+3.D0))-72.D0CORA1024
     2*(2.D0*A-3.D0)*((35.D0*A-50.D0)*Q+((19.D0*A+425.D0)*A-66.D0)*A-840CORA1025
     3.D0)*Q*U+(A+2.D0)*(4.D0*A+10.D0)*(((338.D0*A+1567.D0)*A+8439.D0)*ACORA1026
     4+8190.D0)*Q*U**2+A*(4.D0*A+2.D0)*(1440.D0*(((2.D0*A+33.D0)*A+226.DCORA1027
     50)*A+840.D0)-36.D0*((((74.D0*A+1109.D0)*A+6154.D0)*A+9304.D0)*A+33CORA1028
     660.D0)*U+(A+2.D0)*(2.D0*A+5.D0)*(((407.D0*A+3765.D0)*A+6714.D0)*A+CORA1029
     74536.D0-12.D0*(A+3.D0)*(2.D0*A+3.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)*UCORA1030
     8)*U**2))                                                          CORA1031
      IF (LT) GO TO 45                                                  CORA1032
      C(1)=B1+6.D0*Q*(A+2.D0)*((240.D0*(9.D0*Q+(8.D0*A+98.D0)*A+141.D0)*CORA1033
     1Q+4.D0*(((((524.D0*A+7460.D0)*A+40945.D0)*A+88825.D0)*A+77406.D0)*CORA1034
     2A+17640.D0)*U-60.D0*(((6.D0*A-7.D0)*A+23.D0)*A-30.D0)*Q*U-(A+3.D0)CORA1035
     3*(2.D0*A+5.D0)*(480.D0*(A+4.D0)*(2.D0*A+7.D0)+(A+2.D0)*(2.D0*A+3.DCORA1036
     40)*((233.D0*A+1373.D0)*A+420.D0)*U**2))*F+4.D0*(2.D0*A+5.D0)*((A+2CORA1037
     5.D0)*(5.D0*(((116.D0*A+1028.D0)*A+3015.D0)*A+1953.D0)*Q-A*((((292.CORA1038
     6D0*A+2908.D0)*A+9639.D0)*A+5517.D0)*A-756.D0))*U-60.D0*((((14.D0*ACORA1039
     7+153.D0)*A+467.D0)*A+483.D0)+(2.D0*A-3.D0)*Q)*Q+(A+3.D0)*(12.D0*(2CORA1040
     8.D0*A+7.D0)*A*(5.D0*(A+4.D0)*(2.D0*A-3.D0)-(A+1.D0)*(A+2.D0)*(2.D0CORA1041
     9*A+3.D0)*(2.D0*A+5.D0)*U**2)+5.D0*((12.D0*(A+4.D0)*(A-2.D0)*(2.D0*CORA1042
     AA-3.D0)*(2.D0*A+7.D0)-12.D0*((22.D0*A+175.D0)*A+318.D0)*Q)*F+(A+2.CORA1043
     BD0)*((2.D0*A+3.D0)*(2.D0*A+5.D0)*((85.D0*A+409.D0)*A+84.D0)*U*F-6.CORA1044
     CD0*(2.D0*A+7.D0)*(15.D0*((20.D0*A+92.D0)*A+51.D0)*Q-(A+4.D0)*A*((3CORA1045
     D32.D0*A+368.D0)*A+141.D0)-(2.D0*A+3.D0)*(2.D0*A+5.D0)*(4.D0*A*(A+1CORA1046
     E.D0)*(A+3.D0)*U-7.D0*(A+4.D0)*((19.D0*A+3.D0)*F+8.D0*A*(A+1.D0)*(ACORA1047
     F+3.D0)/W)/W))/W))/W))/W)/W                                        CORA1048
      XX=(3.D0*A+6.D0)*(5.D0*F*(120.D0*((((8.D0*A+116.D0)*A+682.D0)*A+14CORA1049
     105.D0)*A+966.D0-(A-2.D0)*(2.D0*A-3.D0)*Q)*Q-(2.D0*A+3.D0)*(4.D0*((CORA1050
     2((140.D0*A+1808.D0)*A+7627.D0)*A+13909.D0)*A+6510.D0)*Q-A*(A+1.D0)CORA1051
     3*(2.D0*A+1.D0)*(12.D0*(((2.D0*A+33.D0)*A+226.D0)*A+840.D0)+(A+2.D0CORA1052
     4)*(A+3.D0)*(10.D0*A+25.D0)*(17.D0*A+84.D0)*U))*U)+(4.D0*A+10.D0)*(CORA1053
     512.D0*(A+2.D0)*(30.D0*(((8.D0*A+62.D0)*A+159.D0)*Q-((((4.D0*A+40.DCORA1054
     60)*A+151.D0)*A+94.D0)*A+84.D0))*Q-(A+1.D0)*(2.D0*A+3.D0)*(5.D0*(((CORA1055
     768.D0*A+564.D0)*A+1285.D0)*A+210.D0)*Q-A**2*(2.D0*A+1.D0)*(((166.DCORA1056
     80*A+1399.D0)*A+3108.D0)+(A+3.D0)*(4.D0*A+10.D0)*(2.D0*A+7.D0)*U))*CORA1057
     9U)+10.D0*(A+3.D0)*(42.D0*(2.D0*A+3.D0)*(((70.D0*A+561.D0)*A+1241.DCORA1058
     A0)*A+510.D0)*Q*F-(2.D0*A+3.D0)*(A+1.D0)*(7.D0*A*(A+2.D0)*(2.D0*A+1CORA1059
     B.D0)*(2.D0*A+5.D0)*(19.D0*A+84.D0)*U*F+(2.D0*A+7.D0)*(1008.D0*A*(ACORA1060
     C+4.D0)*(2.D0*A+1.D0)*F-(6.D0*A+12.D0)*(4.D0*((194.D0*A+797.D0)*A+1CORA1061
     D05.D0)*Q-A*(2.D0*A+1.D0)*(432.D0*A*(A+4.D0)+(2.D0*A+5.D0)*(4.D0*A*CORA1062
     E(A+3.D0)*U-7.D0*(A+4.D0)*(27.D0*F+8.D0*A*(A+3.D0)/W)/W)))/W)))/W)/CORA1063
     FW)/W                                                              CORA1064
      C(2)=B3+2.D0*(1440.D0*(((((8.D0*A+132.D0)*A+906.D0)*A+2133.D0)*A+2CORA1065
     1116.D0)*A+840.D0+(2.D0*A-3.D0)*((A+36.D0)*A+47.D0+3.D0*Q)*Q)*Q-24.CORA1066
     2D0*((((((504.D0*A+7644.D0)*A+39370.D0)*A+119625.D0)*A+174926.D0)*ACORA1067
     3+106596.D0)*A+17640.D0+(10.D0*A-15.D0)*(((8.D0*A-6.D0)*A+13.D0)*A-CORA1068
     430.D0)*Q)*Q*U+(A+1.D0)*(8.D0*A+12.D0)*((A+2.D0)*(2.D0*A+5.D0)*(((3CORA1069
     562.D0*A+3013.D0)*A+8436.D0)*A+1890.D0)*Q*U+A**2*(2.D0*A+1.D0)*(60.CORA1070
     6D0*(((2.D0*A+33.D0)*A+226.D0)*A+840.D0)-(A+2.D0)*(2.D0*A+5.D0)*((7CORA1071
     73.D0*A+822.D0)*A+3024.D0+(A+3.D0)*(12.D0*A+30.D0)*(2.D0*A+7.D0)*U)CORA1072
     8*U))*U+XX)/W                                                      CORA1073
      C(3)=B2+24.D0*Q*(2.D0*(60.D0*(((((8.D0*A+132.D0)*A+906.D0)*A+2133.CORA1074
     1D0)*A+2116.D0)*A+840.D0+(2.D0*A-3.D0)*(3.D0*Q+(A+36.D0)*A+47.D0)*QCORA1075
     2)-(A+2.D0)*(2.D0*A+5.D0)*((((112.D0*A+1218.D0)*A+3459.D0)*A+4242.DCORA1076
     30)*A+1764.D0+5.D0*(2.D0*A-3.D0)**2*Q-3.D0*(A+1.D0)*(A+3.D0)*(2.D0*CORA1077
     4A+3.D0)*(2.D0*A+5.D0)*(2.D0*A+7.D0)*U)*U)+5.D0*(A+2.D0)*(30.D0*(((CORA1078
     5((8.D0*A+116.D0)*A+682.D0)*A+1405.D0)*A+966.D0)-(A-2.D0)*(2.D0*A-3CORA1079
     6.D0)*Q)*F-(A+2.D0)*(2.D0*A+5.D0)*((A+3.D0)*(2.D0*A+3.D0)*(37.D0*A+CORA1080
     7217.D0)*U*F+6.D0*(6.D0*((((4.D0*A+40.D0)*A+151.D0)*A+94.D0)*A+84.DCORA1081
     80)-2.D0*((24.D0*A+186.D0)*A+477.D0)*Q+(2.D0*A+3.D0)*(2.D0*A+5.D0)*CORA1082
     9(2.D0*(A+1.D0)*(A+3.D0)*(2.D0*A+7.D0)*U-7.D0*(A+3.D0)*((11.D0*A+51CORA1083
     A.D0)*F+4.D0*(2.D0*A+7.D0)*(A+1.D0)*(A+3.D0)/W)/W))/W))/W)/W       CORA1084
      C(4)=B4+6.D0*((240.D0*(A-2.D0)*(2.D0*A-3.D0)*(9.D0*Q+(8.D0*A+118.DCORA1085
     10)*A+141.D0)*Q/(2.D0*A+3.D0)-60.D0*(A**2-4.D0)*(2.D0*A-3.D0)*(3.D0CORA1086
     2*A-5.D0)*Q*U-(A+1.D0)*(2.D0*A+1.D0)*(480.D0*(((2.D0*A+33.D0)*A+226CORA1087
     3.D0)*A+840.D0)+(A+2.D0)*((A+3.D0)*(2.D0*A+5.D0)*((233.D0*A+1798.D0CORA1088
     4)*A+2520.D0)*U**2-4.D0*(((262.D0*A+3523.D0)*A+16926.D0)*A+17640.D0CORA1089
     5)*U)))*F-4.D0*(60.D0*(7.D0*(((((4.D0*A+60.D0)*A+291.D0)*A+969.D0)*CORA1090
     6A+1409.D0)*A+690.D0)+(A-2.D0)*(2.D0*A-3.D0)*(2.D0*A-5.D0)*Q)*Q-(A+CORA1091
     71.D0)*(2.D0*A+3.D0)*(60.D0*A*(2.D0*A+1.D0)*(((2.D0*A+33.D0)*A+226.CORA1092
     8D0)*A+840.D0)+(A+2.D0)*(2.D0*A+5.D0)*(5.D0*((58.D0*A+473.D0)*A+130CORA1093
     92.D0)*Q-A*(2.D0*A+1.D0)*((73.D0*A+822.D0)*A+3024.D0+6.D0*(A+3.D0)*CORA1094
     A(2.D0*A+5.D0)*(2.D0*A+7.D0)*U))*U)+5.D0*(A+2.D0)*(2.D0*A+3.D0)*(12CORA1095
     B.D0*(((22.D0*A+273.D0)*A+1001.D0)*A+1590.D0)*Q*F-(A+1.D0)*(12.D0*(CORA1096
     C2.D0*A+1.D0)*(((2.D0*A+33.D0)*A+226.D0)*A+840.D0)*F+(A+2.D0)*(2.D0CORA1097
     D*A+5.D0)*(5.D0*(A+3.D0)*(2.D0*A+1.D0)*(17.D0*A+84.D0)*U*F-6.D0*(15CORA1098
     E.D0*((20.D0*A+164.D0)*A+357.D0)*Q-(2.D0*A+1.D0)*(A*((166.D0*A+1399CORA1099
     F.D0)*A+3108.D0)+(A+3.D0)*(2.D0*A+5.D0)*(A*(4.D0*A+14.D0)*U-7.D0*((CORA1100
     G19.D0*A+84.D0)*F+4.D0*A*(2.D0*A+7.D0)*(A+3.D0)/W)/W)))/W)))/W)/W)/CORA1101
     HW                                                                 CORA1102
   45 A1=-2.D0*A**2*Y*B1*Z                                              CORA1103
      A2=Y*((2.D0*A+1.D0)*((2.D0*(A**2-A)**2*(1.D0+S**2)+Y**2*(A**2-A-.5CORA1104
     1D0))*B1-Y*(P*B2+Q*B3))+(4.D0*A-2.D0)*(A+1.D0)**2*P*Q*B4)*Z        CORA1105
      A3=-Y*((2.D0*A-1.D0)*((2.D0*(A**2+A)**2*(1.D0+S**2)+Y**2*(A**2+A-.CORA1106
     15D0))*B4-Y*(B2+B3))+(4.D0*A+2.D0)*(A-1.D0)**2*B1)*Z               CORA1107
      A4=2.D0*A**2*Y*B4*Z                                               CORA1108
      IF (X.EQ.0.D0) GO TO 48                                           CORA1109
      A1=A1+X*2.D0*P*((A*X-2.D0*F)*B2-2.D0*Q*(A+1.D0)*B4)               CORA1110
      A2=A2+X*P*((2.D0*Q*((2.D0*A+3.D0)*(A+1.D0)*F+((2.D0*A+3.D0)*A-4.D0CORA1111
     1)*E*S)-2.D0*P*(2.D0*A-3.D0)*(2.D0*A+1.D0)*F+(2.D0*A+1.D0)*((((2.D0CORA1112
     2*A-1.D0)*A-8.D0)*A+5.D0)*F-S*((A+1.D0)*((6.D0*A-9.D0)*A+1.D0)*E-S*CORA1113
     3((6.D0*A-7.D0)*(A**2-1.D0)*F-S*((((2.D0*A-5.D0)*A+2.D0)*A-1.D0)*E)CORA1114
     4))))*B2+2.D0*Q*(A+1.D0)*((2.D0*A+3.D0)*(Q+P)+(2.D0*A-1.D0)*(4.D0*ECORA1115
     5*F*S+(1.D0+S**2)*((2.D0*A-4.D0)*A-3.D0)))*B4)                     CORA1116
      A3=A3+X*((2.D0*P*((2.D0*A-3.D0)*(A-1.D0)*E*S+F*((2.D0*A-3.D0)*A-4.CORA1117
     1D0))-2.D0*Q*E*S*(2.D0*A+3.D0)*(2.D0*A-1.D0)-(2.D0*A-1.D0)*((((2.D0CORA1118
     2*A+5.D0)*A+2.D0)*A+1.D0)*F-S*((6.D0*A+7.D0)*(A**2-1.D0)*E-S*((A-1.CORA1119
     3D0)*((6.D0*A+9.D0)*A+1.D0)*F-S*((((2.D0*A+1.D0)*A-8.D0)*A-5.D0)*E)CORA1120
     4))))*B2+(-4.D0*P*Q*((2.D0*A+1.D0)*A+2.D0)-(2.D0*A-1.D0)*(2.D0*S*E*CORA1121
     5F*(2.D0*A+3.D0)*(Q+P+S**2+1.D0)-A**2*(((A+3.D0)*A+2.5D0)*(1.D0+S**CORA1122
     64)-S**2*((2.D0*A-2.D0)*A-7.D0))+A*(A-1.D0)*(2.D0*A+3.D0)*(1.D0+S**CORA1123
     72)*(P+Q)-(S**2-1.D0)*((2.D0*A+4.D0)*A+.5D0)*(Q-P)))*B4)           CORA1124
      A4=A4+X*2.D0*(((A-1.D0)*(P+Q)+Y**2)*B4+(2.D0*E*S-A*X)*B2)         CORA1125
   46 A4=A4+X*2.D0*((2.D0*F+A*X)*B3-2.D0*(A-1.D0)*B1)                   CORA1126
   47 A1=A1+X*2.D0*(((A+1.D0)*(Q+P)-Y**2)*B1-Q*(A*X+2.D0*E*S)*B3)       CORA1127
      A2=A2+X*((-4.D0*P*Q*(2.D0*A**2-A+2.D0)-(2.D0*A+1.D0)*(2.D0*S*E*F*(CORA1128
     12.D0*A-3.D0)*(Q+P+S**2+1.D0)+A**2*(((A-3.D0)*A+2.5D0)*(1.D0+S**4)-CORA1129
     2S**2*((2.D0*A+2.D0)*A-7.D0))+A*(A+1.D0)*(2.D0*A-3.D0)*(1.D0+S**2)*CORA1130
     3(P+Q)+(S**2-1.D0)*((2.D0*A-4.D0)*A+.5D0)*(Q-P)))*B1+Q*(2.D0*P*((2.CORA1131
     4D0*A+3.D0)*(A+1.D0)*E*S+F*((2.D0*A+3.D0)*A-4.D0))-2.D0*Q*E*S*(2.D0CORA1132
     5*A-3.D0)*(2.D0*A+1.D0)-(2.D0*A+1.D0)*((((2.D0*A-5.D0)*A+2.D0)*A-1.CORA1133
     6D0)*F-S*((6.D0*A-7.D0)*(A**2-1.D0)*E-S*((A+1.D0)*((6.D0*A-9.D0)*A+CORA1134
     71.D0)*F-S*((((2.D0*A-1.D0)*A-8.D0)*A+5.D0)*E)))))*B3)             CORA1135
      A3=A3+X*(2.D0*(A-1.D0)*((2.D0*A-3.D0)*(Q+P)+(2.D0*A+1.D0)*(4.D0*E*CORA1136
     1F*S+(1.D0+S**2)*((2.D0*A+4.D0)*A-3.D0)))*B1+(2.D0*Q*((2.D0*A-3.D0)CORA1137
     2*(A-1.D0)*F+((2.D0*A-3.D0)*A-4.D0)*E*S)-2.D0*P*(2.D0*A+3.D0)*(2.D0CORA1138
     3*A-1.D0)*F+(2.D0*A-1.D0)*((((2.D0*A+1.D0)*A-8.D0)*A-5.D0)*F-S*((A-CORA1139
     41.D0)*((6.D0*A+9.D0)*A+1.D0)*E-S*((6.D0*A+7.D0)*(A**2-1.D0)*F-S*((CORA1140
     5((2.D0*A+5.D0)*A+2.D0)*A+1.D0)*E)))))*B3)                         CORA1141
   48 B(1)=A1*DSQRT(((A-1.D0)**2+E**2)*((A-1.D0)**2+F**2))*(2.D0*A-3.D0)CORA1142
     1/(BD*A*(2.D0*A-1.D0))                                             CORA1143
      B(2)=A2/(A*S*BD*(2.D0*A+1.D0))                                    CORA1144
      B(3)=A3/(A*S*BD*(2.D0*A-1.D0))*DSQRT(P*Q)                         CORA1145
      B(4)=A4*DSQRT(P*Q*((A+1.D0)**2+E**2)*((A+1.D0)**2+F**2))*(2.D0*A+3CORA1146
     1.D0)/(BD*A*(2.D0*A+1.D0))                                         CORA1147
      IF (LT) RETURN                                                    CORA1148
      Z=-2.D0*BD*V*W*DSQRT(S)/DEN                                       CORA1149
      BD=A**2*BD*DSQRT(V*W)**3                                          CORA1150
      A1=A1*(A-1.D0)**2                                                 CORA1151
      A4=A4*(A+1.D0)**2                                                 CORA1152
      C(1)=C(1)/Z-(A+Y*W*(.5D0*A-1.D0)/(A-1.D0)**2)*(2.D0*A-1.D0)*A1/BD CORA1153
      C(2)=(C(2)/Z+W*(A1-P*A4)/BD)*DSQRT(Q)                             CORA1154
      C(3)=(C(3)/Z+W*(A1-Q*A4)/BD)*DSQRT(P)                             CORA1155
      C(4)=(C(4)/Z+(A+Y*W*(.5D0*A+1.D0)/(A+1.D0)**2)*(2.D0*A+1.D0)*A4/BDCORA1156
     1)*DSQRT(P*Q)                                                      CORA1157
      GO TO 70                                                          CORA1158
C FOR NEUTRONS ( COULOMB PARAMETER 0.).                                 CORA1159
   49 X=W**2                                                            CORA1160
      GO TO ( 50 , 51 , 54 , 57 , 61 , 65 ) , LQ                        CORA1161
   50 IF ((LL.EQ.1).OR.(U.EQ.0)) GO TO 73                               CORA1162
C MULTIPOLE LQ=1 L1=L2-1 (USELESS).                                     CORA1163
      B(2)=(U+2.D0-2.D0*A)/(DSQRT(S)*U)                                 CORA1164
      B(3)=DSQRT(S)*(2.D0*A+2.D0)/U                                     CORA1165
      IF (LT) RETURN                                                    CORA1166
      C(1)=DSQRT(S)/(U*X)                                               CORA1167
      C(4)=C(1)/S                                                       CORA1168
      RETURN                                                            CORA1169
   51 GO TO ( 52 , 73 , 53 ) , LL                                       CORA1170
C MULTIPOLE LQ=2 L1=L2.                                                 CORA1171
   52 B(2)=1.D0                                                         CORA1172
      RETURN                                                            CORA1173
C MULTIPOLE LQ=2 L1=L2-2.                                               CORA1174
   53 B(2)=(2.D0*A-1.D0)/(3.D0*S)                                       CORA1175
      B(3)=-(A+1.D0)/1.5D0                                              CORA1176
      IF (.NOT.LT) C(2)=-B(2)/(X*V)                                     CORA1177
      RETURN                                                            CORA1178
   54 GO TO ( 73 , 55 , 73 , 56 ) , LL                                  CORA1179
C MULTIPOLE LQ=3 L1=L2-1.                                               CORA1180
   55 B(2)=1.D0/(3.D0*DSQRT(S))                                         CORA1181
      B(3)=-S*B(2)                                                      CORA1182
      IF (.NOT.LT) C(2)=-B(2)/(X*V)                                     CORA1183
      GO TO 70                                                          CORA1184
C MULTIPOLE LQ=3 L1=L2-3.                                               CORA1185
   56 Y=15.D0*S*DSQRT(S)                                                CORA1186
      B(2)=(1.D0-2.D0*U*(A-1.D0))/Y                                     CORA1187
      B(3)=((2.D0*A+1.D0)*U-1.D0)*S/Y                                   CORA1188
      IF (LT) RETURN                                                    CORA1189
      C(1)=(6.D0*A-3.D0)/(Y*X**2*S)                                     CORA1190
      C(2)=(2.D0+U*(2.D0*A+1.D0)-(12.D0*A**2-3.D0)/X)/(Y*X*V)           CORA1191
      C(3)=-3.D0/(Y*X*W)                                                CORA1192
      C(4)=(6.D0*A+3.D0)/(Y*X**2)                                       CORA1193
      GO TO 70                                                          CORA1194
   57 GO TO ( 58 , 73 , 59 , 73 , 60 ) , LL                             CORA1195
C MULTIPOLE LQ=4 L1=L2.                                                 CORA1196
   58 B(2)=1.D0/(3.D0*A+6.D0)                                           CORA1197
      B(3)=-(U+2.D0)*B(2)/(2.D0*S)                                      CORA1198
      IF (LT) RETURN                                                    CORA1199
      C(2)=-B(2)/(2.D0*X*V)                                             CORA1200
      C(3)=C(2)/S                                                       CORA1201
      C(4)=3.D0*C(3)/W                                                  CORA1202
      GO TO 70                                                          CORA1203
C MULTIPOLE LQ=4 L1=L2-2.                                               CORA1204
   59 Y=15.D0*S*(A+2.D0)                                                CORA1205
      B(2)=-(U*(A-1.D0)-3.D0)/Y                                         CORA1206
      B(3)=((A+.5D0)*U-3.D0)*S/Y                                        CORA1207
      IF (LT) RETURN                                                    CORA1208
      C(1)=(3.D0*A+6.D0)/(Y*X**2*S)                                     CORA1209
      C(2)=-(3.D0-(2.D0*A+1.D0)*(U-(6.D0*A+12.D0)/X))/(2.D0*Y*X*V)      CORA1210
      C(3)=-1.5D0/(Y*X*W)                                               CORA1211
      C(4)=-(2.D0*A+1.D0)*C(3)/W                                        CORA1212
      GO TO 70                                                          CORA1213
C MULTIPOLE LQ=4 L1=L2-4.                                               CORA1214
   60 Y=210.D0*(A+2.D0)*S                                               CORA1215
      B(2)=(6.D0-2.D0*(A-1.D0)*U*(2.D0-(2.D0*A+3.D0)*U))/(Y*S)          CORA1216
      B(3)=-(6.D0-U*(4.D0*A-1.D0-U*(2.D0*A+3.D0)*(2.D0*A+1.D0)))/Y      CORA1217
      IF (LT) RETURN                                                    CORA1218
      C1=U-(10.D0*A-5.D0)/X                                             CORA1219
      C(1)=-(6.D0*A+12.D0)*(4.D0+(2.D0*A+3.D0)*C1)/(Y*X**2*S**2)        CORA1220
      C(2)=-(3.D0+(2.D0*A+10.D0)*U-(A+2.D0)*(108.D0*A-6.D0)/X+(2.D0*A+3.CORA1221
     1D0)*(2.D0*A+1.D0)*(U**2-(6.D0*A+12.D0)*C1/X))/(Y*X*V*S)           CORA1222
      C(3)=-(3.D0-(6.D0*A+9.D0)*(U-(10.D0*A+20.D0)/X))/(Y*X*V)          CORA1223
      C(4)=-(2.D0*A+1.D0)*C(3)/W-(30.D0*A+60.D0)/(Y*X**2*S)             CORA1224
      GO TO 70                                                          CORA1225
   61 GO TO ( 73 , 62 , 73 , 63 , 73 , 64 ) , LL                        CORA1226
C MULTIPOLE LQ=5 L1=L2-1.                                               CORA1227
   62 Y=60.D0*(A+2.D0)*(A+3.D0)*DSQRT(S)                                CORA1228
      B(2)=(16.D0-U*(2.D0*A-2.D0))/Y                                    CORA1229
      B(3)=-(16.D0-U*(2.D0*A-10.D0+U*(2.D0*A+1.D0)))/(Y*S)              CORA1230
      IF (LT) RETURN                                                    CORA1231
      C(1)=6.D0*(A+2.D0)/(S*Y*X**2)                                     CORA1232
      C(2)=-(8.D0-(2.D0*A+1.D0)*(U-6.D0*(A+2.D0)/X))/(Y*X*V)            CORA1233
      C(3)=-(8.D0+3.D0*U-30.D0*(A+2.D0)/X)/(Y*X*V*S)                    CORA1234
      C(4)=(6.D0*A-12.D0+(15.D0*U-(60.D0*A+30.D0)*(A+2.D0)/X)/S**2)/(Y*XCORA1235
     1**2)                                                              CORA1236
      GO TO 70                                                          CORA1237
C MULTIPOLE LQ=5 L1=L2-3.                                               CORA1238
   63 Y=420.D0*(A+2.D0)*(A+3.D0)*DSQRT(S)                               CORA1239
      B(2)=(48.D0-U*(2.D0*A-2.D0)*(9.D0-U*(2.D0*A+3.D0)))/(Y*S)         CORA1240
      B(3)=-(48.D0-U*(18.D0*A+6.D0-U*(2.D0*A+1.D0)*(2.D0*A+3.D0)))/Y    CORA1241
      IF (LT) RETURN                                                    CORA1242
      C1=U-(10.D0*A+30.D0)/X                                            CORA1243
      C(1)=(6.D0*A+12.D0)*(3.D0-(2.D0*A+3.D0)*C1)/(Y*X**2*S**2)         CORA1244
      C(2)=((24.D0*A+162.D0)*(A+2.D0)/X-24.D0+(12.D0*A-3.D0)*U-(2.D0*A+1CORA1245
     1.D0)*(2.D0*A+3.D0)*(U**2-(6.D0*A+12.D0)*C1/X))/(Y*X*S*V)          CORA1246
      C(3)=-(24.D0-(6.D0*A+9.D0)*(U-(10.D0*A+20.D0)/X))/(Y*X*V)         CORA1247
      C(4)=-(2.D0*A+1.D0)*C(3)/W-(30.D0*A+60.D0)/(Y*X**2*S)             CORA1248
      GO TO 70                                                          CORA1249
C MULTIPOLE LQ=5 L1=L2-5.                                               CORA1250
   64 Y=3780.D0*(A+2.D0)*(A+3.D0)*S*DSQRT(S)                            CORA1251
      B(2)=(48.D0-U*(2.D0*A-2.D0)*(15.D0-U*(6.D0*A+6.D0-U*(2.D0*A+3.D0)*CORA1252
     1(2.D0*A+5.D0))))/(Y*S)                                            CORA1253
      B(3)=-(48.D0-U*(30.D0*A-6.D0-U*(12.D0*A**2+12.D0*A-9.D0-U*(8.D0*A*CORA1254
     1*3+36.D0*A**2+46.D0*A+15.D0))))/Y                                 CORA1255
      IF (LT) RETURN                                                    CORA1256
      C1=U**2-(10.D0*A+30.D0)*(U-(14.D0*A-7.D0)/X)/X                    CORA1257
      C(1)=(6.D0*A+12.D0)*(3.D0+(6.D0*A+24.D0)*U-(A+3.D0)*(260.D0*A+110.CORA1258
     1D0)/X+(2.D0*A+5.D0)*(2.D0*A+3.D0)*C1)/(Y*X**2*S**2)               CORA1259
      C(2)=-(24.D0-(18.D0*A-9.D0)*U+(6.D0*A+12.D0)*(66.D0*A+183.D0)/X-(2CORA1260
     1.D0*A+3.D0)*(18.D0*U**2-(12.D0*A+24.D0)*((8.D0*A+29.D0)*U-(A+3.D0)CORA1261
     2*(200.D0*A-40.D0)/X)/X+(2.D0*A+5.D0)*(2.D0*A+1.D0)*(U**3-(6.D0*A+1CORA1262
     32.D0)*C1/X)))/(Y*X*V*S)                                           CORA1263
      C1=U**2-(10.D0*A+20.D0)*(U-(14.D0*A+42.D0)/X)/X                   CORA1264
      C(3)=-(24.D0-(12.D0*A+3.D0)*U+(6.D0*A+9.D0)*(2.D0*A+5.D0)*C1-(A+2.CORA1265
     1D0)*(360.D0*A+1170.D0)/X)/(Y*X*V)                                 CORA1266
      C(4)=(18.D0*A-36.D0+(6.D0*A+9.D0)*((6.D0*A+33.D0)*U+(2.D0*A+1.D0)*CORA1267
     1(2.D0*A+5.D0)*C1-(A+2.D0)*(260.D0*A+830.D0)/X))/(Y*X**2*S)        CORA1268
      GO TO 70                                                          CORA1269
   65 GO TO ( 66 , 73 , 67 , 73 , 68 , 73 , 69 ) , LL                   CORA1270
C MULTIPOLE LQ=6 L1=L2.                                                 CORA1271
   66 Y=120.D0*(A+2.D0)*(A+3.D0)*(A+4.D0)*S**2                          CORA1272
      B(2)=(32.D0+U*(32.D0-U*(2.D0*A-2.D0)))/Y                          CORA1273
      B(3)=-(32.D0+U*(48.D0-U*(4.D0*A-14.D0+U*(2.D0*A+1.D0))))/(Y*S)    CORA1274
      IF (LT) RETURN                                                    CORA1275
      C(1)=(A+2.D0)*(12.D0+6.D0*U-(60.D0*A+180.D0)/X)/(Y*X**2*S)        CORA1276
      C(2)=-(16.D0-U*(2.D0*A-12.D0+U*(2.D0*A+1.D0))+(6.D0*A+12.D0)*(2.D0CORA1277
     1*A-4.D0+(2.D0*A+1.D0)*(U-(10.D0*A+30.D0)/X))/X)/(Y*X*V)           CORA1278
      C(3)=-(16.D0+U*(2.D0*A+20.D0+3.D0*U)-(6.D0*A+12.D0)*(4.D0-2.D0*A+5CORA1279
     1.D0*U+(20.D0*A+10.D0)*(A+3.D0)/X)/X)/(Y*X*S*V)                    CORA1280
      C(4)=((12.D0*A-24.D0)*S**2+(6.D0*A+3.D0)*(U**2-(10.D0*A+20.D0)*(2.CORA1281
     1D0+U+(4.D0*A+2.D0)*(A+3.D0)/X)/X))/(Y*X**2*S**2)                  CORA1282
      RETURN                                                            CORA1283
C MULTIPOLE LQ=6 L1=L2-2.                                               CORA1284
   67 Y=840.D0*(A+2.D0)*(A+3.D0)*(A+4.D0)*S                             CORA1285
      B(2)=(160.D0-U*(2.D0*A-2.D0)*(16.D0-U*(2.D0*A+3.D0)))/Y           CORA1286
      B(3)=-(160.D0-U*(32.D0*A-112.D0-U*((4.D0*A-24.D0)*A-10.D0+U*(2.D0*CORA1287
     1A+3.D0)*(2.D0*A+1.D0))))/(Y*S)                                    CORA1288
      IF (LT) RETURN                                                    CORA1289
      C1=U-(10.D0*A+30.D0)/X                                            CORA1290
      C(1)=(60.D0-(12.D0*A+18.D0)*C1)*(A+2.D0)/(Y*X**2*S)               CORA1291
      C(2)=-(80.D0-(26.D0*A+4.D0)*U+(60.D0*A**2-240.D0)/X+(2.D0*A+1.D0)*CORA1292
     1(2.D0*A+3.D0)*(U**2-(6.D0*A+12.D0)*C1/X))/(Y*X*V)                 CORA1293
      C(3)=-(80.D0-U*(6.D0*A-36.D0)+60.D0*(A**2-4.D0)/X-(6.D0*A+9.D0)*(UCORA1294
     1**2-(10.D0*A+20.D0)*(U-(14.D0*A+42.D0)/X)/X))/(Y*X*V*S)           CORA1295
      C(4)=-(105.D0*(1.D0-(10.D0*A+20.D0)/X)-(60.D0*A-15.D0)*S**2+(6.D0*CORA1296
     1A+3.D0)*(2.D0*A+3.D0)*(U*S**2-(10.D0*A+20.D0)*(1.D0+U-(14.D0*A+42.CORA1297
     2D0)/X)/X))/(Y*X**2*S**2)                                          CORA1298
      GO TO 70                                                          CORA1299
C MULTIPOLE LQ=6 L1=L2-4.                                               CORA1300
   68 Y=7560.D0*(A+2.D0)*(A+3.D0)*(A+4.D0)*S                            CORA1301
      B(2)=(480.D0-U*(2.D0*A-2.D0)*(96.D0-U*(24.D0*A+33.D0-U*(2.D0*A+3.DCORA1302
     10)*(2.D0*A+5.D0))))/(Y*S)                                         CORA1303
      B(3)=-(480.D0-U*(192.D0*A+48.D0-U*(2.D0*A+3.D0)*(24.D0*A+6.D0-U*(2CORA1304
     1.D0*A+1.D0)*(2.D0*A+5.D0))))/Y                                    CORA1305
      IF (LT) RETURN                                                    CORA1306
      C1=(U**2-(10.D0*A+30.D0)*(U-(14.D0*A+56.D0)/X)/X)                 CORA1307
      C(1)=(6.D0*A+12.D0)*(30.D0-(12.D0*A+3.D0)*U-(A+3.D0)*(80.D0*A+470.CORA1308
     1D0)/X+(2.D0*A+3.D0)*(2.D0*A+5.D0)*C1)/(Y*X**2*S**2)               CORA1309
      C(2)=-(240.D0-U*(126.D0*A-36.D0)+180.D0*(A**2-4.D0)/X+(2.D0*A+3.D0CORA1310
     1)*((18.D0*A-9.D0)*U**2-(6.D0*A+12.D0)*((2.D0*A-49.D0)*U+(10.D0*A+3CORA1311
     20.D0)*(22.D0*A+109.D0)/X)/X-(2.D0*A+1.D0)*(2.D0*A+5.D0)*(U**3-(6.DCORA1312
     30*A+12.D0)*C1/X)))/(Y*X*W*S**2)                                   CORA1313
      C1=(2.D0*A+5.D0)*(U**2-(10.D0*A+20.D0)*(U-(14.D0*A+42.D0)/X)/X)   CORA1314
      C(3)=-(240.D0-(66.D0*A+84.D0)*U+180.D0*(A**2-4.D0)/X+(6.D0*A+9.D0)CORA1315
     1*C1)/(Y*X*V)                                                      CORA1316
      C(4)=((A-2.D0)*(180.D0-(72.D0*A+108.D0)*U)+(6.D0*A+9.D0)*((2.D0*A+CORA1317
     11.D0)*C1-(A+2.D0)*(80.D0*A+740.D0)/X))/(Y*X**2*S)                 CORA1318
      GO TO 70                                                          CORA1319
C MULTIPOLE LQ=6 L1=L2-6.                                               CORA1320
   69 Y=83160.D0*(A+2.D0)*(A+3.D0)*(A+4.D0)*S**2                        CORA1321
      B(2)=(480.D0-U*(2.D0*A-2.D0)*(144.D0-U*(54.D0*A+57.D0-U*(2.D0*A+5.CORA1322
     1D0)*(8.D0*A+6.D0-U*(2.D0*A+7.D0)*(2.D0*A+3.D0)))))/(Y*S)          CORA1323
      B(3)=-(480.D0-U*(288.D0*A-48.D0-U*(108.D0*A**2+120.D0*A-78.D0-U*(2CORA1324
     1.D0*A+3.D0)*(2.D0*A+5.D0)*(8.D0*A-5.D0-U*(2.D0*A+1.D0)*(2.D0*A+7.DCORA1325
     20)))))/Y                                                          CORA1326
      IF (LT) RETURN                                                    CORA1327
      C1=U**3-(10.D0*A+30.D0)*(U**2-(14.D0*A+56.D0)*(U-(18.D0*A-9.D0)/X)CORA1328
     1/X)/X                                                             CORA1329
      C(1)=(6.D0*A+12.D0)*(30.D0-(18.D0*A-3.D0)*U+(10.D0*A+30.D0)*(118.DCORA1330
     10*A+457.D0)/X-(2.D0*A+5.D0)*((4.D0*A+36.D0)*U**2-(10.D0*A+30.D0)*(CORA1331
     2(24.D0*A+106.D0)*U-(14.D0*A+56.D0)*(52.D0*A+6.D0)/X)/X+(2.D0*A+7.DCORA1332
     30)*(2.D0*A+3.D0)*C1))/(Y*X**2*S**2)                               CORA1333
      C(2)=-(240.D0-(174.D0*A-84.D0)*U+((72.D0*A+36.D0)*A-63.D0)*U**2+(1CORA1334
     180.D0*(A**2-4.D0)-(6.D0*A+12.D0)*(((136.D0*A+772.D0)*A+1377.D0)*U-CORA1335
     2(10.D0*A+30.D0)*((712.D0*A+3370.D0)*A+2193.D0)/X))/X-(2.D0*A+5.D0)CORA1336
     3*(2.D0*A+3.D0)*((2.D0*A-26.D0)*U**3+(6.D0*A+12.D0)*((14.D0*A+82.D0CORA1337
     4)*U**2-(10.D0*A+30.D0)*((38.D0*A+166.D0)*U-(14.D0*A+56.D0)*(70.D0*CORA1338
     5A-19.D0)/X)/X)/X-(2.D0*A+7.D0)*(2.D0*A+1.D0)*(U**4-6.D0*(A+2.D0)*CCORA1339
     61/X)))/(Y*X*V*S)                                                  CORA1340
      C1=U**3-(10.D0*A+20.D0)*(U**2-(14.D0*A+42.D0)*(U-(18.D0*A+72.D0)/XCORA1341
     1)/X)/X                                                            CORA1342
      C(3)=-(240.D0-(114.D0*A+36.D0)*U+180*(A**2-4.D0)/X+(6.D0*A+15.D0)*CORA1343
     1((6.D0*A-1.D0)*U**2+(10.D0*A+20.D0)*((10.D0*A+57.D0)*U-(14.D0*A+42CORA1344
     2.D0)*(34.D0*A+141.D0)/X)/X-(2.D0*A+7.D0)*(2.D0*A+3.D0)*C1))/(Y*X*VCORA1345
     3)                                                                 CORA1346
      C(4)=(180.D0*A-360.D0-(108.D0*A+72.D0)*(A-2.D0)*U+(60.D0*A+120.D0)CORA1347
     1*((118.D0*A+796.D0)*A+1401.D0)/X-(2.D0*A+5.D0)*(6.D0*A+9.D0)*((4.DCORA1348
     20*A+47.D0)*U**2-(10.D0*A+20.D0)*((24.D0*A+117.D0)*U-(14.D0*A+42.D0CORA1349
     3)*(52.D0*A+215.D0)/X)/X+(2.D0*A+7.D0)*(2.D0*A+1.D0)*C1))/(Y*X**2*SCORA1350
     4)                                                                 CORA1351
   70 IF (LL.EQ.L2-L1+1) RETURN                                         CORA1352
      C1=C(3)                                                           CORA1353
      C(3)=C(2)                                                         CORA1354
      C(2)=C1                                                           CORA1355
      RETURN                                                            CORA1356
   71 WRITE (MW,1000) LQ,LL                                             CORA1357
      RETURN                                                            CORA1358
   72 WRITE (MW,1001) LQ,LL                                             CORA1359
      RETURN                                                            CORA1360
   73 WRITE (MW,1002) LQ,LL                                             CORA1361
      RETURN                                                            CORA1362
 1000 FORMAT (' IN CORA: LQ =',I3,' TOO LARGE OR L2-L1+1=',I3,' OUT OF BCORA1363
     1OUNDS.')                                                          CORA1364
 1001 FORMAT (' IN CORA: COEFFICIENTS SUPPRESSED FOR LQ =',I3,' AND L1-LCORA1365
     12+1=',I3)                                                         CORA1366
 1002 FORMAT (' IN CORA: COEFFICIENTS NOT GIVEN BY THE METHOD FOR LQ =',CORA1367
     1I3,' AND L2-L1+1=',I3)                                            CORA1368
      END                                                               CORA1369
C 08/03/07                                                      ECIS06  INTI-000
      SUBROUTINE INTI(FAM,X,FR,GR,WRE,PAD,IPE,ISM,KAB,W,ITERM,NC,V,NVI,MINTI-001
     1C,NAT,AT,LMD,AG,NCIN,NNI,ITERR,LO)                                INTI-002
C  E. C. I. S. METHOD: SCHROEDINGER EQUATION DRIVING ROUTINE.           INTI-003
C  INTI CALLS INSH  TO SOLVE THE SINGLE HOMOGENEOUS EQUATIONS,          INTI-004
C             INSI  TO SOLVE THE SINGLE INHOMOGENEOUS EQUATIONS.        INTI-005
C  PADE APPROXIMANTS OF TYPE I MAY BE USED TO ACCELERATE THE CONVERGENCEINTI-006
C INPUT:     FAM(*,I):MATCHING VALUES FOR I=1 TO 6, CONSTANTS OF EACH   INTI-007
C                     EQUATION FOR I=7 TO 12.                           INTI-008
C            ISM:     NUMBER OF RADIAL POINTS.                          INTI-009
C            KAB:     MAXIMUM NUMBER OF COUPLED CHANNELS.               INTI-010
C            ITERM:   MAXIMUM NUMBER OF ITERATIONS AND DIM. OF PAD.     INTI-011
C            NC:      NUMBER OF COUPLED EQUATIONS.                      INTI-012
C            V:       REAL, IMAGINARY POTENTIALS AND COUPLINGS.         INTI-013
C            NVI:     ADDRESSES OF COUPLINGS.                           INTI-014
C            MC:      NUCLEAR STATE NUMBER, ANGULAR MOMENTA....         INTI-015
C            NAT,AT:  TABLE OF COUPLING COEFFICIENTS.                   INTI-016
C            LMD:     FIRST DIMENSION OF TABLES NAT AND AT.             INTI-017
C            AG:      COULOMB INTEGRALS FOR COULOMB CORRECTIONS.        INTI-018
C            NCIN:    NUMBER OF SOLUTIONS.                              INTI-019
C            LO(I):   LOGICAL CONTROLS:                                 INTI-020
C               LO(22) =.TRUE. NO USE OF PADE APPROXIMANTS.             INTI-021
C               LO(23) =.TRUE. NO USE OF PADE AND SHIFT TO USUAL COUPLEDINTI-022
C                              EQUATIONS WHEN THERE IS NO CONVERGENCE.  INTI-023
C               LO(29) =.TRUE. NO DIAGONAL TERMS IN SECOND MEMBER.      INTI-024
C               LO(30) =.TRUE. PURE DWBA CALCULATION.                   INTI-025
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     INTI-026
C               LO(53) =.TRUE. OUTPUT OF THE NUMBER OF ITERATIONS.      INTI-027
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   INTI-028
C               LO(104)=.TRUE. CONVERGENCE IS OBTAINED IN THE ITERATION.INTI-029
C               LO(106)=.TRUE. WHEN THE ITERATION IS NOT THE LAST ONE   INTI-030
C                              ALLOWED.                                 INTI-031
C               LO(107)=.TRUE. ALL THE COUPLINGS CALCULATED BEFOREHAND. INTI-032
C               LO(110)=.TRUE. DERIVATIVES ARE NEEDED.                  INTI-033
C               LO(121)=.TRUE. OPTICAL MODEL WITHOUT COUPLING.          INTI-034
C OUTPUT:    FAM(*,I):SCATTERING COEFFICIENTS FOR I>9.                  INTI-035
C            NNI:     NUMBER OF EQUATIONS WITH NEGLIGIBLE INHOMOGENEOUS INTI-036
C                     TERM.                                             INTI-037
C            ITERR:   LARGEST NUMBER OF ITERATIONS DONE FOR THIS J.     INTI-038
C WORKING AREAS:                                                        INTI-039
C            X:       USED IN INSH AND INSI.                            INTI-040
C            FR:      SOLUTIONS OF HOMOGENEOUS EQUATIONS.               INTI-041
C            GR:      SOLUTIONS OF COUPLED EQUATIONS.                   INTI-042
C            WRE:     REAL/IMAGINARY INHOMOGENEOUS TERM.                INTI-043
C            PAD:     PADE APPROXIMANTS.                                INTI-044
C            IPE(I):  FIRST NON NEGLIGIBLE POINT OF UNCOUPLED FUNCTIONS INTI-045
C                     FOR I=1 TO NC, OF COUPLED FUNCTIONS FOR I>NC.     INTI-046
C            W:       FREE PART OF THE STORAGE FOR COUPLINGS            INTI-047
C                                                                       INTI-048
C FOR THE COMMON  /CONVE/ SEE CALX.                                     INTI-049
C FOR THE COMMON  /POTE2/ SEE REDM.                                     INTI-050
C                                                                       INTI-051
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     INTI-052
C  BJM:       CONVERGENCE COEFFICIENT OF IMAGINARY POTENTIAL.           INTI-053
C   USED:     BJM.                                                      INTI-054
C                                                                       INTI-055
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     INTI-056
C  ITY(2):    STARTING ADDRESS OF IMAGINARY CENTRAL POTENTIAL.          INTI-057
C  ITY(9):    STARTING ADDRESS OF COULOMB CENTRAL POTENTIAL.            INTI-058
C   USED:     ITY(2),ITY(9).                                            INTI-059
C                                                                       INTI-060
C***********************************************************************INTI-061
      IMPLICIT REAL*8 (A-H,O-Z)                                         INTI-062
      LOGICAL LO(150)                                                   INTI-063
      DIMENSION FAM(KAB,*),X(*),FR(ISM,4,*),GR(2,ISM,*),WRE(2,*),PAD(2,IINTI-064
     1TERM,*),IPE(*),W(ISM,*),V(ISM,*),NVI(KAB,KAB,4),MC(KAB,6),NAT(2*LMINTI-065
     2D,*),AT(LMD,*),AG(KAB,KAB,4),Z(4),Y(2)                            INTI-066
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       INTI-067
      COMMON /INOUT/ MR,MW,MS                                           INTI-068
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         INTI-069
C COMPUTE ALL COUPLING POTENTIALS AND SOLVE ALL HOMOGENEOUS EQUATIONS.  INTI-070
      DO 5 I=1,NC                                                       INTI-071
      I1=MC(I,4)                                                        INTI-072
      IF (I1.LT.0) GO TO 1                                              INTI-073
      CALL INSH(FR(1,1,I),I,I1,KT,FAM,X,KAB,ISM,V,NAT,AT,LMD,NVI,LO)    INTI-074
      IPE(I)=KT                                                         INTI-075
      GO TO 4                                                           INTI-076
    1 I1=-I1                                                            INTI-077
      IF (I.EQ.I1) GO TO 4                                              INTI-078
      DO 3 J=1,4                                                        INTI-079
      DO 2 IS=1,ISM                                                     INTI-080
    2 FR(IS,J,I)=FR(IS,J,I1)                                            INTI-081
    3 CONTINUE                                                          INTI-082
      IPE(I)=IPE(I1)                                                    INTI-083
    4 IF (LO(57)) WRITE (MW,1000) FAM(I,9),FAM(I,10),I,IPE(I)           INTI-084
    5 CONTINUE                                                          INTI-085
      IF ((.NOT.LO(107)).OR.LO(121)) GO TO 24                           INTI-086
      IVV=0                                                             INTI-087
C CALCULATION OF THE NON DIAGONAL COUPLING POTENTIALS.                  INTI-088
      DO 23 IC=1,NC                                                     INTI-089
      DO 19 IP=1,NC                                                     INTI-090
      K1=NVI(IP,IC,1)                                                   INTI-091
      K2=NVI(IP,IC,2)                                                   INTI-092
      K3=NVI(IP,IC,3)                                                   INTI-093
      IF (K2.EQ.K3.AND.IP.LT.IC) GO TO 17                               INTI-094
      DO 6 J=1,4                                                        INTI-095
    6 NVI(IP,IC,J)=0                                                    INTI-096
C NON DERIVATIVE COUPLING POTENTIALS FOR IK=1.                          INTI-097
C DERIVATIVE COUPLING POTENTIALS FOR IK=3.                              INTI-098
      DO 16 IK=1,3,2                                                    INTI-099
      IF (K1.GT.K2) GO TO 15                                            INTI-100
      IF (LO(29).AND.(IC.EQ.IP)) GO TO 15                               INTI-101
      IVV=IVV+1                                                         INTI-102
      NVI(IP,IC,IK)=IVV                                                 INTI-103
      NIMA=0                                                            INTI-104
      DO 7 IS=1,ISM                                                     INTI-105
    7 W(IS,IVV)=0.D0                                                    INTI-106
      DO 11 K=K1,K2                                                     INTI-107
      IF (AT(2,K).EQ.0.D0) GO TO 9                                      INTI-108
      KT=NAT(1,K)                                                       INTI-109
      IF (NAT(2,K).NE.0) NIMA=NIMA+1                                    INTI-110
      DO 8 IS=1,ISM                                                     INTI-111
    8 W(IS,IVV)=W(IS,IVV)+AT(2,K)*V(IS,KT)                              INTI-112
    9 IF (.NOT.LO(133)) GO TO 11                                        INTI-113
      IF (AT(3,K).EQ.0.D0) GO TO 11                                     INTI-114
      KT=NAT(1,K)+ITY(9)                                                INTI-115
      DO 10 IS=1,ISM                                                    INTI-116
   10 W(IS,IVV)=W(IS,IVV)+AT(3,K)*V(IS,KT)                              INTI-117
   11 CONTINUE                                                          INTI-118
      IF (NIMA.EQ.0) GO TO 15                                           INTI-119
      IVV=IVV+1                                                         INTI-120
      NVI(IP,IC,IK+1)=IVV                                               INTI-121
      DO 12 IS=1,ISM                                                    INTI-122
   12 W(IS,IVV)=0.D0                                                    INTI-123
      DO 14 K=K1,K2                                                     INTI-124
      IF (NAT(2,K).EQ.0) GO TO 14                                       INTI-125
      KT=NAT(2,K)+ITY(2)                                                INTI-126
      DO 13 IS=1,ISM                                                    INTI-127
   13 W(IS,IVV)=W(IS,IVV)+AT(2,K)*V(IS,KT)                              INTI-128
   14 CONTINUE                                                          INTI-129
C DERIVATIVE COUPLING POTENTIALS.                                       INTI-130
   15 K1=K2+1                                                           INTI-131
   16 K2=K3                                                             INTI-132
      GO TO 19                                                          INTI-133
C SYMMETRISATION OF THE TABLE.                                          INTI-134
   17 DO 18 K=1,4                                                       INTI-135
   18 NVI(IP,IC,K)=NVI(IC,IP,K)                                         INTI-136
   19 CONTINUE                                                          INTI-137
C CORRECTION TO AN INCREASE OF THE IMAGINARY POTENTIAL.                 INTI-138
      IF (BJM.EQ.0.D0) GO TO 23                                         INTI-139
      I1=MC(IC,4)+ITY(2)                                                INTI-140
      IF (NVI(IC,IC,2).EQ.0) GO TO 21                                   INTI-141
      K=NVI(IC,IC,2)                                                    INTI-142
      DO 20 IS=1,ISM                                                    INTI-143
   20 W(IS,K)=W(IS,K)-FAM(IC,7)*V(IS,I1)*BJM                            INTI-144
      GO TO 23                                                          INTI-145
   21 IVV=IVV+1                                                         INTI-146
      NVI(IC,IC,2)=IVV                                                  INTI-147
      DO 22 IS=1,ISM                                                    INTI-148
   22 W(IS,IVV)=-FAM(IC,7)*V(IS,I1)*BJM                                 INTI-149
   23 CONTINUE                                                          INTI-150
   24 NNI=0                                                             INTI-151
C LOOP ON SOLUTIONS.                                                    INTI-152
      DO 38 NCI=1,NCIN                                                  INTI-153
      NCI1=NCI+10                                                       INTI-154
      NCI2=NCI1+NCIN                                                    INTI-155
C SET THE ZERO'S ORDER SOLUTION.                                        INTI-156
      DO 25 IC=1,NC                                                     INTI-157
      IPE(IC+NC)=ISM+1                                                  INTI-158
      FAM(IC,NCI1)=0.D0                                                 INTI-159
   25 FAM(IC,NCI2)=0.D0                                                 INTI-160
      FAM(NCI,NCI1)=FAM(NCI,9)                                          INTI-161
      FAM(NCI,NCI2)=FAM(NCI,10)                                         INTI-162
      IF ((IPE(NCI).GT.ISM-3).OR.LO(121)) GO TO 38                      INTI-163
      DO 26 IS=1,ISM                                                    INTI-164
      GR(1,IS,NCI)=FR(IS,1,NCI)                                         INTI-165
   26 GR(2,IS,NCI)=FR(IS,2,NCI)                                         INTI-166
      IPE(NCI+NC)=IPE(NCI)                                              INTI-167
C DERIVE THE ZERO'S ORDER EQUATION.                                     INTI-168
      IF (LO(110)) CALL INSI(WRE,GR,GR(1,1,NC+1),FR,FAM,X,PAD,PAD,1,KAB,INTI-169
     1ISM,IPE,NCI,V,W,NAT,AT,LMD,NVI,NC,Y,Y,MC,LO,.TRUE.,Z)             INTI-170
      AMAX=0.D0                                                         INTI-171
C E. C. I. S. LOOP.                                                     INTI-172
      DO 36 KITER=1,ITERM                                               INTI-173
      ITERR=MAX0(ITERR,KITER)                                           INTI-174
      LO(104)=.TRUE.                                                    INTI-175
      LO(106)=((KITER.NE.ITERM).AND.(AMAX.LT.1.D10)).OR.LO(23)          INTI-176
      IF (AMAX.GT.1.D10) WRITE (MW,1001) AMAX,KITER                     INTI-177
      DO 35 IC=1,NC                                                     INTI-178
      I=MOD(IC+NCI-1,NC)+1                                              INTI-179
C COMPUTE SECOND MEMBERS AND SOLVE THE INHOMOGENEOUS EQUATIONS.         INTI-180
      DO 27 J=1,4                                                       INTI-181
   27 Z(J)=0.D0                                                         INTI-182
      IF (.NOT.LO(44)) GO TO 32                                         INTI-183
      DO 30 J=1,NC                                                      INTI-184
      IF ((LO(29).AND.(I.EQ.J)).OR.(IPE(J+NC).GE.ISM)) GO TO 30         INTI-185
C ORDER IN FG   F(EI)*F(EF),G(EI)*F(EF),F(EI)*G(EF),G(EI)*G(EF).        INTI-186
      IF (LO(22)) GO TO 28                                              INTI-187
      IJ=KITER                                                          INTI-188
      IF (1+MOD(J+NC-NCI-1,NC).GE.IC) IJ=IJ-1                           INTI-189
      IF (IJ.EQ.0) GO TO 28                                             INTI-190
      Y(1)=PAD(1,IJ,J)                                                  INTI-191
      Y(2)=PAD(2,IJ,J)                                                  INTI-192
      GO TO 29                                                          INTI-193
   28 Y(1)=FAM(J,NCI1)                                                  INTI-194
      Y(2)=FAM(J,NCI2)                                                  INTI-195
   29 Z(1)=Z(1)+Y(1)*AG(I,J,3)-Y(2)*AG(I,J,1)                           INTI-196
      Z(2)=Z(2)+Y(1)*AG(I,J,1)+Y(2)*AG(I,J,3)                           INTI-197
      Z(3)=Z(3)+Y(1)*AG(I,J,4)-Y(2)*AG(I,J,2)                           INTI-198
      Z(4)=Z(4)+Y(1)*AG(I,J,2)+Y(2)*AG(I,J,4)                           INTI-199
   30 CONTINUE                                                          INTI-200
      IF (I.EQ.NCI) GO TO 31                                            INTI-201
      Z(1)=Z(1)+AG(I,NCI,1)                                             INTI-202
      Z(3)=Z(3)+AG(I,NCI,2)                                             INTI-203
   31 Z(3)=Z(3)-Z(2)                                                    INTI-204
      Z(4)=Z(4)+Z(1)                                                    INTI-205
      Z(1)=Z(1)+FAM(I,9)*Z(3)-FAM(I,10)*Z(4)                            INTI-206
      Z(2)=Z(2)+Z(3)*FAM(I,10)+Z(4)*FAM(I,9)                            INTI-207
   32 IF (I.NE.NCI) GO TO 33                                            INTI-208
      Z(1)=Z(1)-FAM(I,9)                                                INTI-209
      Z(2)=Z(2)-FAM(I,10)                                               INTI-210
      Z(3)=Z(3)-1.D0                                                    INTI-211
   33 IF (LO(23).AND.(.NOT.LO(106))) LO(104)=.TRUE.                     INTI-212
      CALL INSI(WRE,GR,GR(1,1,NC+1),FR,FAM,X,PAD(1,1,I),PAD(1,1,NC+1),KIINTI-213
     1TER,KAB,ISM,IPE(NC+1),I,V,W,NAT,AT,LMD,NVI,NC,FAM(I,NCI1),FAM(I,NCINTI-214
     2I2),MC,LO,.FALSE.,Z)                                              INTI-215
      IF (IPE(I+NC).GE.ISM) GO TO 34                                    INTI-216
      AMAX=DMAX1(AMAX,DABS(FAM(I,NCI1))+DABS(FAM(I,NCI2)))              INTI-217
      IF (I.NE.NCI.AND.LO(30)) IPE(I+NC)=ISM+1                          INTI-218
      GO TO 35                                                          INTI-219
   34 FAM(I,NCI1)=-Z(1)                                                 INTI-220
      FAM(I,NCI2)=-Z(2)                                                 INTI-221
      IF (LO(57)) WRITE (MW,1002)                                       INTI-222
      IF (KITER.EQ.1.AND.(.NOT.LO(44))) NNI=NNI+1                       INTI-223
      IF (I.EQ.NCI) IPE(NCI+NC)=IPE(NCI)                                INTI-224
   35 CONTINUE                                                          INTI-225
      IF (LO(104).OR.(AMAX.GT.1.D10.AND.LO(23))) GO TO 37               INTI-226
   36 CONTINUE                                                          INTI-227
      KITER=MIN0(KITER,ITERM)                                           INTI-228
   37 IF (LO(53)) WRITE (MW,1003) KITER                                 INTI-229
   38 CONTINUE                                                          INTI-230
      NNI=NNI/NCIN                                                      INTI-231
      RETURN                                                            INTI-232
 1000 FORMAT (2D30.15,5X,2I5)                                           INTI-233
 1001 FORMAT (' MAXIMUM',D15.6,' OBTAINED IN PREVIOUS ITERATION. LAST ONINTI-234
     1E IS',I3)                                                         INTI-235
 1002 FORMAT (5X,'THE INHOMOGENEOUS TERM IS NEGLECTED.')                INTI-236
 1003 FORMAT (5X,I5,' ITERATIONS.')                                     INTI-237
      END                                                               INTI-238
C 28/02/07                                                      ECIS06  INSH-000
      SUBROUTINE INSH(P,IC,I1,KT,FAM,X,KAB,ISM,V,NAT,AT,LMD,NVI,LO)     INSH-001
C  E. C. I. S. METHOD: INTEGRATION OF A SINGLE HOMOGENEOUS EQUATION BY  INSH-002
C  THE NUMEROV METHOD       - SCHROEDINGER EQUATION -                   INSH-003
C INPUT:     IC:      CHANNEL NUMBER OF THE EQUATION.                   INSH-004
C            FAM(*,I):MATCHING VALUES FOR I=1 TO 4,                     INSH-005
C                     WAVE NUMBER FOR I=6,                              INSH-006
C                     CONSTANTS OF THIS EQUATION FOR I=7 TO 12.         INSH-007
C            KAB:     MAXIMUM NUMBER OF COUPLED CHANNELS.               INSH-008
C            ISM:     NUMBER OF RADIAL POINTS.                          INSH-009
C            V:       REAL, IMAGINARY POTENTIALS AND COUPLINGS.         INSH-010
C            NAT,AT:  COUPLING COEFFICIENTS.                            INSH-011
C            LMD:     FIRST DIMENSION OF TABLES NAT AND AT.             INSH-012
C            NVI:     TABLE OF ADDRESSES IN NAT,AT.                     INSH-013
C            LO(I):   LOGICAL CONTROLS:                                 INSH-014
C               LO(26) =.TRUE. INTEGRATION STABILISED FOR LONG RANGE    INSH-015
C                              CONSTANT POTENTIAL.                      INSH-016
C               LO(27) =.TRUE. NUMEROV'S METHOD FOR SINGLE EQUATIONS.   INSH-017
C               LO(29) =.TRUE. NO DIAGONAL TERMS IN SECOND MEMBER.      INSH-018
C               LO(30) =.TRUE. PURE DWBA CALCULATION.                   INSH-019
C               LO(101)=.TRUE. THERE IS A REAL SPIN-ORBIT POTENTIAL.    INSH-020
C               LO(102)=.TRUE. THERE IS AN IMAGINARY SPIN-ORBIT         INSH-021
C                              POTENTIAL.                               INSH-022
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. INSH-023
C               LO(121)=.TRUE. OPTICAL MODEL WITHOUT COUPLING.          INSH-024
C               LO(129)=.TRUE. REAL SPIN-ORBIT OR DIRAC EQUATION.       INSH-025
C               LO(130)=.TRUE. IMAGINARY SPIN-ORBIT OR DIRAC EQUATION.  INSH-026
C               LO(133)=.TRUE. STORE SCALAR AND COULOMB POTENTIAL       INSH-027
C                              INDEPENDENTLY.                           INSH-028
C OUTPUT:    P(*,I):  REAL/IMAGINARY REGULAR SOLUTION FOR I=1 AND 2,    INSH-029
C                     REAL/IMAGINARY IRREGULAR SOLUTION FOR I=3 AND 4.  INSH-030
C            FAM(*,I):REAL/IMAGINARY PART OF ZERO'S ORDER SCATTERING    INSH-031
C                     COEFFICIENTS FOR I=9 AND 10.                      INSH-032
C            KT:    THE SOLUTION IS NEGLIGIBLE FOR THE FIRST KT POINTS. INSH-033
C WORKING AREA:                                                         INSH-034
C            X:     FOR THE INTEGRATION.                                INSH-035
C                                                                       INSH-036
C FOR THE COMMON  /CONVE/ SEE CALX.                                     INSH-037
C FOR THE COMMON  /POTE2/ SEE REDM.                                     INSH-038
C                                                                       INSH-039
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     INSH-040
C  BJM:       CONVERGENCE COEFFICIENT OF IMAGINARY POTENTIAL.           INSH-041
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         INSH-042
C   USED:     BJM,ACONV.                                                INSH-043
C                                                                       INSH-044
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     INSH-045
C  ITY(2):    STARTING ADDRESS OF IMAGINARY CENTRAL POTENTIAL.          INSH-046
C  ITY(3):    STARTING ADDRESS OF REAL SPIN-ORBIT POTENTIAL.            INSH-047
C  ITY(4):    STARTING ADDRESS OF IMAGINARY SPIN-ORBIT POTENTIAL.       INSH-048
C  ITY(9):    STARTING ADDRESS OF COULOMB CENTRAL POTENTIAL.            INSH-049
C  ITY(10):   STARTING ADDRESS OF COULOMB SPIN-ORBIT POTENTIAL.         INSH-050
C   USED:     ITY(2),ITY(3),ITY(4),ITY(9),ITY(10).                      INSH-051
C                                                                       INSH-052
C***********************************************************************INSH-053
      IMPLICIT REAL*8 (A-H,O-Z)                                         INSH-054
      LOGICAL LO(150)                                                   INSH-055
      DIMENSION P(ISM,4),FAM(KAB,12),X(2,*),V(ISM,*),NAT(2*LMD,*),AT(LMDINSH-056
     1,*),NVI(KAB,KAB,2)                                                INSH-057
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       INSH-058
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         INSH-059
      BCONV=ACONV                                                       INSH-060
C FOR CLOSED CHANNELS WHEN GREEN'S FUNCTION IS USED.                    INSH-061
      IF (FAM(IC,8).LT.0.D0) BCONV=1.D-15                               INSH-062
C COMPUTATION OF THE REGULAR SOLUTION.                                  INSH-063
      I2=I1+ITY(2)                                                      INSH-064
      DO 1 IS=1,ISM                                                     INSH-065
      X(1,IS+2)=FAM(IC,8)-FAM(IC,10)/DFLOAT(IS*IS)+FAM(IC,7)*V(IS,I1)   INSH-066
    1 X(2,IS+2)=FAM(IC,7)*V(IS,I2)*(1.D0+BJM)                           INSH-067
      IF ((.NOT.LO(101)).OR.(FAM(IC,9).EQ.0.D0))  GO TO 4               INSH-068
      I2=I1+ITY(3)                                                      INSH-069
      DO 2 IS=1,ISM                                                     INSH-070
    2 X(1,IS+2)=X(1,IS+2)+FAM(IC,9)*V(IS,I2)                            INSH-071
      IF (.NOT.LO(102))  GO TO 4                                        INSH-072
      I2=I1+ITY(4)                                                      INSH-073
      DO 3 IS=1,ISM                                                     INSH-074
    3 X(2,IS+2)=X(2,IS+2)+FAM(IC,9)*V(IS,I2)                            INSH-075
    4 IF (.NOT.LO(133)) GO TO 8                                         INSH-076
      IF (FAM(IC,11).EQ.0.D0) GO TO 6                                   INSH-077
      I2=I1+ITY(9)                                                      INSH-078
      DO 5 IS=1,ISM                                                     INSH-079
    5 X(1,IS+2)=X(1,IS+2)+FAM(IC,11)*V(IS,I2)                           INSH-080
    6 IF (FAM(IC,12).EQ.0.D0) GO TO 8                                   INSH-081
      I2=I1+ITY(10)                                                     INSH-082
      DO 7 IS=1,ISM                                                     INSH-083
    7 X(1,IS+2)=X(1,IS+2)+FAM(IC,12)*V(IS,I2)                           INSH-084
    8 IF (.NOT.LO(29)) GO TO 14                                         INSH-085
      K1=NVI(IC,IC,1)                                                   INSH-086
      K2=NVI(IC,IC,2)                                                   INSH-087
      IF (K1.GT.K2) GO TO 14                                            INSH-088
      DO 13 K=K1,K2                                                     INSH-089
      KT=NAT(1,K)                                                       INSH-090
      DO 9 IS=1,ISM                                                     INSH-091
    9 X(1,IS+2)=X(1,IS+2)+AT(2,K)*V(IS,KT)                              INSH-092
      IF (NAT(2,K).EQ.0) GO TO 11                                       INSH-093
      KT=NAT(2,K)+ITY(2)                                                INSH-094
      DO 10 IS=1,ISM                                                    INSH-095
   10 X(2,IS+2)=X(2,IS+2)+AT(2,K)*V(IS,KT)                              INSH-096
   11 IF (.NOT.LO(133)) GO TO 13                                        INSH-097
      IF (AT(3,K).EQ.0.D0) GO TO 13                                     INSH-098
      KT=NAT(1,K)+ITY(9)                                                INSH-099
      DO 12 IS=1,ISM                                                    INSH-100
   12 X(1,IS+2)=X(1,IS+2)+AT(3,K)*V(IS,KT)                              INSH-101
   13 CONTINUE                                                          INSH-102
   14 IF (LO(27)) GO TO 16                                              INSH-103
C MODIFIED NUMEROV METHOD.                                              INSH-104
      DO 15 IS=1,ISM                                                    INSH-105
      A=X(1,IS+2)**2-X(2,IS+2)**2                                       INSH-106
      IF (LO(26)) A=A-X(1,IS+2)**3/30.D0                                INSH-107
      X(2,IS+2)=X(2,IS+2)*(1.D0-X(1,IS+2)/6.D0)                         INSH-108
   15 X(1,IS+2)=X(1,IS+2)-A/12.D0                                       INSH-109
      GO TO 18                                                          INSH-110
C NUMEROV METHOD.                                                       INSH-111
   16 DO 17 IS=1,ISM                                                    INSH-112
      B=(12.D0+X(1,IS+2))**2+X(2,IS+2)**2                               INSH-113
      A=12.D0*(X(1,IS+2)*(12.D0+X(1,IS+2))+X(2,IS+2)**2)/B              INSH-114
      IF (LO(26)) A=A+X(1,IS+2)**3/240.D0                               INSH-115
      X(1,IS+2)=A                                                       INSH-116
   17 X(2,IS+2)=144.D0*X(2,IS+2)/B                                      INSH-117
   18 X(1,1)=0.D0                                                       INSH-118
      X(2,1)=0.D0                                                       INSH-119
      X(1,2)=1.D-15                                                     INSH-120
      X(2,2)=0.D0                                                       INSH-121
      DO 20 IS=1,ISM                                                    INSH-122
      P(IS,3)=X(1,IS+2)                                                 INSH-123
      P(IS,4)=X(2,IS+2)                                                 INSH-124
      HX=X(1,IS+1)*X(1,IS+2)-X(2,IS+1)*X(2,IS+2)                        INSH-125
      HY=X(2,IS+1)*X(1,IS+2)+X(1,IS+1)*X(2,IS+2)                        INSH-126
      X(1,IS+2)=X(1,IS+1)+X(1,IS+1)-X(1,IS)-HX                          INSH-127
      X(2,IS+2)=X(2,IS+1)+X(2,IS+1)-X(2,IS)-HY                          INSH-128
      IF (DABS(X(1,IS+2)).LT.1.D15) GO TO 20                            INSH-129
C  RENORMALISATION OF LARGE FUNCTION VALUES.                            INSH-130
      J=IS+2                                                            INSH-131
      DO 19 I=2,J                                                       INSH-132
      X(1,I)=X(1,I)*1.D-30                                              INSH-133
   19 X(2,I)=X(2,I)*1.D-30                                              INSH-134
   20 CONTINUE                                                          INSH-135
C END OF INTEGRATION.                                                   INSH-136
C MATCHING.                                                             INSH-137
      BRE=X(1,ISM)*FAM(IC,4)-FAM(IC,3)*X(1,ISM+2)                       INSH-138
      BIM=X(2,ISM)*FAM(IC,4)-FAM(IC,3)*X(2,ISM+2)                       INSH-139
      HX=X(1,ISM)*FAM(IC,2)-FAM(IC,1)*X(1,ISM+2)                        INSH-140
      HY=X(2,ISM)*FAM(IC,2)-FAM(IC,1)*X(2,ISM+2)                        INSH-141
      IF (FAM(IC,8).LT.0.D0) GO TO 21                                   INSH-142
      BIM=BIM+HX                                                        INSH-143
      BRE=BRE-HY                                                        INSH-144
   21 A=BRE*BRE+BIM*BIM                                                 INSH-145
      BRE=-BRE/A                                                        INSH-146
      BIM=BIM/A                                                         INSH-147
      FAM(IC,9)=BRE*HX-BIM*HY                                           INSH-148
      FAM(IC,10)=HX*BIM+HY*BRE                                          INSH-149
      IF (LO(121)) RETURN                                               INSH-150
      BRE=BRE/12.D0                                                     INSH-151
      BIM=BIM/12.D0                                                     INSH-152
C NORMALISATION OF THE REGULAR SOLUTION.                                INSH-153
      DO 22 IS=1,ISM                                                    INSH-154
      HX=X(1,IS)+10.D0*X(1,IS+1)+X(1,IS+2)                              INSH-155
      HY=X(2,IS)+10.D0*X(2,IS+1)+X(2,IS+2)                              INSH-156
      P(IS,1)=HX*BRE-HY*BIM                                             INSH-157
   22 P(IS,2)=HX*BIM+HY*BRE                                             INSH-158
C SEARCH OF THE FIRST NON NEGLIGIBLE VALUE.                             INSH-159
      DO 23 KT=1,ISM                                                    INSH-160
      IF ((DABS(P(KT,1))+DABS(P(KT,2))).GT.BCONV) GO TO 24              INSH-161
   23 CONTINUE                                                          INSH-162
   24 IF (LO(30)) RETURN                                                INSH-163
      HX=0.D0                                                           INSH-164
      HY=0.D0                                                           INSH-165
      IF (FAM(IC,8).LT.0.D0) GO TO 25                                   INSH-166
      HX=FAM(IC,1)                                                      INSH-167
      HY=FAM(IC,2)                                                      INSH-168
C COMPUTATION OF THE IRREGULAR SOLUTION - STARTING VALUES.              INSH-169
C  THE TWO LAST POINTS OF IMAGINARY POTENTIAL ARE ZERO.                 INSH-170
   25 X(2,ISM)=HX/FAM(IC,6)                                             INSH-171
      X(2,ISM+2)=HY/FAM(IC,6)                                           INSH-172
      X(1,ISM)=FAM(IC,3)/FAM(IC,6)                                      INSH-173
      X(1,ISM+2)=FAM(IC,4)/FAM(IC,6)                                    INSH-174
      BRE=2.D0-P(ISM,3)                                                 INSH-175
      X(1,ISM+1)=(X(1,ISM)+X(1,ISM+2))/BRE                              INSH-176
      X(2,ISM+1)=(X(2,ISM)+X(2,ISM+2))/BRE                              INSH-177
      J1=ISM-KT                                                         INSH-178
      IF (J1.LE.0) GO TO 27                                             INSH-179
C INTEGRATION.                                                          INSH-180
      DO 26 JS=1,J1                                                     INSH-181
      IS=ISM-JS                                                         INSH-182
      HX=X(1,IS+1)*P(IS,3)-X(2,IS+1)*P(IS,4)                            INSH-183
      HY=X(2,IS+1)*P(IS,3)+X(1,IS+1)*P(IS,4)                            INSH-184
      X(1,IS)=X(1,IS+1)+X(1,IS+1)-X(1,IS+2)-HX                          INSH-185
   26 X(2,IS)=X(2,IS+1)+X(2,IS+1)-X(2,IS+2)-HY                          INSH-186
C COMPUTATION OF IRREGULAR SOLUTION.                                    INSH-187
   27 DO 28 IS=KT,ISM                                                   INSH-188
      P(IS,3)=(X(1,IS)+10.D0*X(1,IS+1)+X(1,IS+2))/12.D0                 INSH-189
   28 P(IS,4)=(X(2,IS)+10.D0*X(2,IS+1)+X(2,IS+2))/12.D0                 INSH-190
      RETURN                                                            INSH-191
      END                                                               INSH-192
C 08/03/07                                                      ECIS06  INSI-000
      SUBROUTINE INSI(W,P,PD,PH,FAM,X,PAD1,PAD2,KITER,KAB,ISM,IPD,I,V,WWINSI-001
     1W,NAT,AT,LMD,NVI,NC,FAR,FAI,MC,LO,LT,Z)                           INSI-002
C  E. C. I. S. METHOD: INTEGRATION OF A SINGLE INHOMOGENEOUS EQUATION   INSI-003
C  BY THE NUMEROV METHOD       - SCHROEDINGER EQUATION -                INSI-004
C INPUT:     P:       COUPLED SOLUTION.                                 INSI-005
C            PD:      DERIVATIVE OF THE COUPLED SOLUTION.               INSI-006
C            PH:      HOMOGENEOUS SOLUTIONS.                            INSI-007
C            FAM(I):  WAVE NUMBER FOR I=1, COEFFICIENT OF CENTRAL       INSI-008
C                     POTENTIAL FOR I=3.                                INSI-009
C            KITER:   CURRENT ITERATION NUMBER.                         INSI-010
C            KAB:     MAXIMUM NUMBER OF EQUATIONS.                      INSI-011
C            ISM:     NUMBER OF RADIAL POINTS.                          INSI-012
C            IPD(IC): FUNCTION IC NEGLIGIBLE FOR THE FIRST IPD POINTS.  INSI-013
C            I:       CHANNEL NUMBER OF THE EQUATION.                   INSI-014
C            V:       REAL, IMAGINARY POTENTIALS AND COUPLINGS.         INSI-015
C            WWW:     COUPLING BETWEEN EQUATIONS COMPUTED IN INTI.      INSI-016
C            NAT,AT:  TABLE OF COUPLING COEFFICIENTS.                   INSI-017
C            LMD:     FIRST DIMENSION OF TABLES NAT AND AT.             INSI-018
C            NVI:     ADDRESSES OF COUPLING COEFFICIENTS.               INSI-019
C            NC:      NUMBER OF COUPLED CHANNELS.                       INSI-020
C            FAR,FAI: PHASE-SHIFTS TO UPDATE.                           INSI-021
C            MC:      NUCLEAR STATE NUMBER, ANGULAR MOMENTA....         INSI-022
C            LT:      .TRUE. TO COMPUTE ONLY THE DERIVATIVE.            INSI-023
C            Z:       COULOMB INTEGRAL FOR CORRECTIONS.                 INSI-024
C            LO(I):   LOGICAL CONTROLS:                                 INSI-025
C               LO(22) =.TRUE. NO USE OF PADE APPROXIMANTS.             INSI-026
C               LO(29) =.TRUE. NO DIAGONAL TERMS IN SECOND MEMBER.      INSI-027
C               LO(30) =.TRUE. PURE DWBA CALCULATION.                   INSI-028
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     INSI-029
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   INSI-030
C               LO(104)=.TRUE. CONVERGENCE IS OBTAINED IN THE ITERATION.INSI-031
C               LO(105)=.TRUE. CONVERGENCE OBTAINED FOR THIS EQUATION.  INSI-032
C               LO(107)=.TRUE. ALL THE COUPLINGS CALCULATED BEFOREHAND. INSI-033
C               LO(110)=.TRUE. DERIVATIVES ARE NEEDED.                  INSI-034
C OUTPUT:    P:       SOLUTION FOR EQUATION I.                          INSI-035
C            PD:      DERIVATIVE OF THE SOLUTION FOR EQUATION I.        INSI-036
C            FAR,FAI: SCATTERING COEFFICIENT.                           INSI-037
C WORKING AREAS:                                                        INSI-038
C            W(2,ISM):REAL/IMAGINARY SECOND MEMBER.                     INSI-039
C            PAD1:    ITERATION RESULTS FOR THE CHANNEL I.              INSI-040
C            PAD2:    WORKING FIELD OF PADE,TWICE LONGER THAN PAD1.     INSI-041
C            X:       INTEGRAL OF REGULAR SOLUTION WITH SECOND MEMBER.  INSI-042
C                                                                       INSI-043
C FOR THE COMMON  /CONVE/ SEE CALX.                                     INSI-044
C FOR THE COMMON  /POTE2/ SEE REDM.                                     INSI-045
C                                                                       INSI-046
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     INSI-047
C  H:         STEP SIZE FOR INTEGRATION.                                INSI-048
C  BJM:       CONVERGENCE COEFFICIENT OF IMAGINARY POTENTIAL.           INSI-049
C  EITER:     CONVERGENCE CRITERION FOR S-MATRIX.                       INSI-050
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         INSI-051
C  HCONV:     ACONV*H*H CONVERGENCE CRITERION FOR SECOND MEMBERS.       INSI-052
C   USED:     H,BJM,EITER,ACONV,HCONV.                                  INSI-053
C                                                                       INSI-054
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     INSI-055
C  ITY(2):    STARTING ADDRESS OF IMAGINARY CENTRAL POTENTIAL.          INSI-056
C  ITY(9):    STARTING ADDRESS OF COULOMB CENTRAL POTENTIAL.            INSI-057
C   USED:     ITY(2),ITY(9).                                            INSI-058
C                                                                       INSI-059
C***********************************************************************INSI-060
      IMPLICIT REAL*8 (A-H,O-Z)                                         INSI-061
      LOGICAL LO(150),LT                                                INSI-062
      DIMENSION W(2,*),P(2,ISM,*),PD(2,ISM,*),PH(ISM,4,*),FAM(KAB,10),X(INSI-063
     12,*),PAD1(2,*),PAD2(2,*),IPD(*),V(ISM,*),WWW(ISM,*),NAT(2*LMD,*),AINSI-064
     2T(LMD,*),NVI(KAB,KAB,4),FAR(*),FAI(*),MC(KAB,6),Z(4)              INSI-065
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       INSI-066
      COMMON /INOUT/ MR,MW,MS                                           INSI-067
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         INSI-068
      IF (LT) GO TO 39                                                  INSI-069
      ISM1=ISM+1                                                        INSI-070
C PUT ZERO IN THE INHOMOGENEOUS TERMS.                                  INSI-071
      DO 1 IS=1,ISM                                                     INSI-072
      W(1,IS)=0.D0                                                      INSI-073
    1 W(2,IS)=0.D0                                                      INSI-074
      IDP=ISM1                                                          INSI-075
C NON DERIVATIVE TERM OF COUPLING POTENTIALS.                           INSI-076
      DO 27 IC=1,NC                                                     INSI-077
      IF (IPD(IC).GT.ISM) GO TO 27                                      INSI-078
      IF (LO(107)) GO TO 9                                              INSI-079
C NO PREVIOUS CALCULATION OF COUPLING POTENTIALS.                       INSI-080
      IF (IC.NE.I) GO TO 3                                              INSI-081
      IF (BJM.EQ.0.D0) GO TO 3                                          INSI-082
      KT=MC(IC,4)+ITY(2)                                                INSI-083
      DO 2 IS=1,ISM                                                     INSI-084
      W(1,IS)=W(1,IS)+FAM(I,7)*V(IS,KT)*P(2,IS,IC)*BJM                  INSI-085
    2 W(2,IS)=W(2,IS)-FAM(I,7)*V(IS,KT)*P(1,IS,IC)*BJM                  INSI-086
    3 IF (LO(29).AND.(IC.EQ.I)) GO TO 27                                INSI-087
C NO PREVIOUS CALCULATION OF COUPLING POTENTIALS.                       INSI-088
      K1=NVI(IC,I,1)                                                    INSI-089
      K2=NVI(IC,I,2)                                                    INSI-090
      IF (K1.GT.K2) GO TO 15                                            INSI-091
      K3=IPD(IC)                                                        INSI-092
      IDP=MIN0(IDP,K3)                                                  INSI-093
      DO 8 K=K1,K2                                                      INSI-094
      KT=NAT(1,K)                                                       INSI-095
      DO 4 IS=K3,ISM                                                    INSI-096
      W(1,IS)=W(1,IS)+AT(2,K)*V(IS,KT)*P(1,IS,IC)                       INSI-097
    4 W(2,IS)=W(2,IS)+AT(2,K)*V(IS,KT)*P(2,IS,IC)                       INSI-098
      IF (NAT(2,K).EQ.0) GO TO 6                                        INSI-099
      KY=NAT(2,K)+ITY(2)                                                INSI-100
      DO 5 IS=K3,ISM                                                    INSI-101
      W(1,IS)=W(1,IS)-AT(2,K)*V(IS,KY)*P(2,IS,IC)                       INSI-102
    5 W(2,IS)=W(2,IS)+AT(2,K)*V(IS,KY)*P(1,IS,IC)                       INSI-103
    6 IF (.NOT.LO(133)) GO TO 8                                         INSI-104
      IF (AT(3,K).EQ.0.D0) GO TO 8                                      INSI-105
      KZ=NAT(1,K)+ITY(9)                                                INSI-106
      DO 7 IS=K3,ISM                                                    INSI-107
      W(1,IS)=W(1,IS)+AT(3,K)*V(IS,KZ)*P(1,IS,IC)                       INSI-108
    7 W(2,IS)=W(2,IS)+AT(3,K)*V(IS,KZ)*P(2,IS,IC)                       INSI-109
    8 CONTINUE                                                          INSI-110
      GO TO 15                                                          INSI-111
C COUPLING POTENTIALS ALREADY CALCULATED.                               INSI-112
    9 L1=NVI(IC,I,1)                                                    INSI-113
      L2=NVI(IC,I,2)                                                    INSI-114
      K3=IPD(IC)                                                        INSI-115
      IDP=MIN0(IDP,K3)                                                  INSI-116
      IF (L1.EQ.0) GO TO 13                                             INSI-117
      IF (L2.GT.0) GO TO 11                                             INSI-118
      DO 10 IS=K3,ISM                                                   INSI-119
      W(1,IS)=W(1,IS)+WWW(IS,L1)*P(1,IS,IC)                             INSI-120
   10 W(2,IS)=W(2,IS)+WWW(IS,L1)*P(2,IS,IC)                             INSI-121
      GO TO 15                                                          INSI-122
   11 DO 12 IS=K3,ISM                                                   INSI-123
      W(1,IS)=W(1,IS)+WWW(IS,L1)*P(1,IS,IC)-WWW(IS,L2)*P(2,IS,IC)       INSI-124
   12 W(2,IS)=W(2,IS)+WWW(IS,L1)*P(2,IS,IC)+WWW(IS,L2)*P(1,IS,IC)       INSI-125
      GO TO 15                                                          INSI-126
   13 IF (L2.EQ.0) GO TO 15                                             INSI-127
      DO 14 IS=K3,ISM                                                   INSI-128
      W(1,IS)=W(1,IS)-WWW(IS,L2)*P(2,IS,IC)                             INSI-129
   14 W(2,IS)=W(2,IS)+WWW(IS,L2)*P(1,IS,IC)                             INSI-130
   15 IF (.NOT.LO(110)) GO TO 27                                        INSI-131
C DERIVATIVE TERM OF COUPLING POTENTIALS.                               INSI-132
      IF (LO(107)) GO TO 21                                             INSI-133
C NO PREVIOUS CALCULATION OF COUPLING POTENTIALS.                       INSI-134
      K1=K2+1                                                           INSI-135
      K2=NVI(IC,I,3)                                                    INSI-136
      IF (K1.GT.K2) GO TO 27                                            INSI-137
      DO 20 K=K1,K2                                                     INSI-138
      KT=NAT(1,K)                                                       INSI-139
      DO 16 IS=K3,ISM                                                   INSI-140
      W(1,IS)=W(1,IS)+AT(2,K)*V(IS,KT)*PD(1,IS,IC)                      INSI-141
   16 W(2,IS)=W(2,IS)+AT(2,K)*V(IS,KT)*PD(2,IS,IC)                      INSI-142
      IF (NAT(2,K).EQ.0) GO TO 18                                       INSI-143
      KT=NAT(2,K)+ITY(2)                                                INSI-144
      DO 17 IS=K3,ISM                                                   INSI-145
      W(1,IS)=W(1,IS)-AT(2,K)*V(IS,KT)*PD(2,IS,IC)                      INSI-146
   17 W(2,IS)=W(2,IS)+AT(2,K)*V(IS,KT)*PD(1,IS,IC)                      INSI-147
   18 IF (.NOT.LO(133)) GO TO 20                                        INSI-148
      IF (AT(3,K).EQ.0.D0) GO TO 20                                     INSI-149
      KT=NAT(2,K)+ITY(9)                                                INSI-150
      DO 19 IS=K3,ISM                                                   INSI-151
      W(1,IS)=W(1,IS)+AT(3,K)*V(IS,KT)*P(1,IS,IC)                       INSI-152
   19 W(2,IS)=W(2,IS)+AT(3,K)*V(IS,KT)*P(2,IS,IC)                       INSI-153
   20 CONTINUE                                                          INSI-154
      GO TO 27                                                          INSI-155
C COUPLING POTENTIALS ALREADY CALCULATED.                               INSI-156
   21 L1=NVI(IC,I,3)                                                    INSI-157
      L2=NVI(IC,I,4)                                                    INSI-158
      IF (L1.LE.0) GO TO 25                                             INSI-159
      IF (L2.GT.0) GO TO 23                                             INSI-160
      DO 22 IS=K3,ISM                                                   INSI-161
      W(1,IS)=W(1,IS)+WWW(IS,L1)*PD(1,IS,IC)                            INSI-162
   22 W(2,IS)=W(2,IS)+WWW(IS,L1)*PD(2,IS,IC)                            INSI-163
      GO TO 27                                                          INSI-164
   23 DO 24 IS=K3,ISM                                                   INSI-165
      W(1,IS)=W(1,IS)+WWW(IS,L1)*PD(1,IS,IC)-WWW(IS,L2)*PD(2,IS,IC)     INSI-166
   24 W(2,IS)=W(2,IS)+WWW(IS,L1)*PD(2,IS,IC)+WWW(IS,L2)*PD(1,IS,IC)     INSI-167
      GO TO 27                                                          INSI-168
   25 IF (L2.EQ.0) GO TO 27                                             INSI-169
      DO 26 IS=K3,ISM                                                   INSI-170
      W(1,IS)=W(1,IS)-WWW(IS,L2)*PD(2,IS,IC)                            INSI-171
   26 W(2,IS)=W(2,IS)+WWW(IS,L2)*PD(1,IS,IC)                            INSI-172
   27 CONTINUE                                                          INSI-173
      IPD(I)=IDP                                                        INSI-174
C SEARCH FOR THE FIRST NON NEGLIGIBLE VALUE.                            INSI-175
      IF (IDP.GT.ISM) GO TO 42                                          INSI-176
      DO 28 IS=IDP,ISM                                                  INSI-177
      IF ((DABS(W(1,IS))+DABS(W(2,IS))).GT.HCONV) GO TO 29              INSI-178
   28 CONTINUE                                                          INSI-179
   29 IPD(I)=IS                                                         INSI-180
      KT=MAX0(IPD(I),1)                                                 INSI-181
      IF (IPD(I).GE.ISM) GO TO 42                                       INSI-182
      IF (.NOT.LO(44)) GO TO 30                                         INSI-183
      W(1,ISM)=0.D0                                                     INSI-184
      W(2,ISM)=0.D0                                                     INSI-185
C INTEGRAL OF THE REGULAR FUNCTION WITH THE SECOND MEMBER.              INSI-186
   30 X(1,KT)=-PH(KT,2,I)*W(2,KT)+PH(KT,1,I)*W(1,KT)                    INSI-187
      X(2,KT)=PH(KT,1,I)*W(2,KT)+PH(KT,2,I)*W(1,KT)                     INSI-188
      KKT=KT+1                                                          INSI-189
      IF (KKT.GT.ISM) GO TO 32                                          INSI-190
      DO 31 IS=KKT,ISM                                                  INSI-191
      X(1,IS)=X(1,IS-1)+PH(IS,1,I)*W(1,IS)-PH(IS,2,I)*W(2,IS)           INSI-192
   31 X(2,IS)=X(2,IS-1)+PH(IS,1,I)*W(2,IS)+PH(IS,2,I)*W(1,IS)           INSI-193
C SCATTERING COEFFICIENTS.                                              INSI-194
   32 BRE=X(1,ISM)/(H*FAM(I,5))-Z(1)                                    INSI-195
      BIM=X(2,ISM)/(H*FAM(I,5))-Z(2)                                    INSI-196
      IF (LO(30)) GO TO 38                                              INSI-197
      HX=Z(3)*H                                                         INSI-198
      HY=Z(4)*H                                                         INSI-199
      IST=ISM+KT                                                        INSI-200
C INTEGRAL OF THE IRREGULAR FUNCTION WITH THE SECOND MEMBER IN HX/HY    INSI-201
C AND COMPUTATION OF THE SOLUTION WITH THE CORRECTION TERM W/12.        INSI-202
      DO 33 IS=KT,ISM                                                   INSI-203
      JS=IST-IS                                                         INSI-204
      P(1,JS,I)=(X(1,JS)*PH(JS,3,I)-X(2,JS)*PH(JS,4,I)-HX*PH(JS,1,I)+HY*INSI-205
     1PH(JS,2,I))/H-W(1,JS)/12.D0                                       INSI-206
      P(2,JS,I)=(X(1,JS)*PH(JS,4,I)+X(2,JS)*PH(JS,3,I)-HY*PH(JS,1,I)-HX*INSI-207
     1PH(JS,2,I))/H-W(2,JS)/12.D0                                       INSI-208
      HX=HX-PH(JS,3,I)*W(1,JS)+PH(JS,4,I)*W(2,JS)                       INSI-209
   33 HY=HY-PH(JS,3,I)*W(2,JS)-PH(JS,4,I)*W(1,JS)                       INSI-210
      IF (KT.EQ.1) GO TO 35                                             INSI-211
      K=KT-1                                                            INSI-212
      DO 34 IS=1,K                                                      INSI-213
      P(1,IS,I)=-(HX*PH(IS,1,I)-HY*PH(IS,2,I))/H                        INSI-214
   34 P(2,IS,I)=-(HY*PH(IS,1,I)+HX*PH(IS,2,I))/H                        INSI-215
   35 DO 36 KT=1,ISM                                                    INSI-216
      IF ((DABS(P(1,KT,I))+DABS(P(2,KT,I))).GT.ACONV) GO TO 37          INSI-217
   36 CONTINUE                                                          INSI-218
   37 IPD(I)=KT                                                         INSI-219
      IF (LO(22)) GO TO 38                                              INSI-220
      PAD1(1,KITER)=BRE                                                 INSI-221
      PAD1(2,KITER)=BIM                                                 INSI-222
C  TEST OF CONVERGENCE.                                                 INSI-223
   38 LO(105)=(DABS(BIM-FAI(1)).LE.EITER.AND.(DABS(BRE-FAR(1)).LE.EITER)INSI-224
     1)                                                                 INSI-225
      IF ((.NOT.LO(22)).AND.LO(104).AND.KITER.GT.3.AND.(.NOT.LO(105))) CINSI-226
     1ALL PADE(PAD1,PAD2,KITER,BRE,BIM,EITER,1.D0,0.D0,LO)              INSI-227
      LO(104)=LO(104).AND.LO(105)                                       INSI-228
      FAR(1)=BRE                                                        INSI-229
      FAI(1)=BIM                                                        INSI-230
      IF (LO(57)) WRITE (MW,1000) I,FAR(1),FAI(1),KITER,KT              INSI-231
      IF (.NOT.LO(110).OR.LO(92)) RETURN                                INSI-232
C COMPUTATION OF R*(D/DR) OF THE SOLUTIONS.                             INSI-233
   39 IST=ISM-3                                                         INSI-234
      DO 41 J=1,2                                                       INSI-235
      PD(J,1,I)=2.5D0*P(J,2,I)-.25D0*P(J,5,I)+(5.D0*P(J,4,I)-7.7D0*P(J,1INSI-236
     1,I)-10.D0*P(J,3,I)+.2D0*P(J,6,I))/6.D0                            INSI-237
      PD(J,2,I)=-.8D0*P(J,1,I)-P(J,4,I)+(8.D0*P(J,3,I)-3.5D0*P(J,2,I)+.8INSI-238
     1D0*P(J,5,I)-.1D0*P(J,6,I))/3.D0                                   INSI-239
      PD(J,3,I)=2.25D0*(P(J,4,I)-P(J,2,I))-.45D0*(P(J,5,I)-P(J,1,I))+.05INSI-240
     1D0*P(J,6,I)                                                       INSI-241
      FP=3.D0                                                           INSI-242
      DO 40 IS=4,IST                                                    INSI-243
      FP=FP+1.D0                                                        INSI-244
   40 PD(J,IS,I)=FP*(.75D0*(P(J,IS+1,I)-P(J,IS-1,I))-.15D0*(P(J,IS+2,I)-INSI-245
     1P(J,IS-2,I))+(P(J,IS+3,I)-P(J,IS-3,I))/60.D0)                     INSI-246
      FP=FP+1.D0                                                        INSI-247
      PD(J,ISM-2,I)=FP*(P(J,ISM-6,I)-8.D0*P(J,ISM-5,I)+30.D0*P(J,ISM-4,IINSI-248
     1)-80.D0*P(J,IST,I)+35.D0*P(J,ISM-2,I)+24.D0*P(J,ISM-1,I)-2.D0*P(J,INSI-249
     2ISM,I))/60.D0                                                     INSI-250
      FP=FP+1.D0                                                        INSI-251
      PD(J,ISM-1,I)=FP*(15.D0*P(J,ISM-5,I)-2.D0*P(J,ISM-6,I)-50.D0*P(J,IINSI-252
     1SM-4,I)+100.D0*P(J,IST,I)-150.D0*P(J,ISM-2,I)+77.D0*P(J,ISM-1,I)+1INSI-253
     20.D0*P(J,ISM,I))/60.D0                                            INSI-254
      FP=FP+1.D0                                                        INSI-255
      PD(J,ISM,I)=FP*(10.D0*P(J,ISM-6,I)-72.D0*P(J,ISM-5,I)+225.D0*P(J,IINSI-256
     1SM-4,I)-400.D0*P(J,IST,I)+450.D0*P(J,ISM-2,I)-360.D0*P(J,ISM-1,I)+INSI-257
     2147.D0*P(J,ISM,I))/60.D0                                          INSI-258
   41 CONTINUE                                                          INSI-259
      RETURN                                                            INSI-260
   42 IF (LO(22)) RETURN                                                INSI-261
      PAD1(1,KITER)=0.D0                                                INSI-262
      PAD1(2,KITER)=0.D0                                                INSI-263
      RETURN                                                            INSI-264
 1000 FORMAT (5X,I5,2D30.15,I10,10X,I5)                                 INSI-265
      END                                                               INSI-266
C 27/06/06                                                      ECIS06  INTR-000
      SUBROUTINE INTR(FAM,X,FR,GR,WRE,PAD,IPE,ISM,KAB,W,ITERM,NC,V,VR,NVINTR-001
     1I,MC,NAT,AT,AG,NCIN,NNI,ITERR,LO)                                 INTR-002
C  E. C. I. S. METHOD: DIRAC EQUATION DRIVING ROUTINE.                  INTR-003
C             INRH  TO SOLVE THE SINGLE HOMOGENEOUS EQUATIONS.          INTR-004
C             INRI  TO SOLVE THE SINGLE INHOMOGENEOUS EQUATIONS.        INTR-005
C  PADE APPROXIMANTS OF TYPE I MAY BE USED TO ACCELERATE THE CONVERGENCEINTR-006
C INPUT:     FAM(*,I):MATCHING VALUES FOR I=1 TO 6, CONSTANTS OF EACH   INTR-007
C                     EQUATION FOR I=7 TO 10.                           INTR-008
C            ISM:     NUMBER OF RADIAL POINTS.                          INTR-009
C            KAB:     MAXIMUM NUMBER OF COUPLED CHANNELS.               INTR-010
C            ITERM:   MAXIMUM NUMBER OF ITERATIONS AND DIM. OF PAD.     INTR-011
C            NC:      NUMBER OF COUPLED EQUATIONS.                      INTR-012
C            V,VR:    REAL, IMAGINARY POTENTIALS AND COUPLINGS.         INTR-013
C            NVI:     ADDRESSES OF COUPLINGS.                           INTR-014
C            MC:      NUCLEAR STATE NUMBER, ANGULAR MOMENTA....         INTR-015
C            NAT,AT:  TABLE OF COUPLING COEFFICIENTS.                   INTR-016
C            AG:      COULOMB INTEGRALS FOR COULOMB CORRECTIONS.        INTR-017
C            NCIN:    NUMBER OF SOLUTIONS.                              INTR-018
C            LO(I):   LOGICAL CONTROLS:                                 INTR-019
C               LO(22) =.TRUE. NO USE OF PADE APPROXIMANTS.             INTR-020
C               LO(23) =.TRUE. NO USE OF PADE AND SHIFT TO USUAL COUPLEDINTR-021
C                              EQUATIONS WHEN THERE IS NO CONVERGENCE.  INTR-022
C               LO(30) =.TRUE. PURE DWBA CALCULATION.                   INTR-023
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     INTR-024
C               LO(53) =.TRUE. OUTPUT OF THE NUMBER OF ITERATIONS.      INTR-025
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   INTR-026
C               LO(74) =.TRUE. OUTPUT OF TIME IN DIFFERENT STEPS.       INTR-027
C               LO(104)=.TRUE. CONVERGENCE IS OBTAINED IN THE ITERATION.INTR-028
C               LO(106)=.TRUE. WHEN THE ITERATION IS NOT THE LAST ONE   INTR-029
C                              ALLOWED.                                 INTR-030
C               LO(107)=.TRUE. ALL THE COUPLINGS CALCULATED BEFOREHAND. INTR-031
C               LO(121)=.TRUE. OPTICAL MODEL WITHOUT COUPLING.          INTR-032
C OUTPUT:    FAM(*,I):SCATTERING COEFFICIENTS FOR I>9.                  INTR-033
C            NNI:     NUMBER OF EQUATIONS WITH NEGLIGIBLE INHOMOGENEOUS INTR-034
C                     TERM.                                             INTR-035
C            ITERR:   LARGEST NUMBER OF ITERATIONS DONE FOR THIS J.     INTR-036
C WORKING AREAS:                                                        INTR-037
C            X:       USED IN INRH AND INRI.                            INTR-038
C            FR:      SOLUTIONS OF HOMOGENEOUS EQUATIONS.               INTR-039
C            GR:      SOLUTIONS OF COUPLED EQUATIONS.                   INTR-040
C            WRE:     REAL/IMAGINARY INHOMOGENEOUS TERM.                INTR-041
C            PAD:     PADE APPROXIMANTS.                                INTR-042
C            IPE(*,I):FIRST NON NEGLIGIBLE POINT OF UNCOUPLED FUNCTIONS INTR-043
C                     FOR I=1, OF COUPLED FUNCTIONS FOR I=2.            INTR-044
C            W:       FREE PART OF THE STORAGE FOR COUPLINGS            INTR-045
C***********************************************************************INTR-046
      IMPLICIT REAL*8 (A-H,O-Z)                                         INTR-047
      LOGICAL LO(150)                                                   INTR-048
      DIMENSION FAM(KAB,*),X(*),FR(ISM,8,*),GR(ISM,4,*),WRE(ISM,*),PAD(2INTR-049
     1,ITERM,*),IPE(NC,2),W(ISM,4,*),V(ISM,14,*),VR(ISM,4,*),NVI(KAB,KABINTR-050
     2,4),MC(KAB,6),NAT(6,*),AT(3,*),AG(KAB,KAB,4),Y(2),Z(4)            INTR-051
      COMMON /INOUT/ MR,MW,MS                                           INTR-052
      NNI=0                                                             INTR-053
C COMPUTE ALL COUPLING POTENTIALS AND SOLVE ALL HOMOGENEOUS EQUATIONS.  INTR-054
      DO 5 I=1,NC                                                       INTR-055
      I1=MC(I,4)                                                        INTR-056
      IF (I1.LT.0) GO TO 1                                              INTR-057
      CALL INRH(FR(1,1,I),I,K,FAM,X,KAB,ISM,DFLOAT(MC(I,6)+1),V(1,1,I1),INTR-058
     1LO)                                                               INTR-059
      IPE(I,1)=K                                                        INTR-060
      GO TO 4                                                           INTR-061
    1 I1=-I1                                                            INTR-062
      IF (I1.EQ.I) GO TO 4                                              INTR-063
      DO 3 J=1,8                                                        INTR-064
      DO 2 IS=1,ISM                                                     INTR-065
    2 FR(IS,J,I)=FR(IS,J,I1)                                            INTR-066
    3 CONTINUE                                                          INTR-067
      IPE(I,1)=IPE(I1,1)                                                INTR-068
    4 IF (LO(57)) WRITE (MW,1000) FAM(I,9),FAM(I,10),I,IPE(I,1)         INTR-069
    5 CONTINUE                                                          INTR-070
      IF (.NOT.LO(107).OR.LO(121)) GO TO 16                             INTR-071
      IW=0                                                              INTR-072
C CALCULATION OF THE NON DIAGONAL COUPLING POTENTIALS.                  INTR-073
      DO 15 IC=1,NC                                                     INTR-074
      DO 14 IP=1,IC                                                     INTR-075
      K1=NVI(IP,IC,1)                                                   INTR-076
      K2=NVI(IP,IC,2)                                                   INTR-077
      K3=NVI(IP,IC,3)                                                   INTR-078
      NVI(IP,IC,3)=0                                                    INTR-079
      NVI(IP,IC,4)=0                                                    INTR-080
      IF (K1.GT.K2) GO TO 9                                             INTR-081
      IW=IW+1                                                           INTR-082
      NVI(IP,IC,3)=IW                                                   INTR-083
      K=NAT(1,K1)                                                       INTR-084
      DO 6 IS=1,ISM                                                     INTR-085
      W(IS,1,IW)=AT(2,K1)*VR(IS,1,K)                                    INTR-086
      W(IS,2,IW)=AT(2,K1)*VR(IS,2,K)                                    INTR-087
      W(IS,3,IW)=AT(3,K1)*VR(IS,3,K)                                    INTR-088
    6 W(IS,4,IW)=AT(3,K1)*VR(IS,4,K)                                    INTR-089
      K4=K1+1                                                           INTR-090
      IF (K4.GT.K2) GO TO 9                                             INTR-091
      DO 8 K1=K4,K2                                                     INTR-092
      K=NAT(1,K1)                                                       INTR-093
      DO 7 IS=1,ISM                                                     INTR-094
      W(IS,1,IW)=W(IS,1,IW)+AT(2,K1)*VR(IS,1,K)                         INTR-095
      W(IS,2,IW)=W(IS,2,IW)+AT(2,K1)*VR(IS,2,K)                         INTR-096
      W(IS,3,IW)=W(IS,3,IW)+AT(3,K1)*VR(IS,3,K)                         INTR-097
    7 W(IS,4,IW)=W(IS,4,IW)+AT(3,K1)*VR(IS,4,K)                         INTR-098
    8 CONTINUE                                                          INTR-099
    9 IF (K2.GE.K3) GO TO 13                                            INTR-100
      IW=IW+1                                                           INTR-101
      NVI(IP,IC,4)=IW                                                   INTR-102
      K1=K2+1                                                           INTR-103
      K=NAT(1,K1)                                                       INTR-104
      DO 10 IS=1,ISM                                                    INTR-105
      W(IS,1,IW)=AT(2,K1)*VR(IS,1,K)+AT(3,K1)*VR(IS,3,K)                INTR-106
      W(IS,2,IW)=AT(2,K1)*VR(IS,2,K)+AT(3,K1)*VR(IS,4,K)                INTR-107
      W(IS,3,IW)=AT(2,K1)*VR(IS,1,K)-AT(3,K1)*VR(IS,3,K)                INTR-108
   10 W(IS,4,IW)=AT(2,K1)*VR(IS,2,K)-AT(3,K1)*VR(IS,4,K)                INTR-109
      K4=K1+1                                                           INTR-110
      IF (K4.GT.K3) GO TO 13                                            INTR-111
      DO 12 K1=K4,K3                                                    INTR-112
      K=NAT(1,K1)                                                       INTR-113
      DO 11 IS=1,ISM                                                    INTR-114
      W(IS,1,IW)=W(IS,1,IW)+AT(2,K1)*VR(IS,1,K)+AT(3,K1)*VR(IS,3,K)     INTR-115
      W(IS,2,IW)=W(IS,2,IW)+AT(2,K1)*VR(IS,2,K)+AT(3,K1)*VR(IS,4,K)     INTR-116
      W(IS,3,IW)=W(IS,3,IW)+AT(2,K1)*VR(IS,1,K)-AT(3,K1)*VR(IS,3,K)     INTR-117
   11 W(IS,4,IW)=W(IS,4,IW)+AT(2,K1)*VR(IS,2,K)-AT(3,K1)*VR(IS,4,K)     INTR-118
   12 CONTINUE                                                          INTR-119
   13 NVI(IC,IP,3)=NVI(IP,IC,3)                                         INTR-120
      NVI(IC,IP,4)=NVI(IP,IC,4)                                         INTR-121
   14 CONTINUE                                                          INTR-122
   15 CONTINUE                                                          INTR-123
   16 IF (LO(74)) CALL HORA                                             INTR-124
C LOOP ON SOLUTIONS.                                                    INTR-125
      DO 30 NCI=1,NCIN                                                  INTR-126
      NCI1=NCI+10                                                       INTR-127
      NCI2=NCI1+NCIN                                                    INTR-128
C SET THE ZERO'S ORDER SOLUTION.                                        INTR-129
      DO 17 IC=1,NC                                                     INTR-130
      IPE(IC,2)=ISM+1                                                   INTR-131
      FAM(IC,NCI1)=0.D0                                                 INTR-132
   17 FAM(IC,NCI2)=0.D0                                                 INTR-133
      FAM(NCI,NCI1)=FAM(NCI,9)                                          INTR-134
      FAM(NCI,NCI2)=FAM(NCI,10)                                         INTR-135
      IF ((IPE(NCI,1).GT.ISM-3).OR.LO(121)) GO TO 30                    INTR-136
      DO 18 IS=1,ISM                                                    INTR-137
      GR(IS,1,NCI)=FR(IS,1,NCI)                                         INTR-138
      GR(IS,2,NCI)=FR(IS,2,NCI)                                         INTR-139
      GR(IS,3,NCI)=FR(IS,5,NCI)                                         INTR-140
   18 GR(IS,4,NCI)=FR(IS,6,NCI)                                         INTR-141
      IPE(NCI,2)=IPE(NCI,1)                                             INTR-142
      AMAX=0.D0                                                         INTR-143
C E. C. I. S. LOOP.                                                     INTR-144
      DO 28 KITER=1,ITERM                                               INTR-145
      ITERR=MAX0(ITERR,KITER)                                           INTR-146
      LO(104)=.TRUE.                                                    INTR-147
      LO(106)=((KITER.NE.ITERM).AND.(AMAX.LT.1.D10)).OR.LO(23)          INTR-148
      IF (AMAX.GT.1.D10) WRITE (MW,1001) AMAX,KITER                     INTR-149
      DO 27 IC=1,NC                                                     INTR-150
      I=MOD(IC+NCI-1,NC)+1                                              INTR-151
      I1=MC(I,1)                                                        INTR-152
      DO 19 J=1,4                                                       INTR-153
   19 Z(J)=0.D0                                                         INTR-154
      IF (.NOT.LO(44)) GO TO 24                                         INTR-155
      DO 22 J=1,NC                                                      INTR-156
      IF (IPE(J,2).GE.ISM) GO TO 22                                     INTR-157
C ORDER IN FG   F(EI)*F(EF),G(EI)*F(EF),F(EI)*G(EF),G(EI)*G(EF).        INTR-158
      IF (LO(22)) GO TO 20                                              INTR-159
      IJ=KITER                                                          INTR-160
      IF (1+MOD(J+NC-NCI-1,NC).GE.IC) IJ=IJ-1                           INTR-161
      IF (IJ.EQ.0) GO TO 20                                             INTR-162
      Y(1)=PAD(1,IJ,J)                                                  INTR-163
      Y(2)=PAD(2,IJ,J)                                                  INTR-164
      GO TO 21                                                          INTR-165
   20 Y(1)=FAM(J,NCI1)                                                  INTR-166
      Y(2)=FAM(J,NCI2)                                                  INTR-167
   21 Z(1)=Z(1)+Y(1)*AG(I,J,3)-Y(2)*AG(I,J,1)                           INTR-168
      Z(2)=Z(2)+Y(1)*AG(I,J,1)+Y(2)*AG(I,J,3)                           INTR-169
      Z(3)=Z(3)+Y(1)*AG(I,J,4)-Y(2)*AG(I,J,2)                           INTR-170
      Z(4)=Z(4)+Y(1)*AG(I,J,2)+Y(2)*AG(I,J,4)                           INTR-171
   22 CONTINUE                                                          INTR-172
      IF (I.EQ.NCI) GO TO 23                                            INTR-173
      Z(1)=Z(1)+AG(I,NCI,1)                                             INTR-174
      Z(3)=Z(3)+AG(I,NCI,2)                                             INTR-175
   23 Z(3)=Z(3)-Z(2)                                                    INTR-176
      Z(4)=Z(4)+Z(1)                                                    INTR-177
      Z(1)=Z(1)+FAM(I,9)*Z(3)-FAM(I,10)*Z(4)                            INTR-178
      Z(2)=Z(2)+Z(3)*FAM(I,10)+Z(4)*FAM(I,9)                            INTR-179
   24 IF (I.NE.NCI) GO TO 25                                            INTR-180
      Z(1)=Z(1)-FAM(I,9)                                                INTR-181
      Z(2)=Z(2)-FAM(I,10)                                               INTR-182
      Z(3)=Z(3)-1.D0                                                    INTR-183
   25 IF (LO(23).AND.(.NOT.LO(106))) LO(104)=.TRUE.                     INTR-184
C COMPUTE SECOND MEMBERS AND SOLVE THE INHOMOGENEOUS EQUATIONS.         INTR-185
      CALL INRI(WRE,FR(1,1,I),GR,W,NVI,FAM(I,5),X,PAD(1,1,I),PAD(1,1,NC+INTR-186
     11),KITER,KAB,NC,ISM,IPE(1,2),I,NAT,AT,VR,FAM(I,NCI1),FAM(I,NCI2),DINTR-187
     2FLOAT(MC(I,6)+1),V(1,1,I1),LO,Z)                                  INTR-188
      IF (IPE(I,2).GE.ISM) GO TO 26                                     INTR-189
      IF (I.NE.NCI.AND.LO(30)) IPE(I,2)=ISM+1                           INTR-190
      AMAX=DMAX1(AMAX,DABS(FAM(I,NCI1))+DABS(FAM(I,NCI2)))              INTR-191
      GO TO 27                                                          INTR-192
   26 FAM(I,NCI1)=-Z(1)                                                 INTR-193
      FAM(I,NCI2)=-Z(2)                                                 INTR-194
      IF (LO(57)) WRITE (MW,1002)                                       INTR-195
      IF (KITER.EQ.1.AND.LO(44)) NNI=NNI+1                              INTR-196
      IF (I.EQ.NCI) IPE(NCI,2)=IPE(NCI,1)                               INTR-197
   27 CONTINUE                                                          INTR-198
      IF (LO(74)) CALL HORA                                             INTR-199
      IF (LO(104).OR.(AMAX.GT.1.D10.AND.LO(23))) GO TO 29               INTR-200
   28 CONTINUE                                                          INTR-201
      KITER=MIN0(KITER,ITERM)                                           INTR-202
   29 IF (LO(53)) WRITE (MW,1003) KITER                                 INTR-203
   30 CONTINUE                                                          INTR-204
      NNI=NNI/NCIN                                                      INTR-205
      RETURN                                                            INTR-206
 1000 FORMAT (2D30.15,5X,2I5)                                           INTR-207
 1001 FORMAT (' MAXIMUM',D15.6,' OBTAINED IN PREVIOUS ITERATION. LAST ONINTR-208
     1E IS',I3)                                                         INTR-209
 1002 FORMAT (5X,'THE INHOMOGENEOUS TERM IS NEGLECTED.')                INTR-210
 1003 FORMAT (5X,I5,' ITERATIONS.')                                     INTR-211
      END                                                               INTR-212
C 27/06/06                                                      ECIS06  INRH-000
      SUBROUTINE INRH(P,IC,KT,FAM,X,NC,ISM,CC,VV,LO)                    INRH-001
C  E. C. I. S. METHOD: INTEGRATION OF A SINGLE HOMOGENEOUS EQUATION BY  INRH-002
C  THE NUMEROV METHOD   - DIRAC EQUATION -                              INRH-003
C INPUT:     IC:      CHANNEL NUMBER OF THE EQUATION.                   INRH-004
C            FAM(*,I):MATCHING VALUES FOR I=1 TO 4,                     INRH-005
C                     CONSTANTS OF THIS EQUATION FOR I=6 TO 10.         INRH-006
C            KAB:     MAXIMUM NUMBER OF COUPLED CHANNELS.               INRH-007
C            NC:      NUMBER OF COUPLED CHANNELS.                       INRH-008
C            ISM:     NUMBER OF RADIAL POINTS.                          INRH-009
C            CC:      EIGENVALUE OF L.S+1                               INRH-010
C            VV:      POTENTIALS, D(R), ....                            INRH-011
C            LO(I):   LOGICAL CONTROLS:                                 INRH-012
C               LO(26) =.TRUE. INTEGRATION STABILISED FOR LONG RANGE    INRH-013
C                              CONSTANT POTENTIAL.                      INRH-014
C               LO(27) =.TRUE. NUMEROV'S METHOD FOR SINGLE EQUATIONS.   INRH-015
C               LO(121)=.TRUE. OPTICAL MODEL WITHOUT COUPLING.          INRH-016
C OUTPUT:    P(*,I):  REGULAR SOLUTION FOR I=1, 2, 5 AND 6,             INRH-017
C                     IRREGULAR SOLUTION FOR I=3, 4, 7 AND 8,           INRH-018
C                     LARGE COMPONENTS FOR I=1 TO 4,                    INRH-019
C                     SMALL COMPONENT FOR I=5 TO 8,                     INRH-020
C                     REAL/IMAGINARY IRREGULAR SOLUTION FOR I=3 AND 4.  INRH-021
C            FAM(*,I):REAL/IMAGINARY PART OF ZERO'S ORDER SCATTERING    INRH-022
C                     COEFFICIENTS FOR I=9 AND 10.                      INRH-023
C            KT:    THE SOLUTION IS NEGLIGIBLE FOR THE FIRST KT POINTS. INRH-024
C WORKING AREA:                                                         INRH-025
C            X:     FOR THE INTEGRATION.                                INRH-026
C                                                                       INRH-027
C FOR THE COMMON  /CONVE/ SEE CALX.                                     INRH-028
C                                                                       INRH-029
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     INRH-030
C  H:         STEP SIZE FOR INTEGRATION.                                INRH-031
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         INRH-032
C   USED:     H,ACONV.                                                  INRH-033
C                                                                       INRH-034
C***********************************************************************INRH-035
      IMPLICIT REAL*8 (A-H,O-Z)                                         INRH-036
      LOGICAL LO(150)                                                   INRH-037
      DIMENSION P(ISM,8),FAM(NC,10),X(2,*),VV(ISM,14)                   INRH-038
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       INRH-039
C COMPUTATION OF THE REGULAR SOLUTION.                                  INRH-040
      DO 1 IS=1,ISM                                                     INRH-041
      X(1,IS+2)=FAM(IC,10)/DFLOAT(IS)**2-FAM(IC,8)-FAM(IC,7)*VV(IS,1)-FAINRH-042
     1M(IC,9)*VV(IS,3)                                                  INRH-043
    1 X(2,IS+2)=-FAM(IC,7)*VV(IS,2)-FAM(IC,9)*VV(IS,4)                  INRH-044
      IF (LO(27)) GO TO 3                                               INRH-045
C MODIFIED NUMEROV METHOD.                                              INRH-046
      DO 2 IS=1,ISM                                                     INRH-047
      A=X(1,IS+2)**2-X(2,IS+2)**2                                       INRH-048
      IF (LO(26)) A=A+X(1,IS+2)**3/30.D0                                INRH-049
      X(2,IS+2)=X(2,IS+2)*(1.D0+X(1,IS+2)/6.D0)                         INRH-050
    2 X(1,IS+2)=X(1,IS+2)+A/12.D0                                       INRH-051
      GO TO 5                                                           INRH-052
C NUMEROV METHOD.                                                       INRH-053
    3 DO 4 IS=1,ISM                                                     INRH-054
      B=(12.D0-X(1,IS+2))**2+X(2,IS+2)**2                               INRH-055
      A=12.D0*(X(1,IS+2)*(12.D0-X(1,IS+2))-X(2,IS+2)**2)/B              INRH-056
      IF (LO(26)) A=A-X(1,IS+2)**3/240.D0                               INRH-057
      X(1,IS+2)=A                                                       INRH-058
    4 X(2,IS+2)=144.D0*X(2,IS+2)/B                                      INRH-059
    5 X(1,1)=0.D0                                                       INRH-060
      X(2,1)=0.D0                                                       INRH-061
      X(1,2)=1.D-15                                                     INRH-062
      X(2,2)=0.D0                                                       INRH-063
      DO 7 IS=1,ISM                                                     INRH-064
      P(IS,3)=X(1,IS+2)                                                 INRH-065
      P(IS,4)=X(2,IS+2)                                                 INRH-066
      HX=X(1,IS+1)*X(1,IS+2)-X(2,IS+1)*X(2,IS+2)                        INRH-067
      HY=X(2,IS+1)*X(1,IS+2)+X(1,IS+1)*X(2,IS+2)                        INRH-068
      X(1,IS+2)=X(1,IS+1)+X(1,IS+1)-X(1,IS)+HX                          INRH-069
      X(2,IS+2)=X(2,IS+1)+X(2,IS+1)-X(2,IS)+HY                          INRH-070
      IF (DABS(X(1,IS+2)).LT.1.D15) GO TO 7                             INRH-071
C RENORMALISATION OF LARGE FUNCTION VALUES.                             INRH-072
      J=IS+2                                                            INRH-073
      DO 6 I=2,J                                                        INRH-074
      X(1,I)=X(1,I)*1.D-30                                              INRH-075
    6 X(2,I)=X(2,I)*1.D-30                                              INRH-076
    7 CONTINUE                                                          INRH-077
C END OF INTEGRATION.                                                   INRH-078
C MATCHING WITH TWO VALUES.                                             INRH-079
      BRE=X(1,ISM)*FAM(IC,4)-FAM(IC,3)*X(1,ISM+2)                       INRH-080
      BIM=X(2,ISM)*FAM(IC,4)-FAM(IC,3)*X(2,ISM+2)                       INRH-081
      HX=X(1,ISM)*FAM(IC,2)-FAM(IC,1)*X(1,ISM+2)                        INRH-082
      HY=X(2,ISM)*FAM(IC,2)-FAM(IC,1)*X(2,ISM+2)                        INRH-083
      BIM=BIM+HX                                                        INRH-084
      BRE=BRE-HY                                                        INRH-085
      BRR=BRE*BRE+BIM*BIM                                               INRH-086
      BRE=-BRE/BRR                                                      INRH-087
      BIM=BIM/BRR                                                       INRH-088
      FAM(IC,9)=BRE*HX-BIM*HY                                           INRH-089
      FAM(IC,10)=HX*BIM+HY*BRE                                          INRH-090
      IF (LO(121)) RETURN                                               INRH-091
      BRE=BRE/12.D0                                                     INRH-092
      BIM=BIM/12.D0                                                     INRH-093
C NORMALISATION OF THE REGULAR SOLUTION.                                INRH-094
C AND SEARCH OF THE FIRST NON NEGLIGIBLE VALUE.                         INRH-095
      DO 8 IS=1,ISM                                                     INRH-096
      BRR=X(1,IS)+10.D0*X(1,IS+1)+X(1,IS+2)                             INRH-097
      HY=X(2,IS)+10.D0*X(2,IS+1)+X(2,IS+2)                              INRH-098
      HX=BRR*BRE-HY*BIM                                                 INRH-099
      HY=HY*BRE+BRR*BIM                                                 INRH-100
      P(IS,1)=HX*VV(IS,9)-HY*VV(IS,10)                                  INRH-101
    8 P(IS,2)=HX*VV(IS,10)+HY*VV(IS,9)                                  INRH-102
      DO 9 KT=1,ISM                                                     INRH-103
      IF ((DABS(P(KT,1))+DABS(P(KT,2))).GT.ACONV) GO TO 10              INRH-104
    9 CONTINUE                                                          INRH-105
   10 HX=FAM(IC,1)                                                      INRH-106
      HY=FAM(IC,2)                                                      INRH-107
C COMPUTATION OF THE IRREGULAR SOLUTION - STARTING VALUES.              INRH-108
C THE LAST POINT OF IMAGINARY POTENTIAL IS NEGLECTED.                   INRH-109
      X(2,ISM)=HX/FAM(IC,6)                                             INRH-110
      X(2,ISM+2)=HY/FAM(IC,6)                                           INRH-111
      X(1,ISM)=FAM(IC,3)/FAM(IC,6)                                      INRH-112
      X(1,ISM+2)=FAM(IC,4)/FAM(IC,6)                                    INRH-113
      BRE=2.D0+P(ISM,3)                                                 INRH-114
      X(1,ISM+1)=(X(1,ISM)+X(1,ISM+2))/BRE                              INRH-115
      X(2,ISM+1)=(X(2,ISM)+X(2,ISM+2))/BRE                              INRH-116
      KR=MIN0(KT,ISM-6)                                                 INRH-117
      I1=ISM-KR                                                         INRH-118
C INTEGRATION.                                                          INRH-119
      DO 11 JS=1,I1                                                     INRH-120
      IS=ISM-JS                                                         INRH-121
      HX=X(1,IS+1)*P(IS,3)-X(2,IS+1)*P(IS,4)                            INRH-122
      HY=X(2,IS+1)*P(IS,3)+X(1,IS+1)*P(IS,4)                            INRH-123
      X(1,IS)=X(1,IS+1)+X(1,IS+1)-X(1,IS+2)+HX                          INRH-124
   11 X(2,IS)=X(2,IS+1)+X(2,IS+1)-X(2,IS+2)+HY                          INRH-125
C COMPUTATION OF IRREGULAR SOLUTION.                                    INRH-126
      DO 12 IS=KR,ISM                                                   INRH-127
      BRE=(X(1,IS)+10.D0*X(1,IS+1)+X(1,IS+2))/12.D0                     INRH-128
      BIM=(X(2,IS)+10.D0*X(2,IS+1)+X(2,IS+2))/12.D0                     INRH-129
      P(IS,3)=BRE*VV(IS,9)-BIM*VV(IS,10)                                INRH-130
   12 P(IS,4)=BRE*VV(IS,10)+BIM*VV(IS,9)                                INRH-131
      ISM3=ISM-3                                                        INRH-132
      HH=H*60.D0                                                        INRH-133
      DO 22 L=1,4                                                       INRH-134
      DO 21 IS=KT,ISM                                                   INRH-135
      IF (IS-KR.GT.2) GO TO 16                                          INRH-136
      IF (IS-KR-1)  13 , 14 , 15                                        INRH-137
   13 P(IS,L+4)=(-147.D0*P(IS,L)+360.D0*P(IS+1,L)-450.D0*P(IS+2,L)+400.DINRH-138
     10*P(IS+3,L)-225.D0*P(IS+4,L)+72.D0*P(IS+5,L)-10.D0*P(IS+6,L))/HH  INRH-139
      GO TO 21                                                          INRH-140
   14 P(IS,L+4)=(-10.D0*P(KR,L)-77.D0*P(IS,L)+150.D0*P(IS+1,L)-100.D0*P(INRH-141
     1IS+2,L)+50.D0*P(IS+3,L)-15.D0*P(IS+4,L)+2.D0*P(IS+5,L))/HH        INRH-142
      GO TO 21                                                          INRH-143
   15 P(IS,L+4)=(2.D0*P(KR,L)-24.D0*P(IS-1,L)-35.D0*P(IS,L)+80.D0*P(IS+1INRH-144
     1,L)-30.D0*P(IS+2,L)+8.D0*P(IS+3,L)-P(IS+4,L))/HH                  INRH-145
      GO TO 21                                                          INRH-146
   16 IF (IS.GT.ISM3) GO TO 17                                          INRH-147
      P(IS,L+4)=(45.D0*(P(IS+1,L)-P(IS-1,L))-9.D0*(P(IS+2,L)-P(IS-2,L))+INRH-148
     1P(IS+3,L)-P(IS-3,L))/HH                                           INRH-149
      GO TO 21                                                          INRH-150
   17 IF (IS-ISM+1) 18 , 19 , 20                                        INRH-151
   18 P(ISM-2,L+4)=(P(ISM-6,L)-8.D0*P(ISM-5,L)+30.D0*P(ISM-4,L)-80.D0*P(INRH-152
     1ISM3,L)+35.D0*P(ISM-2,L)+24.D0*P(ISM-1,L)-2.D0*P(ISM,L))/HH       INRH-153
      GO TO 21                                                          INRH-154
   19 P(ISM-1,L+4)=(-2.D0*P(ISM-6,L)+15.D0*P(ISM-5,L)-50.D0*P(ISM-4,L)+1INRH-155
     100.D0*P(ISM3,L)-150.D0*P(ISM-2,L)+77.D0*P(ISM-1,L)+10.D0*P(ISM,L))INRH-156
     2/HH                                                               INRH-157
      GO TO 21                                                          INRH-158
   20 P(ISM,L+4)=(10.D0*P(ISM-6,L)-72.D0*P(ISM-5,L)+225.D0*P(ISM-4,L)-40INRH-159
     10.D0*P(ISM3,L)+450.D0*P(ISM-2,L)-360.D0*P(ISM-1,L)+147.D0*P(ISM,L)INRH-160
     2)/HH                                                              INRH-161
   21 CONTINUE                                                          INRH-162
   22 CONTINUE                                                          INRH-163
      R=H*DFLOAT(KT-1)                                                  INRH-164
      DO 23 IS=KT,ISM                                                   INRH-165
      R=R+H                                                             INRH-166
      BR=P(IS,1)*(CC/R+VV(IS,13))-P(IS,5)-P(IS,2)*VV(IS,14)             INRH-167
      BI=P(IS,2)*(CC/R+VV(IS,13))-P(IS,6)+P(IS,1)*VV(IS,14)             INRH-168
      CR=P(IS,3)*(CC/R+VV(IS,13))-P(IS,7)-P(IS,4)*VV(IS,14)             INRH-169
      CI=P(IS,4)*(CC/R+VV(IS,13))-P(IS,8)+P(IS,3)*VV(IS,14)             INRH-170
      P(IS,5)=BR*VV(IS,11)-BI*VV(IS,12)                                 INRH-171
      P(IS,6)=BI*VV(IS,11)+BR*VV(IS,12)                                 INRH-172
      P(IS,7)=CR*VV(IS,11)-CI*VV(IS,12)                                 INRH-173
   23 P(IS,8)=CI*VV(IS,11)+CR*VV(IS,12)                                 INRH-174
      IF (KT.EQ.1) RETURN                                               INRH-175
      KR=KT-1                                                           INRH-176
      DO 25 IS=1,KR                                                     INRH-177
      DO 24 L=1,8                                                       INRH-178
   24 P(IS,L)=0.D0                                                      INRH-179
   25 CONTINUE                                                          INRH-180
      RETURN                                                            INRH-181
      END                                                               INRH-182
C 27/06/06                                                      ECIS06  INRI-000
      SUBROUTINE INRI(W,P,Q,WW,NVI,FAM,X,PAD1,PAD2,KITER,KAB,NC,ISM,IPI,INRI-001
     1J,NAT,AT,VR,FAR,FAI,CC,V,LO,Z)                                    INRI-002
C  E. C. I. S. METHOD: INTEGRATION OF A SINGLE INHOMOGENEOUS EQUATION   INRI-003
C  BY THE NUMEROV METHOD      - DIRAC EQUATION -                        INRI-004
C INPUT:     P:       UNCOUPLED SOLUTIONS.                              INRI-005
C            Q:       COUPLED SOLUTION.                                 INRI-006
C            WW:      COUPLING BETWEEN EQUATIONS.                       INRI-007
C            NVI:     TABLE OF ADDRESSES OF COUPLINGS.                  INRI-008
C            FAM:     WAVE NUMBER.                                      INRI-009
C            KITER:   CURRENT ITERATION NUMBER.                         INRI-010
C            KAB:     DIMENSION OF TABLE NVI.                           INRI-011
C            NC:      NUMBER OF COUPLED CHANNELS.                       INRI-012
C            ISM:     NUMBER OF RADIAL POINTS.                          INRI-013
C            IPI:     THE FUNCTION IS NEGLIGIBLE FOR R < IPI*H.         INRI-014
C            J:       CHANNEL NUMBER OF THE EQUATION.                   INRI-015
C            NAT,AT:  COEFFICIENTS AND ADDRESSES OF COUPLINGS.          INRI-016
C            VR:      COUPLING POTENTIALS.                              INRI-017
C            CC:      EIGENVALUE OF L.S + 1.                            INRI-018
C            V:       D(R) AND TENSOR POTENTIALS FOR H**4 CORRECTION.   INRI-019
C            Z:       COULOMB INTEGRAL FOR CORRECTIONS.                 INRI-020
C            LO(I):   LOGICAL CONTROLS:                                 INRI-021
C               LO(22) =.TRUE. NO USE OF PADE APPROXIMANTS.             INRI-022
C               LO(30) =.TRUE. PURE DWBA CALCULATION.                   INRI-023
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   INRI-024
C               LO(104)=.TRUE. CONVERGENCE IS OBTAINED IN THE ITERATION.INRI-025
C               LO(105)=.TRUE. CONVERGENCE OBTAINED FOR THIS EQUATION.  INRI-026
C               LO(107)=.TRUE. ALL THE COUPLINGS CALCULATED BEFOREHAND. INRI-027
C OUTPUT:    FAR,FAI: REAL/IMAGINARY PART OF SCATTERING COEFFICIENTS.   INRI-028
C WORKING AREAS:                                                        INRI-029
C            W(ISM,4):SECOND MEMBERS.                                   INRI-030
C            X:       INTEGRAL OF REGULAR FUNCTION WITH SECOND MEMBER.  INRI-031
C            PAD1:    ITERATION RESULTS FOR THE CHANNEL J.              INRI-032
C            PAD2:    WORKING FIELD OF PADE,TWICE LONGER THAN PAD1.     INRI-033
C                                                                       INRI-034
C FOR THE COMMON  /CONVE/ SEE CALX.                                     INRI-035
C                                                                       INRI-036
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /CONVE/:                     INRI-037
C  H:         STEP SIZE FOR INTEGRATION.                                INRI-038
C  EITER:     CONVERGENCE CRITERION FOR S-MATRIX.                       INRI-039
C  ACONV:     CONVERGENCE CRITERION FOR POTENTIAL AND FUNCTION.         INRI-040
C  HCONV:     ACONV*H*H CONVERGENCE CRITERION FOR SECOND MEMBERS.       INRI-041
C   USED:     H,EITER,ACONV,HCONV.                                      INRI-042
C                                                                       INRI-043
C***********************************************************************INRI-044
      IMPLICIT REAL*8 (A-H,O-Z)                                         INRI-045
      LOGICAL LO(150)                                                   INRI-046
      DIMENSION W(ISM,4),P(ISM,8),Q(ISM,4,*),WW(ISM,4,*),NVI(KAB,KAB,4),INRI-047
     1FAM(*),X(2,*),PAD1(2,*),PAD2(*),IPI(*),NAT(6,*),AT(3,*),VR(ISM,4,*INRI-048
     2),FAR(*),FAI(*),V(ISM,14),Z(4),WX(4)                              INRI-049
      COMMON /CONVE/ H,BJM,EITER,ACONV,CONJ,HCONV                       INRI-050
      COMMON /INOUT/ MR,MW,MS                                           INRI-051
      ISM1=ISM+1                                                        INRI-052
C PUT ZERO IN THE INHOMOGENEOUS TERMS.                                  INRI-053
      DO 2 K=1,4                                                        INRI-054
      DO 1 IS=1,ISM                                                     INRI-055
    1 W(IS,K)=0.D0                                                      INRI-056
    2 CONTINUE                                                          INRI-057
      IDP=ISM1                                                          INRI-058
      DO 15 IC=1,NC                                                     INRI-059
      IF (IPI(IC).GT.ISM) GO TO 15                                      INRI-060
      K3=IPI(IC)                                                        INRI-061
      IDP=MIN0(IDP,K3)                                                  INRI-062
      IF (LO(107)) GO TO 11                                             INRI-063
C NO PREVIOUS CALCULATION OF COUPLING POTENTIALS.                       INRI-064
      L1=NVI(J,IC,1)                                                    INRI-065
      L2=NVI(J,IC,2)                                                    INRI-066
      L3=NVI(J,IC,3)                                                    INRI-067
      IF (L1.GT.L2) GO TO 6                                             INRI-068
C SCALAR AND VECTOR TERMS OF COUPLING POTENTIALS.                       INRI-069
      DO 5 IS=K3,ISM                                                    INRI-070
      DO 3 I=1,4                                                        INRI-071
    3 WX(I)=0.D0                                                        INRI-072
      DO 4 K1=L1,L2                                                     INRI-073
      K=NAT(1,K1)                                                       INRI-074
      WX(1)=WX(1)+AT(2,K1)*VR(IS,1,K)                                   INRI-075
      WX(2)=WX(2)+AT(2,K1)*VR(IS,2,K)                                   INRI-076
      WX(3)=WX(3)+AT(3,K1)*VR(IS,3,K)                                   INRI-077
    4 WX(4)=WX(4)+AT(3,K1)*VR(IS,4,K)                                   INRI-078
      W(IS,1)=W(IS,1)+WX(1)*Q(IS,1,IC)-WX(2)*Q(IS,2,IC)                 INRI-079
      W(IS,2)=W(IS,2)+WX(1)*Q(IS,2,IC)+WX(2)*Q(IS,1,IC)                 INRI-080
      W(IS,3)=W(IS,3)+WX(3)*Q(IS,3,IC)-WX(4)*Q(IS,4,IC)                 INRI-081
    5 W(IS,4)=W(IS,4)+WX(3)*Q(IS,4,IC)+WX(4)*Q(IS,3,IC)                 INRI-082
    6 IF (L2.GE.L3) GO TO 13                                            INRI-083
C TENSOR TERMS OF COUPLING POTENTIALS.                                  INRI-084
      L2=L2+1                                                           INRI-085
      DO 10 IS=K3,ISM                                                   INRI-086
      DO 7 I=1,4                                                        INRI-087
    7 WX(I)=0.D0                                                        INRI-088
      DO 8 K1=L2,L3                                                     INRI-089
      K=NAT(1,K1)                                                       INRI-090
      WX(1)=WX(1)+AT(2,K1)*VR(IS,1,K)                                   INRI-091
      WX(2)=WX(2)+AT(2,K1)*VR(IS,2,K)                                   INRI-092
      WX(3)=WX(3)+AT(3,K1)*VR(IS,3,K)                                   INRI-093
    8 WX(4)=WX(4)+AT(3,K1)*VR(IS,4,K)                                   INRI-094
      IF (J.GT.IC) GO TO 9                                              INRI-095
      WX(3)=-WX(3)                                                      INRI-096
      WX(4)=-WX(4)                                                      INRI-097
    9 W(IS,1)=W(IS,1)+(WX(1)+WX(3))*Q(IS,3,IC)-(WX(2)+WX(4))*Q(IS,4,IC) INRI-098
      W(IS,2)=W(IS,2)+(WX(1)+WX(3))*Q(IS,4,IC)+(WX(2)+WX(4))*Q(IS,3,IC) INRI-099
      W(IS,3)=W(IS,3)+(WX(1)-WX(3))*Q(IS,1,IC)-(WX(2)-WX(4))*Q(IS,2,IC) INRI-100
   10 W(IS,4)=W(IS,4)+(WX(1)-WX(3))*Q(IS,2,IC)+(WX(2)-WX(4))*Q(IS,1,IC) INRI-101
      GO TO 15                                                          INRI-102
C COUPLING POTENTIALS COMPUTED IN INTR.                                 INRI-103
   11 K1=NVI(IC,J,3)                                                    INRI-104
      IF (K1.EQ.0) GO TO 13                                             INRI-105
C SCALAR AND VECTOR TERMS OF COUPLING POTENTIALS.                       INRI-106
      DO 12 IS=K3,ISM                                                   INRI-107
      W(IS,1)=W(IS,1)+WW(IS,1,K1)*Q(IS,1,IC)-WW(IS,2,K1)*Q(IS,2,IC)     INRI-108
      W(IS,2)=W(IS,2)+WW(IS,1,K1)*Q(IS,2,IC)+WW(IS,2,K1)*Q(IS,1,IC)     INRI-109
      W(IS,3)=W(IS,3)+WW(IS,3,K1)*Q(IS,3,IC)-WW(IS,4,K1)*Q(IS,4,IC)     INRI-110
   12 W(IS,4)=W(IS,4)+WW(IS,3,K1)*Q(IS,4,IC)+WW(IS,4,K1)*Q(IS,3,IC)     INRI-111
   13 K1=NVI(IC,J,4)                                                    INRI-112
C TENSOR TERMS OF COUPLING POTENTIALS.                                  INRI-113
      IF (K1.EQ.0) GO TO 15                                             INRI-114
      L1=1                                                              INRI-115
      IF (J.LT.IC) L1=3                                                 INRI-116
      L2=4-L1                                                           INRI-117
      DO 14 IS=K3,ISM                                                   INRI-118
      W(IS,1)=W(IS,1)+WW(IS,L1,K1)*Q(IS,3,IC)-WW(IS,L1+1,K1)*Q(IS,4,IC) INRI-119
      W(IS,2)=W(IS,2)+WW(IS,L1,K1)*Q(IS,4,IC)+WW(IS,L1+1,K1)*Q(IS,3,IC) INRI-120
      W(IS,3)=W(IS,3)+WW(IS,L2,K1)*Q(IS,1,IC)-WW(IS,L2+1,K1)*Q(IS,2,IC) INRI-121
   14 W(IS,4)=W(IS,4)+WW(IS,L2,K1)*Q(IS,2,IC)+WW(IS,L2+1,K1)*Q(IS,1,IC) INRI-122
   15 CONTINUE                                                          INRI-123
      IPI(J)=IDP                                                        INRI-124
C SEARCH FOR THE FIRST NON NEGLIGIBLE VALUE.                            INRI-125
      IF (IDP.GT.ISM) GO TO 28                                          INRI-126
      DO 16 IS=IDP,ISM                                                  INRI-127
      IF ((DABS(W(IS,1))+DABS(W(IS,2))+DABS(W(IS,3))+DABS(W(IS,4))).GT.HINRI-128
     1CONV) GO TO 17                                                    INRI-129
   16 CONTINUE                                                          INRI-130
   17 IPI(J)=IS                                                         INRI-131
      IF (IPI(J).GE.ISM) GO TO 28                                       INRI-132
      KT=MAX0(IPI(J),1)                                                 INRI-133
C INTEGRAL OF THE REGULAR FUNCTION WITH THE SECOND MEMBER.              INRI-134
      X(1,KT)=P(KT,2)*W(KT,2)-P(KT,1)*W(KT,1)+P(KT,6)*W(KT,4)-P(KT,5)*W(INRI-135
     1KT,3)                                                             INRI-136
      X(2,KT)=-P(KT,1)*W(KT,2)-P(KT,2)*W(KT,1)-P(KT,5)*W(KT,4)-P(KT,6)*WINRI-137
     1(KT,3)                                                            INRI-138
      KKT=KT+1                                                          INRI-139
      IF (KKT.GT.ISM) GO TO 19                                          INRI-140
      DO 18 IS=KKT,ISM                                                  INRI-141
      X(1,IS)=X(1,IS-1)-P(IS,1)*W(IS,1)+P(IS,2)*W(IS,2)-P(IS,5)*W(IS,3)+INRI-142
     1P(IS,6)*W(IS,4)                                                   INRI-143
   18 X(2,IS)=X(2,IS-1)-P(IS,1)*W(IS,2)-P(IS,2)*W(IS,1)-P(IS,5)*W(IS,4)-INRI-144
     1P(IS,6)*W(IS,3)                                                   INRI-145
C SCATTERING COEFFICIENTS.                                              INRI-146
   19 HX=Z(3)*H                                                         INRI-147
      HY=Z(4)*H                                                         INRI-148
      A=X(1,ISM)/FAM(1)-Z(1)                                            INRI-149
      B=X(2,ISM)/FAM(1)-Z(2)                                            INRI-150
      IF (LO(30)) GO TO 27                                              INRI-151
      IST=ISM+KT                                                        INRI-152
      R=H*DFLOAT(ISM)                                                   INRI-153
      DO 20 IS=KT,ISM                                                   INRI-154
      JS=IST-IS                                                         INRI-155
      Q(JS,1,J)=(X(1,JS)*P(JS,3)-X(2,JS)*P(JS,4)-HX*P(JS,1)+HY*P(JS,2)-.INRI-156
     15D0*W(JS,3))/H+(V(JS,5)*W(JS,1)-V(JS,6)*W(JS,2)+W(JS,3)*(CC/R+V(JSINRI-157
     2,13))-W(JS,4)*V(JS,14))/12.D0                                     INRI-158
      Q(JS,2,J)=(X(1,JS)*P(JS,4)+X(2,JS)*P(JS,3)-HY*P(JS,1)-HX*P(JS,2)-.INRI-159
     15D0*W(JS,4))/H+(V(JS,5)*W(JS,2)+V(JS,6)*W(JS,1)+W(JS,4)*(CC/R+V(JSINRI-160
     2,13))+W(JS,3)*V(JS,14))/12.D0                                     INRI-161
      Q(JS,3,J)=(X(1,JS)*P(JS,7)-X(2,JS)*P(JS,8)-HX*P(JS,5)+HY*P(JS,6)+.INRI-162
     15D0*W(JS,1))/H+(V(JS,7)*W(JS,3)-V(JS,8)*W(JS,4)+W(JS,1)*(CC/R+V(JSINRI-163
     2,13))-W(JS,2)*V(JS,14))/12.D0                                     INRI-164
      Q(JS,4,J)=(X(1,JS)*P(JS,8)+X(2,JS)*P(JS,7)-HY*P(JS,5)-HX*P(JS,6)+.INRI-165
     15D0*W(JS,2))/H+(V(JS,7)*W(JS,4)+V(JS,8)*W(JS,3)+W(JS,2)*(CC/R+V(JSINRI-166
     2,13))+W(JS,1)*V(JS,14))/12.D0                                     INRI-167
      HX=HX+P(JS,3)*W(JS,1)-P(JS,4)*W(JS,2)+P(JS,7)*W(JS,3)-P(JS,8)*W(JSINRI-168
     1,4)                                                               INRI-169
      HY=HY+P(JS,3)*W(JS,2)+P(JS,4)*W(JS,1)+P(JS,7)*W(JS,4)+P(JS,8)*W(JSINRI-170
     1,3)                                                               INRI-171
   20 R=R-H                                                             INRI-172
C CORRECTIONS OF ORDER H**4.                                            INRI-173
      KT1=KT+3                                                          INRI-174
      ISM3=ISM-3                                                        INRI-175
      IF (KT1.GT.ISM3) GO TO 22                                         INRI-176
      HZ=H*720.D0                                                       INRI-177
      DO 21 IS=KT1,ISM3                                                 INRI-178
      Q(IS,1,J)=Q(IS,1,J)-(45.D0*(W(IS+1,3)-W(IS-1,3))-9.D0*(W(IS+2,3)-WINRI-179
     1(IS-2,3))+W(IS+3,3)-W(IS-3,3))/HZ                                 INRI-180
      Q(IS,2,J)=Q(IS,2,J)-(45.D0*(W(IS+1,4)-W(IS-1,4))-9.D0*(W(IS+2,4)-WINRI-181
     1(IS-2,4))+W(IS+3,4)-W(IS-3,4))/HZ                                 INRI-182
      Q(IS,3,J)=Q(IS,3,J)+(45.D0*(W(IS+1,1)-W(IS-1,1))-9.D0*(W(IS+2,1)-WINRI-183
     1(IS-2,1))+W(IS+3,1)-W(IS-3,1))/HZ                                 INRI-184
   21 Q(IS,4,J)=Q(IS,4,J)+(45.D0*(W(IS+1,2)-W(IS-1,2))-9.D0*(W(IS+2,2)-WINRI-185
     1(IS-2,2))+W(IS+3,2)-W(IS-3,2))/HZ                                 INRI-186
   22 IF (KT.EQ.1) GO TO 24                                             INRI-187
      K=KT-1                                                            INRI-188
      DO 23 IS=1,K                                                      INRI-189
      Q(IS,1,J)=-(HX*P(IS,1)-HY*P(IS,2))/H                              INRI-190
      Q(IS,2,J)=-(HY*P(IS,1)+HX*P(IS,2))/H                              INRI-191
      Q(IS,3,J)=-(HX*P(IS,5)-HY*P(IS,6))/H                              INRI-192
   23 Q(IS,4,J)=-(HY*P(IS,5)+HX*P(IS,6))/H                              INRI-193
   24 DO 25 KT=1,ISM                                                    INRI-194
      IF ((DABS(Q(KT,1,J))+DABS(Q(KT,2,J))+DABS(Q(KT,3,J))+DABS(Q(KT,4,JINRI-195
     1))).GT.ACONV) GO TO 26                                            INRI-196
   25 CONTINUE                                                          INRI-197
   26 IPI(J)=KT                                                         INRI-198
      IF (LO(22)) GO TO 27                                              INRI-199
      PAD1(1,KITER)=A                                                   INRI-200
      PAD1(2,KITER)=B                                                   INRI-201
C  TEST OF CONVERGENCE.                                                 INRI-202
   27 LO(105)=(DABS(B-FAI(1)).LE.EITER.AND.(DABS(A-FAR(1)).LE.EITER))   INRI-203
      IF ((.NOT.LO(22)).AND.LO(104).AND.KITER.GT.3.AND.(.NOT.LO(105))) CINRI-204
     1ALL PADE(PAD1,PAD2,KITER,A,B,EITER,1.D0,0.D0,LO)                  INRI-205
      LO(104)=LO(104).AND.LO(105)                                       INRI-206
      FAR(1)=A                                                          INRI-207
      FAI(1)=B                                                          INRI-208
      IF (LO(57)) WRITE (MW,1000) J,FAR(1),FAI(1),KITER,KT              INRI-209
      RETURN                                                            INRI-210
   28 IF (LO(22)) RETURN                                                INRI-211
      PAD1(1,KITER)=0.D0                                                INRI-212
      PAD1(2,KITER)=0.D0                                                INRI-213
      RETURN                                                            INRI-214
 1000 FORMAT (5X,I5,2D30.15,I10,10X,I5)                                 INRI-215
      END                                                               INRI-216
C 12/02/06                                                      ECIS06  PADE-000
      SUBROUTINE PADE(R,P,MM,BRE,BIM,EITER,VLR,VLI,LO)                  PADE-001
C  PADE APPROXIMANT OF TYPE I, CONTINUED FRACTION.                      PADE-002
C INPUT:     R:       PARTIAL TAYLOR SUMS.                              PADE-003
C            MM:      NUMBER OF COMPONENTS OF P.                        PADE-004
C            EITER:   CONVERGENCE CRITERION.                            PADE-005
C            VLR,VLI: VARIABLE   HERE TAKEN AS (1.D0,0.D0).             PADE-006
C            LO(I):   LOGICAL CONTROLS:                                 PADE-007
C               LO(23) =.TRUE. NO USE OF PADE AND SHIFT TO USUAL COUPLEDPADE-008
C                              EQUATIONS WHEN THERE IS NO CONVERGENCE.  PADE-009
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   PADE-010
C               LO(105)=.TRUE. CONVERGENCE OBTAINED FOR THIS EQUATION.  PADE-011
C               LO(106)=.TRUE. WHEN THE ITERATION IS NOT THE LAST ONE   PADE-012
C                              ALLOWED.                                 PADE-013
C OUTPUT:    BRE,BIM: RESULT IF CONVERGENCE IS OBTAINED.                PADE-014
C WORKING AREA:                                                         PADE-015
C            P:       AT LEAST TWICE AS LONG AS R.                      PADE-016
C***********************************************************************PADE-017
      IMPLICIT REAL*8 (A-H,O-Z)                                         PADE-018
      DIMENSION R(2,MM),P(2,2,MM)                                       PADE-019
      LOGICAL LO(150)                                                   PADE-020
      COMMON /INOUT/ MR,MW,MS                                           PADE-021
      LO(105)=.TRUE.                                                    PADE-022
      IF (MM.GT.3) GO TO 1                                              PADE-023
      LO(105)=.FALSE.                                                   PADE-024
      RETURN                                                            PADE-025
C TAYLOR COEFFICIENTS.                                                  PADE-026
    1 MT=MM+1                                                           PADE-027
      P(1,1,1)=R(1,1)                                                   PADE-028
      P(1,2,1)=0.D0                                                     PADE-029
      P(2,1,1)=R(2,1)                                                   PADE-030
      P(2,2,1)=0.D0                                                     PADE-031
      DO 2 I=2,MM                                                       PADE-032
      P(1,1,I)=R(1,I)-R(1,I-1)                                          PADE-033
      P(1,2,I)=0.D0                                                     PADE-034
      P(2,1,I)=R(2,I)-R(2,I-1)                                          PADE-035
    2 P(2,2,I)=0.D0                                                     PADE-036
C DECOMPOSITION LOOP.                                                   PADE-037
      NM=MM-1                                                           PADE-038
      DO 6 NA=1,NM                                                      PADE-039
      ML=MM-NA                                                          PADE-040
      ZR=P(1,1,NA)                                                      PADE-041
      ZI=P(2,1,NA)                                                      PADE-042
      IF (DABS(ZR)+DABS(ZI).GE.1.D-8) GO TO 4                           PADE-043
      P(1,2,MT-NA)=0.D0                                                 PADE-044
      P(2,2,MT-NA)=0.D0                                                 PADE-045
      DO 3 J=1,ML                                                       PADE-046
      P(1,1,NA+J)=P(1,1,NA+J)-P(1,1,NA)*P(1,2,J)+P(2,1,NA)*P(2,2,J)     PADE-047
    3 P(2,1,NA+J)=P(2,1,NA+J)-P(2,1,NA)*P(1,2,J)-P(1,1,NA)*P(2,2,J)     PADE-048
      GO TO 6                                                           PADE-049
    4 P(1,2,MT-NA)=1.D0                                                 PADE-050
      DO 5 J=1,ML                                                       PADE-051
      ZX=P(1,1,NA)**2+P(2,1,NA)**2                                      PADE-052
      ZR=(P(1,1,NA+J)*P(1,1,NA)+P(2,1,NA+J)*P(2,1,NA))/ZX               PADE-053
      ZI=(P(2,1,NA+J)*P(1,1,NA)-P(1,1,NA+J)*P(2,1,NA))/ZX               PADE-054
      P(1,1,NA+J)=P(1,2,J)-ZR                                           PADE-055
      P(2,1,NA+J)=P(2,2,J)-ZI                                           PADE-056
      P(1,2,J)=ZR                                                       PADE-057
    5 P(2,2,J)=ZI                                                       PADE-058
    6 CONTINUE                                                          PADE-059
      AR1=1.D30                                                         PADE-060
C TRUNCATED CONTINUED FRACTIONS.                                        PADE-061
      DO 9  N=1,NM                                                      PADE-062
      IP=MM+1-N                                                         PADE-063
      P(1,2,N)=P(1,1,IP)                                                PADE-064
      P(2,2,N)=P(2,1,IP)                                                PADE-065
      DO 8  I=2,IP                                                      PADE-066
      ID=IP+1-I                                                         PADE-067
      IF (P(1,2,MT-ID).GT.0.D0) GO TO 7                                 PADE-068
      AR=VLR*P(1,2,N)-VLI*P(2,2,N)+P(1,1,ID)                            PADE-069
      AI=VLR*P(2,2,N)+VLI*P(1,2,N)+P(2,1,ID)                            PADE-070
      P(1,2,N)=AR                                                       PADE-071
      P(2,2,N)=AI                                                       PADE-072
      GO TO 8                                                           PADE-073
    7 AR=1.D0+VLR*P(1,2,N)-VLI*P(2,2,N)                                 PADE-074
      AI=VLR*P(2,2,N)+VLI*P(1,2,N)                                      PADE-075
      ZX=AR*AR+AI*AI                                                    PADE-076
      P(1,2,N)=(P(1,1,ID)*AR+P(2,1,ID)*AI)/ZX                           PADE-077
      P(2,2,N)=(P(2,1,ID)*AR-P(1,1,ID)*AI)/ZX                           PADE-078
    8 CONTINUE                                                          PADE-079
      IF (N.EQ.1) GO TO 9                                               PADE-080
C SEARCH FOR SMALLEST DIFFERENCE.                                       PADE-081
      ZR=P(1,2,N)-P(1,2,N-1)                                            PADE-082
      ZI=P(2,2,N)-P(2,2,N-1)                                            PADE-083
      AI1=DMAX1(DABS(ZR),DABS(ZI))                                      PADE-084
      IF (AI1.GE.AR1) GO TO 9                                           PADE-085
      NN=N                                                              PADE-086
      AR1=AI1                                                           PADE-087
    9 CONTINUE                                                          PADE-088
      LO(105)=AR1.LE.EITER                                              PADE-089
      IF (LO(57)) WRITE (MW,1000) LO(105),MM,NN,P(1,2,NN),P(2,2,NN),P(1,PADE-090
     12,NN-1),P(2,2,NN-1)                                               PADE-091
      IF ((.NOT.LO(105)).AND.(LO(106).OR.LO(23))) RETURN                PADE-092
      LO(105)=.TRUE.                                                    PADE-093
      BRE=P(1,2,NN-1)                                                   PADE-094
      BIM=P(2,2,NN-1)                                                   PADE-095
      IF (NN.EQ.2) RETURN                                               PADE-096
      BRE=0.5D0*(BRE+P(1,2,NN))                                         PADE-097
      BIM=0.5D0*(BIM+P(2,2,NN))                                         PADE-098
      RETURN                                                            PADE-099
 1000 FORMAT (' PADE',5X,L3,5X,'ITER =',I3,5X,'N =',I3,5X,4D15.8)       PADE-100
      END                                                               PADE-101
C 08/03/07                                                      ECIS06  INCH-000
      SUBROUTINE INCH(V,MC,NAT,AT,LMD,NVI,FAM,Y,X,W,ISM,KAB,NC,NCIN,NML,INCH-001
     1JSX,KR,LO)                                                        INCH-002
C  STANDARD INTEGRATION OF THE COUPLED  EQUATIONS BY THE NUMEROV METHOD.INCH-003
C INPUT:     V:       POTENTIALS AND COUPLINGS.                         INCH-004
C            MC(*,J): ADDRESS OF CENTRAL POTENTIALS FOR J=4.            INCH-005
C            NAT,AT:  GEOMETRICAL COEFFICIENTS.                         INCH-006
C            LMD:     FIRST DIMENSION OF TABLES NAT AND AT.             INCH-007
C            NVI:     ADDRESSES IN THE TABLE NAT,AT.                    INCH-008
C            FAM:     MATCHING VALUES AND CONSTANTS OF EQUATIONS.       INCH-009
C            Y:       COULOMB CORRECTIONS.                              INCH-010
C            ISM:     NUMBER OF RADIAL POINTS.                          INCH-011
C            KAB:     MAXIMUM NUMBER OF COUPLED CHANNELS.               INCH-012
C            NC:      NUMBER OF COUPLED CHANNELS.                       INCH-013
C            NCIN:    NUMBER OF SOLUTIONS.                              INCH-014
C            NML:     MAXIMUM NUMBER OF POINTS WHERE THE COUPLING       INCH-015
C                     POTENTIALS CAN BE CALCULATED AT A TIME.           INCH-016
C            JSX:     PERIODICITY OF THE SCHMIDT'S ORTHOGONALISATION    INCH-017
C                     IF LO(42) IS .TRUE..                              INCH-018
C            LO(I):   LOGICAL CONTROLS:                                 INCH-019
C               LO(26) =.TRUE. INTEGRATION STABILISED FOR LONG RANGE    INCH-020
C                              CONSTANT POTENTIAL.                      INCH-021
C               LO(42) =.TRUE. SCHMIDT'S ORTHOGONALISATION OF SOLUTIONS INCH-022
C                              IN USUAL COUPLED EQUATIONS.              INCH-023
C               LO(44) =.TRUE. COULOMB CORRECTIONS.                     INCH-024
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   INCH-025
C               LO(74) =.TRUE. OUTPUT OF TIME IN DIFFERENT STEPS.       INCH-026
C               LO(103)=.TRUE. THERE IS A COULOMB SPIN-ORBIT POTENTIAL. INCH-027
C               LO(129)=.TRUE. REAL SPIN-ORBIT OR DIRAC EQUATION.       INCH-028
C               LO(130)=.TRUE. IMAGINARY SPIN-ORBIT OR DIRAC EQUATION.  INCH-029
C               LO(133)=.TRUE. STORE SCALAR AND COULOMB POTENTIAL       INCH-030
C                              INDEPENDENTLY.                           INCH-031
C OUTPUT:    X:       SCATTERING COEFFICIENTS MULTIPLIED KF/KI          INCH-032
C                     REAL PART IN X(IC,IC',5), IMAGINARY PART IN       INCH-033
C                     X(IC,IC',2) FOR INCOMING CHANNEL IC'.             INCH-034
C WORKING AREAS:                                                        INCH-035
C            W:       REAL/IMAGINARY COUPLING POTENTIALS.               INCH-036
C            X:       NUMEROV RECURRENCE.                               INCH-037
C            KR:      WORKING FIELD FOR LINS.                           INCH-038
C                                                                       INCH-039
C FOR THE COMMON  /POTE2/ SEE REDM.                                     INCH-040
C                                                                       INCH-041
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /POTE2/:                     INCH-042
C  ITY(2):    STARTING ADDRESS OF IMAGINARY CENTRAL POTENTIAL.          INCH-043
C  ITY(3):    STARTING ADDRESS OF REAL SPIN-ORBIT POTENTIAL.            INCH-044
C  ITY(4):    STARTING ADDRESS OF IMAGINARY SPIN-ORBIT POTENTIAL.       INCH-045
C  ITY(9):    STARTING ADDRESS OF COULOMB CENTRAL POTENTIAL.            INCH-046
C  ITY(10):   STARTING ADDRESS OF COULOMB SPIN-ORBIT POTENTIAL.         INCH-047
C   USED:     ITY(2),ITY(3),ITY(4),ITY(9),ITY(10).                      INCH-048
C                                                                       INCH-049
C***********************************************************************INCH-050
      IMPLICIT REAL*8 (A-H,O-Z)                                         INCH-051
      LOGICAL LO(150)                                                   INCH-052
      DIMENSION V(ISM,*),MC(KAB,6),NAT(2*LMD,*),AT(LMD,*),NVI(KAB,KAB,2)INCH-053
     1,FAM(KAB,12),Y(KAB,KAB,4),X(KAB,KAB,6),W(2,NC,NC,*),KR(*)         INCH-054
      COMMON /INOUT/ MR,MW,MS                                           INCH-055
      COMMON /POTE2/ ITY(12),INVT,INTV,INSL,NPX                         INCH-056
      IF (LO(74)) CALL HORA                                             INCH-057
      JR=0                                                              INCH-058
      DO 3 I=1,NC                                                       INCH-059
      DO 2 J=1,NC                                                       INCH-060
      DO 1 K=1,6                                                        INCH-061
    1 X(J,I,K)=0.D0                                                     INCH-062
    2 CONTINUE                                                          INCH-063
    3 X(I,I,3)=1.D-15                                                   INCH-064
C  RADIAL INTEGRATION LOOP.                                             INCH-065
      DO 40 JS=1,ISM                                                    INCH-066
      IS=MOD(JS-1,NML)+1                                                INCH-067
      IF (JS.LE.JR) GO TO 26                                            INCH-068
      JI=JR+1                                                           INCH-069
      M=JS-JI                                                           INCH-070
      JR=MIN0(ISM,JR+NML)                                               INCH-071
C THE POTENTIALS ARE FIRST CALCULATED IN W(1,IC,IC',I) AND              INCH-072
C W(2,IC,IC',I) STARTING WITH I=2   FOR IC LARGER OR EQUAL TO IC'.      INCH-073
      DO 19 L=1,NC                                                      INCH-074
      DO 18 J=L,NC                                                      INCH-075
      DO 4 I=JI,JR                                                      INCH-076
      W(1,J,L,I+1)=0.D0                                                 INCH-077
    4 W(2,J,L,I+1)=0.D0                                                 INCH-078
      IF (L.NE.J) GO TO 12                                              INCH-079
C OPTICAL MODEL CONTRIBUTION.                                           INCH-080
      I1=MC(L,4)                                                        INCH-081
      I2=I1+ITY(2)                                                      INCH-082
      DO 5 I=JI,JR                                                      INCH-083
      W(1,J,L,I+1)=FAM(L,8)-FAM(L,10)/DFLOAT(I+M)**2+FAM(L,7)*V(I+M,I1) INCH-084
    5 W(2,J,L,I+1)=FAM(L,7)*V(I+M,I2)                                   INCH-085
      IF (.NOT.LO(129)) GO TO 8                                         INCH-086
      I2=I1+ITY(3)                                                      INCH-087
      DO 6 I=JI,JR                                                      INCH-088
    6 W(1,J,L,I+1)=W(1,J,L,I+1)+FAM(L,9)*V(I+M,I2)                      INCH-089
      IF (.NOT.LO(130)) GO TO 8                                         INCH-090
      I2=I1+ITY(4)                                                      INCH-091
      DO 7 I=JI,JR                                                      INCH-092
    7 W(2,J,L,I+1)=W(2,J,L,I+1)+FAM(L,9)*V(I+M,I2)                      INCH-093
    8 IF (.NOT.LO(133)) GO TO 12                                        INCH-094
      IF (FAM(L,11).EQ.0.D0) GO TO 10                                   INCH-095
      I2=I1+ITY(9)                                                      INCH-096
      DO 9 I=JI,JR                                                      INCH-097
    9 W(1,J,L,I+1)=W(1,J,L,I+1)+FAM(L,11)*V(I+M,I2)                     INCH-098
   10 IF (.NOT.LO(103)) GO TO 12                                        INCH-099
      I2=I1+ITY(10)                                                     INCH-100
      DO 11 I=JI,JR                                                     INCH-101
   11 W(1,J,L,I+1)=W(1,J,L,I+1)+FAM(L,12)*V(I+M,I2)                     INCH-102
C COUPLED CHANNEL CONTRIBUTION.                                         INCH-103
   12 K1=NVI(J,L,1)                                                     INCH-104
      K2=NVI(J,L,2)                                                     INCH-105
      IF (K1.GT.K2) GO TO 18                                            INCH-106
      DO 17 K=K1,K2                                                     INCH-107
      KT=NAT(1,K)                                                       INCH-108
      KU=NAT(2,K)                                                       INCH-109
      DO 13 I=JI,JR                                                     INCH-110
   13 W(1,J,L,I+1)=W(1,J,L,I+1)+AT(2,K)*V(I+M,KT)                       INCH-111
      IF (NAT(2,K).EQ.0) GO TO 15                                       INCH-112
      KU=NAT(2,K)+ITY(2)                                                INCH-113
      DO 14 I=JI,JR                                                     INCH-114
   14 W(2,J,L,I+1)=W(2,J,L,I+1)+AT(2,K)*V(I+M,KU)                       INCH-115
   15 IF (.NOT.LO(133)) GO TO 17                                        INCH-116
      IF (AT(3,K).EQ.0.D0) GO TO 17                                     INCH-117
      KU=KT+ITY(11)                                                     INCH-118
      DO 16 I=JI,JR                                                     INCH-119
   16 W(1,J,L,I+1)=W(1,J,L,I+1)+AT(3,K)*V(I+M,KU)                       INCH-120
   17 CONTINUE                                                          INCH-121
   18 CONTINUE                                                          INCH-122
   19 CONTINUE                                                          INCH-123
      JJ=JR-JI+1                                                        INCH-124
      DO 25 I=1,JJ                                                      INCH-125
      J=I+1                                                             INCH-126
C SYMMETRISATION OF OLD VALUES.                                         INCH-127
      DO 21 K=1,NC                                                      INCH-128
      DO 20 L=K,NC                                                      INCH-129
      W(1,K,L,J)=W(1,L,K,J)                                             INCH-130
   20 W(2,K,L,J)=W(2,L,K,J)                                             INCH-131
   21 CONTINUE                                                          INCH-132
C COMPUTATION OF V +V*V/12. FOR L LARGER OR EQUAL TO K.                 INCH-133
      DO 24 K=1,NC                                                      INCH-134
      DO 23 L=K,NC                                                      INCH-135
      BRE=0.D0                                                          INCH-136
      BIM=0.D0                                                          INCH-137
      DO 22 N=1,NC                                                      INCH-138
      BRE=BRE-W(1,N,K,J)*W(1,N,L,J)+W(2,N,K,J)*W(2,N,L,J)               INCH-139
   22 BIM=BIM-W(2,N,K,J)*W(1,N,L,J)-W(1,N,K,J)*W(2,N,L,J)               INCH-140
C SYMMETRISATION.                                                       INCH-141
      W(1,L,K,I)=W(1,L,K,J)+BRE/12.D0                                   INCH-142
      W(2,L,K,I)=W(2,L,K,J)+BIM/12.D0                                   INCH-143
      W(1,K,L,I)=W(1,L,K,I)                                             INCH-144
   23 W(2,K,L,I)=W(2,L,K,I)                                             INCH-145
      IF (LO(26)) W(1,K,K,I)=W(1,K,K,I)+W(1,K,K,J)**3/360.D0            INCH-146
   24 CONTINUE                                                          INCH-147
   25 CONTINUE                                                          INCH-148
   26 DO 33 I=1,NC                                                      INCH-149
      DO 27 J=1,NC                                                      INCH-150
      X(I,J,1)=X(I,J,2)                                                 INCH-151
      X(I,J,2)=X(I,J,3)                                                 INCH-152
      X(I,J,4)=X(I,J,5)                                                 INCH-153
   27 X(I,J,5)=X(I,J,6)                                                 INCH-154
   28 DO 30 J=1,NC                                                      INCH-155
      HX=0.D0                                                           INCH-156
      HY=0.D0                                                           INCH-157
      DO 29 K=1,NC                                                      INCH-158
      HX=HX+W(1,K,J,IS)*X(I,K,2)-W(2,K,J,IS)*X(I,K,5)                   INCH-159
   29 HY=HY+W(2,K,J,IS)*X(I,K,2)+W(1,K,J,IS)*X(I,K,5)                   INCH-160
      X(I,J,3)=X(I,J,2)+X(I,J,2)-X(I,J,1)-HX                            INCH-161
   30 X(I,J,6)=X(I,J,5)+X(I,J,5)-X(I,J,4)-HY                            INCH-162
      IF (DABS(X(I,I,3)).LT.1.D15) GO TO 33                             INCH-163
      DO 32 JI=1,6                                                      INCH-164
      DO 31 IJ=1,NC                                                     INCH-165
   31 X(I,IJ,JI)=X(I,IJ,JI)*1.D-30                                      INCH-166
   32 CONTINUE                                                          INCH-167
      GO TO 28                                                          INCH-168
   33 CONTINUE                                                          INCH-169
      IF (.NOT.(LO(42).AND.(MOD(JS,JSX).EQ.0).AND.(JS.NE.ISM))) GO TO 40INCH-170
C  SCHMIDT ORTHOGONALISATION PROCEDURE EVERY JSX STEPS.                 INCH-171
      DO 39 I=1,NC                                                      INCH-172
      IF (I.EQ.1) GO TO 37                                              INCH-173
      IM=I-1                                                            INCH-174
      DO 36 K=1,IM                                                      INCH-175
      X(I,K,1)=0.D0                                                     INCH-176
      X(I,K,4)=0.D0                                                     INCH-177
      DO 34 J=1,NC                                                      INCH-178
      X(I,K,1)=X(I,K,1)+X(K,J,2)*X(I,J,2)-X(K,J,5)*X(I,J,5)             INCH-179
   34 X(I,K,4)=X(I,K,4)+X(K,J,5)*X(I,J,2)+X(K,J,2)*X(I,J,5)             INCH-180
      BRE=X(I,K,1)*X(K,K,1)-X(I,K,4)*X(K,K,4)                           INCH-181
      BIM=X(I,K,1)*X(K,K,4)+X(I,K,4)*X(K,K,1)                           INCH-182
      DO 35 J=1,NC                                                      INCH-183
      X(I,J,2)=X(I,J,2)-BRE*X(K,J,2)+BIM*X(K,J,5)                       INCH-184
      X(I,J,5)=X(I,J,5)-BRE*X(K,J,5)-BIM*X(K,J,2)                       INCH-185
      X(I,J,3)=X(I,J,3)-BRE*X(K,J,3)+BIM*X(K,J,6)                       INCH-186
   35 X(I,J,6)=X(I,J,6)-BRE*X(K,J,6)-BIM*X(K,J,3)                       INCH-187
   36 CONTINUE                                                          INCH-188
   37 BRE=0.D0                                                          INCH-189
      BIM=0.D0                                                          INCH-190
      DO 38 J=1,NC                                                      INCH-191
      BRE=BRE+X(I,J,2)**2-X(I,J,5)**2                                   INCH-192
   38 BIM=BIM+2.D0*X(I,J,2)*X(I,J,5)                                    INCH-193
      BIM=BIM/BRE                                                       INCH-194
      X(I,I,1)=1.D0/(BRE*(1.D0+BIM**2))                                 INCH-195
   39 X(I,I,4)=-X(I,I,1)*BIM                                            INCH-196
   40 CONTINUE                                                          INCH-197
      IF (LO(74)) CALL HORA                                             INCH-198
C  MATRICES OF PSEUDO-WRONSKIANS FOR THE MATCHING CONDITION.            INCH-199
      DO 42 I=1,NC                                                      INCH-200
      DO 41 J=1,NC                                                      INCH-201
      X(I,J,2)=(X(I,J,1)*FAM(J,2)-FAM(J,1)*X(I,J,3))                    INCH-202
      X(I,J,5)=(X(I,J,6)*FAM(J,1)-FAM(J,2)*X(I,J,4))                    INCH-203
      X(I,J,1)=(X(I,J,3)*FAM(J,3)-FAM(J,4)*X(I,J,1))                    INCH-204
      X(I,J,4)=(X(I,J,4)*FAM(J,4)-FAM(J,3)*X(I,J,6))                    INCH-205
      IF (FAM(J,8).LT.0.D0) GO TO 41                                    INCH-206
      X(I,J,1)=X(I,J,1)-X(I,J,5)                                        INCH-207
      X(I,J,4)=X(I,J,4)+X(I,J,2)                                        INCH-208
   41 CONTINUE                                                          INCH-209
   42 CONTINUE                                                          INCH-210
C  COMPLEX LINEAR SYSTEM OF EQUATIONS.                                  INCH-211
      NCX=NCIN                                                          INCH-212
      IF (LO(44)) NCX=NC                                                INCH-213
      CALL LINS(X(1,1,4),KAB,X,KAB,X(1,1,5),KAB,X(1,1,2),KAB,NC,NCX,KR,IINCH-214
     1ER)                                                               INCH-215
      IF (IER.NE.0) GO TO 48                                            INCH-216
      IF (.NOT.LO(44)) RETURN                                           INCH-217
C BUILDING THE LINEAR SYSTEM FOR S-MATRIX WITH COULOMB CORRECTIONS.     INCH-218
      DO 45 I=1,NC                                                      INCH-219
      DO 44 J=1,NC                                                      INCH-220
      X(I,J,1)=Y(J,I,1)                                                 INCH-221
      X(I,J,3)=X(I,J,2)                                                 INCH-222
      X(I,J,4)=Y(J,I,2)                                                 INCH-223
      X(I,J,6)=-Y(J,I,1)+X(I,J,5)                                       INCH-224
      DO 43 K=1,NC                                                      INCH-225
      X(I,J,1)=X(I,J,1)-(Y(J,K,1)-Y(J,K,4))*X(I,K,2)+(Y(J,K,3)+Y(J,K,2))INCH-226
     1*X(I,K,5)                                                         INCH-227
      X(I,J,3)=X(I,J,3)-Y(J,K,3)*X(I,K,2)-Y(J,K,1)*X(I,K,5)             INCH-228
      X(I,J,4)=X(I,J,4)-(Y(J,K,1)-Y(J,K,4))*X(I,K,5)-(Y(J,K,2)+Y(J,K,3))INCH-229
     1*X(I,K,2)                                                         INCH-230
   43 X(I,J,6)=X(I,J,6)-Y(J,K,3)*X(I,K,5)+Y(J,K,1)*X(I,K,2)             INCH-231
   44 CONTINUE                                                          INCH-232
   45 X(I,I,4)=X(I,I,4)+1.D0                                            INCH-233
C TRANSFER OF THE SECOND MEMBERS IN X(1,1,5) AND X(1,1,2).              INCH-234
      DO 47 I=1,NC                                                      INCH-235
      DO 46 J=1,NC                                                      INCH-236
      Y(I,J,2)=X(I,J,2)                                                 INCH-237
      X(I,J,2)=X(I,J,3)                                                 INCH-238
      Y(I,J,1)=X(I,J,5)                                                 INCH-239
   46 X(I,J,5)=X(I,J,6)                                                 INCH-240
   47 CONTINUE                                                          INCH-241
      CALL LINS(X(1,1,4),KAB,X,KAB,X(1,1,5),KAB,X(1,1,2),KAB,NC,NCIN,KR INCH-242
     1,IER)                                                             INCH-243
      IF (IER.NE.0) GO TO 48                                            INCH-244
      IF (LO(57)) WRITE (MW,1000) ((I,J,Y(I,J,1),Y(I,J,2),X(I,J,5),X(I,JINCH-245
     1,2),J=1,NCIN),I=1,NC)                                             INCH-246
      RETURN                                                            INCH-247
   48 WRITE (MW,1001) IER                                               INCH-248
      STOP                                                              INCH-249
 1000 FORMAT (/25X,'UNCORRECTED VALUES',30X,'CORRECTED VALUES'/(2X,2I3,4INCH-250
     1D25.15))                                                          INCH-251
 1001 FORMAT (' RETURN FROM LINS WITH IER =',I2///' IN INCH  ...  STOP  INCH-252
     1...')                                                             INCH-253
      END                                                               INCH-254
C 03/03/07                                                      ECIS06  SCAM-000
      SUBROUTINE SCAM(F,FCN,TX,GCN,JMAX,KMAX,MC,MD,FAR,FAI,WV,NCOLL,NCOLSCAM-001
     1S,KAB,KBA,IPI,IPIM,GAM,FISS,TL,NCJ,XD,P,Q,V,NCT,IQ,AA,KBC,IDT,LO) SCAM-002
C STORAGE OF SCATTERING COEFFICIENTS.                                   SCAM-003
C INPUT:     JMAX:    MAXIMUM NUMBER OF CHANNEL SPINS, DIMENSION FOR F. SCAM-004
C            KMAX:    MAXIMUM NUMBER OF L OF COMPOUND NUCLEUS,          SCAM-005
C                     DIMENSION FOR FCN, GCN.                           SCAM-006
C            MC:      NUCLEAR STATE NUMBERS, ANGULAR MOMENTA,  SEE QUAN.SCAM-007
C            MD:      EXTENDED MC FOR IDENTICAL PARTICLES WITH SPIN.    SCAM-008
C            FAR/FAI: REAL/IMAGINARY PART OF SCATTERING COEFFICIENTS.   SCAM-009
C            WV:      WAVE NUMBER AND COULOMB PARAMETER.  SEE COLF.     SCAM-010
C            NCOLL:   NUMBER OF COUPLED LEVELS.                         SCAM-011
C            NCOLS:   NUMBER OF LEVELS WITH ANGULAR DISTRIBUTION.       SCAM-012
C            KAB:     DIMENSION FOR MC.                                 SCAM-013
C            KBA:     NUMBER OF INDEPENDENT AMPLITUDES.                 SCAM-014
C            IPI:     PARITY, MULTIPLICITIES, ADDRESSES IN F (SEE CALX).SCAM-015
C            IPIM:    IPI FOR CONTINUA OF COMPOUND NUCLEUS.             SCAM-016
C            GAM:     GAMMA TRANSMISSION COEFFICIENTS READ.             SCAM-017
C            FISS:    FISSION COEFFICIENTS FOR COMPOUND NUCLEUS.        SCAM-018
C            TL:      TRANSMISSION COEFFICIENTS OF UNCOUPLED LEVELS.    SCAM-019
C            NCJ:     STARTING AND FINAL ADDRESSES FOR CONTINUA.        SCAM-020
C            XD:      ENERGY AND SPIN DEPENDENCE OF LEVEL DENSITIES.    SCAM-021
C            NCT:     NUMBER OF EQUATIONS AND SOLUTIONS FOR EACH PARITY.SCAM-022
                                                                        SCAM-023
C            IQ:      DIMENSION FOR V.                                  SCAM-024
C            AA:      COEFFICIENTS OF SYMMETRISATION.                   SCAM-025
C            KBC:     DIMENSION FOR AA.                                 SCAM-026
C            IDT:     SIZE AVAILABLE FOR THE Q IN DOUBLE PRECISION.     SCAM-027
C            LO(I):   LOGICAL CONTROLS:                                 SCAM-028
C               LO(18) =.TRUE. PROJECTILE-TARGET ANTISYMMETRISATION.    SCAM-029
C               LO(55) =.TRUE. OUTPUT OF C-MATRIX ELEMENTS AND OF       SCAM-030
C                              COMPOUND NUCLEUS INTERMEDIATE RESULTS.   SCAM-031
C               LO(63) =.TRUE. PENETRABILITIES WRITTEN ON FILE 63.      SCAM-032
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         SCAM-033
C               LO(83) =.TRUE. NO ENGELBRETCH-WEIDENMULLER TRANSFORM.   SCAM-034
C               LO(85) =.TRUE. FISSION TRANSMISSION COEFFICIENTS.       SCAM-035
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      SCAM-036
C               LO(87) =.TRUE. NO WIDTH FLUCTUATIONS.                   SCAM-037
C               LO(123)=.TRUE. IDENTICAL PARTICLES WITH SPIN.           SCAM-038
C               LO(124)=.TRUE. COMPUTE TRANSMISSION COEFFICIENTS.       SCAM-039
C               LO(125)=.TRUE. USUAL COUPLED EQUATIONS.                 SCAM-040
C               LO(131)=.TRUE. TOTAL SPIN IS TOO LARGE FOR COMPOUND     SCAM-041
C                              NUCLEUS.                                 SCAM-042
C               LO(132)=.TRUE. STORE FISSION AND GAMMA TRANSMISSION     SCAM-043
C                              COEFFICIENTS FOR INTERPOLATION.          SCAM-044
C OUTPUT:    F:       SCATTERING COEFFICIENTS.                          SCAM-045
C            FCN:     COMPOUND NUCLEUS CONTRIBUTIONS.                   SCAM-046
C            TX:      TOTAL REACTION CROSS SECTION IN MB FOLLOWED BY    SCAM-047
C                     THE TOTAL DIRECT CROSS SECTIONS OF COUPLED        SCAM-048
C                     LEVELS, THE TOTAL COMPOUND CROSS SECTIONS OF      SCAM-049
C                     LEVELS, THE FISSION AND GAMMA CROSS SECTIONS.     SCAM-050
C            GCN:     COMPOUND NUCLEUS COEFFICIENTS OF LEGENDRE         SCAM-051
C                     POLYNOMIALS.                                      SCAM-052
C WORKING AREAS:                                                        SCAM-053
C            P:       FOR DIAGONALISATION OF THE S MATRIX.              SCAM-054
C            Q:       FOR ANGULAR DISTRIBUTION OF COMPOUND NUCLEUS.     SCAM-055
C            V(1,*):  LEVEL AND QUANTUM NUMBERS.                        SCAM-056
C            V(2,*):  WEIGH FOR CONTINUA.                               SCAM-057
C            V(3,*):  TRANSMISSION COEFFICIENTS.                        SCAM-058
C            V(4,*):  WIDTH FLUCTUATION PARAMETER.                      SCAM-059
C            V(5,*):  CONTRIBUTION TO COMPOUND NUCLEUS.                 SCAM-060
C                                                                       SCAM-061
C FOR THE COMMON  /DCONS/ SEE CALC.                                     SCAM-062
C FOR THE COMMON  /NCOMP/ SEE CALX.                                     SCAM-063
C FOR THE COMMON  /NOEQU/ SEE QUAN.                                     SCAM-064
C                                                                       SCAM-065
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     SCAM-066
C  XZ:        CONVERSION FACTOR TO MILLIBARNS.                          SCAM-067
C   USED:     XZ.                                                       SCAM-068
C                                                                       SCAM-069
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     SCAM-070
C  NFISS:     NUMBER OF FISSION TRANSMISSION COEFFICIENTS.              SCAM-071
C  NRD:       NUMBER OF GAMMA TRANSMISSION COEFFICIENTS.                SCAM-072
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 SCAM-073
C  NCOJ:      NUMBER OF SPINS OF THE TARGET FOR A CONTINUUM.            SCAM-074
C  NCOLX:     TOTAL NUMBER OF LEVELS WITHOUT DISCRETISATION.            SCAM-075
C  NDP:       ADDRESS OF FISSION AND GAMMA FINAL RESULTS.               SCAM-076
C  NDQ:       ADDRESS OF FISSION AND GAMMA INTERMEDIATE RESULTS.        SCAM-077
C  BZ:        HAUSER-FESHBACH AND MOLDAUER'S PARAMETERS DESCRIBED BELOW.SCAM-078
C   BZ(1):    SQUARE ROOT OF ELASTIC ENHANCEMENT.                       SCAM-079
C   BZ(2):    IF LO(82)=.TRUE., SPIN CUT-OFF PARAMETER.                 SCAM-080
C             IF LO(82)=.FALSE., PARTICLE DEGREES OF FREEDOM.           SCAM-081
C   BZ(3):    SQUARE ROOT OF LEVEL DENSITY PARAMETER. IF LO(82)=LO(87)= SCAM-082
C             .FALSE., PARAMETER BZ(3) IN MOLDAUER'S FORMULA OF INPUT   SCAM-083
C             DESCRIPTION.                                              SCAM-084
C   BZ(4):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(4) IN SAME FORMULA.SCAM-085
C   BZ(5):    IF LO(82)=LO(87)=.FALSE., PARAMETER BZ(5) IN SAME FORMULA.SCAM-086
C  FNUG:      RADIATIVE DEGREES OF FREEDOM.                             SCAM-087
C  TG1:       DERIVED DATA FOR GAMMA IN COMPOUND NUCLEUS.               SCAM-088
C  SGSQ:      DERIVED DATA FOR GAMMA IN COMPOUND NUCLEUS.               SCAM-089
C   USED:     NFISS,NRD,NCONT,NCOJ,NCOLX,NDP,NDQ,BZ,FNUG,TG1,SGSQ       SCAM-090
C                                                                       SCAM-091
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NOEQU/:                     SCAM-092
C  NIC:       NUMBER OF EQUATIONS AT THE CHANNEL SPIN.                  SCAM-093
C  NCI:       NUMBER OF SOLUTIONS AT THE CHANNEL SPIN.                  SCAM-094
C  NC:        NUMBER OF EQUATIONS FOR IDENTICAL PARTICLES.              SCAM-095
C  NCIN:      NUMBER OF SOLUTIONS FOR IDENTICAL PARTICLES.              SCAM-096
C  JPI:       PARITY 0 OR 1.                                            SCAM-097
C  IPJ:       VALUE OF J+1 OR J+1/2 WHERE J IS THE CHANNEL SPIN.        SCAM-098
C  R1(2):     MAXIMUM OF SCATTERING AND COMPOUND COEFFICIENT.           SCAM-099
C  NAJ:       TWICE THE CHANNEL SPIN J.                                 SCAM-100
C   DEFINED:  R1.                                                       SCAM-101
C   USED:     NIC,NCI,NC,NCIN,JPI,IPJ,R1,NAJ.                           SCAM-102
C                                                                       SCAM-103
C***********************************************************************SCAM-104
      IMPLICIT REAL*8 (A-H,O-Z)                                         SCAM-105
      LOGICAL LO(150),LG(2)                                             SCAM-106
      DIMENSION F(2,JMAX,*),FCN(KMAX,*),TX(*),GCN(KMAX,*),MC(KAB,12),MD(SCAM-107
     1KAB,12),FAR(KAB,*),FAI(KAB,*),WV(22,*),IPI(11,*),IPIM(11,*),GAM(*)SCAM-108
     2,FISS(2,*),TL(*),NCJ(2,*),XD(3,*),P(NC,NC,4),Q(*),V(IQ,*),NCT(6),ASCAM-109
     3A(KBC,*),X(20),W(20),TP(20),SGF(2),TG(2),FNU(2),MCX(4,2),VCX(4,2) SCAM-110
      CHARACTER*1 IP(2)                                                 SCAM-111
      CHARACTER*8 AL(2)                                                 SCAM-112
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            SCAM-113
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQSCAM-114
     1,ACN(8),BZ(5),TG0,BN,FNUG,EGD,GGD,TG1,SGSQ                        SCAM-115
      COMMON /NOEQU/ NCXN,NIC,NCI,NC,NCIN,NIN,JPI,IPJ,R1(2),NAJ         SCAM-116
      COMMON /INOUT/ MR,MW,MS                                           SCAM-117
      DATA IP,AL,PI,NSY /'+','-',' FISSION','   GAMMA',3.141592653589793SCAM-118
     12D0,0/                                                            SCAM-119
      DATA X /7.0539889691988753D-02,3.7212681800161144D-01,9.1658210248SCAM-120
     1327356D-01,1.7073065310283439D+00,2.7491992553094321D+00,4.0489253SCAM-121
     2138508869D+00,5.6151749708616165D+00,7.4590174536710633D+00,9.5943SCAM-122
     3928695810968D+00,1.2038802546964316D+01,1.4814293442630740D+01,1.7SCAM-123
     4948895520519376D+01,2.1478788240285011D+01,2.5451702793186906D+01,SCAM-124
     52.9932554631700612D+01,3.5013434240479000D+01,4.0833057056728571D+SCAM-125
     601,4.7619994047346502D+01,5.5810795750063899D+01,6.652441652561575SCAM-126
     74D+01/                                                            SCAM-127
      DATA W /1.8108006241898926D-01,4.2255676787856397D-01,6.6690954670SCAM-128
     1184815D-01,9.1535237278307367D-01,1.1695397071955460D+00,1.4313549SCAM-129
     2859282060D+00,1.7029811379850227D+00,1.9870158907927472D+00,2.2866SCAM-130
     3357812534308D+00,2.6058347275538333D+00,2.9497837342139509D+00,3.3SCAM-131
     4253957820093196D+00,3.7422554705898109D+00,4.2142367102518804D+00,SCAM-132
     54.7625184614902093D+00,5.4217260442455743D+00,6.2540123569324213D+SCAM-133
     600,7.3873143890544346D+00,9.1513287309874796D+00,1.289338864593999SCAM-134
     77D+01/                                                            SCAM-135
      IK(I,L,J)=((J-NAJ+IPI(3,I)-1)/2*IPI(2,I)+(L-J+IPI(2,I)-1)/2)/2    SCAM-136
      NZ=MOD(IPJ+JPI+1,2)                                               SCAM-137
      NS=0                                                              SCAM-138
      IF (NZ.NE.0) NS=NCT(1)*NCT(3)                                     SCAM-139
      R1(1)=0.D0                                                        SCAM-140
      R1(2)=0.D0                                                        SCAM-141
      JC=0                                                              SCAM-142
      AJ=0.5D0*DFLOAT(NAJ)                                              SCAM-143
      DZ=1.D0                                                           SCAM-144
      IF (LO(18)) DZ=2.D0                                               SCAM-145
      RZ=PI*DZ*XZ*DFLOAT(NAJ+1)                                         SCAM-146
      IF (LO(55)) WRITE (MW,1000) AJ,IP(JPI+1),NC,NCIN                  SCAM-147
C COMPUTATION OF TRANSMISSION COEFFICIENTS.                             SCAM-148
      NXX=NCIN                                                          SCAM-149
      IF (LO(124)) NXX=NC                                               SCAM-150
      DO 5 IC=1,NXX                                                     SCAM-151
      IV=MC(IC,1)                                                       SCAM-152
      IF (WV(3,IV).LT.0.D0) GO TO 5                                     SCAM-153
      IF (IC.LE.NCIN) TX(1)=TX(1)+4.D0*FAI(IC,IC)*RZ*DZ                 SCAM-154
      IF (.NOT.LO(124)) GO TO 2                                         SCAM-155
      JC=JC+1                                                           SCAM-156
      V(1,JC)=131072.D0*(65536.D0*DFLOAT(IV)+DFLOAT(MC(IC,2)))+DFLOAT(MCSCAM-157
     1(IC,3))                                                           SCAM-158
      V(2,JC)=1.D0                                                      SCAM-159
      V(3,JC)=4.D0*FAI(IC,IC)                                           SCAM-160
      DO 1 N=4,IQ                                                       SCAM-161
    1 V(N,JC)=0.D0                                                      SCAM-162
    2 DO 4 ICP=1,NC                                                     SCAM-163
      IVQ=MC(ICP,1)                                                     SCAM-164
      A1=DSQRT(WV(11,IVQ)/WV(11,IV))                                    SCAM-165
      IF (LO(125)) A1=1.D0/A1                                           SCAM-166
      FAR(ICP,IC)=FAR(ICP,IC)*A1                                        SCAM-167
      FAI(ICP,IC)=FAI(ICP,IC)*A1                                        SCAM-168
      IF (WV(3,IVQ).LT.0.D0) GO TO 3                                    SCAM-169
      IF (LO(124)) V(3,JC)=V(3,JC)-4.D0*(FAR(ICP,IC)**2+FAI(ICP,IC)**2) SCAM-170
      IF (IC.GT.NCIN) GO TO 4                                           SCAM-171
C TEST OF CONVERGENCE.                                                  SCAM-172
      R1(1)=DMAX1(R1(1),DABS(FAR(ICP,IC))+DABS(FAI(ICP,IC)))            SCAM-173
      A1=FAR(ICP,IC)*FAR(ICP,IC)+FAI(ICP,IC)*FAI(ICP,IC)                SCAM-174
      IF (A1.GT.1.D0) WRITE (MW,1001) AJ,IP(JPI+1),NC,NCIN,IC,ICP,FAR(ICSCAM-175
     1P,IC),FAI(ICP,IC)                                                 SCAM-176
      TX(IVQ+1)=TX(IVQ+1)+4.D0*A1*RZ*DZ                                 SCAM-177
      FJ=0.5D0*DFLOAT(MC(ICP,3))                                        SCAM-178
      IF (.NOT.LO(55)) GO TO 4                                          SCAM-179
C PRINT OUT OF THE AMPLITUDES.                                          SCAM-180
      A1=DSQRT(A1)                                                      SCAM-181
      B1=0.D0                                                           SCAM-182
      IF (A1.NE.0.D0) B1=DATAN2(FAI(ICP,IC),FAR(ICP,IC))                SCAM-183
      WRITE (MW,1002) ICP,IC,IVQ,MC(ICP,2),FJ,FAR(ICP,IC),FAI(ICP,IC),A1SCAM-184
     1,B1                                                               SCAM-185
      GO TO 4                                                           SCAM-186
    3 IF ((IC.LE.NCIN).AND.LO(55)) WRITE (MW,1003) ICP,IC,IVQ,MC(ICP,2),SCAM-187
     1FJ,FAR(ICP,IC),FAI(ICP,IC)                                        SCAM-188
    4 CONTINUE                                                          SCAM-189
      IF (.NOT.LO(124)) GO TO 5                                         SCAM-190
      IF (V(3,JC).LT.0.D0) V(3,JC)=0.D0                                 SCAM-191
      IF (IC.LE.NCIN) R1(2)=DMAX1(R1(2),V(3,JC))                        SCAM-192
    5 CONTINUE                                                          SCAM-193
      IF ((.NOT.(LO(63).OR.LO(55))).OR.(JC.EQ.0)) GO TO 8               SCAM-194
C OUTPUT OF TRANSMISSION COEFFICIENTS FOR COUPLED CHANNELS.             SCAM-195
      IF (LO(55)) WRITE (MW,1004) AJ,IP(JPI+1)                          SCAM-196
      IC=1+(JC-1)/4                                                     SCAM-197
      IF (LO(63)) WRITE (99,1005) AJ,IP(JPI+1),JC                       SCAM-198
      DO 7 I=1,IC                                                       SCAM-199
      J1=4*(I-1)                                                        SCAM-200
      J2=MIN0(JC-J1,4)                                                  SCAM-201
      DO 6 J=1,J2                                                       SCAM-202
      N=IDINT(V(1,J+J1)/131072.D0+.01D0)                                SCAM-203
      VCX(J,1)=.5D0*DMOD(V(1,J+J1),131072.D0)                           SCAM-204
      VCX(J,2)=V(3,J+J1)                                                SCAM-205
      MCX(J,2)=MOD(N,65536)                                             SCAM-206
    6 MCX(J,1)=N/65536                                                  SCAM-207
      IF (LO(63)) WRITE (99,1006) (MCX(J,1),MCX(J,2),VCX(J,1),VCX(J,2),JSCAM-208
     1=1,J2)                                                            SCAM-209
      IF (LO(55)) WRITE (MW,1007) (MCX(J,1),MCX(J,2),VCX(J,1),VCX(J,2),JSCAM-210
     1=1,J2)                                                            SCAM-211
    7 CONTINUE                                                          SCAM-212
    8 IF (LO(131)) GO TO 62                                             SCAM-213
      NSS=NS                                                            SCAM-214
      IF (NZ.NE.0) NSS=NCT(5)*NCT(3)                                    SCAM-215
C FISSION COEFFICIENT.                                                  SCAM-216
      TG(1)=0.D0                                                        SCAM-217
      FNU(1)=.5D0                                                       SCAM-218
      IF (.NOT.LO(86)) GO TO 9                                          SCAM-219
      KN=2*IPJ+JPI-1                                                    SCAM-220
      IF (KN.GE.NFISS) GO TO 9                                          SCAM-221
      TG(1)=FISS(1,KN)                                                  SCAM-222
      FNU(1)=.5D0*FISS(2,KN)                                            SCAM-223
    9 LG(1)=(.NOT.LO(85)).OR.TG(1).EQ.0.D0                              SCAM-224
C GAMMA COEFFICIENT.                                                    SCAM-225
      TG(2)=0.D0                                                        SCAM-226
      FNU(2)=.5D0*FNUG                                                  SCAM-227
      IF (.NOT.LO(86)) GO TO 12                                         SCAM-228
      IF (NRD.NE.0) GO TO 11                                            SCAM-229
      A1=0.D0                                                           SCAM-230
      N1=NAJ-2                                                          SCAM-231
      N1=IABS(N1)                                                       SCAM-232
      N2=NAJ+2                                                          SCAM-233
      DO 10 J=N1,N2,2                                                   SCAM-234
      A2=-DFLOAT((J+1)*(J+1))/(4.D0*SGSQ)                               SCAM-235
   10 A1=A1+DEXP(A2)*DFLOAT(J+1)/SGSQ                                   SCAM-236
      TG(2)=6.283185307D0*TG1*A1                                        SCAM-237
      GO TO 12                                                          SCAM-238
   11 IF (IPJ.LE.NRD) TG(2)=GAM(IPJ)                                    SCAM-239
   12 LG(2)=(.NOT.LO(86)).OR.TG(2).EQ.0.D0                              SCAM-240
      NC1=JC                                                            SCAM-241
      NJC=JC                                                            SCAM-242
      IF (NCOLL.EQ.NCOLX) GO TO 24                                      SCAM-243
C TRANSMISSION COEFFICIENTS FOR UNCOUPLED STATES.                       SCAM-244
      NSP1=NCOLX-NCOLL-NCONT                                            SCAM-245
      IF (NSP1.LT.1) GO TO 17                                           SCAM-246
      DO 16 I=1,NSP1                                                    SCAM-247
      II=I+NCOLL                                                        SCAM-248
      IF (WV(3,II).LT.0.D0) GO TO 16                                    SCAM-249
      NM=IPI(3,II)                                                      SCAM-250
      MN=IPI(2,II)                                                      SCAM-251
      DO 15 J=1,NM                                                      SCAM-252
      NN=NAJ-NM-1+2*J                                                   SCAM-253
      IF (NN.LT.IABS(NM-1-NAJ)) GO TO 15                                SCAM-254
      DO 14 K=1,MN                                                      SCAM-255
      MM=NN+MN+1-2*K                                                    SCAM-256
      IF (MM.LT.IABS(MN-1-NN).OR.MM.GE.2*IPI(10,II)+2) GO TO 14         SCAM-257
      L=MM/2                                                            SCAM-258
      IF (MOD(L+JPI+IPI(1,II),2).NE.0) GO TO 14                         SCAM-259
      M=MN*L+K+IPI(8,II)                                                SCAM-260
      JC=JC+1                                                           SCAM-261
      V(1,JC)=131072.D0*(65536.D0*DFLOAT(II)+DFLOAT(L))+DFLOAT(NN)      SCAM-262
      V(2,JC)=1.D0                                                      SCAM-263
      V(3,JC)=TL(M)                                                     SCAM-264
      DO 13 N=4,IQ                                                      SCAM-265
   13 V(N,JC)=0.D0                                                      SCAM-266
   14 CONTINUE                                                          SCAM-267
   15 CONTINUE                                                          SCAM-268
      IF (II.LE.NCOLS) NC1=JC                                           SCAM-269
   16 CONTINUE                                                          SCAM-270
   17 IF (NCONT.EQ.0) GO TO 24                                          SCAM-271
C TRANSMISSION COEFFICIENTS FOR CONTINUA.                               SCAM-272
      DO 23 I=1,NCONT                                                   SCAM-273
      IJ=NCJ(1,I)                                                       SCAM-274
      JI=NCJ(2,I)                                                       SCAM-275
      IF (IJ.GT.JI) GO TO 23                                            SCAM-276
      MN=IPIM(2,IJ)                                                     SCAM-277
      IT=MOD(IPIM(3,IJ)+1,2)                                            SCAM-278
      DO 22 II=IJ,JI                                                    SCAM-279
      L=IPIM(10,II)+1                                                   SCAM-280
      IF (L.EQ.0) GO TO 22                                              SCAM-281
      M=IPIM(8,II)                                                      SCAM-282
      II1=II+NCOLL+NSP1                                                 SCAM-283
      DO 21 LJ=1,L                                                      SCAM-284
      DO 20 JL=1,MN                                                     SCAM-285
      M=M+1                                                             SCAM-286
      IF (TL(M).EQ.0.D0) GO TO 20                                       SCAM-287
      JJ=2*(LJ+JL)-MN-3                                                 SCAM-288
      IF (JJ.LT.0) GO TO 20                                             SCAM-289
      IKM=IABS(JJ-NAJ)/2+1                                              SCAM-290
      IKP=MIN0((JJ+NAJ)/2+1,NCOJ)                                       SCAM-291
      IF (IKM.GT.IKP) GO TO 20                                          SCAM-292
      AI=0.D0                                                           SCAM-293
      DO 18 KK=IKM,IKP                                                  SCAM-294
      AR=.5D0*DFLOAT(IT+2*KK-1)                                         SCAM-295
   18 AI=AI+AR*DEXP(-AR*AR/XD(3,II))/XD(3,II)                           SCAM-296
      JC=JC+1                                                           SCAM-297
      V(1,JC)=131072.D0*(65536.D0*DFLOAT(II1)+DFLOAT(LJ-1))+DFLOAT(JJ)  SCAM-298
      V(2,JC)=AI*XD(1,II)                                               SCAM-299
      V(3,JC)=TL(M)                                                     SCAM-300
      DO 19 N=4,IQ                                                      SCAM-301
   19 V(N,JC)=0.D0                                                      SCAM-302
   20 CONTINUE                                                          SCAM-303
   21 CONTINUE                                                          SCAM-304
   22 CONTINUE                                                          SCAM-305
   23 CONTINUE                                                          SCAM-306
C COMPOUND NUCLEUS.                                                     SCAM-307
   24 SGF(1)=0.D0                                                       SCAM-308
      SGF(2)=0.D0                                                       SCAM-309
      IF (LO(82)) GO TO 58                                              SCAM-310
      IF (LO(83)) GO TO 28                                              SCAM-311
C COMPUTATION OF SATCHLER P-MATRIX ("PR","PI").                         SCAM-312
      I=0                                                               SCAM-313
      DO 27 II=1,NC                                                     SCAM-314
      IF (WV(3,MC(II,1)).LT.0.D0) GO TO 27                              SCAM-315
      I=I+1                                                             SCAM-316
      J=0                                                               SCAM-317
      DO 26 JJ=1,NC                                                     SCAM-318
      IF (WV(3,MC(JJ,1)).LT.0.D0) GO TO 26                              SCAM-319
      J=J+1                                                             SCAM-320
      P(I,J,1)=2.D0*(FAI(I,J)+FAI(J,I))                                 SCAM-321
      P(I,J,2)=0.D0                                                     SCAM-322
      P(I,J,3)=0.D0                                                     SCAM-323
      P(I,J,4)=0.D0                                                     SCAM-324
      K=0                                                               SCAM-325
      DO 25 KK=1,NC                                                     SCAM-326
      IF (WV(3,MC(KK,1)).LT.0.D0) GO TO 25                              SCAM-327
      K=K+1                                                             SCAM-328
      P(I,J,1)=P(I,J,1)-4.D0*(FAR(I,K)*FAR(J,K)+FAI(I,K)*FAI(J,K))      SCAM-329
   25 P(I,J,2)=P(I,J,2)+4.D0*(FAR(I,K)*FAI(J,K)-FAI(I,K)*FAR(J,K))      SCAM-330
   26 CONTINUE                                                          SCAM-331
   27 P(I,I,3)=1.D0                                                     SCAM-332
      CALL DIAG(P,P(1,1,2),P(1,1,3),P(1,1,4),NC,NJC,1.D-12,A1,IERR)     SCAM-333
      IF (IERR.EQ.0) GO TO 28                                           SCAM-334
      WRITE (MW,1008)                                                   SCAM-335
      LO(83)=.TRUE.                                                     SCAM-336
   28 BIR=1.D-12+TG(1)+TG(2)                                            SCAM-337
      DO 29 IC=1,JC                                                     SCAM-338
      IF ((.NOT.LO(83)).AND.IC.LE.NJC) V(3,IC)=DMAX1(0.D0,P(IC,IC,1))   SCAM-339
   29 BIR=BIR+V(3,IC)*V(2,IC)                                           SCAM-340
C FLUCTUATION PARAMETER NU=2*FNU, (P.A.M.,N.P.A344(1980)185).           SCAM-341
C COMMON FACTOR "TP" OF WIDTH FLUCTUATION INTEGRAL                      SCAM-342
C (P.A.M.,PRC 11(1975)426).                                             SCAM-343
      IF (LO(87).OR.(BIR.LT.0.0001D0)) GO TO 39                         SCAM-344
      DO 30 M=1,20                                                      SCAM-345
   30 TP(M)=1.D0                                                        SCAM-346
      EFB=DEXP(-BZ(5)*BIR)                                              SCAM-347
      DO 36 IC=1,JC                                                     SCAM-348
      IF (BZ(2).NE.0.D0) GO TO 31                                       SCAM-349
      V(4,IC)=(1.D0+BZ(4)+(V(3,IC)**BZ(3)-BZ(4))*EFB)/2.D0              SCAM-350
      GO TO 32                                                          SCAM-351
   31 V(4,IC)=0.5D0*BZ(2)                                               SCAM-352
   32 A1=V(3,IC)/V(4,IC)/BIR                                            SCAM-353
      IF (A1.EQ.0.D0) GO TO 36                                          SCAM-354
      IF (A1.GT.1.D-9) GO TO 34                                         SCAM-355
      DO 33 M=1,20                                                      SCAM-356
   33 TP(M)=TP(M)*DEXP(X(M)*V(3,IC)*V(2,IC)/BIR*(1.D0-.5D0*X(M)*A1))    SCAM-357
      GO TO 36                                                          SCAM-358
   34 DO 35 M=1,20                                                      SCAM-359
   35 TP(M)=TP(M)*((BIR+X(M)*V(3,IC)/V(4,IC))/BIR)**(V(4,IC)*V(2,IC))   SCAM-360
   36 CONTINUE                                                          SCAM-361
      DO 38 I=1,2                                                       SCAM-362
      IF (LG(I)) GO TO 38                                               SCAM-363
      DO 37 M=1,20                                                      SCAM-364
   37 TP(M)=TP(M)*(1.D0+X(M)*TG(I)/(BIR*FNU(I)))**FNU(I)                SCAM-365
   38 CONTINUE                                                          SCAM-366
C STORAGE OF COMPOUND TERMS.                                            SCAM-367
   39 TQ=0.D0                                                           SCAM-368
      IF (.NOT.LO(55)) GO TO 40                                         SCAM-369
      WRITE (MW,1009) AJ,IP(JPI+1)                                      SCAM-370
      IF (.NOT.LO(83)) WRITE (MW,1010)                                  SCAM-371
   40 NCX=NJC                                                           SCAM-372
      IF (LO(83)) NCX=NCIN                                              SCAM-373
      DO 56 IC=1,NCX                                                    SCAM-374
      G=1.D0                                                            SCAM-375
      BRI=BIR                                                           SCAM-376
      IF (LO(87).AND.(IC.LE.NCIN)) BRI=BRI+V(3,IC)*BZ(3)                SCAM-377
      AR=1.D0                                                           SCAM-378
      IF (LO(83)) GO TO 42                                              SCAM-379
      AR=0.D0                                                           SCAM-380
      DO 41 IA=1,NCIN                                                   SCAM-381
   41 AR=AR+(P(IA,IC,3)**2+P(IA,IC,4)**2)                               SCAM-382
   42 DO 52 ICP=1,JC                                                    SCAM-383
      IV=IDINT(V(1,ICP)/131072.D0/65536.D0+.01D0)                       SCAM-384
      IF (LO(87).OR.(BIR.LT.0.0001D0)) GO TO 44                         SCAM-385
      G=0.D0                                                            SCAM-386
      DO 43 M=1,20                                                      SCAM-387
   43 G=G+W(M)/(TP(M)*(1.D0+X(M)*V(3,IC)/(V(4,IC)*BRI))*(1.D0+X(M)*V(3,ISCAM-388
     1CP)/(V(4,ICP)*BRI)))                                              SCAM-389
      IF (ICP.EQ.IC) G=G+G/V(4,IC)                                      SCAM-390
   44 TQ=V(3,IC)*V(3,ICP)*G/BRI                                         SCAM-391
      IF (LO(87).AND.(ICP.EQ.IC)) TQ=TQ+TQ*BZ(3)                        SCAM-392
      IF ((ICP.GT.NC1).OR.LO(83)) GO TO 50                              SCAM-393
C INVERSE E-W TRANSFORMATION (P.A.M.,PRC 12(1975)744).                  SCAM-394
      IF (ICP.GT.NJC) GO TO 48                                          SCAM-395
      DO 47 IA=1,NCIN                                                   SCAM-396
      DO 46 IB=1,NJC                                                    SCAM-397
      A1=P(IA,IC,3)*P(IB,ICP,3)-P(IA,IC,4)*P(IB,ICP,4)                  SCAM-398
      B1=P(IA,IC,3)*P(IB,ICP,4)+P(IA,IC,4)*P(IB,ICP,3)                  SCAM-399
      A2=A1                                                             SCAM-400
      B2=B1                                                             SCAM-401
      IF (ICP.EQ.IC) GO TO 45                                           SCAM-402
      A2=A1+P(IA,ICP,3)*P(IB,IC,3)-P(IA,ICP,4)*P(IB,IC,4)               SCAM-403
      B2=B1+P(IA,ICP,3)*P(IB,IC,4)+P(IA,ICP,4)*P(IB,IC,3)               SCAM-404
   45 V(IA+4,IB)=V(IA+4,IB)+(A1*A2+B1*B2)*TQ                            SCAM-405
   46 CONTINUE                                                          SCAM-406
   47 CONTINUE                                                          SCAM-407
      GO TO 51                                                          SCAM-408
   48 DO 49 IA=1,NCIN                                                   SCAM-409
   49 V(IA+4,ICP)=V(IA+4,ICP)+(P(IA,IC,3)**2+P(IA,IC,4)**2)*TQ          SCAM-410
      GO TO 51                                                          SCAM-411
   50 V(5,ICP)=V(5,ICP)+AR*TQ                                           SCAM-412
   51 IF ((IC.GT.NCIN).OR.(.NOT.LO(55))) GO TO 52                       SCAM-413
      GNU=2.D0*V(4,ICP)                                                 SCAM-414
      L=IDINT(DMOD(V(1,ICP)/131072.D0,65536.D0)+.01D0)                  SCAM-415
      FJ=.5D0*DMOD(V(1,ICP),131072.D0)                                  SCAM-416
      WRITE (MW,1011) IC,ICP,IV,L,FJ,V(3,ICP),TQ,GNU,G                  SCAM-417
   52 CONTINUE                                                          SCAM-418
      IF (LO(83).AND.IC.GT.NCIN) GO TO 56                               SCAM-419
      DO 55 I=1,2                                                       SCAM-420
      IF (LG(I)) GO TO 55                                               SCAM-421
      IF (LO(87)) GO TO 54                                              SCAM-422
      G=0.D0                                                            SCAM-423
      DO 53 M=1,20                                                      SCAM-424
   53 G=G+W(M)/(TP(M)*(1.D0+X(M)*V(3,IC)/(V(4,IC)*BRI))*(1.D0+X(M)*TG(I)SCAM-425
     1/(BRI*FNU(I))))                                                   SCAM-426
   54 A1=V(3,IC)*TG(I)*G/BRI                                            SCAM-427
      SGF(I)=SGF(I)+A1*AR                                               SCAM-428
      FN=2.D0*FNU(I)                                                    SCAM-429
      IF (LO(55).AND.(IC.LE.NCIN)) WRITE (MW,1012) AL(I),TG(I),SGF(I),FNSCAM-430
     1,G                                                                SCAM-431
   55 CONTINUE                                                          SCAM-432
   56 CONTINUE                                                          SCAM-433
      IF (LO(55)) WRITE (MW,1013) BIR                                   SCAM-434
      DO 57 I=1,2                                                       SCAM-435
      IF (LG(I)) GO TO 57                                               SCAM-436
      IF (LO(132)) FCN(IPJ,NDQ+I)=FCN(IPJ,NDQ+I)+.25D0*SGF(I)           SCAM-437
      TX(NDP+I)=TX(NDP+I)+RZ*SGF(I)                                     SCAM-438
   57 CONTINUE                                                          SCAM-439
      GO TO 62                                                          SCAM-440
C STORAGE FOR SIMPLIFIED COMPOUND NUCLEUS.                              SCAM-441
   58 BIR=BZ(3)**2*(2.D0*AJ+1.D0)*DEXP(-AJ*(AJ+1.D0)/(2.D0*BZ(2)**2))   SCAM-442
      DO 59 IC=1,NJC                                                    SCAM-443
   59 BIR=BIR+4.D0*V(3,IC)                                              SCAM-444
      IF (LO(55)) WRITE (MW,1014) BIR                                   SCAM-445
      DO 61 IC=1,NCIN                                                   SCAM-446
      NT=NS+IK(1,2*MC(IC,2),MC(IC,3))*NCT(NZ+1)                         SCAM-447
      DO 60 ICP=1,NJC                                                   SCAM-448
      TQ=V(3,IC)*V(3,ICP)/BIR                                           SCAM-449
      IF (IV.EQ.1) TQ=TQ*BZ(1)**2                                       SCAM-450
   60 V(IC+4,ICP)=V(IC+4,ICP)+4.D0*TQ                                   SCAM-451
   61 CONTINUE                                                          SCAM-452
   62 IF (LO(55).AND.LO(123)) WRITE (MW,1000) AJ,IP(JPI+1),NC,NCIN      SCAM-453
C STORAGE OF THE AMPLITUDES.                                            SCAM-454
      NI=NCI-NCIN                                                       SCAM-455
      DO 70 I1=1,NCI                                                    SCAM-456
      NT=NS+IK(1,2*MD(I1,2),MD(I1,3))*NCT(NZ+1)                         SCAM-457
      IF (LO(123)) GO TO 63                                             SCAM-458
      J1=I1                                                             SCAM-459
      K1=J1                                                             SCAM-460
      GO TO 64                                                          SCAM-461
   63 J1=1                                                              SCAM-462
      K1=NCIN                                                           SCAM-463
   64 IVS=0                                                             SCAM-464
      DO 69 I2=1,NIC                                                    SCAM-465
      IV=MD(I2,1)                                                       SCAM-466
      IF ((IV.NE.IVS).AND.(IV.NE.1)) NT=NT+(IPI(2,IVS)*IPI(3,IVS)+NSY)/2SCAM-467
      NSY=MOD(IPI(1,IV)+JPI+IPJ+(IPI(2,IV)+IPI(3,IV))/2+1,2)            SCAM-468
      IVS=IV                                                            SCAM-469
      ID=NT+IK(IV,2*MD(I2,2),MD(I2,3))+1                                SCAM-470
      IF (LO(123).AND.(I2.LE.NCI)) GO TO 65                             SCAM-471
      J2=I2-NI                                                          SCAM-472
      K2=J2                                                             SCAM-473
      GO TO 66                                                          SCAM-474
   65 J2=1                                                              SCAM-475
      K2=NCIN                                                           SCAM-476
   66 AR=0.D0                                                           SCAM-477
      AI=0.D0                                                           SCAM-478
      DO 68 L1=J1,K1                                                    SCAM-479
      A1=DZ                                                             SCAM-480
      IF (LO(123)) A1=A1*AA(I1,L1)                                      SCAM-481
      IF (A1.EQ.0.D0) GO TO 68                                          SCAM-482
      DO 67 L2=J2,K2                                                    SCAM-483
      A2=1.D0                                                           SCAM-484
      IF (LO(123).AND.(L2.LE.NCIN)) A2=AA(I2,L2)                        SCAM-485
      IF (A2.EQ.0.D0) GO TO 67                                          SCAM-486
      AR=AR+FAR(L2,L1)*A1*A2                                            SCAM-487
      AI=AI+FAI(L2,L1)*A1*A2                                            SCAM-488
   67 CONTINUE                                                          SCAM-489
   68 CONTINUE                                                          SCAM-490
      F(1,IPJ,ID)=AR                                                    SCAM-491
      F(2,IPJ,ID)=AI                                                    SCAM-492
      IF (.NOT.(LO(55).AND.LO(123))) GO TO 69                           SCAM-493
      A1=DSQRT(AR*AR+AI*AI)                                             SCAM-494
      A2=0.D0                                                           SCAM-495
      IF (A1.NE.0.D0) A2=DATAN2(AI,AR)                                  SCAM-496
      FJ=0.5D0*DFLOAT(MD(I2,3))                                         SCAM-497
      WRITE (MW,1002) I2,I1,IV,MD(I2,2),FJ,AR,AI,A1,A2                  SCAM-498
   69 CONTINUE                                                          SCAM-499
   70 CONTINUE                                                          SCAM-500
      IF (LO(131)) RETURN                                               SCAM-501
C COMPOUND NUCLEUS.                                                     SCAM-502
      JCX=JC+NI                                                         SCAM-503
      IIV=IPI(2,1)-1                                                    SCAM-504
      III=IPI(3,1)-1                                                    SCAM-505
      DO 81 IC=1,NCI                                                    SCAM-506
      LA=2*MD(IC,2)                                                     SCAM-507
      JA=MD(IC,3)                                                       SCAM-508
      NT=NSS+IK(IV,LA,JA)*NCT(NZ+5)                                     SCAM-509
      IVS=0                                                             SCAM-510
      CALL COCN(LA,LA,JA,JA,III,IIV,NAJ,IPJ,Q,Q(IPJ+1),IDT-2*IPJ)       SCAM-511
      IF (LO(123)) GO TO 71                                             SCAM-512
      J1=IC                                                             SCAM-513
      K1=J1                                                             SCAM-514
      GO TO 72                                                          SCAM-515
   71 J1=1                                                              SCAM-516
      K1=NCIN                                                           SCAM-517
   72 DO 80 ICP=1,JCX                                                   SCAM-518
      IF (LO(123).AND.(ICP.LE.NCI)) GO TO 73                            SCAM-519
      J2=ICP-NI                                                         SCAM-520
      K2=J2                                                             SCAM-521
      GO TO 74                                                          SCAM-522
   73 J2=1                                                              SCAM-523
      K2=NCIN                                                           SCAM-524
   74 AR=0.D0                                                           SCAM-525
      DO 76 L1=J1,K1                                                    SCAM-526
      A1=DZ                                                             SCAM-527
      IF (LO(123)) A1=A1*AA(I1,L1)                                      SCAM-528
      IF (A1.EQ.0.D0) GO TO 79                                          SCAM-529
      DO 75 L2=J2,K2                                                    SCAM-530
      A2=1.D0                                                           SCAM-531
      IF (LO(123).AND.(L2.GT.NCIN)) A2=AA(I2,L2)                        SCAM-532
      IF (A2.EQ.0.D0) GO TO 75                                          SCAM-533
      AR=AR+V(L1+4,L2)*A1*A2                                            SCAM-534
   75 CONTINUE                                                          SCAM-535
   76 CONTINUE                                                          SCAM-536
      IF (AR.EQ.0.D0) GO TO 81                                          SCAM-537
      IV=IDINT(V(1,ICP)/131072.D0/65536.D0+.01D0)                       SCAM-538
      IF ((IV.NE.IVS).AND.(IV.NE.1)) NT=NT+(IPI(2,IVS)*IPI(3,IVS)+NSY)/2SCAM-539
      NSY=MOD(IPI(1,IV)+JPI+IPJ+(IPI(2,IV)+IPI(3,IV))/2+1,2)            SCAM-540
      IVS=IV                                                            SCAM-541
      TX(NCOLL+IV+1)=TX(NCOLL+IV+1)+AR*V(2,ICP)*RZ                      SCAM-542
      IF (ICP.GT.NC1) GO TO 79                                          SCAM-543
      JB=DMOD(V(1,ICP),131072.D0)                                       SCAM-544
      N=IDINT(V(1,ICP)/131072.D0+.01D0)                                 SCAM-545
      LB=2*MOD(N,65536)                                                 SCAM-546
      IF (.NOT.LO(132)) GO TO 77                                        SCAM-547
      ID=NT+IK(IV,LB,JB)+1                                              SCAM-548
      FCN(IPJ,ID)=FCN(IPJ,ID)+.25D0*AR                                  SCAM-549
   77 CALL COCN(LB,LB,JB,JB,IPI(3,IV)-1,IPI(2,IV)-1,NAJ,IPJ,Q(IPJ+1),Q(2SCAM-550
     1*IPJ+1),IDT-3*IPJ)                                                SCAM-551
      IF ((IV.EQ.1).AND.(III.NE.0).AND.(ICP.NE.IC)) CALL COCN(LA,LB,JA,JSCAM-552
     1B,IPI(3,IV)-1,IPI(2,IV)-1,NAJ,IPJ,Q(2*IPJ+1),Q(3*IPJ+1),IDT-4*IPJ)SCAM-553
      DO 78 LL=1,IPJ                                                    SCAM-554
      AI=Q(LL)*Q(LL+IPJ)                                                SCAM-555
      IF ((IV.EQ.1).AND.(III.NE.0).AND.(ICP.NE.IC)) AI=AI+Q(LL+2*IPJ)**2SCAM-556
   78 GCN(LL,IV)=GCN(LL,IV)+.25D0*AI*AR*XZ                              SCAM-557
      GO TO 80                                                          SCAM-558
   79 IF (.NOT.LO(132)) GO TO 80                                        SCAM-559
      J=IV+KBA-NCOLS                                                    SCAM-560
      FCN(IPJ,J)=FCN(IPJ,J)+0.25D0*AR*V(2,ICP)                          SCAM-561
   80 CONTINUE                                                          SCAM-562
   81 JCX=NC1+NI                                                        SCAM-563
      RETURN                                                            SCAM-564
 1000 FORMAT (//' CHANNEL SPIN AND PARITY =',F7.1,A1,I11,' COUPLED CHANNSCAM-565
     1ELS AND',I3,' SOLUTIONS'//'  IC  ICP N    L    J',19X,'C MATRIX',2SCAM-566
     20X,'|C|',6X,'PHASE')                                              SCAM-567
 1001 FORMAT (' C MATRIX LARGER THAN 1 FOR AJ IPI NC NCIN IC ICP =',F5.1SCAM-568
     1,A1,4I3,2X,2D12.4)                                                SCAM-569
 1002 FORMAT (1X,I3,I4,I3,I5,F7.1,4X,1P,2D15.7,' I',4X,0P,2F11.8)       SCAM-570
 1003 FORMAT (1X,I3,I4,I3,I5,F7.1,4X,1P,2D15.7,' I',4X,'CLOSED')        SCAM-571
 1004 FORMAT (/' TRANSMISSION COEFFICIENTS FOR CHANNEL SPIN AND PARITY =SCAM-572
     1',F7.1,A1/4(' LEVEL   L     J',16X))                              SCAM-573
 1005 FORMAT (1X,F9.1,4X,A1,1X,I4)                                      SCAM-574
 1006 FORMAT (1X,I2,I6,F9.1,2X,1P,D18.8,0P)                             SCAM-575
 1007 FORMAT (4(1X,I2,I4,F6.1,2X,1P,D14.7,0P,3X))                       SCAM-576
 1008 FORMAT (' ERROR IN EIGENSYSTEM.  E-W CORRECTION DISCONTINUED.')   SCAM-577
 1009 FORMAT (//' CHANNEL SPIN AND PARITY =',F7.1, A1//'  IC  ICP N    LSCAM-578
     1    J',9X,'TL',9X,'HF',11X,'NU',9X,'G')                           SCAM-579
 1010 FORMAT (' TL  IN TRANSFORMED CHANNEL SPACE:')                     SCAM-580
 1011 FORMAT (1X,I3,I4,I3,I5,F7.1,F12.6,D14.6,2F10.6)                   SCAM-581
 1012 FORMAT (15X,A8,F12.6,D14.6,F10.4,F10.6)                           SCAM-582
 1013 FORMAT (20X,'SUM',F12.6)                                          SCAM-583
 1014 FORMAT (15X,'H.-F.',D20.6)                                        SCAM-584
      END                                                               SCAM-585
C 02/04/06                                                      ECIS06  DIAG-000
      SUBROUTINE DIAG(ZR,ZI,XR,XI,N,NC,EPS,AX,IER)                      DIAG-001
C DIAGONALISATION OF A HERMITIAN COMPLEX MATRIX BY AN EXTENSION OF THE  DIAG-002
C JACOBI'S METHOD.                                                      DIAG-003
C INPUT:     ZR,ZI:  REAL AND IMAGINARY PARTS OF THE MATRIX.            DIAG-004
C            XR,XI:  REAL AND IMAGINARY PARTS OF THE UNIT MATRIX.       DIAG-005
C            N:      FIRST DIMENSION OF ZR,ZI,XR AND XI.                DIAG-006
C            NC:     DIMENSION OF THE MATRIX.                           DIAG-007
C            EPS:    VALUE BELOW WHICH MATRIX ELEMENTS ARE SET TO 0.    DIAG-008
C OUTPUT:    ZR,ZI:  THE EIGENVALUES ARE ON THE DIAGONAL OF ZR.         DIAG-009
C                    ALL THE OTHER ELEMENTS ARE 0, IF PROCESS SUCCEEDED.DIAG-010
C            XR,XI:  EIGENVECTORS.                                      DIAG-011
C            AX:     SQUARE OF NORM OF THE LARGEST NON DIAGONAL ELEMENT.DIAG-012
C            IER:    RETURNS 0 OR -1 AFTER 4*NC**2 ROTATIONS.           DIAG-013
C***********************************************************************DIAG-014
      IMPLICIT REAL*8 (A-H,O-Z)                                         DIAG-015
      DIMENSION ZR(N,*),ZI(N,*),XR(N,*),XI(N,*)                         DIAG-016
      IER=0                                                             DIAG-017
      NT=0                                                              DIAG-018
    1 NT=NT+1                                                           DIAG-019
      IF (NT.GT.4*NC*NC) GO TO 6                                        DIAG-020
      AX=0.D0                                                           DIAG-021
      L=1                                                               DIAG-022
      M=2                                                               DIAG-023
C SYMMETRISATION AND SEARCH FOR THE LARGEST NON DIAGONAL ELEMENT.       DIAG-024
      DO 3 I=1,NC                                                       DIAG-025
      DO 2 J=I,NC                                                       DIAG-026
      IF (ZR(J,I).EQ.0.D0) ZR(I,J)=0.D0                                 DIAG-027
      IF (ZI(J,I).EQ.0.D0) ZI(I,J)=0.D0                                 DIAG-028
      IF (ZR(I,J).EQ.0.D0) ZR(J,I)=0.D0                                 DIAG-029
      IF (ZI(I,J).EQ.0.D0) ZI(J,I)=0.D0                                 DIAG-030
      AR=(ZR(I,J)+ZR(J,I))/2.D0                                         DIAG-031
      AI=(ZI(I,J)-ZI(J,I))/2.D0                                         DIAG-032
      ZR(J,I)=AR                                                        DIAG-033
      ZR(I,J)=AR                                                        DIAG-034
      ZI(I,J)=AI                                                        DIAG-035
      ZI(J,I)=-AI                                                       DIAG-036
      IF (I.EQ.J) GO TO 2                                               DIAG-037
      AY=ZR(I,J)**2+ZI(I,J)**2                                          DIAG-038
      IF (AX.GT.AY) GO TO 2                                             DIAG-039
      AX=AY                                                             DIAG-040
      L=I                                                               DIAG-041
      M=J                                                               DIAG-042
    2 CONTINUE                                                          DIAG-043
    3 CONTINUE                                                          DIAG-044
      IF (AX.EQ.0.D0) RETURN                                            DIAG-045
C ELEMENTARY TRANSFORMATION.                                            DIAG-046
      U=DATAN2(-ZI(L,M),ZR(L,M))/2.D0                                   DIAG-047
      V=DATAN2(2.D0*DSQRT(ZR(L,M)**2+ZI(L,M)**2),ZR(M,M)-ZR(L,L))/2.D0  DIAG-048
      UC=DCOS(U)                                                        DIAG-049
      US=DSIN(U)                                                        DIAG-050
      TC=DCOS(V)                                                        DIAG-051
      TS=-DSIN(V)                                                       DIAG-052
      UCC=UC*TC                                                         DIAG-053
      UCS=UC*TS                                                         DIAG-054
      USC=US*TC                                                         DIAG-055
      USS=US*TS                                                         DIAG-056
C TRANSFORMATION OF ROWS.                                               DIAG-057
      DO 4 I=1,NC                                                       DIAG-058
      AR=XR(I,L)*UCC+XI(I,L)*USC+XR(I,M)*UCS-XI(I,M)*USS                DIAG-059
      BR=-XR(I,L)*UCS-XI(I,L)*USS+XR(I,M)*UCC-XI(I,M)*USC               DIAG-060
      AI=XI(I,L)*UCC-XR(I,L)*USC+XI(I,M)*UCS+XR(I,M)*USS                DIAG-061
      BI=-XI(I,L)*UCS+XR(I,L)*USS+XI(I,M)*UCC+XR(I,M)*USC               DIAG-062
      XR(I,L)=AR                                                        DIAG-063
      XR(I,M)=BR                                                        DIAG-064
      XI(I,L)=AI                                                        DIAG-065
      XI(I,M)=BI                                                        DIAG-066
      AR=ZR(I,L)*UCC+ZI(I,L)*USC+ZR(I,M)*UCS-ZI(I,M)*USS                DIAG-067
      BR=-ZR(I,L)*UCS-ZI(I,L)*USS+ZR(I,M)*UCC-ZI(I,M)*USC               DIAG-068
      AI=ZI(I,L)*UCC-ZR(I,L)*USC+ZI(I,M)*UCS+ZR(I,M)*USS                DIAG-069
      BI=-ZI(I,L)*UCS+ZR(I,L)*USS+ZI(I,M)*UCC+ZR(I,M)*USC               DIAG-070
      ZR(I,L)=AR                                                        DIAG-071
      ZR(I,M)=BR                                                        DIAG-072
      ZI(I,L)=AI                                                        DIAG-073
    4 ZI(I,M)=BI                                                        DIAG-074
C TRANSFORMATION OF COLUMNS.                                            DIAG-075
      DO 5 I=1,NC                                                       DIAG-076
      AR=ZR(L,I)*UCC-ZI(L,I)*USC+ZR(M,I)*UCS+ZI(M,I)*USS                DIAG-077
      BR=-ZR(L,I)*UCS+ZI(L,I)*USS+ZR(M,I)*UCC+ZI(M,I)*USC               DIAG-078
      AI=ZI(L,I)*UCC+ZR(L,I)*USC+ZI(M,I)*UCS-ZR(M,I)*USS                DIAG-079
      BI=-ZI(L,I)*UCS-ZR(L,I)*USS+ZI(M,I)*UCC-ZR(M,I)*USC               DIAG-080
      IF (DABS(AR).LT.EPS) AR=0.D0                                      DIAG-081
      IF (DABS(BR).LT.EPS) BR=0.D0                                      DIAG-082
      IF (DABS(AI).LT.EPS) AI=0.D0                                      DIAG-083
      IF (DABS(BI).LT.EPS) BI=0.D0                                      DIAG-084
      ZR(L,I)=AR                                                        DIAG-085
      ZR(M,I)=BR                                                        DIAG-086
      ZI(L,I)=AI                                                        DIAG-087
    5 ZI(M,I)=BI                                                        DIAG-088
      GO TO 1                                                           DIAG-089
    6 IER=-1                                                            DIAG-090
      RETURN                                                            DIAG-091
      END                                                               DIAG-092
C 02/04/06                                                      ECIS06  COCN-000
      SUBROUTINE COCN(LA,LB,JA,JB,IW,IV,IJ,IP,RB,RC,NT)                 COCN-001
C COMPUTATION OF COEFFICIENT FOR ANGULAR DISTRIBUTION OF COMPOUND       COCN-002
C NUCLEUS CROSS-SECTIONS.                                               COCN-003
C INPUT:     LA,LB,JA,JB,IW,IV,IJ: INTEGER DOUBLE VALUES.               COCN-004
C            IP:      NUMBER OF COEFFICIENTS REQUESTED.                 COCN-005
C            NT:      SIZE OF THE WORKING SPACE RC.                     COCN-006
C OUTPUT:    RB:      IN RB(I), VALUE OF:                               COCN-007
C                     ( LL  LA  LB )  ( JA  JB  LL )  ( LA  LB  LL )    COCN-008
C                     (            )  )            (  )            (    COCN-009
C                     (  0   0   0 )  ( IJ  IJ  IW )  ( JB  JA  IV )    COCN-010
C                     *(2 IJ+1)*SQRT((2 LA+1)(2 LB+1)(2 JA+1)(2 JB+1))  COCN-011
C                     FOR EVEN VALUES OF LL, FROM LL=0 WITH POSITIVE    COCN-012
C                     OR NULL VALUE FOR LL=0.                           COCN-013
C WORKING AREA:                                                         COCN-014
C             RC:     FOR ALL THE NON-ZERO 6-J COEFFICIENTS WITH EVEN   COCN-015
C                     AND ODD VALUES OF LL, STARTING WITH THE LARGEST   COCN-016
C                     VALUE OF LL IN RC(2).                             COCN-017
C***********************************************************************COCN-018
      IMPLICIT REAL*8 (A-H,O-Z)                                         COCN-019
      COMMON /INOUT/ MR,MW,MS                                           COCN-020
      DIMENSION RB(*),RC(*),J(5)                                        COCN-021
      LD=IABS(LA-LB)                                                    COCN-022
      LP=(LA+LB)/4+1                                                    COCN-023
      LM=LD/4+1                                                         COCN-024
      AD=DFLOAT(LD**2)                                                  COCN-025
      AP=DFLOAT(LA+LB+2)**2                                             COCN-026
      JT=MAX0(IP,LP)                                                    COCN-027
      IF (JT.GT.NT) GO TO 7                                             COCN-028
      TI=0.D0                                                           COCN-029
C RECURRENCE COMPUTATION OF 3-J COEFFICIENTS FOR EVEN VALUES OF LL.     COCN-030
      DO 2 I=1,JT                                                       COCN-031
      AL=DFLOAT(4*I-4)                                                  COCN-032
      RC(I)=0.D0                                                        COCN-033
      IF (I.LT.LM.OR.I.GT.LP) GO TO 2                                   COCN-034
      IF (I.GT.LM) GO TO 1                                              COCN-035
      RC(I)=1.D0                                                        COCN-036
      GO TO 2                                                           COCN-037
    1 RC(I)=-RC(I-1)*DSQRT(((AL-2.D0)**2-AD)*(AP-(AL-2.D0)**2)/((AL**2-ACOCN-038
     1D)*(AP-AL**2)))                                                   COCN-039
    2 TI=TI+RC(I)**2*(AL+1.D0)                                          COCN-040
      TI=DSQRT(TI)                                                      COCN-041
      DO 3 I=1,IP                                                       COCN-042
    3 RB(I)=RC(I)                                                       COCN-043
C QUANTUM NUMBERS OF THE FIRST 6-J COEFFICIENT.                         COCN-044
      J(1)=LA                                                           COCN-045
      J(2)=JA                                                           COCN-046
      J(3)=IV                                                           COCN-047
      J(4)=JB                                                           COCN-048
      J(5)=LB                                                           COCN-049
      DO 5 K=1,2                                                        COCN-050
      JI=MAX0(IABS(J(1)-J(5)),IABS(J(2)-J(4)))                          COCN-051
      JF=MIN0(J(1)+J(5),J(2)+J(4))                                      COCN-052
      JT=(JF-JI)/2+2                                                    COCN-053
      IF (JT.GT.NT) GO TO 7                                             COCN-054
      AT=DFLOAT(JF+1)                                                   COCN-055
      CALL DX6J(RC,AT,J,JT)                                             COCN-056
      TI=TI*DSQRT(AT*DFLOAT(J(3)+1))                                    COCN-057
      DO 4 I=1,IP                                                       COCN-058
      LL=4*I-4                                                          COCN-059
      LK=1                                                              COCN-060
      IF (LL.GE.JI.AND.LL.LE.JF) LK=2+(JF-LL)/2                         COCN-061
      RB(I)=RC(LK)*RB(I)                                                COCN-062
    4 CONTINUE                                                          COCN-063
C QUANTUM NUMBERS OF THE SECOND 6-J COEFFICIENT.                        COCN-064
      J(1)=IJ                                                           COCN-065
      J(3)=IW                                                           COCN-066
    5 J(5)=IJ                                                           COCN-067
C NORMALISATION.                                                        COCN-068
      TI=DSQRT(DFLOAT(LA+1)*DFLOAT(LB+1)*DFLOAT(JA+1)*DFLOAT(JB+1))*DFLOCOCN-069
     1AT(IJ+1)/TI                                                       COCN-070
      IF (RB(1).LT.0.D0) TI=-TI                                         COCN-071
      DO 6 I=1,IP                                                       COCN-072
    6 RB(I)=RB(I)*TI                                                    COCN-073
      RETURN                                                            COCN-074
    7 WRITE (MW,1000) NT,JT                                             COCN-075
      STOP                                                              COCN-076
 1000 FORMAT (' WORKING SPACE TOO SMALL IN COCN:',I5,' AVAILABLE',I6,' RCOCN-077
     1EQUESTED.'///' IN COCN  ...  STOP  ...')                          COCN-078
      END                                                               COCN-079
C 02/03/07                                                      ECIS06  SCHE-000
      SUBROUTINE SCHE(F,JMAX,KMAX,IPI,MT1,MT2,MF,TX,BM,MC,FA,XG,LMAX1,WVSCHE-001
     1,KAB,KBA,KCB,JMIN,IPJ,IPK,FN,NCOLL,NCOLS,NCT,FGN,AM,JIT,JTI,NLT,IDSCHE-002
     21,LO)                                                             SCHE-003
C SCATTERING COEFFICIENTS IN THE HELICITY REPRESENTATION.               SCHE-004
C INPUT:     F:       S-MATRIX.                                         SCHE-005
C            JMAX:    MAXIMUM NUMBER OF CHANNEL SPINS, DIMENSION FOR F. SCHE-006
C            KMAX:    MAXIMUM NUMBER OF COMPOUND NUCLEUS, DIMENSION FOR SCHE-007
C                     FN.                                               SCHE-008
C            IPI(I,*):PARITY OF CHANNEL FOR I=1,                        SCHE-009
C                     MULTIPLICITIES OF PARTICLE FOR I=2,               SCHE-010
C                     MULTIPLICITIES OF TARGET FOR I=3,                 SCHE-011
C                     PRODUCT OF CHARGES FOR I=4,                       SCHE-012
C                     FIRST/LAST CHANNEL NUMBER FOR I=6, 7 (SEE DEPH),  SCHE-013
C                     MAXIMUM ANGULAR MOMENTUM FOR I=11.                SCHE-014
C            MT1,MT2: MAXIMUM 2*SPIN+1 FOR PART. AND TARGET.            SCHE-015
C            MF:      HELICITY NUMBERS (SEE DEPH).                      SCHE-016
C            TX:      TOTAL REACTION CROSS SECTION IN MILLIBARNS        SCHE-017
C                     FOLLOWED BY THE TOTAL CROSS SECTION FOR EACH      SCHE-018
C                     LEVEL, THE COMPOUND NUCLEUS CROSS SECTIONS,       SCHE-019
C                     THE FISSION AND THE GAMMA CROSS SECTIONS.         SCHE-020
C            XG:      COULOMB PHASE-SHIFTS.                             SCHE-021
C            LMAX1:   DIMENSION FOR XG.                                 SCHE-022
C            WV:      WAVE NUMBER AND COULOMB PARAMETER (SEE COLF).     SCHE-023
C            KAB:     DIMENSION FOR FA.                                 SCHE-024
C            KBA:     NUMBER OF INDEPENDENT AMPLITUDES.                 SCHE-025
C            KCB:     DIMENSION FOR MC.                                 SCHE-026
C            JMIN:    TWICE MINIMUM CHANNEL SPIN.                       SCHE-027
C            IPJ:     NUMBER OF THE CHANNEL SPIN.                       SCHE-028
C            IPK:     NUMBER OF L VALUES FOR COMPOUND NUCLEUS.          SCHE-029
C            FN:      COMPOUND NUCLEUS CONTRIBUTION.                    SCHE-030
C            NCOLL:   NUMBER OF COUPLED LEVELS.                         SCHE-031
C            NCOLS:   NUMBER OF LEVELS WITH ANGULAR DISTRIBUTION.       SCHE-032
C            NCT:     NUMBER OF EQUATIONS AND SOLUTIONS FOR EACH PARITY.SCHE-033
C            FGN:     COEFFICIENTS OF LEGENDRE POLYNOMIALS FOR COMPOUND SCHE-034
C                     NUCLEUS.                                          SCHE-035
C            JIT:     NUMBER OF DIFFERENT RATES OF INTERPOLATION.       SCHE-036
C            JTI:     LIMITS AND STEPS OF INTERPOLATION.                SCHE-037
C            NLT:     MEMORIES NEEDED FOR LEGENDRE POLYNOMIALS.         SCHE-038
C            ID1:     LENGTH AVAILABLE FOR BM.                          SCHE-039
C            LO(I):   LOGICAL CONTROLS:                                 SCHE-040
C               LO(18) =.TRUE. PROJECTILE-TARGET ANTISYMMETRISATION.    SCHE-041
C               LO(41) =.TRUE. FACTORISATION OF 1/(1-COS(THETA)).       SCHE-042
C               LO(43) =.TRUE. INTERPOLATION ON TOTAL SPIN.             SCHE-043
C               LO(56) =.TRUE. OUTPUT OF S-MATRIX ELEMENTS.             SCHE-044
C               LO(60) =.TRUE. S-MATRIX ELEMENTS WRITTEN ON FILE 60.    SCHE-045
C               LO(65) =.TRUE. PRINT COEFFICIENTS OF THE EXPANSION IN   SCHE-046
C                              LEGENDRE POLYNOMIALS ON FILE 65.         SCHE-047
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             SCHE-048
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         SCHE-049
C               LO(116)=.TRUE. NO OUTPUT.                               SCHE-050
C               LO(119)=.TRUE. RESULTS WITH THE LAST CALCULATION.       SCHE-051
C               LO(120)=.TRUE. OUTPUT AND LAST CALCULATION BEST ONE.    SCHE-052
C               LO(122)=.TRUE. IDENTICAL PARTICLES WITHOUT SPIN.        SCHE-053
C               LO(132)=.TRUE. STORE FISSION AND GAMMA TRANSMISSION     SCHE-054
C                              COEFFICIENTS FOR INTERPOLATION.          SCHE-055
C OUTPUT:    F:       HELICITY SCATTERING COEFFICIENTS.                 SCHE-056
C            TX,FGN:  ADDITION OF INTERPOLATED VALUES.                  SCHE-057
C WORKING AREAS:                                                        SCHE-058
C            BM:      FOR FACTORS 1/(-X*COS(THETA)), 3J COEFFICIENTS,...SCHE-059
C            MC:      NUCLEAR STATE NUMBERS AND ANGULAR MOMENTA.        SCHE-060
C            FA:      FOR STORAGE OF S-MATRIX FOR A GIVEN TOTAL SPIN.   SCHE-061
C            AM:      FOR PRODUCTS OF C.G. COEFFICIENTS.                SCHE-062
C                                                                       SCHE-063
C FOR THE COMMON  /ANGUL/ SEE LECT.                                     SCHE-064
C FOR THE COMMON  /DCONS/ SEE CALC.                                     SCHE-065
C FOR THE COMMON  /NCOMP/ SEE CALX.                                     SCHE-066
C                                                                       SCHE-067
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     SCHE-068
C  XZ:        CONVERSION FACTOR TO MILLIBARNS.                          SCHE-069
C   USED:     XZ.                                                       SCHE-070
C                                                                       SCHE-071
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ANGUL/:                     SCHE-072
C  NCJ:       NUMBER OF FACTORISATIONS OF 1/(1-COS(THETA)) IN AMPLITUDE.SCHE-073
C   DEFINED:  NCJ.                                                      SCHE-074
C   USED:     NCJ.                                                      SCHE-075
C                                                                       SCHE-076
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     SCHE-077
C  NSP(1):    NUMBER OF UNCOUPLED LEVELS FOR COMPOUND NUCLEUS           SCHE-078
C             INCLUDING DISCRETISATION OF CONTINUUM.                    SCHE-079
C  NSP(2):    NUMBER OF THESE LEVELS WITH ANGULAR DISTRIBUTION.         SCHE-080
C  NSP(3):    NUMBER OF THESE LEVELS WITHOUT ANGULAR DISTRIBUTION.      SCHE-081
C   USED:     NSP.                                                      SCHE-082
C                                                                       SCHE-083
C***********************************************************************SCHE-084
      IMPLICIT REAL*8 (A-H,O-Z)                                         SCHE-085
      LOGICAL LO(150)                                                   SCHE-086
      DIMENSION F(2,JMAX,*),IPI(11,*),MF(10,*),TX(*),BM(*),MC(KCB,2,*),FSCHE-087
     1A(2,KAB,*),XG(LMAX1,*),WV(22,*),FN(KMAX,*),NCT(6),FGN(KMAX,*),AM(MSCHE-088
     2T1,MT2,*),JTI(2,JIT)                                              SCHE-089
      CHARACTER*1 IP(2),IPP                                             SCHE-090
      COMMON /ANGUL/ THETA1,THETA2,DTHETA,DTHE,NCJ,NL(3),JMM(2)         SCHE-091
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            SCHE-092
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQSCHE-093
     1,ACN1,ACN2,AZ(18)                                                 SCHE-094
      COMMON /INOUT/ MR,MW,MS                                           SCHE-095
      DATA IP,PI,K2,K3,K4 /'+','-',3.1415926535897932D0,3*0/            SCHE-096
      IF (LO(120)) GO TO 60                                             SCHE-097
      IF (LO(119)) RETURN                                               SCHE-098
C TABLES OF QUANTUM NUMBERS.                                            SCHE-099
      IPD=1                                                             SCHE-100
      IF (LO(122)) IPD=2                                                SCHE-101
      IPZ=2*IPD                                                         SCHE-102
      IJA=JMIN-IPZ                                                      SCHE-103
      IAJ=IJA                                                           SCHE-104
      DO 4 JPI=1,2                                                      SCHE-105
      NC=0                                                              SCHE-106
      DO 3 I=1,NCOLS                                                    SCHE-107
      NJ1=IJA-IPI(3,I)+1                                                SCHE-108
      NJ=IPI(3,I)                                                       SCHE-109
      DO 2 J=1,NJ                                                       SCHE-110
      L1=NJ1-IPI(2,I)+1                                                 SCHE-111
      NM=IPI(2,I)                                                       SCHE-112
      DO 1 K=1,NM                                                       SCHE-113
      IF (MOD(L1+2*IPI(1,I)+2*(JPI+IPD),4).EQ.0) GO TO 1                SCHE-114
      NC=NC+1                                                           SCHE-115
      MC(NC,JPI,1)=I                                                    SCHE-116
      MC(NC,JPI,2)=L1                                                   SCHE-117
      MC(NC,JPI,3)=NJ1                                                  SCHE-118
    1 L1=L1+2                                                           SCHE-119
    2 NJ1=NJ1+2                                                         SCHE-120
    3 CONTINUE                                                          SCHE-121
    4 CONTINUE                                                          SCHE-122
      NXY=0                                                             SCHE-123
      IF (LO(81).AND.(.NOT.LO(82))) NXY=NSP(3)+2                        SCHE-124
      IF (.NOT.LO(43)) GO TO 38                                         SCHE-125
C INTERPOLATION FOR THE S-MATRIX.                                       SCHE-126
      RZ=4.D0*PI*XZ*DFLOAT(IPD)                                         SCHE-127
      I1=0                                                              SCHE-128
      I4=0                                                              SCHE-129
C LOOP ON PARITIES.                                                     SCHE-130
      DO 17 J=1,2                                                       SCHE-131
      I2=I1+NCT(J)                                                      SCHE-132
      I3=NCT(J+2)                                                       SCHE-133
      I1=I1+1                                                           SCHE-134
      IF (I1.GT.I2) GO TO 17                                            SCHE-135
C LOOP ON SOLUTIONS.                                                    SCHE-136
      DO 16 K=1,I3                                                      SCHE-137
      JI4=(3+MAX0(IPI(3,1)-1-IAJ-MC(K,J,3),IPI(2,1)-1-MC(K,J,2)-MC(K,J,3SCHE-138
     1),-2*MC(K,J,2),-2*MC(K,J,3)))/4-IPD+1                             SCHE-139
      I6=0                                                              SCHE-140
C LOOP ON S MATRIX ELEMENTS.                                            SCHE-141
      DO 15 I=I1,I2                                                     SCHE-142
      I4=I4+1                                                           SCHE-143
      I6=I6+1                                                           SCHE-144
      IV=MC(I6,J,1)                                                     SCHE-145
      JI3=(3+MAX0(IPI(3,IV)-1-IAJ-MC(I6,J,3),IPI(2,IV)-1-MC(I6,J,2)-MC(ISCHE-146
     16,J,3),-2*MC(I6,J,2),-2*MC(I6,J,3)))/4-IPD+1                      SCHE-147
      JI1=MAX0(JI3,JI4)                                                 SCHE-148
      JT1=MIN0(IPJ,IPI(10,1)-MC(K,J,2)/2,IPI(10,IV)-MC(IV,J,2)/2)       SCHE-149
      N1=0                                                              SCHE-150
      N3=1                                                              SCHE-151
    5 IF (N3.LT.JI1) GO TO 6                                            SCHE-152
      N1=N1+1                                                           SCHE-153
      K1=K2                                                             SCHE-154
      K2=K3                                                             SCHE-155
      K3=K4                                                             SCHE-156
      K4=N3                                                             SCHE-157
      IF (N1.GT.3) GO TO 9                                              SCHE-158
    6 DO 7 L=1,JIT                                                      SCHE-159
      IF (N3.LE.JTI(1,L)) GO TO 8                                       SCHE-160
    7 N3=N3+JTI(2,L)*IPD                                                SCHE-161
      L=JIT                                                             SCHE-162
    8 N3=N3+IPD                                                         SCHE-163
      IF (N3.LE.JT1) GO TO 5                                            SCHE-164
      IF (N3.GT.JTI(1,L)+JTI(2,L)*IPD+IPD) GO TO 14                     SCHE-165
      GO TO 69                                                          SCHE-166
    9 JI2=K3-IPD                                                        SCHE-167
      IF (N3.EQ.JT1) JI2=K4-IPD                                         SCHE-168
      IF (JI1.GT.JI2) GO TO 14                                          SCHE-169
      M1=(K1-K2)*(K1-K3)*(K1-K4)                                        SCHE-170
      M2=(K2-K1)*(K2-K3)*(K2-K4)                                        SCHE-171
      M3=(K3-K1)*(K3-K2)*(K3-K4)                                        SCHE-172
      M4=(K4-K1)*(K4-K2)*(K4-K3)                                        SCHE-173
      N2=1                                                              SCHE-174
      DO 13 N4=JI1,JI2,IPD                                              SCHE-175
      IF (N4.EQ.K1.OR.N4.EQ.K2.OR.N4.EQ.K3.OR.N4.EQ.K4) GO TO 13        SCHE-176
      SZ=RZ*DFLOAT(2*N4+JMIN-1)                                         SCHE-177
      IF (N2.NE.1) GO TO 10                                             SCHE-178
      N2=3                                                              SCHE-179
      A2=F(1,K1,I4)**2+F(2,K1,I4)**2                                    SCHE-180
      B2=F(1,K2,I4)**2+F(2,K2,I4)**2                                    SCHE-181
      C2=F(1,K3,I4)**2+F(2,K3,I4)**2                                    SCHE-182
      D2=F(1,K4,I4)**2+F(2,K4,I4)**2                                    SCHE-183
      IF (A2*B2*C2*D2.EQ.0.D0) GO TO 10                                 SCHE-184
      A1=DATAN2(F(2,K1,I4),F(1,K1,I4))                                  SCHE-185
      B1=DATAN2(F(2,K2,I4),F(1,K2,I4))                                  SCHE-186
      C1=DATAN2(F(2,K3,I4),F(1,K3,I4))                                  SCHE-187
      D1=DATAN2(F(2,K4,I4),F(1,K4,I4))                                  SCHE-188
      IF ((A1-B1)*(B1-C1).LT.0.D0.OR.(B1-C1)*(C1-D1).LT.0.D0) GO TO 10  SCHE-189
      N2=2                                                              SCHE-190
      A2=DLOG(A2)                                                       SCHE-191
      B2=DLOG(B2)                                                       SCHE-192
      C2=DLOG(C2)                                                       SCHE-193
      D2=DLOG(D2)                                                       SCHE-194
   10 A3=DFLOAT((N4-K2)*(N4-K3)*(N4-K4))/DFLOAT(M1)                     SCHE-195
      B3=DFLOAT((N4-K1)*(N4-K3)*(N4-K4))/DFLOAT(M2)                     SCHE-196
      C3=DFLOAT((N4-K1)*(N4-K2)*(N4-K4))/DFLOAT(M3)                     SCHE-197
      D3=DFLOAT((N4-K1)*(N4-K2)*(N4-K3))/DFLOAT(M4)                     SCHE-198
      IF (N2.EQ.3) GO TO 11                                             SCHE-199
      A4=A1*A3+B1*B3+C1*C3+D1*D3                                        SCHE-200
      B4=DEXP(0.5D0*(A2*A3+B2*B3+C2*C3+D2*D3))                          SCHE-201
      F(1,N4,I4)=B4*DCOS(A4)                                            SCHE-202
      F(2,N4,I4)=B4*DSIN(A4)                                            SCHE-203
      GO TO 12                                                          SCHE-204
   11 F(1,N4,I4)=F(1,K1,I4)*A3+F(1,K2,I4)*B3+F(1,K3,I4)*C3+F(1,K4,I4)*D3SCHE-205
      F(2,N4,I4)=F(2,K1,I4)*A3+F(2,K2,I4)*B3+F(2,K3,I4)*C3+F(2,K4,I4)*D3SCHE-206
   12 TX(IV+1)=TX(IV+1)+(F(1,N4,I4)**2+F(2,N4,I4)**2)*SZ                SCHE-207
      IF (I6.EQ.K) TX(1)=TX(1)+F(2,N4,I4)*SZ                            SCHE-208
   13 CONTINUE                                                          SCHE-209
   14 JI1=JI2+IPZ                                                       SCHE-210
      IF (JI1.LT.JT1) GO TO 6                                           SCHE-211
   15 CONTINUE                                                          SCHE-212
   16 CONTINUE                                                          SCHE-213
   17 I1=I2                                                             SCHE-214
      IF (.NOT.(LO(81).AND.LO(132))) GO TO 38                           SCHE-215
C INTERPOLATION FOR THE COMPOUND NUCLEUS.                               SCHE-216
      I1=0                                                              SCHE-217
      I4=0                                                              SCHE-218
      DO 37 J=1,3                                                       SCHE-219
      IF (J.LE.2) GO TO 18                                              SCHE-220
      IF (NXY.EQ.0) GO TO 37                                            SCHE-221
      I2=I1                                                             SCHE-222
      I3=NXY                                                            SCHE-223
      GO TO 19                                                          SCHE-224
   18 I2=I1+NCT(J+4)                                                    SCHE-225
      I3=NCT(J+2)                                                       SCHE-226
      I1=I1+1                                                           SCHE-227
   19 IF (I1.GT.I2) GO TO 37                                            SCHE-228
      I6=0                                                              SCHE-229
C LOOP ON SOLUTIONS.                                                    SCHE-230
      DO 36 K=1,I3                                                      SCHE-231
      IF (J.EQ.3) GO TO 20                                              SCHE-232
      JI4=(3+MAX0(IPI(3,1)-1-IAJ-MC(K,J,3),IPI(2,1)-1-MC(K,J,2)-MC(K,J,3SCHE-233
     1),-2*MC(K,J,2),-2*MC(K,J,3)))/4-IPD+1                             SCHE-234
   20 I6=0                                                              SCHE-235
C LOOP ON S MATRIX ELEMENTS.                                            SCHE-236
      DO 35 I=I1,I2                                                     SCHE-237
      I4=I4+1                                                           SCHE-238
      I6=I6+1                                                           SCHE-239
      JI1=1                                                             SCHE-240
      IF (J.EQ.3) GO TO 21                                              SCHE-241
      IV=MC(I6,J,1)                                                     SCHE-242
      IVL=IV+NCOLL+1                                                    SCHE-243
      JI3=(3+MAX0(IPI(3,IV)-1-IAJ-MC(I6,J,3),IPI(2,IV)-1-MC(I6,J,2)-MC(ISCHE-244
     16,J,3),-2*MC(I6,J,2),-2*MC(I6,J,3)))/4-IPD+1                      SCHE-245
      JI1=MAX0(JI3,JI4)                                                 SCHE-246
      GO TO 22                                                          SCHE-247
   21 IVL=K+NCOLL+NCOLS+1                                               SCHE-248
   22 NT=0                                                              SCHE-249
      JPJ=0                                                             SCHE-250
      DO 23 L=JI1,IPK                                                   SCHE-251
      IF (DABS(FN(L,I4)).LT.1.D-15) GO TO 23                            SCHE-252
      NT=NT+1                                                           SCHE-253
      JPJ=L                                                             SCHE-254
   23 CONTINUE                                                          SCHE-255
      NT=MIN0(NT,4)-1                                                   SCHE-256
      IF (NT.LT.1) GO TO 35                                             SCHE-257
      N1=0                                                              SCHE-258
      N3=1                                                              SCHE-259
   24 IF (N3.LT.JI1) GO TO 25                                           SCHE-260
      N1=N1+1                                                           SCHE-261
      K1=K2                                                             SCHE-262
      K2=K3                                                             SCHE-263
      K3=K4                                                             SCHE-264
      K4=N3                                                             SCHE-265
      IF (N1.GT.NT) GO TO 28                                            SCHE-266
   25 DO 26 L=1,JIT                                                     SCHE-267
      IF (N3.LE.JTI(1,L)) GO TO 27                                      SCHE-268
   26 N3=N3+JTI(2,L)*IPD                                                SCHE-269
      L=JIT                                                             SCHE-270
   27 N3=N3+IPD                                                         SCHE-271
      IF (N3.LE.JPJ) GO TO 24                                           SCHE-272
      IF (N3.GT.JTI(1,L)+JTI(2,L)*IPD+IPD) GO TO 34                     SCHE-273
   28 JI2=K3-IPD                                                        SCHE-274
      IF (N3.EQ.JPJ) JI2=K4-IPD                                         SCHE-275
      IF (JI1.GT.JI2) GO TO 34                                          SCHE-276
      DO 33 N4=JI1,JI2,IPD                                              SCHE-277
      IF (N4.EQ.K1.OR.N4.EQ.K2.OR.N4.EQ.K3.OR.N4.EQ.K4) GO TO 33        SCHE-278
      SZ=RZ*DFLOAT(2*N4+JMIN-1)                                         SCHE-279
      IF (NT.LT.3) GO TO 29                                             SCHE-280
      A3=DFLOAT((N4-K2)*(N4-K3)*(N4-K4))/DFLOAT((K1-K2)*(K1-K3)*(K1-K4))SCHE-281
      B3=DFLOAT((N4-K1)*(N4-K3)*(N4-K4))/DFLOAT((K2-K1)*(K2-K3)*(K2-K4))SCHE-282
      C3=DFLOAT((N4-K1)*(N4-K2)*(N4-K4))/DFLOAT((K3-K1)*(K3-K2)*(K3-K4))SCHE-283
      D3=DFLOAT((N4-K1)*(N4-K2)*(N4-K3))/DFLOAT((K4-K1)*(K4-K2)*(K4-K3))SCHE-284
      FN(N4,I4)=DABS(FN(K1,I4)*A3+FN(K2,I4)*B3+FN(K3,I4)*C3+FN(K4,I4)*D3SCHE-285
     1)                                                                 SCHE-286
      GO TO 31                                                          SCHE-287
   29 IF (NT.EQ.1) GO TO 30                                             SCHE-288
      B3=DFLOAT((N4-K3)*(N4-K4))/DFLOAT((K2-K3)*(K2-K4))                SCHE-289
      C3=DFLOAT((N4-K2)*(N4-K4))/DFLOAT((K3-K2)*(K3-K4))                SCHE-290
      D3=DFLOAT((N4-K2)*(N4-K3))/DFLOAT((K4-K2)*(K4-K3))                SCHE-291
      FN(N4,I4)=DABS(FN(K2,I4)*B3+FN(K3,I4)*C3+FN(K4,I4)*D3)            SCHE-292
      GO TO 31                                                          SCHE-293
   30 C3=DFLOAT(N4-K4)/DFLOAT(K3-K4)                                    SCHE-294
      D3=DFLOAT(N4-K3)/DFLOAT(K4-K3)                                    SCHE-295
      FN(N4,I4)=DABS(FN(K3,I4)*C3+FN(K4,I4)*D3)                         SCHE-296
   31 TX(IVL)=TX(IVL)+FN(N4,I4)*SZ                                      SCHE-297
      IF ((J.EQ.3).OR.(FN(N4,I4).EQ.0.D0)) GO TO 33                     SCHE-298
      CALL COCN(MC(K,J,2)+IPZ*N4,MC(K,J,2)+IPZ*N4,MC(K,J,3)+IPZ*N4,MC(K,SCHE-299
     1J,3)+IPZ*N4,IPI(3,1)-1,IPI(2,1)-1,IJA+IPZ*N4,N4,BM,BM(N4+1),ID1-N4SCHE-300
     2)                                                                 SCHE-301
      CALL COCN(MC(I6,J,2)+IPZ*N4,MC(I6,J,2)+IPZ*N4,MC(I6,J,3)+IPZ*N4,MCSCHE-302
     1(I6,J,3)+IPZ*N4,IPI(3,IV)-1,IPI(2,IV)-1,IJA+IPZ*N4,N4,BM(N4+1),BM(SCHE-303
     22*N4+1),ID1-2*N4)                                                 SCHE-304
      IF ((IV.EQ.1).AND.(IPI(3,1).GT.1).AND.(K.NE.I6)) CALL COCN(MC(K,J,SCHE-305
     12)+IPZ*N4,MC(I6,J,2)+IPZ*N4,MC(K,J,3)+IPZ*N4,MC(I6,J,3)+IPZ*N4,IPISCHE-306
     2(3,IV)-1,IPI(2,IV)-1,IJA+IPZ*N4,N4,BM(2*N4+1),BM(3*N4+1),ID1-3*N4)SCHE-307
      DO 32 LL=1,N4                                                     SCHE-308
      Z=BM(LL)*BM(LL+N4)                                                SCHE-309
      IF ((IV.EQ.1).AND.(IPI(3,1).GT.1).AND.(K.NE.I6)) Z=BM(LL+2*N4)**2+SCHE-310
     1Z                                                                 SCHE-311
   32 FGN(LL,IV)=FGN(LL,IV)+Z*FN(N4,I4)*XZ                              SCHE-312
   33 CONTINUE                                                          SCHE-313
   34 JI1=JI2+IPZ                                                       SCHE-314
      IF (JI1.LT.JPJ) GO TO 25                                          SCHE-315
   35 CONTINUE                                                          SCHE-316
   36 CONTINUE                                                          SCHE-317
   37 I1=I2                                                             SCHE-318
   38 IK=1                                                              SCHE-319
      NPT=0                                                             SCHE-320
      DO 57 IJ=1,IPJ,IPD                                                SCHE-321
C TRANSFER OF S MATRIX FOR A GIVEN ANGULAR MOMENTUM.                    SCHE-322
      I1=0                                                              SCHE-323
      I4=0                                                              SCHE-324
      DO 41 J=1,2                                                       SCHE-325
      I2=I1+NCT(J+2)                                                    SCHE-326
      I1=I1+1                                                           SCHE-327
      IF (I1.GT.I2) GO TO 41                                            SCHE-328
      I3=NCT(J)                                                         SCHE-329
      DO 40 I=I1,I2                                                     SCHE-330
      DO 39 K=1,I3                                                      SCHE-331
      I4=I4+1                                                           SCHE-332
      FA(1,K,I)=F(1,IJ,I4)                                              SCHE-333
   39 FA(2,K,I)=F(2,IJ,I4)                                              SCHE-334
   40 CONTINUE                                                          SCHE-335
   41 I1=I2                                                             SCHE-336
      DO 42 I=1,KBA                                                     SCHE-337
      F(1,IJ,I)=0.D0                                                    SCHE-338
   42 F(2,IJ,I)=0.D0                                                    SCHE-339
      J1=0                                                              SCHE-340
      IAJ=IAJ+IPZ                                                       SCHE-341
      AAJ=DFLOAT(IAJ+1)                                                 SCHE-342
      DO 54 JI=1,2                                                      SCHE-343
      J2=J1+NCT(JI+2)                                                   SCHE-344
      J1=J1+1                                                           SCHE-345
      IF (J1.GT.J2) GO TO 54                                            SCHE-346
      NC1=0                                                             SCHE-347
      NC2=0                                                             SCHE-348
      NC=NCT(JI)                                                        SCHE-349
C GEOMETRIC COEFFICIENT FOR THE TRANSFORMATION TO HELICITY COEFFICIENTS.SCHE-350
      DO 48 IC=1,NC                                                     SCHE-351
      MC(IC,JI,2)=MC(IC,JI,2)+IPZ                                       SCHE-352
      MC(IC,JI,3)=MC(IC,JI,3)+IPZ                                       SCHE-353
      IV=MC(IC,JI,1)                                                    SCHE-354
      NI=IPI(2,IV)                                                      SCHE-355
      MI=IPI(3,IV)                                                      SCHE-356
      MC(IC,1,4)=MIN0(MC(IC,JI,3)-IABS(IAJ+1-MI),MC(IC,JI,2)-IABS(MC(IC,SCHE-357
     1JI,3)+1-NI))                                                      SCHE-358
      IF (MC(IC,JI,2).GT.2*IPI(10,IV)) MC(IC,1,4)=-1                    SCHE-359
      IF (MC(IC,1,4).LT.0) GO TO 48                                     SCHE-360
      IF (IV.EQ.1) NC1=NC1+1                                            SCHE-361
      NC2=NC2+1                                                         SCHE-362
      A1=0.D0                                                           SCHE-363
      YM=DFLOAT(MC(IC,JI,3)-NI+1)                                       SCHE-364
      XB1=0.5D0*DFLOAT(NI**2+(MC(IC,JI,3)-MC(IC,JI,2))*(MC(IC,JI,2)+MC(ISCHE-365
     1C,JI,3)+2)-1)                                                     SCHE-366
      C3=0.D0                                                           SCHE-367
C COUPLING FOR PARTICLE HELICITY.                                       SCHE-368
      DO 43 I1=1,NI                                                     SCHE-369
      BM(I1)=0.D0                                                       SCHE-370
      IF (IABS(2*I1-NI-1).GT.MC(IC,JI,3)) GO TO 43                      SCHE-371
      N3=(MC(IC,JI,3)+2*I1-NI-1)*(MC(IC,JI,3)-2*I1+NI+3)*(I1-1)         SCHE-372
      IF (N3.EQ.0) BM(I1)=DFLOAT(2*MOD(I1,2)-1)                         SCHE-373
      IF (N3.LE.0) GO TO 43                                             SCHE-374
      C2=C3                                                             SCHE-375
      C3=DSQRT(DFLOAT((NI-I1+1)*(I1-1))*(YM+DFLOAT(2*I1-2))*(YM+DFLOAT(2SCHE-376
     1*NI-2*I1+2)))                                                     SCHE-377
      BM(I1)=(XB1-DFLOAT(2*I1-NI-3)**2)*BM(I1-1)/C3                     SCHE-378
      IF (I1.GE.3) BM(I1)=BM(I1)-C2*BM(I1-2)/C3                         SCHE-379
   43 A1=A1+BM(I1)**2                                                   SCHE-380
      DO 47 I1=1,NI                                                     SCHE-381
      A2=0.D0                                                           SCHE-382
      IF (DABS(BM(I1)).LT.1.D-10) GO TO 45                              SCHE-383
      IA=2*I1-NI-1                                                      SCHE-384
      XB1=0.5D0*DFLOAT(MI**2+(IAJ-MC(IC,JI,3))*(IAJ+MC(IC,JI,3)+2)-1)   SCHE-385
      C3=0.D0                                                           SCHE-386
C COUPLING FOR TARGET HELICITY.                                         SCHE-387
      DO 44 I2=1,MI                                                     SCHE-388
      BM(NI+I2)=0.D0                                                    SCHE-389
      IF (IABS(2*I2-MI-1-IA).GT.IAJ) GO TO 44                           SCHE-390
      N3=(IAJ+IA-2*I2+MI+3)*(IAJ-IA+2*I2-MI-1)*(I2-1)                   SCHE-391
      IF (N3.EQ.0) BM(NI+I2)=DFLOAT(2*MOD(I2,2)-1)                      SCHE-392
      IF (N3.LE.0) GO TO 44                                             SCHE-393
      C2=C3                                                             SCHE-394
      IB=2*I2-MI-3                                                      SCHE-395
      C3=DSQRT(DFLOAT((MI-I2+1)*(I2-1))*(AAJ**2-DFLOAT(2*I1-2*I2+MI-NI+1SCHE-396
     1)**2))                                                            SCHE-397
      BM(NI+I2)=((XB1-DFLOAT(IB*(IB-IA)))*BM(NI+I2-1)-C2*BM(NI+I2-2))/C3SCHE-398
   44 A2=A2+BM(NI+I2)**2                                                SCHE-399
      IF (A2*A1.NE.0.D0) A2=DFLOAT(MOD(1+MC(IC,JI,3)-IAJ+MI,4)-1)*DSQRT(SCHE-400
     1AAJ/(A1*A2))                                                      SCHE-401
   45 DO 46 I2=1,MI                                                     SCHE-402
   46 AM(I1,I2,IC)=BM(I1)*BM(NI+I2)*A2                                  SCHE-403
   47 CONTINUE                                                          SCHE-404
   48 CONTINUE                                                          SCHE-405
      IF (NC1.EQ.0) GO TO 54                                            SCHE-406
      NCIN=NCT(JI+2)                                                    SCHE-407
C TRANSFORMATION.                                                       SCHE-408
      IF (IK.NE.IJ) GO TO 49                                            SCHE-409
      IF (.NOT.(LO(56).OR.LO(60))) GO TO 49                             SCHE-410
      BJ=.5D0*DFLOAT(IAJ)                                               SCHE-411
      JIJ=1+MOD(IJ+JI,2)                                                SCHE-412
      NC1=NC1*NC2                                                       SCHE-413
      IF (LO(56)) WRITE (MW,1000) BJ,IP(JIJ)                            SCHE-414
      NPT=NPT+1                                                         SCHE-415
      IF (LO(60)) WRITE (94,1001) BJ,IP(JIJ),NC2,NC1                    SCHE-416
   49 NC1=0                                                             SCHE-417
      DO 53 IC=1,NCIN                                                   SCHE-418
      IF (MC(IC,1,4).LT.0) GO TO 53                                     SCHE-419
      ICX=IC                                                            SCHE-420
      NC1=NC1+1                                                         SCHE-421
      IF (JI.EQ.2) ICX=ICX+NCT(3)                                       SCHE-422
      LCI=MC(IC,JI,2)/2+1                                               SCHE-423
      NC2=0                                                             SCHE-424
      DO 52 ICP=1,NC                                                    SCHE-425
      IF (MC(ICP,1,4).LT.0) GO TO 52                                    SCHE-426
      LCP=MC(ICP,JI,2)/2+1                                              SCHE-427
      IV=MC(ICP,JI,1)                                                   SCHE-428
      NC2=NC2+1                                                         SCHE-429
      C1=XG(LCI,1)+XG(LCP,IV)                                           SCHE-430
      IF (IK.NE.IJ) GO TO 50                                            SCHE-431
      IF (.NOT.(LO(56).OR.LO(60))) GO TO 50                             SCHE-432
      B1=-2.D0*FA(2,ICP,ICX)                                            SCHE-433
      IF (IC.EQ.ICP) B1=B1+1.D0                                         SCHE-434
      B2=2.D0*FA(1,ICP,ICX)                                             SCHE-435
      B3=DSQRT(B1**2+B2**2)                                             SCHE-436
      D1=0.D0                                                           SCHE-437
      IF (B3.NE.0.D0) D1=DATAN2(B2,B1)                                  SCHE-438
      D2=DMOD(D1+C1+PI,2.D0*PI)-PI                                      SCHE-439
      LC=LCP-1                                                          SCHE-440
      BJ=0.5D0*DFLOAT(MC(ICP,JI,3))                                     SCHE-441
      IF (LO(56)) WRITE (MW,1002) NC1,NC2,IV,LC,BJ,B1,B2,B3,D1,D2       SCHE-442
      IF (LO(60)) WRITE (94,10031) NC1,NC2,IV,LC,BJ,B1,B2,B3            SCHE-443
C MULTIPLICATION BY THE COULOMB PHASE.                                  SCHE-444
   50 A1=DCOS(C1)                                                       SCHE-445
      A2=DSIN(C1)                                                       SCHE-446
      C2=FA(1,ICP,ICX)*A1-FA(2,ICP,ICX)*A2                              SCHE-447
      C3=FA(1,ICP,ICX)*A2+FA(2,ICP,ICX)*A1                              SCHE-448
      I1=IPI(6,IV)                                                      SCHE-449
      I2=IPI(7,IV)                                                      SCHE-450
C  HELICITY SCATTERING COEFFICIENTS.                                    SCHE-451
      DO 51 ID=I1,I2                                                    SCHE-452
      MF1=MF(1,ID)                                                      SCHE-453
      MF2=MF(2,ID)                                                      SCHE-454
      MF3=MF(3,ID)                                                      SCHE-455
      MF4=MF(4,ID)                                                      SCHE-456
      C1=AM(MF1,MF2,ICP)*AM(MF3,MF4,IC)                                 SCHE-457
      F(1,IJ,ID)=F(1,IJ,ID)+C2*C1                                       SCHE-458
   51 F(2,IJ,ID)=F(2,IJ,ID)+C3*C1                                       SCHE-459
   52 CONTINUE                                                          SCHE-460
   53 CONTINUE                                                          SCHE-461
   54 CONTINUE                                                          SCHE-462
      IF ((.NOT.LO(43)).OR.IK.NE.IJ) GO TO 56                           SCHE-463
      DO 55 L=1,JIT                                                     SCHE-464
      IF (IK.LE.JTI(1,L)) GO TO 56                                      SCHE-465
   55 IK=IK+JTI(2,L)*IPD                                                SCHE-466
   56 IK=IK+IPD                                                         SCHE-467
   57 CONTINUE                                                          SCHE-468
      IF (.NOT.LO(60)) GO TO 60                                         SCHE-469
      WRITE (60,1004) WV(1,1),WV(13,1),WV(2,1),IPI(4,1),NPT             SCHE-470
      REWIND 94                                                         SCHE-471
      DO 59 I=1,NPT                                                     SCHE-472
      READ (94,1001) U1,IPP,K1,K2                                       SCHE-473
      WRITE (60,1001) U1,IPP,K1,K2                                      SCHE-474
      DO 58 K=1,K2                                                      SCHE-475
      READ (94,10031) K1,K2,K3,K4,BJ,B1,B2,B3                           SCHE-476
   58 WRITE (60,1005) K1,K2,K3,K4,BJ,B1,B2,B3                           SCHE-477
   59 CONTINUE                                                          SCHE-478
C     CLOSE (94)                                                        SCHE-479
   60 IF (.NOT.LO(65)) GO TO 61                                         SCHE-480
      NSA=7*(NLT+2*IPJ+1)+1                                             SCHE-481
      IF (NSA.GT.ID1) CALL MEMO('SCHE',ID1,NSA)                         SCHE-482
      CALL LCSP(F,FGN,JMAX,KMAX,IPI,NCOLL,NCOLS,MF,WV,JMIN,IPJ,IPJ,BM,BMSCHE-483
     1(NSA),ID1-NSA,LO)                                                 SCHE-484
   61 IF (LO(120).OR.(.NOT.LO(41))) RETURN                              SCHE-485
C ELIMINATION OF FACTORS 1/(1-X*COS(THETA)).                            SCHE-486
      NCJ=MIN0(NCJ,IPJ-1)                                               SCHE-487
      IF (NCJ.EQ.0) RETURN                                              SCHE-488
      DO 68 NJ=1,NCJ                                                    SCHE-489
      IPJ=IPJ-1                                                         SCHE-490
C LOOP ON THE INDEPENDENT AMPLITUDES.                                   SCHE-491
      DO 67 K=1,KBA                                                     SCHE-492
      IF (MF(6,K).EQ.99999) GO TO 62                                    SCHE-493
      M1=MF(5,K)                                                        SCHE-494
      M2=MF(6,K)                                                        SCHE-495
      M3=((IABS(M1+M2)+IABS(M1-M2))/2-JMIN)/2+1                         SCHE-496
   62 B3=0.25D0*DFLOAT(M1*M2)                                           SCHE-497
      IF (M3.GT.IPJ) GO TO 70                                           SCHE-498
      D1=0.D0                                                           SCHE-499
      D2=0.D0                                                           SCHE-500
      MJ=2*M3+JMIN-2                                                    SCHE-501
      C3=0.5D0*DFLOAT(MJ)                                               SCHE-502
      F1=DFLOAT((MJ+M2)/2+1-M3)                                         SCHE-503
      F2=DFLOAT((MJ-M2)/2+1-M3)                                         SCHE-504
      F3=DFLOAT((MJ+M1)/2+1-M3)                                         SCHE-505
      F4=DFLOAT((MJ-M1)/2+1-M3)                                         SCHE-506
      C1=0.D0                                                           SCHE-507
      B1=0.D0                                                           SCHE-508
      A1=0.D0                                                           SCHE-509
      B4=0.D0                                                           SCHE-510
C CALC. OF X WHICH MINIMISES THE DIFFERENCES WITH A WEIGHT (J+1)**2     SCHE-511
C FOR THE 5 LAST ONE.                                                   SCHE-512
      NPJ=IPJ-5                                                         SCHE-513
      DO 63 I=M3,IPJ                                                    SCHE-514
      FI=I                                                              SCHE-515
      A2=A1                                                             SCHE-516
      B2=B1                                                             SCHE-517
      A1=F(1,I,K)                                                       SCHE-518
      B1=F(2,I,K)                                                       SCHE-519
      C3=C3+1.D0                                                        SCHE-520
      C2=C1                                                             SCHE-521
      C1=DSQRT((F1+FI)*(F2+FI)*(F3+FI)*(F4+FI))/(C3*(2.D0*C3+1.D0))     SCHE-522
      IF (B3.NE.0.D0) B4=B3/(C3*C3-C3)                                  SCHE-523
      BM(2*I-1)=A1*B4+A2*C2+F(1,I+1,K)*C1                               SCHE-524
      BM(2*I)=B1*B4+B2*C2+F(2,I+1,K)*C1                                 SCHE-525
      IF (I.LE.NPJ) GO TO 63                                            SCHE-526
      D1=D1+C3*C3*(F(1,I,K)*BM(2*I-1)+F(2,I,K)*BM(2*I))                 SCHE-527
      D2=D2+C3*C3*(BM(2*I-1)**2+BM(2*I)**2)                             SCHE-528
   63 C1=C1*(C3+C3+1.D0)/(C3+C3-1.D0)                                   SCHE-529
      A3=.9999999D0                                                     SCHE-530
      IF (LO(18)) GO TO 64                                              SCHE-531
      IF (D2.NE.0.D0) A3=D1/D2                                          SCHE-532
      A4=A3                                                             SCHE-533
C X IS FIXED BETWEEN +1 AND -1                                          SCHE-534
      IF (A4.GT..9999999D0) A4=.9999999D0                               SCHE-535
      IF (A4.LT.-.9999999D0) A4=-.9999999D0                             SCHE-536
C CALCULATION OF THE NEW SCATTERING COEFFICIENTS.                       SCHE-537
      GO TO 65                                                          SCHE-538
   64 A4=A3*DFLOAT(2*MOD(NJ,2)-1)                                       SCHE-539
   65 DO 66 I=M3,IPJ                                                    SCHE-540
      F(1,I,K)=F(1,I,K)-A4*BM(2*I-1)                                    SCHE-541
   66 F(2,I,K)=F(2,I,K)-A4*BM(2*I)                                      SCHE-542
      IF (.NOT.LO(116)) WRITE (MW,1006) K,A4,A3,F(1,IPJ,K),F(2,IPJ,K),F(SCHE-543
     11,IPJ+1,K),F(2,IPJ+1,K)                                           SCHE-544
      F(1,IPJ+1,K)=A4                                                   SCHE-545
   67 CONTINUE                                                          SCHE-546
   68 CONTINUE                                                          SCHE-547
      RETURN                                                            SCHE-548
   69 WRITE (MW,1007) N1                                                SCHE-549
      GO TO 71                                                          SCHE-550
   70 WRITE (MW,1008) NJ                                                SCHE-551
   71 WRITE (MW,1009)                                                   SCHE-552
      STOP                                                              SCHE-553
 1000 FORMAT (//' CHANNEL SPIN AND PARITY =',F7.1,A1//'  IC ICP N    L  SCHE-554
     1  J',18X,'S MATRIX',20X,'|S|',7X,'PHASE /WITH COUL.')             SCHE-555
 1001 FORMAT (1X,F9.1,4X,A1,1X,I4,1X,I4)                                SCHE-556
 1002 FORMAT (1X,3I3,I5,F7.1,4X,1P,2D15.7,' I',4X,0P,3F11.8)            SCHE-557
 1003 FORMAT (1X,3(I2,1X),I3,1X,F5.1,1X,2(1P,D15.7,0P,1X),5X,F11.8)     SCHE-558
10031 FORMAT (1X,3(I3,1X),I3,1X,F5.1,1X,2(1P,D15.7,0P,1X),5X,F11.8)     SCHE-558 
 1004 FORMAT ('<S-MATRIX>',F10.2,1P,D20.8,0P,F10.2,2I5)                 SCHE-559
 1005 FORMAT (1X,3(I3,1X),I3,1X,F5.1,1X,2(1P,D15.7,0P,1X),'I',4X,F11.8) SCHE-560
 1006 FORMAT (' AMPLITUDE =',I3,D15.7,' (',D15.7,')  NEW',2D15.7,3X,'OLDSCHE-561
     1',2D15.7)                                                         SCHE-562
 1007 FORMAT (5X,I2,' AMPLITUDES INSUFFICIENT TO INTERPOLATE.')         SCHE-563
 1008 FORMAT (' AMPLITUDES INSUFFICIENT TO FACTORISE (1-COS)',I2,' TIMESSCHE-564
     1')                                                                SCHE-565
 1009 FORMAT (//' IN SCHE  ...  STOP  ...')                             SCHE-566
      END                                                               SCHE-567
C 27/03/07                                                      ECIS06  LCSP-000
      SUBROUTINE LCSP(F,FCN,JMAX,KMAX,IPI,NCOLL,NCOLS,MF,WV,JMIN,IPJ,IPKLCSP-001
     1,A,AX,JD,LO)                                                      LCSP-002
C COEFFICIENTS OF LEGENDRE POLYNOMIALS FOR CROSS-SECTIONS               LCSP-003
C SCATTERING COEFFICIENTS IN THE HELICITY REPRESENTATION                LCSP-004
C INPUT:     F:       S-MATRIX.                                         LCSP-005
C            FCN:     TRANSMISSION COEFFICIENTS.                        LCSP-006
C            JMAX:    MAXIMUM NUMBER OF CHANNEL SPINS, DIMENSION FOR F. LCSP-007
C            KMAX:    MAXIMUM NUMBER L FOR COMPOUND NUCLEUS, DIMENSION  LCSP-008
C                     FOR FCN.                                          LCSP-009
C            IPI(I,*):MULTIPLICITIES OF TARGET/PARTICLE FOR I=2/3,      LCSP-010
C                     FIRST/LAST CHANNEL NUMBER FOR I=6/7 (SEE DEPH).   LCSP-011
C            NCOLL:   NUMBER OF COUPLED LEVELS.                         LCSP-012
C            NCOLS:   NUMBER OF LEVELS WITH ANGULAR DISTRIBUTION.       LCSP-013
C            MF:      HELICITY NUMBERS (SEE DEPH).                      LCSP-014
C            WV:      WAVE NUMBER AND COULOMB PARAMETER (SEE COLF).     LCSP-015
C            JMIN:    TWICE MINIMUM CHANNEL SPIN.                       LCSP-016
C            IPJ:     NUMBER OF CHANNEL SPIN.                           LCSP-017
C            IPK:     NUMBER OF CHANNEL SPIN FOR COMPOUND NUCLEUS.      LCSP-018
C            JD:      DIMENSION OF WORKING FIELD AX.                    LCSP-019
C            LO(I):   LOGICAL CONTROLS:                                 LCSP-020
C               LO(18) =.TRUE. PROJECTILE-TARGET ANTISYMMETRISATION.    LCSP-021
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             LCSP-022
C WORKING AREAS:                                                        LCSP-023
C            A(7,*):  AMPLITUDE MULTIPLIED BY A LEGENDRE POLYNOMIAL     LCSP-024
C                     ALTERNATIVELY IN A(1-2,*) AND A(3-4,*),           LCSP-025
C                     COEFFICIENTS OF RECURRENCE IN A(5-7,*).           LCSP-026
C            AX:      1 TO JML  LEGENDRE COEFFICIENTS OF CROSS-SECTION: LCSP-027
C                     JML+1 TO JMT    FOR COMPOUND NUCLEUS,             LCSP-028
C                     JMT+1 TO JMX    PRODUCT SPIN ROTATION MATRICES.   LCSP-029
C                                                                       LCSP-030
C FOR THE COMMON  /ANGUL/ SEE LECT.                                     LCSP-031
C FOR THE COMMON  /DCONS/ SEE CALC.                                     LCSP-032
C                                                                       LCSP-033
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     LCSP-034
C  XZ:        CONVERSION FACTOR TO MILLIBARNS.                          LCSP-035
C   USED:     XZ.                                                       LCSP-036
C                                                                       LCSP-037
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ANGUL/:                     LCSP-038
C  NL(1):     POWER OF (1-COS(THETA)) FOR THE EXPANSION IN LEGENDRE     LCSP-039
C             POLYNOMIALS OF THE INTERFERENCE BETWEEN COULOMB AND       LCSP-040
C             NUCLEAR ELASTIC SCATTERING. POWER OF (1-COS(THETA)**2)    LCSP-041
C             IF LO(18) IS .TRUE..                                      LCSP-042
C  NL(2):     NUMBER OF LEGENDRE POLYNOMIALS FOR ELASTIC SCATTERING OF  LCSP-043
C             CHARGED PARTICLES.                                        LCSP-044
C  NL(3):     NUMBER OF LEGENDRE POLYNOMIALS FOR ELASTIC SCATTERING OF  LCSP-045
C             UNCHARGED PARTICLES, INELASTIC SCATTERING AND COMPOUND    LCSP-046
C             NUCLEUS.                                                  LCSP-047
C   USED:     NL.                                                       LCSP-048
C                                                                       LCSP-049
C***********************************************************************LCSP-050
      IMPLICIT REAL*8 (A-H,O-Z)                                         LCSP-051
      LOGICAL LO(150),LS                                                LCSP-052
      DIMENSION F(2,JMAX,*),FCN(KMAX,*),IPI(11,*),MF(10,*),WV(22,*),A(7,LCSP-053
     1*),AX(*),AT(2),NDL(2)                                             LCSP-054
      COMMON /ANGUL/ THETA1,THETA2,DTHETA,DTHE,NCJ,NL(3),JMM(2)         LCSP-055
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            LCSP-056
      COMMON /INOUT/ MR,MW,MS                                           LCSP-057
C DETERMINATION OF THE NUMBER OF LEGENDRE POLYNOMIALS.                  LCSP-058
      NDL(1)=NL(2)                                                      LCSP-059
      NDL(2)=NL(3)                                                      LCSP-060
      IF (NDL(1).EQ.0) NDL(1)=(6*IPJ-3+3*JMIN)/2                        LCSP-061
      IF (NDL(2).EQ.0) NDL(2)=2*IPJ-1+JMIN                              LCSP-062
      WRITE (65,1000) WV(1,1),WV(13,1),WV(2,1),IPI(4,1),NCOLS           LCSP-063
      WRITE (MW,1001)                                                   LCSP-064
C LOOP ON LEVELS.                                                       LCSP-065
      DO 36 JK=1,NCOLS                                                  LCSP-066
      IF (WV(3,JK).LT.0.D0) GO TO 35                                    LCSP-067
      IF (JK.GT.NCOLL) GO TO 32                                         LCSP-068
      JK1=IPI(6,JK)                                                     LCSP-069
      JK2=IPI(7,JK)                                                     LCSP-070
      JML=NDL(2)                                                        LCSP-071
      LS=JK.EQ.1.AND.WV(5,1).NE.0.D0                                    LCSP-072
      IF (LS) JML=NDL(1)                                                LCSP-073
      JMT=JML                                                           LCSP-074
      IF (JMT.GT.JD) CALL MEMO('LCSP',ID,JMT)                           LCSP-075
      DO 1 J=1,JMT                                                      LCSP-076
    1 AX(J)=0.D0                                                        LCSP-077
C LOOP ON AMPLITUDES.                                                   LCSP-078
      DO 29 I=JK1,JK2                                                   LCSP-079
      IF (MF(6,I).EQ.99999) GO TO 3                                     LCSP-080
      M1=MF(5,I)                                                        LCSP-081
      M2=MF(6,I)                                                        LCSP-082
      M3=((IABS(M1+M2)+IABS(M1-M2))/2-JMIN)/2+1                         LCSP-083
      IF (JK.GT.NCOLL) GO TO 3                                          LCSP-084
      A1=0.25D0*DFLOAT(M1*M2)                                           LCSP-085
      MJ=2*M3+JMIN-2                                                    LCSP-086
      A2=0.5D0*DFLOAT(MJ)                                               LCSP-087
      X1=DFLOAT((MJ+M2)/2+1-M3)                                         LCSP-088
      X2=DFLOAT((MJ-M2)/2+1-M3)                                         LCSP-089
      X3=DFLOAT((MJ+M1)/2+1-M3)                                         LCSP-090
      X4=DFLOAT((MJ-M1)/2+1-M3)                                         LCSP-091
      A(7,M3)=0.D0                                                      LCSP-092
C COEFFICIENTS OF THE RECURRENCE.                                       LCSP-093
      JM1=JML+IPJ                                                       LCSP-094
      JM=JM1+1                                                          LCSP-095
      IF (M3.GT.JM1) GO TO 3                                            LCSP-096
      DO 2 J=M3,JM1                                                     LCSP-097
      XJ=DFLOAT(J)                                                      LCSP-098
      A2=A2+1.D0                                                        LCSP-099
      A(6,J)=0.D0                                                       LCSP-100
      IF (A1.NE.0.D0) A(6,J)=A1/(A2*A2-A2)                              LCSP-101
      A(5,J)=DSQRT((X1+XJ)*(X2+XJ)*(X3+XJ)*(X4+XJ))/(A2*(2.D0*A2+1.D0)) LCSP-102
    2 A(7,J+1)=A(5,J)*(A2+A2+1.D0)/(A2+A2-1.D0)                         LCSP-103
    3 IF (M3.GT.JM) GO TO 29                                            LCSP-104
      DO 4 J=M3,JM                                                      LCSP-105
      A(1,J)=0.D0                                                       LCSP-106
      A(2,J)=0.D0                                                       LCSP-107
      A(3,J)=0.D0                                                       LCSP-108
      IF (J.GT.IPJ) GO TO 4                                             LCSP-109
      A(1,J)=F(1,J,I)                                                   LCSP-110
      A(2,J)=F(2,J,I)                                                   LCSP-111
    4 A(4,J)=0.D0                                                       LCSP-112
      IF (.NOT.LS) GO TO 24                                             LCSP-113
C COULOMB AMPLITUDE.                                                    LCSP-114
      NS1=IPI(2,1)-1                                                    LCSP-115
      NS2=IPI(3,1)-1                                                    LCSP-116
      NSM=IABS(NS1-NS2)-JMIN                                            LCSP-117
      NSP=NS1+NS2-JMIN                                                  LCSP-118
      XS3=DFLOAT(NS1+NS2+2)                                             LCSP-119
      XS4=DFLOAT(NS1-NS2)                                               LCSP-120
      NST=NSP/2+1                                                       LCSP-121
      JMX=JMT+NST                                                       LCSP-122
      JMY=JMX+2                                                         LCSP-123
      IF (LO(18)) JMY=JMY+2*NL(1)                                       LCSP-124
      IF (JMY.GT.JD) CALL MEMO('LCSP',ID,JMY)                           LCSP-125
      DO 5 J=1,NST                                                      LCSP-126
    5 AX(JMT+J)=1.D0                                                    LCSP-127
C REDUCED ROTATION MATRIX ELEMENT.                                      LCSP-128
      DO 9 I1=1,2                                                       LCSP-129
      MS1=2*MF(2*I1-1,I)-NS1-2                                          LCSP-130
      MS2=NS2-2*MF(2*I1,I)+2                                            LCSP-131
      MSP=IABS(MS1+MS2)-JMIN                                            LCSP-132
      NSQ=MAX0(NSM,MSP)/2+1                                             LCSP-133
      XS=MS1+MS2                                                        LCSP-134
      AT(I1)=1.D0                                                       LCSP-135
      IF (NSQ.EQ.1) GO TO 7                                             LCSP-136
      DO 6 J=2,NSQ                                                      LCSP-137
    6 AX(JMT+J-1)=0.D0                                                  LCSP-138
    7 IF (NSQ.EQ.NST) GO TO 9                                           LCSP-139
      NS=NSQ+1                                                          LCSP-140
      A2=0.D0                                                           LCSP-141
      A1=1.D0                                                           LCSP-142
      B2=0.D0                                                           LCSP-143
      DO 8 K=NS,NST                                                     LCSP-144
      A3=A2                                                             LCSP-145
      A2=A1                                                             LCSP-146
      B1=B2                                                             LCSP-147
      XJ=DFLOAT(2*K+JMIN-2)                                             LCSP-148
      B2=DSQRT((XJ**2-XS**2)*(XS3**2-XJ**2)*(XJ**2-XS4**2)/(XJ**2-1.D0))LCSP-149
     1/(2.D0*XJ)                                                        LCSP-150
      B3=DFLOAT(MS1-MS2)                                                LCSP-151
      IF (XJ.NE.2.D0) B3=B3-XS*XS3*XS4/(XJ*(XJ-2.D0))                   LCSP-152
      A1=(A2*B3-A3*B1)/B2                                               LCSP-153
      AX(JMT+K)=AX(JMT+K)*A1                                            LCSP-154
    8 AT(I1)=AT(I1)+A1**2                                               LCSP-155
    9 CONTINUE                                                          LCSP-156
      IJX=NL(1)                                                         LCSP-157
      A3=1.D0                                                           LCSP-158
      JP=IPJ                                                            LCSP-159
C MULTIPLICATION BY (1-COS), (1-COS**2) OR THEIR SQUARES.               LCSP-160
   10 DO 12 IJ=1,IJX                                                    LCSP-161
      A1=0.D0                                                           LCSP-162
      B1=0.D0                                                           LCSP-163
      DO 11 J=M3,JP                                                     LCSP-164
      A2=A1                                                             LCSP-165
      B2=B1                                                             LCSP-166
      A1=A(1,J)                                                         LCSP-167
      B1=A(2,J)                                                         LCSP-168
      A(1,J)=A1-A3*(A(7,J)*A2+A(6,J)*A1+A(5,J)*A(1,J+1))                LCSP-169
   11 A(2,J)=B1-A3*(A(7,J)*B2+A(6,J)*B1+A(5,J)*A(2,J+1))                LCSP-170
      JP=JP+1                                                           LCSP-171
      A(1,JP)=-A3*A1*A(6,JP)                                            LCSP-172
   12 A(2,JP)=-A3*B1*A(6,JP)                                            LCSP-173
      A3=-A3                                                            LCSP-174
      IF (LO(18).AND.A3.LT.0.D0) GO TO 10                               LCSP-175
C INITIALISATION OF COULOMB PHASE SHIFTS.                               LCSP-176
      C1=DSQRT(AT(1)*AT(2))                                             LCSP-177
      IF (AX(JMX).LT.0.D0) C1=-C1                                       LCSP-178
      C2=DFLOAT(IJX)                                                    LCSP-179
      C3=2.D0**(IJX-1)                                                  LCSP-180
      DO 23 IK=1,2                                                      LCSP-181
      NX=0                                                              LCSP-182
      NST1=NST                                                          LCSP-183
      DO 13 J=1,NST                                                     LCSP-184
      A1=2.D0*AX(JMT+J)/C1*DFLOAT(1-MOD(J+IK,2))                        LCSP-185
      IF (A1.NE.0.D0) NX=NX+1                                           LCSP-186
   13 A(3,J)=A1                                                         LCSP-187
      IF (NX.EQ.0) GO TO 23                                             LCSP-188
      AX(JMX+1)=-C2*C3*WV(5,1)/(C2*C2+WV(5,1)**2)                       LCSP-189
      AX(JMX+2)=-C3*WV(5,1)**2/(C2*C2+WV(5,1)**2)                       LCSP-190
      IF (.NOT.LO(18)) GO TO 15                                         LCSP-191
      AX(JMX+1)=4.D0*C3*AX(JMX+1)                                       LCSP-192
      AX(JMX+2)=4.D0*C3*AX(JMX+2)                                       LCSP-193
      DO 14 J=1,IJX                                                     LCSP-194
      A2=DFLOAT(J)*(DFLOAT(J+IJX)**2+WV(5,1)**2)                        LCSP-195
      A1=-DFLOAT(IJX-J+1)*(DFLOAT(IJX+J)*DFLOAT(IJX+J-1)+WV(5,1)**2)/A2 LCSP-196
      B1=DFLOAT(IJX-J+1)*WV(5,1)/A2                                     LCSP-197
      AX(JMX+2*J+1)=AX(JMX+2*J-1)*A1-AX(JMX+2*J)*B1                     LCSP-198
   14 AX(JMX+2*J+2)=AX(JMX+2*J-1)*B1+AX(JMX+2*J)*A1                     LCSP-199
   15 I1=3                                                              LCSP-200
      DO 21 L=1,JM                                                      LCSP-201
      B1=2*L-1                                                          LCSP-202
C COULOMB PHASE SHIFT.                                                  LCSP-203
      A1=AX(JMX+1)                                                      LCSP-204
      A2=AX(JMX+2)                                                      LCSP-205
      IF (.NOT.LO(18)) GO TO 17                                         LCSP-206
      DO 16 J=1,IJX                                                     LCSP-207
      A1=A1+AX(JMX+2*J+1)                                               LCSP-208
   16 A2=A2+AX(JMX+2*J+2)                                               LCSP-209
   17 DO 18 J=1,NST1                                                    LCSP-210
      IF (LO(18).AND.MOD(L+IK,2).EQ.1) GO TO 18                         LCSP-211
      A(1,J)=A(1,J)+A1*A(I1,J)*B1                                       LCSP-212
      A(2,J)=A(2,J)+A2*A(I1,J)*B1                                       LCSP-213
   18 CONTINUE                                                          LCSP-214
      I2=7-I1                                                           LCSP-215
      IF (L.EQ.JM) GO TO 21                                             LCSP-216
C PRODUCT OF ROTATION MATRIX ELEMENTS BY NEXT PL.                       LCSP-217
      B2=-(B1-1.D0)/(B1+1.D0)                                           LCSP-218
      B3=2.D0*B1/(B1+1.D0)                                              LCSP-219
      A1=0.D0                                                           LCSP-220
      DO 19 J=M3,NST1                                                   LCSP-221
      A2=A1                                                             LCSP-222
      A1=A(I1,J)                                                        LCSP-223
      A(I2,J)=B2*A(I2,J)+(A(7,J)*A2+A(6,J)*A1+A(5,J)*A(I1,J+1))*B3      LCSP-224
      IF (DABS(A(I2,J)).LT.1.D-10) A(I2,J)=0.D0                         LCSP-225
   19 CONTINUE                                                          LCSP-226
      IF (NST1.NE.JM) A(I2,NST1+1)=A(7,NST1+1)*A1*B3                    LCSP-227
      NST1=MIN0(NST1+1,JM)                                              LCSP-228
      A1=(B1+1.D0)*WV(5,1)                                              LCSP-229
      B2=2.D0*C2                                                        LCSP-230
      A3=.25D0*(B1+1.D0+B2)**2+WV(5,1)**2                               LCSP-231
      A2=.25D0*(B1+1.D0-B2)*(B1+1.D0+B2)-WV(5,1)**2                     LCSP-232
      B3=(AX(JMX+1)*A2-AX(JMX+2)*A1)/A3                                 LCSP-233
      AX(JMX+2)=(AX(JMX+1)*A1+AX(JMX+2)*A2)/A3                          LCSP-234
      AX(JMX+1)=B3                                                      LCSP-235
      IF (.NOT.LO(18)) GO TO 21                                         LCSP-236
      DO 20 J=1,IJX                                                     LCSP-237
      B2=B2+2.D0                                                        LCSP-238
      A3=.25D0*(B1+1.D0+B2)**2+WV(5,1)**2                               LCSP-239
      A2=.25D0*(B1+1.D0-B2)*(B1+1.D0+B2)-WV(5,1)**2                     LCSP-240
      B3=(AX(JMX+2*J+1)*A2-AX(JMX+2*J+2)*A1)/A3                         LCSP-241
      AX(JMX+2*J+2)=(AX(JMX+2*J+1)*A1+AX(JMX+2*J+2)*A2)/A3              LCSP-242
   20 AX(JMX+2*J+1)=B3                                                  LCSP-243
   21 I1=I2                                                             LCSP-244
      DO 22 J=M3,JM                                                     LCSP-245
      A(3,J)=0.D0                                                       LCSP-246
   22 A(4,J)=0.D0                                                       LCSP-247
   23 CONTINUE                                                          LCSP-248
   24 B3=JMIN+2*M3-1                                                    LCSP-249
      I1=1                                                              LCSP-250
      I2=3                                                              LCSP-251
C COEFFICIENT OF OTHER PL.                                              LCSP-252
      DO 28 L=1,JML                                                     LCSP-253
      A3=0.D0                                                           LCSP-254
      C1=B3                                                             LCSP-255
      IF (LO(18).AND.MOD(L,2).NE.1) GO TO 26                            LCSP-256
      DO 25 J=M3,IPJ                                                    LCSP-257
      A3=A3+(F(1,J,I)*A(I1,J)+F(2,J,I)*A(I1+1,J))/C1                    LCSP-258
   25 C1=C1+2.D0                                                        LCSP-259
      IF (MF(8,I).NE.0.) A3=A3+A3                                       LCSP-260
      AX(L)=AX(L)+A3*XZ                                                 LCSP-261
   26 IF (L.EQ.JML) GO TO 28                                            LCSP-262
      C1=DFLOAT(L)                                                      LCSP-263
      C2=-(C1-1.D0)/C1                                                  LCSP-264
      C3=(2.D0*C1-1.D0)/C1                                              LCSP-265
      I1=I2                                                             LCSP-266
      I2=4-I1                                                           LCSP-267
      A1=0.D0                                                           LCSP-268
      B1=0.D0                                                           LCSP-269
      DO 27 J=M3,JM1                                                    LCSP-270
      A2=A1                                                             LCSP-271
      B2=B1                                                             LCSP-272
      A1=A(I2,J)                                                        LCSP-273
      B1=A(I2+1,J)                                                      LCSP-274
      A(I1,J)=C2*A(I1,J)+(A(7,J)*A2+A(6,J)*A1+A(5,J)*A(I2,J+1))*C3      LCSP-275
   27 A(I1+1,J)=C2*A(I1+1,J)+(A(7,J)*B2+A(6,J)*B1+A(5,J)*A(I2+1,J+1))*C3LCSP-276
      A(I1,JM)=A(7,JM)*A1*C3                                            LCSP-277
      A(I1+1,JM)=A(7,JM)*B1*C3                                          LCSP-278
   28 CONTINUE                                                          LCSP-279
   29 CONTINUE                                                          LCSP-280
      WRITE (65,1002) JK,JML                                            LCSP-281
      IF (LS) WRITE (MW,1003) JK,IJX,JML                                LCSP-282
      IF (.NOT.LS) WRITE (MW,1004) JK,JML                               LCSP-283
      DO 30 LL=1,JML,5                                                  LCSP-284
      L=LL-1                                                            LCSP-285
      LM=MIN0(JML,LL+4)                                                 LCSP-286
   30 WRITE (MW,1005) L,(AX(M),M=LL,LM)                                 LCSP-287
      DO 31 LL=1,JML                                                    LCSP-288
      L=LL-1                                                            LCSP-289
      IF (LS) WRITE (65,1006) JK,L,AX(LL),IJX                           LCSP-290
      IF (.NOT.LS) WRITE (65,1007) JK,L,AX(LL)                          LCSP-291
   31 CONTINUE                                                          LCSP-292
   32 IF (.NOT.LO(81)) GO TO 36                                         LCSP-293
      WRITE (65,1008) JK,IPK                                            LCSP-294
      WRITE (MW,1009) JK,IPK                                            LCSP-295
      DO 33 LL=1,IPK,5                                                  LCSP-296
      L=2*LL-2                                                          LCSP-297
      LM=MIN0(IPK,LL+4)                                                 LCSP-298
   33 WRITE (MW,1005) L,(FCN(M,JK),M=LL,LM)                             LCSP-299
      DO 34 LL=1,IPK                                                    LCSP-300
      L=2*LL-2                                                          LCSP-301
   34 WRITE (65,1010) JK,L,FCN(LL,JK)                                   LCSP-302
      GO TO 36                                                          LCSP-303
   35 WRITE (65,1011) JK                                                LCSP-304
   36 CONTINUE                                                          LCSP-305
      RETURN                                                            LCSP-306
 1000 FORMAT ('<LEGENDRE>',F10.2,1P,D20.8,0P,F10.2,2I5)                 LCSP-307
 1001 FORMAT ('1 COEFFICIENTS OF LEGENDRE POLYNOMIALS DESCRIBING THE CROLCSP-308
     1SS-SECTIONS.')                                                    LCSP-309
 1002 FORMAT (2I5,' COUPLED LEVEL, NUMBER OF VALUES')                   LCSP-310
 1003 FORMAT (/' DIRECT INTERACTION FOR LEVEL',I2,' MULTIPLIED BY (1-COSLCSP-311
     1(THETA))**(',I2,' )',I4,' COEFFICIENTS'/4X,'L',8X,'C(L)',14X,'C(L+LCSP-312
     21)',13X,'C(L+2)',13X,'C(L+3)',13X,'C(L+4)')                       LCSP-313
 1004 FORMAT (/' DIRECT INTERACTION FOR LEVEL',I2,',',I4,' COEFFICIENTS'LCSP-314
     1/4X,'L',8X,'C(L)',14X,'C(L+1)',13X,'C(L+2)',13X,'C(L+3)',13X,'C(L+LCSP-315
     24)')                                                              LCSP-316
 1005 FORMAT (I5,1P,5D19.10)                                            LCSP-317
 1006 FORMAT (2I5,1P,D20.10,5X,'*(1-COS(THETA)**(',I2,' )')             LCSP-318
 1007 FORMAT (2I5,1P,D20.10)                                            LCSP-319
 1008 FORMAT (2I5,' UNCOUPLED LEVEL, NUMBER OF VALUES')                 LCSP-320
 1009 FORMAT (/' COMPOUND NUCLEUS FOR LEVEL',I2,',',I4,' COEFFICIENTS (OLCSP-321
     1NLY EVEN ONES ARE GIVEN)'/4X,'L',8X,'C(L)',14X,'C(L+2)',13X,'C(L+4LCSP-322
     2)',13X,'C(L+6)',13X,'C(L+8)')                                     LCSP-323
 1010 FORMAT (2I5,1P,D20.10,5X,'COMPOUND NUCLEUS')                      LCSP-324
 1011 FORMAT (I5,4X,'0 CLOSED CHANNEL')                                 LCSP-325
      END                                                               LCSP-326
C 23/03/07                                                      ECIS06  RESU-000
      SUBROUTINE RESU(IPI,SR,TX,SRX,JMAX,KMAX,NCOLL,NCOLS,MF,CQ,MFM,FM,IRESU-001
     1PJ,IPK,DONN,NCOLR,NCO,COE,WV,WVM,FCN,NOI,XD,JMIN,NRZ,NJC,RES,AM,EXRESU-002
     2,THE,DXX,SPG,NZZ,LO)                                              RESU-003
C COMPUTES CROSS-SECTIONS AND POLARISATIONS - COMPARE TO EXPERIMENTAL   RESU-004
C RESULTS -   OBTAINS EXPERIMENTAL NORMALISATIONS AND PARTIAL CHI2.     RESU-005
C INPUT:     IPI(J,I):PARITY OF THE NUCLEAR STATES (+/-) FOR J=1,       RESU-006
C                     MULTIPLICITY OF PARTICLE AND TARGET J=2,3,        RESU-007
C                     FIRST/LAST AMPL. AND OBSERVABLE FOR EACH          RESU-008
C                     LEVEL FOR J=6 TO 9. SEE CALX.                     RESU-009
C            SR:      HELICITY SCATTERING COEFFICIENTS.                 RESU-010
C            TX:      INELASTIC CROSS-SECTIONS IN MILLIBARNS            RESU-011
C                     FOLLOWED BY HAUSER-FESHBACH COEFFICIENTS.         RESU-012
C            SRX:     EQUIVALENT WITH SR BY CALL TO SAVE SR AND TX FOR  RESU-013
C                     MINIMUM CHI2 IN A SEARCH.                         RESU-014
C            JMAX:    MAXIMUM NUMBER OF CHANNEL SPINS.                  RESU-015
C            KMAX:    MAXIMUM NUMBER OF L FOR COMPOUND NUCLEUS.         RESU-016
C            NCOLL:   NUMBER OF COUPLED CHANNELS.                       RESU-017
C            NCOLS:   NUMBER OF CHANNELS WITH ANGULAR DISTRIBUTION.     RESU-018
C            MF,CQ:   TABLES OF HELICITY, DESCRIPTION OF OBSERVABLES    RESU-019
C                     ... ETC.  SEE DEPH AND OBSE.                      RESU-020
C            MFM,FM:  DESCRIPTION OF EXPERIMENTAL DATA.  SEE LECD.      RESU-021
C            IPJ:     NUMBER OF CHANNEL SPINS USED.                     RESU-022
C            IPK:     NUMBER OF L FOR COMPOUND NUCLEUS.                 RESU-023
C            DONN:    EXPERIMENTAL DATA:ANGLE, VALUE, EXPERIMENTAL      RESU-024
C                     ERROR ,ANGULAR WIDTH, ANGULAR ERROR AND           RESU-025
C                     CALCULATED ERROR.                                 RESU-026
C            NCOLR:   NUMBER OF EXPERIMENTAL ANGULAR DISTRIBUTIONS.     RESU-027
C            NCO,COE: INDICATIONS FOR OBSERVABLES.  SEE OBSE.           RESU-028
C            WV(I,J): WAVE NUMBER AND COULOMB PARAMETER.                RESU-029
C            WVM:     SAME AS WV FOR THE CONTINUUM.                     RESU-030
C            FCN:     COMPOUND NUCLEUS COEFFICIENTS.                    RESU-031
C            NOI:     STARTING AND FINAL ADDRESSES FOR CONTINUA.        RESU-032
C            XD:      ENERGY STEP FOR THE CONTINUA.                     RESU-033
C            JMIN:    TWICE MINIMUM CHANNEL SPIN.                       RESU-034
C            NRZ:     LENGTH OF SR+TX TO BE SAVED FOR MINIMUM CHI2.     RESU-035
C            NJC:     FIRST DIMENSION OF WORKING AREA EX.               RESU-036
C            NZZ:     TOTAL LENGTH OF WORKING FIELD,RETURNS SPACE USED. RESU-037
C            LO:      LOGICAL CONTROLS:                                 RESU-038
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 RESU-039
C               LO(31) =.TRUE. INPUT OF EXPERIMENTAL DATA AND CHI2      RESU-040
C                              CALCULATION.                             RESU-041
C               LO(32) =.TRUE. AUTOMATIC SEARCH ON SOME PARAMETERS.     RESU-042
C               LO(33) =.TRUE. SYMMETRISED CHI2 FOR CROSS-SECTIONS.     RESU-043
C               LO(59) =.TRUE. PRINT RESULTS ON FILES 58 AND 59.        RESU-044
C               LO(64) =.TRUE. PRINT RESULTS ON FILES 64 AND 66.        RESU-045
C               LO(66) =.TRUE. NO CALCULATION AT EQUIDISTANT ANGLES.    RESU-046
C               LO(67) =.TRUE. NO PLOT OF EXPERIMENTAL DATA.            RESU-047
C               LO(68) =.TRUE. NO PLOT OF EQUIDISTANT CROSS-SECTIONS.   RESU-048
C               LO(69) =.TRUE. NO PLOT OF EQUIDISTANT POLARISATIONS.    RESU-049
C               LO(74) =.TRUE. OUTPUT OF TIME IN DIFFERENT STEPS.       RESU-050
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             RESU-051
C               LO(84) =.TRUE. UNCOUPLED LEVELS FOR COMPOUND NUCLEUS.   RESU-052
C               LO(85) =.TRUE. FISSION TRANSMISSION COEFFICIENTS.       RESU-053
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      RESU-054
C               LO(91) =.TRUE. ANGLES IN THE LABORATORY SYSTEM.         RESU-055
C               LO(116)=.TRUE. NO OUTPUT.                               RESU-056
C               LO(118)=.TRUE. FOR LAST RESULTS.                        RESU-057
C               LO(126)=.TRUE. SOME OBSERVABLES IN LABORATORY SYSTEM.   RESU-058
C OUTPUT:    RES:     DIFFERENCE BETWEEN EXPERIMENTAL AND CALCULATED    RESU-059
C                     VALUE DIVIDED BY ERROR.                           RESU-060
C WORKING AREAS:                                                        RESU-061
C            AM:      FOR GENERAL PURPOSES.                             RESU-062
C            EX:      FOR OBSERVABLES.                                  RESU-063
C            THE:     ANGLES FOR PLOT.                                  RESU-064
C            DXX:     CROSS-SECTIONS FOR PLOTS.                         RESU-065
C            SPG:     POLARISATIONS FOR PLOTS                           RESU-066
C                                                                       RESU-067
C FOR THE COMMON  /ANGUL/ SEE LECT.                                     RESU-068
C FOR THE COMMONS /DCONS/ AND /TITRE/ SEE CALC.                         RESU-069
C FOR THE COMMONS /DCHI2/ AND /NCOMP/  SEE CALX.                        RESU-070
C FOR THE COMMON  /RESCT/ SEE SCAT.                                     RESU-071
C                                                                       RESU-072
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ANGUL/:                     RESU-073
C  THETA1:    FIRST ANGLE FOR COMPUTATION AT EQUIDISTANT ANGLES.        RESU-074
C  DTHETA:    STEP FOR COMPUTATION AT EQUIDISTANT ANGLES.               RESU-075
C  THETA2:    LAST ANGLE FOR COMPUTATION AT EQUIDISTANT ANGLES.         RESU-076
C  DTHE:      AVERAGING ANGLE.                                          RESU-077
C  NCJ:       NUMBER OF FACTORISATIONS OF 1/(1-COS(THETA)) IN AMPLITUDE.RESU-078
C  JMM(1):    NUMBER OF CHANNEL SPINS USED FOR MINIMUM CHI2.            RESU-079
C  JMM(2):    NUMBER OF L FOR COMPOUND NUCLEUS FOR MINIMUM CHI2.        RESU-080
C   DEFINED:  JMM.                                                      RESU-081
C   USED:     THETA1,DTHETA,THETA2,DTHE,NCJ,JMM.                        RESU-082
C                                                                       RESU-083
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCHI2/:                     RESU-084
C  CHI2:      CHI-SQUARE COMPUTED IN SUBROUTINE RESU.                   RESU-085
C  CHI2M:     MINIMUM CHI-SQUARE IN THE SEARCH.                         RESU-086
C   DEFINED:  CHI2,CHI2M.                                               RESU-087
C   USED:     CHI2,CHI2M.                                               RESU-088
C                                                                       RESU-089
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     RESU-090
C  CMB:       ATOMIC MASS CM DIVIDED BY H-BAR*C.                        RESU-091
C   USED:     CMB.                                                      RESU-092
C                                                                       RESU-093
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     RESU-094
C  NSP(1):    NUMBER OF UNCOUPLED LEVELS FOR COMPOUND NUCLEUS           RESU-095
C             INCLUDING DISCRETISATION OF CONTINUUM.                    RESU-096
C  NSP(3):    NUMBER OF THESE LEVELS WITHOUT ANGULAR DISTRIBUTION.      RESU-097
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 RESU-098
C  NIE:       NUMBER OF UNCOUPLED STATES ADDED FOR DISCRETISATION.      RESU-099
C  NCOLX:     TOTAL NUMBER OF LEVELS WITHOUT DISCRETISATION.            RESU-100
C  NDP:       ADDRESS OF FISSION AND GAMMA FINAL RESULTS.               RESU-101
C   DEFINED:  NDP.                                                      RESU-102
C   USED:     NSP,NCONT,NIE,NCOLX,NDP.                                  RESU-103
C                                                                       RESU-104
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /RESCT/:                     RESU-105
C  EXCN:      COMPOUND-NUCLEUS CROSS-SECTION.                           RESU-106
C  XA,XB:     CONSTANTS FOR CHANGE TO LABORATORY SYSTEM.                RESU-107
C  JN1,JN2:   FIRST AND LAST AMPLITUDE IN THE TABLE.                    RESU-108
C  NTT:       TOTAL NUMBER OF AMPLITUDES FOR THIS STATE AND A GIVEN J.  RESU-109
C  MTT:       SIZE OF THE SCATTERING MATRIX FOR THIS STATE AND ANGLE.   RESU-110
C  MT1:       MULTIPLICITY OF THE OUTGOING PARTICLE.                    RESU-111
C  MT2:       MULTIPLICITY OF THE RESIDUAL TARGET.                      RESU-112
C  MT3:       MULTIPLICITY OF THE INCIDENT PARTICLE.                    RESU-113
C  MT4:       MULTIPLICITY OF THE INITIAL TARGET.                       RESU-114
C  NOUT:      NUCLEAR STATE CONSIDERED.                                 RESU-115
C  NIX,NFX:   FIRST AND LAST OBSERVABLE IN THE TABLE.                   RESU-116
C  KLT:       1 FOR EXPERIMENTAL DATA.                                  RESU-117
C             2 FOR EQUIDISTANT ANGLES.                                 RESU-118
C             3 FOR PURE COMPOUND NUCLEUS.                              RESU-119
C  LKT:       LOGICAL=.TRUE. FOR CENTRE OF MASS SYSTEM.                 RESU-120
C   DEFINED:  XA,XB,JN1,JN2,NTT,MTT,MT1,MT2;MT3,MT4,NOUT,NIX,NFX,KLT,   RESU-121
C             LKT.                                                      RESU-122
C   USED:     EXCN,XA,XB,JN1,JN2,NTT,MTT,MT1,MT2;MT3,MT4,NOUT,NIX,NFX,  RESU-123
C             KLT,LKT.                                                  RESU-124
C                                                                       RESU-125
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /TITRE/:                     RESU-126
C  TITLE(18): TITLE OF THE RUN PRINTED AS HEADING OF RESULTS.           RESU-127
C   USED:     TITLE.                                                    RESU-128
C                                                                       RESU-129
C INTERNAL LOGICAL LT(3):                                               RESU-130
C            XD:      ENERGY STEP FOR THE CONTINUA.                     RESU-131
C            LT(1)=.TRUE. FOR CROSS-SECTION IN MILLIBARNS.              RESU-132
C            LT(2)=.TRUE. FOR SYMMETRISED CHI2, CROSS-SECTION AND       RESU-133
C                         NORMALISATION ERROR.                          RESU-134
C            LT(3)=.TRUE. FOR GRAPH OF POLARISATION.                    RESU-135
C            LKT  =.FALSE. FOR ANGLE IN THE LABORATORY SYSTEM.          RESU-136
C***********************************************************************RESU-137
      IMPLICIT REAL*8 (A-H,O-Z)                                         RESU-138
      LOGICAL LO(150),LT(3),LKT                                         RESU-139
      DIMENSION IPI(11,*),SR(2,JMAX,*),TX(*),SRX(*),MF(10,*),MFM(14,*),FRESU-140
     1M(7,*),DONN(6,*),NCO(*),COE(*),WV(22,*),WVM(22,*),FCN(KMAX,*),NOI(RESU-141
     22,*),XD(3,*),RES(*),AM(*),EX(NJC,4),THE(*),DXX(*),SPG(*),ZX(3),ZY(RESU-142
     33),SP(6)                                                          RESU-143
      CHARACTER*1 SIGM(2)                                               RESU-144
      CHARACTER*4 LG(10),TITLE,CQ(10,1)                                 RESU-145
      COMMON /ANGUL/ THETA1,THETA2,DTHETA,DTHE,NCJ,NL(3),JMM(2)         RESU-146
      COMMON /DCHI2/ CHI2,CHI2M,YY(3)                                   RESU-147
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            RESU-148
      COMMON /INOUT/ MR,MW,MS                                           RESU-149
      COMMON /NCOMP/ NSP(3),NRD(2),NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQ,ACRESU-150
     1N(20)                                                             RESU-151
      COMMON /RESCT/ EXCN,XA,XB,JN1,JN2,NTT,MTT,MT1,MT2,MT3,MT4,NOUT,NIXRESU-152
     1,NFX,KLT,LKT                                                      RESU-153
      COMMON /TITRE/ TITLE(18)                                          RESU-154
      DATA SIGM,LG,I3,I4,I5,I7,LT /'+','-',' COM','POUN','D NU','CLEU','RESU-155
     1S ',2*'    ','   D','IREC','T ',4*0,3*.FALSE./                    RESU-156
      NESP=0                                                            RESU-157
      MT3=IPI(2,1)                                                      RESU-158
      MT4=IPI(3,1)                                                      RESU-159
      IF (.NOT.LO(118)) GO TO 2                                         RESU-160
C COPY THE SCATTERING COEFFICIENTS OBTAINED FOR MINIMUM CHI2.           RESU-161
      IPJ=JMM(1)                                                        RESU-162
      IPK=JMM(2)                                                        RESU-163
      DO 1 I=1,NRZ                                                      RESU-164
    1 SRX(I)=SRX(I+NRZ)                                                 RESU-165
    2 IF (.NOT.LO(31)) GO TO 29                                         RESU-166
C CALCULATION AT EXPERIMENTAL ANGLES.                                   RESU-167
      KLT=1                                                             RESU-168
      CHI2=0.D0                                                         RESU-169
      NOUT=0                                                            RESU-170
      IF (LO(64)) WRITE (64,1000) WV(1,1),WV(13,1),WV(2,1),IPI(4,1),NCOLRESU-171
     1R                                                                 RESU-172
      KI=IPI(9,NCOLL)                                                   RESU-173
      JI=1                                                              RESU-174
      KA=0                                                              RESU-175
C PSEUDO LOOP ON THE ANGULAR DISTRIBUTIONS.                             RESU-176
    3 AA=0.D0                                                           RESU-177
      BB=0.D0                                                           RESU-178
      CC=0.D0                                                           RESU-179
      NIX=KI+JI                                                         RESU-180
      NFX=NIX                                                           RESU-181
      LT(1)=MF(2,NIX).EQ.0                                              RESU-182
      LT(2)=LO(33).AND.((IABS(MF(2,NIX)).LE.1.OR.MF(2,NIX).EQ.19).AND.FMRESU-183
     1(5,JI).EQ.0.D0)                                                   RESU-184
      JIM=JI                                                            RESU-185
      JIN=JI                                                            RESU-186
    4 J1=MFM(2,JI)                                                      RESU-187
      J2=MFM(3,JI)                                                      RESU-188
      LKT=MFM(4,JI).NE.1                                                RESU-189
      IF (J2.GE.J1) GO TO 5                                             RESU-190
      JI=JI+1                                                           RESU-191
      GO TO 4                                                           RESU-192
    5 JIF=JI                                                            RESU-193
      J=J1                                                              RESU-194
C PSEUDO LOOP ON THE EXPERIMENTAL DATA.                                 RESU-195
    6 DONN(6,J)=DONN(3,J)                                               RESU-196
      KC=1                                                              RESU-197
      THETA=DONN(1,J)                                                   RESU-198
    7 JI=JIM                                                            RESU-199
      ZX(KC)=0.D0                                                       RESU-200
      ZY(KC)=0.D0                                                       RESU-201
      IF (MF(2,KI+JI).NE.19) GO TO 63                                   RESU-202
C DATA ARE TOTAL CROSS SECTIONS.                                        RESU-203
      I=IDINT(DONN(1,J)*1.000001D0)                                     RESU-204
      IF (I.GT.NCOLX-NCONT) GO TO 8                                     RESU-205
      IF (I.EQ.-1) ZX(1)=TX(1)                                          RESU-206
      IF (I.EQ.0) ZX(1)=TX(1)-TX(2)                                     RESU-207
      IF (I.EQ.0.AND.NCOLL.NE.NCOLX) ZX(1)=ZX(1)-TX(NCOLL+2)            RESU-208
      IF (I.LE.0) GO TO 18                                              RESU-209
      K=MAX0(I,1)+1+NCOLL                                               RESU-210
      ZX(1)=0.D0                                                        RESU-211
      IF (NCOLL.NE.NCOLX) ZX(1)=TX(NCOLL+I+1)                           RESU-212
      IF (I.LE.NCOLL) ZX(1)=ZX(1)+TX(I+1)                               RESU-213
      GO TO 18                                                          RESU-214
    8 IF (I.GT.NCOLX) GO TO 10                                          RESU-215
      IK=NCOLL+NCOLX-NCONT+1                                            RESU-216
      II=I+NCONT-NCOLX                                                  RESU-217
      IJ=NOI(1,II)                                                      RESU-218
      JI=NOI(2,II)                                                      RESU-219
      ZX(1)=0.D0                                                        RESU-220
      IF (IJ.GT.JI) GO TO 18                                            RESU-221
      DO 9 II=IJ,JI                                                     RESU-222
    9 ZX(1)=ZX(1)+TX(IK+II)                                             RESU-223
      GO TO 18                                                          RESU-224
   10 ZX(1)=TX(NDP+I-NCOLX)                                             RESU-225
      GO TO 18                                                          RESU-226
   11 IF (LT(1)) EX(2,KC)=1.D0                                          RESU-227
      ZX(KC)=(ZX(KC)*ZY(KC)+EX(2,KC)*EX(1,KC))/(ZY(KC)+EX(1,KC))        RESU-228
      ZY(KC)=ZY(KC)+EX(1,KC)                                            RESU-229
      IF (JI.EQ.JIF) GO TO 12                                           RESU-230
      JI=JI+1                                                           RESU-231
      GO TO 63                                                          RESU-232
   12 IF (LT(1)) ZX(KC)=ZX(KC)*ZY(KC)                                   RESU-233
      GO TO ( 13 , 14 , 15 ),KC                                         RESU-234
   13 IF (DONN(4,J).EQ.0.D0) GO TO 18                                   RESU-235
      KC=2                                                              RESU-236
      THETA=DONN(1,J)-DONN(4,J)                                         RESU-237
      GO TO 7                                                           RESU-238
   14 KC=3                                                              RESU-239
      THETA=DONN(1,J)+DONN(4,J)                                         RESU-240
      GO TO 7                                                           RESU-241
   15 IF (LT(1)) GO TO 16                                               RESU-242
      ZX(1)=(ZX(1)*ZY(1)+ZX(2)*ZY(2)+ZX(3)*ZY(3))/(ZY(1)+ZY(2)+ZY(3))   RESU-243
      GO TO 17                                                          RESU-244
   16 ZX(1)=(ZX(1)+ZX(2)+ZX(3))/3.D0                                    RESU-245
   17 IF (DONN(5,J).NE.0.D0) DONN(6,J)=DSQRT(DONN(3,J)*DONN(3,J)+((ZX(2)RESU-246
     1-ZX(3))*DONN(2,J)*DONN(5,J)/(2.D0*DONN(4,J)*ZX(1)))**2)           RESU-247
   18 RES(J)=ZX(1)                                                      RESU-248
      IF (LT(2)) DONN(6,J)=DONN(6,J)*DSQRT(FM(4,JI)*RES(J)/DONN(2,J))   RESU-249
      XC=DONN(6,J)**2/FM(3,JI)                                          RESU-250
      AA=AA+RES(J)**2/XC                                                RESU-251
      BB=BB+RES(J)*DONN(2,J)/XC                                         RESU-252
      CC=CC+DONN(2,J)**2/XC                                             RESU-253
      J=J+1                                                             RESU-254
C END OF THE PSEUDO LOOP ON EXPERIMENTAL DATA.                          RESU-255
      IF (J.LE.J2) GO TO 6                                              RESU-256
C COMPUTATION OF NORMALISATION AND CHI2.                                RESU-257
      IF (FM(5,JI).EQ.0.D0) GO TO 21                                    RESU-258
      XA=FM(3,JI)/FM(5,JI)**2                                           RESU-259
      AA=AA+XA                                                          RESU-260
      XB=FM(4,JI)                                                       RESU-261
      BB=BB+XA*XB                                                       RESU-262
      CC=CC+XA*XB*XB                                                    RESU-263
      IF (JI.EQ.NCOLR) GO TO 19                                         RESU-264
      IF (FM(4,JI).NE.FM(4,JI+1).OR.FM(5,JI).NE.FM(5,JI+1)) GO TO 19    RESU-265
      IF ((2*IABS(MF(2,NIX))-3)*(2*IABS(MF(2,NIX+1))-3).LT.0) GO TO 19  RESU-266
      JI=JI+1                                                           RESU-267
      JIM=JI                                                            RESU-268
      GO TO 4                                                           RESU-269
   19 IF (LT(2)) GO TO 20                                               RESU-270
      FM(6,JI)=BB/AA                                                    RESU-271
      GO TO 22                                                          RESU-272
   20 FM(6,JI)=DSQRT(CC/AA)                                             RESU-273
      GO TO 22                                                          RESU-274
   21 FM(6,JI)=FM(4,JI)                                                 RESU-275
   22 DO 27 JJ=JIN,JI                                                   RESU-276
      NIX=KI+JJ                                                         RESU-277
      J1=MFM(2,JJ)                                                      RESU-278
      J2=MFM(3,JJ)                                                      RESU-279
      J3=J2-J1+1                                                        RESU-280
      IF (LO(64)) WRITE (64,1001) (MF(J,NIX),J=1,2),J3,(CQ(J,NIX),J=6,10RESU-281
     1)                                                                 RESU-282
      IF (J3.LE.0) GO TO 27                                             RESU-283
      IF (JJ.NE.JI) FM(6,JJ)=FM(6,JI)                                   RESU-284
      IF (LO(116)) GO TO 23                                             RESU-285
C OUTPUT OF THE CALCULATED AND THE EXPERIMENTAL VALUES.                 RESU-286
      M=0                                                               RESU-287
      WRITE (MW,1002) TITLE                                             RESU-288
      IF (MF(2,NIX).NE.19) WRITE (MW,1003) MFM(1,JJ)                    RESU-289
      WRITE (MW,1004) (CQ(J,NIX),J=6,10)                                RESU-290
   23 A1=FM(6,JJ)                                                       RESU-291
      A6=DSQRT(FM(3,JJ))                                                RESU-292
      AA=0.D0                                                           RESU-293
      IF (FM(5,JJ).EQ.0.D0) GO TO 24                                    RESU-294
      A2=(A1-FM(4,JJ))/FM(5,JJ)                                         RESU-295
      AA=A2**2                                                          RESU-296
      RES(J2+1)=A2*A6                                                   RESU-297
      CHI2=CHI2+RES(J2+1)**2                                            RESU-298
   24 DO 26 J=J1,J2                                                     RESU-299
      A2=DONN(2,J)/A1                                                   RESU-300
      A3=DONN(6,J)/A1                                                   RESU-301
      A4=((RES(J)-A2)/A3)**2                                            RESU-302
      IF (LO(116)) GO TO 25                                             RESU-303
      M=M+1                                                             RESU-304
      A5=DONN(3,J)/A1                                                   RESU-305
      THE(M)=DONN(1,J)                                                  RESU-306
      DXX(M)=A2                                                         RESU-307
      SPG(M)=RES(J)                                                     RESU-308
      WRITE (MW,1005) DONN(1,J),RES(J),A2,A5,A3,A4                      RESU-309
      IF (LO(64)) WRITE (64,1005) DONN(1,J),RES(J),A2,A5,A3,A4          RESU-310
   25 AA=AA+A4                                                          RESU-311
      RES(J)=(RES(J)-A2)*A6/A3                                          RESU-312
   26 CHI2=CHI2+RES(J)**2                                               RESU-313
      FM(7,JJ)=AA                                                       RESU-314
      IF (LO(116)) GO TO 27                                             RESU-315
      WRITE (MW,1006) (FM(J,JJ),J=3,7)                                  RESU-316
      IF (MF(1,NIX).EQ.19) GO TO 27                                     RESU-317
      IF (LO(74)) CALL HORA                                             RESU-318
      IF (LO(67)) GO TO 27                                              RESU-319
      LT(3)=.NOT.(LT(1).OR.MF(2,NIX).EQ.1.OR.MF(2,NIX).EQ.19)           RESU-320
      CALL GRAL(THE,SPG,DXX,M,MF(1,NIX),CQ(1,NIX),1,LT(3),.FALSE.)      RESU-321
   27 CONTINUE                                                          RESU-322
      JI=JI+1                                                           RESU-323
C END OF THE PSEUDO LOOP ON ANGULAR DISTRIBUTIONS.                      RESU-324
      IF (JI.LE.NCOLR) GO TO 3                                          RESU-325
      IF (.NOT.LO(116)) WRITE (MW,1007) CHI2                            RESU-326
      IF (.NOT.((CHI2.LE.CHI2M).AND.LO(32))) GO TO 29                   RESU-327
      JMM(1)=IPJ                                                        RESU-328
      JMM(2)=IPK                                                        RESU-329
      CHI2M=CHI2                                                        RESU-330
C IF THE CHI2 DECREASED, SAVE THE SCATTERING COEFFICIENTS.              RESU-331
      DO 28 I=1,NRZ                                                     RESU-332
   28 SRX(I+NRZ)=SRX(I)                                                 RESU-333
   29 IF (LO(116)) GO TO 62                                             RESU-334
      LKT=.NOT.LO(91)                                                   RESU-335
      IF (LO(66).AND.(.NOT.(LO(81).OR.LO(59)))) GO TO 62                RESU-336
C COMPUTATION AT EQUIDISTANT ANGLES.                                    RESU-337
      WRITE (MW,1002) TITLE                                             RESU-338
      JG=IDINT((THETA2-THETA1)/DTHETA+1.5D0)                            RESU-339
      IF (LO(64)) WRITE (66,1008) WV(1,1),WV(13,1),WV(2,1),IPI(4,1),NCOLRESU-340
     1S                                                                 RESU-341
      IF (.NOT.LO(59)) GO TO 30                                         RESU-342
      ND=1                                                              RESU-343
      IF (WV(5,1).EQ.0.D0) ND=3                                         RESU-344
      IF (LO(81)) ND=ND+1                                               RESU-345
      WRITE (58,1009) WV(1,1),WV(13,1),WV(2,1),IPI(4,1),ND              RESU-346

      WRITE (55,'(1x,F10.3,$)') Wv(13,1)

      IF (NCOLS.NE.1) WRITE (59,1010) WV(1,1),WV(13,1),WV(2,1),IPI(4,1),RESU-347
     1NCOLS-1                                                           RESU-348
   30 IF (WV(5,1).NE.0.D0) GO TO 31                                     RESU-349

      IF (Lo(59)) WRITE (55,'(3x,F10.2,$)') Tx(1)

      WRITE (MW,1011) TX(1)                                             RESU-350
      IF (LO(59)) WRITE (58,1012) TX(1)                                 RESU-351
   31 RX=TX(1)-TX(2)                                                    RESU-352
      IF (LO(59)) WRITE (58,1012) RX                                    RESU-353
 
      IF (Lo(59)) THEN
         IF (Wv(5,1).NE.0.D0) THEN
            WRITE (55,'(1x,F10.2)') rx
         ELSE
            WRITE (55,'(1x,F10.2,$)') rx
         ENDIF
      ENDIF

      IF (LO(81)) GO TO 32                                              RESU-354
      WRITE (MW,1013) RX                                                RESU-355
      GO TO 42                                                          RESU-356
C COMPOUND NUCLEUS RESULTS.                                             RESU-357
   32 WRITE (MW,1014) RX                                                RESU-358
      NDP=2*NCOLL+NSP(1)+1                                              RESU-359
      RX=RX-TX(NCOLL+2)                                                 RESU-360
      WRITE (MW,1015) RX                                                RESU-361

      IF (LO(59)) WRITE (55,'(1x,F10.2,$)') RX                          RCN



      IF (LO(85)) WRITE (MW,1016) TX(NDP+1)                             RESU-362
      IF (LO(86)) WRITE (MW,1017) TX(NDP+2)                             RESU-363
      RX=TX(NDP+1)+TX(NDP+2)                                            RESU-364
      WRITE (MW,1018)                                                   RESU-365
      RY=0.D0                                                           RESU-366
      DO 33 I=1,NCOLL                                                   RESU-367
      II=IPI(1,I)+1                                                     RESU-368
      SP2=0.5D0*DFLOAT(IPI(3,I)-1)                                      RESU-369
      RY=RY+TX(NCOLL+I+1)                                               RESU-370
   33 WRITE (MW,1019) I,SP2,SIGM(II),WV(3,I),TX(NCOLL+I+1)              RESU-371
      WRITE (MW,1020) RY                                                RESU-372
      RX=RX+RY                                                          RESU-373
      IF (.NOT.LO(84)) GO TO 41                                         RESU-374
      IF (NCOLL.EQ.NCOLS) GO TO 35                                      RESU-375
      WRITE (MW,1021)                                                   RESU-376
      RY=0.D0                                                           RESU-377
      N1=NCOLL+1                                                        RESU-378
      DO 34 I=N1,NCOLS                                                  RESU-379
      II=IPI(1,I)+1                                                     RESU-380
      SP2=0.5D0*DFLOAT(IPI(3,I)-1)                                      RESU-381
      RY=RY+TX(NCOLL+I+1)                                               RESU-382
   34 WRITE (MW,1019) I,SP2,SIGM(II),WV(3,I),TX(NCOLL+I+1)              RESU-383
      WRITE (MW,1020) RY                                                RESU-384
      RX=RX+RY                                                          RESU-385
   35 NSP1=NSP(3)                                                       RESU-386
      IF (NCONT.NE.0) NSP1=NSP1-NIE                                     RESU-387
      IF (NSP1.LT.1) GO TO 37                                           RESU-388
      WRITE (MW,1022)                                                   RESU-389
      RY=0.D0                                                           RESU-390
      DO 36 I=1,NSP1                                                    RESU-391
      J=I+NCOLS                                                         RESU-392
      II=IPI(1,J)+1                                                     RESU-393
      SP2=0.5D0*DFLOAT(IPI(3,J)-1)                                      RESU-394
      RY=RY+TX(NCOLL+J+1)                                               RESU-395
   36 WRITE (MW,1019) J,SP2,SIGM(II),WV(3,J),TX(NCOLL+J+1)              RESU-396
      WRITE (MW,1020) RY                                                RESU-397
      RX=RX+RY                                                          RESU-398
   37 IF (NCONT.EQ.0) GO TO 41                                          RESU-399
      IK=NCOLL+NCOLX-NCONT+1                                            RESU-400
      DO 40 I=1,NCONT                                                   RESU-401
      IJ=NOI(1,I)                                                       RESU-402
      JI=NOI(2,I)                                                       RESU-403
      RY=0.D0                                                           RESU-404
      IF (IJ.GT.JI) GO TO 40                                            RESU-405
      DO 38 II=IJ,JI                                                    RESU-406
   38 RY=RY+TX(IK+II)                                                   RESU-407
      WRITE (MW,1023) I,RY                                              RESU-408
      RX=RX+RY                                                          RESU-409
      DO 39 II=IJ,JI                                                    RESU-410
      RY=TX(IK+II)/XD(2,II)                                             RESU-411
   39 WRITE (MW,1024) II,WVM(3,II),XD(2,II),TX(IK+II),RY                RESU-412
   40 CONTINUE                                                          RESU-413
   41 WRITE (MW,1025) RX                                                RESU-414
      WRITE (MW,1002) TITLE                                             RESU-415
      IF (LO(59)) WRITE (58,1012) RX                                    RESU-416
   42 INIV=1                                                            RESU-417
      SP2=0.5D0*DFLOAT(IPI(3,INIV)-1)                                   RESU-418
      WRITE (MW,1026) SP2,SIGM(IPI(1,INIV)+1)                           RESU-419
      NOUT=0                                                            RESU-420
      KLT=2                                                             RESU-421
C PSEUDO DO LOOP ON LEVELS.                                             RESU-422
   43 IF (WV(3,INIV).GT.0.D0) GO TO 44                                  RESU-423
      WRITE (MW,1027) INIV                                              RESU-424
C     IF (LO(64)) WRITE (66,1028) INIV,SP2,SIGM(IPI(1,INIV)+1)          RESU-425
      IF (LO(59)) WRITE (59,1029) INIV-1                                RESU-426
      GO TO 57                                                          RESU-427
   44 RX=TX(INIV+1)                                                     RESU-428
      IF (LO(81)) RX=RX+TX(NCOLL+INIV+1)                                RESU-429
      IF (INIV.EQ.1) GO TO 45                                           RESU-430
      WRITE (MW,1002) TITLE                                             RESU-431
      WRITE (MW,1030) INIV,SP2,SIGM(IPI(1,INIV)+1)                      RESU-432
      WRITE (MW,1031) RX                                                RESU-433
      GO TO 46                                                          RESU-434
   45 IF (WV(5,1).NE.0.D0) GO TO 47                                     RESU-435
      WRITE (MW,1032) RX                                                RESU-436
   46 IF (LO(81)) WRITE (MW,1033) TX(INIV+1)                            RESU-437
      IF (.NOT.LO(59)) GO TO 47                                         RESU-438
      IF (INIV.EQ.1) WRITE (58,1012) RX                                 RESU-439



      IF (INIV.EQ.1) WRITE (55,'(1x,F10.2)') RX                         RCN



      IF (INIV.NE.1) WRITE (59,1034) RX,INIV-1                          RESU-440
   47 IF (LO(81)) WRITE (MW,1035) TX(NCOLL+INIV+1)                      RESU-441
      IF (LO(66)) GO TO 62                                              RESU-442
      IF (JG.LE.0) GO TO 57                                             RESU-443
      THETB=THETA1                                                      RESU-444
      IJ=0                                                              RESU-445
      II=1                                                              RESU-446
C PSEUDO DO LOOP ON ANGLES.                                             RESU-447
   48 THE(II)=THETB                                                     RESU-448
      THETA=THETB                                                       RESU-449
      KC=1                                                              RESU-450
      GO TO 64                                                          RESU-451
   49 DXX(II)=EX(I5,1)                                                  RESU-452
      IF (LO(81)) GO TO 50                                              RESU-453
      I1=MIN0(I3,7)                                                     RESU-454
      WRITE (MW,1036) THETB,(EX(K,1),K=2,I1)                            RESU-455
      GO TO 51                                                          RESU-456
   50 I1=MIN0(I3,5)                                                     RESU-457
      IF (I1.LT.3) GO TO 52                                             RESU-458
      WRITE (MW,1036) THETB,EX(2,1),EX(I3+1,1),EX(I4,1),(EX(K,1),K=3,I1)RESU-459
   51 IF (I1.GE.I3) GO TO 53                                            RESU-460
      I2=I1+1                                                           RESU-461
      I1=MIN0(I1+5,I3)                                                  RESU-462
      WRITE (MW,1037) (EX(K,1),K=I2,I1)                                 RESU-463
      GO TO 51                                                          RESU-464
   52 WRITE (MW,1036) THETB,EX(2,1),EX(I3+1,1),EX(I4,1)                 RESU-465
   53 IF (.NOT.LO(64)) GO TO 54                                         RESU-466



C     WRITE (66,1038) (MF(2,NIX+K-2),THETA,EX(K,1),(CQ(L,NIX+K-2),L=6,10RESU-467


C    1),K=2,I3)                                                         RESU-468


C     Printing only cross sections (MF(2,NIX+K-2)=0)                  


      WRITE (66,10381)(THETA,EX(K,1),(CQ(L,NIX+K-2),L=6,10),K=2,2)        RCN


C     IF (LO(81)) WRITE (66,1039) THETA,EX(I3+1,1),(LG(K),K=1,5),THETA,ERESU-469


C    1X(I4,1),(LG(K),K=6,10)                                            RESU-470





      IF (LO(81)) WRITE (66,10391)THETA,EX(I3+1,1),(LG(K),K=1,5),THETA,E  RCN


     1X(I4,1),(LG(K),K=6,10)                                              RCN





   54 IF (I7.LE.0) GO TO 56                                             RESU-471
      DO 55 K=1,I7                                                      RESU-472
      IJ=IJ+1                                                           RESU-473
   55 SPG(IJ)=EX(K+I5,1)                                                RESU-474
   56 THETB=THETB+DTHETA                                                RESU-475
      II=II+1                                                           RESU-476
C END OF THE PSEUDO DO LOOP ON ANGLES.                                  RESU-477
      IF (II.LE.JG) GO TO 48                                            RESU-478
      IF (.NOT.LO(68)) CALL GRAL(THE,DXX,DXX,JG,MF(1,NFX-I7),CQ(1,NFX-I7RESU-479
     1),1,.FALSE.,.TRUE.)                                               RESU-480
      IF (.NOT.LO(69).AND.I7.GT.0) CALL GRAL(THE,SPG,DXX,JG,MF(1,NIX+I5-RESU-481
     11),CQ(1,NIX+I5-1),I7,.TRUE.,.TRUE.)                               RESU-482
      IF (LO(74)) CALL HORA                                             RESU-483
   57 INIV=INIV+1                                                       RESU-484
      SP2=0.5D0*DFLOAT(IPI(3,INIV)-1)                                   RESU-485
C END OF THE PSEUDO DO LOOP ON LEVELS.                                  RESU-486
      IF (INIV.LE.NCOLL) GO TO 43                                       RESU-487
      IF (.NOT.LO(81)) GO TO 62                                         RESU-488
      JN2=NCOLL                                                         RESU-489
      KLT=3                                                             RESU-490
   58 JN1=JN2+1                                                         RESU-491
      JN2=MIN0(JN1+5,NCOLS)                                             RESU-492
      IS=JN1-1                                                          RESU-493
      IF (JN1.GT.JN2) GO TO 62                                          RESU-494
      DO 59 I=JN1,JN2                                                   RESU-495
   59 SP(I-IS)=0.5D0*DFLOAT(IPI(3,I)-1)                                 RESU-496
      WRITE (MW,1002) TITLE                                             RESU-497
      WRITE (MW,1040) JN1,JN2,(I,SP(I-IS),SIGM(IPI(1,I)+1),I=JN1,JN2)   RESU-498
      THETB=THETA1                                                      RESU-499
      GO TO 61                                                          RESU-500
   60 WRITE (MW,1041) THETB,(EX(I-IS,1),I=JN1,JN2)                      RESU-501
      THETB=THETB+DTHETA                                                RESU-502
   61 THETA=THETB                                                       RESU-503
      KC=1                                                              RESU-504
      IF (THETB.LE.THETA2) GO TO 71                                     RESU-505
      GO TO 58                                                          RESU-506
   62 NZZ=2*NESP                                                        RESU-507
      RETURN                                                            RESU-508
C FOR EXPERIMENTAL DATA.                                                RESU-509
   63 IF (JI.EQ.KA) GO TO 71                                            RESU-510
      INIV=MFM(1,JI)                                                    RESU-511
      KA=JI                                                             RESU-512
      GO TO 65                                                          RESU-513
C FOR EQUIDISTANT ANGLES.                                               RESU-514
   64 IF (INIV.EQ.NOUT) GO TO 71                                        RESU-515
   65 NOUT=INIV                                                         RESU-516
C CHANGE OF LEVEL.                                                      RESU-517
      JN1=IPI(6,NOUT)                                                   RESU-518
      JN2=IPI(7,NOUT)                                                   RESU-519
      MT1=IPI(2,NOUT)                                                   RESU-520
      MT2=IPI(3,NOUT)                                                   RESU-521
      NTT=JN2+1-JN1                                                     RESU-522
      MTT=MT1*MT2*MT3*MT4                                               RESU-523
      M2=1+2*MTT                                                        RESU-524
      M3=M2+2*NTT                                                       RESU-525
      M4=M3+IPJ+NCJ                                                     RESU-526
      IF (LO(126)) M4=MAX0(M4,6*MTT)                                    RESU-527
      NESP=MAX0(NESP,M4)                                                RESU-528
      IF (2*M4.GT.NZZ) CALL MEMO('RESU',NZZ,2*M4)                       RESU-529
      IF (LKT) GO TO 67                                                 RESU-530
      IF (LO(8)) GO TO 66                                               RESU-531
      XA=1.D0                                                           RESU-532
      XB=WV(4,1)*WV(1,NOUT)/(WV(4,NOUT)*WV(2,1))                        RESU-533
      GO TO 67                                                          RESU-534
   66 XA=DSQRT(1.D0+(WV(4,1)/(CMB*WV(2,1)))**2)                         RESU-535
      XB=DSQRT(WV(1,NOUT)**2+(WV(4,NOUT)/CMB)**2)*WV(4,1)/(WV(4,NOUT)*WVRESU-536
     1(2,1))                                                            RESU-537
   67 IF (KLT.NE.2) GO TO 71                                            RESU-538
C FOR EQUIDISTANT ANGLES.                                               RESU-539
      NIX=IPI(8,INIV)                                                   RESU-540
      NFX=IPI(9,INIV)                                                   RESU-541
      I4=2+NFX-NIX                                                      RESU-542
      I3=I4                                                             RESU-543
      I5=2                                                              RESU-544
      I8=I4-1                                                           RESU-545
      IF (I4.GT.2.AND.MF(2,NIX+1).EQ.1) I5=3                            RESU-546
      I7=I4-I5                                                          RESU-547
      IF (LO(81)) GO TO 68                                              RESU-548
      NGX=MIN0(NFX,NIX+5)                                               RESU-549
      WRITE (MW,1042) ((CQ(L,K),L=6,10),K=NIX,NGX)                      RESU-550
      GO TO 70                                                          RESU-551
   68 I4=I4+2                                                           RESU-552
      I8=I8+2                                                           RESU-553
      NGX=MIN0(NFX,NIX+3)                                               RESU-554
      NJX=NIX+1                                                         RESU-555
      IF (NGX.GE.NJX) GO TO 69                                          RESU-556
      WRITE (MW,1042) (CQ(L,NIX),L=6,10),LG                             RESU-557
      GO TO 70                                                          RESU-558
   69 WRITE (MW,1042) (CQ(L,NIX),L=6,10),LG,((CQ(L,K),L=6,10),K=NJX,NGX)RESU-559
C  70 IF (LO(64)) WRITE (66,1043) INIV,SP2,SIGM(IPI(1,INIV)+1),I8,JG    RESU-560


C     Printing only cross sections (01 instead of I8)


   70 IF (LO(64)) WRITE (66,1043) INIV,SP2,SIGM(IPI(1,INIV)+1),01,JG    RCN 





      IF (NGX.EQ.NFX) GO TO 71                                          RESU-561
      NJX=NGX+1                                                         RESU-562
      NGX=MIN0(NFX,NJX+4)                                               RESU-563
      WRITE (MW,1044) ((CQ(L,K),L=6,10),K=NJX,NGX)                      RESU-564
      IF (NGX.LT.NFX) GO TO 70                                          RESU-565
   71 CALL SCAT(SR,MF,JMAX,KMAX,THETA,FCN,IPJ,IPK,NCO,COE,IPI,AM,AM(M2),RESU-566
     1AM(M3),EX(1,KC),WV,NCJ,JMIN,LO)                                   RESU-567
      GO TO ( 11 , 72 , 73 ) , KLT                                      RESU-568
   72 IF (.NOT.LO(81)) GO TO 73                                         RESU-569
      EX(I4-1,KC)=EXCN                                                  RESU-570
      EX(I4,KC)=EX(2,KC)-EXCN                                           RESU-571
   73 IF (DTHE.EQ.0.D0) GO TO ( 49 , 49 , 60 ) , KLT                    RESU-572
      GO TO ( 74 , 75 , 76 ),KC                                         RESU-573
   74 KC=2                                                              RESU-574
      THETA=THETB-DTHE                                                  RESU-575
      GO TO 71                                                          RESU-576
   75 KC=3                                                              RESU-577
      THETA=THETB+DTHE                                                  RESU-578
      GO TO 71                                                          RESU-579
   76 IF (KLT.EQ.3) GO TO 79                                            RESU-580
      AA=EX(1,1)+EX(1,2)+EX(1,3)                                        RESU-581
      DO 78 K=2,I4                                                      RESU-582
      IF ((K.GT.I5).AND.(K.LE.I3)) GO TO 77                             RESU-583
      EX(K,1)=(EX(K,1)+EX(K,2)+EX(K,3))/3.D0                            RESU-584
      GO TO 78                                                          RESU-585
   77 EX(K,1)=(EX(K,1)*EX(1,1)+EX(K,2)*EX(1,2)+EX(K,3)*EX(1,3))/AA      RESU-586
   78 CONTINUE                                                          RESU-587
      GO TO 49                                                          RESU-588
   79 DO 80 K=JN1,JN2                                                   RESU-589
   80 EX(K-IS,1)=(EX(K-IS,1)+EX(K-IS,2)+EX(K-IS,3))/3.D0                RESU-590
      GO TO 60                                                          RESU-591
 1000 FORMAT ('<EXP.DAT.>',F10.2,1P,D20.8,0P,F10.2,2I5)                 RESU-592
 1001 FORMAT (3I5,5A4)                                                  RESU-593
 1002 FORMAT ('1',5X,18A4//)                                            RESU-594
 1003 FORMAT (//30X,'**********   STATE',I5,'    **********'//)         RESU-595
 1004 FORMAT (//42X,5A4//10X,'ANGLE',10X,'CALC. VAL.',11X,'EXP. VAL.',10RESU-596
     1X,'EXP. ERROR',10X,'COR. ERROR',13X,'CHI2'/)                      RESU-597
 1005 FORMAT (6X,F10.3,5D20.5)                                          RESU-598
 1006 FORMAT (//' WEIGHT IN THE CHI2',8X,D15.5/' EXPERIMENTAL NORMALISATRESU-599
     1ION',D15.5/' NORMALISATION ERROR',7X,D15.5/' CALCULATED NORMALISATRESU-600
     2ION',2X,D15.5//' ***** CHI2 =',D15.6,'   *****'/)                 RESU-601
 1007 FORMAT (/' ************ CHI2 **********',D20.10//)                RESU-602
 1008 FORMAT ('<ANG.DIS.>',F10.2,1P,D20.8,0P,F10.2,2I5)                 RESU-603
 1009 FORMAT ('<CROSS-S.>',F10.2,1P,D20.8,0P,F10.2,2I5)                 RESU-604
 1010 FORMAT ('<INE.C.S.>',F10.2,1P,D20.8,0P,F10.2,2I5)                 RESU-605
 1011 FORMAT (6X,'==> TOTAL CROSS SECTION =',F14.6,' MILLIBARNS.')      RESU-606
 1012 FORMAT (1P,D12.5)                                                 RESU-607
 1013 FORMAT (' TOTAL REACTION CROSS SECTION =',F14.6,' MILLIBARNS.')   RESU-608
 1014 FORMAT (' TOTAL REACTION CROSS SECTION =',F14.6,' MILLIBARNS',11X,RESU-609
     1'( INCLUDING COMPOUND ELASTIC ).')                                RESU-610
 1015 FORMAT (' TOTAL DIRECT REACTION CROSS SECTION =',F14.6,' MILLIBARNRESU-611
     1S',4X,'( WITHOUT COMPOUND ELASTIC ).')                            RESU-612
 1016 FORMAT (8X,'FISSION CROSS SECTION =',F14.6,' MILLIBARNS.')        RESU-613
 1017 FORMAT (6X,'GAMMA RAY CROSS SECTION =',F14.6,' MILLIBARNS.')      RESU-614
 1018 FORMAT (/'  COMPOUND CROSS SECTION FOR SCATTERING TO COUPLED LEVELRESU-615
     1S.'/'  ======================================================='//'RESU-616
     2   LEVEL     SPIN       ENERGY       CROSS SECTION'/)             RESU-617
 1019 FORMAT (I5,F9.1,A1,'   AT',F10.5,' MEV',F14.5)                    RESU-618
 1020 FORMAT (/' SUM OF COMPOUND CONTRIBUTIONS',F14.6,' MILLIBARNS.')   RESU-619
 1021 FORMAT (/'  COMPOUND CROSS SECTION FOR SCATTERING TO UNCOUPLED LEVRESU-620
     1ELS WITH ANGULAR DISTRIBUTION.'/'  ===============================RESU-621
     2===================================================='//'   LEVEL  RESU-622
     3   SPIN       ENERGY       CROSS SECTION'/)                       RESU-623
 1022 FORMAT (/'  COMPOUND CROSS SECTION FOR SCATTERING TO LEVELS WITHOURESU-624
     1T ANGULAR DISTRIBUTION.'/'  ======================================RESU-625
     2======================================'//'   LEVEL     SPIN       RESU-626
     3ENERGY       CROSS SECTION'/)                                     RESU-627
 1023 FORMAT (/' CONTINUUM',I4/' TOTAL COMPOUND REACTION CROSS SECTION =RESU-628
     1',F14.6,' MILLIBARNS.'//8X,' ENERGY     STEP     CONTRIBUTION  VALRESU-629
     2UE (MILLIBARNS/MEV)'/)                                            RESU-630
 1024 FORMAT (2X,I3,2F10.5,2F15.5)                                      RESU-631
 1025 FORMAT (/' TOTAL SUM OF COMPOUND CONTRIBUTIONS',F14.6,' MILLIBARNSRESU-632
     1.')                                                               RESU-633
 1026 FORMAT (/' ELASTIC SCATTERING ON THE TARGET STATE OF SPIN =',F5.1,RESU-634
     1A1)                                                               RESU-635
 1027 FORMAT (//' CLOSED CHANNEL FOR THE TARGET STATE',I3)              RESU-636
 1028 FORMAT (I5,F5.1,A1,3X,'0',5X,'CLOSED CHANNEL.')                   RESU-637
 1029 FORMAT ('0.D0',8X,I3)                                             RESU-638
 1030 FORMAT (/' INELASTIC SCATTERING TO THE TARGET STATE',I3,'  SPIN ='RESU-639
     1,F5.1,A1)                                                         RESU-640
 1031 FORMAT (/6X,'INELASTIC CROSS SECTION =',F14.6,' MILLIBARNS.')     RESU-641
 1032 FORMAT (/'  TOTAL ELASTIC CROSS SECTION =',F14.6,' MILLIBARNS.')  RESU-642
 1033 FORMAT (9X,'DIRECT CROSS SECTION =',F14.6,' MILLIBARNS.')         RESU-643
 1034 FORMAT (1P,D12.5,I3)                                              RESU-644
 1035 FORMAT (7X,'COMPOUND CROSS SECTION =',F14.6,' MILLIBARNS.')       RESU-645
 1036 FORMAT (1X,F10.3,D16.5,2X,5F18.7)                                 RESU-646
 1037 FORMAT (29X,5F18.7)                                               RESU-647
 1038 FORMAT (I3,1P,2D12.5,5X,4A4,A2)                                   RESU-648
10381 FORMAT (3X,1P,2D12.5,5X,4A4,A2)                                   RCN


 1039 FORMAT (' -4',1P,2D12.5,5X,4A4,A2/' -5',2D12.5,5X,4A4,A2)         RESU-649


10391 FORMAT (3X,1P,2D12.5,5X,4A4,A2/3X,2D12.5,5X,4A4,A2)               RCN


 1040 FORMAT (/' ANGULAR DISTRIBUTION OF COMPOUND SCATTERING ON LEVELS',RESU-650
     1I3,' TO',I3//6X,'ANGLE',6(I6,'-LEVEL',F5.1,A1))                   RESU-651
 1041 FORMAT (1X,F10.3,6F18.7)                                          RESU-652
 1042 FORMAT (/6X,'ANGLE ',6(4A4,A2))                                   RESU-653
 1043 FORMAT (I5,F5.1,A1,I4,I5)                                         RESU-654
 1044 FORMAT (30X,5(4A4,A2))                                            RESU-655
      END                                                               RESU-656
C 07/03/07                                                      ECIS06  SCAT-000
      SUBROUTINE SCAT(FR,MF,JMAX,KMAX,THETA,FCN,IPJ,IPK,NCO,COE,IPI,AB,ASCAT-001
     1,B,EX,WV,NCJ,JMIN,LO)                                             SCAT-002
C COMPUTATION OF OBSERVABLES.                                           SCAT-003
C INPUT:     FR:      SCATTERING COEFFICIENTS IN THE HELICITY FORMALISM.SCAT-004
C            MF:      TABLES OF HELICITY,DESCRIPTION OF OBSERVABLES,    SCAT-005
C                     .... ETC.  SEE DEPH AND OBSE.                     SCAT-006
C            JMAX:    DIMENSION FOR FR.                                 SCAT-007
C            KMAX:    DIMENSION FOR FCN.                                SCAT-008
C            THETA:   SCATTERING ANGLE.                                 SCAT-009
C            FCN:     COMPOUND NUCLEUS COEFFICIENTS.                    SCAT-010
C            IPJ:     NUMBER OF J VALUES USED FOR SCATTERING.           SCAT-011
C            IPK:     NUMBER OF L VALUES USED FOR COMPOUND NUCLEUS.     SCAT-012
C            NCO,COE: LOOPS AND COEFFICIENTS FOR OBSERVABLES (SEE OBSE).SCAT-013
C            IPI:     MULTIPLICITIES FOR PARTICLE AND TARGET NUCLEUS.   SCAT-014
C            WV:      MASSES, ENERGIES, ETC..    SEE CALX.              SCAT-015
C            NCJ:     NUMBER OF FACTORISATIONS OF 1/(1-X*COS(THETA)).   SCAT-016
C            JMIN:    TWICE MINIMUM OF THE TOTAL SPIN.                  SCAT-017
C            LO:      LOGICAL CONTROLS:                                 SCAT-018
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 SCAT-019
C               LO(18) =.TRUE. PROJECTILE-TARGET ANTISYMMETRISATION.    SCAT-020
C               LO(41) =.TRUE. FACTORISATION OF 1/(1-COS(THETA)).       SCAT-021
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             SCAT-022
C OUTPUT:    EX:      DIFFERENTIAL CROSS-SECTION FOLLOWED BY OBSERVABLESSCAT-023
C WORKING AREAS:                                                        SCAT-024
C            AB:      AMPLITUDES IN THE C. M. OR THE LAB. SYSTEM.       SCAT-025
C            A:       FOR INDEPENDENT AMPLITUDES.                       SCAT-026
C            B:       TO STORE THE ROTATION MATRIX ELEMENTS.            SCAT-027
C                                                                       SCAT-028
C THE COMMON /RESCT/ IS USED IN RESU AND SCAT.                          SCAT-029
C                                                                       SCAT-030
C FOR THE COMMON  /DCONS/ SEE CALC.                                     SCAT-031
C                                                                       SCAT-032
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCONS/:                     SCAT-033
C  CMB:       ATOMIC MASS CM DIVIDED BY H-BAR*C.                        SCAT-034
C  XZ:        CONVERSION FACTOR TO MILLIBARNS.                          SCAT-035
C   USED:     CMB,XZ.                                                   SCAT-036
C                                                                       SCAT-037
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /RESCT/:                     SCAT-038
C  EXCN:      COMPOUND-NUCLEUS CROSS-SECTION.                           SCAT-039
C  XA,XB:     CONSTANTS FOR CHANGE TO LABORATORY SYSTEM.                SCAT-040
C  JN1,JN2:   FIRST AND LAST AMPLITUDE IN:THE TABLE.                    SCAT-041
C  JN2:       NUMBER OF INDEPENDENT AMPLITUDES.                         SCAT-042
C  NTT:       TOTAL NUMBER OF AMPLITUDES FOR THIS STATE AND A GIVEN J.  SCAT-043
C  MTT:       SIZE OF THE SCATTERING MATRIX FOR THIS STATE AND ANGLE.   SCAT-044
C  MT1:       MULTIPLICITY OF THE OUTGOING PARTICLE.                    SCAT-045
C  MT2:       MULTIPLICITY OF THE RESIDUAL TARGET.                      SCAT-046
C  MT3:       MULTIPLICITY OF THE INCIDENT PARTICLE.                    SCAT-047
C  MT4:       MULTIPLICITY OF THE INITIAL TARGET.                       SCAT-048
C  NOUT:      NUCLEAR STATE CONSIDERED.                                 SCAT-049
C  NIX,NFX:   FIRST AND LAST OBSERVABLE IN THE TABLE.                   SCAT-050
C  KLT:       1 FOR EXPERIMENTAL DATA.                                  SCAT-051
C             2 FOR EQUIDISTANT ANGLES.                                 SCAT-052
C             3 FOR PURE COMPOUND NUCLEUS.                              SCAT-053
C  LKT:       LOGICAL=.TRUE. FOR CENTRE OF MASS SYSTEM.                 SCAT-054
C                                                                       SCAT-055
C***********************************************************************SCAT-056
      IMPLICIT REAL*8 (A-H,O-Z)                                         SCAT-057
      LOGICAL LO(150),LTT(6),LXY,LKT                                    SCAT-058
      DIMENSION FR(2,JMAX,*),MF(10,*),FCN(KMAX,*),NCO(20,*),COE(*),IPI(1SCAT-059
     12,*),AB(2,*),A(2,*),B(*),EX(*),WV(22,*),MO(18)                    SCAT-060
      EQUIVALENCE (MO(1),MI1),(MO(2),MP1),(MO(3),N1),(MO(4),L1),(MO(5),MSCAT-061
     1I2),(MO(6),MP2),(MO(7),N2),(MO(8),L2),(MO(9),MI3),(MO(10),MP3),(MOSCAT-062
     2(11),N3),(MO(12),L3),(MO(13),MI4),(MO(14),MP4),(MO(15),N4),(MO(16)SCAT-063
     3,L4),(MO(17),JQ),(MO(18),JP)                                      SCAT-064
      COMMON /DCONS/ CM,CHB,CZ,CMB,CCZ,CK,XZ                            SCAT-065
      COMMON /RESCT/ EXCN,XA,XB,JN1,JN2,NTT,MTT,MT1,MT2,MT3,MT4,NOUT,NIXSCAT-066
     1,NFX,KLT,LKT                                                      SCAT-067
      THET=1.74532925D-02*THETA                                         SCAT-068
      IF (KLT.EQ.3) GO TO 56                                            SCAT-069
C FOR EXPERIMENTAL DATA OR EQUIDISTANT ANGLES.                          SCAT-070
      W6=DCOS(THET)                                                     SCAT-071
      W7=DSIN(THET)                                                     SCAT-072
      IF (LKT) GO TO 1                                                  SCAT-073
      XC=(XA**2-XB**2)*W7**2+W6**2                                      SCAT-074
      IF (XC.GT.0.D0) XC=DSQRT(XC)                                      SCAT-075
      A3=XC*W6-XA*XB*W7**2                                              SCAT-076
      W7=W7*(XB*W6+XC*XA)                                               SCAT-077
      W6=A3                                                             SCAT-078
    1 IF (.NOT.LO(81)) GO TO 3                                          SCAT-079
C COMPOUND NUCLEUS CONTRIBUTION.                                        SCAT-080
      EXCN=FCN(1,NOUT)                                                  SCAT-081
      IF (IPK.EQ.1) GO TO 3                                             SCAT-082
      U1=0.D0                                                           SCAT-083
      U2=1.D0                                                           SCAT-084
      DO 2 J=2,IPK                                                      SCAT-085
      U1=(DFLOAT(4*J-7)*U2*W6-DFLOAT(2*J-4)*U1)/DFLOAT(2*J-3)           SCAT-086
      U2=(DFLOAT(4*J-5)*U1*W6-DFLOAT(2*J-3)*U2)/DFLOAT(2*J-2)           SCAT-087
    2 EXCN=EXCN+U2*FCN(J,NOUT)*DFLOAT(4*J-3)                            SCAT-088
C DIRECT INTERACTION CONTRIBUTION.                                      SCAT-089
    3 W3=1.D0                                                           SCAT-090
      X2=DSQRT(.5D0*(1.D0+W6))                                          SCAT-091
      X3=DSQRT(.5D0*(1.D0-W6))                                          SCAT-092
      DO 4 I=1,NTT                                                      SCAT-093
      A(1,I)=0.D0                                                       SCAT-094
    4 A(2,I)=0.D0                                                       SCAT-095
      IF (NOUT.NE.1) GO TO 7                                            SCAT-096
C COMPUTATION OF COULOMB AMPLITUDES FOR THE ELASTIC CHANNEL.            SCAT-097
      IF (WV(5,1).EQ.0.D0.OR.X3.LT.1.D-20) GO TO 7                      SCAT-098
      W2=2.D0*WV(5,1)*DLOG(X3)                                          SCAT-099
      W3=-0.5D0*WV(5,1)/(X3*X3)                                         SCAT-100
      W4=W3*DCOS(W2)                                                    SCAT-101
      W5=-W3*DSIN(W2)                                                   SCAT-102
      W3=W3**2                                                          SCAT-103
      IF (.NOT.LO(18)) GO TO 5                                          SCAT-104
C SYMMETRISATION BETWEEN PROJECTILE AND TARGET.                         SCAT-105
      FS=DFLOAT(2*MOD(IPI(2,1),2)-1)                                    SCAT-106
      Y2=2.D0*WV(5,1)*DLOG(X2)                                          SCAT-107
      Y1=-0.5D0*WV(5,1)/(X2*X2)                                         SCAT-108
      Y4=Y1*DCOS(Y2)                                                    SCAT-109
      Y5=-Y1*DSIN(Y2)                                                   SCAT-110
      W3=W4**2+W5**2+Y4**2+Y5**2+2.D0*FS*(W4*Y4+W5*Y5)/DFLOAT(IPI(2,1)) SCAT-111
C TRANSFORMATION OF THE COULOMB AMPLITUDES TO THE HELICITY FORMALISM.   SCAT-112
    5 DO 6 I=1,NTT                                                      SCAT-113
      M5=IPI(2,1)-1                                                     SCAT-114
      M6=IPI(3,1)-1                                                     SCAT-115
      M1=2*MF(1,I)-1-IPI(2,1)                                           SCAT-116
      M2=IPI(3,1)-2*MF(2,I)+1                                           SCAT-117
      M3=2*MF(3,I)-1-IPI(2,1)                                           SCAT-118
      M4=IPI(3,1)-2*MF(4,I)+1                                           SCAT-119
      CALL EMRO(M5,M3,M1,X2,X3,B,1)                                     SCAT-120
      CALL EMRO(M6,M4,M2,X2,X3,B(2),1)                                  SCAT-121
      W1=B(1)*B(2)                                                      SCAT-122
      A(1,I)=W4*W1                                                      SCAT-123
      A(2,I)=W5*W1                                                      SCAT-124
      IF (.NOT.LO(18)) GO TO 6                                          SCAT-125
      CALL EMRO(M5,M3,M2,X2,X3,B,1)                                     SCAT-126
      CALL EMRO(M6,M4,M1,X2,X3,B(2),1)                                  SCAT-127
      Y1=B(1)*B(2)*FS                                                   SCAT-128
      A(1,I)=A(1,I)+Y4*Y1                                               SCAT-129
      A(2,I)=A(2,I)+Y5*Y1                                               SCAT-130
    6 CONTINUE                                                          SCAT-131
      W3=W3/WV(4,1)**2                                                  SCAT-132
C COMPUTATION OF THE NUCLEAR AMPLITUDES.                                SCAT-133
    7 DO 13 I=JN1,JN2                                                   SCAT-134
      IJ=I-JN1+1                                                        SCAT-135
      W5=1.D0                                                           SCAT-136
      JN=IPJ                                                            SCAT-137
      IF (.NOT.LO(41)) GO TO 9                                          SCAT-138
C FACTORISATION OF 1/(1-X*COS(THETA)) WITH X AFTER THE SCATTERING       SCAT-139
C COEFFICIENT.                                                          SCAT-140
      DO 8 J=1,NCJ                                                      SCAT-141
      JN=JN+1                                                           SCAT-142
    8 W5=W5/(1.D0-FR(1,JN,I)*W6)                                        SCAT-143
    9 IF (MF(6,I).EQ.99999) GO TO 10                                    SCAT-144
      CALL EMRO(JMIN,MF(5,I),MF(6,I),X2,X3,B,JN)                        SCAT-145
      W1=W5                                                             SCAT-146
      GO TO 11                                                          SCAT-147
C ROTATION MATRIX ELEMENTS ARE THE SAME AS FOR THE LAST AMPLITUDE.      SCAT-148
   10 W1=W5*DFLOAT(MF(10,I))                                            SCAT-149
   11 DO 12 J=1,IPJ                                                     SCAT-150
      A(1,IJ)=A(1,IJ)+FR(1,J,I)*W1*B(J)                                 SCAT-151
   12 A(2,IJ)=A(2,IJ)+FR(2,J,I)*W1*B(J)                                 SCAT-152
C CONSTRUCTION OF THE TOTAL AMPLITUDE MATRIX.                           SCAT-153
      K1=MF(7,I)                                                        SCAT-154
      AB(1,K1)=A(1,IJ)                                                  SCAT-155
      AB(2,K1)=A(2,IJ)                                                  SCAT-156
      IF (MF(8,I).EQ.0) GO TO 13                                        SCAT-157
      K1=MF(8,I)                                                        SCAT-158
      W1=DFLOAT(MF(9,I))                                                SCAT-159
      AB(1,K1)=W1*A(1,IJ)                                               SCAT-160
      AB(2,K1)=W1*A(2,IJ)                                               SCAT-161
   13 CONTINUE                                                          SCAT-162
C CROSS-SECTION.                                                        SCAT-163
      DZ=0.D0                                                           SCAT-164
      IF (LO(81)) DZ=EXCN/XZ                                            SCAT-165
      DO 14 I1=1,MTT                                                    SCAT-166
   14 DZ=DZ+AB(1,I1)*AB(1,I1)+AB(2,I1)*AB(2,I1)                         SCAT-167
      EX(1)=DZ*XZ                                                       SCAT-168
      LX1=0                                                             SCAT-169
      LX2=0                                                             SCAT-170
      JEX=1                                                             SCAT-171
C LOOP ON THE OBSERVABLES.                                              SCAT-172
      DO 54 IEX=NIX,NFX                                                 SCAT-173
      JEX=JEX+1                                                         SCAT-174
      IF (MF(2,IEX).GT.1) GO TO 21                                      SCAT-175
      IF (MF(2,IEX)) 17 , 15 , 16                                       SCAT-176
C CROSS SECTION.                                                        SCAT-177
   15 EX(JEX)=EX(1)                                                     SCAT-178
      GO TO 54                                                          SCAT-179
C CROSS SECTION DIVIDED BY RUTHERFORD'S CROSS-SECTION.                  SCAT-180
   16 EX(JEX)=EX(1)/(10.D0*W3)                                          SCAT-181
      GO TO 54                                                          SCAT-182
   17 EX(JEX)=0.D0                                                      SCAT-183
      IF (MF(2,IEX).EQ.-3) GO TO 19                                     SCAT-184
      MTP=MT1*MT2*MT4                                                   SCAT-185
C VECTOR ANALYSING POWER FOR SPIN 1/2 OR 1.                             SCAT-186
      DO 18 I1=1,MTP                                                    SCAT-187
      I2=I1+MTP                                                         SCAT-188
   18 EX(JEX)=EX(JEX)+AB(2,I2)*AB(1,I1)-AB(1,I2)*AB(2,I1)               SCAT-189
      EX(JEX)=2.D0*EX(JEX)*XZ/EX(1)                                     SCAT-190
      IF (MT3.EQ.3) EX(JEX)=1.22474487D0*EX(JEX)                        SCAT-191
      GO TO 54                                                          SCAT-192
C VECTOR POLARISATION FOR SPIN 1/2 OR 1.                                SCAT-193
   19 DO 20 I1=1,MTT,MT1                                                SCAT-194
   20 EX(JEX)=EX(JEX)+AB(1,I1+1)*AB(2,I1)-AB(2,I1+1)*AB(1,I1)           SCAT-195
      EX(JEX)=2.D0*EX(JEX)*XZ/EX(1)                                     SCAT-196
      IF (MT1.EQ.3) EX(JEX)=1.22474487D0*EX(JEX)                        SCAT-197
      GO TO 54                                                          SCAT-198
C ALL THE OTHER OBSERVABLES.                                            SCAT-199
   21 EX(JEX)=0.D0                                                      SCAT-200
      K1=MF(3,IEX)                                                      SCAT-201
      K2=MF(4,IEX)                                                      SCAT-202
C LOOP ON THE COMPONENTS OF THE DESCRIPTION OF THE OBSERVABLE.          SCAT-203
      DO 53 II=K1,K2                                                    SCAT-204
      IX=1                                                              SCAT-205
      IXY=0                                                             SCAT-206
      IXX=IXY+MTT                                                       SCAT-207
      DO 22 I=1,18                                                      SCAT-208
   22 MO(I)=NCO(I,II)                                                   SCAT-209
      DO 23 IJ=1,6                                                      SCAT-210
      LTT(IJ)=MOD(JQ,2).EQ.1                                            SCAT-211
   23 JQ=JQ/2                                                           SCAT-212
C COMPUTATION OF THE ANGLE FOR A CHANGE OF FRAME.                       SCAT-213
      IF (MOD(JP,1000).EQ.0) GO TO 46                                   SCAT-214
      LXY=.TRUE.                                                        SCAT-215
      IF (LX1.EQ.MOD(JP,1000)) GO TO 45                                 SCAT-216
      LX1=MOD(JP,1000)                                                  SCAT-217
      LX2=0                                                             SCAT-218
      N=MT1                                                             SCAT-219
      IF (LX1.EQ.1) GO TO 26                                            SCAT-220
      GO TO 25                                                          SCAT-221
   24 IF (JP/1000.EQ.0) GO TO 46                                        SCAT-222
      LXY=.FALSE.                                                       SCAT-223
      IF (JP/1000.EQ.LX2) GO TO 45                                      SCAT-224
      LX2=JP/1000                                                       SCAT-225
      N=MT2                                                             SCAT-226
      IF (LX2.EQ.1) GO TO 27                                            SCAT-227
   25 IF (DABS(W7).LT.1.D-5.OR.N.EQ.1) GO TO 43                         SCAT-228
      W1=W6                                                             SCAT-229
      W2=-W7                                                            SCAT-230
      GO TO 31                                                          SCAT-231
C TRANSFORMATION TO THE LABORATORY SYSTEM FOR THE PARTICLE.             SCAT-232
   26 W1=WV(1,NOUT)                                                     SCAT-233
      GO TO 28                                                          SCAT-234
C TRANSFORMATION TO THE LABORATORY SYSTEM FOR THE TARGET.               SCAT-235
   27 W1=-WV(2,NOUT)                                                    SCAT-236
   28 IF (N.EQ.1) GO TO 43                                              SCAT-237
      IF (.NOT.LO(08)) GO TO 29                                         SCAT-238
      W1=WV(4,NOUT)/(CMB*W1)                                            SCAT-239
      W2=CMB*WV(2,1)/WV(4,1)                                            SCAT-240
      W3=DATAN(-W7/(W6*DSQRT(W1*W1+1.D0)+W1*DSQRT(W2*W2+1.D0)))         SCAT-241
      GO TO 30                                                          SCAT-242
   29 W3=DATAN(-W7/(WV(4,NOUT)*WV(2,1)/(WV(4,1)*W1)+W6))                SCAT-243
   30 IF (DABS(W3).LT.1.D-5.OR.N.EQ.1) GO TO 43                         SCAT-244
      W1=DCOS(W3)                                                       SCAT-245
      W2=DSIN(W3)                                                       SCAT-246
   31 DO 32 I=1,MTT                                                     SCAT-247
      AB(1,I+IXX)=0.D0                                                  SCAT-248
   32 AB(2,I+IXX)=0.D0                                                  SCAT-249
      W3=DSQRT(.5D0*(1.D0-W1))                                          SCAT-250
      W5=1.D0                                                           SCAT-251
      DO 33 I=2,N                                                       SCAT-252
   33 W5=-W5*W3                                                         SCAT-253
      IF (DABS(W5).LT.1.D-30) GO TO 43                                  SCAT-254
      W4=0.D0                                                           SCAT-255
      W8=.5D0*DFLOAT(N-1)                                               SCAT-256
      MTY=MT3*MT4                                                       SCAT-257
      X3=-W8                                                            SCAT-258
C TRANSFORMATION OF THE AMPLITUDE MATRIX.                               SCAT-259
      DO 42 I=1,N                                                       SCAT-260
      IF (I.EQ.1) GO TO 34                                              SCAT-261
      W3=W4                                                             SCAT-262
      IF (I.NE.2) W3=W3*DSQRT(DFLOAT((I-2)*(N+2-I)))                    SCAT-263
      W4=W5                                                             SCAT-264
      W5=(2.D0*(X3*W1-W8)*W4/W2-W3)/DSQRT(DFLOAT((I-1)*(N+1-I)))        SCAT-265
      X3=X3+1.D0                                                        SCAT-266
   34 X2=0.D0                                                           SCAT-267
      X5=W5                                                             SCAT-268
      X4=W8                                                             SCAT-269
      DO 41 J=I,N                                                       SCAT-270
      IF (J.EQ.I) GO TO 35                                              SCAT-271
      X1=X2                                                             SCAT-272
      IF (J.NE.I+1) X1=X1*DSQRT(DFLOAT((J-I-1)*(N+1-J+I)))              SCAT-273
      X2=X5                                                             SCAT-274
      X5=(2.D0*(X3-X4*W1)*X2/W2-X1)/DSQRT(DFLOAT((J-I)*(N+I-J)))        SCAT-275
      X4=X4-1.D0                                                        SCAT-276
   35 X=X5                                                              SCAT-277
      L=1+J-I                                                           SCAT-278
      M=N+1-I                                                           SCAT-279
      DO 40 K=1,2                                                       SCAT-280
      DO 39 I1=1,MTY                                                    SCAT-281
      IF (LXY) GO TO 37                                                 SCAT-282
      IXI=IXX+MT1*((I1-1)*MT2+L-1)                                      SCAT-283
      IXJ=IXY+MT1*((I1-1)*MT2+M-1)                                      SCAT-284
      DO 36 I4=1,MT1                                                    SCAT-285
      AB(1,I4+IXI)=AB(1,I4+IXI)+X*AB(1,I4+IXJ)                          SCAT-286
   36 AB(2,I4+IXI)=AB(2,I4+IXI)+X*AB(2,I4+IXJ)                          SCAT-287
      GO TO 39                                                          SCAT-288
   37 IXI=IXX+MT1*((I1-1)*MT2-1)+L                                      SCAT-289
      IXJ=IXY+MT1*((I1-1)*MT2-1)+M                                      SCAT-290
      DO 38 I4=MT1,MT2*MT1,MT1                                          SCAT-291
      AB(1,IXI+I4)=AB(1,IXI+I4)+X*AB(1,IXJ+I4)                          SCAT-292
   38 AB(2,IXI+I4)=AB(2,IXI+I4)+X*AB(2,IXJ+I4)                          SCAT-293
   39 CONTINUE                                                          SCAT-294
      IF (J.EQ.N) GO TO 41                                              SCAT-295
      ML=L                                                              SCAT-296
      L=M                                                               SCAT-297
      M=ML                                                              SCAT-298
      IF (MOD(J+N,2).NE.0) X=-X                                         SCAT-299
   40 CONTINUE                                                          SCAT-300
   41 CONTINUE                                                          SCAT-301
   42 CONTINUE                                                          SCAT-302
      GO TO 45                                                          SCAT-303
   43 DO 44 I=1,MTT                                                     SCAT-304
      AB(1,I+IXX)=AB(1,I+IXY)                                           SCAT-305
   44 AB(2,I+IXX)=AB(2,I+IXY)                                           SCAT-306
   45 IX=IX+1                                                           SCAT-307
      IXY=IXX                                                           SCAT-308
      IXX=IXY+MTT                                                       SCAT-309
      IF (LXY) GO TO 24                                                 SCAT-310
   46 IF (LTT(5)) GO TO 52                                              SCAT-311
      X=0.D0                                                            SCAT-312
C THE FOUR DO LOOPS.                                                    SCAT-313
      DO 51 I1=MI1,MP1                                                  SCAT-314
      J1=I1-N1                                                          SCAT-315
      X1=COE(10*II)                                                     SCAT-316
      IF (LTT(1)) X1=COE(10*II)*COE(I1+L1)                              SCAT-317
      DO 50 I2=MI2,MP2                                                  SCAT-318
      J2=I2-N2                                                          SCAT-319
      X2=X1                                                             SCAT-320
      IF (LTT(2)) X2=X1*COE(L2-I2)                                      SCAT-321
      DO 49 I3=MI3,MP3                                                  SCAT-322
      J3=I3-N3                                                          SCAT-323
      X3=X2                                                             SCAT-324
      IF (LTT(3)) X3=X2*COE(I3+L3)                                      SCAT-325
      DO 48 I4=MI4,MP4                                                  SCAT-326
      J4=I4-N4                                                          SCAT-327
      X4=X3                                                             SCAT-328
      IIJ=MT1*(I4+MT2*(J2-1+MT4*(J1-1+MT3*(IX-1)))-1)                   SCAT-329
      III=MT1*(J4+MT2*(I2-1+MT4*(I1-1+MT3*(IX-1)))-1)                   SCAT-330
      IF (LTT(4)) X4=X3*COE(L4-I4)                                      SCAT-331
      IF (LTT(6)) GO TO 47                                              SCAT-332
      X=X+(AB(1,I3+IIJ)*AB(1,J3+III)+AB(2,I3+IIJ)*AB(2,J3+III))*X4      SCAT-333
      GO TO 48                                                          SCAT-334
   47 X=X+(AB(2,I3+IIJ)*AB(1,J3+III)-AB(1,I3+IIJ)*AB(2,J3+III))*X4      SCAT-335
   48 CONTINUE                                                          SCAT-336
   49 CONTINUE                                                          SCAT-337
   50 CONTINUE                                                          SCAT-338
   51 CONTINUE                                                          SCAT-339
      GO TO 53                                                          SCAT-340
   52 X=COE(10*II)*DZ                                                   SCAT-341
   53 EX(JEX)=EX(JEX)+X                                                 SCAT-342
      EX(JEX)=EX(JEX)/DZ                                                SCAT-343
   54 CONTINUE                                                          SCAT-344
      IF (LKT) GO TO 55                                                 SCAT-345
      XC=DSQRT((XA*W6+XB)**2+W7**2)**3/DABS(XA+XB*W6)                   SCAT-346
      EX(1)=EX(1)*XC                                                    SCAT-347
   55 IF (KLT.EQ.1.OR.LKT) RETURN                                       SCAT-348
      EX(2)=EX(2)*XC                                                    SCAT-349
      IF (LO(81)) EXCN=EXCN*XC                                          SCAT-350
      RETURN                                                            SCAT-351
C PURE COMPOUND NUCLEUS FOR LEVELS JN1 TO JN2.                          SCAT-352
   56 IS=JN1-1                                                          SCAT-353
      DO 63 IV=JN1,JN2                                                  SCAT-354
      EX(IV-IS)=FCN(1,IV)                                               SCAT-355
      IF (IPK.EQ.1) GO TO 62                                            SCAT-356
      IF (LKT) GO TO 59                                                 SCAT-357
      IF (LO(8)) GO TO 57                                               SCAT-358
      XA=1.D0                                                           SCAT-359
      XB=WV(4,1)*WV(1,IV)/(WV(4,IV)*WV(2,1))                            SCAT-360
      GO TO 58                                                          SCAT-361
   57 XA=DSQRT(1.D0+(WV(4,1)/(CMB*WV(2,1)))**2)                         SCAT-362
      XB=DSQRT(WV(1,IV)**2+(WV(4,IV)/CMB)**2)*WV(4,1)/(WV(4,IV)*WV(2,1))SCAT-363
   58 W6=DCOS(THET)                                                     SCAT-364
      W7=DSIN(THET)                                                     SCAT-365
      XC=(XA**2-XB**2)*W7**2+W6**2                                      SCAT-366
      IF (XC.GT.0.D0) XC=DSQRT(XC)                                      SCAT-367
      W6=XC*W6-XA*XB*W7**2                                              SCAT-368
      GO TO 60                                                          SCAT-369
   59 W6=DCOS(THET)                                                     SCAT-370
   60 U1=0.D0                                                           SCAT-371
      U2=1.D0                                                           SCAT-372
      DO 61 J=2,IPK                                                     SCAT-373
      U1=(DFLOAT(4*J-7)*U2*W6-DFLOAT(2*J-4)*U1)/DFLOAT(2*J-3)           SCAT-374
      U2=(DFLOAT(4*J-5)*U1*W6-DFLOAT(2*J-3)*U2)/DFLOAT(2*J-2)           SCAT-375
   61 EX(IV-IS)=EX(IV-IS)+U2*FCN(J,IV)*DFLOAT(4*J-3)                    SCAT-376
   62 IF (.NOT.LKT) EX(IV-IS)=EX(IV-IS)*DSQRT((XA*W6+XB)**2+1.D0-W6**2)*SCAT-377
     1*3/DABS(XA+XB*W6)                                                 SCAT-378
   63 CONTINUE                                                          SCAT-379
      RETURN                                                            SCAT-380
      END                                                               SCAT-381
C 28/06/06                                                      ECIS06  GRAL-000
      SUBROUTINE GRAL(TGR,GRR,FRR,MTHETA,MF,CM,ID1,LT1,LT2)             GRAL-001
C PLOTS OF CROSS-SECTION AND POLARISATIONS WITH AND WITHOUT EXPERIMENTALGRAL-002
C DATA.                                                                 GRAL-003
C INPUT:     TGR:     ANGLES.                                           GRAL-004
C            GRR:     CALCULATED VALUES.                                GRAL-005
C            FRR:     EXPERIMENTAL VALUES.                              GRAL-006
C            MTHETA:  NUMBER OF ANGLES.                                 GRAL-007
C            MF,CM:   EQUIVALENT BY CALL, DESCRIPTION OF DATA (SEE OBSE)GRAL-008
C                     MF(5,J) IS THE NUMBER OF POWER OF 10 IN A LINE    GRAL-009
C                     FOR CROSS SECTIONS AND MUST BE 1 TO PLOT A        GRAL-010
C                     POLARISATION (ALWAYS BETWEEN -1 AND 1).           GRAL-011
C                     CM(I,J) IS A TITLE FOR I=6,10.                    GRAL-012
C            ID1:     NUMBER OF DIFFERENT POLARISATIONS.                GRAL-013
C            LT1:     .TRUE. FOR POLARISATION,                          GRAL-014
C                     .FALSE. FOR CROSS SECTION.                        GRAL-015
C            LT2:     .TRUE. IF THERE ARE NO EXPERIMENTAL DATA.         GRAL-016
C***********************************************************************GRAL-017
      IMPLICIT REAL*8 (A-H,O-Z)                                         GRAL-018
      LOGICAL LT1,LT2                                                   GRAL-019
      DIMENSION TGR(MTHETA),GRR(ID1,MTHETA),FRR(MTHETA),MF(10,*)        GRAL-020
      CHARACTER*1 VGR(112),GRA(17)                                      GRAL-021
      CHARACTER*4 CM(10,*)                                              GRAL-022
      COMMON /INOUT/ MR,MW,MS                                           GRAL-023
      DATA GRA /'+','*',',',':','-','1','2','3','4','5','6','7','8','9',GRAL-024
     1'0',' ','.'/                                                      GRAL-025
      IF (LT1) GO TO 14                                                 GRAL-026
C CROSS SECTIONS.                                                       GRAL-027
      IF ((MF(5,1).LE.0).OR.(MF(5,1).GT.50)) RETURN                     GRAL-028
      NA2=100/MF(5,1)                                                   GRAL-029
      AA2=DFLOAT(NA2)                                                   GRAL-030
      WRITE (MW,1000)                                                   GRAL-031
      WRITE (MW,1001) GRA(1),(CM(J,1),J=6,10)                           GRAL-032
      IF (.NOT.LT2) WRITE (MW,1002)                                     GRAL-033
      AA3=AA2*DFLOAT((MF(5,1)+1)/2)                                     GRAL-034
      AA1=AA2/DLOG(10.D0)                                               GRAL-035
      NA1=101-MF(5,1)*NA2                                               GRAL-036
      A5=101.5D0                                                        GRAL-037
      DO 1 I=1,112                                                      GRAL-038
    1 VGR(I)=GRA(16)                                                    GRAL-039
      DO 2 I=NA1,112,NA2                                                GRAL-040
    2 VGR(I)=GRA(6)                                                     GRAL-041
      WRITE (MW,1003) VGR                                               GRAL-042
      DO 3 I=1,112                                                      GRAL-043
    3 VGR(I)=GRA(17)                                                    GRAL-044
      DO 4 I=NA1,112,NA2                                                GRAL-045
    4 VGR(I)=GRA(2)                                                     GRAL-046
      WRITE (MW,1003) VGR                                               GRAL-047
      DO 11 I=1,MTHETA                                                  GRAL-048
      DO 5 J=2,111                                                      GRAL-049
    5 VGR(J)=GRA(16)                                                    GRAL-050
      DO 6 J=NA1,111,NA2                                                GRAL-051
    6 VGR(J)=GRA(17)                                                    GRAL-052
      IF (GRR(1,I).LT.0.D0) GO TO 27                                    GRAL-053
      A4=AA1*DLOG(GRR(1,I))+A5                                          GRAL-054
      NG=0                                                              GRAL-055
    7 IF (NG.GT.20) GO TO 28                                            GRAL-056
      NG=NG+1                                                           GRAL-057
      IF (A4.GT.2.D0) GO TO 8                                           GRAL-058
      A4=A4+AA3                                                         GRAL-059
      A5=A5+AA3                                                         GRAL-060
      WRITE (MW,1004)                                                   GRAL-061
      GO TO 7                                                           GRAL-062
    8 IF (A4.LT.112.D0) GO TO 9                                         GRAL-063
      A4=A4-AA3                                                         GRAL-064
      A5=A5-AA3                                                         GRAL-065
      WRITE (MW,1005)                                                   GRAL-066
      GO TO 8                                                           GRAL-067
    9 L=IDINT(A4)                                                       GRAL-068
      VGR(L)=GRA(1)                                                     GRAL-069
      IF (LT2) GO TO 10                                                 GRAL-070
C EXPERIMENTAL DATA.                                                    GRAL-071
      IF (FRR(I).LT.0.D0) GO TO 29                                      GRAL-072
      L=IDINT(AA1*DLOG(FRR(I))+A5)                                      GRAL-073
      IF (L.GT.1.AND.L.LT.112) VGR(L)=GRA(2)                            GRAL-074
   10 WRITE (MW,1006) TGR(I),VGR                                        GRAL-075
   11 CONTINUE                                                          GRAL-076
      DO 12 I=1,112                                                     GRAL-077
   12 VGR(I)=GRA(17)                                                    GRAL-078
      DO 13 I=NA1,112,NA2                                               GRAL-079
   13 VGR(I)=GRA(2)                                                     GRAL-080
      WRITE (MW,1003) VGR                                               GRAL-081
      RETURN                                                            GRAL-082
C POLARISATION.                                                         GRAL-083
   14 IF (LT2) GO TO 15                                                 GRAL-084
      WRITE (MW,1000)                                                   GRAL-085
      WRITE (MW,1001) GRA(1),(CM(J,1),J=6,10)                           GRAL-086
      WRITE (MW,1002)                                                   GRAL-087
      GO TO 17                                                          GRAL-088
   15 NK=0                                                              GRAL-089
      DO 16 K=1,ID1                                                     GRAL-090
      IF (MF(5,K).NE.1) GO TO 16                                        GRAL-091
      KN=MOD(NK,15)+1                                                   GRAL-092
      NK=NK+1                                                           GRAL-093
      IF (NK.EQ.1) WRITE (MW,1000)                                      GRAL-094
      WRITE (MW,1001) GRA(KN),(CM(J,K),J=6,10)                          GRAL-095
   16 CONTINUE                                                          GRAL-096
      IF (NK.EQ.0) RETURN                                               GRAL-097
   17 WRITE (MW,1007)                                                   GRAL-098
      DO 18 I=1,112                                                     GRAL-099
   18 VGR(I)=GRA(16)                                                    GRAL-100
      DO 19 I=1,103                                                     GRAL-101
   19 VGR(I)=GRA(17)                                                    GRAL-102
      DO 20 I=2,102,10                                                  GRAL-103
   20 VGR(I)=GRA(2)                                                     GRAL-104
      WRITE (MW,1003) VGR                                               GRAL-105
      DO 24 I=1,MTHETA                                                  GRAL-106
      DO 21 M=2,102                                                     GRAL-107
   21 VGR(M)=GRA(16)                                                    GRAL-108
      VGR(52)=GRA(17)                                                   GRAL-109
      NK=0                                                              GRAL-110
      DO 22 K=1,ID1                                                     GRAL-111
      IF (MF(5,K).NE.1) GO TO 22                                        GRAL-112
      NK=MOD(NK,15)+1                                                   GRAL-113
      M=IDINT(50.D0*GRR(K,I)+52.5D0)                                    GRAL-114
      IF (M.GT.1.AND.M.LE.102) VGR(M)=GRA(NK)                           GRAL-115
   22 CONTINUE                                                          GRAL-116
      IF (LT2) GO TO 23                                                 GRAL-117
      M=IDINT(50.D0*FRR(I)+52.5D0)                                      GRAL-118
      IF (M.GT.1.AND.M.LE.102) VGR(M)=GRA(2)                            GRAL-119
   23 WRITE (MW,1006) TGR(I),VGR                                        GRAL-120
   24 CONTINUE                                                          GRAL-121
      DO 25 I=1,103                                                     GRAL-122
   25 VGR(I)=GRA(17)                                                    GRAL-123
      DO 26 I=2,102,10                                                  GRAL-124
   26 VGR(I)=GRA(2)                                                     GRAL-125
      WRITE (MW,1003) VGR                                               GRAL-126
      RETURN                                                            GRAL-127
   27 WRITE (MW,1008) I,GRR(1,I)                                        GRAL-128
      GO TO 30                                                          GRAL-129
   28 WRITE (MW,1009) I,GRR(1,I)                                        GRAL-130
      GO TO 30                                                          GRAL-131
   29 WRITE (MW,1010) I,FRR(I)                                          GRAL-132
   30 WRITE (MW,1011)                                                   GRAL-133
      RETURN                                                            GRAL-134
 1000 FORMAT ('1')                                                      GRAL-135
 1001 FORMAT (45X,A1,4X,5A4/)                                           GRAL-136
 1002 FORMAT (45X,'+    CALCULATED VALUE'/45X,'*    EXPERIMENTAL VALUE'/GRAL-137
     1)                                                                 GRAL-138
 1003 FORMAT (7X,112A1)                                                 GRAL-139
 1004 FORMAT (40(' -*'))                                                GRAL-140
 1005 FORMAT (40(' *-'))                                                GRAL-141
 1006 FORMAT (F7.2,112A1)                                               GRAL-142
 1007 FORMAT (//6X,' -1',7X,' -.8',6X,' -.6',6X,' -.4',6X,' -.2',7X,' 0'GRAL-143
     1,8X,' .2',7X,' .4',7X,' .6',7X,' .8',7X,' 1')                     GRAL-144
 1008 FORMAT (' FOR THE',I4,'TH LINE, CALCULATED VALUE =',D15.8)        GRAL-145
 1009 FORMAT (' FOR THE',I4,'TH LINE, MORE THAN 20 TRANSLATIONS. CALCULAGRAL-146
     1TED VALUE =',D15.8)                                               GRAL-147
 1010 FORMAT (' FOR THE',I4,'TH LINE, EXPERIMENTAL VALUE =',D15.8)      GRAL-148
 1011 FORMAT (//' **** GRAPH CANCELED ****')                            GRAL-149
      END                                                               GRAL-150
C 09/02/06                                                      ECIS06  EMRO-000
      SUBROUTINE EMRO(IA,I1,I2,X2,X3,RES,NX)                            EMRO-001
C COMPUTATION OF ROTATION MATRIX ELEMENTS.                              EMRO-002
C INPUT:     IA:      TWICE THE FIRST J VALUE.                          EMRO-003
C            I1:      TWICE M1.                                         EMRO-004
C            I2:      TWICE M2.                                         EMRO-005
C            X2:      COSINES OF THETA/2.                               EMRO-006
C            X3:      SINUS OF THETA/2.                                 EMRO-007
C            NX:      NUMBER OF VALUES REQUESTED.                       EMRO-008
C OUTPUT:    RES:     MATRIX ELEMENTS:                                  EMRO-009
C                      J          J+1                     J+NX-1        EMRO-010
C                     R (THETA), R (THETA) ............. R (THETA)      EMRO-011
C                      M1,M2      M1,M2                   M1,M2         EMRO-012
C                     USING THE RECURRENCE RELATION OBTAINED FROM       EMRO-013
C                                   J                  J'               EMRO-014
C                     COS(THETA) * R (THETA)  = SUM   R (THETA)         EMRO-015
C                                   M1,M2       ON J'  M1,M2            EMRO-016
C                                                                       EMRO-017
C***********************************************************************EMRO-018
      IMPLICIT REAL*8 (O-Z)                                             EMRO-019
      DIMENSION RES(*)                                                  EMRO-020
      NR=1                                                              EMRO-021
      JA=IA                                                             EMRO-022
      X1=X2*X2-X3*X3                                                    EMRO-023
      M1=IABS(I1+I2)/2                                                  EMRO-024
      M2=IABS(I1-I2)/2                                                  EMRO-025
      MJ=M1+M2                                                          EMRO-026
      NJ=MJ                                                             EMRO-027
    1 IF (MJ.LE.JA) GO TO 2                                             EMRO-028
      RES(NR)=0.D0                                                      EMRO-029
      NR=NR+1                                                           EMRO-030
      IF (NR.GT.NX) RETURN                                              EMRO-031
      JA=JA+2                                                           EMRO-032
      GO TO 1                                                           EMRO-033
    2 S1=0.D0                                                           EMRO-034
      S2=0.D0                                                           EMRO-035
      S3=1.D0                                                           EMRO-036
      IF (MJ.EQ.0) GO TO 11                                             EMRO-037
C THE MAGNETIC QUANTUM NUMBERS ARE NOT BOTH ZEROS.                      EMRO-038
      IF (M1.EQ.M2) GO TO 8                                             EMRO-039
C NO MAGNETIC QUANTUM NUMBER IS ZERO.                                   EMRO-040
      IF (M2.EQ.0) GO TO 4                                              EMRO-041
      DO 3 I=1,M2                                                       EMRO-042
    3 S3=S3*X3*DSQRT(DFLOAT(M1+I)/DFLOAT(I))                            EMRO-043
    4 IF (M1.EQ.0) GO TO 6                                              EMRO-044
      DO 5 M=1,M1                                                       EMRO-045
    5 S3=S3*X2                                                          EMRO-046
    6 IF ((I1.GT.I2).AND.(2*(M2/2).NE.M2)) S3=-S3                       EMRO-047
      KX=1                                                              EMRO-048
      X4=0.D0                                                           EMRO-049
      Z1=DFLOAT(M1)                                                     EMRO-050
      Z2=DFLOAT(M2)                                                     EMRO-051
      SL=(Z1-Z2)/DFLOAT(NJ+2)                                           EMRO-052
    7 IF (JA.LE.NJ) GO TO 13                                            EMRO-053
C RECURRENCE.                                                           EMRO-054
      NJ=NJ+2                                                           EMRO-055
      S2=S3                                                             EMRO-056
      Z1=Z1+1.D0                                                        EMRO-057
      Z2=Z2+1.D0                                                        EMRO-058
      MJ=MJ+1                                                           EMRO-059
      X4=X4+1.D0                                                        EMRO-060
      Y2=DSQRT(Z1*Z2*X4*DFLOAT(MJ))                                     EMRO-061
      SJ=DFLOAT(NJ)                                                     EMRO-062
      S3=(SJ-1.D0)*SJ*((X1-SL)*S2-S1)/(2.D0*Y2)                         EMRO-063
      S1=2.D0*Y2*S2/((SJ+1.D0)*SJ)                                      EMRO-064
      SL=SL*(SJ-2.D0)/(SJ+2.D0)                                         EMRO-065
      GO TO 7                                                           EMRO-066
C A MAGNETIC QUANTUM NUMBER IS ZERO.                                    EMRO-067
    8 DO 9 I=1,M1                                                       EMRO-068
    9 S3=S3*X3*X2*DSQRT(DFLOAT(M1+I)/DFLOAT(I))                         EMRO-069
      KX=2                                                              EMRO-070
      IF (I1.GT.I2.AND.(2*(M2/2).NE.M2)) S3=-S3                         EMRO-071
      X4=0.D0                                                           EMRO-072
   10 IF (JA.LE.NJ) GO TO 13                                            EMRO-073
C RECURRENCE.                                                           EMRO-074
      NJ=NJ+2                                                           EMRO-075
      S2=S3                                                             EMRO-076
      MJ=MJ+1                                                           EMRO-077
      X4=X4+1.D0                                                        EMRO-078
      Y2=DSQRT(X4*DFLOAT(MJ))                                           EMRO-079
      S3=(DFLOAT(NJ-1)*X1*S2-S1)/Y2                                     EMRO-080
      S1=Y2*S2                                                          EMRO-081
      GO TO 10                                                          EMRO-082
C THE MAGNETIC QUANTUM NUMBERS ARE BOTH ZEROS.                          EMRO-083
   11 KX=3                                                              EMRO-084
   12 IF (JA.LE.NJ) GO TO 13                                            EMRO-085
C RECURRENCE.                                                           EMRO-086
      NJ=NJ+2                                                           EMRO-087
      SJ=DFLOAT(NJ/2)                                                   EMRO-088
      S2=S3                                                             EMRO-089
      S3=((2.D0*SJ-1.D0)*X1*S2-S1)/SJ                                   EMRO-090
      S1=S2*SJ                                                          EMRO-091
      GO TO 12                                                          EMRO-092
C STORAGE.                                                              EMRO-093
   13 RES(NR)=S3                                                        EMRO-094
      NR=NR+1                                                           EMRO-095
      IF (NR.GT.NX) RETURN                                              EMRO-096
      JA=JA+2                                                           EMRO-097
      GO TO ( 7 , 10 , 12 ),KX                                          EMRO-098
      END                                                               EMRO-099
C 29/10/06                                                      ECIS06  VARI-000
      SUBROUTINE VARI(KF,NW,DW,LO)                                      VARI-001
C ASSIGNS THE VALUES OF THE VARIABLE PARAMETERS AND PRINTS THE OUTPUT   VARI-002
C DURING THE SEARCH.                                                    VARI-003
C INPUT:     KF:      1 BEFORE THE CALL TO THE SEARCH SUBROUTINES:      VARI-004
C                     AT THE FIRST CALL(KE=0) DEFINES THE VARIABLES     VARI-005
C                     IN SEARCH,                                        VARI-006
C                     AT ANY CALL, PRINT CHI2 AND VARIABLES.            VARI-007
C                     0 AFTER THE CALL TO THE SEARCH SUBROUTINES:       VARI-008
C                     AT ANY CALL SETS PARAMETERS TO THEIR VALUE FOR    VARI-009
C                     NEXT EVALUATION,                                  VARI-010
C                     AT THE LAST CALL AND IF KE IS NOT 1, PRINT        VARI-011
C                     ERRORS AND PARAMETERS.                            VARI-012
C            NW:      WORKING AREA FOR INTEGERS.                        VARI-013
C            DW:      WORKING AREA FOR DOUBLE PRECISION IN EQUIVALENCE  VARI-014
C                     BY CALL WITH NW.                                  VARI-015
C            LO:      LOGICAL CONTROLS:                                 VARI-016
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).VARI-017
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     VARI-018
C                              ROTATIONAL MODEL.                        VARI-019
C               LO(4)  =.TRUE. PARAMETRISED SPIN-ORBIT DEFORMATION.     VARI-020
C               LO(6)  =.TRUE. USE DEFORMATION LENGTHS.                 VARI-021
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    VARI-022
C               LO(16) =.TRUE. HEAVY-ION DEFINITION OF REDUCED RADII ANDVARI-023
C                              DEFORMATIONS.                            VARI-024
C               LO(17) =.TRUE. FOLDING MODEL.                           VARI-025
C               LO(41) =.TRUE. FACTORISATION OF 1/(1-COS(THETA)).       VARI-026
C               LO(53) =.TRUE. OUTPUT OF THE NUMBER OF ITERATIONS.      VARI-027
C               LO(55) =.TRUE. OUTPUT OF C-MATRIX ELEMENTS AND OF       VARI-028
C                              COMPOUND NUCLEUS INTERMEDIATE RESULTS.   VARI-029
C               LO(56) =.TRUE. OUTPUT OF S-MATRIX ELEMENTS.             VARI-030
C               LO(57) =.TRUE. OUTPUT PHASE-SHIFTS AT EACH ITERATION.   VARI-031
C               LO(58) =.TRUE. OUTPUT OF THE COEFFICIENTS OF EACH FORM  VARI-032
C                              FACTOR FOR ALL SETS OF EQUATIONS.        VARI-033
C               LO(60) =.TRUE. S-MATRIX ELEMENTS WRITTEN ON FILE 60.    VARI-034
C               LO(62) =.TRUE. POTENTIALS WRITTEN ON FILE 62.           VARI-035
C               LO(64) =.TRUE. PRINT RESULTS ON FILES 64 AND 66.        VARI-036
C               LO(76) =.TRUE. LO(51) TO LO(65) ARE ALWAYS USED.        VARI-037
C               LO(78) =.TRUE. OUTPUT OF DIFFERENCES BETWEEN            VARI-038
C                              EXPERIMENTAL AND CALCULATED VALUES.      VARI-039
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             VARI-040
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         VARI-041
C               LO(87) =.TRUE. NO WIDTH FLUCTUATIONS.                   VARI-042
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      VARI-043
C               LO(111)=.TRUE. NUCLEAR PARAMETERS ARE CHANGED IN SEARCH.VARI-044
C               LO(112)=.TRUE. SPIN-ORBIT OR COMPOUND NUCLEUS PARAMETERSVARI-045
C                              ARE CHANGED IN SEARCH.                   VARI-046
C               LO(113)=.TRUE. DISPERSION RELATION IS CHANGED IN SEARCH.VARI-047
C               LO(114)=.TRUE. COMPOUND NUCLEUS CONTINUUM IS CHANGED IN VARI-048
C                              SEARCH.                                  VARI-049
C               LO(116)=.TRUE. NO OUTPUT.                               VARI-050
C               LO(118)=.TRUE. FOR LAST RESULTS.                        VARI-051
C               LO(119)=.TRUE. RESULTS WITH THE LAST CALCULATION.       VARI-052
C               LO(120)=.TRUE. OUTPUT AND LAST CALCULATION BEST ONE.    VARI-053
C                                                                       VARI-054
C FOR THE COMMON  /ADDRE/, /COUPL/ AND /INTEG/ SEE CALC.                VARI-055
C FOR THE COMMON  /DCHI2/ AND /NCOMP/ SEE CALX.                         VARI-056
C                                                                       VARI-057
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ADDRE/:                     VARI-058
C  NWV:       NON INTEGER VALUES FOR THE CHANNELS.                      VARI-059
C  NIPP:      DISPERSION PARAMETERS.                                    VARI-060
C  NPAA:      VALUES OF NUCLEAR PARAMETERS.                             VARI-061
C  NSCN:      LEVEL DENSITY DESCRIPTION.                                VARI-062
C  NFIS:      FISSION DATA FOR COMPOUND NUCLEUS.                        VARI-063
C  NGAM:      GAMMA DATA FOR COMPOUND NUCLEUS.                          VARI-064
C  NPOT:      OPTICAL POTENTIAL PARAMETERS.                             VARI-065
C  NBETA:     DEFORMATION PARAMETERS.                                   VARI-066
C  NTGX:      BEGINNING OF CHI2 AND NORMALISATION OF DATA.              VARI-067
C  NISE:      INDEXES OF THE VARIABLE PARAMETERS IN SEARCH.             VARI-068
C  NRC:       PERMANENT WORKING FIELD FOR THE SEARCH.                   VARI-069
C  NIW:       INTEGER WORKING FIELD FOR THE SEARCH.                     VARI-070
C  NRES:      FUNCTIONS FOR THE SEARCH.                                 VARI-071
C  NXX:       VARIABLES FOR THE SEARCH.                                 VARI-072
C  NT:        TABLE OF REDUCED NUCLEAR MATRIX ELEMENTS.                 VARI-073
C  NIVQ:      TABLE OF MULTIPOLES.                                      VARI-074
C  NIVY:      TABLE OF FORM FACTOR IDENTIFICATION IVY (FOR COMPUTATION).VARI-075
C   USED:     NWV,NIPP,NPAA,NSCN,NFIS,NGAM,NPOT,NBETA,NTGX,NISE,NRC,NIW,VARI-076
C             NRES,NXX,NT,NIVQ,NIVY.                                    VARI-077
C                                                                       VARI-078
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     VARI-079
C  IQM:       MAXIMUM L-VALUE OF DEFORMATION IN ROTATIONAL MODEL.       VARI-080
C  IQMAX:     MAXIMUM L-EXPANSION IN ROTATIONAL MODEL.                  VARI-081
C  NBT1:      NUMBER OF PHONONS (VIBRATIONS).                           VARI-082
C  NFA:       NUMBER OF LOGARITHMS OF FACTORIALS.                       VARI-083
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             VARI-084
C  NSPIN:     TWICE THE K-VALUE OF THE ROTATIONAL BAND.                 VARI-085
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             VARI-086
C   USED:     NPP,NVA.                                                  VARI-087
C                                                                       VARI-088
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCHI2/:                     VARI-089
C  CHI2:      CHI-SQUARE COMPUTED IN SUBROUTINE RESU.                   VARI-090
C  CHI2M:     MINIMUM CHI-SQUARE IN THE SEARCH.                         VARI-091
C  YY(1):     STEP SIZE IN THE SEARCH.                                  VARI-092
C  YY(2):     HALF OF THE SUCCESS MULTIPLICATIVE FACTOR OF THE STEP.    VARI-093
C  YY(3):     VARIOUS MEANINGS.  SEE FITE.                              VARI-094
C   USED:     CHI2,CHI2M,YY.                                            VARI-095
C                                                                       VARI-096
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INTEG/:                     VARI-097
C  NBET:      NUMBER OF DIFFERENT DEFORMATIONS (VIBRATIONS+ROTATIONS).  VARI-098
C  NCOLR:     NUMBER OF EXPERIMENTAL ANGULAR DISTRIBUTIONS.             VARI-099
C  NREC:      NUMBER OF VARIABLES IN SEARCH.                            VARI-100
C  NTOT:      NUMBER OF EXPERIMENTAL DATA.                              VARI-101
C  KE:        CONTROL OF SEARCH (SEE FITE).                             VARI-102
C   USED:     NBET,NCOLR,NREC,NTOT,KE.                                  VARI-103
C                                                                       VARI-104
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     VARI-105
C  NFISS:     NUMBER OF FISSION TRANSMISSION COEFFICIENTS.              VARI-106
C  NRD:       NUMBER OF GAMMA TRANSMISSION COEFFICIENTS.                VARI-107
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 VARI-108
C  NCONS:     NUMBER OF LEVEL DENSITIES NEEDED.                         VARI-109
C  AZ(I):     SPIN-ORBIT PARAMETRISATION FOR I-1 TO 6,                  VARI-110
C             HAUSER FESHBACH PARAMETERS FOR J=7 TO 11,                 VARI-111
C             GIANT DIPOLE RESONANCE FOR I=12 TO 16.                    VARI-112
C   DEFINED:  AZ.                                                       VARI-113
C   USED:     NFISS,NRD,NCONT,NCONS,AZ.                                 VARI-114
C                                                                       VARI-115
C PARAMETERS IN SEARCH ARE GIVEN BY NW(2-MOD(I,2),NISE+I/2)=INDEX(I)    VARI-116
C STARTING AT NW(1,NISE) FOR I=1 TO NREC:                               VARI-117
C   POSITIVE VALUE: PARAMETER DEFINED BY INDEX(I)                       VARI-118
C   NEGATIVE VALUE -L: PARAMETERS DEFINED BY INDEX(J) FOR J=L+1 TO      VARI-119
C     J=L+INDEX(L) ARE DEFINED AS THE SAME VARIABLE.                    VARI-120
C      1-1000      OPTICAL MODEL,FOLDING PARAMETERS.                    VARI-121
C   1001-2000      DEFORMATIONS FOR A GIVEN POTENTIAL:  - LX(1)=.TRUE.  VARI-122
C   2001-3000      DEFORMATIONS FOR A GIVEN MULTIPOLE:  - LX(1)=.TRUE.  VARI-123
C   3001-4000      INDIVIDUAL DEFORMATION:              - LX(1)=.TRUE.  VARI-124
C   4001-5000      NUCLEAR MODEL PARAMETER:             - LO(111)=.TRUE.VARI-125
C   5001-6000      NUCLEAR MATRIX ELEMENT:              - LX(2)=.TRUE.  VARI-126
C   6001-7000      SPIN-ORBIT AND COMPOUND NUCLEUS PARAMETRISATION:     VARI-127
C    6001-6006     SPIN-ORBIT PARAMETRISATION:          - LX(3)=.TRUE.  VARI-128
C    6007-6011     BZ1, BZ2, BZ3, BZ4, BZ5:     - LO(112)=LX(4)=.TRUE.  VARI-129
C    6012-6016     TGO, BN, FNUG, EGD, GGD:     - LO(112)=LX(5)=.TRUE.  VARI-130
C    6017-6...     SEE DESCRIPTION OF INPUT.                            VARI-131
C   FOR GAMMA      SA, UX, TAU, SG, E0, EX:     - LO(112)=LX(6)=.TRUE.  VARI-132
C   FOR CONTINUUM  SA, UX, TAU, SG, E0, EX:     - LO(114)=LX(7)=.TRUE.  VARI-133
C                  GAMMA TRANSMISSION FACTORS:          - LX(8)=.TRUE.  VARI-134
C                  FISSION TRANSMISSION COEFFICIENT,                    VARI-135
C                  DEGREE OF FREEDOM:                  - LX(9)=.TRUE.   VARI-136
C   7001-8000      DISPERSION RELATIONS PARAMETRISATION:- LO(113)=.TRUE.VARI-137
C  10001-99999     EXTERNAL OPTICAL MODEL (PARAMETERS ABOVE 1000)       VARI-138
C IT STOPS THE CALCULATION FOR AN INDEX OF PARAMETER OUT OF RANGE.      VARI-139
C***********************************************************************VARI-140
      IMPLICIT REAL*8 (A-H,O-Z)                                         VARI-141
      LOGICAL LO(150),LX(9)                                             VARI-142
      DIMENSION NW(2,*),DW(*),R0(8)                                     VARI-143
      COMMON /ADDRE/ NIPH,NJIT,NWV,NIPP,NPAR,NPAA,NSCN,NFIS,NGAM,NNIV,NPVARI-144
     1OT,NBETA,NFM,NTGX,NDONN,NNVI,NDE,NISE,NRC,NIW,NNWI,NCC,MCC,NXA,NAMVARI-145
     21,NFAC,NFG,NXG,NRES,NXX,NT,NIVQ,NIVY,NIVZ,NCOI,MIPI,NXD,MWV,NIXT,NVARI-146
     3TY,NSM,NTX,NRY,NRCO,NRDO,NVC1,NVC2,NNC,NCX                        VARI-147
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   VARI-148
      COMMON /DCHI2/ CHI2,CHI2M,YY(3)                                   VARI-149
      COMMON /INOUT/ MR,MW,MS                                           VARI-150
      COMMON /INTEG/ IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOVARI-151
     1LS,NCOLT,NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,JTVARI-152
     2H,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM(2),VARI-153
     3NCT(6)                                                            VARI-154
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQVARI-155
     1,ACN1,ACN2,AZ(18)                                                 VARI-156
C TRANSFER BETWEEN VARIABLES AND PARAMETERS                             VARI-157
      IF (KF.EQ.1.AND.KE.NE.0) GO TO 36                                 VARI-158
      DO 1 I=111,114                                                    VARI-159
    1 LO(I)=.FALSE.                                                     VARI-160
      DO 2 I=1,9                                                        VARI-161
    2 LX(I)=.FALSE.                                                     VARI-162
      DO 35 I=1,NREC                                                    VARI-163
      J=NW(2-MOD(I,2),NISE+(I-1)/2)                                     VARI-164
      JJ=IABS(J)                                                        VARI-165
      IF (J.NE.JJ) GO TO 3                                              VARI-166
      J1=I                                                              VARI-167
      J2=I                                                              VARI-168
      GO TO 4                                                           VARI-169
    3 J1=JJ+1                                                           VARI-170
      J2=J1+NW(2-MOD(JJ,2),NISE+(JJ-1)/2)-1                             VARI-171
    4 DO 34 K=J1,J2                                                     VARI-172
      J=NW(2-MOD(K,2),NISE+(K-1)/2)                                     VARI-173
      IF ((J.GT.1000).AND.(J.LE.10000)) GO TO 10                        VARI-174
C OPTICAL MODEL AND FOLDING PARAMETERS                                  VARI-175
      IF (J.GT.10000) J=J-9000                                          VARI-176
      IF (LO(7)) GO TO 5                                                VARI-177
      NVAT=42*NPP                                                       VARI-178
      IF (J.GT.NVAT) GO TO 67                                           VARI-179
      IF (MOD(J,42).EQ.25) GO TO 68                                     VARI-180
      GO TO 8                                                           VARI-181
C EXTERNAL OPTICAL PARAMETERS                                           VARI-182
    5 IF (J.GE.NW(2,NPOT+1)) GO TO 69                                   VARI-183
      I1=NW(1,NPOT)-2                                                   VARI-184
      DO 6 L=1,I1                                                       VARI-185
      IF (J.GE.NW(1,NPOT+L).AND.J.LE.NW(2,NPOT+L)) GO TO 7              VARI-186
    6 CONTINUE                                                          VARI-187
      GO TO 70                                                          VARI-188
    7 IF (L.EQ.1) GO TO 8                                               VARI-189
C NOT A FOLDING PARAMETER.                                              VARI-190
      M=NW(1,NPOT+L)                                                    VARI-191
      N=NW(2,NPOT+M-2)                                                  VARI-192
      IV=NW(2,NPOT+N-1)                                                 VARI-193
      IF (IV.GE.1.AND.IV.LE.6) GO TO 8                                  VARI-194
      IF ((IV.LT.0).AND.(J-M.GT.1)) GO TO 71                            VARI-195
      IF ((IV.NE.7).AND.(IV.NE.8)) GO TO 8                              VARI-196
      JY=J                                                              VARI-197
      IF (NW(1,NPOT+NW(2,NPOT+M-2)).NE.1) JY=JY-1                       VARI-198
      IF (M.GT.JY) GO TO 72                                             VARI-199
      IF ((IV.EQ.7).AND.(MOD(JY-M,3).NE.0)) GO TO 73                    VARI-200
      IF ((IV.EQ.8).AND.(MOD(JY+10-M,11).LT.3)) GO TO 74                VARI-201
    8 IF (KF.NE.0) GO TO 9                                              VARI-202
      IF (K.EQ.J1) RAP=DW(NXX+I-1)/DW(NPOT+J-1)                         VARI-203
      DW(NPOT+J-1)=RAP*DW(NPOT+J-1)                                     VARI-204
      GO TO 34                                                          VARI-205
    9 DW(NXX+I-1)=DW(NPOT+J-1)                                          VARI-206
      GO TO 35                                                          VARI-207
   10 J=J-1000                                                          VARI-208
      IF (J.GT.1000) GO TO 15                                           VARI-209
      IF (J.GT.8) GO TO 75                                              VARI-210
C  DEFORMATIONS FOR A GIVEN POTENTIAL                                   VARI-211
      LX(1)=.TRUE.                                                      VARI-212
      DO 11 K1=1,NBET                                                   VARI-213
      IF (LO(1).AND.LO(3).AND.NW(2,NBETA+9*K1-1).NE.0) GO TO 11         VARI-214
      IF (DW(NBETA+9*K1+J-10).NE.0.D0) GO TO 12                         VARI-215
   11 CONTINUE                                                          VARI-216
      GO TO 76                                                          VARI-217
   12 IF (KF.EQ.0) GO TO 13                                             VARI-218
      DW(NXX+I-1)=DW(NBETA+9*K1+J-10)                                   VARI-219
      GO TO 35                                                          VARI-220
   13 IF (K.EQ.J1) RAP=DW(NXX+I-1)/DW(NBETA+9*K1+J-10)                  VARI-221
      DO 14 L=K1,NBET                                                   VARI-222
      IF (LO(1).AND.LO(3).AND.NW(2,NBETA+9*K1-1).NE.0) GO TO 14         VARI-223
      DW(NBETA+9*L+J-10)=DW(NBETA+9*L+J-10)*RAP                         VARI-224
   14 CONTINUE                                                          VARI-225
      GO TO 34                                                          VARI-226
   15 J=J-1000                                                          VARI-227
      IF (J.GT.1000) GO TO 20                                           VARI-228
C DEFORMATIONS FOR A GIVEN MULTIPOLE                                    VARI-229
      IF (J.GT.NBET) GO TO 77                                           VARI-230
      LX(1)=.TRUE.                                                      VARI-231
      DO 16 K1=1,8                                                      VARI-232
      IF (DW(NBETA+9*J+K1-10).NE.0.D0) GO TO 17                         VARI-233
   16 CONTINUE                                                          VARI-234
      GO TO 78                                                          VARI-235
   17 IF (KF.EQ.0) GO TO 18                                             VARI-236
      DW(NXX+I-1)=DW(NBETA+9*J+K1-10)                                   VARI-237
      GO TO 35                                                          VARI-238
   18 IF (K.EQ.J1) RAP=DW(NXX+I-1)/DW(NBETA+9*J+K1-10)                  VARI-239
      DO 19 L=K1,8                                                      VARI-240
   19 DW(NBETA+9*J+L-10)=DW(NBETA+9*J+L-10)*RAP                         VARI-241
      GO TO 34                                                          VARI-242
   20 J=J-1000                                                          VARI-243
      IF (J.GT.1000) GO TO 21                                           VARI-244
C INDIVIDUAL DEFORMATIONS                                               VARI-245
      NBT=10*NBET                                                       VARI-246
      IF (J.GT.NBT) GO TO 79                                            VARI-247
      K1=1+(J-1)/10                                                     VARI-248
      K2=1+MOD(J-1,10)                                                  VARI-249
      IF (K2.GT.8) GO TO 80                                             VARI-250
      LX(1)=.TRUE.                                                      VARI-251
      JK=NBETA+J-1-(J-10)/10                                            VARI-252
      GO TO 32                                                          VARI-253
   21 J=J-1000                                                          VARI-254
      IF (J.GT.1000) GO TO 22                                           VARI-255
C  NUCLEAR PARAMETERS                                                   VARI-256
      IF (J.GT.NVA) GO TO 81                                            VARI-257
      LO(111)=.TRUE.                                                    VARI-258
      JK=NPAA+J-1                                                       VARI-259
      GO TO 32                                                          VARI-260
   22 J=J-1000                                                          VARI-261
      IF (J.GT.1000) GO TO 23                                           VARI-262
C  NUCLEAR MATRIX ELEMENTS                                              VARI-263
      NME=(NIVQ-NT)/3                                                   VARI-264
      IF (J.GT.NME) GO TO 82                                            VARI-265
      LX(2)=.TRUE.                                                      VARI-266
      JK=NT+3*J-1                                                       VARI-267
      GO TO 32                                                          VARI-268
   23 J=J-1000                                                          VARI-269
      IF (J.GT.1000) GO TO 30                                           VARI-270
C  SPIN-ORBIT AND H. F. PARAMETRISATION                                 VARI-271
      IF ((.NOT.LO(81)).AND.(J.GT.6)) GO TO 83                          VARI-272
      IF (J.GT.16) GO TO 27                                             VARI-273
      IF (J.LE.6) GO TO 24                                              VARI-274
      LX(4)=LX(4).OR.(J.LE.11)                                          VARI-275
      LX(5)=LX(5).OR.(J.GT.11)                                          VARI-276
      IF (LO(82).AND.J.GT.9) GO TO 84                                   VARI-277
      IF ((.NOT.LO(86)).AND.(J.GT.11)) GO TO 85                         VARI-278
      IF (LO(82)) GO TO 25                                              VARI-279
      IF ((J.NE.9).AND.(J.LE.11).AND.LO(87)) GO TO 86                   VARI-280
      IF (LO(87)) GO TO 25                                              VARI-281
      IF (J.EQ.7) GO TO 87                                              VARI-282
      IF ((AZ(8).NE.0.D0).AND.(J.GT.8).AND.(J.LE.11)) GO TO 87          VARI-283
      IF ((AZ(8).EQ.0.D0).AND.(J.EQ.8)) GO TO 87                        VARI-284
      GO TO 25                                                          VARI-285
   24 IF (.NOT.LO(4)) GO TO 88                                          VARI-286
      LX(3)=.TRUE.                                                      VARI-287
   25 IF (KF.NE.0) GO TO 26                                             VARI-288
      IF (K.EQ.J1) RAP=DW(NXX+I-1)/AZ(J)                                VARI-289
      AZ(J)=RAP*AZ(J)                                                   VARI-290
      GO TO 34                                                          VARI-291
   26 DW(NXX+I-1)=AZ(J)                                                 VARI-292
      GO TO 35                                                          VARI-293
C LEVEL DENSITY PARAMETERS.                                             VARI-294
   27 J3=J-16                                                           VARI-295
      IF (J3.GT.6*NCONS) GO TO 28                                       VARI-296
      IF (J3.LE.6*(NCONS-NCONT)) LX(6)=.TRUE.                           VARI-297
      IF (J3.GT.6*(NCONS-NCONT)) LX(7)=.TRUE.                           VARI-298
      JK=NSCN+J3-(J3-7)/6                                               VARI-299
      GO TO 32                                                          VARI-300
   28 J3=J3-7*NCONS                                                     VARI-301
      IF (J3.GT.NRD) GO TO 29                                           VARI-302
      LX(8)=.TRUE.                                                      VARI-303
      JK=NGAM+J3-1                                                      VARI-304
      GO TO 32                                                          VARI-305
   29 J3=J3-NRD                                                         VARI-306
      IF (J3.GT.NFISS) GO TO 89                                         VARI-307
      LX(9)=.TRUE.                                                      VARI-308
      JK=NFIS+J-1                                                       VARI-309
      GO TO 32                                                          VARI-310
C DISPERSION PARAMETERS.                                                VARI-311
   30 J=J-1000                                                          VARI-312
      JN=(J-1)/13                                                       VARI-313
      JJ=J-13*JN                                                        VARI-314
      IF (JJ.GT.NPP-1) GO TO 90                                         VARI-315
      IF (NW(2,NIPP+17*JN+2).NE.0) GO TO 91                             VARI-316
      IF ((JJ.LT.6).OR.(JJ.GE.12)) GO TO 31                             VARI-317
      IF ((NW(1,NIPP+17*JN+1).EQ.0).AND.(J.LE.8)) GO TO 92              VARI-318
      IF ((NW(2,NIPP+17*JN+1).EQ.0).AND.(J.GT.8)) GO TO 92              VARI-319
   31 JK=NIPP+2+JJ+3*JN                                                 VARI-320
      LO(113)=.TRUE.                                                    VARI-321
   32 IF (KF.EQ.0) GO TO 33                                             VARI-322
      DW(NXX+I-1)=DW(JK)                                                VARI-323
      GO TO 35                                                          VARI-324
   33 IF (K.EQ.J1) RAP=DW(NXX+I-1)/DW(JK)                               VARI-325
      DW(JK)=RAP*DW(JK)                                                 VARI-326
   34 CONTINUE                                                          VARI-327
   35 CONTINUE                                                          VARI-328
      LO(112)=LX(4).OR.LX(5).OR.LX(6)                                   VARI-329
      LO(114)=LX(7)                                                     VARI-330
   36 IF (KF.EQ.0) GO TO 38                                             VARI-331
      WRITE (MW,1000) NW(1,NIW+1),NW(2,NIW),CHI2,(YY(I),I=1,3)          VARI-332
      WRITE (MW,1001)                                                   VARI-333
      DO 37 I=1,NCOLR                                                   VARI-334
      IF (DW(NTGX+7*I-1).NE.0.D0) WRITE (MW,1002) I,(DW(NTGX+7*I+J-8),J=VARI-335
     13,7)                                                              VARI-336
   37 CONTINUE                                                          VARI-337
      WRITE (MW,1003) (I,DW(NXX+I-1),I=1,NREC)                          VARI-338
      IF (LO(78)) WRITE (MW,1004) (I,DW(NRES+I-1),I=1,NTOT)             VARI-339
      RETURN                                                            VARI-340
   38 IF (KE.EQ.1) RETURN                                               VARI-341
C PRINTING OF RESULTS.                                                  VARI-342
      WRITE (MW,1005) NW(1,NIW+1),NW(2,NIW),CHI2,KE,YY(1)               VARI-343
      IF (KE*(KE-3).NE.0.OR.DW(NRC).LE.0.D0) GO TO 40                   VARI-344
      WRITE (MW,1006) NW(2,NIW+1),YY(3),(DW(NRC+I-1),I=1,NREC)          VARI-345
      WRITE (MW,1007) (DW(NRC+NREC+I-1),I=1,NREC)                       VARI-346
      WRITE (MW,1008)                                                   VARI-347
      L=2*NREC+NRC-1                                                    VARI-348
      DO 39 I=1,NREC                                                    VARI-349
      K=L+1                                                             VARI-350
      L=L+I                                                             VARI-351
   39 WRITE (MW,1009) (DW(J),J=K,L)                                     VARI-352
      GO TO 41                                                          VARI-353
   40 WRITE (MW,1010)                                                   VARI-354
   41 IF (KE.EQ.0) WRITE (MW,1011)                                      VARI-355
      IF (KE.EQ.2) WRITE (MW,1012)                                      VARI-356
      IF (KE.EQ.3) WRITE (MW,1013)                                      VARI-357
      IF (KE.EQ.4) WRITE (MW,1014)                                      VARI-358
      IF (KE.EQ.5) WRITE (MW,1015) NW(2,NIW+1)                          VARI-359
      IF (KE.EQ.6) WRITE (MW,1016) NW(1,NIW+1),NW(2,NIW+1)              VARI-360
      IF (KE.EQ.7) WRITE (MW,1017) NTOT,NREC                            VARI-361
C END OF THE SEARCH                                                     VARI-362
      LO(116)=.FALSE.                                                   VARI-363
      LO(118)=.TRUE.                                                    VARI-364
      IF (LO(76)) GO TO 43                                              VARI-365
      DO 42 I=51,65                                                     VARI-366
   42 LO(I)=LO(I+85)                                                    VARI-367
   43 LO(120)=.NOT.(LO(53).OR.LO(55).OR.LO(56).OR.LO(57).OR.LO(58).OR.LOVARI-368
     1(60).OR.LO(62).OR.LO(64))                                         VARI-369
      IF (LO(41)) LO(120)=LO(120).AND.(.NOT.LO(65))                     VARI-370
      LO(119)=LO(120).AND.(.NOT.(LO(51).OR.LO(64).OR.LO(65)))           VARI-371
      LO(120)=CHI2.EQ.CHI2M.AND.LO(120)                                 VARI-372
C OUTPUT OF FINAL PARAMETERS                                            VARI-373
      WRITE (MW,1018) (LO(J),J=1,100)                                   VARI-374
      IF (LO(7)) GO TO 46                                               VARI-375
      NPO=NPOT-1                                                        VARI-376
C OUTPUT OF USUAL POTENTIALS.                                           VARI-377
      DO 45 J=1,NPP                                                     VARI-378
      IJ=IABS(NW(1,NIPP+15*J-15))                                       VARI-379
      AM3=DW(NWV+18*IJ-17)**.33333333333333D0                           VARI-380
      IF (LO(16)) AM3=AM3+DW(NWV+18*IJ-18)**.33333333333333D0           VARI-381
      WRITE (MW,1019) J,AM3                                             VARI-382
      DO 44 I=1,8                                                       VARI-383
   44 R0(I)=DW(NPO+4*I-2)/AM3                                           VARI-384
      WRITE (MW,1020) (DW(NPO+4*I-3),DW(NPO+4*I-2),R0(I),DW(NPO+4*I-1),DVARI-385
     1W(NPO+4*I),I=1,8),DW(NPO+33)                                      VARI-386
      IF (LO(17)) WRITE (MW,1021) (DW(NPO+I),I=34,42)                   VARI-387
   45 NPO=NPO+1                                                         VARI-388
      GO TO 58                                                          VARI-389
C OUTPUT OF EXTERNAL POTENTIALS.                                        VARI-390
   46 NVMA=NW(1,NPOT)                                                   VARI-391
      WRITE (MW,1022)                                                   VARI-392
   47 IF (NVMA.GE.NW(1,NPOT+1)) GO TO 57                                VARI-393
      I1=NW(1,NVMA+NPOT-1)                                              VARI-394
      IV=NW(2,NVMA+NPOT-1)                                              VARI-395
      IF (IV.EQ.16) GO TO 56                                            VARI-396
      IT1=MOD(I1-1,8)+1                                                 VARI-397
      J1=(I1-1)/8                                                       VARI-398
      I2=NW(1,NPOT+I1-7)                                                VARI-399
      I3=NW(2,NPOT+I1-7)                                                VARI-400
      IF (IV.GE.0) GO TO 48                                             VARI-401
      WRITE (MW,1023) IT1,J1,I2,I3,DW(NPOT+I2-1),DW(NPOT+I2)            VARI-402
      GO TO 56                                                          VARI-403
   48 IF (IV.LT.9) GO TO 49                                             VARI-404
      WRITE (MW,1024) IT1,J1,IV,I2,I3,(DW(NPOT+I-1),I=I2,I3)            VARI-405
      GO TO 56                                                          VARI-406
   49 IF (IV.GT.6) GO TO 55                                             VARI-407
      WRITE (MW,1025) IT1,J1,IV,I2,I3,(DW(NPOT+I-1),I=I2,I3)            VARI-408
      NST=NW(1,NPOT+NVMA+1)                                             VARI-409
      IF (NST.GT.0) GO TO 52                                            VARI-410
      K=IABS(NST)                                                       VARI-411
      EX=DW(NWV+18*K-17)**.33333333333333D0                             VARI-412
      EY=EX                                                             VARI-413
      IF (LO(16)) EX=EX+DW(NWV+18*K-18)**.33333333333333D0              VARI-414
      EY=EY/EX                                                          VARI-415
      EX=DW(NPOT+I2)/EX                                                 VARI-416
      EZ=DW(NPOT+I2-1)                                                  VARI-417
      IF ((.NOT.LO(16)).OR.J1.LE.NPP) GO TO 51                          VARI-418
      ITYZ=IV                                                           VARI-419
      IF (ITYZ.GE.5) ITYZ=ITYZ-4                                        VARI-420
      ITYW=1                                                            VARI-421
      IF (IT1.LE.6) GO TO 50                                            VARI-422
      ITI=7*(J1-NPP)                                                    VARI-423
      ITYW=ITYW*NW(2-MOD(ITI,2),NIVY+(ITI-1)/2)                         VARI-424
   50 IF (LO(6)) ITYW=ITYW-1                                            VARI-425
      IF (ITYZ.GT.1) EZ=EZ/EY**((ITYZ-1)*ITYW)                          VARI-426
   51 WRITE (MW,1026) EZ,EX                                             VARI-427
   52 IF ((IV.NE.5).AND.(IV.NE.6)) GO TO 56                             VARI-428
      WRITE (MW,1027) I2,I3,(DW(NPOT+I-1),I=I2,I3)                      VARI-429
      IF (NST.GT.0) GO TO 56                                            VARI-430
      WRITE (MW,1028)                                                   VARI-431
      NMB=0                                                             VARI-432
   53 NMA=I2                                                            VARI-433
      I4=I2+7                                                           VARI-434
      DO 54 I=I2,I4                                                     VARI-435
      NMB=NMB+1                                                         VARI-436
      J=I-NMA                                                           VARI-437
      IF (IT1.LT.7) J=0                                                 VARI-438
      IF (.NOT.LO(6)) J=J+1                                             VARI-439
   54 R0(NMB)=DW(NPOT+I-1)/EY**J                                        VARI-440
      WRITE (MW,1009) (R0(I),I=1,NMB)                                   VARI-441
      I2=I2+8                                                           VARI-442
      IF (I2.LE.I3) GO TO 53                                            VARI-443
      GO TO 56                                                          VARI-444
   55 WRITE (MW,1025) IT1,J1,IV,I2,I3,(DW(NPOT+I-1),I=I2,I3)            VARI-445
   56 NVMA=I3+1                                                         VARI-446
      GO TO 47                                                          VARI-447
   57 NVMB=NW(2,NPOT+1)                                                 VARI-448
      IF (NVMA.LT.NVMB) WRITE (MW,1029) (DW(NPOT+I-1),I=NVMA,NVMB)      VARI-449
   58 IF (.NOT.LX(1)) GO TO 66                                          VARI-450
C OUTPUT OF DEFORMATIONS.                                               VARI-451
      WRITE (MW,1030) (I,NW(1,NBETA+9*I-1),NW(2,NBETA+9*I-1),(DW(NBETA+9VARI-452
     1*I+J-10),J=1,8),I=1,NBET)                                         VARI-453
      IF (.NOT.LO(16)) GO TO 66                                         VARI-454
      DM=DW(NWV+1)**.33333333333333D0/(DW(NWV)**.33333333333333D0+DW(NWVVARI-455
     1+1)**.33333333333333D0)                                           VARI-456
      WRITE (MW,1031)                                                   VARI-457
      DO 65 I=1,NBET                                                    VARI-458
      K1=0                                                              VARI-459
      K2=0                                                              VARI-460
      IF (LO(3)) GO TO 60                                               VARI-461
   59 K1=1                                                              VARI-462
      K2=NW(1,NBETA+9*I-1)                                              VARI-463
      GO TO 62                                                          VARI-464
   60 IF (LO(1)) GO TO 61                                               VARI-465
      K1=I-1                                                            VARI-466
      K2=K1*NW(1,NBETA+9*I-1)                                           VARI-467
      GO TO 62                                                          VARI-468
   61 IF (NW(2,NBETA+9*I-1).EQ.0) GO TO 59                              VARI-469
   62 IF (.NOT.LO(6)) GO TO 63                                          VARI-470
      K2=K2-K1                                                          VARI-471
      K1=0                                                              VARI-472
   63 DO 64 J=1,6                                                       VARI-473
   64 R0(J)=DW(NBETA+9*I+J-10)/DM**K1                                   VARI-474
      R0(7)=DW(NBETA+9*I-3)/DM**K2                                      VARI-475
      R0(8)=DW(NBETA+9*I-2)/DM**K2                                      VARI-476
   65 WRITE (MW,1032) I,NW(1,NBETA+9*I-1),NW(2,NBETA+9*I-1),R0          VARI-477
C OUTPUT OF OTHER PARAMETERS IN SEARCH                                  VARI-478
   66 IF (LO(111)) WRITE (MW,1033) (DW(NPAA+J-1),I=1,NVA)               VARI-479
      IF (LX(2)) WRITE (MW,1034) (DW(I+2),I=NT,NIVQ,3)                  VARI-480
      IF (LX(3)) WRITE (MW,1035) (AZ(I),I=1,6)                          VARI-481
      IF (LX(4)) WRITE (MW,1036) (AZ(I),I=7,11)                         VARI-482
      IF (LX(5)) WRITE (MW,1037) (AZ(I),I=12,16)                        VARI-483
      IF (LX(6)) WRITE (MW,1038) (I,(DW(NSCN+7*I+J-8),J=1,7),I=1,1)     VARI-484
      IF (LX(7)) WRITE (MW,1038) (I,(DW(NSCN+7*I+J-8),J=1,7),I=1+NCONS-NVARI-485
     1CONT,NCONS)                                                       VARI-486
      IF (LX(8)) WRITE (MW,1039) (I,DW(NGAM+I-1),I=1,NRD)               VARI-487
      IF (LX(9)) WRITE (MW,1040) (I,(DW(NFIS+2*I+J-3),J=1,2),I=1,NFISS) VARI-488
      IF (LO(113)) WRITE (MW,1041) (I,(DW(NIPP+15*I+J-16),J=4,16),I=1,NPVARI-489
     1P)                                                                VARI-490
      RETURN                                                            VARI-491
   67 WRITE (MW,1042) NVAT                                              VARI-492
      GO TO 93                                                          VARI-493
   68 WRITE (MW,1043)                                                   VARI-494
      GO TO 93                                                          VARI-495
   69 WRITE (MW,1044) NW(2,NPOT+1)                                      VARI-496
      GO TO 93                                                          VARI-497
   70 WRITE (MW,1045) I,J,(NW(1,NPOT+L),NW(2,NPOT+L),L=1,I1)            VARI-498
      GO TO 93                                                          VARI-499
   71 WRITE (MW,1046)                                                   VARI-500
      GO TO 93                                                          VARI-501
   72 WRITE (MW,1047)                                                   VARI-502
      GO TO 93                                                          VARI-503
   73 WRITE (MW,1048)                                                   VARI-504
      GO TO 93                                                          VARI-505
   74 WRITE (MW,1049)                                                   VARI-506
      GO TO 93                                                          VARI-507
   75 WRITE (MW,1050)                                                   VARI-508
      GO TO 93                                                          VARI-509
   76 WRITE (MW,1051) I,NW(2-MOD(K,2),NISE+(K-1)/2),J                   VARI-510
      GO TO 93                                                          VARI-511
   77 WRITE (MW,1052) NBET                                              VARI-512
      GO TO 93                                                          VARI-513
   78 WRITE (MW,1053) I,NW(2-MOD(K,2),NISE+(K-1)/2),J                   VARI-514
      GO TO 93                                                          VARI-515
   79 WRITE (MW,1054) NBT                                               VARI-516
      GO TO 93                                                          VARI-517
   80 WRITE (MW,1055)                                                   VARI-518
      GO TO 93                                                          VARI-519
   81 WRITE (MW,1056) NVA                                               VARI-520
      GO TO 93                                                          VARI-521
   82 WRITE (MW,1057) NME                                               VARI-522
      GO TO 93                                                          VARI-523
   83 WRITE (MW,1058)                                                   VARI-524
      GO TO 93                                                          VARI-525
   84 WRITE (MW,1059)                                                   VARI-526
      GO TO 93                                                          VARI-527
   85 WRITE (MW,1060)                                                   VARI-528
      GO TO 93                                                          VARI-529
   86 WRITE (MW,1061)                                                   VARI-530
      GO TO 93                                                          VARI-531
   87 WRITE (MW,1062)                                                   VARI-532
      GO TO 93                                                          VARI-533
   88 WRITE (MW,1063)                                                   VARI-534
      GO TO 93                                                          VARI-535
   89 WRITE (MW,1064)                                                   VARI-536
      GO TO 93                                                          VARI-537
   90 WRITE (MW,1065) NPP                                               VARI-538
      GO TO 93                                                          VARI-539
   91 WRITE (MW,1066)                                                   VARI-540
      GO TO 93                                                          VARI-541
   92 WRITE (MW,1067)                                                   VARI-542
   93 WRITE (MW,1068) I,NW(2-MOD(K,2),NISE+(K-1)/2),J                   VARI-543
      STOP                                                              VARI-544
 1000 FORMAT (/' RUN',I4,'   MAX =',I4,'   ***** CHI2 =',D18.10,' *****'VARI-545
     1,5X,'W(1) =',F10.2,5X,'W(2) =',F5.2,5X,'W(3) =',F10.5)            VARI-546
 1001 FORMAT (/21X,'WEIGHT',12X,'EXP. NORM.',10X,'ERR. NORM.',10X,'CALC.VARI-547
     1 NORM.',12X,'CHI2')                                               VARI-548
 1002 FORMAT (5X,I5,1P,5D20.6)                                          VARI-549
 1003 FORMAT (/' *** VARIABLES'//(6(1X,I3,1P,D16.6)))                   VARI-550
 1004 FORMAT (/' *** FUNCTIONS'//(6(1X,I3,1P,D16.6)))                   VARI-551
 1005 FORMAT (/' RUN',I4,'   MAX =',I4,'   ***** CHI2 =',D18.10,' *****'VARI-552
     1,5X,'KE =',I2,5X,'W(1) =',F12.4)                                  VARI-553
 1006 FORMAT (//' STANDARD ERRORS (VARIANCE AT BEST FIT EQUAL TO DEGREE VARI-554
     1OF FREEDOM:',I6,'.RENORMALISATION FACTOR',D15.6,' )'/(1P,8D15.6)) VARI-555
 1007 FORMAT (/' ERROR ENHANCEMENTS (MULTI/SINGLE VARIABLE ERROR)'/(1P,8VARI-556
     1D15.6))                                                           VARI-557
 1008 FORMAT (/' ERROR CORRELATION MATRIX:')                            VARI-558
 1009 FORMAT (1P,8D15.6)                                                VARI-559
 1010 FORMAT (//' NO INFORMATION ON ERRORS.')                           VARI-560
 1011 FORMAT (//' SEARCH ENDED WITHOUT ERRORS.')                        VARI-561
 1012 FORMAT (//' SEARCH INTERRUPTED BY USER.')                         VARI-562
 1013 FORMAT (//' SEARCH ENDED BY NUMBER OF EVALUATIONS.')              VARI-563
 1014 FORMAT (//' SEARCH ENDED FOR ROUNDING ERRORS.')                   VARI-564
 1015 FORMAT (//' SEARCH ENDED BECAUSE THE FUNCTIONS DO NOT DEPEND ON THVARI-565
     1E VARIABLE',I6)                                                   VARI-566
 1016 FORMAT (//' SEARCH ENDED BECAUSE VARIABLES',2I6,' ARE USELESS IN PVARI-567
     1REPARATORY CALLS.')                                               VARI-568
 1017 FORMAT (//' SEARCH ENDED BECAUSE THE NUMBER OF PARAMETERS',I4,' ISVARI-569
     1 LARGER THAN THE NUMBER OF DATA',I4)                              VARI-570
 1018 FORMAT ('1'/' ******* FINAL RESULTS *******'//' **** FIRST CONTROLVARI-571
     1 CARD ****',2X,'1 ',9(' 1'),' 2 ',9(' 2'),' 3 ',9(' 3'),' 4 ',9(' VARI-572
     24'),' 5'/11X,5('  1 2 3 4 5 6 7 8 9 0')/11X,5(1X,10L2)//' *** SECOVARI-573
     3ND CONTROL CARD ****',2X,'1 ',9(' 1'),' 2 ',9(' 2'),' 3 ',9(' 3'),VARI-574
     4' 4 ',9(' 4'),' 5'/11X,5('  1 2 3 4 5 6 7 8 9 0')/11X,5(1X,10L2)/)VARI-575
 1019 FORMAT (/' OPTICAL POTENTIALS  **',I3,' **     REDUCED RADIUS MULTVARI-576
     1IPLIED BY  ',D15.6/)                                              VARI-577
 1020 FORMAT (' VOLUME/SCALAR REAL POTENTIAL'/' DEPTH',F12.6,' MEV   RADVARI-578
     1IUS',F10.6,' FERMI (REDUCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FVARI-579
     2ERMI AT THE POWER (1+',F9.6,')'/' VOLUME/SCALAR IMAGINARY POTENTIAVARI-580
     3L'/' DEPTH',F12.6,' MEV   RADIUS',F10.6,' FERMI (REDUCED VALUE',F9VARI-581
     4.6,')   DIFFUSENESS',F9.6,' FERMI AT THE POWER (1+',F9.6,')'/' SURVARI-582
     5FACE/VECTOR REAL POTENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',F10.6,'VARI-583
     6 FERMI (REDUCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FERMI AT THE VARI-584
     7POWER (1+',F9.6,')'/' SURFACE/VECTOR IMAGINARY POTENTIAL'/' DEPTH'VARI-585
     8,F12.6,' MEV   RADIUS',F10.6,' FERMI (REDUCED VALUE',F9.6,')   DIFVARI-586
     9FUSENESS',F9.6,' FERMI AT THE POWER (1+',F9.6,')'/' REAL SPIN-ORBIVARI-587
     AT/TENSOR POTENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',F10.6,' FERMI (VARI-588
     BREDUCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FERMI AT THE POWER (1VARI-589
     C+',F9.6,')'/' IMAGINARY SPIN-ORBIT/TENSOR POTENTIAL'/' DEPTH',F12.VARI-590
     D6,' MEV   RADIUS',F10.6,' FERMI (REDUCED VALUE',F9.6,')   DIFFUSENVARI-591
     EESS',F9.6,' FERMI AT THE POWER (1+',F9.6,')'/' COULOMB POTENTIAL'/VARI-592
     F'  CHARGE PRODUCT',F7.0,'  RADIUS',F10.6,' FERMI (REDUCED VALUE',FVARI-593
     G9.6,')   DIFFUSENESS',F9.6,' FERMI AT THE POWER (1+',F9.6,')'/' SPVARI-594
     HIN-ORBIT COULOMB POTENTIAL'/' DEPTH',F12.6,' MEV   RADIUS',F10.6,'VARI-595
     I FERMI (REDUCED VALUE',F9.6,')   DIFFUSENESS',F9.6,' FERMI AT THE VARI-596
     JPOWER (1+',F9.6,')'/14X,'THIRD CHARGE PARAMETER',F9.6)            VARI-597
 1021 FORMAT (/' *** FOLDING MODEL ***'/' REAL PART',10X,'V =',F10.4,6X,VARI-598
     1'R =',F10.4,6X,'A =',F10.4/' IMAGINARY PART',6X,'V =', F10.4,6X,'RVARI-599
     2 =',F10.4,6X,'A =',F10.4/' COULOMB PART',7X,'V =',F10.4,6X,'R =',FVARI-600
     310.4,6X,'A =',F10.4)                                              VARI-601
 1022 FORMAT (/' **** EXTERNAL POTENTIAL PARAMETERS ****'/)             VARI-602
 1023 FORMAT (' (',I1,',',I2,') GIVEN BY POINTS WITH THE PARAMETERS FROMVARI-603
     1',I4,' TO',I4/' STRENGTH =',1P,D15.6,19X,'SCALE =',D15.6)         VARI-604
 1024 FORMAT (' (',I1,',',I2,') TYPE',I3,' FROM',I4,' TO',I4/1P,2D15.6/(VARI-605
     11P,8D15.6))                                                       VARI-606
 1025 FORMAT (' (',I1,',',I2,') TYPE',I3,' FROM',I4,' TO',I4,4X,6D14.6/(VARI-607
     17X,8D14.6))                                                       VARI-608
 1026 FORMAT (' VALUES READ:',F12.6,3X,F9.6)                            VARI-609
 1027 FORMAT (' DEFORMATIONS: PARAMETERS FROM',I4,' TO ',I4,10X,4D18.6/(VARI-610
     152X,4D18.6))                                                      VARI-611
 1028 FORMAT (' DEFORMATIONS READ:')                                    VARI-612
 1029 FORMAT (' FOLDING PARAMETERS:',3F10.5/(20X,3F10.5))               VARI-613
 1030 FORMAT (/' BETA(I,J) FOR  L   K',9X,'V',9X,'W',8X,'VS',8X,'WS',7X,VARI-614
     1'VSO',7X,'WSO',6X,'COUL S.O. COUL'/(5X,I5,5X,I2,2X,I2,2X,8F10.5)) VARI-615
 1031 FORMAT (/10X,'WITHOUT HEAVY ION CORRECTION:'/)                    VARI-616
 1032 FORMAT (5X,I5,5X,I2,2X,I2,2X,8F10.5)                              VARI-617
 1033 FORMAT (/' *** NUCLEAR VARIABLES ***'//(1X,6F20.6))               VARI-618
 1034 FORMAT (/' *** NUCLEAR MATRIX ELEMENTS ***'//(1X,6F20.6))         VARI-619
 1035 FORMAT (/' *** SPIN-ORBIT PARAMETRISATION ***'//1X,6F20.6/)       VARI-620
 1036 FORMAT (/' *** HAUSER-FESHBACH CORRECTIONS ***'//1X,5F20.6/)      VARI-621
 1037 FORMAT (/' *** GIANT DIPOLE RESONANCE PARAM. ***'//1X,5F20.6/)    VARI-622
 1038 FORMAT (/' *** DENSITY OF STATES ***'//(1X,I3,'  SA:',D13.6,6X,'UXVARI-623
     1:',D13.6,5X,'TAU:',D13.6,6X,'SG:',D13.6/28X,'E0:',D13.6,6X,'EX:',DVARI-624
     213.6,7X,'Z:',F5.0))                                               VARI-625
 1039 FORMAT (/' *** GAMMA TRANSMISSION COEFFICIENTS ***'//(1X,4(I5,F20.VARI-626
     16)))                                                              VARI-627
 1040 FORMAT (/' *** FISSION DATA ***'//(1X,2(I5,2F20.6)))              VARI-628
 1041 FORMAT (/' *** DISPERSION RELATION PARAMETERS ***'//(' POTENTIAL',VARI-629
     1I5/1X,6F20.6/1X,6F20.6/1X,F20.6))                                 VARI-630
 1042 FORMAT (' NO OPTICAL PARAMETER INDEX LARGER THAN',I3)             VARI-631
 1043 FORMAT (' NO CHANGE OF COULOMB CHARGES.')                         VARI-632
 1044 FORMAT (' NO EXTERNAL OPTICAL PARAMETER LARGER THAN',I5)          VARI-633
 1045 FORMAT (' VARIABLE',I3,' DEFINED BY',I5,' CANNOT BE USED.'/' THE PVARI-634
     1ARAMETER WHICH CAN BE SEARCHED ARE BETWEEN:'/(4(5X,I6,' TO',I6))) VARI-635
 1046 FORMAT (' FOR A FORM FACTOR GIVEN BY POINTS, THE TWO MULTIPLICATIVVARI-636
     1E FACTOR ONLY CAN BE CHANGED.')                                   VARI-637
 1047 FORMAT (' THE COUPLING OF TWO PARTICLE STATES CANNOT BE CHANGED.')VARI-638
 1048 FORMAT (' ONLY THE OSCILLATOR PARAMETER CAN BE CHANGED FOR A LAGUEVARI-639
     1RRE POLYNOMIAL.')                                                 VARI-640
 1049 FORMAT (' MASSES AND PRODUCT OF CHARGES CANNOT BE CHANGED FOR A SIVARI-641
     1NGLE PARTICLE STATE.')                                            VARI-642
 1050 FORMAT (' NO INDEX FOR DEFORMATION OF A GIVEN POTENTIAL LARGER THAVARI-643
     1N 8.')                                                            VARI-644
 1051 FORMAT (' THE VARIABLE',I3,' CANNOT BE USED BECAUSE ',I5,'  IS A VVARI-645
     1ARIATION OF THE DEFORMATIONS OF POTENTIAL',I3,' WHICH ARE ZERO.') VARI-646
 1052 FORMAT (' NO INDEX FOR MULTIPOLE LARGER THAN',I3)                 VARI-647
 1053 FORMAT (' THE VARIABLE',I3,' CANNOT BE USED BECAUSE ',I5,'  IS A VVARI-648
     1ARIATION FOR A GIVEN MULTIPOLE',I3,' AND THEY ARE ZERO.')         VARI-649
 1054 FORMAT (' NO INDEX FOR INDIVIDUAL MULTIPOLE LARGER THAN',I3)      VARI-650
 1055 FORMAT (' NO INDEX FOR INDIVIDUAL MULTIPOLE EQUAL TO 0 OR 9 MODULOVARI-651
     1 10.')                                                            VARI-652
 1056 FORMAT (' NO INDEX FOR NUCLEAR PARAMETER LARGER THAN',I3)         VARI-653
 1057 FORMAT (' NO INDEX FOR NUCLEAR MATRIX ELEMENT LARGER THAN',I3)    VARI-654
 1058 FORMAT (' NO HAUSER-FESHBACH CORRECTIONS.')                       VARI-655
 1059 FORMAT (' PARAMETER NOT USED FOR SIMPLIFIED COMPOUND NUCLEUS.')   VARI-656
 1060 FORMAT (' NO GAMMA EMISSION IN COMPOUND NUCLEUS.')                VARI-657
 1061 FORMAT (' NO WIDTH FLUCTUATION IN COMPOUND NUCLEUS.')             VARI-658
 1062 FORMAT (' PARAMETER NOT USED IN THIS KIND OF COMPOUND NUCLEUS.')  VARI-659
 1063 FORMAT (' NO PARAMETRISATION OF SOIN-ORBIT DEFORMATION.')         VARI-660
 1064 FORMAT (' THIS LEVEL DENSITY PARAMETER IS NOT USED.')             VARI-661
 1065 FORMAT (' THERE ARE ONLY',I3,' SETS OF DISPERSION PARAMETERS.')   VARI-662
 1066 FORMAT (' THE COEFFICIENTS OF THIS DISPERSION RELATION SHOULD BE RVARI-663
     1EAD EACH TIME AND CANNOT BE IN SEARCH.')                          VARI-664
 1067 FORMAT (' THIS COEFFICIENT OF DISPERSION RELATION IS NOT USED.')  VARI-665
 1068 FORMAT (' VARIABLE',I3,' DEFINED BY',I5,I4,' CANNOT BE USED.'///' VARI-666
     1IN VARI  ...  STOP  ...')                                         VARI-667
      END                                                               VARI-668
C 29/10/06                                                      ECIS06  EVAL-000
      SUBROUTINE EVAL(NW,DW,CM,LO)                                      EVAL-001
C THIS SUBROUTINE CHANGES SOME PARAMETERS TO DO A NEW CALCULATION.      EVAL-002
C THE VALUES READ HERE ARE ABSOLUTE CHANGES ( NEX=0 ),                  EVAL-003
C RELATIVE CHANGES ( NEX>0 ) OR PERCENTAGES ( NEX<0 ).                  EVAL-004
C IF THE LABORATORY ENERGY IS CHANGED, COULOMB FUNCTIONS AND REDUCED    EVAL-005
C NUCLEAR MATRIX ELEMENTS ARE RECALCULATED EVEN IF THEY ARE NOT MODIFIEDEVAL-006
C IF NUCLEAR PARAMETERS ARE CHANGED, REDUCED NUCLEAR MATRIX ELEMENTS AREEVAL-007
C CALCULATED AGAIN. IN ALL THE OTHERS CASES, THE COMPUTATION RESTARTS   EVAL-008
C WITH THE COMPUTATION OF POTENTIALS.                                   EVAL-009
C INDEXES FOR PARAMETERS ARE THE ONES USED IN SEARCH (SEE VARI).        EVAL-010
C HOWEVER 0 MEANS ENERGY IN THE LABORATORY SYSTEM.                      EVAL-011
C INPUT:     NW:      WORKING AREA FOR INTEGERS.                        EVAL-012
C            DW:      WORKING AREA FOR DOUBLE PRECISION IN EQUIVALENCE  EVAL-013
C                     BY CALL WITH NW.                                  EVAL-014
C            CM:      NUCLEAR MASS.                                     EVAL-015
C            LO:      LOGICAL CONTROLS:                                 EVAL-016
C               LO(1)  =.TRUE. ROTATIONAL MODEL-(.F.:VIBRATIONAL MODEL).EVAL-017
C               LO(3)  =.TRUE. ANHARMONIC VIBRATIONAL OR ASYMMETRIC     EVAL-018
C                              ROTATIONAL MODEL.                        EVAL-019
C               LO(4)  =.TRUE. PARAMETRISED SPIN-ORBIT DEFORMATION.     EVAL-020
C               LO(6)  =.TRUE. USE DEFORMATION LENGTHS.                 EVAL-021
C               LO(7)  =.TRUE. MATRIX ELEMENT AND FORM FACTORS READ.    EVAL-022
C               LO(8)  =.TRUE. RELATIVISTIC KINEMATICS.                 EVAL-023
C               LO(16) =.TRUE. HEAVY-ION DEFINITION OF REDUCED RADII ANDEVAL-024
C                              DEFORMATIONS.                            EVAL-025
C               LO(32) =.TRUE. AUTOMATIC SEARCH ON SOME PARAMETERS.     EVAL-026
C               LO(34) =.TRUE. NEXT CALCULATION CHANGING ENERGY AND/OR  EVAL-027
C                              SOME PARAMETERS.                         EVAL-028
C               LO(75) =.TRUE. NO COMPLETE OUTPUT AT THE FIRST RUN OF A EVAL-029
C                              SEARCH.                                  EVAL-030
C               LO(76) =.TRUE. LO(51) TO LO(65) ARE ALWAYS USED.        EVAL-031
C               LO(81) =.TRUE. HAUSER-FESHBACH CORRECTIONS.             EVAL-032
C               LO(82) =.TRUE. OLD SIMPLIFIED COMPOUND NUCLEUS.         EVAL-033
C               LO(86) =.TRUE. GAMMA EMISSION IN COMPOUND NUCLEUS.      EVAL-034
C               LO(87) =.TRUE. NO WIDTH FLUCTUATIONS.                   EVAL-035
C               LO(111)=.TRUE. NUCLEAR PARAMETERS ARE CHANGED IN SEARCH.EVAL-036
C               LO(112)=.TRUE. SPIN-ORBIT OR COMPOUND NUCLEUS PARAMETERSEVAL-037
C                              ARE CHANGED IN SEARCH.                   EVAL-038
C               LO(113)=.TRUE. DISPERSION RELATION IS CHANGED IN SEARCH.EVAL-039
C               LO(114)=.TRUE. COMPOUND NUCLEUS CONTINUUM IS CHANGED IN EVAL-040
C                              SEARCH.                                  EVAL-041
C               LO(115)=.TRUE. FIRST COMPUTATION FOR THIS ENERGY.       EVAL-042
C               LO(116)=.TRUE. NO OUTPUT.                               EVAL-043
C                                                                       EVAL-044
C FOR THE COMMON  /ADDRE/, /COUPL/, /INTEG/ AND /TITRE/ SEE CALC.       EVAL-045
C FOR THE COMMON  /DCHI2/, AND /NCOMP/ SEE CALX.                        EVAL-046
C                                                                       EVAL-047
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /ADDRE/:                     EVAL-048
C  NWV:       NON INTEGER VALUES FOR THE CHANNELS.                      EVAL-049
C  NIPP:      DISPERSION PARAMETERS.                                    EVAL-050
C  NSCN:      LEVEL DENSITY DESCRIPTION.                                EVAL-051
C  NPOT:      OPTICAL POTENTIAL PARAMETERS.                             EVAL-052
C  NBETA:     DEFORMATION PARAMETERS.                                   EVAL-053
C  NIW:       INTEGER WORKING FIELD FOR THE SEARCH.                     EVAL-054
C  NT:        TABLE OF REDUCED NUCLEAR MATRIX ELEMENTS.                 EVAL-055
C  NIVQ:      TABLE OF MULTIPOLES.                                      EVAL-056
C  NIVY:      TABLE OF FORM FACTOR IDENTIFICATION IVY (FOR COMPUTATION).EVAL-057
C  NCX:       FIRST FREE ADDRESS FOR COMPUTATION OF POTENTIALS.         EVAL-058
C             HERE, FIRST FREE ADDRESS FOR INPUT.                       EVAL-059
C   USED:     NWV,NIPP,NSCN,NPOT,NBETA,NIW,NT,NIVQ,NIVY,NCX.            EVAL-060
C                                                                       EVAL-061
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /COUPL/:                     EVAL-062
C  NPP:       NUMBER OF OPTICAL POTENTIALS.                             EVAL-063
C  NVA:       NUMBER OF NUCLEAR PARAMETERS.                             EVAL-064
C   USED:     NPP,NVA.                                                  EVAL-065
C                                                                       EVAL-066
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCHI2/:                     EVAL-067
C  CHI2M:     MINIMUM CHI-SQUARE IN THE SEARCH.                         EVAL-068
C  YY(1):     STEP SIZE IN THE SEARCH.                                  EVAL-069
C  YY(3):     VARIOUS MEANINGS.  SEE FITE.                              EVAL-070
C   DEFINED:  CHI2M,YY.                                                 EVAL-071
C                                                                       EVAL-072
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /INTEG/:                     EVAL-073
C  IDMT:      TOTAL WORKING FIELD LENGTH AS SINGLE PRECISION.           EVAL-074
C  NBET:      NUMBER OF DIFFERENT DEFORMATIONS (VIBRATIONS+ROTATIONS).  EVAL-075
C   USED:     IDMT,NBET.                                                EVAL-076
C                                                                       EVAL-077
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /NCOMP/:                     EVAL-078
C  NFISS:     NUMBER OF FISSION TRANSMISSION COEFFICIENTS.              EVAL-079
C  NRD:       NUMBER OF GAMMA TRANSMISSION COEFFICIENTS.                EVAL-080
C  NCONT:     NUMBER OF CONTINUUM FOR COMPOUND NUCLEUS.                 EVAL-081
C  NCONS:     NUMBER OF LEVEL DENSITIES NEEDED.                         EVAL-082
C  NCOLX:     TOTAL NUMBER OF LEVELS WITHOUT DISCRETISATION.            EVAL-083
C  AZ(I):     SPIN-ORBIT PARAMETRISATION FOR I-1 TO 6,                  EVAL-084
C             HAUSER FESHBACH PARAMETERS FOR J=7 TO 11,                 EVAL-085
C             GIANT DIPOLE RESONANCE FOR I=12 TO 16.                    EVAL-086
C   DEFINED:  AZ.                                                       EVAL-087
C   USED:     NFISS,NRD,NCONT,NCONS,NCOLX,AZ.                           EVAL-088
C                                                                       EVAL-089
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /TITRE/:                     EVAL-090
C  TITLE(18): TITLE OF THE RUN PRINTED AS HEADING OF RESULTS.           EVAL-091
C   DEFINED:  TITLE.                                                    EVAL-092
C                                                                       EVAL-093
C MEANING OF INDEX AND LOGICAL RETURNED:                                EVAL-094
C      1-1000      OPTICAL MODEL,FOLDING PARAMETERS.                    EVAL-095
C   1001-2000      DEFORMATIONS FOR A GIVEN POTENTIAL.                  EVAL-096
C   2001-3000      DEFORMATIONS FOR A GIVEN MULTIPOLE.                  EVAL-097
C   3001-4000      INDIVIDUAL DEFORMATION.                              EVAL-098
C   4001-5000      NUCLEAR MODEL PARAMETER.             - LO(111)=.TRUE.EVAL-099
C   5001-6000      NUCLEAR MATRIX ELEMENT.                              EVAL-100
C   6001-7000      SPIN-ORBIT AND COMPOUND NUCLEUS PARAMETRISATION.     EVAL-101
C                  SPIN-ORBIT PARAMETRISATION:                          EVAL-102
C                  BZ1, BZ2, BZ3, BZ4, BZ5              - LO(112)=.TRUE.EVAL-103
C                  TGO, BN, FNUG, EGD, GGD              - LO(112)=.TRUE.EVAL-104
C                  SA, UX, TAU, SG, E0, EX FOR GAMMA    - LO(112)=.TRUE.EVAL-105
C                  SA, UX, TAU, SG, E0, EX FOR CONTINUUM- LO(114)=.TRUE.EVAL-106
C                  GAMMA TRANSMISSION FACTORS                           EVAL-107
C                  FISSION TRANSMISSION COEFFICIENT, DEGREE OF FREEDOM  EVAL-108
C   7001-8000      DISPERSION RELATIONS PARAMETRISATION - LO(113)=.TRUE.EVAL-109
C  10001-99999     EXTERNAL OPTICAL MODEL (PARAMETERS ABOVE 1000)       EVAL-110
C IT STOPS THE CALCULATION FOR AN INDEX OF PARAMETER OUT OF RANGE       EVAL-111
C                                                                       EVAL-112
C***********************************************************************EVAL-113
      IMPLICIT REAL*8 (A-H,O-Z)                                         EVAL-114
      LOGICAL LO(150),LX                                                EVAL-115
      DIMENSION NW(2,*),DW(*)                                           EVAL-116
      CHARACTER*4 AA(2),TITLE                                           EVAL-117
      CHARACTER*8 BB(2,2)                                               EVAL-118
      COMMON /ADDRE/ NIPH,NJIT,NWV,NIPP,NPAR,NPAA,NSCN,NFIS,NGAM,NNIV,NPEVAL-119
     1OT,NBETA,NFM,NTGX,NDONN,NNVI,NDE,NISE,NRC,NIW,NNWI,NCC,MCC,NXA,NAMEVAL-120
     21,NFAC,NFG,NXG,NRES,NXX,NT,NIVQ,NIVY,NIVZ,NCOI,MIPI,NXD,MWV,NIXT,NEVAL-121
     3TY,NSM,NTX,NRY,NRCO,NRDO,NVC1,NVC2,NNC,NCX                        EVAL-122
      COMMON /COUPL/ IQM,IQMAX,NBT1,NFA,NPP,NSPIN,NVA                   EVAL-123
      COMMON /DCHI2/ CHI2,CHI2M,YY(3)                                   EVAL-124
      COMMON /INOUT/ MR,MW,MS                                           EVAL-125
      COMMON /INTEG/ IDMT,NPLACE,NCOLL,NJMAX,ITERM,JDM,JIT,KMIN,KMAX,NCOEVAL-126
     1LS,NCOLT,NBET,LMX,LMAX1,NLT,ISM,NJC,JTX,KCC,MS1,MS2,KBA,KAB,KBC,JTEVAL-127
     2H,NCOLR,NREC,NTOT,LMAX2,KE,ITEMM,KXT,LMAX3,NRZ,NTZ,IPM,IPK,MCM(2),EVAL-128
     3NCT(6)                                                            EVAL-129
      COMMON /NCOMP/ NSP(3),NFISS,NRD,NCONT,NCOJ,NCONS,NIE,NCOLX,NDP,NDQEVAL-130
     1,ACN1,ACN2,AZ(18)                                                 EVAL-131
      COMMON /TITRE/ TITLE(18)                                          EVAL-132
      DATA AA /' NEW','LAST'/                                           EVAL-133
      DATA BB /'INCREASE','S )     ','NEW VALU','ES )    '/             EVAL-134
      NVAT=42*NPP                                                       EVAL-135
      LO(34)=.FALSE.                                                    EVAL-136
      LX=.FALSE.                                                        EVAL-137
      READ (MR,1000) LO(34),LX,NIN,NEX,YY(1)                            EVAL-138
      IF (LX) READ (MR,1001) TITLE                                      EVAL-139
      NX=MIN0(1,MAX0(NEX,-1))+2                                         EVAL-140
      I1=1                                                              EVAL-141
      I2=1                                                              EVAL-142
      IF (.NOT.LO(34)) I1=2                                             EVAL-143
      IF (NX.EQ.2) I2=2                                                 EVAL-144
      WRITE (MW,1002) AA(I1),NIN,BB(1,I2),BB(2,I2)                      EVAL-145
      IF (NX.EQ.1) WRITE (MW,1003)                                      EVAL-146
      DO 1 I=111,120                                                    EVAL-147
    1 LO(I)=.FALSE.                                                     EVAL-148
      IF (NCX+2*NIN.GT.IDMT) CALL MEMO('EVAL',IDMT,NCX+2*NIN)           EVAL-149
      READ (MR,1004) (NW(1,2*I+NCX-2),I=1,NIN)                          EVAL-150
      READ (MR,1005) (DW(2*I+NCX-1),I=1,NIN)                            EVAL-151
      DO 50 I=1,NIN                                                     EVAL-152
      NW(1,2*I+NCX-2)=MAX0(0,NW(1,2*I+NCX-2))                           EVAL-153
      J=MOD(NW(1,2*I+NCX-2),1000)                                       EVAL-154
      IK=(NW(1,2*I+NCX-2)+999)/1000                                     EVAL-155
      EY=DW(2*I+NCX-1)                                                  EVAL-156
      IF (IK.NE.0) GO TO 7                                              EVAL-157
C ENERGY IN THE LABORATORY SYSTEM.                                      EVAL-158
      LO(115)=.TRUE.                                                    EVAL-159
      DW(NWV+12)=EY                                                     EVAL-160
      EX=DW(NWV+2)                                                      EVAL-161
      IF (NX.EQ.1) EY=.01D0*EY*EX                                       EVAL-162
      IF (NX.NE.2) EY=EX+EY                                             EVAL-163
      IF (LO(8)) GO TO 2                                                EVAL-164
      DW(NWV+2)=EY*DW(NWV+1)/(DW(NWV)+DW(NWV+1))                        EVAL-165
      GO TO 3                                                           EVAL-166
C RELATIVISTIC C.-M. ENERGY ECM=SQRT((M1+M2)**2+2*M2*ELAB))-M1-M2.      EVAL-167
    2 DW(NWV+2)=CM*(DSQRT((DW(NWV)+DW(NWV+1))**2+2.D0*DW(NWV+1)*EY/CM)-DEVAL-168
     1W(NWV)-DW(NWV+1))                                                 EVAL-169
    3 WRITE (MW,1006) I,J,EY,DW(2*I+NCX-1),DW(NWV+2),EX                 EVAL-170
      IF (NCOLX.EQ.1) GO TO 50                                          EVAL-171
      DO 5 J=2,NCOLX                                                    EVAL-172
      DW(NWV+22*J-20)=DW(NWV+22*J-20)+DW(NWV+2)-EX                      EVAL-173
      IF (LO(8)) GO TO 4                                                EVAL-174
      DW(NWV+22*J-10)=DW(NWV+22*J-20)*(DW(NWV+22*J-22)+DW(NWV+22*J-21))/EVAL-175
     1DW(NWV+22*J-21)                                                   EVAL-176
      GO TO 5                                                           EVAL-177
    4 DW(NWV+22*J-10)=DW(NWV+22*J-20)*(DW(NWV+22*J-20)/(2.D0*CM)+DW(NWV+EVAL-178
     122*J-22)+DW(NWV+22*J-21))/DW(NWV+22*J-21)                         EVAL-179
    5 CONTINUE                                                          EVAL-180
      GO TO 50                                                          EVAL-181
    6 IF (NEX.LT.0) EY=.01D0*EY*EX                                      EVAL-182
      EY=EX+EY                                                          EVAL-183
      GO TO ( 18 , 23 , 29 , 34 , 36 , 38 , 40 , 49 ),IK                EVAL-184
    7 IF (IK.GT.10) GO TO 8                                             EVAL-185
      IF (IK.GT.8) GO TO 52                                             EVAL-186
      GO TO ( 9 , 19 , 25 , 31 , 35 , 37 , 39 , 48 ),IK                 EVAL-187
    8 IK=1                                                              EVAL-188
      J=NW(1,2*I+NCX-2)-9000                                            EVAL-189
    9 IF (LO(7)) GO TO 11                                               EVAL-190
C OPTICAL MODEL AND FOLDING PARAMETERS.                                 EVAL-191
      N=1+MOD(J-1,42)                                                   EVAL-192
      M=1+(J-1)/42                                                      EVAL-193
      K=IABS(NW(1,NIPP+17*M-17))                                        EVAL-194
      IF (J.GT.NVAT.OR.N.EQ.25) GO TO 53                                EVAL-195
      IF (MOD(N,4).NE.2.OR.N.GT.32) GO TO 10                            EVAL-196
      EX=DW(NWV+22*K-21)**.33333333333333D0                             EVAL-197
      IF (LO(16)) EX=EX+DW(NWV+22*K-22)**.33333333333333D0              EVAL-198
      EY=EY*EX                                                          EVAL-199
   10 EX=DW(NPOT+J-1)                                                   EVAL-200
      IF (NX.NE.2) GO TO 6                                              EVAL-201
      GO TO 18                                                          EVAL-202
C EXTERNAL OPTICAL PARAMETERS.                                          EVAL-203
   11 IF (J.GE.NW(2,NPOT+1)) GO TO 54                                   EVAL-204
      I1=NW(1,NPOT)-2                                                   EVAL-205
      DO 12 L=1,I1                                                      EVAL-206
      IF (J.GE.NW(1,NPOT+L).AND.J.LE.NW(2,NPOT+L)) GO TO 13             EVAL-207
   12 CONTINUE                                                          EVAL-208
      GO TO 55                                                          EVAL-209
   13 EX=DW(NPOT+J-1)                                                   EVAL-210
      IF (L.EQ.1) GO TO 17                                              EVAL-211
C NOT A FOLDING PARAMETER.                                              EVAL-212
      M=NW(1,NPOT+L)                                                    EVAL-213
      N=NW(2,NPOT+M-2)                                                  EVAL-214
      IV=NW(2,NPOT+N-1)                                                 EVAL-215
      IF (IV.LT.1.OR.IV.GT.6) GO TO 16                                  EVAL-216
      NST=NW(1,NPOT+N+1)                                                EVAL-217
      IF (NST.GT.0) GO TO 18                                            EVAL-218
      IT1=MOD(NW(1,NPOT+N-1)-1,8)+1                                     EVAL-219
      J1=(NW(1,NPOT+N-1)-1)/8                                           EVAL-220
      J2=4                                                              EVAL-221
      IF (IT1.GT.6) J2=5                                                EVAL-222
      IF (J-M.GT.1.AND.J-M.LT.J2) GO TO 17                              EVAL-223
      K=IABS(NST)                                                       EVAL-224
      FX=DW(NWV+22*K-21)**.33333333333333D0                             EVAL-225
      FY=FX                                                             EVAL-226
      IF (LO(16)) FX=FX+DW(NWV+22*K-22)**.33333333333333D0              EVAL-227
C TRANSFORMATION OF DEPTH AND RADIUS.                                   EVAL-228
      IF (J-M.EQ.1) EY=EY*FX                                            EVAL-229
      FY=FY/FX                                                          EVAL-230
      IF (J.GT.M+2) GO TO 15                                            EVAL-231
      IF ((.NOT.LO(16)).OR.J1.LE.NPP.OR.J.NE.M) GO TO 17                EVAL-232
      ITYZ=IV                                                           EVAL-233
      IF (ITYZ.GE.5) ITYZ=ITYZ-4                                        EVAL-234
      ITYW=1                                                            EVAL-235
      IF (IT1.LE.6) GO TO 14                                            EVAL-236
      ITI=7*(J1-NPP)                                                    EVAL-237
      ITYW=ITYW*NW(2-MOD(ITI,2),NIVY+(ITI-1)/2)                         EVAL-238
   14 IF (LO(6)) ITYW=ITYW-1                                            EVAL-239
      IF (ITYZ.GT.1) EY=EY*FY**((ITYZ-1)*ITYW)                          EVAL-240
      GO TO 17                                                          EVAL-241
C TRANSFORMATION OF DEFORMATIONS.                                       EVAL-242
   15 J3=J-M-J2                                                         EVAL-243
      IF (IT1.LT.7) J3=0                                                EVAL-244
      IF (.NOT.LO(6)) J3=J3+1                                           EVAL-245
      EY=EY*FY**J3                                                      EVAL-246
      GO TO 17                                                          EVAL-247
   16 IF ((IV.LT.0).AND.(J-M.GT.1)) GO TO 56                            EVAL-248
      IF ((IV.NE.7).AND.(IV.NE.8)) GO TO 17                             EVAL-249
      JY=J                                                              EVAL-250
      IF (NW(1,NPOT+NW(2,NPOT+M-2)).NE.1) JY=JY-1                       EVAL-251
      IF (M.GT.JY) GO TO 57                                             EVAL-252
      IF ((IV.EQ.7).AND.(MOD(JY-M,3).NE.0)) GO TO 58                    EVAL-253
      IF ((IV.EQ.8).AND.(MOD(JY+10-M,11).LT.3)) GO TO 59                EVAL-254
   17 IF (NX.NE.2) GO TO 6                                              EVAL-255
   18 IF (.NOT.LO(7)) WRITE (MW,1007) I,J,N,M,EY,DW(2*I+NCX-1),DW(NPOT+JEVAL-256
     1-1)                                                               EVAL-257
      IF (LO(7)) WRITE (MW,1008) I,J,EY,DW(2*I+NCX-1),DW(NPOT+J-1)      EVAL-258
      DW(NPOT+J-1)=EY                                                   EVAL-259
      GO TO 50                                                          EVAL-260
   19 IF (J.GT.8) GO TO 60                                              EVAL-261
C DEFORMATIONS FOR A GIVEN POTENTIAL.                                   EVAL-262
      K2=J                                                              EVAL-263
      DO 20 K1=1,NBET                                                   EVAL-264
      IF (LO(1).AND.LO(3).AND.NW(2,NBETA+9*K1-1).NE.0) GO TO 20         EVAL-265
      IF (DW(NBETA+K2+9*K1-10).NE.0.D0) GO TO 21                        EVAL-266
   20 CONTINUE                                                          EVAL-267
      GO TO 61                                                          EVAL-268
   21 EY=EY/DW(NBETA+K2+9*K1-10)                                        EVAL-269
      K3=1                                                              EVAL-270
      IF ((NX.NE.1).AND.LO(16)) GO TO 32                                EVAL-271
   22 EX=1                                                              EVAL-272
      IF (NX.NE.2) GO TO 6                                              EVAL-273
   23 WRITE (MW,1009) I,NW(1,2*I+NCX-2),K2,K1,EY,DW(2*I+NCX-1)          EVAL-274
      DO 24 L=K1,NBET                                                   EVAL-275
      IF (LO(1).AND.LO(3).AND.NW(2,NBETA+9*K1-1).NE.0) GO TO 24         EVAL-276
      EX=DW(NBETA+K2+9*L-10)*EY                                         EVAL-277
      WRITE (MW,1010) K2,L,EX,DW(NBETA+K2+9*L-10)                       EVAL-278
      DW(NBETA+K2+9*L-10)=EX                                            EVAL-279
   24 CONTINUE                                                          EVAL-280
      GO TO 50                                                          EVAL-281
C DEFORMATIONS FOR A GIVEN MULTIPOLE.                                   EVAL-282
   25 K1=J                                                              EVAL-283
      IF (J.GT.NBET) GO TO 62                                           EVAL-284
      DO 26 K2=1,8                                                      EVAL-285
      IF (DW(NBETA+K2+9*K1-10).NE.0.D0) GO TO 27                        EVAL-286
   26 CONTINUE                                                          EVAL-287
      GO TO 63                                                          EVAL-288
   27 EY=EY/DW(NBETA+K2+9*K1-10)                                        EVAL-289
      K3=2                                                              EVAL-290
      IF ((NX.NE.1).AND.LO(16)) GO TO 22                                EVAL-291
   28 EX=1                                                              EVAL-292
      IF (NX.NE.2) GO TO 6                                              EVAL-293
   29 WRITE (MW,1009) I,NW(1,2*I+NCX-2),K2,K1,EY,DW(2*I+NCX-1)          EVAL-294
      DO 30 L=K2,8                                                      EVAL-295
      EX=DW(NBETA+L+9*K1-10)*EY                                         EVAL-296
      WRITE (MW,1010) L,K1,EX,DW(NBETA+L+9*K1-10)                       EVAL-297
   30 DW(NBETA+L+9*K1-10)=EX                                            EVAL-298
      GO TO 50                                                          EVAL-299
C INDIVIDUAL DEFORMATIONS.                                              EVAL-300
   31 NBT=10*NBET                                                       EVAL-301
      IF (J.GT.NBT) GO TO 64                                            EVAL-302
      K1=1+(J-1)/10                                                     EVAL-303
      K2=1+MOD(J-1,10)                                                  EVAL-304
      IF (K2.GT.8) GO TO 65                                             EVAL-305
      K3=3                                                              EVAL-306
      IF (.NOT.LO(16)) GO TO 33                                         EVAL-307
C SEARCH OF THE CORRECTIONS FOR HEAVY IONS.                             EVAL-308
   32 EX=DW(NWV+1)**.33333333333333D0/(DW(NWV+1)**.33333333333333D0+DW(NEVAL-309
     1WV)**.33333333333333D0)                                           EVAL-310
      JK=1                                                              EVAL-311
      IF (.NOT.LO(1).AND.LO(3)) JK=K1-1                                 EVAL-312
      K=JK                                                              EVAL-313
      IF (K2.GT.6) K=K*NW(1,NBETA+9*K1-1)                               EVAL-314
      IF (LO(6)) K=K-JK                                                 EVAL-315
      EY=EY*EX**K                                                       EVAL-316
      IF (K3-2) 22 , 28 , 33                                            EVAL-317
   33 EX=DW(NBETA+K2+9*K1-10)                                           EVAL-318
      IF (NX.NE.2) GO TO 6                                              EVAL-319
   34 WRITE (MW,1011) I,NW(1,2*I+NCX-2),K2,K1,EY,DW(2*I+NCX-1),DW(NBETA+EVAL-320
     1K2+9*K1-10)                                                       EVAL-321
      DW(NBETA+K2+9*K1-10)=EY                                           EVAL-322
      GO TO 50                                                          EVAL-323
   35 IF (J.GT.NVA) GO TO 66                                            EVAL-324
      EX=DW(NPAA+J-1)                                                   EVAL-325
      IF (NX.NE.2) GO TO 6                                              EVAL-326
   36 WRITE (MW,1012) I,NW(1,2*I+NCX-2),J,EY,DW(2*I+NCX-1),DW(NPAA+J-1) EVAL-327
      DW(NPAA+J-1)=EY                                                   EVAL-328
      GO TO 50                                                          EVAL-329
C  NUCLEAR MATRIX ELEMENTS.                                             EVAL-330
   37 I3=(NIVQ-NT)/3                                                    EVAL-331
      IF (J.GT.I3) GO TO 67                                             EVAL-332
      EX=DW(NT+3*J-3)                                                   EVAL-333
      LO(111)=.TRUE.                                                    EVAL-334
      IF (NX.NE.2) GO TO 6                                              EVAL-335
   38 WRITE (MW,1013) I,NW(1,2*I+NCX-2),J,EY,DW(2*I+NCX-1),DW(NT+3*J-3) EVAL-336
      DW(NT+3*J-3)=EY                                                   EVAL-337
      GO TO 50                                                          EVAL-338
C SPIN-ORBIT PARAMETRISATION.                                           EVAL-339
   39 IF (J.GT.6) GO TO 41                                              EVAL-340
      IF (.NOT.LO(4)) GO TO 68                                          EVAL-341
      EX=AZ(J)                                                          EVAL-342
      IF (NX.NE.2) GO TO 6                                              EVAL-343
   40 IF (J.GT.6) GO TO 43                                              EVAL-344
      WRITE (MW,1014) I,NW(1,2*I+NCX-2),J,EY,DW(2*I+NCX-1),AZ(J)        EVAL-345
      GO TO 45                                                          EVAL-346
C HAUSER-FESBACH CORRECTION.                                            EVAL-347
   41 IF (.NOT.LO(81)) GO TO 69                                         EVAL-348
      IF (J.GT.16) GO TO 46                                             EVAL-349
      IF (LO(82).AND.J.GT.9) GO TO 70                                   EVAL-350
      IF ((.NOT.LO(86)).AND.J.GT.11) GO TO 70                           EVAL-351
      IF (LO(82)) GO TO 42                                              EVAL-352
      IF (J.NE.9.AND.J.LE.11.AND.LO(87)) GO TO 70                       EVAL-353
      IF (LO(87)) GO TO 42                                              EVAL-354
      IF (J.EQ.7) GO TO 70                                              EVAL-355
      IF (AZ(8).NE.0.D0.AND.J.GT.8.AND.J.LE.11) GO TO 70                EVAL-356
      IF (AZ(8).EQ.0.D0.AND.J.EQ.8) GO TO 70                            EVAL-357
   42 EX=AZ(J)                                                          EVAL-358
      IF (NX.NE.2) GO TO 6                                              EVAL-359
   43 IF (J.GT.16) GO TO 47                                             EVAL-360
      LO(112)=.TRUE.                                                    EVAL-361
      K=J-6                                                             EVAL-362
      IF (K.GT.6) GO TO 44                                              EVAL-363
      WRITE (MW,1015) I,NW(1,2*I+NCX-2),K,EY,DW(2*I+NCX-1),AZ(J)        EVAL-364
      GO TO 45                                                          EVAL-365
   44 K=J-5                                                             EVAL-366
      WRITE (MW,1016) I,NW(1,2*I+NCX-2),K,EY,DW(2*I+NCX-1),AZ(J)        EVAL-367
   45 AZ(J)=EY                                                          EVAL-368
      GO TO 50                                                          EVAL-369
   46 JJ=J-16+(J-16)/6                                                  EVAL-370
      EX=DW(NSCN+JJ-1)                                                  EVAL-371
      IF (NX.NE.2) GO TO 6                                              EVAL-372
   47 K=1+(J-17)/NCONS                                                  EVAL-373
      L=1+MOD(J-17,NCONS)                                               EVAL-374
      IF (K.EQ.NCONS-NCONT) LO(112)=.TRUE.                              EVAL-375
      IF (K.GT.NCONS-NCONT) LO(114)=.TRUE.                              EVAL-376
      WRITE (MW,1017) I,NW(1,2*I+NCX-2),L,K,EY,DW(2*I+NCX-1),DW(NSCN+JJ-EVAL-377
     11)                                                                EVAL-378
      DW(NSCN+JJ-1)=EY                                                  EVAL-379
      GO TO 50                                                          EVAL-380
C DISPERSION PARAMETERS.                                                EVAL-381
   48 IF (.NOT.LO(10)) GO TO 71                                         EVAL-382
      K=(J-1)/13+1                                                      EVAL-383
      IF (K.GT.NPP) GO TO 72                                            EVAL-384
      IF (NW(2,NIPP+17*K-14).NE.0) GO TO 73                             EVAL-385
      L=J-13*K+17                                                       EVAL-386
      LO(113)=.TRUE.                                                    EVAL-387
      EX=DW(NIPP+17*K+L-17)                                             EVAL-388
      IF ((EX.EQ.0.D0).OR.(EY.EQ.0.D0)) WRITE (MW,1018) EX,EY           EVAL-389
      IF (NX.NE.2) GO TO 6                                              EVAL-390
   49 WRITE (MW,1019) I,NW(1,2*I+NCX-2),L,K,EY,DW(2*I+NCX-1),DW(NIPP+17*EVAL-391
     1K+L-17)                                                           EVAL-392
      DW(NIPP+17*K+L-17)=EY                                             EVAL-393
   50 CONTINUE                                                          EVAL-394
      IF (.NOT.LO(32)) RETURN                                           EVAL-395
      CHI2M=1.D35                                                       EVAL-396
      IF (YY(1).EQ.0.D0) YY(1)=20.D0                                    EVAL-397
      YY(3)=0.D0                                                        EVAL-398
      NW(2,NIW)=NW(2,NIW)-NW(1,NIW+1)                                   EVAL-399
      NW(1,NIW+1)=1                                                     EVAL-400
      WRITE (MW,1020) NW(2,NIW),YY(1)                                   EVAL-401
      IF (NW(2,NIW).LE.0) GO TO 75                                      EVAL-402
      II=51                                                             EVAL-403
      IF (LO(76).OR.(.NOT.LO(75))) II=59                                EVAL-404
      DO 51 I=II,65                                                     EVAL-405
      LO(I+85)=LO(I)                                                    EVAL-406
   51 LO(I)=.FALSE.                                                     EVAL-407
      LO(116)=.TRUE.                                                    EVAL-408
      RETURN                                                            EVAL-409
   52 WRITE (MW,1021)                                                   EVAL-410
      GO TO 74                                                          EVAL-411
   53 WRITE (MW,1022) NVAT                                              EVAL-412
      GO TO 74                                                          EVAL-413
   54 WRITE (MW,1023) NW(2,NPOT+1)                                      EVAL-414
      GO TO 74                                                          EVAL-415
   55 WRITE (MW,1024) I,EY,J,(NW(1,NPOT+L),NW(2,NPOT+L),L=1,I1)         EVAL-416
      GO TO 74                                                          EVAL-417
   56 WRITE (MW,1025)                                                   EVAL-418
      GO TO 74                                                          EVAL-419
   57 WRITE (MW,1026)                                                   EVAL-420
      GO TO 74                                                          EVAL-421
   58 WRITE (MW,1027)                                                   EVAL-422
      GO TO 74                                                          EVAL-423
   59 WRITE (MW,1028)                                                   EVAL-424
      GO TO 74                                                          EVAL-425
   60 WRITE (MW,1029)                                                   EVAL-426
      GO TO 74                                                          EVAL-427
   61 WRITE (MW,1030) I,NW(1,2*I+NCX-2),K2                              EVAL-428
      GO TO 74                                                          EVAL-429
   62 WRITE (MW,1031) NBET                                              EVAL-430
      GO TO 74                                                          EVAL-431
   63 WRITE (MW,1032) I,NW(1,2*I+NCX-2),K1                              EVAL-432
      GO TO 74                                                          EVAL-433
   64 WRITE (MW,1033) NBT                                               EVAL-434
      GO TO 74                                                          EVAL-435
   65 WRITE (MW,1034)                                                   EVAL-436
      GO TO 74                                                          EVAL-437
   66 WRITE (MW,1035) NVA                                               EVAL-438
      GO TO 74                                                          EVAL-439
   67 WRITE (MW,1036) I3                                                EVAL-440
      GO TO 74                                                          EVAL-441
   68 WRITE (MW,1037)                                                   EVAL-442
      GO TO 74                                                          EVAL-443
   69 WRITE (MW,1038)                                                   EVAL-444
      GO TO 74                                                          EVAL-445
   70 WRITE (MW,1039)                                                   EVAL-446
      GO TO 74                                                          EVAL-447
   71 WRITE (MW,1040)                                                   EVAL-448
      GO TO 74                                                          EVAL-449
   72 WRITE (MW,1041) NPP                                               EVAL-450
      GO TO 74                                                          EVAL-451
   73 WRITE (MW,1042)                                                   EVAL-452
   74 WRITE (MW,1043) I,NW(1,2*I+NCX-2),IK,J,DW(2*I+NCX-1)              EVAL-453
   75 WRITE (MW,1044)                                                   EVAL-454
      STOP                                                              EVAL-455
 1000 FORMAT (2L1,I3,I5,F10.5)                                          EVAL-456
 1001 FORMAT (18A4)                                                     EVAL-457
 1002 FORMAT ('1',A4,' COMPUTATION WITH',I4,'  NEW PARAMETERS',10X,'( INEVAL-458
     1PUT OF ',2A8)                                                     EVAL-459
 1003 FORMAT (20X,'*** VALUES GIVEN AS PERCENTAGES ***')                EVAL-460
 1004 FORMAT (14I5)                                                     EVAL-461
 1005 FORMAT (7F10.5)                                                   EVAL-462
 1006 FORMAT (2X,I2,' PARAM.',I5,3X,'NEW LAB. ENERGY',1P,D15.8,' (',D15.EVAL-463
     18,')',3X,'CENTRE OF MASS ENERGY',D15.6,5X,'OLD VALUE',D15.6)      EVAL-464
 1007 FORMAT (2X,I2,' PARAM.',I5,3X,'VALUE OF V-OPTICAL(',I2,',',I2,') =EVAL-465
     1',1P,D15.6,' (',D15.6,')',3X,'OLD VALUE',D15.6)                   EVAL-466
 1008 FORMAT (2X,I2,' PARAM.',I5,'TH VALUE OF EXTERNAL POTENTIAL =',1P,DEVAL-467
     115.6,' (',D15.6,')',3X,'OLD VALUE',D15.6)                         EVAL-468
 1009 FORMAT (2X,I2,' PARAM.',I5,3X,'PROPORTIONAL TO BETA(',I2,',',I2,')EVAL-469
     1  WITH RATIO',1P,D15.6,' (',D15.6,')')                            EVAL-470
 1010 FORMAT (15X,'BETA(',I2,',',I2,') =',1P,D15.6,5X,'OLD VALUE',D15.6)EVAL-471
 1011 FORMAT (2X,I2,' PARAM.',I5,3X,'BETA(',I2,',',I2,') =',1P,D15.6,' (EVAL-472
     1',E15.6,')',3X,'OLD VALUE',D15.6)                                 EVAL-473
 1012 FORMAT (2X,I2,' PARAM.',I5,3X,'VAR(',I2,') =',1P,D15.6,' (',D15.6,EVAL-474
     1')',3X,'OLD VALUE',D15.6)                                         EVAL-475
 1013 FORMAT (2X,I2,' PARAM.',I5,3X,'T(4,',I3,') =',1P,D15.6,' (',D15.6,EVAL-476
     1')',3X,'OLD VALUE',D15.6)                                         EVAL-477
 1014 FORMAT (2X,I2,' PARAM.',I5,3X,'AZ(',I1,') =',1P,D15.6,' (',D15.6,'EVAL-478
     1)',3X,'OLD VALUE',D15.6)                                          EVAL-479
 1015 FORMAT (2X,I2,' PARAM.',I5,3X,'BZ(',I1,') =',1P,D15.6,' (',D15.6,'EVAL-480
     1)',3X,'OLD VALUE',D15.6)                                          EVAL-481
 1016 FORMAT (2X,I2,' PARAM.',I5,3X,'GIANT RESONANCE(',I1,') =',1P,D15.6EVAL-482
     1,' (',D15.6,')',3X,'OLD VALUE',D15.6)                             EVAL-483
 1017 FORMAT (2X,I2,' PARAM.',I5,3X,'SCN(',I3,',',I3,') =',1P,D15.6,' ('EVAL-484
     1,D15.6,')',3X,'OLD VALUE',D15.6)                                  EVAL-485
 1018 FORMAT (' NO VERIFICATION OF VALIDITY FOR THE DISPERSION PARAMETEREVAL-486
     1',1P,D15.6,' CHANGED INTO',D15.6)                                 EVAL-487
 1019 FORMAT (2X,I2,' PARAM.',I5,3X,'PIP(',I3,',',I3,') =',1P,D15.6,' ('EVAL-488
     1,D15.6,')',3X,'OLD VALUE',D15.6)                                  EVAL-489
 1020 FORMAT (' NEW MAXIMUM NUMBER OF RUNS:',I6,10X,'STARTING SCALE',F10EVAL-490
     1.2)                                                               EVAL-491
 1021 FORMAT (' NO VARIABLE IS DEFINED BY INDEX BETWEEN 8001 AND 10000.'EVAL-492
     1)                                                                 EVAL-493
 1022 FORMAT (' NO OPTICAL PARAMETER INDEX LARGER THAN',I3,' AND NO CHANEVAL-494
     1GE OF COULOMB CHARGES.')                                          EVAL-495
 1023 FORMAT (' NO EXTERNAL OPTICAL PARAMETER LARGER THAN',I5)          EVAL-496
 1024 FORMAT (' VARIABLE',I3,1P,D15.6,' DEFINED BY',I5,' CANNOT BE USED'EVAL-497
     1/' THE PARAMETER WHICH CAN BE SEARCHED ARE BETWEEN:'/(4(5X,I6,' TOEVAL-498
     2',I6)))                                                           EVAL-499
 1025 FORMAT (' FOR A FORM FACTOR GIVEN BY POINTS, THE TWO MULTIPLICATIVEVAL-500
     1E FACTOR ONLY CAN BE CHANGED.')                                   EVAL-501
 1026 FORMAT (' THE COUPLING OF TWO PARTICLE STATES CANNOT BE CHANGED.')EVAL-502
 1027 FORMAT (' ONLY THE OSCILLATOR PARAMETER CAN BE CHANGED FOR A LAGUEEVAL-503
     1RRE POLYNOMIAL.')                                                 EVAL-504
 1028 FORMAT (' MASSES AND PRODUCT OF CHARGES CANNOT BE CHANGED FOR A SIEVAL-505
     1NGLE PARTICLE STATE.')                                            EVAL-506
 1029 FORMAT (' NOT AN INDEX FOR DEFORMATION OF A GIVEN POTENTIAL.')    EVAL-507
 1030 FORMAT (' THE VARIABLE',I3,' CANNOT BE USED BECAUSE ',I5,'  IS A VEVAL-508
     1ARIATION OF THE DEFORMATIONS OF POTENTIAL',I3,' WHICH ARE ZERO.') EVAL-509
 1031 FORMAT (' NO INDEX FOR MULTIPOLE LARGER THAN',I3)                 EVAL-510
 1032 FORMAT (' THE VARIABLE',I3,' CANNOT BE USED BECAUSE ',I5,'  IS A VEVAL-511
     1ARIATION FOR A GIVEN MULTIPOLE',I3,' AND THEY ARE ZERO.')         EVAL-512
 1033 FORMAT (' NO INDEX FOR INDIVIDUAL MULTIPOLE LARGER THAN',I3)      EVAL-513
 1034 FORMAT (' NO INDEX FOR INDIVIDUAL MULTIPOLE EQUAL TO 0 OR 9 MODULOEVAL-514
     1 10')                                                             EVAL-515
 1035 FORMAT (' NO INDEX FOR NUCLEAR LEVEL PARAMETER LARGER THAN',I3)   EVAL-516
 1036 FORMAT (' NO INDEX FOR NUCLEAR MATRIX ELEMENT LARGER THAN',I3)    EVAL-517
 1037 FORMAT (' THE SPIN-ORBIT IS NOT PARAMETRISED.')                   EVAL-518
 1038 FORMAT (' NO HAUSER-FESBACH CORRECTION TO CROSS-SECTIONS.')       EVAL-519
 1039 FORMAT (' PARAMETER NOT USED FOR THESE HAUSER-FESBACH CORRECTION TEVAL-520
     1O CROSS-SECTIONS.')                                               EVAL-521
 1040 FORMAT (' DISPERSION RELATIONS WERE NOT USED IN PREVIOUS COMPUTATIEVAL-522
     1ON.')                                                             EVAL-523
 1041 FORMAT (' THERE ARE ONLY',I3,' DIFFERENT POTENTIALS.')            EVAL-524
 1042 FORMAT (' THE COEFFICIENTS OF THIS DISPERSION RELATION SHOULD BE REVAL-525
     1EAD EACH TIME.')                                                  EVAL-526
 1043 FORMAT (' VARIABLE',I3,' DEFINED BY',I5,' (',I2,I5,')',' WITH VALUEVAL-527
     1E ',D15.6,' CANNOT BE USED.')                                     EVAL-528
 1044 FORMAT (//' IN EVAL  ...  STOP ...')                              EVAL-529
      END                                                               EVAL-530
C 19/04/07                                                      ECIS06  REST-000
      SUBROUTINE REST(KF,NW,DW,IDMX,LO)                                 REST-001
C IF KF=0                                                               REST-002
C IT SAVES ON TAPE MS ALL THE DATA NEEDED TO RE-START A SEARCH STOPPED  REST-003
C BY THE NUMBER OF EVALUATIONS IF LO(35)=.TRUE.                         REST-004
C IF KF.NE.0                                                            REST-005
C IT READS ON TAPE MS TO RE-START THE SEARCH                            REST-006
C IT IS CALLED ONLY IF LO(36)=.TRUE.                                    REST-007
C ******** UNLESS THE MAIN SUBROUTINE IS CHANGED, MS = 8 ***************REST-008
C INPUT:     KE:      0 TO WRITE ON MS, ANY VALUE TO READ ON MS.        REST-009
C            NW,DW:   WORKING ARRAY.                                    REST-010
C            IDMX:    SIZE OF THE WORKING ARRAY.                        REST-011
C            LO(I):   LOGICAL CONTROLS:                                 REST-012
C               LO(35) =.TRUE. SEARCH SAVED ON TAPE 8 IF CORRECTLY ENDEDREST-013
C                              OR STOPPED BY THE NUMBER OF EVALUATIONS. REST-014
C                                                                       REST-015
C THE COMMON /ADDRE/ IS USED IN CALC, CALX, CAL1, VARI, EVAL AND REST.  REST-016
C THE COMMON /ANGUL/ IS USED IN CALX, LECT, SCHE, LCSP, RESU AND REST.  REST-017
C THE COMMON /CONVE/ IS USED IN CALC, CALX, CAL1, INTI, INSI, INTR      REST-018
C                               INRI AND REST.                          REST-019
C THE COMMON /COUPL/ IS USED IN CALC, CALX, LECL, LECT, LECD, COLF,     REST-020
C                               REDM, VIBM, ROTM, ROAM, EXTP, CAL1,     REST-021
C                               POTE, ROTP, ROTD, STDP, VARI, EVAL      REST-022
C                               AND REST.                               REST-023
C THE COMMON /DCHI2/ IS USED IN CALC, CALX, RESU, VARI, EVAL, REST      REST-024
C                               AND FITE.                               REST-025
C THE COMMON /DCONS/ IS USED IN ECIS, CALC, LECL, LECT, COLF, KHCO,     REST-026
C                               CONU, CAL1, POTE, ROTP, ROTZ, STDP,     REST-027
C                               STBF, MTCH, SCAM, SCHE, LSCP, RESU,     REST-028
C                               SCAT AND REST.                          REST-029
C THE COMMON /INTEG/ IS USED IN CALC, CALX, CAL1, VARI, EVAL AND REST.  REST-030
C THE COMMON /NCOMP/ IS USED IN CALC, CALX, LECT, CONU, GGDR, CAL1,     REST-031
C                               QUAN, SCAM, SCHE, RESU, VARI, EVAL,     REST-032
C                               AND REST.                               REST-033
C THE COMMON /POTE1/ IS USED IN CALC, REDM, EXTP, POTE, ROTP, STDP,     REST-034
C                               FOLD AND REST.                          REST-035
C THE COMMON /POTE2/ IS USED IN CALC, LECL, REDM, CAL1, POTE, QUAN,     REST-036
C                               MTCH AND REST.                          REST-037
C THE COMMON /TITRE/ IS USED IN CALC, CALX, RESU, EVAL AND REST.        REST-038
C                                                                       REST-039
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /TITRE/:                     REST-040
C  TITLE(18): TITLE OF THE RUN PRINTED AS HEADING OF RESULTS.           REST-041
C   DEFINED:  TITLE.                                                    REST-042
C   USED:     TITLE.                                                    REST-043
C                                                                       REST-044
C***********************************************************************REST-045
      IMPLICIT REAL*8 (A-H,O-Z)                                         REST-046
      LOGICAL LO(150)                                                   REST-047
      DIMENSION NW(2,*),DW(*),T(18)                                     REST-048
      CHARACTER*4 T,TITLE                                               REST-049
      COMMON /ADDRE/ N1(49)                                             REST-050
      COMMON /ANGUL/ N2(14)                                             REST-051
      COMMON /CONVE/ A3(6)                                              REST-052
      COMMON /COUPL/ N3(7)                                              REST-053
      COMMON /DCHI2/ A4(5)                                              REST-054
      COMMON /DCONS/ A5(7)                                              REST-055
      COMMON /INOUT/ MR,MW,MS                                           REST-056
      COMMON /INTEG/ N7(45)                                             REST-057
      COMMON /NCOMP/ N8(52)                                             REST-058
      COMMON /POTE1/ N9(22)                                             REST-059
      COMMON /POTE2/ NA(16)                                             REST-060
      COMMON /TITRE/ TITLE(18)                                          REST-061
      IDMY=IDMX                                                         REST-062
      REWIND MS                                                         REST-063
      IF (KF.NE.0) GO TO 1                                              REST-064
C WRITES COMMONS FIRST AND W AFTER                                      REST-065
      WRITE (MS) IDMX,LO,N1,N2,A3,N3,A4,A5,N7,N8,N9,NA,TITLE            REST-066
C N1(46) IS NRCO,N7(2) IS NPLACE,N7(1) IS IDMT                          REST-067
      I1=N1(46)                                                         REST-068
      WRITE (MW,1000) MS,I1                                             REST-069
      WRITE (MS) (DW(I),I=1,I1)                                         REST-070
      REWIND MS                                                         REST-071
      RETURN                                                            REST-072
C READ COMMONS,COMPUTES LIMITS OF W AND READ W                          REST-073
    1 READ (MS) I,LO,N1,N2,A3,N3,A4,A5,N7,N8,N9,NA,T                    REST-074
      I1=N1(46)                                                         REST-075
      N7(1)=IDMY                                                        REST-076
      WRITE (MW,1001) TITLE,T,N7(1)                                     REST-077
      IF (N7(2).GT.N7(1)) CALL MEMO('REST',N7(1),N7(2))                 REST-078
      READ (MS) (DW(I),I=1,I1)                                          REST-079
      REWIND MS                                                         REST-080
C READS ON 5 IF SAVE HAS TO BE DONE AGAIN AND THE NEW NUMBER OF EVAL.   REST-081
C ANY MODIFICATION OF THE SEARCH CAN BE READ AT THIS PLACE IF THEY      REST-082
C DO NOT SPOIL THE SEARCH                                               REST-083
      LO(35)=.FALSE.                                                    REST-084
      READ (MR,1002) LO(35),N,ECH,RAP                                   REST-085
C N1(20) IS NIW, N7(27) IS NREC                                         REST-086
      IF (N.EQ.0) N=N7(34)+2                                            REST-087
      M=N1(20)                                                          REST-088
      NW(2,M)=NW(2,M)+N                                                 REST-089
      WRITE (MW,1003) MS,I1                                             REST-090
      WRITE (MW,1004) N,NW(2,M)                                         REST-091
      IF (LO(35)) WRITE (MW,1005) MS                                    REST-092
      IF (.NOT.LO(35)) WRITE (MW,1006) MS                               REST-093
      IF (ECH.LT.1.D0) GO TO 2                                          REST-094
      WRITE (MW,1008) A4(3),ECH                                         REST-095
      A4(3)=ECH                                                         REST-096
    2 IF (RAP.LT.1.D0) GO TO 3                                          REST-097
      WRITE (MW,1009) A4(4),RAP                                         REST-098
      A4(4)=RAP                                                         REST-099
    3 RETURN                                                            REST-100
 1000 FORMAT (///15H OUTPUT ON TAPE,I3,24H OF DW FROM DW(1) TO DW(,I6,1HREST-101
     1)///)                                                             REST-102
 1001 FORMAT ('1'//1X,18A4//' RESTART OF COMPUTATION'//' LAST TITLE : ''REST-103
     1''',18A4,''''''//' AVAILABLE WORKING SPACE',I8/)                  REST-104
 1002 FORMAT (L1,I4,5X,2F10.5)                                          REST-105
 1003 FORMAT (' INPUT FROM TAPE',I3,' OF DW FROM DW(1) TO DW(',I6,')'//)REST-106
 1004 FORMAT (/' MAXIMUM NUMBER OF EVALUATIONS INCREASED BY',I4,5X,'NEW REST-107
     1VALUE',I6)                                                        REST-108
 1005 FORMAT (' SAVE ON TAPE',I3,' IF NECESSARY.')                      REST-109
 1006 FORMAT (' NO SAVE ON TAPE',I3)                                    REST-110
 1008 FORMAT (' CHANGE OF ECH FROM',F10.5,' TO',F10.5)                  REST-111
 1009 FORMAT (' CHANGE OF RAP FROM',F10.5,' TO',F10.5)                  REST-112
      END                                                               REST-113
C 28/06/06                                                      ECIS06  FITE-000
      SUBROUTINE FITE(KE,M,N,F,X,E,W,NW,IZ,WA)                          FITE-001
C CHI-SQUARE MINIMISING SUBROUTINE WRITTEN BY G. SCHWEIMER IN KARLSRUHE.FITE-002
C SIMPLIFIED FOR THE USE OF ECIS (NO GRADIENT).                         FITE-003
C SOLVES THE NONLINEAR LEAST SQUARES PROBLEM,                           FITE-004
C USING A LEAST SQUARES INTERPOLATION BETWEEN VARIABLES AND FUNCTIONS.  FITE-005
C CALLED SUBROUTINES: FIT2 /.TRUE./ (LINEAR LEAST SQUARES PROBLEM).     FITE-006
C                     FIT2 /.FALSE./(INVERSION OF A(TRANSPOSED)*A).     FITE-007
C                     FIT1(ONE DIMENSIONAL MINIMUM SEARCH).             FITE-008
C INPUT:     KE:      0 FOR THE FIRST CALL, 1 FOR THE FOLLOWING ONES.   FITE-009
C            M:       NUMBER OF FUNCTIONS, M GE N.                      FITE-010
C            N:       NUMBER OF VARIABLES, N GE 1.                      FITE-011
C            F:       FUNCTION VALUES AT THE POINT X.                   FITE-012
C            X:       STARTING VALUES OF THE VARIABLES.                 FITE-013
C            E:       ABSOLUTE SEARCH ACCURACIES FOR THE VARIABLES.     FITE-014
C            IZ(I)    NUMBER OF POINTS TO BE REMEMBERED FOR I=1         FITE-015
C                     (AT LEAST N+1).                                   FITE-016
C                     MAXIMUM NUMBER OF FUNCTION EVALUATIONS FOR I=2.   FITE-017
C OUTPUT:    KE:      ERROR CODE:                                       FITE-018
C                     KE=0: WITHOUT ERRORS.                             FITE-019
C                     KE=2: USER INTERRUPT.                             FITE-020
C                     KE=3: MAXIMUM NUMBER OF FUNCTION EVALUATIONS.     FITE-021
C                     KE=4: ROUNDING ERRORS.                            FITE-022
C                     KE=5: THE FUNCTIONS DO NOT DEPEND ON X(IZ(4)).    FITE-023
C                     KE=6: USELESS VARIABLES IN THE PREPARATORY CALLS, FITE-024
C                           THE LABELS OF THE VARIABLES ARE IZ(3),IZ(4).FITE-025
C                     KE=7: M LT N.                                     FITE-026
C            W(I):    FOR I<N, STANDARD ERROR OF THE VARIABLE I (FOR A  FITE-027
C                     VARIANCE AT BEST FIT EQUAL TO DEGREE OF FREEDOM). FITE-028
C                     FOR I+N, ERROR ENHANCEMENT (MANY/SINGLE VARIABLE  FITE-029
C                     RESULT).                                          FITE-030
C                     FOR N+N+I+(J*(J-1))/2, ERROR CORRELATION BETWEEN  FITE-031
C                     X(I) AND X(J), I<J.                               FITE-032
C            IZ(I)    NUMBER OF FUNCTION EVALUATIONS FOR I=3.           FITE-033
C                     FOR I=4, NUMBER OF DEGREES OF FREEDOM IF KE=0,2,3 FITE-034
C                     OR 4.  PLACE OF USELESS VARIABLE IF KE=5 OR 6.    FITE-035
C                     EVENTUALLY INDICATIONS FOR ONE DIMENSIONAL SEARCH FITE-036
C                     IF KE=1.                                          FITE-037
C WORKING AREAS:                                                        FITE-038
C            IZ(I):   FOR I=5 TO 4+IZ(1), LABELS OF THE QUADRATIC SUMS. FITE-039
C            W(I):    OF LENGTH MAX(14+N+K*(M+N+1),(N*(N+5))/2)         FITE-040
C                     EVENTUALLY, INDICATIONS FOR ONE DIMENSIONAL       FITE-041
C                     SEARCH. FROM MAX(15,N+1),K SETS OF (FUNCTIONS +   FITE-042
C                     VARIABLES + CHI2). SEE ABOVE THE ADDRESSES IN W   FITE-043
C                     AFTER THE SEARCH                                  FITE-044
C            NW:      EQUIVALENT BY CALL WITH W.                        FITE-045
C            WA(I):   OF LENGTH (M+1)*(N+1)+(N*(N+1))/2. FROM I=1,      FITE-046
C                     GRADIENT OR MATRIX A FOLLOWED BY CENTRAL FUNCTIONSFITE-047
C                     FROM I=1+M*(N+1), CENTRAL VARIABLES,              FITE-048
C                     FROM I=(N+1)*(M+1), MATRIX D.                     FITE-049
C                                                                       FITE-050
C THE WORKING FIELDS IZ AND W CONTAIN ALL INFORMATION TO CONTINUE       FITE-051
C THE SEARCH. THIS ALLOWS A SEARCH WITHIN ANOTHER SEARCH JUST CHANGING  FITE-052
C THE WORKING FIELDS.                                                   FITE-053
C                                                                       FITE-054
C FOR THE COMMON  /DCHI2/  SEE CALX.                                    FITE-055
C                                                                       FITE-056
C SIGNIFICANCE OF THE QUANTITIES IN COMMON /DCHI2/:                     FITE-057
C  CHI2:      CHI-SQUARE COMPUTED IN SUBROUTINE RESU.                   FITE-058
C  YY(1):     STEP SIZE IN THE SEARCH.                                  FITE-059
C  YY(2):     HALF OF THE SUCCESS MULTIPLICATIVE FACTOR OF THE STEP.    FITE-060
C             THE STEP SIZE IS DIVIDED BY 4 TIMES ITS SQUARE AFTER      FITE-061
C             UNSUCCESS.                                                FITE-062
C  YY(3):     CHANGED X VALUE IN PREPARATORY CALLS,                     FITE-063
C             RATIO STEP/DISTANCE OF MINIMUM AFTER PREPARATORY CALLS    FITE-064
C             OR 0. FOR RANDOM PREDICTION,                              FITE-065
C             ERROR RENORMALISATION FACTOR WHEN KE=0,2 OR 3.(SQUARE ROOTFITE-066
C             OF VARIANCE AT BEST FIT DIVIDED BY DEGREE OF FREEDOM).    FITE-067
C   DEFINED:  CHI2,YY.                                                  FITE-068
C   USED:     CHI2,YY.                                                  FITE-069
C                                                                       FITE-070
C***********************************************************************FITE-071
      IMPLICIT REAL*8 (A-H,O-Z)                                         FITE-072
      DIMENSION F(*),X(*),E(*),W(*),NW(*),IZ(*),WA(*)                   FITE-073
      COMMON /DCHI2/ CHI2,CHI2M,YY(3)                                   FITE-074
      DATA EPS /1.D-5/                                                  FITE-075
      JD=(M+1)*(N+1)-1                                                  FITE-076
      JS=14+N                                                           FITE-077
      LM=M+N+1                                                          FITE-078
      K=IZ(1)                                                           FITE-079
      IF (KE.NE.0) GO TO 2                                              FITE-080
      IF (M.LT.N) GO TO 39                                              FITE-081
      IZ(3)=1                                                           FITE-082
      IZ(4)=0                                                           FITE-083
      DO 1 L=1,K                                                        FITE-084
      IZ(L+4)=1+K-L                                                     FITE-085
    1 W(JS+LM*L)=7.D35                                                  FITE-086
      IF (YY(2).LT.1.D0) YY(2)=1.D0                                     FITE-087
      KE=1                                                              FITE-088
    2 JM=JS+LM*IZ(5)-LM                                                 FITE-089
      J3=M*N                                                            FITE-090
      KV=K                                                              FITE-091
      IF (CHI2.LE.0.D0) GO TO 38                                        FITE-092
C ROW OF MATRIX S TO BE REPLACED BY NEW VALUES                          FITE-093
      L=IZ(K+4)                                                         FITE-094
      IF (W(JS+LM*L).EQ.7.D35) KV=L-1                                   FITE-095
      DO 3 I=1,K                                                        FITE-096
      J1=JS+LM*IZ(I+4)                                                  FITE-097
      IF (CHI2.LT.W(J1)) GO TO 4                                        FITE-098
    3 CONTINUE                                                          FITE-099
C ONE DIMENSIONAL SEARCH IS NECESSARY                                   FITE-100
      GO TO 30                                                          FITE-101
    4 IF (I.GT.MAX0(N+1,KV)) GO TO 30                                   FITE-102
C VECTOR OF LABELS OF THE QUADRATIC SUMS                                FITE-103
      IF (KV.LT.K) KV=KV+1                                              FITE-104
      I1=K+4                                                            FITE-105
      I2=K-I                                                            FITE-106
      IF ((IZ(3).GT.N+1).AND.(I.NE.1)) YY(1)=YY(1)/(4.D0*YY(2)**3)      FITE-107
      IF (I2.EQ.0) GO TO 6                                              FITE-108
      DO 5 J=1,I2                                                       FITE-109
      I1=I1-1                                                           FITE-110
    5 IZ(I1+1)=IZ(I1)                                                   FITE-111
      IZ(I1)=L                                                          FITE-112
      JM=JS+LM*IZ(5)-LM                                                 FITE-113
C NEW ROW                                                               FITE-114
    6 J1=JS+LM*(L-1)                                                    FITE-115
      DO 7 I=1,M                                                        FITE-116
      J1=J1+1                                                           FITE-117
    7 W(J1)=F(I)                                                        FITE-118
      DO 8 I=1,N                                                        FITE-119
      J1=J1+1                                                           FITE-120
    8 W(J1)=X(I)                                                        FITE-121
      W(J1+1)=CHI2                                                      FITE-122
      IF (IZ(3).GE.IZ(2)) GO TO 43                                      FITE-123
      IF (N.EQ.1) GO TO 35                                              FITE-124
      IF (IZ(3).GT.N+1) GO TO 13                                        FITE-125
C PREPARATORY FUNCTION EVALUATIONS                                      FITE-126
      MF=IZ(3)                                                          FITE-127
      IF (MF.EQ.1) GO TO 12                                             FITE-128
C SIGNIFICANCE OF THE NEW VARIABLE                                      FITE-129
      X(MF-1)=YY(3)                                                     FITE-130
      S=0.D0                                                            FITE-131
      DO 9 I=1,M                                                        FITE-132
      T=F(I)-W(JS+I)                                                    FITE-133
    9 S=S+T*T                                                           FITE-134
      J=2                                                               FITE-135
      IF (S.LT.EPS*EPS*W(JS+LM)) GO TO 41                               FITE-136
      YY(3)=S                                                           FITE-137
      W(MF-1)=DSQRT(YY(3))                                              FITE-138
      IF (MF.LE.2) GO TO 12                                             FITE-139
C INDEPENDENCE OF THE NEW VARIABLE                                      FITE-140
      DO 11 J=3,MF                                                      FITE-141
      I2=JS+LM*(J-2)                                                    FITE-142
      S=0.D0                                                            FITE-143
      DO 10 I=1,M                                                       FITE-144
   10 S=S+(W(I2+I)-W(JS+I))*(F(I)-W(JS+I))                              FITE-145
      IF (DABS(W(MF-1)*W(J-2)-DABS(S)).LT.EPS*DABS(S)) GO TO 40         FITE-146
   11 CONTINUE                                                          FITE-147
   12 IF (MF.EQ.N+1) GO TO 13                                           FITE-148
      YY(3)=X(MF)                                                       FITE-149
      X(MF)=X(MF)+YY(1)*E(MF)                                           FITE-150
      GO TO 64                                                          FITE-151
C END OF PREPARATORY FUNCTION EVALUATIONS                               FITE-152
C SUM OF INVERSES OF THE QUADRATIC SUMS                                 FITE-153
   13 S=0.D0                                                            FITE-154
      DO 14 L=1,KV                                                      FITE-155
      T=W(JS+LM*L)                                                      FITE-156
   14 S=S+1.D0/(T*T)                                                    FITE-157
      WJA=1.D0/S                                                        FITE-158
C CENTRE OF THE VARIABLES AND FUNCTIONS                                 FITE-159
      I1=M+N                                                            FITE-160
      DO 16 I=1,I1                                                      FITE-161
      J1=JS                                                             FITE-162
      S=0.D0                                                            FITE-163
      DO 15 L=1,KV                                                      FITE-164
      T=W(J1+LM)                                                        FITE-165
      S=S+W(J1+I)/(T*T)                                                 FITE-166
   15 J1=J1+LM                                                          FITE-167
   16 WA(J3+I)=S*WJA                                                    FITE-168
      IF (KE.NE.1) GO TO 47                                             FITE-169
C THE LINEAR APPROXIMATION MEANS THAT THE DIFFERENCE WITH CENTRAL VALUE FITE-170
C F(I,K)-F(I) = SUM F(I,J)*(X(J,K)-X(J)) WHERE F(I),X(J) ARE MEAN VALUESFITE-171
C AND F(I,J) IS THE FIRST DERIVATIVE WITH RESPECT TO X(J).              FITE-172
C USING THE MATRIX D(I,J) = WEIGHTED SUM ON (X(I,K)-X(I))*(X(J,K)-X(J)) FITE-173
C AND WRITING THE CHANGE DX = D*Y, THE BEST FIT IS OBTAINED FOR         FITE-174
C ||F-A*Y||=MIN(Y) WITH A(I,J)=WEIGHTED SUM(F(I,K)-F(I)*(X(J,K)-X(J))   FITE-175
C MATRIX A                                                              FITE-176
   17 J1=0                                                              FITE-177
      DO 19 I=1,N                                                       FITE-178
      U=WA(J3+M+I)                                                      FITE-179
      DO 19 J=1,M                                                       FITE-180
      J1=J1+1                                                           FITE-181
      J2=JS                                                             FITE-182
      S=0.D0                                                            FITE-183
      T=WA(J3+J)                                                        FITE-184
      DO 18 L=1,KV                                                      FITE-185
      V=W(J2+LM)                                                        FITE-186
      S=S+(W(J2+J)-T)*(W(J2+M+I)-U)/(V*V)                               FITE-187
   18 J2=J2+LM                                                          FITE-188
   19 WA(J1)=S*WJA                                                      FITE-189
      IF (KE.NE.1) GO TO 50                                             FITE-190
C LINEAR LEAST SQUARES PROBLEM                                          FITE-191
      CALL FIT2(M,N,WA,X,NW,IR,.TRUE.)                                  FITE-192
      IF (IR) 42 , 20 , 28                                              FITE-193
C MATRIX D                                                              FITE-194
   20 J1=JD                                                             FITE-195
      JA=J3+M                                                           FITE-196
      DO 23 I=1,N                                                       FITE-197
      T=WA(JA+I)                                                        FITE-198
      DO 22 J=1,I                                                       FITE-199
      J1=J1+1                                                           FITE-200
      J2=JS+M                                                           FITE-201
      S=0.D0                                                            FITE-202
      U=WA(JA+J)                                                        FITE-203
      DO 21 L=1,KV                                                      FITE-204
      V=W(J2+N+1)                                                       FITE-205
      S=S+(W(J2+I)-T)*(W(J2+J)-U)/(V*V)                                 FITE-206
   21 J2=J2+LM                                                          FITE-207
   22 WA(J1)=S*WJA                                                      FITE-208
   23 CONTINUE                                                          FITE-209
C NEW VARIABLES                                                         FITE-210
      DO 25 I=1,N                                                       FITE-211
      I2=1                                                              FITE-212
      J1=JD+(I*I-I)/2                                                   FITE-213
      S=0.D0                                                            FITE-214
      DO 24 J=1,N                                                       FITE-215
      J1=J1+I2                                                          FITE-216
      IF (J.GE.I) I2=J                                                  FITE-217
   24 S=S+WA(J1)*X(J)                                                   FITE-218
   25 WA(I)=WA(JA+I)-S                                                  FITE-219
C TEST OF CONVERGENCE                                                   FITE-220
      A=0.D0                                                            FITE-221
      DO 26 I=1,N                                                       FITE-222
      W(I)=WA(I)-W(JM+M+I)                                              FITE-223
   26 A=DMAX1(A,DABS(W(I)/E(I)))                                        FITE-224
      YY(1)=YY(1)*YY(2)                                                 FITE-225
      IF (A.LT.1.D0.OR.YY(1).LT.1.D0) GO TO 38                          FITE-226
      YY(3)=1.D0                                                        FITE-227
C STEP SIZE LIMITATION                                                  FITE-228
      IF (A.GT.2.D0*YY(1)) YY(3)=2.D0*YY(1)/A                           FITE-229
      DO 27 I=1,N                                                       FITE-230
   27 X(I)=W(JM+M+I)+YY(3)*W(I)                                         FITE-231
      IZ(4)=0                                                           FITE-232
      YY(1)=A*YY(3)                                                     FITE-233
      GO TO 64                                                          FITE-234
C RANDOM PREDICTION                                                     FITE-235
   28 DO 29 I=1,N                                                       FITE-236
   29 X(I)=W(JM+M+I)+YY(1)*E(I)*DFLOAT(MOD(IABS(NW(JM+I)),200)-100)/100.FITE-237
     1D0                                                                FITE-238
      YY(3)=0.D0                                                        FITE-239
      GO TO 64                                                          FITE-240
C ONE DIMENSIONAL SEARCH                                                FITE-241
   30 IF (N.EQ.1) GO TO 36                                              FITE-242
      IF (IZ(3).GE.IZ(2)) GO TO 43                                      FITE-243
      IF (IZ(4).EQ.2) GO TO 32                                          FITE-244
      IZ(4)=2                                                           FITE-245
      DO 31 I=1,N                                                       FITE-246
   31 W(I+14)=X(I)-W(JM+M+I)                                            FITE-247
      NW(1)=3                                                           FITE-248
      NW(2)=20                                                          FITE-249
      W(4)=0.5D0                                                        FITE-250
      W(7)=0.D0                                                         FITE-251
      W(8)=0.D0                                                         FITE-252
      W(9)=0.D0                                                         FITE-253
      W(10)=1.D0                                                        FITE-254
      W(12)=W(JM+LM)                                                    FITE-255
      W(13)=CHI2                                                        FITE-256
      GO TO 33                                                          FITE-257
   32 W(5)=CHI2                                                         FITE-258
      CALL FIT1(KE,NW,W(4))                                             FITE-259
   33 DO 34 I=1,N                                                       FITE-260
   34 X(I)=W(JM+M+I)+W(4)*W(I+14)                                       FITE-261
      IF (KE.EQ.3) KE=2                                                 FITE-262
      IF (KE.EQ.2) GO TO 43                                             FITE-263
      KE=1                                                              FITE-264
      YY(3)=W(4)                                                        FITE-265
      GO TO 64                                                          FITE-266
C ONLY ONE VARIABLE X                                                   FITE-267
   35 IF (IZ(3).GT.1) GO TO 36                                          FITE-268
      KE=0                                                              FITE-269
      W(6)=YY(1)*E(1)                                                   FITE-270
      W(7)=E(1)                                                         FITE-271
      W(8)=0.D0                                                         FITE-272
   36 NW(2)=IZ(2)                                                       FITE-273
      W(4)=X(1)                                                         FITE-274
      W(5)=CHI2                                                         FITE-275
      CALL FIT1(KE,NW,W(4))                                             FITE-276
      IZ(4)=2                                                           FITE-277
      X(1)=W(4)                                                         FITE-278
      IF (KE.EQ.1) GO TO 64                                             FITE-279
      IF (KE.GT.0) KE=KE+1                                              FITE-280
      YY(3)=0.D0                                                        FITE-281
      W(1)=0.D0                                                         FITE-282
      DO 37 J=1,M                                                       FITE-283
   37 F(J)=W(JM+I)                                                      FITE-284
      CHI2=W(JM+LM)                                                     FITE-285
      X(1)=W(JM+LM-1)                                                   FITE-286
      IF (NW(2).NE.0) GO TO 63                                          FITE-287
      W(1)=DSQRT(DABS((W(9)-W(11))/((W(12)-W(13))/(W(9)-W(10))-(W(13)-W(FITE-288
     114))/(W(10)-W(11)))))                                             FITE-289
      W(2)=1.D0                                                         FITE-290
      W(3)=1.D0                                                         FITE-291
      GO TO 60                                                          FITE-292
C END OF SEARCH                                                         FITE-293
   38 KE=0                                                              FITE-294
      IF (CHI2.EQ.0.D0.OR.IZ(2).LT.0) GO TO 64                          FITE-295
      GO TO 44                                                          FITE-296
C ERROR CODE DEFINITION                                                 FITE-297
   39 KE=KE+1                                                           FITE-298
   40 KE=KE+1                                                           FITE-299
   41 KE=KE+1                                                           FITE-300
   42 KE=KE+1                                                           FITE-301
   43 KE=KE+1                                                           FITE-302
      KE=KE+1                                                           FITE-303
C RESTORE OPTIMUM VALUES TO X AND F                                     FITE-304
   44 DO 45 I=1,M                                                       FITE-305
   45 F(I)=W(JM+I)                                                      FITE-306
      DO 46 I=1,N                                                       FITE-307
      X(I)=W(JM+M+I)                                                    FITE-308
   46 W(I)=0.D0                                                         FITE-309
      YY(3)=0.D0                                                        FITE-310
      CHI2=W(JM+LM)                                                     FITE-311
      IF (KE*(KE-3).NE.0.OR.(KE.EQ.3.AND.((YY(3).EQ.0.D0.AND.IZ(3).LE.N)FITE-312
     1))) GO TO 63                                                      FITE-313
C COMPUTATION OF THE ERRORS OF THE VARIABLES - RESTORE MATRIX G         FITE-314
      KV=MIN0(K,IZ(3))                                                  FITE-315
      GO TO 13                                                          FITE-316
C INVERSE OF MATRIX D                                                   FITE-317
   47 T=DSQRT(WJA)                                                      FITE-318
      J1=0                                                              FITE-319
      DO 49 I=1,N                                                       FITE-320
      S=WA(J3+M+I)                                                      FITE-321
      J2=JS+I-LM+M                                                      FITE-322
      DO 48 L=1,KV                                                      FITE-323
      J1=J1+1                                                           FITE-324
   48 WA(J1)=T*(W(J2+L*LM)-S)/W(JS+L*LM)                                FITE-325
   49 CONTINUE                                                          FITE-326
      CALL FIT2(KV,N,WA,WA(JD+1),NW,IR,.FALSE.)                         FITE-327
      IF (IR) 63 , 17 , 63                                              FITE-328
C MATRIX G = A*INVERSE OF D                                             FITE-329
   50 DO 54 L=1,M                                                       FITE-330
      J1=L-M                                                            FITE-331
      DO 52 I=1,N                                                       FITE-332
      I1=JD+(I*I-I)/2                                                   FITE-333
      I2=1                                                              FITE-334
      S=0.D0                                                            FITE-335
      DO 51 J=1,N                                                       FITE-336
      I1=I1+I2                                                          FITE-337
      IF (J.GE.I) I2=J                                                  FITE-338
   51 S=S+WA(I1)*WA(J1+J*M)                                             FITE-339
   52 W(I)=S                                                            FITE-340
      DO 53 J=1,N                                                       FITE-341
   53 WA(J1+J*M)=W(J)                                                   FITE-342
   54 CONTINUE                                                          FITE-343
C DIAGONAL ELEMENTS OF G(T)*G                                           FITE-344
      J1=0                                                              FITE-345
      DO 56 I=1,N                                                       FITE-346
      S=0.D0                                                            FITE-347
      DO 55 L=1,M                                                       FITE-348
      J1=J1+1                                                           FITE-349
   55 S=S+WA(J1)*WA(J1)                                                 FITE-350
   56 W(N+I)=DSQRT(S)                                                   FITE-351
C STANDARD ERRORS AND ERROR CORRELATIONS                                FITE-352
      CALL FIT2(M,N,WA,W(2*N+1),NW,IR,.FALSE.)                          FITE-353
      IF (IR.NE.0) GO TO 63                                             FITE-354
      DO 57 I=1,N                                                       FITE-355
      JDI=2*N+(I*I+I)/2                                                 FITE-356
      W(I)=DSQRT(W(JDI))                                                FITE-357
   57 W(N+I)=W(I)*W(N+I)                                                FITE-358
      J1=2*N                                                            FITE-359
      DO 59 I=1,N                                                       FITE-360
      DO 58 J=1,I                                                       FITE-361
      J1=J1+1                                                           FITE-362
   58 W(J1)=W(J1)/(W(I)*W(J))                                           FITE-363
   59 CONTINUE                                                          FITE-364
C ERROR RENORMALISATION FACTOR                                          FITE-365
   60 S=0.D0                                                            FITE-366
      DO 61 I=1,M                                                       FITE-367
   61 S=S+F(I)                                                          FITE-368
      YY(3)=DSQRT(DABS(CHI2-S*S/M)/MAX0(M-N-1,1))                       FITE-369
      DO 62 I=1,N                                                       FITE-370
   62 W(I)=W(I)*YY(3)                                                   FITE-371
   63 IZ(4)=M-N-1                                                       FITE-372
      IF ((KE-5)*(KE-6).NE.0) GO TO 64                                  FITE-373
      IZ(3)=J-2                                                         FITE-374
      IZ(4)=MF-1                                                        FITE-375
   64 IF (KE.EQ.1) IZ(3)=IZ(3)+1                                        FITE-376
      RETURN                                                            FITE-377
      END                                                               FITE-378
C 08/04/06                                                      ECIS06  FIT1-000
      SUBROUTINE FIT1(KE,I,W)                                           FIT1-001
C MINIMISATION OF A FUNCTION F(X) OF ONE VARIABLE X.                    FIT1-002
C INPUT:     AM:      TABLES OF MULTIPOLES.                             FIT1-003
C CALLING SEQUENCE                                                      FIT1-004
C    KE=0                                                               FIT1-005
C    I(2)=MAXIMUM NUMBER OF FUNCTION EVALUATIONS                        FIT1-006
C    W(1)=START VALUE OF X                                              FIT1-007
C    W(3)=FIRST STEP SIZE                                               FIT1-008
C    W(4)=ABSOLUTE SEARCH ACCURACY                                      FIT1-009
C    W(5)=RELATIVE SEARCH ACCURACY                                      FIT1-010
C  1 W(2)=FUNCTION VALUE F(X) AT X=W(1)                                 FIT1-011
C    CALL FIT1(KE,I,W)                                                  FIT1-012
C    IF(KE.EQ.1) GO TO 1                                                FIT1-013
C    XMIN=W(1)                                                          FIT1-014
C    FMIN=W(2)                                                          FIT1-015
C KE = ERROR CODE: KE=0 NO ERRORS, KE=                                  FIT1-016
C  2 MAXIMUM NUMBER OF FUNCTION EVALUATIONS                             FIT1-017
C  3 ROUNDING ERRORS, PROBABLY BECAUSE BOTH W(4) AND W(5) ARE TOO SMALL FIT1-018
C THE WORKING FIELDS I AND W HAVE THE LENGTH 3 AND 11 RESPECTIVELY      FIT1-019
C THEY CONTAIN ALL INFORMATION FOR THE CONTINUATION OF THE SEARCH       FIT1-020
C THEREFORE A SEARCH WITHIN ANOTHER SEARCH CAN BE DONE JUST CHANGING    FIT1-021
C THE WORKING FIELDS                                                    FIT1-022
C IF 2 FUNCTION VALUES F1 AND F2 ARE KNOWN FOR X = X1 AND X2 RESPECTIVE FIT1-023
C LY WITH X1 NE X2 ENTER THE CALLING SEQUENCE AFTER DEFINING :          FIT1-024
C KE = 1; I(1) = 3; W(6) = X1; W(7) = X2; W(9) = F1; W(10) = F2 AND     FIT1-025
C W(1) = USERS CHOICE                                                   FIT1-026
C WORKING FIELD VARIABLES:                                              FIT1-027
C I(1): CURRENT NUMBER OF FUNCTION EVALUATIONS                          FIT1-028
C I(2): MAXIMUM NUMBER OF FUNCTION EVALUATIONS                          FIT1-029
C I(3): MINIMUM POINTER, THE MINIMUM FUNCTION VALUE IS AT W(7+I(3))     FIT1-030
C W(1): CURRENT VALUE OF X                                              FIT1-031
C W(2): USER SUPPLIED FUNCTION VALUE                                    FIT1-032
C W(3): FIRST STEP SIZE                                                 FIT1-033
C W(4 AND 5): SEARCH ACCURACIES                                         FIT1-034
C W(6, 7 AND 8): X1, X2 AND X3 WITH X1 < X2 < X3                        FIT1-035
C W(9, 10 AND 11): FUNCTION VALUES AT X1, X2 AND X3 RESPECTIVELY        FIT1-036
C***********************************************************************FIT1-037
      IMPLICIT REAL*8 (A-H,O-Z)                                         FIT1-038
      DIMENSION I(3),W(11)                                              FIT1-039
      IF (KE.EQ.1) GO TO 2                                              FIT1-040
      KE=1                                                              FIT1-041
      I(1)=1                                                            FIT1-042
      I(3)=-1                                                           FIT1-043
      W(6)=W(1)                                                         FIT1-044
      W(9)=W(2)                                                         FIT1-045
    1 W(1)=W(1)+W(3)                                                    FIT1-046
      GO TO 11                                                          FIT1-047
    2 IF (I(1).GT.2) GO TO 3                                            FIT1-048
      I(3)=0                                                            FIT1-049
      W(7)=W(1)                                                         FIT1-050
      W(10)=W(2)                                                        FIT1-051
      IF (W(2).LE.W(9)) GO TO 1                                         FIT1-052
      I(3)=-1                                                           FIT1-053
      W(1)=W(6)-W(3)                                                    FIT1-054
      GO TO 11                                                          FIT1-055
    3 IF (I(1).GT.3) GO TO 5                                            FIT1-056
      W(8)=W(1)                                                         FIT1-057
      W(11)=W(2)                                                        FIT1-058
C ORDERING OF THE 3 FIRST VALUES OF X: W(6) < W(7) < W(8).              FIT1-059
      DO 4 J=1,3                                                        FIT1-060
      K=7-MOD(J,2)                                                      FIT1-061
      IF (W(K).LE.W(K+1)) GO TO 4                                       FIT1-062
      W(1)=W(K)                                                         FIT1-063
      W(K)=W(K+1)                                                       FIT1-064
      W(K+1)=W(1)                                                       FIT1-065
      K=K+3                                                             FIT1-066
      W(1)=W(K)                                                         FIT1-067
      W(K)=W(K+1)                                                       FIT1-068
      W(K+1)=W(1)                                                       FIT1-069
    4 CONTINUE                                                          FIT1-070
      I(3)=0                                                            FIT1-071
      IF (W(9).LT.W(10).AND.W(9).LT.W(11)) I(3)=-1                      FIT1-072
      IF (W(11).LT.W(10).AND.W(11).LT.W(9)) I(3)=1                      FIT1-073
      GO TO 9                                                           FIT1-074
C SORT IN THE NEW VALUES OF X AND F.                                    FIT1-075
    5 IF (I(3).EQ.0) GO TO 6                                            FIT1-076
      J=I(3)                                                            FIT1-077
      W(7-J)=W(7)                                                       FIT1-078
      W(10-J)=W(10)                                                     FIT1-079
      IF ((W(7+J)-W(1))*(W(1)-W(7)).GT.0.D0) GO TO 7                    FIT1-080
      W(7)=W(7+J)                                                       FIT1-081
      W(10)=W(10+J)                                                     FIT1-082
      W(7+J)=W(1)                                                       FIT1-083
      W(10+J)=W(2)                                                      FIT1-084
      IF (W(2).GE.W(10)) I(3)=0                                         FIT1-085
      GO TO 9                                                           FIT1-086
    6 J=-1                                                              FIT1-087
      IF (W(1).LT.W(7)) J=1                                             FIT1-088
      IF (W(2).GT.W(10)) GO TO 8                                        FIT1-089
      W(7+J)=W(7)                                                       FIT1-090
      W(10+J)=W(10)                                                     FIT1-091
    7 W(7)=W(1)                                                         FIT1-092
      W(10)=W(2)                                                        FIT1-093
      I31=I(3)+10                                                       FIT1-094
      IF (W(2).LE.W(I31)) I(3)=0                                        FIT1-095
      GO TO 9                                                           FIT1-096
    8 W(7-J)=W(1)                                                       FIT1-097
      W(10-J)=W(2)                                                      FIT1-098
    9 J=7+I(3)                                                          FIT1-099
C ERROR TESTS.                                                          FIT1-100
      IF (W(6).EQ.W(7).OR.W(7).EQ.W(8).OR.(W(9).EQ.W(10).AND.W(10).EQ.W(FIT1-101
     111))) GO TO 14                                                    FIT1-102
      IF (I(1).GE.I(2)) GO TO 15                                        FIT1-103
      IF (I(3).EQ.0) GO TO 10                                           FIT1-104
C STEP SIZE LIMITATION.                                                 FIT1-105
      W(1)=W(J)+(2*I(3))*DABS(W(6)-W(8))                                FIT1-106
      GO TO 11                                                          FIT1-107
C PREDICTION OF THE POSITION OF THE MINIMUM (PARABOLIC APPROXIMATION).  FIT1-108
   10 W(1)=((W(9)-W(10))/(W(6)-W(7))-(W(10)-W(11))/(W(7)-W(8)))/(W(6)-W(FIT1-109
     18))                                                               FIT1-110
      W(1)=.5D0*(W(6)+W(8)+(W(11)-W(9))/(W(1)*(W(6)-W(8))))             FIT1-111
C TEST OF CONVERGENCE.                                                  FIT1-112
      W(2)=DABS(W(1)-W(J))                                              FIT1-113
      IF (W(2).LT.DABS(W(4)).OR.W(2).LT.DABS(W(5)*W(J))) GO TO 12       FIT1-114
   11 I(1)=I(1)+1                                                       FIT1-115
      RETURN                                                            FIT1-116
   12 KE=0                                                              FIT1-117
   13 I37=I(3)+7                                                        FIT1-118
      W(1)=W(I37)                                                       FIT1-119
      I31=I(3)+10                                                       FIT1-120
      W(2)=W(I31)                                                       FIT1-121
      RETURN                                                            FIT1-122
   14 KE=KE+1                                                           FIT1-123
   15 KE=KE+1                                                           FIT1-124
      GO TO 13                                                          FIT1-125
      END                                                               FIT1-126
C 07/03/07                                                      ECIS06  FIT2-000
      SUBROUTINE FIT2(M,N,A,D,IP,IR,LLO)                                FIT2-001
C IF LLO=.TRUE. EX SUBROUTINE LILESQ WRITTEN BY SCHWEIMER..             FIT2-002
C  LINEAR LEAST SQUARES PROBLEM ||B-A*D||=MIN(D)                        FIT2-003
C  SOLVED BY HOUSEHOLDER TRANSFORMATIONS.                               FIT2-004
C INPUT:     M:       NUMBER OF ROWS OF A AND B.                        FIT2-005
C            N:       NUMBER OF COLUMNS OF A AND ROWS OF D.             FIT2-006
C            A:       M*N MATRIX FOLLOWED BY THE VECTOR B OF M          FIT2-007
C                     COMPONENTS (DESTROYED).                           FIT2-008
C OUTPUT:    A:       THE UPPER PART CONTAINS THE TRANSFORMED INPUT A   FIT2-009
C                     A(2,1) CONTAINS THE SQUARE OF THE EUCLIDEAN NORM. FIT2-010
C            D:       VECTOR OF VARIABLES, THE REDUNDANT VARIABLES ARE  FIT2-011
C                     SET TO ZERO. THE ||D||=MIN IS NOT USED BECAUSE THEFIT2-012
C                     COMPONENTS OF D ARE ASSUMED NOT COMMENSURABLE.    FIT2-013
C            IP:      PERMUTATION VECTOR OF N COMPONENTS, IT CONTAINS   FIT2-014
C                     THE COLUMN LABELS OF MATRIX A ORDERED ACCORDING   FIT2-015
C                     THEIR IMPORTANCE IN REDUCING THE EUCLIDEAN NORM.  FIT2-016
C            IR:      ERROR CODE: IR=0 NO ERROR, IR=-1 ALL COMPONENTS   FIT2-017
C                     OF D ARE ZERO AND MAY BE REDUNDANT, IR>0 THE      FIT2-018
C                     FIRST IR COMPONENTS OF IP CONTAIN THE LABELS OF   FIT2-019
C                     THE NONZERO COMPONENTS OF D, THE REMAINING        FIT2-020
C                     COMPONENTS OF D ARE ZERO AND MAY BE REDUNDANT.    FIT2-021
C  NOTE: ALL ARITHMETIC OPERATIONS ARE PERFORMED IN DOUBLE PRECISION,   FIT2-022
C  AN ITERATIVE IMPROVEMENT IS IMPOSSIBLE WITHOUT SAVING A AND B.       FIT2-023
C  THE ROUND OFF ERROR OF ||B-A*D||**2 IS APPROXIMATELY GIVEN BY        FIT2-024
C  ||B(INITIAL)||**2 - ||B(TRANSFORMED)||**2                            FIT2-025
C                                                                       FIT2-026
C IF LLO=.FALSE. EX SUBROUTINE INVATA WRITTEN BY SCHWEIMER.             FIT2-027
C  INVERSION OF THE PRODUCT MATRIX A(TRANSPOSED)*A                      FIT2-028
C  THE MATRIX A IS REDUCED TO AN UPPER TRIANGULAR MATRIX R BY           FIT2-029
C  HOUSEHOLDER TRANSFORMATIONS. THE REMAINING COMPUTATION IS STRAIGHT   FIT2-030
C  FORWARD.                                                             FIT2-031
C INPUT:     M:       NUMBER OF COLUMNS OF MATRIX A.                    FIT2-032
C            N:       NUMBER OF ROWS OF MATRIX A, M >= N > 0.           FIT2-033
C            A:       INPUT MATRIX (DESTROYED).                         FIT2-034
C OUTPUT:    A:       TRIANGULAR MATRIX R, R=A(I,J) I<=J=1,N.           FIT2-035
C            D:       VECTOR OF LENGTH (N*(N+1))/2, IT CONTAINS THE     FIT2-036
C                     UPPER TRIANGULAR PART OF THE INVERSE OF A(T)*A.   FIT2-037
C            IP:      PERMUTATION VECTOR OF LENGTH N, ITS FIRST IR      FIT2-038
C                     COMPONENTS CONTAIN THE LABELS OF THE USEFUL       FIT2-039
C                     COLUMNS OF A, THE LAST COMPONENTS CONTAIN THE     FIT2-040
C                     LABELS OF THE COLUMNS WHICH ARE LINEAR            FIT2-041
C                     COMBINATIONS OF THE FIRST.                        FIT2-042
C            IR:      ERROR CODE: IR=0 NO ERROR (RANK OF MATRIX A IS N),FIT2-043
C                     IR=-1 RANK OF MATRIX A IS ZERO, IR>0 RANK OF      FIT2-044
C                     MATRIX A IS IR, THE INVERSE OF A(T)*A IS COMPUTED FIT2-045
C                     CONSIDERING THE IR COLUMNS OF A INDICATED BY THE  FIT2-046
C                     FIRST IR COMPONENTS OF IP.                        FIT2-047
C***********************************************************************FIT2-048
      IMPLICIT REAL*8 (A-H,O-Z)                                         FIT2-049
      LOGICAL LLO                                                       FIT2-050
      DIMENSION A(M,*),D(*),IP(N)                                       FIT2-051
      IR=0                                                              FIT2-052
      N1=N                                                              FIT2-053
      IF (LLO) N1=N+1                                                   FIT2-054
      DO 1 J=1,N                                                        FIT2-055
    1 IP(J)=J                                                           FIT2-056
C ROTATION LOOP.                                                        FIT2-057
      DO 13 K=1,N                                                       FIT2-058
C PIVOT ELEMENT    COLUMN J WHICH GENERATES THE LARGEST NEW A(*,M) AND  FIT2-059
C AND LINE I OF THE LARGEST ELEMENT OF COLUMN J IF LLO=.TRUE.           FIT2-060
C COLUMN AND LINE OF LARGEST ELEMENT IF LLO=.FALSE.                     FIT2-061
      U=0.D0                                                            FIT2-062
      DO 7 J=K,N                                                        FIT2-063
      C=0.D0                                                            FIT2-064
      DO 2 I=K,M                                                        FIT2-065
      IF (DABS(A(I,J)).LE.DABS(C)) GO TO 2                              FIT2-066
      L2=I                                                              FIT2-067
      C=A(I,J)                                                          FIT2-068
    2 CONTINUE                                                          FIT2-069
      IF (C.EQ.0.D0) GO TO 7                                            FIT2-070
      S=0.D0                                                            FIT2-071
      IF (LLO) GO TO 4                                                  FIT2-072
      IF (DABS(C).LT.U) GO TO 7                                         FIT2-073
      U=DABS(C)                                                         FIT2-074
      DO 3 I=K,M                                                        FIT2-075
      V=A(I,J)/C                                                        FIT2-076
    3 S=S+V*V                                                           FIT2-077
      GO TO 6                                                           FIT2-078
    4 T=0.D0                                                            FIT2-079
      DO 5 I=K,M                                                        FIT2-080
      V=A(I,J)/C                                                        FIT2-081
      S=S+V*V                                                           FIT2-082
    5 T=T+V*A(I,N1)                                                     FIT2-083
      IF (U.GE.T*(T/S)) GO TO 7                                         FIT2-084
      U=T*(T/S)                                                         FIT2-085
    6 SIG=C*DSQRT(S)                                                    FIT2-086
      L=J                                                               FIT2-087
      L1=L2                                                             FIT2-088
    7 CONTINUE                                                          FIT2-089
      IF (U.EQ.0.D0) GO TO 14                                           FIT2-090
C PERMUTE COLUMNS OF A(K).                                              FIT2-091
      I=IP(L)                                                           FIT2-092
      IP(L)=IP(K)                                                       FIT2-093
      IP(K)=I                                                           FIT2-094
      DO 8 I=1,M                                                        FIT2-095
      C=A(I,L)                                                          FIT2-096
      A(I,L)=A(I,K)                                                     FIT2-097
    8 A(I,K)=C                                                          FIT2-098
C PERMUTE LINES OF A(K).                                                FIT2-099
      DO 9 J=K,N1                                                       FIT2-100
      C=A(K,J)                                                          FIT2-101
      A(K,J)=A(L1,J)                                                    FIT2-102
    9 A(L1,J)=C                                                         FIT2-103
C ROTATION OF THE LOWER COLUMN FRAGMENT OF A(K) AND B(K).               FIT2-104
      U=SIG+A(K,K)                                                      FIT2-105
      V=A(K,K)/SIG                                                      FIT2-106
      A(K,K)=-SIG                                                       FIT2-107
      L=K+1                                                             FIT2-108
      IF (L.GT.M) A(K,L)=-A(K,L)                                        FIT2-109
      IF (L.GT.N1.OR.L.GT.M) GO TO 13                                   FIT2-110
      DO 12 J=L,N1                                                      FIT2-111
      S=V*A(K,J)                                                        FIT2-112
      DO 10 I=L,M                                                       FIT2-113
      T=A(I,K)/SIG                                                      FIT2-114
   10 S=S+T*A(I,J)                                                      FIT2-115
      T=(A(K,J)+S)/U                                                    FIT2-116
      A(K,J)=-S                                                         FIT2-117
      DO 11 I=L,M                                                       FIT2-118
   11 A(I,J)=A(I,J)-T*A(I,K)                                            FIT2-119
   12 CONTINUE                                                          FIT2-120
   13 CONTINUE                                                          FIT2-121
C END OF ROTATION LOOP.                                                 FIT2-122
      K=N                                                               FIT2-123
      GO TO 15                                                          FIT2-124
   14 K=K-1                                                             FIT2-125
      IR=K                                                              FIT2-126
   15 IF (LLO) GO TO 22                                                 FIT2-127
      IF (K.EQ.0) GO TO 29                                              FIT2-128
C INVERSE OF THE TRIANGULAR MATRIX R STORED IN D.                       FIT2-129
      DO 18 J=1,K                                                       FIT2-130
      D(J)=A(J,J)                                                       FIT2-131
      A(J,J)=1.D0/D(J)                                                  FIT2-132
      IF (J.EQ.1) GO TO 18                                              FIT2-133
      I=J                                                               FIT2-134
      DO 17 L=2,J                                                       FIT2-135
      I1=I                                                              FIT2-136
      I=I-1                                                             FIT2-137
      S=0.D0                                                            FIT2-138
      DO 16 L1=I1,J                                                     FIT2-139
   16 S=S+A(I,L1)*A(J,L1)                                               FIT2-140
   17 A(J,I)=-S/D(I)                                                    FIT2-141
   18 CONTINUE                                                          FIT2-142
C INVERSE OF THE PRODUCT MATRIX.                                        FIT2-143
      DO 21 J=1,K                                                       FIT2-144
      DO 20 I=1,J                                                       FIT2-145
      L=MAX0(IP(J),IP(I))                                               FIT2-146
      IJ=IP(I)+IP(J)+(L*(L-3))/2                                        FIT2-147
      S=0.D0                                                            FIT2-148
      DO 19 L1=J,K                                                      FIT2-149
   19 S=S+A(L1,I)*A(L1,J)                                               FIT2-150
   20 D(IJ)=S                                                           FIT2-151
   21 CONTINUE                                                          FIT2-152
      GO TO 30                                                          FIT2-153
C SQUARE OF THE EUCLIDEAN NORM.                                         FIT2-154
   22 S=0.D0                                                            FIT2-155
      L=K+1                                                             FIT2-156
      IF (K.EQ.M) GO TO 24                                              FIT2-157
      DO 23 I=L,M                                                       FIT2-158
   23 S=S+A(I,N1)*A(I,N1)                                               FIT2-159
   24 A(2,1)=S                                                          FIT2-160
      IF (K.EQ.N) GO TO 26                                              FIT2-161
C COMPONENTS OF D WHICH DO NOT REDUCE THE EUCLIDEAN NORM.               FIT2-162
      DO 25 J=L,N                                                       FIT2-163
      IJ=IP(J)                                                          FIT2-164
   25 D(IJ)=0.D0                                                        FIT2-165
      IF (K.EQ.0) GO TO 29                                              FIT2-166
C COMPUTATION OF D.                                                     FIT2-167
   26 IJ=IP(K)                                                          FIT2-168
      D(IJ)=A(K,N1)/A(K,K)                                              FIT2-169
      IF (K.EQ.1) GO TO 30                                              FIT2-170
      DO 28 J=2,K                                                       FIT2-171
      L=K+2-J                                                           FIT2-172
      S=A(L-1,N1)                                                       FIT2-173
      DO 27 I=L,K                                                       FIT2-174
      IJ=IP(I)                                                          FIT2-175
   27 S=S-A(L-1,I)*D(IJ)                                                FIT2-176
      IJ=IP(L-1)                                                        FIT2-177
   28 D(IJ)=S/A(L-1,L-1)                                                FIT2-178
      GO TO 30                                                          FIT2-179
C ERROR CODE.                                                           FIT2-180
   29 IR=-1                                                             FIT2-181
   30 RETURN                                                            FIT2-182
      END                                                               FIT2-183


