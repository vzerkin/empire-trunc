#! /bin/sh -
#script to format EMPIRE II output
if [ -z $EMPIREDIR ]; then
    echo "Please set the 'EMPIREDIR' environment variable."
    echo "See Empire v3 documentation for more information."
    exit
fi

file=$1
MATid=$2
work=`pwd`
if [ "$1" = "" ]
   then
echo 'Inputs ready to run'
echo ' '
ls *out
echo ' '
echo -n 'Choose one of the above (without .out extention!): '
read file
fi                          

#run EMPEND to format EMPIRE output into ENDF

# EMPEND takes .out file, writes endf. Also needs mesh, thinning, and MAT:
cat >EMPEND.INP <<EOF
$file.out
$file-e.endf
1 
0.1
$2
EOF
$EMPIREDIR/util/empend/empend <EMPEND.INP
mv empend.log $file-log.empend
rm EMPEND.INP empmf1.tmp


# RECONSTRUCT (N,N), (N,P), AND (N,A) REACTIONS WITH FIXUP
# careful, looks like fixup has fixed-form input

rm $file-f.endf 2>/dev/null
ln -sf $file-e.endf OUTPUT.ENDF
cat >FIXUP.INP <<EOF
12101011111001                                                              
OUTPUT.ENDF                                                                        
FIXUP.ENDF  
S  4=+( 50, 91)
S103=+(600,649)
S104=+(650,699)
S105=+(700,749)
S106=+(750,799)
S107=+(800,849)
S  3=+(  4,  5)+( 11, 18)+( 22, 26)+(28, 37)+( 41, 45)+(102,117)
S  2=+(  1,  1)-(  3,  3)

 0.00000+00 0.00000+00          0          0${2}  4

 0.00000+00 0.00000+00          0          0${2}103

 0.00000+00 0.00000+00          0          0${2}107







                                                                      
                                                                      
EOF
#cp FIXUP1.INP FIXUP.INP
$EMPIREDIR/util/fixup/fixup < FIXUP.INP
rm OUTPUT.ENDF
rm FIXUP.INP
mv FIXUP.ENDF $work/$file-f.endf
mv FIXUP.LST $work/$file-log.fixup


# RUN ENDRES TO INCLUDE RESONANCE PARAMETRS (FILE 2), currently disabled:
# second input line should point to file containing MF2 (and 32?)

#rm $file.endf 2>/dev/null
#cat >ENDRES.INP <<EOF
#$file-f.endf
#$file-resonances.endf
#endf.dat
#0
#EOF
#
#../util/endres/endres < ENDRES.INP
#mv endf.dat $file.endf
#mv endres.lst $file-log.endres

# $work/$file.endf is the final ENDF output file
mv $file-f.endf $file.endf

# RUN STANEF

rm -f INPUT
cat >INPUT <<EOF
$file.endf
$file-stan.endf
0

DONE
EOF
$EMPIREDIR/util/stanef/stanef <INPUT
mv $file-stan.endf $file.endf

# remove left-over files
rm INPUT 2>/dev/null
rm angdis.cur 2>/dev/null
rm angdis.pnt 2>/dev/null

exit
