Title  : EMPEND Program
Purpose: Convert EMPIRE output into ENDF format
Author : A.Trkov 
Version: original code ENEA, Bologna, Italy, 1996
         current version developed at IAEA, Vienna, Austria
  98/10 Final version for distribution.
  99/11 Minor corrections to fix bugs.
  00/11 Implement formatting of elastic ang.distrib.
  00/12 Process total cross section.
  02/05 Fix MF4 processing for discrete levels.
  02/09 - Fix thresholds for multi-particle emission
        - Photon branching ratios for the last level (MF12)
        - Atomic weight ratios for target and recoils.
  02/11 Implement continuum photon spectra processing.
  03/06 Define MT numbers for incident protons.
  03/07 Fix processing of double differential data for protons.
  04/06 - Process discrete levels flagged with -ve energies.
        - Let EMPIRE to handle max. outgoing particle energy.
  04/07 - Fix ordering of levels in MF12,
        - Read in values in double precision to avoid underflow.
        - Fix MTs and yields of minor reactions (37, 41, etc).
  04/07 - Add (n,5n) MT47
        - Check for absence of distribution data (NP=0 in MF6).
  04/09 - Check for normalisation overflow in WRIMF4
  04/10 Implement formatting for incident alphas and photons.
  
  Manual for Program EMPEND
  =========================
  
  The EMPIRE output is processed and converted into ENDF 
  format. The ENDF formatted output file has to obey the
  rule of ordering the reactions in increasing order by
  the reaction MT number, so several sweeps of the EMPIRE
  file are made:
   - In the first sweep the cross sections and the
     corresponding reaction Q-values are extracted.
   - In the next sweep all reactions for which particle
     spectra are given are identified.
   - Another sweep is made for each reaction requiring
     an ENDF file-4 section. Particularly, these
     data are entered for discrete level reactions.
   - Next follows a sweep for each reaction having
     energy-angle correlated outgoing particle distributions.
   - Finally, a sweep is made for the remaining reactions,
     particularly the (n,gamma) reaction, for which the
     particle distributions are coded in ENDF Files-12, 14
     and 15.
  
  The cross section data found on the file are fitted by
  a cubic spline and entered into the output ENDF file on
  a user-defined dense energy grid, thinned to the specified
  tolerance and taking reaction thresholds into account.
  If desired, the spline interpolation may be suppressed
  and the energy points found on the file are entered
  directly into the ENDF formatted file.
  
  The angular distributions for discrete level reactions
  that appear in the ENDF file-4 sections are extracted from
  the spectra on the EMPIRE output file, interpolated to
  the appropriate energy, if necessary.

  The correlated energy-angle distributions for continuum
  reactions that appear in ENDF file-6 sections are entered
  in Legendre polynomial representation in the centre-of-
  mass coordinate system. The maximum Legendre order is
  limited to 12. For reactions with relatively smooth
  angular distributions, the number of coefficients is
  reduced accordingly.

  Photon production reactions, which remain to be specified,
  particularly the (n,gamma) reaction, are given in the ENDF
  files-12, 14 and 15. Photon multiplicity is stored in 
  file-12. Isotropic angular distribution is assumed and
  written to file 14. The particle energy distribution is
  written to file15.

  Instructions:
  The program can be executed interactively from a terminal
  screen. The required input is entered in response to the
  prompts, which are the following:
   - The name of the EMPIRE output file to be processed.
   - The name of the ENDF formatted file to be written.
   - Number of subintervals per incident neutron energy 
     interval on the EMPIRE output file. The dubintervals
     define the fine energy mesh on the ENDF formatted
     file. If zero is entered, only the points on the
     EMPIRE output are entered to the ENDF formatted file.
   - Thinning tolerance limit [%] to reduce the number of
     cross section points. Data points which, can be
     reproduced from the neighbouring points by linear 
     interpolation to within the specified tolerance, are 
     removed. Entering a negative value for the thinning
     tolerance limit causes thinning to be suppressed.
   - ENDF material number identifier.

  To monitor the formatting process for quality assurance
  purposes, the EMPEND.LOG file is written in which the
  details of the formatting process are recorded. A limited
  amount of checking is done. An entry to the log file is
  added in the follwing cases:
   - The cross section obtained by integrating the spectrum
     should agree with the value given directly in the
     EMPIRE output file. If the difference exceeds 2%,
     a warning message is written, giving the reaction
     MT number, the incident particle energy, the expected
     cross section (i.e. the value given directly in the
     EMPIRE output file) and the percent difference.
   - The angular distributions are fitted to determine the
     Legendre polynomial expansion coefficients. If the
     distribution reconstructed from the Legendre polynomial
     coefficients differs from the pointwise values on the
     EMPIRE output file by more than 5%, a warning message
     is written, giving the reaction MT number, the outgoing
     particle ZA identifier, the incident and the outgoing
     particle energies and the percent difference in the
     fitted distribution from the pointwise value on the
     file.
  Additional messages monitor the progress of the data
  formatting process.
